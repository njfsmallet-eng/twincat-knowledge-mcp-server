---
title: "TF8000 Twin CAT 3"
product: "TF8000"
category: "Building_Automation"
tags: ["CAT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.3.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF8000_TC3_HVAC_EN.pdf"
release_date: "2025-02-03"
---
Manual | EN TF8000 Twin CAT 3 | HVAC 2025-02-03 | Version: 1.3.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 2.1 Target groups.................................................................................................................................... 8 2.2 User requirement profile.................................................................................................................... 8 2.3 General technical characteristics...................................................................................................... 9 2.3.1 Integration into Twin CAT.................................................................................................... 9 2.3.2 Hardware requirements...................................................................................................... 9 2.3.3 Remanent data................................................................................................................... 9 2.3.4 Default values.................................................................................................................... 9 2.3.5 Value range monitoring.................................................................................................... 10 3 General Information................................................................................................................................ 11 4 Integration in Twin CAT........................................................................................................................... 12 4.1 System requirements...................................................................................................................... 12 4.2 Installation....................................................................................................................................... 12 4.3 Licensing......................................................................................................................................... 15 5 Programming........................................................................................................................................... 18 5.1 POUs............................................................................................................................................... 18 5.1.1 Overview.......................................................................................................................... 18 5.1.2 HVAC Actuators............................................................................................................... 25 5.1.3 HVAC Analog modules.................................................................................................... 67 5.1.4 HVAC Controller............................................................................................................. 109 5.1.5 HVAC Room Functions.................................................................................................. 184 5.1.6 HVAC Setpoint modules................................................................................................ 321 5.1.7 HVAC Special functions................................................................................................. 335 5.1.8 HVAC Time schedule..................................................................................................... 460 5.1.9 HVAC System................................................................................................................ 476 5.1.10 Backup Var...................................................................................................................... 484 5.1.11 Functions........................................................................................................................ 486 5.2 DUTs............................................................................................................................................. 487 5.2.1 E_HVAC2Point Actuator Mode........................................................................................ 487 5.2.2 E_HVAC2Point Ctrl Mode................................................................................................ 487 5.2.3 E_HVAC3Point Actuator Mode........................................................................................ 487 5.2.4 E_HVACActuator Mode.................................................................................................. 488 5.2.5 E_HVACAir Conditioning2Speed Mode........................................................................... 488 5.2.6 E_HVACAnalog Output Mode.......................................................................................... 488 5.2.7 E_HVACAnti Blocking Mode............................................................................................ 488 5.2.8 E_HVACBus Terminal_KL32xx....................................................................................... 488 5.2.9 E_HVACCtrl Mode.......................................................................................................... 489 5.2.10 E_HVACConvection Mode.............................................................................................. 490 5.2.11 E_HVACData Security Type............................................................................................ 490 TF8000 Version: 1.3.0 3
## Page 4

Table of contents 5.2.12 E_HVACError Codes...................................................................................................... 490 5.2.13 E_HVACExternal Mode................................................................................................... 490 5.2.14 E_HVACExternal Request Mode..................................................................................... 491 5.2.15 E_HVACPlant Mode........................................................................................................ 491 5.2.16 E_HVACPower Measurement Mode................................................................................ 491 5.2.17 E_HVACReferencing Mode............................................................................................ 491 5.2.18 E_HVACReg Outside Temp............................................................................................. 491 5.2.19 E_HVACReq Pump......................................................................................................... 491 5.2.20 E_HVACReg Valve......................................................................................................... 492 5.2.21 E_HVACSensor Type..................................................................................................... 492 5.2.22 E_HVACSequence Ctrl Mode.......................................................................................... 492 5.2.23 E_HVACSetpoint Heating Mode...................................................................................... 493 5.2.24 E_HVACSetpoint Mode................................................................................................... 493 5.2.25 E_HVACState................................................................................................................ 493 5.2.26 E_HVACTemperature Curve........................................................................................... 494 5.2.27 E_HVACTemperature Sensor Mode................................................................................ 494 5.2.28 ST_HVAC2Point Ctrl Sequence....................................................................................... 494 5.2.29 ST_HVACAggregate...................................................................................................... 494 5.2.30 ST_HVACCmd Ctrl_8Param........................................................................................... 495 5.2.31 ST_HVACCmd Ctrl_8State............................................................................................. 495 5.2.32 ST_HVACHoliday........................................................................................................... 495 5.2.33 ST_HVACI_Ctrl.............................................................................................................. 495 5.2.34 ST_HVACPeriod............................................................................................................ 496 5.2.35 ST_HVACParameter Scale_n Point................................................................................. 496 5.2.36 ST_HVACPower Measurement...................................................................................... 496 5.2.37 ST_HVACPower Measurement Ex.................................................................................. 497 5.2.38 ST_HVACPower Range Table......................................................................................... 497 5.2.39 ST_HVACTime Channel................................................................................................. 498 5.2.40 ST_HVACTemp Change Function................................................................................... 498 5.2.41 HVAC room functions..................................................................................................... 498 5.3 GVLs............................................................................................................................................. 503 5.3.1 Constants....................................................................................................................... 503 5.3.2 Parameter...................................................................................................................... 504 6 Appendix................................................................................................................................................ 506 6.1 Calculation of switching time when changing sequence............................................................... 506 6.2 Table of sequence controller operating modes............................................................................. 508 6.3 Support and Service...................................................................................................................... 508 6.4 ADS Return Codes........................................................................................................................ 510 4 Version: 1.3.0 TF8000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. It is absolutely necessary to comply with the documentation and the following notes and explanations when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS®, and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Patents The Ether CAT Technology is covered by the following patent applications and patents, without this constituting an exhaustive list: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 and similar applications and registrations in several other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party brands Third-party trademarks and wordmarks are used in this documentation. The trademark endorsements can be found at: https://www.beckhoff.com/trademarks TF8000 Version: 1.3.0 5
## Page 6

Foreword 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.3.0 TF8000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF8000 Version: 1.3.0 7
## Page 8

Overview 2 Overview This library is used for the maintenance and servicing of existing projects! For new projects, please use the components of TF8040 Twin CAT Building Automation. Convenience, energy saving, low investment and running costs, and therefore a quick return on investment are the ambitious aims of a building automation system. A basic prerequisite therefore is an integrated, coordinated control system for automating all technical building services. By using the HVAC library, all PLC programs, including central heating, air conditioning, and room automation functions, can be programmed with Twin CAT PLC Control and are then available as function blocks within the building automation library. The Beckhoff system integrator thus receives a wide range of established, tried-and-tested functions. This simplifies the implementation of the complex and interoperable building automation functions and cuts down on engineering work. In addition, the life cycle costs of the system are reduced, since servicing and maintenance work can focus on a single programming software and hardware platform. With the room automation functions for air conditioning, lighting, and shading devices, systems that meet the highest energy efficiency standard, EN 15232 Class A, can be configured. Moreover, the object-oriented encapsulation of the building automation functions offers the following benefits: • fast creation of system programs • fast parameterization and commissioning of the systems • a very large range of system functions is guaranteed at all times • transparency in programs (prerequisite for long-term maintainability and expandability of the systems) • once created, good reusability of templates for systems or system subassemblies • staff training is easy • straightforward extension and modification of existing systems • specifications for a clear, object-oriented structure for the creation of visualization objects in MMI and SCADA systems • programs are easier to document 2.1 Target groups This software library is intended for building automation system partners of Beckhoff Automation Gmb H. The system partners operate in the field of building automation and are concerned with the installation, commissioning, expansion, maintenance and service of measurement, control and regulating systems for the technical equipment of buildings. 2.2 User requirement profile The user of this library requires basic knowledge of the following. • Twin CAT PLC • Twin CAT System • PC and network knowledge • Structure and properties of the Beckhoff Embedded PC and its Bus Terminal system. • Technology of heating, ventilation, air conditioning and sanitary systems • Relevant safety regulations for building technical equipment 8 Version: 1.3.0 TF8000
## Page 9

Overview 2.3 General technical characteristics 2.3.1 Integration into Twin CAT Requirements Development environ- Target platform Twin CAT PLC function Twin CAT Standard PLC ment to be implemented libraries to be imple- mented Twin CAT 3.1 build PC or CX Tc2_HVAC Tc2_Coupler; 4022.16 or higher Tc2_Io Functions; Tc2_Math; Tc2_Standard; Tc2_System; Tc2_Utilities 2.3.2 Hardware requirements The HVAC library is usable on all PC-based hardware platforms. The ideal target platforms for heating, ventilation, air conditioning and sanitary applications are the Embedded PCs from the CX series. 2.3.3 Remanent data The controllers have either a NOVRAM and/or a flash for saving remanent data. The IN_OUT variables are monitored for changes in their values for automatic saving after a parameter change. In the event of a change, an internal variable in the library is triggered, with which the function blocks FB_HVACNOVRAMData Handling or FB_HVACPersistent Data Handling are activated. The IN_OUT variables are saved in a binary file in the flash if e Data Security Type:= e HVACData Security Type_Persistent. The prerequisite for this is a single instancing of the function block FB_HVACPersistant Data Handling. Writing of the IN_OUT variables is deactivated if e Data Security Type:= e HVACData Security Type_Idle. Nevertheless, the variables must be located or addressed for remanent storage. They will then be saved in the NOVRAM in the event of a change of value. The prerequisite for this is the instancing of the function block FB_HVACNOVRAMData Handling, as well as an instance of the respective data type that is to be saved. Example: An instance of FB_HVACNOVRAM_Byte must be used in the case of a variable of type BYTE. NOTICE Flash destruction An IN_OUT variable that has been declared as persistent must not be written cyclically if e Data Security Type: = e HVACData Security Type_Persistent, since otherwise the flash will be prematurely destroyed. Regarding this subject, it is strongly recommended that you read the documentation on the function blocks FB_HVACNOVRAMData Handling or FB_HVACPersistent Data Handling and familiarize yourself with the examples contained in the documentation! 2.3.4 Default values Default values are declared inside the function block for all system parameters. When the controller is restarted, a check is made as to whether values already exist in the NOVRAM or flash of the controller. If values exist in the binary file in flash or NOVRAM, they will be written back automatically to the IN_OUT variables during the first cycle. Hence, the controller starts automatically with the last saved remanent data. The default values can be activated at any time by a rising edge at the input variable b Set Default. TF8000 Version: 1.3.0 9
## Page 10

Overview 2.3.5 Value range monitoring A value range is defined for each input parameter of the function block. After the input of a value out of its premissible range the last valid value is automatically written back by the function block. The attempt to input an invalid parameter value is indicated by a TRUE at the output variable b Invalid Parameter. The variable b Invalid Parameter can be reset by a rising edge at the input variable b Reset. 10 Version: 1.3.0 TF8000
## Page 11

General Information 3 General Information Further libraries required For PC systems and Embedded PCs (CXxxxx): • Tc2_Coupler • Tc2_IOFunctions • Tc2_Math • Tc2_Standard • Tc2_System • Tc2_Utilities TF8000 Version: 1.3.0 11
## Page 12

Integration in Twin CAT 4 Integration in Twin CAT 4.1 System requirements Technical data Requirement Operating system Windows 7/10, Windows Embedded Standard 7, Windows CE 7 Target platform PC architecture (x86, x64 or ARM) Twin CAT version Twin CAT 3.1 build 4022.16 or higher Required Twin CAT setup level Twin CAT 3 XAE, XAR Required Twin CAT license TF8000 TC3 HVAC 4.2 Installation The following section describes how to install the Twin CAT 3 Function for Windows-based operating systems. ü The Twin CAT 3 Function setup file was downloaded from the Beckhoff website. 1. Run the setup file as administrator. To do this, select the command Run as administrator in the context menu of the file. ð The installation dialog opens. 2. Accept the end user licensing agreement and click Next. 12 Version: 1.3.0 TF8000
## Page 13

Integration in Twin CAT 3. Enter your user data. 4. If you want to install the full version of the Twin CAT 3 Function, select Complete as installation type. If you want to install the Twin CAT 3 Function components separately, select Custom. TF8000 Version: 1.3.0 13
## Page 14

Integration in Twin CAT 5. Select Next, then Install to start the installation. ð A dialog box informs you that the Twin CAT system must be stopped to proceed with the installation. 6. Confirm the dialog with Yes. 14 Version: 1.3.0 TF8000
## Page 15

Integration in Twin CAT 7. Select Finish to exit the setup. ð The Twin CAT 3 Function has been successfully installed. 4.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. TF8000 Version: 1.3.0 15
## Page 16

Integration in Twin CAT 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 16 Version: 1.3.0 TF8000
## Page 17

Integration in Twin CAT 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. TF8000 Version: 1.3.0 17
## Page 18

Programming 5 Programming 5.1 POUs 5.1.1 Overview HVAC actuators Name Description FB_HVAC2Point Actuator [} 25] Control of two-point dampers or valves FB_HVAC3Point Actuator [} 27] Control of three-point dampers or valves FB_HVACCirculation Pump [} 29] Control of pumps FB_HVACCirculation Pump Ex [} 32] Control of pumps; the control of the output b Pump has been changed compared to FB_HVACCirculation Pump FB_HVACMotor1Speed [} 43] Control of single-speed drives FB_HVACMotor2Speed [} 47] Control of two-speed drives FB_HVACMotor3Speed [} 52] Control of three-speed drives FB_HVACRedundancy Ctrl [} 62] Control of up to eight actuators depending on the runtime; uses an internal timer for determining the runtime FB_HVACRedundancy Ctrl Ex [} 65] Control of up to eight actuators depending on the runtime; the runtimes of the actuators must be created externally as hour values. HVAC analog modules Name Description FB_HVACAnalog Input [} 67] Acquisition of analog input signals FB_HVACAnalog Output [} 70] Control of analog actuators FB_HVACAnalog Output Ex [} 72] Control of analog actuators with integrated scaling function FB_HVACAnalog To3Point [} 76] Conversion of an analog control signal into a three-point step signal FB_HVACConfigure KL32xx [} 82] Parameterization of the connected sensor type on an input channel from the PLC FB_HVACScale [} 86] Scaling function block FB_HVACScale_n Point [} 87] Simulation of characteristic curves in the PLC FB_HVACScale XX [} 92] Mapping of characteristic curves with 2, 4 or 7 interpolation points. FB_HVACTemperature Curve [} 93] Different temperature characteristic curves that can be mapped are stored inside the FB. FB_HVACTemperature Sensor [} 99] Acquisition of temperature values in 1/10 °C, tailored to the KL320x Bus Terminals FB_HVACTemperature Sensor Ex [} 102] Acquisition of temperature values in 1/10°C, tailored to the KL320x Bus Terminals; without 2nd order filter, but with a smoothing function FB_HVACTemperature Sensor Ex2 [} 105] Acquisition of temperature values in 1/10°C or 1/100°C, tailored to the KL320x Bus Terminals; without 2nd order filter, but with a smoothing function 18 Version: 1.3.0 TF8000
## Page 19

Programming HVAC controller Name Description FB_HVAC2Point Ctrl [} 109] 2-point controller FB_HVACI_Ctrl Step [} 112] I-transfer element for step control in conjunction with FB_HVACPower Range Table FB_HVACI_Ctrl Step Ex [} 119] I-transfer element for step control in conjunction with FB_HVACPower Range Table FB_HVACPIDCtrl [} 127] PID controller FB_HVACPIDCtrl_Ex [} 130] PID controller (extended) FB_HVACPower Range Table [} 135] Power range table for the sequential control of power generators such as boilers or refrigerating machines FB_HVAC2Point Ctrl Sequence [} 149] 2-point sequence controller FB_HVACBasic Sequence Ctrl [} 156] general sequence controller FB_HVACMaster Sequence Ctrl [} 159] Master controller in a VAC system FB_HVACPIDCooling [} 162] PID cooling controller FB_HVACPIDDehumidify [} 165] PID dehumidification controller FB_HVACPIDEnergy Recovery [} 168] PID heat recovery controller FB_HVACPIDHumidify [} 171] PID humidification controller FB_HVACPIDMixed Air [} 175] PID mixed air chamber controller FB_HVACPIDPre Heating [} 178] PID pre-heating controller FB_HVACPIDRe Heating [} 181] PID reheating controller Air conditioning room function Name Description FB_BAREnergy Level [} 184] This function block is for the adaptation of the supply of energy for the use of the building. FB_BARFan Coil [} 186] This function block maps a 3-speed fan with the corresponding switching hysteresis. FB_BARFct Selection [} 189] This function block is for enabling room heating or room cooling. FB_BARSetpoint Room [} 192] This function block assigns a setpoint for cooling operation and another for heating operation to each of the four energy levels. Room function controller Name Description FB_BARPICtrl [} 197] simple PI Controller TF8000 Version: 1.3.0 19
## Page 20

Programming Room functions; lighting Name Description FB_BARAutomatic Light [} 203] Occupancy-controlled automatic light with switch-off delay FB_BARConstant Light Control [} 206] Constant light controller with continuous output of analog values FB_BARDaylight Control [} 212] Daylight control without dimming procedures FB_BARLight Actuator [} 216] Output of a preset proportional dimming value via a ramp function. Output is alternatively in percent, INTEGER or BOOL. This function block likewise encompasses a light scene memory of 21 adjustable dimming values. FB_BARLight Circuit [} 219] Simple light switching circuit without dimming function FB_BARLight Circuit Dim [} 221] Simple light switching circuit with dimming function FB_BARStairwell Automatic [} 224] Stairwell lighting with preliminary warning sequence FB_BARTwilight Automatic [} 227] Twilight switching Sun protection room function Name Description FB_BARBlind Position Entry [} 247] Sun protection function: Input of blind positions. FB_BARDelayed Hysteresis [} 250] External brightness check with delay and hysteresis FB_BARFacade Element Entry [} 251] Shading correction: Input of facade elements per function block. FB_BARRead Facade Element List [} 256] Shading correction: Input of facade elements via data list (csv). FB_BARRead Shading Objects List [} 260] Shading correction: Input of shading objects via data list (csv). FB_BARShading Correction [} 263] / Shading correction function block (FB_Bar Shading Correction South applies to the southern FB_BARShading Correction South [} 266] hemisphere) FB_BARShading Objects Entry [} 269] Shading correction: Input of shading objects per function block. FB_BARSunblind Actuator [} 272] / Blind actuator FB_BARSunblind Actuator Ex [} 278] FB_BARSunblind Event [} 283] Output of a specified blind position and angle in percent FB_BARSunblind Priority Switch [} 285] Priority controller FB_BARRoller Blind [} 286] Roller shutter actuator FB_BARSunblind Scene [} 288] Manual operation with scene selection and programming FB_BARSunblind Switch [} 291] Manual operation FB_BARSunblind Thermo Automatic [} 293] Thermo-automatic function FB_BARSunblind Twilight Automatic [} 300] Automatic twilight function FB_BARSunblind Weather Protection [} 302] Weather protection function FB_BARSun Protection Ex [} 305] Sun protection function, see Overview of automatic sun protection (shading correction) [} 232] FB_BARWithin Range Azimuth [} 308] Verification of valid sun position and sun direction range (azimuth angle) FB_BARWithin Range Elevation [} 310] Verification of valid sun position and sun elevation range (elevation angle) 20 Version: 1.3.0 TF8000
## Page 21

Programming HVAC Setpoint modules Name Description FB_HVACHeating Curve [} 321] Calculation the supply temperature depending on the outside temperature with four base FB_HVACHeating Curve Ex [} 323] Calculation the supply temperature depending on the outside temperature FB_HVACOutside Temp Damped [} 327] Calculation the damped outside temperature FB_HVACSetpoint Heating [} 328] Control an heating circuit with different operating modes FB_HVACSetpoint Ramp [} 330] Moving setpoint ramp FB_HVACSummer Compensation [} 332] summer compensation TF8000 Version: 1.3.0 21
## Page 22

Programming HVAC special functions 22 Version: 1.3.0 TF8000
## Page 23

Programming Name Description FB_HVACAir Conditioning2Speed [} 335] Control of air handling units with two-speed fans FB_HVACAlarm [} 339] Alarm function block FB_HVACAnti Blocking Damper [} 340] Blocking protection for damper drives FB_HVACAnti Blocking Pump [} 342] Blocking protection for pumps FB_HVACBlink [} 345] Flash sequence FB_HVACCmd Ctrl_8 [} 346] With this function block, individual units in a system can be sequentially switched on or off in a certain order. FB_HVACCmd Ctrl_8 can be used as the starting function block of a ventilation system. FB_HVACCmd Ctrl System1Stage [} 354] Single-stage system switch FB_HVACCmd Ctrl System2Stage [} 363] Two-stage system switch FB_HVACConvert Enum [} 376] Converts an Enum into an integer value and vice versa. This conversion is particularly suitable for Enums that are used as VAR_IN_OUT variables on function blocks. FB_HVACEnthalpy [} 377] Determination of the dew point, the specific enthalpy and the absolute humidity. FB_HVACFixed Limit [} 379] Limit switch FB_HVACFreeze Protection Heater [} 381] Frost protection monitoring FB_HVACMux8 [} 59] evaluates the FIFO memory of FB_HVACRedundancy Ctrl Ex FB_HVACMUX_INT_16 [} 388] Function block contains two different types of multiplexer FB_HVACMUX_INT_8 [} 384] Function block contains two different types of multiplexer FB_HVACMUX_REAL_16 [} 396] Function block contains two different types of multiplexer FB_HVACMUX_REAL_8 [} 392] Function block contains two different types of multiplexer FB_HVACOverwrite Analog [} 399] analog override in manual operation FB_HVACOverwrite Digital [} 400] digital override in manual operation FB_HVACPower Measurement KL3403 Acquisition of the measured/calculated values of the three- phase power measurement terminal (KL3403) [} 401] FB_HVACPower Measurement KL3403Ex In comparison with the FB_HVACPower Measurement KL3403, the results are output in LREAL format. The output was [} 403] extended by the frequencies of the three phases. FB_HVACPriority_INT_16 [} 409] This function block can be used to prioritize events or as a multiplexer FB_HVACPriority_INT_8 [} 405] This function block can be used to prioritize events or as a multiplexer FB_HVACPriority_REAL_16 [} 418] This function block can be used to prioritize events or as a multiplexer FB_HVACPriority_REAL_8 [} 413] This function block can be used to prioritize events or as a multiplexer FB_HVACOptimized Off [} 432] Function block for the optimized switch-off (pre-stop) of boilers and air conditioning systems in conjunction with switching time function blocks. FB_HVACOptimized On [} 422] Function block for the optimized switch-on of boilers and air conditioning systems in conjunction with switching time function blocks. FB_HVACTemp Change Function Entry Function block for the input of the interpolation points of the pre- start function [} 442] FB_HVACPWM [} 443] PWM function block FB_HVACStart Air Conditioning [} 446] Start program of an air handling unit FB_HVACSummer Night Cooling [} 450] Summer night cooling TF8000 Version: 1.3.0 23
## Page 24

Programming Name Description FB_HVACSummer Night Cooling Ex [} 453] Summer night cooling FB_HVACTime Con [} 457] Converts a TIME variable into three UDINT variables (udi Sec, udi Min, udi Hour) FB_HVACTime Con Sec [} 457] Converts a TIME variable into a UDINT variable (udi Sec) FB_HVACTime Con Sec Ms [} 458] Converts a TIME variable into two UDINT variables (udi Ms, udi Sec) FB_HVACWork [} 458] Recording of operating hours HVAC Time schedule Name Description FB_HVACScheduler1ch [} 460] Weekly time switch with 1 time switch channel FB_HVACScheduler7ch [} 463] Weekly time switch with 7 time switch channel FB_HVACScheduler7TCHandling [} 466] this FB can be used to select and modify an individual line from the data array of a weekly timer FB_HVACScheduler28ch [} 467] Weekly time switch with 28 time switch channel FB_HVACScheduler28TCHandling [} 471] this FB can be used to select and modify an individual line from the data array of a weekly timer FB_HVACScheduler Special Periods [} 473] Yearly scheduler with day, month and exactly time FB_HVACScheduler Public Holidays [} 471] Yearly scheduler with day and month HVAC system Name Description FB_HVACGet System Time [} 476] Implementation of an internal clock in the Twin CAT PLC FB_HVACNOVRAMData Handling [} 477] Data are written fail-safe to the NOVRAM FB_HVACPersistent Data Handling [} 479] Data are written fail-safe to a file FB_HVACPersistent Data File Copy [} 481] Copying of binary files between local or remote Twin CAT PC and the local Twin CAT PC FB_HVACSet Local Time [} 482] Sets the local Windows system time and the date of a Twin CAT system FB_HVACSystem Task Info [} 484] Determination of system variables of the task HVAC backup function blocks Name Description FB_HVACNOVRAM_XX [} 485] FBs for standard data types FB_HVACPersistent_XX [} 485] FBs for standard data types Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 24 Version: 1.3.0 TF8000
## Page 25

Programming 5.1.2 HVAC Actuators 5.1.2.1 FB_HVAC2Point Actuator This function block serves to control two-point valves or two-point dampers. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b In : BOOL; e Ctrl Mode Actuator : E_HVAC2Point Actuator Mode; b Man Switch : BOOL; b Limit Switch Close : BOOL; b Limit Switch Open : BOOL; b Ctrl Voltage : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the PLC program with the input variable b Enable. The actuator always remains closed as long as the function block is not enabled. Output b Out is permanently FALSE. b In: In automatic mode the actuator is closed by a FALSE and opened by a TRUE. e Ctrl Mode Actuator: Enum that defines the operation mode (see E_HVAC2Point Actuator Mode [} 487]). TF8000 Version: 1.3.0 25
## Page 26

Programming b Man Switch: if the two-point drive has a manual/emergency switch in the control cabinet, this can be connected to the input b Man Switch; the status of the manual/emergency switch will then be monitored. If b Man Switch = FALSE, then output b Out of the drive will be set to FALSE. b Limit Switch Close: Actuator feedback TRUE when the actuator is completely closed. b Limit Switch Open: Actuator feedback TRUE when the actuator is completely open. b Ctrl Voltage: The parameter b Ctrl Voltage serves to check the control voltage. The control voltage is present if the b Ctrl Voltage variable is TRUE. The feedback control is suppressed if the control voltage fails. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b Out : BOOL; by State : BYTE; e State Mode Actuator : E_HVAC2Point Actuator Mode; b Error Limit Switch : BOOL; b Invalid Parameter : BOOL; b Out: The actuator is connected to this output (FALSE = closing drive; TRUE = opening drive). by State: Shows the status of the control of the actuator: by State.0:= Enable by State.1:= Manual Switch by State.2:= Enable Feedback Control by State.3:= Control Voltage by State.4:= Reset by State.5:= b Out e State Mode Actuator: Indicates which operation mode the actuator is in (see E_HVAC2Point Actuator Mode [} 487]). b Error Limit Switch: Goes TRUE if no limit switch is triggered after the preset stroke time. b Error Limit Switch is acknowledged with a positive edge on the input b Reset. b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT b Enable Limit Switch : BOOL; t Stroke Time : TIME; b Enable Limit Switch: If the input is TRUE, then the function control of the drive is activated by means of the limit switch. The variable is saved persistently. t Stroke Time: In order to set the function control correctly, the stroke time of the drive from fully closed to fully opened drive must be entered here (0s..3600s). The variable is saved persistently. Preset to 200 s. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 26 Version: 1.3.0 TF8000
## Page 27

Programming 5.1.2.2 FB_HVAC3Point Actuator This function block serves to control three-point valves or three-point dampers, with or without constant position feedback. The function block is often used in conjunction with the FB_HVACAnalog To3Point [} 76] function block. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b Auto Open : BOOL; b Auto Close : BOOL; e Ctrl Mode Actuator : E_HVAC3Point Actuator Mode; b Man Switch : BOOL; r Feedb : REAL b Ctrl Voltage : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the PLC program with the input variable b Enable. The three-point actuator always remains fully closed as long as the function block is not enabled. Output b Close is permanently TRUE. TF8000 Version: 1.3.0 27
## Page 28

Programming b Auto Open / b Auto Close: In automatic mode the three-point actuator is controlled by the input variables b Auto Close and b Auto Open. e Ctrl Mode Actuator: Enum that defines the operation mode (see E_HVAC3Point Actuator Mode [} 487]). b Man Switch: If the three-point actuator has a manual/emergency switch in the control cabinet, this can be connected to the input b Man Switch; the status of the manual/emergency switch will then be monitored. If b Man Switch = FALSE, then output b Out of the drive will be set to FALSE. r Feedb: Analog position feedback from the actuator (0%..100%). b Ctrl Voltage: Parameter for controlling the control voltage. The control voltage is present if the b Ctrl Voltage variable is TRUE. The feedback control is suppressed if the control voltage fails. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b Open : BOOL; b Close : BOOL; by State : BYTE; e State Mode Actuator : E_HVAC3Point Actuator Mode; b Error Feedb : BOOL; b Invalid Parameter : BOOL; b Open: The signal for the opening drive of the three-point actuator is connected to this output. b Close: The signal for the closing drive of the three-point actuator is connected to this output. by State: Shows the status of the control of the actuator: by State.0:= Enable by State.1:= Manual Switch by State.2:= Enable Feedback Control by State.3:= Control Voltage by State.4:= Reset e State Mode Actuator: Indicates which operation mode the actuator is in (see E_HVAC3Point Actuator Mode [} 487]). b Error Feedb: When setting the output b Close, the position of the drive must have decreased by at least the value of r Hysteresis Feedb within the time t Stroke Time. When setting the output b Open, the position of the drive must have increased by at least the value of r Hysteresis Feedb within the time t Stroke Time. If the actual position is not within the tolerance range within the specified time following a positioning command, this will be indicated by TRUE on the output b Error Feedb. Outputs b Open and b Close both go FALSE. The fault is acknowledged by a positive edge on the input b Reset. b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT b Enable Feedb Ctrl : BOOL; r Min Value Feedb : REAL; r Max Value Feedb : REAL; r Hysteresis Feedb : REAL; t Stroke Time : TIME: b Enable Feedb Ctrl: If the input is TRUE, then the control of the feedback signal is activated. The variable is saved persistently. r Min Value Feedb: Serves to scale the analog position feedback. r Min Value Feedb contains the value of the analog signal when the actuator is fully closed (0%..100%). The variable is saved persistently. Preset to 0. r Max Value Feedb: Serves to scale the analog position feedback. r Max Value Feedb contains the value of the analog signal when the actuator is fully open (0%..100%). The variable is saved persistently. Preset to 0. 28 Version: 1.3.0 TF8000
## Page 29

Programming r Hysteresis Feedb: Due to the stroke time of the drive, the position feedback always lags in the case of a jump in the set position value. Using the variable r Hysteresis Feedb Ctrl, a range is specified within which the set position value of the actuator can deviate from the feedback signal without the feedback control (b Error Feedb) being triggered (0%..100%). The variable is saved persistently. Preset to 10. t Stroke Time: Due to the lagging of the actual position in relation to the set position, the activation of the feedback control in the event of the maximum permissible difference being exceeded is delayed by the variable t Stroke Time [s]. If the actuator is fully closed and receives a setpoint jump of 100 %, at least the stroke time of the drive over its entire range of movement should be entered as a time (0s..3600s). The variable is saved persistently. Preset to 200 s. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.2.3 FB_HVACCirculation Pump This function block serves to control pumps in HVAC systems. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b Auto : BOOL; e Ctrl Mode Actuator : E_HVACActuator Mode; r Outside Temp : REAL; r Valve Position : REAL; b Feedb Pump : BOOL; b Pump Protec : BOOL; b Anti Blocking : BOOL; b Man Switch : BOOL; b Ctrl Voltage : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. TF8000 Version: 1.3.0 29
## Page 30

Programming A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. b Auto: Input for the request from the automatic program. The request is overridden by e Ctrl Mode Actuator. e Ctrl Mode Actuator: Enum that defines the operation mode (see E_HVACActuator Mode [} 488]). r Outside Temp: Input for transmitting the outside temperature value. r Valve Position: If there is a control valve in the hydraulic circuit of the pump, the position of the control valve must be applied here. b Feedb Pump: This input is for displaying the operating message in a visualization system and for monitoring the pump function. b Pump Protec: A pump error message is connected to the input b Pump Protec. There is a pump error if the input b Pump Protec is FALSE. The output b Pump becomes FALSE in the event of a fault. The pump can only be restarted after an acknowledgment on the input b Reset. b Anti Blocking: Input for transferring the anti-blocking request, i.e. if TRUE the request is active. b Man Switch: If the pump has a manual/emergency switch in the control cabinet, this can be connected to the input b Man Switch; the status of the manual/emergency switch will then be monitored. The output b Pump is disabled if b Man Switch= FALSE. The output b Pump can only be switched on if b Man Switch = TRUE (quiescent current principle). b Ctrl Voltage: In order to suppress a torrent of messages, the error message from b Pump Protec is only acquired if the input b Ctrl Voltage is TRUE. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b Pump : BOOL; by State : BYTE; b State Man Switch : BOOL; b Req Outside Temp : BOOL; b Req Valve : BOOL; e State Mode Actuator : E_HVACActuator Mode; b Error Pump Protec : BOOL; b Error Pump Feedb : BOOL; b Error General : BOOL; by Error : BYTE; b Invalid Parameter : BOOL; b Pump: Output variable for controlling a pump. by State: Output of the pump status as a byte. by State.0 := b Enable by State.1 := b Pump by State.2 := b Req Outside Temp by State.3 := b Req Valve by State.4 := b Antiblocking 30 Version: 1.3.0 TF8000
## Page 31

Programming by State.5 := b Feedb Pump by State.6 := NOT b Man Switch by State.7 := b Ctrl Voltage b State Man Switch: Indicates the state of the manual/emergency switch. A TRUE signals that the manual/ emergency operating level is activated. b Req Outside Temp: If the condition for requesting the pump depending on the outside temperature is TRUE, the output variable b Req Outside Temp is TRUE. b Req Valve: If the condition for requesting the pump depending on the valve position is reached, the variable b Req Valve is TRUE. e State Mode Actuator: Indicates which operation mode the actuator is in (see E_HVACActuator Mode [} 488]). b Error Pump Protec: Pump error. b Error Pump Feedb: If the input b Feedb Pump does not go TRUE within the time of t Feedb Pump Delay (t Feedb Pump Delay must be > t#0s) after setting the output b Pump, this is recognized as a fault and this output is set to TRUE and the output b Pump to FALSE. The error message must be acknowledged with b Reset. b Error General: There is a general error. by Error: Output of the error as a byte. by Error.1 := b Invalid Parameter by Error.2 := b Error General by Error.3 := b Error Pump Protec by Error.4 := b Error Pump Feedb b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT t Stop Delay : TIME; t Feedb Pump Delay : TIME; r Outside Temp Limit : REAL; r Valve Position Limit : REAL; e Req Outside Temp : E_HVACReq Outside Temp; e Req Valve : E_HVACReq Valve; t Stop Delay: The time t Stop Delay [s] delays the switching off of the pump after the switch-on conditions are no longer given. The variable is saved persistently. Preset to 0 s. t Feedb Pump Delay: The monitoring function of the pump feedback message [s] is only active if t Feedb Pump Delay is > t#0s. If t Feedb Pump Delay = t#0s the monitoring function is deactivated (0s..3600s). The variable is saved persistently. Preset to 0 s. r Outside Temp Limit: Value [°C] above or below which the pump is switched on or off depending on the outside temperature (-60°C..60°C). The variable is saved persistently. Preset to 10 °C. r Valve Position Limit: Threshold value for the position of a control valve associated with a pump, from which the pump should switch on automatically, e.g. heater pump (0%..100%). The variable is saved persistently. Preset to 3%. e Req Outside Temp: Depending on the outside temperature, the pump can be compulsorily switched on, e.g. for frost protection purposes when the temperature limit value r Outside Temp Limit is undershot. The prerequisite is that b Enable = TRUE and that the pump is in automatic mode (see E_HVACReg Outside Temp [} 491]). The variable is saved persistently. NOTICE Manual off overrides the frost protection function! TF8000 Version: 1.3.0 31
## Page 32

Programming e Req Valve: Depending on the position of the valve associated with the pump, the pump can be switched on when the threshold value of r Valve Position Limit is exceeded. The ENUM activates the switch-on via the valve position. In addition, the ENUM determines whether the temperature-dependent and valve position- dependent switch-on conditions are ORed or ANDed together (see E_HVACReg Valve [} 492]). The variable is saved persistently. The table below shows a summary of all possible combinations: e Req Outside Temp e Req Valve Function Application OTLower Limit No Request outsidetemp lower limit OTLower Limit Or Valve Pos Higher Limit outsidetemp OR valve Heating circuit, air heater higher limit OTLower Limit And Valve Pos Higher Limit outsidetemp AND valve higher limit OTHigher Limit No Request outsidetemp higher limit OTHigher Limit Or Valve Pos Higher Limit outsidetemp OR valve higher limit OTHigher Limit And Valve Pos Higher Limit outsidetemp AND valve Cooler pump higher limit No Request No Request no request Primary pump No Request Or Valve Pos Higher Limit valve higher limit No Request And Valve Pos Higher Limit not valid By means of various combinations of the two variables, e Req Outside Temp and e Req Valve, this function block can be adapted to the requirements of a heating circuit, an air heater, an air cooler or a feed pump. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.2.4 FB_HVACCirculation Pump Ex This function block serves to control pumps in HVAC systems. 32 Version: 1.3.0 TF8000
## Page 33

Programming The following switch-on conditions must first be fulfilled in order to control the pump via b Pump: b Enable = TRUE AND b Error Pump Protec = FALSE AND b Man Switch = TRUE AND b Ctrl Voltage = TRUE If one of the switch-on conditions is not fulfilled, then the output b Pump is constantly FALSE. On the basis of the following diagrams it can be seen how the output b Pump is controlled depending on the Enum e Req Pump, the input b External, the outside temperature r Out Side Temp and the valve position r Valve Position. The switch-on conditions mentioned above must be fulfilled for this, and one of the two operation modes e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP must be preselected. TF8000 Version: 1.3.0 33
## Page 34

Programming 34 Version: 1.3.0 TF8000
## Page 35

Programming TF8000 Version: 1.3.0 35
## Page 36

Programming e HVACReq Pump_No: There is no request on the part of the Enum to control the pump (see E_HVACReq Pump [} 491]). e HVACReq Pump_OT_LL: The outside temperature (OT = r Outside Temp) must be lower than r Outside Temp Low Limit (LL = Lower Limit) (see E_HVACReq Pump [} 491]). 36 Version: 1.3.0 TF8000
## Page 37

Programming e HVACReq Pump_OT_HL: The outside temperature (OT = r Outside Temp) must be higher than r Outside Temp High Limit (HL = Higher Limit) (see E_HVACReq Pump [} 491]). e HVACReq Pump_VP: The valve position (VP = r Valve Position) must be larger than r Valve Position Limit On (see E_HVACReq Pump [} 491]). e HVACReq Pump_OT_LL_OR_VP: The outside temperature (OT = r Outside Temp) must be lower than r Outside Temp Low Limit (LL = Lower Limit) OR the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On (see E_HVACReq Pump [} 491]). e HVACReq Pump_OT_HL_OR_VP: The outside temperature (OT = r Outside Temp) must be higher than r Outside Temp High Limit (HL = Higher Limit) OR the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On (see E_HVACReq Pump [} 491]). e HVACReq Pump_OT_LL_AND_VP: The outside temperature (OT = r Outside Temp) must be lower than r Outside Temp Low Limit (LL = Lower Limit) AND the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On (see E_HVACReq Pump [} 491]). e HVACReq Pump_OT_HL_AND_VP: The outside temperature (OT = r Outside Temp) must be higher than r Outside Temp High Limit (HL = Higher Limit) AND the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On (see E_HVACReq Pump [} 491]). The output b Pump switches itself off, after the switch-on conditions are no longer fulfilled, depending on the Enum e Req Pump, the input b External, the outside temperature r Out Side Temp or the valve position r Valve Position, with a delay set by the time udi Sec Stop Delay. b Error goes TRUE if b Error Pump Protec is TRUE. However, only the fault b Error Pump Protec leads to the deactivation of the output b Pump. If the error message b Error Feedb is also to lead to the switch-off of the pump, then the variable must be ANDed with the output b Pump after calling the function block. The error message b Error Feedb is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP and only if the time udi Sec Feedb Pump Delay is greater than 0. TF8000 Version: 1.3.0 37
## Page 38

Programming Example for Anti Blocking function VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b External : BOOL; e Ctrl Mode Actuator : E_HVACActuator Mode; r Outside Temp : REAL; r Valve Position : REAL; b Feedb Pump : BOOL; b Pump Protec : BOOL; b Man Switch : BOOL; b Ctrl Voltage : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip 38 Version: 1.3.0 TF8000
## Page 39

Programming If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If b Enable = FALSE, then the output b Pump is constantly FALSE. b External: The output b Pump can be switched on or off directly via the input b External. The following conditions must be fulfilled for this: b Enable = TRUE AND b Error Pump Protec = FALSE AND b Man Switch = TRUE AND b Ctrl Voltage = TRUE AND e Ctrl Mode Actuator = e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP AND e Req Pump=e HVACRequest Pump_No Request. Otherwise, b External controls the output b Pump depending on b Req Outside Temp and b Req Valve, see diagrams above. b External is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP. e Ctrl Mode Actuator: Enum that specifies the operation mode. The following operation modes are supported by the function block FB_HVACCirculation Pump Ex: e HVACActuator Mode_Auto_BMS, e HVACActuator Mode_Auto_OP, e HVACActuator Mode_Speed1_BMS, e HVACActuator Mode_Speed1_OP, e HVACActuator Mode_Off_BMS, e HVACActuator Mode_Off_OP. The two operation modes e HVACActuator Mode_Auto_BMS and e HVACActuator Mode_Auto_OP mean that the function block is in automatic mode. The output b Pump can be switched on directly via the two operation modes e HVACActuator Mode_Speed1_BMS and e HVACActuator Mode_Speed1_OP, provided the following conditions are fulfilled: b Enable = TRUE AND b Error Pump Protec = FALSE AND b Man Switch = TRUE AND b Ctrl Voltage = TRUE The operation modes e HVACActuator Mode_Off_BMS and e HVACActuator Mode_Off_OP switch the output b Pump to the FALSE state. If an incorrect variable value is present on e Ctrl Mode Actuator, the last valid variable value is taken. The state of the enum e Ctrl Mode Actuator is output via e State Mode Actuator (see E_HVACActuator Mode [} 488]). r Outside Temp: Input for transmitting the outside temperature value. Depending on the outside temperature, the pump can be switched on if the temperature falls below the limit value r Outside Temp Low Limit or exceeds the limit value r Outside Temp High Limit. This depends on the enum e Req Pump [} 491] for requesting the pump, see diagrams above. r Outside Temp is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP. r Valve Position: Input for transmitting the valve position of the control loop. Depending on the position r Valve Position of the valve associated with the pump, the pump can be switched on when the threshold value r Valve Position Limit On is exceeded. This depends on the enum e Req Pump for requesting the pump, see diagrams above. r Valve Position is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP. b Feedb Pump: Feedback from the pump or a relay contact that the pump is switched on. If the output b Pump = TRUE, then the input b Feedb Pump must be TRUE within the time specification udi Sec Feedb Pump Delay and must remain so until b Pump = FALSE. This error is otherwise indicated via the output variable b Error Feedb. After the rectification of the fault it must be acknowledged at the input b Reset. The error message b Error Feedb has no effect on the control of the output b Pump. b Feedb Pump is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP and only if the time udi Sec Feedb Pump Delay is greater than 0. If no pump status feedback is present, but the functions are nevertheless realized, then a TRUE may not be applied constantly to the input b Feedb Pump. This would lead in the switched-off state to an error: b Error Feedb = TRUE. In this case the output b Pump should be applied to the input b Feedb Pump. TF8000 Version: 1.3.0 39
## Page 40

Programming b Pump Protec: The motor protection switch for the pump is connected to the input b Pump Protec. A pump error has occurred if the input b Pump Protec is FALSE. If there is an error the output b Pump goes FALSE and the error is displayed by means of the variable b Error Pump Protec. The output b Pump can only be switched on if b Pump Protec = TRUE (quiescent current principle). After the rectification of the fault it must be acknowledged at the input b Reset. b Man Switch: If the pump has a manual / emergency switch, this can be connected to the input b Man Switch. The state of the manual / emergency switch is monitored. The output b Pump is disabled if b Man Switch= FALSE. The output b Pump can only be switched on if b Man Switch = TRUE (quiescent current principle). The state of b Man Switch is indicated by the output variable b State Man Switch. b Ctrl Voltage: The control voltage monitoring is applied to the input b Ctrl Voltage. If b Ctrl Voltage = FALSE, then the output b Pump is constantly FALSE. In order to suppress error message torrents, the error messages b Pump Protec, b Error Feedb and b Error are registered only if the input b Ctrl Voltage is TRUE. b Reset: Acknowledgment input in the case of a fault following its rectification. VAR_OUTPUT b Pump : BOOL; by State : BYTE; b Req External : BOOL; b Req Outside Temp : BOOL; b Req Valve : BOOL; b State Man Switch : BOOL; udi Sec RT_Stop Delay : UDINT; udi Sec RT_Feedb Pump Delay : UDINT; e State Mode Actuator : E_HVACActuator Mode; b Error : BOOL; by Error : BYTE; b Error Pump Protec : BOOL; b Error Feedb : BOOL; b Invalid Parameter : BOOL; b Pump: Output variable for controlling a pump. The following conditions must first be fulfilled in order to control the pump via b Pump: b Enable = TRUE AND b Error Pump Protec = FALSE AND b Man Switch = TRUE AND b Ctrl Voltage = TRUE. If these conditions are satisfied the pump can be switched on directly via the operation mode e Ctrl Mode Actuator or via different possibilities in automatic mode, see diagram above. The output b Pump switches itself off, after the switch-on conditions are no longer fulfilled, depending on the Enum E_HVACReq Pump [} 491], the input b External, the outside temperature r Out Side Temp or the valve position r Valve Position, with a delay set by the time udi Sec Stop Delay. by State: Pump status output by State.0 := b Enable; by State.1 := b Pump; by State.2 := b Req External; by State.3 := b Req Outside Temp; by State.4 := b Req Valve; by State.5 := b Feedb Pump; by State.6 := NOT b Man Switch; by State.7 := b Ctrl Voltage; b Req External: If the condition b External = TRUE is fulfilled for switching on the pump via b Pump, then the output variable b Req External goes TRUE. All switch-on conditions and the use of the output b Req External to control b Pump are described in the diagrams above. b Req Outside Temp: If the condition is achieved for requesting the pump via b Pump depending on the outside temperature r Outside Temp, then the output variable b Req Outside Temp goes TRUE. All switch-on conditions and the use of the output b Req Outside Temp to control b Pump are described in thediagrams above. b Req Valve: If the condition is achieved for requesting the pump via b Pump depending on the valve position r Valve Position, the output variable b Req Valve goes TRUE. All switch-on conditions and the use of the output b Req Valve to control b Pump are described in the diagrams above. b State Man Switch: Indicates the state of the manual/emergency switch. A TRUE signals that the manual/ emergency operating level is activated. b State Man Switch = NOT b Man Switch. 40 Version: 1.3.0 TF8000
## Page 41

Programming udi Sec RT_Stop Delay: If the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP is selected, then the output b Pump is switched off after the switch-on conditions are no longer satisfied, depending on the enum E_HVACReq Pump [} 491], the input b External, the outside temperature r Out Side Temp or the valve position r Valve Position, delayed by the time set by udi Sec RT_Stop Delay. The output is given in seconds. udi Sec RT_Feedb Pump Delay: If the output b Pump = TRUE, then the input b Feedb Pump must be TRUE within the time udi Sec RT_Feedb Pump Delay and must remain so until b Pump = FALSE. This error is otherwise indicated via the output variable b Error Feedb. udi Sec RT_Feedb Pump Delay is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP and only if the time udi Sec Feedb Pump Delay is greater than 0. The output is given in seconds. e State Mode Actuator: Indicates the operation mode of the function block. e State Mode Actuator is equivalent to e Ctrl Mode Actuator (see E_HVACActuator Mode [} 488]). b Error: b Error goes TRUE if b Error Pump Protec is TRUE. However, only the error b Error Pump Protec leads to the deactivation of the output b Pump. If the error message b Error Feedb is also to lead to the switch-off of the pump, then the variable must be ANDed with the output b Pump after calling the function block. by Error: Output of the error as a byte. by Error.1 := b Invalid Parameter by Error.2 := b Error by Error.3 := b Error Pump Protec by Error.4 := b Error Feedb b Error Pump Protec: The motor protection switch for the pump is connected to the input b Pump Protec. There is a pump error if the input b Pump Protec is FALSE. If there is an error the output b Pump goes FALSE and the error is displayed by means of the variable b Error Pump Protec. The output b Pump can only be switched on if b Pump Protec = TRUE (quiescent current principle). After the rectification of the fault it must be acknowledged at the input b Reset. b Error Feedb: If the output b Pump = TRUE, then the input b Feedb Pump must be TRUE within the time specification udi Sec Feedb Pump Delay and must remain so until b Pump = FALSE. This error is otherwise indicated via the output variable b Error Feedb. After the rectification of the fault it must be acknowledged at the input b Reset. The error message b Error Feedb has no effect on the control of the output b Pump. b Error Feedb is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP and only if the time udi Sec Feedb Pump Delay is greater than 0. b Invalid Parameter: Goes TRUE if an error occurs during the plausibility check of the following variables: r Outside Temp High Limit, r Outside Temp Low Limit, r Valve Position Limit On, r Valve Position Limit Off The message must be acknowledged with b Reset. VAR_IN_OUT udi Sec Stop Delay : UDINT; udi Sec Feedb Pump Delay : UDINT; r Outside Temp High Limit : REAL; r Outside Temp Low Limit : REAL; r Valve Position Limit On : REAL; r Valve Position Limit Off : REAL; e Req Pump : E_HVACReq Pump; udi Sec Stop Delay: The time delay udi Sec Stop Delay [s] delays the switching off of the pump after the switch- on conditions are no longer fulfilled. It is input in seconds (0s..4294967s). If the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP is selected, then the output b Pump is switched off after the switch-on conditions are no longer satisfied, depending on the enum e Req Pump, the input b External, the outside temperature r Out Side Temp or the valve position r Valve Position, delayed by the time set by udi Sec Stop Delay. The data is given in seconds. The variable is saved persistently. Preset to 0. udi Sec Feedb Pump Delay: If the output b Pump = TRUE, then the input b Feedb Pump must be TRUE within the time delay udi Sec Feedb Pump Delay and must remain so until b Pump = FALSE. Otherwise this error is indicated via the output variable b Error Feedb (0s..4294967s). udi Sec Feedb Pump Delay is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP and only if the time udi Sec Feedb Pump Delay is greater than 0. The input is given in seconds. The variable is saved persistently. Preset to 0. TF8000 Version: 1.3.0 41
## Page 42

Programming r Outside Temp High Limit: Value above which the pump is switched on or off depending on the outside temperature r Outside Temp and the enum e Req Pump, see diagrams above (-60°C..60°C). r Outside Temp High Limit is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP. If an incorrect variable value is present on r Outside Temp High Limit, the last valid variable value is taken. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 4. r Outside Temp Low Limit: Value below which the pump is switched on or off depending on the outside temperature r Outside Temp and the enum e Req Pump, see diagrams above (-60°C..60°C). r Outside Temp Low Limit is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP. If an incorrect variable value is present on r Outside Temp Low Limit, the last valid variable value is taken. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 1. r Valve Position Limit On: Threshold value for the position r Valve Position of a control valve associated with a pump, above which the pump should switch on automatically, e.g. heater pump, see diagrams above (0%..100%). r Valve Position Limit On is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP. r Valve Position Limit On may not be smaller than r Valve Position Limit Off. Otherwise the last valid variable value is taken and b Invalid Parameter is set. If an incorrect variable value is present on r Valve Position Limit, the last valid variable value is taken. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 5. r Valve Position Limit Off: Threshold value for the position r Valve Position of a control valve associated with a pump, below which the pump should switch off automatically, e.g. heater pump, see diagrams above (0%..100%). r Valve Position Limit Off is active only in the operation mode e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP. r Valve Position Limit Off may not be larger than r Valve Position Limit On. Otherwise the last valid variable value is taken and b Invalid Parameter is set. If an incorrect variable value is present on r Valve Position Limit, the last valid variable value is taken. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 1. e Req Pump: Using the Enum E_HVACReq Pump [} 491], switch-on conditions or combinations of switch-on conditions can be set for switching on the pump. The switch-on conditions are as follows: - depending on the outside temperature, the pump can be switched on if the temperature falls below the limit value r Outside Temp Low Limit or exceeds the limit value r Outside Temp High Limit. - depending on the position r Valve Position of the valve associated with the pump, the pump can be switched on when the threshold value r Valve Position Limit On is exceeded. In addition, the Enum combinations can be used to specify whether the temperature-dependent and valve- position-dependent switch-on conditions are ORed or ANDed together. The following switch-on conditions or combinations of switch-on condition can be set via the Enum in order to control the output b Pump: e HVACReq Pump_No: There is no request on the part of the Enum to control the pump e HVACReq Pump_OT_LL: The outside temperature (OT = r Outside Temp) must be smaller than r Outside Temp Low Limit (LL = Lower Limit) e HVACReq Pump_OT_HL: The outside temperature (OT = r Outside Temp) must be larger than r Outside Temp High Limit (HL = Higher Limit) e HVACReq Pump_VP: The valve position (VP = r Valve Position) must be larger than r Valve Position Limit On 42 Version: 1.3.0 TF8000
## Page 43

Programming e HVACReq Pump_OT_LL_OR_VP: The outside temperature (OT = r Outside Temp) must be smaller than r Outside Temp Low Limit (LL = Lower Limit) OR The valve position (VP = r Valve Position) must be larger than r Valve Position Limit On e HVACReq Pump_OT_HL_OR_VP: The outside temperature (OT = r Outside Temp) must be larger than r Outside Temp High Limit (HL = Higher Limit) OR the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On e HVACReq Pump_OT_LL_AND_VP: The outside temperature (OT = r Outside Temp) must be smaller than r Outside Temp Low Limit (LL = Lower Limit) AND The valve position (VP = r Valve Position) must be larger than r Valve Position Limit On e HVACReq Pump_OT_HL_AND_VP: The outside temperature (OT = r Outside Temp) must be larger than r Outside Temp High Limit (HL = Higher Limit) AND the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On Prerequisites for the use of the enum e Req Pump are that b Enable = TRUE AND b Error Pump Protec = FALSE AND b Man Switch = TRUE AND b Ctrl Voltage = TRUE AND e Ctrl Mode Actuator = e HVACActuator Mode_Auto_BMS OR e HVACActuator Mode_Auto_OP. If an incorrect variable value is present on e Req Pump, the last valid variable value is taken. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.2.5 FB_HVACMotor1Speed This function block serves to control a single-stage drive in HVAC systems. It is suitable for fans. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; TF8000 Version: 1.3.0 43
## Page 44

Programming b Auto : BOOL; e Ctrl Mode Actuator : E_HVACActuator Mode; b Motor Protec : BOOL; b Feedb Contactor : BOOL; b Feedb Process : BOOL; b Repair Switch : BOOL; b Man Switch : BOOL; b Ctrl Voltage : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If b Enable = FALSE, the drive will be switched off via the specified time variable t Stop Delay. b Auto: b Auto is then only active if the operation mode e Ctrl Mode Actuator is set either to e HVACActuator Mode_Auto_BMS or to e HVACActuator Mode_Auto_OP. If the input variable b Auto = TRUE, the function block will be instructed that the drive is to run. If b Auto = FALSE, the drive will be switched off with a delay via the specified time variable t Stop Delay. e Ctrl Mode Actuator: Enum that specifies the operation mode of the motor (see E_HVACActuator Mode [} 488]). If specified incorrectly, operation continues internally with the last valid operation mode. This is e HVACActuator Mode_Auto_BMS in the case of initial commissioning. b Invalid Parameter is set in the case of an incorrect parameter specification. b Motor Protec: Input for the motor protection switch. There is a motor protection switch error if the input b Motor Protec = FALSE (quiescent current principle). In the event of a fault, the output b Motor = FALSE; the fault is indicated at the output of the function block by b Error Motorprotec. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. b Feedb Contactor: Feedback for the power section of the motor. The operating feedback is present if the input b Feedb Contactor = TRUE. If, after switching on the motor, this feedback is not present after the time delay set by t Delay Feedb Contactor, the output b Error Feedb Contactor is set in order to indicate the fault. The output b Motor becomes FALSE in the event of a fault. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. If no feedback from the power section of the motor is present, the output variable b Motor must be applied to the input b Feedb Contactor. If no feedback from the power section of the motor is present, the output variable b Motor must be applied to the input b Feedb Contactor. b Feedb Process: A process feedback signal, for example from a v-belt monitor or a flow monitor can be connected to the input b Feedb Process. The process feedback is present if the input b Feedb Process = TRUE (quiescent current principle). If, in the start-up phase after switching on the motor, the process feedback is not present after the time set by t Feedb Process Timer, the drive switches off and indicates a fault at the 44 Version: 1.3.0 TF8000
## Page 45

Programming output b Error Feedb Process. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. In order to avoid undesired switching off of the drive during operation due to the process monitoring, e.g. in the event of short-term pressure fluctuations, the triggering of the input b Feedb Process can be delayed by the time t Delay Feedb Process. b Repair Switch: The state of the repair switch is monitored with the input b Repair Switch. The motor can only be switched on if b Repair Switch= TRUE (quiescent current principle). If the repair switch is switched off, b Repair Switch = FALSE and the output b Motor becomes FALSE. b Man Switch: The state of the manual/emergency switch is monitored with the input b Man Switch. The motor can only be switched on if b Man Switch = TRUE (quiescent current principle). If the manual/emergency switch is switched off, b Man Switch = FALSE and the output b Motor becomes FALSE. b Ctrl Voltage: The state of the control voltage is monitored with the input b Ctrl Voltage. The motor can only be switched on if b Ctrl Voltage = TRUE (quiescent current principle). If the control voltage is switched off, b Ctrl Voltage = FALSE and the output b Motor becomes FALSE. In order to avoid a torrent of error messages if the control voltage fails, the error messages of the function block are suppressed. If the control voltage is restored, the error messages are enabled again. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b Motor : BOOL; by State : BYTE; b State Auto : BOOL; b State Repair Switch : BOOL; b State Man Switch : BOOL; e State Mode Actuator : E_HVACActuator Mode; b Error General : BOOL; by Error : BYTE; b Error Motorprotec : BOOL; b Error Feedb Contactor : BOOL; b Error Feedb Process : BOOL; b Invalid Parameter : BOOL; b Motor: Output variable for controlling a single-speed motor. by State: Status byte indicating the operating state of the function block. by State.0 := b Enable; by State.1 := b Motor; by State.2 := b State Auto; by State.5 := b State Repair Switch; by State.6 := b State Man Switch; by State.7 := b Ctrl Voltage; b State Auto: Indicates the state for automatic preselection if the operation mode e Ctrl Mode Actuator [} 488] is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP and stage 1 was activated via the input variable b Auto. b State Repair Switch: Indicates the state of the repair switch. TRUE indicates that the repair switch is switched off. b State Man Switch: Indicates the state of the manual/emergency switch. A TRUE signals that the manual/ emergency operating level is activated. e State Mode Actuator: Enum via which the state of the operation mode of the motor is fed back to the controller (see E_HVACActuator Mode [} 488]). b Error General: The error message b Error General becomes TRUE as soon as one of the error messages b Error Motorprotec, b Error Feedb Contactor or b Error Feedb Process = TRUE. The output b Motor is then set to FALSE and is only enabled again when the fault has been rectified and acknowledged via b Reset. by Error: Delivers all error messages and warnings from the function block. by Error.1 := b Invalid Parameter; by Error.2 := b Error General; by Error.3 := b Error Motorprotec; by Error.4 := b Error Feedb Contactor; by Error.5 := b Error Feedb Process; TF8000 Version: 1.3.0 45
## Page 46

Programming b Error Motorprotec: Motor protection switch error, see input variable b Motor Protec. b Error Feedb Contactor: Power section feedback error, see input variable b Feedb Contactor. If no feedback from the power section of the motor is present, the output variable b Motor must be applied to the input b Feedb Contactor. b Error Feedb Process: Process feedback error, see input variable b Feedback Process. b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables e Ctrl Mode Actuator, t Start Delay, t Stop Delay, t Delay Feedb Contactor, t Feedb Process Timer or t Delay Feedb Process. An incorrect parameter specification does not lead to a standstill of the function block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. VAR_IN_OUT t Start Delay : TIME; t Stop Delay : TIME; t Delay Feedb Contactor : TIME; t Feedb Process Timer : TIME; t Delay Feedb Process : TIME; t Start Delay: The start-up of the motor after enabling and switching on via the operation mode of the motor is delayed by the time t Start Delay [s] (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Stop Delay: The switching off of the motor via the operation mode of the motor is delayed by the time t Stop Delay [s] (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Feedb Contactor: Time delay [ms] of the feedback of the power section after switching on the motor. If this time has elapsed and b Feedb Contactor = FALSE, then this is fed back to the controller via the error message b Error Feedb Contactor (100ms..3600ms). The variable is saved persistently. Preset to 100 ms. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Feedb Process Timer: Time delay of the process feedback b Feedb Process [s] after switching on the motor. If this time has elapsed and b Feedb Process = FALSE, then this is fed back to the controller via the error message b Error Feedb Process (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Feedb Process: In order to avoid undesired switching off of the drive during operation due to the process monitoring b Feedb Process, e.g. in the event of short-term pressure fluctuations, the response of the input b Feedb Process can be delayed by the time t Delay Feedb Process [s] (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 46 Version: 1.3.0 TF8000
## Page 47

Programming 5.1.2.6 FB_HVACMotor2Speed This function block serves to control a two-stage drive in HVAC systems. The function block always runs in stage 1, the lower power stage. It cannot be switched on directly in stage 2. In the event of a restart, disablement, an error or switching off of the motor via the operation mode, restart of the motor is blocked for the duration of t Delay Speed2to Speed1. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b Auto Speed1 : BOOL; b Auto Speed2 : BOOL; e Ctrl Mode Actuator : E_HVACActuator Mode; b Motor Protec Speed1 : BOOL; b Motor Protec Speed2 : BOOL; b Feedb Contactor Speed1 : BOOL; b Feedb Contactor Speed2 : BOOL; b Feedb Process : BOOL; b Repair Switch : BOOL; b Man Switch : BOOL; b Ctrl Voltage : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip TF8000 Version: 1.3.0 47
## Page 48

Programming If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If b Enable = FALSE, the drive will be switched off in the respective switch-on stage with a delay via the specified time variable t Stop Delay. If an enable is present, a restart of the motor is blocked for the duration of t Delay Speed2to Speed1. b Auto Speed1: b Auto Speed1 is then only active if the operation mode e Ctrl Mode Actuator is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP. If the input variable b Auto Speed1 = TRUE and the input variable b Auto Speed2 = FALSE, the function block is instructed that the drive should run at speed 1. If b Auto Speed1 = FALSE, the drive will be switched off with a delay via the specified time variable t Stop Delay. b Auto Speed2: b Auto Speed2 is then only active if the operation mode e Ctrl Mode Actuator is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP. If the input variables b Auto Speed1 and b Auto Speed2 are both TRUE, the function block is instructed that the drive should run at speed 2. If b Auto Speed1 and b Auto Speed2 are both FALSE, the drive will be switched off with a delay via the specified time variable t Stop Delay. e Ctrl Mode Actuator: Enum that specifies the operation mode of the motor (see E_HVACActuator Mode [} 488]). If specified incorrectly, operation continues internally with the last valid operation mode. This is e HVACActuator Mode_Auto_BMS in the case of initial commissioning. b Invalid Parameter is set in the case of an incorrect parameter specification. b Motor Protec Speed1: Input for the motor protection speed 1. There is a motor protection error if the input b Motor Protec Speed1 = FALSE (quiescent current principle). In the event of a fault, the outputs b Motor Speed1 and b Motor Speed2 are both FALSE; the error is indicated at the output of the function block by b Error Motorprotec Speed1. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. b Motor Protec Speed2: Input for the motor protection speed 2. There is a motor protection error if the input b Motor Protec Speed2 = FALSE (quiescent current principle). In the event of a fault, the outputs b Motor Speed1 and b Motor Speed2 are both FALSE; the fault is indicated at the output of the function block by b Error Motorprotec Speed2. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. b Feedb Contactor Speed1: Feedback from the power section of the motor for speed 1. The operating feedback is present if the input b Feedb Contactor Speed1 = TRUE. If, after switching on the motor, this feedback is not present after the time delay set by t Delay Feedb Contactor Speed1, the output b Error Feedb Contactor Speed1 is set in order to indicate a fault. In the event of a fault, the outputs b Motor Speed1 and b Motor Speed2 are both FALSE. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. If no feedback from the power section of the motor is present for speed 1, the output variable b Motor Speed1 must be applied to the input b Feedb Contactor Speed1. If no feedback from the power section of the motor is present, the output variable b Motor Speed1 must be applied to the input b Feedb Contactor Speed1. b Feedb Contactor Speed2: Feedback from the power section of the motor for speed 2. The operating feedback is present if the input b Feedb Contactor Speed2 = TRUE. If, after switching on the motor, this feedback is not present after the time delay set by t Delay Feedb Contactor Speed2, the output b Error Feedb Contactor Speed2 is set in order to indicate a fault. In the event of a fault, the outputs b Motor Speed1 and b Motor Speed2 are both FALSE. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. If no feedback from the power section of the motor is present for speed 2, the output variable b Motor Speed2 must be applied to the input b Feedb Contactor Speed2. 48 Version: 1.3.0 TF8000
## Page 49

Programming If no feedback from the power section of the motor is present, the output variable b Motor Speed2 must be applied to the input b Feedb Contactor Speed2. b Feedb Process: A process feedback signal, for example from a v-belt monitor or a flow monitor can be connected to the input b Feedb Process. The process feedback is present if the input b Feedb Process = TRUE (quiescent current principle). If, in the start-up phase after switching on the motor, the process feedback is not present after the time set by t Feedb Process Timer, the drive switches off and indicates a fault at the output b Error Feedb Process. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. In order to avoid undesired switching off of the drive during operation due to the process monitoring, e.g. in the event of short-term pressure fluctuations, the triggering of the input b Feedb Process can be delayed by the time t Delay Feedb Process. The process feedback is active if either b Motor Speed1 or b Motor Speed2 = TRUE. b Repair Switch: The state of the repair switch is monitored with the input b Repair Switch. The motor can only be switched on if b Repair Switch = TRUE (quiescent current principle). If the repair switch is switched off, b Repair Switch = FALSE and the outputs b Motor Speed1 and b Motor Speed2 are both FALSE. If the state of the repair switch is TRUE, a restart of the motor is blocked for the duration of t Delay Speed2to Speed1. b Man Switch: The state of the manual/emergency switch is monitored with the input b Man Switch. The motor can only be switched on if b Man Switch = TRUE (quiescent current principle). If the manual/emergency switch is switched off, b Man Switch= FALSE and the outputs b Motor Speed1 and b Motor Speed2 are both FALSE. If the state of the manual/emergency switch is TRUE, a restart of the motor is blocked for the duration of t Delay Speed2to Speed1. b Ctrl Voltage: The state of the control voltage is monitored with the input b Ctrl Voltage. The motor can only be switched on if b Ctrl Voltage = TRUE (quiescent current principle). If the control voltage is switched off, b Ctrl Voltage= FALSE and the outputs b Motor Speed1 and b Motor Speed2 are both FALSE. In order to avoid a torrent of error messages if the control voltage fails, the error messages of the function block are suppressed. If the control voltage is restored, the error messages are enabled again. If control voltage is present, a restart of the motor is blocked for the duration of t Delay Speed2to Speed1. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b Motor Speed1 : BOOL; b Motor Speed2 : BOOL; by State : BYTE; b State Auto Speed1 : BOOL; b State Auto Speed2 : BOOL; b State Repair Switch : BOOL; b State Man Switch : BOOL; e State Mode Actuator : E_HVACActuator Mode; b Error General : BOOL; by Error : BYTE; b Error Motorprotec Speed1 : BOOL; b Error Motorprotec Speed2 : BOOL; b Error Feedb Contactor Speed1 : BOOL; b Error Feedb Contactor Speed2 : BOOL; b Error Feedb Process : BOOL; b Invalid Parameter : BOOL; b Motor Speed1: Output variable for controlling speed 1 of the two-speed drive. b Motor Speed2: Output variable for controlling speed 2 of the two-speed drive. by State: Status byte indicating the operating state of the function block by State.0 := b Enable; by State.1 := b Motor Speed1; by State.2 := b Motor Speed2; by State.3 := b State Auto Speed1; by State.4 := b State Auto Speed2; y State.5 := b State Repair Switch; by State.6 := b State Man Switch; by State.7 := b Ctrl Voltage; TF8000 Version: 1.3.0 49
## Page 50

Programming b State Auto Speed1: Indicates the state for automatic preselection of speed 1 if the operation mode e Ctrl Mode Actuator is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP and speed 1 was activated via the input variable b Auto Speed1. b State Auto Speed2: Indicates the state for automatic preselection of speed 2 if the operation mode e Ctrl Mode Actuator is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP and speed 2 was activated via the input variable b Auto Speed2. b State Repair Switch: Indicates the state of the repair switch. TRUE indicates that the repair switch is switched off. b State Man Switch: Indicates the state of the manual/emergency switch. A TRUE signals that the manual/ emergency operating level is activated. e State Mode Actuator: Enum via which the state of the operation mode of the motor is fed back to the controller (see E_HVACActuator Mode [} 488]). b Error General: The error message b Error General becomes TRUE as soon as one of the error messages b Error Motorprotec Speed1, b Error Motorprotec Speed2, b Error Feedb Contactor Speed1, b Error Feedb Contactor Speed2 or b Error Feedb Process = TRUE. The outputs b Motor Speed1 and b Motor Speed2 are then set to FALSE and are only enabled again when the fault has been rectified and acknowledged via b Reset. After rectification of the fault a restart of the motor is blocked for the duration of t Delay Speed2to Speed1. by Error: Delivers all error messages and warnings from the function block. by Error.1 := b Invalid Parameter; by Error.2 := b Error General; by Error.3 := b Error Motorprotec Speed1; by Error.4 := b Error Motorprotec Speed2; by Error.5 := b Error Feedb Contactor Speed1; by Error.6 := b Error Feedb Contactor Speed2; by Error.7 := b Error Feedb Process; b Error Motorprotec Speed1: Motor protection error, see input variable b Motor Protec Speed1 b Error Motorprotec Speed2: Motor protection error, see input variable b Motor Protec Speed2 b Error Feedb Contactor Speed1: Power section feedback error, see input variable b Feedb Contactor Speed1 If no feedback from the power section of the motor is present, the output variable b Motor Speed1 must be applied to the input b Feedb Contactor Speed1. b Error Feedb Contactor Speed2: Power section feedback error, see input variable b Feedb Contactor Speed2 If no feedback from the power section of the motor is present, the output variable b Motor Speed2 must be applied to the input b Feedb Contactor Speed2. b Error Feedb Process: Process feedback error, see input variable b Feedback Process b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables e Ctrl Mode Actuator, t Start Delay, t Stop Delay, t Delay Feedb Contactor Speed1, t Delay Feedb Contactor Speed2, t Feedb Process Timer, t Delay Feedb Process, t Delay Speed1 or t Delay Speed1To Speed2. An incorrect parameter specification does not lead to a standstill of the function block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. VAR_IN_OUT t Start Delay : TIME; t Stop Delay : TIME; t Delay Feedb Contactor Speed1 : TIME; t Delay Feedb Contactor Speed2 : TIME; t Feedb Process Timer : TIME; t Delay Feedb Process : TIME; 50 Version: 1.3.0 TF8000
## Page 51

Programming t Delay Speed1 : TIME; t Delay Speed1To Speed2 : TIME; t Delay Speed2To Speed1 : TIME; t Start Delay: The start-up of the motor after enabling and switching on via the operation mode of the motor is delayed by the time t Start Delay [s] (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Stop Delay: The switch-off of the motor in the respective switch-on stage, either by switching the enable b Enable to FALSE, or by switching off via the operation mode e Ctrl Mode Actuator, or in automatic operation mode by switching the input variables b Auto Speed1 and b Auto Speed2 to FALSE, is delayed by the time t Stop Delay [s]. Once the delayed switch-off of the motor has been activated it can no longer be canceled (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Feedb Contactor Speed1: Time delay of the feedback of the power section after switching on the motor. If this time has elapsed and b Feedb Contactor Speed1 = FALSE, then this is fed back to the controller via the error message b Error Feedb Contactor Speed1 (100ms..3600s). The variable is saved persistently. Preset to 100 ms. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Feedb Contactor Speed2: Time delay of the feedback of the power section after switching on the motor. If this time has elapsed and b Feedb Contactor Speed2 = FALSE, then this is fed back to the controller via the error message b Error Feedb Contactor Speed2 (100ms..3600s). The variable is saved persistently. Preset to 100 ms. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Feedback Process Timer: Time delay [s] of the process feedback b Feedb Process during the motor start-up phase. If this time has elapsed and b Feedb Process = FALSE, then this is fed back to the controller via the error message b Error Feedb Process (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Feedb Process: In order to avoid undesired switching off of the drive during operation due to the process monitoring b Feedb Process, e.g. in the event of short-term pressure fluctuations, the response of the input b Feedb Process can be delayed by the time t Delay Feedb Process [s] (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Speed1: Time delay [s] for the start-up phase of the motor in speed 1 (1s..3600s). The variable is saved persistently. Preset to 3 s. After this time has elapsed the motor can be switched from the first to the second speed if the operation mode for speed 2 has been selected. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Speed1To Speed2: Time delay for the motor switchover phase from speed 1 to speed 2, so that both outputs b Motor Speed1 and b Motor Speed2 are FALSE for a short while (100ms..10s). The variable is saved persistently. Preset to 250 ms. The purpose of this time delay is to preserve the motor windings. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. TF8000 Version: 1.3.0 51
## Page 52

Programming t Delay Speed2To Speed1: Time delay [s] for the motor switchover phase from speed 2 to speed 1 (1s..3600s). The variable is saved persistently. Preset to 10 s. In this phase both outputs b Motor Speed1 and b Motor Speed2 are FALSE for the time t Delay Speed2To Speed1 in order to reduce the speed of the motor when switching to speed 1. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.2.7 FB_HVACMotor3Speed This function block serves to control a three-speed drive in HVAC systems. The function block always runs in stage 1, the lowest power stage, and switches to stage 2 or stage 3 depending on requirements. It cannot be switched on directly in stage 2 or 3. In the event of a restart, disablement, an error or switching off of the motor via the operation mode, restart of the motor is blocked for the duration of t Delay Speed2To Speed1 + t Delay Speed3To Speed2. 52 Version: 1.3.0 TF8000
## Page 53

Programming VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b Auto Speed1 : BOOL; b Auto Speed2 : BOOL; b Auto Speed3 : BOOL; e Ctrl Mode Actuator : E_HVACActuator Mode; b Motor Protec Speed1 : BOOL; b Motor Protec Speed2 : BOOL; b Motor Protec Speed3 : BOOL; b Feedb Contactor Speed1 : BOOL; b Feedb Contactor Speed2 : BOOL; b Feedb Contactor Speed3 : BOOL; b Feedb Process : BOOL; b Repair Switch : BOOL; b Man Switch : BOOL; b Ctrl Voltage : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If b Enable = FALSE, the drive will be switched off in the respective switch-on stage with a delay via the specified time variable t Stop Delay. If an enable is present, a restart of the motor is blocked for the duration of t Delay Speed2To Speed1 + t Delay Speed3To Speed2. b Auto Speed1: b Auto Speed1 is then only active if the operation mode e Ctrl Mode Actuator [} 488] is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP. If the input variable b Auto Speed1 is TRUE and the input variables b Auto Speed2 and b Auto Speed3 are FALSE, then the function block is instructed that the drive should run at speed 1. If b Auto Speed1 = FALSE, the drive will be switched off with a delay via the specified time variable t Stop Delay. b Auto Speed2: b Auto Speed2 is then only active if the operation mode e Ctrl Mode Actuator [} 488] is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP. If the input variables b Auto Speed1 and b Auto Speed2 are TRUE and the input variable b Auto Speed3 is FALSE, then the function block is instructed that the drive should run at speed 2. If b Auto Speed1 and b Auto Speed2 are both FALSE, the drive will be switched off with a delay via the specified time variable t Stop Delay. b Auto Speed3: b Auto Speed3 is then only active if the operation mode e Ctrl Mode Actuator [} 488] is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP. If the input variables b Auto Speed1, b Auto Speed2 and b Auto Speed3 are TRUE, then the function block is instructed that the drive should run at speed 3. If b Auto Speed1, b Auto Speed2 and b Auto Speed3 are all FALSE, the drive will be switched off with a delay via the specified time variable t Stop Delay. TF8000 Version: 1.3.0 53
## Page 54

Programming e Ctrl Mode Actuator: Enum that specifies the operation mode of the motor (see E_HVACActuator Mode [} 488]). If specified incorrectly, operation continues internally with the last valid operation mode. This is e HVACActuator Mode_Auto_BMS in the case of initial commissioning. b Invalid Parameter is set in the case of an incorrect parameter specification. b Motor Protec Speed1: Input for the motor protection speed 1. There is a motor protection error if the input b Motor Protec Speed1 = FALSE (quiescent current principle). In the event of a fault, the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE; the fault is indicated at the output of the function block by b Error Motorprotec Speed1. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. b Motor Protec Speed2: Input for the motor protection speed 2. There is a motor protection error if the input b Motor Protec Speed2 = FALSE (quiescent current principle). In the event of a fault, the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE; the fault is indicated at the output of the function block by b Error Motorprotec Speed2. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. b Motor Protec Speed3: Input for the motor protection speed 3. There is a motor protection error if the input b Motor Protec Speed3 = FALSE (quiescent current principle). In the event of a fault, the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE; the fault is indicated at the output of the function block by b Error Motorprotec Speed3. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. b Feedb Contactor Speed1: Feedback from the power section of the motor for speed 1. The operating feedback is present if the input b Feedb Contactor Speed1 = TRUE. If, after switching on the motor, this feedback is not present after the time delay set by t Delay Feedb Contactor Speed1, the output b Error Feedb Contactor Speed1 is set in order to indicate a fault. In the event of a fault, the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. If no feedback from the power section of the motor is present for speed 1, the output variable b Motor Speed1 must be applied to the input b Feedb Contactor Speed1. If no feedback from the power section of the motor is present, the output variable b Motor Speed1 must be applied to the input b Feedb Contactor Speed1. See application example b Feedb Contactor Speed2: Feedback from the power section of the motor for speed 2. The operating feedback is present if the input b Feedb Contactor Speed2 = TRUE. If, after switching on the motor, this feedback is not present after the time delay set by t Delay Feedb Contactor Speed2, the output b Error Feedb Contactor Speed2 is set in order to indicate a fault. In the event of a fault, the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. If no feedback from the power section of the motor is present for speed 2, the output variable b Motor Speed2 must be applied to the input b Feedb Contactor Speed2. If no feedback from the power section of the motor is present, the output variable b Motor Speed2 must be applied to the input b Feedb Contactor Speed2. See application example b Feedb Contactor Speed3: Feedback from the power section of the motor for speed 3. The operating feedback is present if the input b Feedb Contactor Speed3 = TRUE. If, after switching on the motor, this feedback is not present after the time delay set by t Delay Feedb Contactor Speed3, the output b Error Feedb Contactor Speed3 is set in order to indicate a fault. In the event of a fault, the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. If no feedback from the power section of the motor is present for speed 3, the output variable b Motor Speed3 must be applied to the input b Feedb Contactor Speed3. If no feedback from the power section of the motor is present, the output variable b Motor Speed3 must be applied to the input b Feedb Contactor Speed3. See application example 54 Version: 1.3.0 TF8000
## Page 55

Programming b Feedb Process: A process feedback signal, for example from a v-belt monitor or a flow monitor can be connected to the input b Feedb Process. The process feedback is present if the input b Feedb Process = TRUE (quiescent current principle). If, in the start-up phase after switching on the motor, the process feedback is not present after the time set by t Feedb Process Timer, the drive switches off and indicates a fault at the output b Error Feedb Process. The motor can only be restarted if the fault has been rectified and acknowledged at the input b Reset. In order to avoid undesired switching off of the drive during operation due to the process monitoring, e.g. in the event of short-term pressure fluctuations, the triggering of the input b Feedb Process can be delayed by the time t Delay Feedb Process. The process feedback is active if either b Motor Speed1, b Motor Speed2 or b Motor Speed3 = TRUE. b Repair Switch: The state of the repair switch is monitored with the input b Repair Switch. The motor can only be switched on if b Repair Switch = TRUE (quiescent current principle). If the repair switch is switched off, b Repair Switch = FALSE and the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE. If the state of the repair switch is TRUE, a restart of the motor is blocked for the duration of t Delay Speed2To Speed1 + t Delay Speed3To Speed2. b Man Switch: The state of the manual/emergency switch is monitored with the input b Man Switch. The motor can only be switched on if b Man Switch = TRUE (quiescent current principle). If the manual/emergency switch is switched off, then b Man Switch is FALSE and the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE. If the state of the manual/emergency switch is TRUE, a restart of the motor is blocked for the duration of t Delay Speed2To Speed1 + t Delay Speed3To Speed2. b Ctrl Voltage: The state of the control voltage is monitored with the input b Ctrl Voltage. The motor can only be switched on if b Ctrl Voltage = TRUE (quiescent current principle). If the control voltage is switched off, b Ctrl Voltage = FALSE and the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE. In order to avoid a torrent of error messages if the control voltage fails, the error messages of the function block are suppressed. If the control voltage is restored, the error messages are enabled again. If control voltage is present, a restart of the motor is blocked for the duration of t Delay Speed2To Speed1 + t Delay Speed3To Speed2. b Reset: Input for acknowledgement of faults via a rising edge. VAR_OUTPUT b Motor Speed1 : BOOL; b Motor Speed2 : BOOL; b Motor Speed3 : BOOL; w State : WORD; b State Auto Speed1 : BOOL; b State Auto Speed2 : BOOL; b State Auto Speed3 : BOOL; b State Repair Switch : BOOL; b State Man Switch : BOOL; e State Mode Actuator : E_HVACActuator Mode; b Error General : BOOL; w Error : WORD; b Error Motorprotec Speed1 : BOOL; b Error Motorprotec Speed2 : BOOL; b Error Motorprotec Speed3 : BOOL; b Error Feedb Contactor Speed1 : BOOL; b Error Feedb Contactor Speed2 : BOOL; b Error Feedb Contactor Speed3 : BOOL; b Error Feedb Process : BOOL; b Invalid Parameter : BOOL; b Motor Speed1: Output variable for controlling speed 1 of the three-speed drive. b Motor Speed2: Output variable for controlling speed 2 of the three-speed drive. b Motor Speed3: Output variable for controlling speed 3 of the three-speed drive. w State: Status word indicating the operating state of the function block. w State.0 := b Enable; w State.1 := b Motor Speed1; w State.2 := b Motor Speed2; w State.3 := b Motor Speed3; w State.4 := b State Auto Speed1; w State.5 := b State Auto Speed2; w State.6 := b State Auto Speed3; TF8000 Version: 1.3.0 55
## Page 56

Programming w State.7 := b State Repair Switch; w State.8 := b State Man Switch; w State.9 := b Ctrl Voltage; b State Auto Speed1: Indicates the state for automatic preselection of speed 1 if the operation mode e Ctrl Mode Actuator [} 488] is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP and speed 1 was activated via the input variable b Auto Speed1. b State Auto Speed2: Indicates the state for automatic preselection of speed 2 if the operation mode e Ctrl Mode Actuator [} 488] is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP and speed 2 was activated via the input variable b Auto Speed2. b State Auto Speed3: Indicates the state for automatic preselection of speed 3 if the operation mode e Ctrl Mode Actuator [} 488] is either e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP and speed 3 was activated via the input variable b Auto Speed3. b State Repair Switch: Indicates the state of the repair switch. TRUE indicates that the repair switch is switched off. b State Man Switch: Indicates the state of the manual/emergency switch. A TRUE signals that the manual/ emergency operating level is activated. e State Mode Actuator: Enum via which the operation mode status of the motor is fed back to the controller. b Error General: The error message b Error General becomes TRUE as soon as one of the error messages b Error Motorprotec Speed1, b Error Motorprotec Speed2, b Error Motorprotec Speed3, b Error Feedb Contactor Speed1, b Error Feedb Contactor Speed2, b Error Feedb Contactor Speed23 or b Error Feedb Process = TRUE. The outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are then set to FALSE and are only enabled again when the fault has been rectified and acknowledged via b Reset. After rectification of the fault a restart of the motor is blocked for the duration of t Delay Speed2To Speed1 + t Delay Speed3To Speed2. w Error: Delivers all error messages and warnings from the function block. w Error.1 := b Invalid Parameter; w Error.2 := b Error General; w Error.3 := b Error Motorprotec Speed1; w Error.4 := b Error Motorprotec Speed2; w Error.5 := b Error Motorprotec Speed3; w Error.6 := b Error Feedb Contactor Speed1; w Error.7 := b Error Feedb Contactor Speed2; w Error.8 := b Error Feedb Contactor Speed3; w Error.9 := b Error Feedb Process; b Error Motorprotec Speed1: Motor protection error, see input variable b Motor Protec Speed1. b Error Motorprotec Speed2: Motor protection error, see input variable b Motor Protec Speed2. b Error Motorprotec Speed3: Motor protection error, see input variable b Motor Protec Speed3. b Error Feedb Contactor Speed1: Power section feedback error, see input variable b Feedb Contactor Speed1. If no feedback from the power section of the motor is present, the output variable b Motor Speed1 must be applied to the input b Feedb Contactor Speed1. b Error Feedb Contactor Speed2: Power section feedback error, see input variable b Feedb Contactor Speed2 If no feedback from the power section of the motor is present, the output variable b Motor Speed2 must be applied to the input b Feedb Contactor Speed2. b Error Feedb Contactor Speed3: Power section feedback error, see input variable b Feedb Contactor Speed3 56 Version: 1.3.0 TF8000
## Page 57

Programming If no feedback from the power section of the motor is present, the output variable b Motor Speed3 must be applied to the input b Feedb Contactor Speed3. b Error Feedb Process: Process feedback error, see input variable b Feedback Process. b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables e Ctrl Mode Actuator, t Start Delay, t Stop Delay, t Delay Feedb Contactor Speed1, t Delay Feedb Contactor Speed2, t Delay Feedb Contactor Speed3, t Feedb Process Timer, t Delay Feedb Process, t Delay Speed1, t Delay Speed2, t Delay Speed1To Speed2To Speed3, t Delay Speed2To Speed1 or t Delay Speed3To Speed2. An incorrect parameter specification does not lead to a standstill of the function block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. VAR_IN_OUT t Start Delay : TIME; t Stop Delay : TIME; t Delay Feedb Contactor Speed1 : TIME; t Delay Feedb Contactor Speed2 : TIME; t Delay Feedb Contactor Speed3 : TIME; t Feedb Process Timer : TIME; t Delay Feedb Process : TIME; t Delay Speed1 : TIME; t Delay Speed2 : TIME; t Delay Speed1To Speed2To Speed3 : TIME; t Delay Speed2To Speed1 : TIME; t Delay Speed3To Speed2 : TIME; t Start Delay: The start-up of the motor after enabling and switching on via the operation mode of the motor is delayed by the time t Start Delay [s] (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Stop Delay: The switching off of the motor in the respective switch-on stage, either by switching the enable b Enable to FALSE, or by switching off via the operation mode e Ctrl Mode Actuator, or in automatic operation mode by switching the input variables b Auto Speed1, b Auto Speed2 and b Auto Speed3 to FALSE, is delayed by the time t Stop Delay [s]. Once the delayed switch-off of the motor has been activated it can no longer be canceled (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Feedb Contactor Speed1: Time delay of the feedback of the power section after switching on the motor. If this time has elapsed and b Feedb Contactor Speed1 = FALSE, then this is fed back to the controller via the error message b Error Feedb Contactor Speed1 (100ms..3600s). The variable is saved persistently. Preset to 100 ms. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Feedb Contactor Speed2: Time delay of the feedback of the power section after switching on the motor. If this time has elapsed and b Feedb Contactor Speed2 = FALSE, then this is fed back to the controller via the error message b Error Feedb Contactor Speed2 (100ms..3600s). The variable is saved persistently. Preset to 100 ms. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Feedb Contactor Speed3: Time delay of the feedback of the power section after switching on the motor. If this time has elapsed and b Feedb Contactor Speed3 = FALSE, then this is fed back to the controller via the error message b Error Feedb Contactor Speed3 (100ms..3600s). The variable is saved persistently. Preset to 100 ms. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. TF8000 Version: 1.3.0 57
## Page 58

Programming t Feedback Process Timer: Time delay [s] of the process feedback b Feedb Process during the motor start-up phase. If this time has elapsed and b Feedb Process = FALSE, then this is fed back to the controller via the error message b Error Feedb Process (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Feedb Process: In order to avoid undesired switching off of the drive during operation due to the process monitoring b Feedb Process, e.g. in the event of short-term pressure fluctuations, the response of the input b Feedb Process can be delayed by the time t Delay Feedb Process [s] (0s..3600s). The variable is saved persistently. Preset to 0 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Speed1: Time delay [s] for the start-up phase of the motor in speed 1 (1s..3600s). The variable is saved persistently. Preset to 3 s. After this time has elapsed the motor can be switched from the first to the second speed if the operation mode for speed 2 has been selected. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Speed2: Time delay [s] for the start-up phase of the motor in speed 2 (1s..3600s). The variable is saved persistently. Preset to 3 s. After this time has elapsed the motor can be switched from the second to the third speed if the operation mode for speed 3 has been selected. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Speed1To Speed2To Speed3: Time delay for the motor switchover phase from speed 1 to speed 2, or from speed 2 to speed 3, so that the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are all FALSE for a short while (1s..3600s). The variable is saved persistently. Preset to 250 ms. The purpose of this time delay is to preserve the motor windings. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Speed2To Speed1: Time delay [s] for the motor switchover phase from speed 2 to speed 1 (1s..3600s). The variable is saved persistently. Preset to 10 s. In this phase the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are FALSE for the time t Delay Speed2To Speed1 in order to reduce the speed of the motor when switching to speed 1. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Delay Speed3To Speed2: Time delay [s] for the motor switchover phase from speed 3 to speed 2 (1s..3600s). The variable is saved persistently. Preset to 10 s. In this phase the outputs b Motor Speed1, b Motor Speed2 and b Motor Speed3 are FALSE for the time t Delay Speed2To Speed2 in order to reduce the speed of the motor when switching to speed 2. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 58 Version: 1.3.0 TF8000
## Page 59

Programming 5.1.2.8 FB_HVACMux8 This function block evaluates the FIFO memory from FB_HVACRedundancy Ctrl Ex [} 65]. The inputs are mapped to the respective outputs according to a FIFO table. If this function block is used, for example, to control speed-controlled fans, then the setpoints from a controller cascade can be assigned to the respective outputs (drives). To do this, the setpoints are applied to the inputs of FB_HVACMux8. The processing takes place with the aid of information from the FIFO memory (which drive is running and in which order did switch-on take place). Example: There are 4 drives with speed controllers (Set FC1 – Set FC4), of which a maximum of three should be running. The control range of 0 to 300% is divided into 3 setpoints (Set1 to Set3). The output arr Fi Fo of FB_HVACRedundancy Ctrl Ex supplies FB_HVACMux8 with the assignment description. In the example the array contains: 2,3,0,0,0,0,0,0. Therefore Q2 was switched on first and then Q3. As a result r In1 is now output on r Q2 and r In2 on r Q3 in FB_HVACMux8. VAR_INPUT arr Fi Fo : Array[1..8] of INT; r In1 - r In8 : REAL; arr Fi Fo: Contains the assignment table with a maximum of eight values. The first value indicates where the first input was copied to, the second value where the second input was copied to and so on. Identical values are permitted. No assignment takes place with "0". r In1 - 8: Setpoints to be mapped. VAR_OUTPUT r Q1 - r Q8 : REAL; b Err : BOOL; r Q1 -r Q8: Actuator setpoint, input value mapped according to the Fi Fo table. b Err: Value range in the Fi Fo table was exceeded; 0 to 8 is permissible. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 59
## Page 60

Programming 5.1.2.9 FB_HVACMux8Ex This function block evaluates the FIFO memory from FB_HVACRedundancy Ctrl Ex [} 65]. The inputs are mapped to the respective outputs according to a FIFO table. Sample: In the sample the array contains: 4,3,1,2,0,0,0,0. As a result the following are now output in FB_HVACMux8Ex r In1 on the output r Q4 r In2 on the output r Q3 r In3 on the output r Q1 r In4 on the output r Q2 VAR_INPUT arr Fi Fo : Array[1..8] of INT; r In1 - r In8 : REAL; arr Fi Fo: Contains the assignment table with a maximum of eight values. The first value indicates where the first input was copied to, the second value where the second input was copied to and so on. No assignment takes place with "0". r In1- r In8: Setpoints to be mapped. VAR_OUTPUT r Q1 – r Q8 : REAL; r Q1 – r Q8: Actuator setpoint, input value mapped according to the FIFO table. Requirements Development environment required library required function Twin CAT 3.1 build 4022.22 or Tc2_HVAC V3.3.4.0 TF8000 | TC3 HVAC V1.0.1.0 higher 60 Version: 1.3.0 TF8000
## Page 61

Programming 5.1.2.10 FB_HVACMux8_BOOL This function block evaluates the FIFO memory from FB_HVACRedundancy Ctrl Ex [} 65]. The inputs are mapped to the respective outputs according to a FIFO table. The functions blocks FB_HVACRedundancy Ctrl Ex [} 65], FB_HVACMux8_BOOL and FB_HVACMux8Ex [} 60] enable the sequential control of up to 8 units with automatic changing of the switch-on sequence. Sample: In the sample the array contains: 4,3,1,2,0,0,0,0. As a result the following are now output in FB_HVACMux8_BOOL b In1 on the output b Q4 b In2 on the output b Q3 b In3 on the output b Q1 b In4 on the output b Q2 ausgegeben. VAR_INPUT arr Fi Fo : Array[1..8] of INT; b In1 - b In8 : BOOL; arr Fi Fo: Contains the assignment table with a maximum of eight values. The first value indicates where the first input was copied to, the second value where the second input was copied to and so on. Identical values are permitted. No assignment takes place with "0". b In1- b In8: Variables to be mapped. VAR_OUTPUT b Q1 – b Q8 : BOOL; b Q1 – b Q8: Output variable; mapped input variable according to FIFO table. Requirements Development environment required library required function Twin CAT 3.1 build 4022.22 or Tc2_HVAC V3.3.4.0 TF8000 | TC3 HVAC V1.0.1.0 higher TF8000 Version: 1.3.0 61
## Page 62

Programming 5.1.2.11 FB_HVACRedundancy Ctrl This function block serves to control a certain number of actuators, e.g. of pumps, from a pool of 8 actuators. From all enabled actuators, the logic searches for those with the shortest runtimes and switches them on according to the runtime order. This continues until the number specified via i Count Ctrl is reached. The actuators are routed internally via a FIFO memory so that they can be switched off again in the same order. Changeover during operation can be performed with the time specification ui Max On Level or by the trigger b Force Change. The actuator that has been switched on longest is switched off, and the one with the shortest runtime is switched on. In order to avoid a hydraulic shock in the pumps, an overlap time can be set via t Overlap1Actuator. This applies only to cases where an exchange between two actuators takes place. In order to determine the runtimes, the function block FB_HVACWork [} 458] is instanced internally and the IN-OUT variables are relayed to the outside (r Hours and ui Count). The recording of the operating time is controlled by the Feedback inputs. If no feedback signal from the actuator is available, the actuator output must be fed back to the feedback input. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; i Count Ctrl : INT; b En1 - b En8 : BOOL; b Feed Back1 - b Feed Back8 : BOOL; b Force Change : BOOL; dt System Time : DT; b Sys Takt1Hz : BOOL; 62 Version: 1.3.0 TF8000
## Page 63

Programming b Reset All Hours : BOOL; b Reset All Counter : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. i Count Ctrl: Number of actuators to be switched on (0..8). b En1 - 8: Enables the corresponding actuator. b Feed Back1 - 8: Operating feedback from the actuator. Evaluation only takes place if t No Feedb Actuator > t#0s. b Force Change: A positive edge at the input switches off the first actuator in the FIFO and switches on the actuator from the pool that has the shortest runtime. dt System Time: System time. b Sys Takt1Hz: 1 Hz clock signal as a replacement for dt System Time; if dt System Time is not available, or does not change its value for longer than 2 s, then the clock signal is used as a replacement. b Reset All Hours: Resets all operating hour meters. b Reset All Counter: Resets all switch-on meters. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b Q1 - b Q8 : BOOL; e Error Code : E_HVACError Codes; b Error General : BOOL; b Invalid Parameter : BOOL; b Q1 - 8: Actuator feedback. e Error Code: Indicates which actuator has not returned an operating feedback within the prespecified time interval (see E_HVACError Codes [} 490]). The recognition of this group of errors is activated by a time greater than 0 in the variable t No Feedb Actuator. e HVACError Codes_Error_No Feedback Actuator1 := 15, e HVACError Codes_Error_No Feedback Actuator2 := 16, e HVACError Codes_Error_No Feedback Actuator3 := 17, e HVACError Codes_Error_No Feedback Actuator4 := 18, e HVACError Codes_Error_No Feedback Actuator5 := 19, e HVACError Codes_Error_No Feedback Actuator6 := 20, e HVACError Codes_Error_No Feedback Actuator7 := 21, e HVACError Codes_Error_No Feedback Actuator8 := 22, TF8000 Version: 1.3.0 63
## Page 64

Programming b Error General: Error during evaluation of the operating feedback. b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Hours : REAL; ui Count : UINT; t Overlap1Actuator : TIME; ui Max On Level : UINT; t No Feedb Actuator : TIME; r Hours[1..8]: Operating hours [h] with a resolution of 1/100 hours (internally with 1 s). The variable is saved persistently. ui Count[1..8]: Switch-on cycle counter. The variable is saved persistently. t Overlap1Actuator: Overlap time for the case where an exchange between two actuators takes place (0ms..1min). The variable is saved persistently. Preset to 20 s. ui Max On Level: Max. time in hours [h] that an actuator may be switched on (0h..1000h). Forces an actuator change only if an actuator is available to be switched on. The variable is saved persistently. Preset to 200 h. t No Feedb Actuator: Time that is allowed to elapse before the lack of an operating feedback from the actuator leads to b Error General = TRUE (0ms..60s). There is no evaluation if the time = 0. The variable is saved persistently. Preset to 3 s. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 64 Version: 1.3.0 TF8000
## Page 65

Programming 5.1.2.12 FB_HVACRedundancy Ctrl Ex This function block serves to control a certain number of actuators, e.g. of pumps, from a pool of 8 actuators. From all enabled actuators, the logic searches for those with the shortest runtimes and switches them on according to the runtime order. This continues until the number specified via i Count Ctrl is reached. The actuators are routed internally via a FIFO memory so that they can be switched off again in the same order. Changeover during operation can take place with the time specification ui Max On Level, a change of i Count Ctrl or by the trigger b Force Change. The actuator that has been switched on longest is switched off, and the one with the shortest runtime is switched on. In order to avoid a hydraulic stroke in the pumps, an overlap time can be set via t Overlap1Actuator. This applies only to cases where an exchange between two actuators takes place. In contrast to FB_HVACRedundancy Ctrl [} 62] no internal timer is used for determining the runtimes. Instead, the times have to be specified externally as hourly values via Var_Input. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; i Count Ctrl : INT; b En1 - b En8 : BOOL; b Feed Back1 - b Feed Back8 : BOOL; b Force Change : BOOL; r Hours1-r Hours8 : REAL; TF8000 Version: 1.3.0 65
## Page 66

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. i Count Ctrl: Number of actuators to be switched on (0..8). A change in the sequence of the actuators to be switched on is created by a change of i Count Ctrl. b En1 - 8: Enables the corresponding actuator. b Feed Back1 - 8: Operating feedback from the actuator. Evaluation only takes place if t No Feedb Actuator > t#0s. b Force Change: A positive edge at the input switches off the first actuator in the FIFO and switches on the actuator from the pool that has the shortest runtime. r Hours: Operating hours VAR_OUTPUT b Q1 - b Q8 : BOOL; arr Fi Fo : Array[1..8] of INT; e Error Code : E_HVACError Codes; b Error General : BOOL; b Invalid Parameter : BOOL; b Q1 - 8: Actuator feedback. arr Fi Fo: Table containing the information showing which actuator is switched on (actuator number). The order specifies the switch-off sequence. arr Fi Fo[1] = no. of the actuator that will be switched off next. e Error Code: Indicates which actuator has not returned an operating feedback within the prespecified time interval (see E_HVACError Codes [} 490]). The recognition of this group of errors is activated by a time greater than 0 in the variable t No Feedb Actuator. e HVACError Codes_Error_No Feedback Actuator1 := 15, e HVACError Codes_Error_No Feedback Actuator2 := 16, e HVACError Codes_Error_No Feedback Actuator3 := 17, e HVACError Codes_Error_No Feedback Actuator4 := 18, e HVACError Codes_Error_No Feedback Actuator5 := 19, e HVACError Codes_Error_No Feedback Actuator6 := 20, e HVACError Codes_Error_No Feedback Actuator7 := 21, e HVACError Codes_Error_No Feedback Actuator8 := 22, b Error General: Error during evaluation of the operating feedback. b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. 66 Version: 1.3.0 TF8000
## Page 67

Programming VAR_IN_OUT t Overlap1Actuator : TIME; ui Max On Level : UINT; t No Feedb Actuator : TIME; t Overlap1Actuator: Overlap time for the case where an exchange between two actuators takes place (0ms..1min). The variable is saved persistently. Preset to 20 s. ui Max On Level: Max. time in hours that an actuator may be switched on (0h..1000h). Forces an actuator change only if an actuator is available to be switched on. The variable is saved persistently. Preset to 200 h. t No Feedb Actuator: Time that is allowed to elapse before the lack of an operating feedback from the actuator leads to b Error General = TRUE (0ms..60s). There is no evaluation if the time = 0. The variable is saved persistently. Preset to 3 s Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.3 HVAC Analog modules 5.1.3.1 FB_HVACAnalog Input This function block serves the acquisition and scaling of analog input signals. Using the KL30xx, KL31xx and KL32xx terminals, the standard signals 0-20 m A, 4-20 m A, 0-10 V and 10-5000 Ω can be acquired and converted to physical values. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; i Raw Value : INT; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; b Enable Limit Ctrl : BOOL; b Ctrl Voltage : BOOL; b Reset : BOOL; TF8000 Version: 1.3.0 67
## Page 68

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. i Raw Value: The raw value is transferred from the terminal to the function block with the parameter i Raw Value. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: Cycle time with which the function block is processed. This must be greater than or equal to Task Cycle Time. The function block uses this input variable to calculate internally whether the state and the output variables have to be updated in the current cycle. b Enable Limit Ctrl: Limit value monitoring is only activated if the variable b Enable Limit Ctrl is TRUE. This way, limit value monitoring can be delayed with a timer until the heating or air conditioning system is in a controlled state. In the case of air conditioning systems, this is usually enabled by the system start program. See also FB_HVACStart Air Conditioning [} 446]regarding this point. b Ctrl Voltage: By means of checking the sensor supply voltage with the input b Ctrl Voltage, error messages are suppressed if the supply voltage to the sensors is absent. If the sensor supply voltage is present, a TRUE is present at the input b Ctrl Voltage. b Reset: Acknowledge input in the event of an error. In addition the 2nd order filter can be synchronized via this input to the present measuring signal, so that this can be output at r Present Value. VAR_OUTPUT r Present Value : REAL; by State : BYTE; b Error : BOOL; e Error Code : E_HVACError Codes; b Error High Limit : BOOL; b Error Low Limit : BOOL; b Error General : BOOL; by Error : BYTE; b Invalid Parameter : BOOL; r Present Value: Determined output value. by State: State of the function block. by State.1:= TRUE, limit value monitoring is activated. by State.7:= TRUE, sensor supply voltage is present. b Error: The variable b Error changes to TRUE in the event of an internal error in the function block. e Error Code: Contains the specific error code related to the output b Error (see E_HVACError Codes [} 490]). b Error High Limit: TRUE if the upper limit value has been reached. 68 Version: 1.3.0 TF8000
## Page 69

Programming b Error Low Limit: TRUE if the lower limit value is reached. b Error General: TRUE if a single error message from the process is present. by Error: Output of the error as a byte. by Error.0:= b Error by Error.1:= b Invalid Parameter by Error.2:= b Error General by Error.3:= b Error Low Limit is TRUE if the lower limit value is undershot. by Error.4:= b Error High Limit is TRUE if the upper limit value is exceeded. b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT i High Range : INT; i Low Range : INT; r High Range : REAL; r Low Range : REAL; r High Limit : REAL; r Low Limit : REAL; t Filter Time : TIME; r Offset : REAL; i High Range: Upper raw value of the input variable i Raw Value. The variable is saved persistently. Preset to 32767. i Low Range: Lower raw value of the input variable i Raw Value. The variable is saved persistently. Preset to 0. r High Range: The upper scaled measured value. The variable is saved persistently. Preset to 100. r Low Range: The lower scaled measured value. The variable is saved persistently. Preset to 0. r High Limit: If the scaled measured value is larger than the upper limit value r High Limit, an impermissibly high measured value can be reached. The function block indicates this error by setting the variable b Err High Limit to TRUE. The variable is saved persistently. Preset to 100. r Low Limit: If the scaled measured value is smaller than the lower limit value r Low Limit, an impermissibly low measured value can be reached. The function block indicates this error by setting the variable b Err Low Limit to TRUE. The variable is saved persistently. Preset to 0. t Filter Time: To avoid large fluctuations and jumps in the measuring signal, the function block is provided with two 1st order filters. Both filters work with the same time constant. The filter constants are determined by the variable t Filter Time [s] (0..3600). The variable is saved persistently. Preset to 2 s. r Offset: With this offset the linear equation determined by means of the two conversion points is shifted parallel upwards or downwards. The variable is saved persistently. Preset to 0. With the two value pairs High Range/r High Range and i Low Range/r Low Range, the raw value is linearly converted to the physical unit. i High Range and i Low Range correspond to the raw values. r High Limit and r Low Limit correspond to the scaled values in the physical unit of the signal to be measured. The output value is given by: r Present Value = [ { (r High Range - r Low Range) / (i High Range - i Low Range) } x (i Raw Value - i High Range ] + r High Range + r Offset Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 69
## Page 70

Programming 5.1.3.2 FB_HVACAnalog Output This function block serves to control analog actuators, such as valves or dampers, with positional feedback. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r Setpoint : REAL; b Ctrl Voltage : BOOL; e Ctrl Mode Analog Output : E_HVACAnalog Output Mode; r YManual : REAL; r Feedb : REAL; b Frost : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If the function block is not enabled the value zero is output at the output r Y. r Setpoint: The setpoint for the analog output is transferred to the function block with the variable r Setpoint. 70 Version: 1.3.0 TF8000
## Page 71

Programming b Ctrl Voltage: The control voltage is present if the b Ctrl Voltage variable is TRUE. The feedback control is deactivated in the event of failure of the control voltage so that no false alarms occur. e Ctrl Mode Analog Output: Enum that defines the operation mode (see E_HVACAnalog Output Mode [} 488]). TYPE E_HVACAnalog Output Mode : ( e HVACAnalog Output Mode_Auto_BMS := 0, e HVACAnalog Output Mode_Manual_BMS := 1, e HVACAnalog Output Mode_Auto_OP := 2, e HVACAnalog Output Mode_Manual_OP := 3 ); END_TYPE r YManual: Analog input value, which is relayed to the output r Y in manual mode. r Feedb: Analog positional feedback from the actuator. b Frost: This input serves to protect an air heater against frost. As soon as the input b Frost is TRUE, r Y is set to the maximum size (r Range High) and i YTerminal to 32767. The outputs r Y and i YTerminal remain set until the input b Frost is once again FALSE. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; i YTerminal : INT; e State Mode Analog Output : E_HVACAnalog Output Mode; b Manual Mode : BOOL; by State : BYTE; b Error Feedb : BOOL; b Error General : BOOL; by Error : BYTE; b Invalid Parameter : BOOL; r Y: Shows the current magnitude of the control signal in % (0%..100%). i YTerminal: Represents the size of the output signal scaled to the value range 0 to 32767. e State Mode Analog Output: Enum that indicates the operation mode (see E_HVACAnalog Output Mode [} 488]). b Manual Mode: The analog output is in manual operation mode. by State: Status byte indicating the operating state of the function block. by State.0 := b Enable; by State.1 := b Manual Mode; by State.2 := b Frost; by State.7 := b Ctrl Voltage; b Error Feedb: Error feedback signal. b Error General: This is a collective message for all function block errors. by Error: Delivers all error messages and warnings. by Error.1 := b Invalid Parameter by Error.2 := b Error General by Error.3 := b Error Feedb b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Range High : REAL; r Range Low : REAL; b Direction : BOOL; b Enable Feedb Ctrl : BOOL; r Hysteresis Feedb Ctrl : REAL; t Delay Feedb Ctrl : TIME; TF8000 Version: 1.3.0 71
## Page 72

Programming r Range High/r Range Low: These two variables define the value range of r Y (0%..100%). The variable is saved persistently. Example: r Setpoint = 100, r Range Low = 0, r Range High = 200, ==> r Y = 50 ==> r YTerminal = 16384 r Setpoint = 200, r Range Low = 0, r Range High = 200, ==> r Y = 100 ==> r YTerminal = 32767 b Direction: The output signal of r Y is inverted by the variable b Direction. FALSE corresponds to the direct control direction. The variable is saved persistently. b Enable Feedb Ctrl: Analog actuators often have positional feedback. The function of the actuator is monitored by means of the positional feedback. Positional feedback monitoring is activated if the variable b Enable Feedb Ctrl is TRUE. The variable is saved persistently. r Hysteresis Feedb Ctrl: Due to the stroke time of typical drives used in heating and air conditioning systems, the positional feedback always lags in the case of a jump in the set position value. Using the variable r Hysteresis Feedb Ctrl, a range is specified within which the position setpoint r Y of the actuator may deviate from the feedback signal (0..32767). The variable is saved persistently. t Delay Feedb Ctrl: If the difference between the set position and the actual position of the actuator is greater than +/- r Hysteresis Feedb Ctrl, then the response of the output b Error Feedb is delayed by the time of the timer t Delay Feedb Ctrl [s] (0s..50s). The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.3.3 FB_HVACAnalog Output Ex/FB_HVACAnalog Output Ex2 This function block serves to control analog actuators, such as valves or dampers, with positional feedback. Unlike the FB_HVACAnalog Output [} 70], a scaling function is integrated in this function block. The function is: y=m*x+b. 72 Version: 1.3.0 TF8000
## Page 73

Programming The only difference between the function blocks FB_HVACAnalog Output Ex and FB_HVACAnalog Output Ex2 is that with FB_HVACAnalog Output Ex2 the control direction is queried after the response of b Frost. If the control direction is inverse, r Y is set to the smallest value. Application example: Damper actuator working range 2 to 10 V with the KL4404 (signal voltage 0 to 10 V) r X1 = 0 / i Y1 = 6553 r X2 = 100 / i Y2 = 32767 VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r Setpoint : REAL; b Ctrl Voltage : BOOL; e Ctrl Mode Analog Output: E_HVACAnalog Output Mode; r YManual : REAL; r Feedb : REAL; b Frost : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. TF8000 Version: 1.3.0 73
## Page 74

Programming A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If the function block is not enabled the value zero is output at the output r Y. r Setpoint: The setpoint for the analog output is transferred to the function block with the variable r Setpoint. b Ctrl Voltage: The control voltage is present if the b Ctrl Voltage variable is TRUE. The feedback control is deactivated in the event of failure of the control voltage so that no false alarms occur. e Ctrl Mode Analog Output: Enum that defines the operation mode (see E_HVACAnalog Output Mode [} 488]). TYPE E_HVACAnalog Output Mode : ( e HVACAnalog Output Mode_Auto_BMS := 0, e HVACAnalog Output Mode_Manual_BMS := 1, e HVACAnalog Output Mode_Auto_OP := 2, e HVACAnalog Output Mode_Manual_OP := 3 ); END_TYPE r YManual: Analog input value, which is relayed to the output r Y in manual mode. r Feedb: Analog positional feedback from the actuator. b Frost: This input serves to protect an air heater against frost. As soon as the input b Frost is TRUE, r Y is set to the maximum size (r Range High) and i YTerminal to 32767. The outputs r Y and i YTerminal remain set until the input b Frost is once again FALSE. With FB_HVACAnalog Output Ex2 the control direction is queried after the response of b Frost. If the control direction is inverse, r Y is set to the smallest value. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; i YTerminal : INT; e State Mode Analog Output : E_HVACAnalog Output Mode; b Manual Mode : BOOL; by State : BYTE; b Error Feedb : BOOL; b Error General : BOOL; by Error : BYTE; b Invalid Parameter : BOOL; r Y: Shows the current magnitude of the control signal in % (0%..100%). i YTerminal: Represents the size of the output signal scaled to the value range 0 to 32767. e State Mode Analog Output: Enum that indicates the operation mode (see E_HVACAnalog Output Mode [} 488]). b Manual Mode: The analog output is in manual operation mode. 74 Version: 1.3.0 TF8000
## Page 75

Programming by State: Status byte indicating the operating state of the function block. by State.0 := b Enable; by State.1 := b Manual Mode; by State.2 := b Frost; by State.7 := b Ctrl Voltage; b Error Feedb: Error feedback signal. b Error General: This is a collective message for all function block errors. by Error: Delivers all error messages and warnings. by Error.1 := b Invalid Parameter by Error.2 := b Error General by Error.3 := b Error Feedb b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r X2 : REAL; r X1 : REAL; i Y2 : INT; i Y1 : INT; b Direction : BOOL; b Enable Feedb Ctrl : BOOL; r Hysteresis Feedb Ctrl : REAL; t Delay Feedb Ctrl : TIME; r X2: Upper limit value on the X-axis (-32767..32767). The variable is saved persistently. r X1: Lower limit value on the X-axis (-32767..32767). The variable is saved persistently. r Y2: Upper limit value on the Y-axis (0..32767). The variable is saved persistently. r Y1: Lower limit value on the Y-axis (0..32767). The variable is saved persistently. b Direction: The output signal of r Y is inverted by the variable b Direction. FALSE corresponds to the direct control direction. The variable is saved persistently. b Enable Feedb Ctrl: Analog actuators often have positional feedback. The function of the actuator is monitored by means of the positional feedback. Positional feedback monitoring is activated if the variable b Enable Feedb Ctrl is TRUE. The variable is saved persistently. r Hysteresis Feedb Ctrl: Due to the stroke time of typical drives used in heating and air conditioning systems, the positional feedback always lags in the case of a jump in the set position value. Using the variable r Hysteresis Feedb Ctrl, a range is specified within which the position setpoint r Y of the actuator may deviate from the feedback signal (0..32767). The variable is saved persistently. t Delay Feedb Ctrl: If the difference between the set position and the actual position of the actuator is greater than +/- r Hysteresis Feedb Ctrl, then the response of the output b Error Feedb is delayed by the time of the timer t Delay Feedb Ctrl (0s..50s). The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 75
## Page 76

Programming 5.1.3.4 FB_HVACAnalog To3Point This function block serves to convert an analog control signal into a three-point step signal. Hence three- point dampers or valves can be controlled by a controller with a continuous control signal. The function block FB_HVACAnalog To3Point works with or without a continuous positional feedback signal from the drive. 76 Version: 1.3.0 TF8000
## Page 77

Programming Example: 3-Point-Actuator without feedback and limit switches VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r Setpoint : REAL; r Feedb : REAL; b Limit Switch Open : BOOL; b Limit Switch Close : BOOL; b Ctrl Voltage : BOOL; b Reset : BOOL; t Task Cycle Time : TIME; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. TF8000 Version: 1.3.0 77
## Page 78

Programming NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If control voltage is present and there are no errors and b Enable = FALSE, then the output b Close is TRUE and the output b Open is FALSE. If the reference mode e Referencing Mode = e HVACReferencing Mode_Emulation, then the output b Close remains set until either the limit switch is reached, the enable signal is present again or there is an error. If the reference mode e Referencing Mode = e HVACReferencing Mode_Analog Feedback, then the output b Close remains set until either the enable signal is present again, or there is a fault or r Feedback = r Min Setpoint. r Setpoint: The setpoint for the position of the damper or the valve is transferred to the function block with the variable r Setpoint. The value range for r Setpoint is specified by the parameters r Max Setpoint and r Min Setpoint (0.0..32767). If no correct variable value is present at r Setpoint, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues internally with r Min Setpoint. b Invalid Parameter will be set in the event of an incorrect variable value; the function block continues to work normally. r Feedb: The input variable r Feedb (0.0..32767) is only active if the referencing mode of the function block e Referencing Mode = e HVACReferencing Mode_Analog Feedback. The actual position of the drive is fed back with the scaled input signal r Feedb. The scaling of r Feedb must correspond to the scaling of r Setpoint. The value range for r Feedb is specified by the parameters r Max Setpoint and r Min Setpoint. r Feedb is feedback to the controller via the output variable r Position. If no correct variable value is present at r Feedb , then the last valid variable value, if one exists, will be taken. If no valid last value exists, operation continues internally with r Min Setpoint. b Invalid Parameter will be set in the event of an incorrect variable value; the function block continues to work normally. b Limit Switch Open/b Limit Switch Close: If the three-point actuator is equipped with limit switches, these can be connected to the inputs b Limit Switch Open and b Limit Switch Close. The limit switches serve as references for the function block in the referencing mode e Referencing Mode = e HVACReferencing Mode_Emulation. Depending on the direction of driving, the currently calculated position r Position is automatically set to the corresponding value of r Max Setpoint/r Min Setpoint by a falling edge on one of the two inputs b Limit Switch Open/b Limit Switch Close. This also takes place when the drive is at a standstill. Regardless of which referencing mode the function block is in, the associated output b Open or b Close remains at TRUE after the respective limit switch has been reached. The limit switches must be connected to the function block as normally closed contacts. If none exist, a TRUE must be applied to the two inputs b Limit Switch Open/b Limit Switch Close. b Ctrl Voltage: A check is made of whether control voltage is present via the input variable b Ctrl Voltage. Both b Open and b Close are set to FALSE in the event of failure of the control voltage. Since many error messages are based on the quiescent current principle, there would be a torrent of error messages following failure of the control voltage. Therefore all error messages are suppressed in the FB_HVACAnalog To3Point in the event of control voltage failure. The control voltage is present if a TRUE is present at the input b Ctrl Voltage. b Reset: Acknowledge input in the event of a fault. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. If an incorrect time value of T#0 s is present on t Task Cycle Time, then t Task Cycle Time is set internally to T#1 ms. b Invalid Parameter is set in the case of an incorrect variable value. VAR_OUTPUT b Open : BOOL; b Close : BOOL; by State : BYTE; r Position : REAL; b Error General : BOOL; 78 Version: 1.3.0 TF8000
## Page 79

Programming by Error : BYTE; b Error Limit Switch : BOOL; b Invalid Parameter : BOOL; b Open: Output for opening drive of the three-point actuator. b Close: Output for closing drive of the three-point actuator. by State: Status byte indicating the operating state of the function block. by State.0 := b Enable by State.1 := b Open by State.2 := b Close by State.3 := b Limit Switch Open by State.4 := b Limit Switch Close by State.7 := b Ctrl Voltage r Position: With r Position either the measured or the calculated position of the drive is fed back to the controller. If e Referencing Mode [} 491] = e HVACReferencing Mode_Analog Feedback, then r Feedb is fed back to the controller via the output variable r Position. If r Feedb > r Max Setpoint, then r Position = r Max Setpoint and b Invalid Parameter is set. If r Feedb < r Min Setpoint, then r Position = r Min Setpoint and b Invalid Parameter is set. If e Referencing Mode = e HVACReferencing Mode_Emulation, then the actual position of the drive will be emulated on the basis of a calculation and fed back to the controller via r Position. b Error General: The error message b Error General becomes TRUE as soon as b Error General Limit Switch = TRUE. The outputs b Open and b Close are then set to FALSE and are only enabled again when the error has been rectified and acknowledged via b Reset. by Error: Delivers all error messages and warnings from the function block by Error.1 := b Invalid Parameter by Error.2 := b Error General by Error.3 := b Error Limit Switch b Error Limit Switch: Becomes TRUE if both limit switches are activated simultaneously or if ((r Max Setpoint - r Threshold) < r Setpoint) and b Open = TRUE ) or if ((r Min Setpoint + r Threshold) > r Setpoint) and b Close = TRUE). The error b Error Limit Switch can only occur if e Referencing Mode = e Emulation. b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables r Min Setpoint, r Max Setpoint, r Threshold, r Tolerance, t Pause Min, t Pause Max, t Interval, t Stroke Time, t Switch Over Dead Time, e Referencing Mode, r Setpoint or r Feedback. An incorrect parameter entry does not lead to a standstill of the function block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. VAR_IN_OUT r Min Setpoint : REAL; r Max Setpoint : REAL; r Threshold : REAL; r Tolerance : REAL; t Pause Min : TIME; t Pause Max : TIME; t Interval : TIME; t Stroke Time : TIME; t Switch Over Dead Time : TIME; e Referencing Mode : E_HVACReferencing Mode; r Min Setpoint/r Max Setpoint: The value range for r Setpoint is specified by the parameters r Max Setpoint (0..32767) and r Min Setpoint (0..32767). r Max Setpoint must be greater than r Min Setpoint. In addition the two variables r Max Setpoint and r Min Setpoint are integrated in the calculation of the variable pulse/pause modulation; see fig. 1.1. If an incorrect variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the preset value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variables are saved persistently. r Min Setpoint preset to 0. r Max Setpoint preset to 100. TF8000 Version: 1.3.0 79
## Page 80

Programming r Threshold/r Tolerance: If the difference between the set position value r Setpoint and the calculated or measured actual position value r Position of the actuator is greater than the threshold value set by the variable r Threshold (0.001..32767), then the function block begins to correct the position by cycling the outputs b Open and b Close, depending on the control deviation value. Correction continues until the deviation is smaller than the value r Tolerance (0.001..32767). A hysteresis loop for the opening and closing movement of the drive is defined by the value of r Threshold – r Tolerance. This is necessary in order to prevent the drive reacting to the smallest changes of the control value. Wear on the drive and the relay is thus reduced. r Threshold must be greater than r Tolerance. r Setpoint - r Position > = r Threshold: b Open is activated r Position- r Setpoint > = r Threshold: b Close is activated If an incorrect variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the preset value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variables are saved persistently. r Threshold preset to 5.0. r Tolerance preset to 2.0. t Pause Min/t Pause Max/t Interval: A variable pulse/pause modulation for cycling the three-point actuator can be set with the parameters t Pause Min [s] (0..3600), t Pause Max [s] (0..3600) and t Interval [s] (0..3600). The pause length is defined as a function of the control deviation by the parameters t Pause Min and t Pause Max. In the case of a small deviation the pause time is long in relation to the interval time. Analogously, the pause time is short if the deviation is large. The effective driving speed of the three-point actuator is thus higher for larger control deviations than it is for smaller ones; see following fig. The following condition must be satisfied in all cases: t Pause Min < t Pause Max < t Interval If an incorrect variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the preset value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variables are saved persistently. t Pause Min preset to 2 s. t Pause Max preset to 8 s. t Interval preset to 10 s. t Stroke Time: The variable t Stroke Time [s] specifies the complete stroke time of the drive. If the drive has no continuous position feedback, the actual position of the drive will be emulated on the basis of a calculation. For this reason the precise input of the total stroke time of the actuator is important. The following condition must be satisfied in all cases: t Stroke Time > t Interval If an incorrect variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the preset value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 200 s. t Switch Over Dead Time: Dwell time when changing direction (0..3600). Both outputs are reset during this period. If an incorrect variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the preset value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 500 ms. e Referencing Mode: Enum that specifies the referencing mode of the function block (see E_HVACReferencing Mode [} 491]). Depending on the features of the actuator used, the position is referenced depending on e Referencing Mode. If e Referencing Mode = e HVACReferencing Mode_Emulation, the position of the drive will be calculated on the basis of the activation of b Open and b Close by means of t Stroke Time. However, as the operating hours of the three-point valve or three-point damper increase, deviations could occur due to mechanical inaccuracies in the drive. In order to achieve automatic matching of the actual and calculated positions, one of the outputs b Open or b Close will be set to TRUE upon reaching the calculated position r Position of r Max Setpoint or r Min Setpoint and it is correspondingly given the value of the parameter r Max Setpoint or r Min Setpoint. A falling edge on the signal inputs b Limit Switch Open and b Limit Switch Close is used to reference the position of the drive to r Max Setpoint or r Min Setpoint. The associated output b Open or b Close remains at TRUE after the respective limit switch has been reached. If e Referencing Mode = e HVACReferencing Mode_Analog Feedback, the position of the drive will be transferred on the basis of the signal r Feedback. The associated output b Open or b Close remains at TRUE after the respective limit switch has been reached. If an incorrect variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the preset value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 0. 80 Version: 1.3.0 TF8000
## Page 81

Programming Figure 1.1 Table 1: Example t Interval 120 seconds t Pause Min 10 seconds t Pause Max 60 seconds r Setpoint 100% r Position 50% t Pause Interval / b Close OR b Open 35 seconds/85 seconds r Setpoint 50% r Position 25% t Pause Interval / b Close OR b Open 47,5 seconds/72,5 seconds Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 81
## Page 82

Programming 5.1.3.5 FB_HVACConfigure KL32xx With the function block FB_HVACConfigure KL32xx, the type of sensor of a channel of the KL3201/02/04, the KL3208-0010 or the KL3228 can be set from the PLC. To do this, the variables by Status KL32xx, i Data In KL32xx, by Ctrl KL32xx and i Data Out KL32xx must be linked in the Twin CAT I/O area with the variables Status, Data In, Control and Data Out of a channel of the KL3201/02/04 or the KL3228. The resistor elements specified in Table 1 can be selected with the Enum e Sensor Type [} 492]. The KS2000 configuration software is no longer needed for setting the temperature sensor. When measuring resistances from 10 to 5000 Ω with the KL32xx, 1 digit = 0.5 Ω, i.e. the indicated raw value must be divided by 2 in the PLC. Example: 2500 Ω would be represented in the controller by a raw value of 5000. The raw value must be divided by 2 in the PLC in order to arrive at the ohmic value of 2500 Ω. The measurement of resistances from 10 to 10000 Ω is possible only with the special terminal KL320x-0027. Exclusively the resistance measurement 10...10000 Ω can be performed on this special terminal. The EL3692 Ether CAT Terminal is a resistance measurement terminal that covers the measuring range up to 10 MΩ. VAR_INPUT by Status KL32xx : BYTE; i Data In KL32xx : INT; b Set Sensor : BOOL; b Scan Sensor : BOOL; e Sensor Type : E_HVACSensor Type; t Time Out : TIME; by Status KL32xx: The status byte (Status) of the Bus Terminal must be assigned here in the Twin CAT I/O area for the respective channel. If this is not the case, then this is indicated as an error with b Error Communication if the function block has been activated with a rising edge on b Set Sensor/ b Scan Sensor. If scanning or setting has been concluded with a rising edge on b Set Sensor/b Scan Sensor, then this is indicated with a TRUE on b Ready and by Out Status: = by Status KL32xx. If scanning or setting is activated, b Ready = FALSE, then the value of by Status KL32xx present before activation is output on by Out Status. i Data In KL32xx: The raw value (Data In) of the Bus Terminal must be assigned here in the Twin CAT I/O area for the respective channel. If this is not the case, then this is indicated as an error with b Error Communication if the function block has been activated with a rising edge on b Set Sensor/ b Scan Sensor. If scanning or setting has been concluded with a rising edge on b Set Sensor/b Scan Sensor, then this is indicated with a TRUE on b Ready and i Out Data In: = i Data In KL32xx. If scanning or setting is activated, b Ready = FALSE, then the value of i Data In KL32xx present before activation is output on i Out Data In. 82 Version: 1.3.0 TF8000
## Page 83

Programming b Set Sensor: The type of sensor specified on the Enum e Sensor Type [} 492] is set in the Bus Terminal with a rising edge on b Set Sensor. If the procedure has been concluded, scanning is activated internally in the function block and the type of sensor that has been set is indicated via the Enum e Status Scan Sensor Type [} 492]. b Scan Sensor: The scanning of the respective channel of the Bus Terminal is activated by a rising edge on b Scan Sensor. The type of sensor that has been set is indicated via the Enum e Status Scan Sensor Type [} 492]. e Sensor Type: Enum with which the sensor type for the respective channel is specified for setting via b Set Sensor (see E_HVACSensor Type [} 492]). t Time Out: Specifies the time until the abortion of the function and b Error Communication goes TRUE. If no time is specified, then T#5s is used internally in the function block. VAR_OUTPUT b Ready : BOOL; by Out Status : BYTE; i Out Data In : INT; by Ctrl KL32xx : BYTE; i Data Out KL32xx : INT; e Bus Terminal KL32xx : E_HVACBus Terminal_KL32xx; e Status Scan Sensor Type : E_HVACSensor Type; b Error General : BOOL; by Error : BYTE; b Error Communication : BOOL; b Error Bus Terminal Not Supported: BOOL; b Error Sensor Type : BOOL; b Error Scan Sensor : BOOL; b Ready: If the function block is activated via a rising edge on b Set Sensor/b Scan Sensor, then b Ready goes FALSE. If scanning or the setting of the type of sensor has been concluded, then b Ready goes TRUE. by Out Status: If scanning or setting has been concluded with a rising edge on b Set Sensor/b Scan Sensor, then this is indicated with a TRUE on b Ready and by Out Status: = by Status KL32xx. If scanning or setting is activated, b Ready = FALSE, then the value of by Status KL32xx present before activation is output on by Out Status. i Out Data In: If scanning or setting has been concluded with a rising edge on b Set Sensor/b Scan Sensor, then this is indicated with a TRUE on b Ready and i Out Data In: = i Data In KL32xx. If scanning or setting is activated, b Ready = FALSE, then the value of i Data In KL32xx present before activation is output on i Out Data In. by Ctrl KL32xx: The control byte (Control) of the Bus Terminal must be assigned here in the Twin CAT I/O area for the respective channel. If this is not the case, then this is indicated as an error with b Error Communication if the function block has been activated with a rising edge on b Set Sensor/ b Scan Sensor. i Data Out KL32xx: The data output (Data Out) of the Bus Terminal must be assigned here in the Twin CAT System Manager for the respective channel. If this is not the case, then this is indicated as an error with b Error Communication if the function block has been activated with a rising edge on b Set Sensor/ b Scan Sensor. e Bus Terminal KL32xx: Enum that displays the type of Bus Terminal if the function block has been activated with a rising edge on b Set Sensor/b Scan Sensor (see E_HVACBus Terminal_KL32xx [} 488]). e Status Scan Sensor Type: Enum that displays the type of sensor for the respective channel if the function block has been activated with a rising edge on b Set Sensor/b Scan Sensor (see E_HVACSensor Type [} 492]). b Error General: Goes TRUE as soon as either b Error Communication, b Error Bus Terminal Not Supported, b Error Sensor Type or b Error Scan Sensor is TRUE. by Error: Delivers all error messages and warnings from the function block by Error.2 := b Error General; by Error.3 := b Error Communication; by Error.4 := b Error Bus Terminal Not Supported; by Error.5 := b Error Sensor Type; by Error.6 := b Error Scan Sensor; TF8000 Version: 1.3.0 83
## Page 84

Programming b Error Communication: Goes TRUE if, for example, the variables by Ctrl KL32xx, i Data Out KL32xx, by Status KL32xx and i Data In KL32xx have not been assigned to a channel of the Bus Terminal. Communication to the Bus Terminal is then interrupted during scanning or the setting of the type of sensor. b Error Communication likewise goes TRUE if the t Time Out time is not sufficient when scanning or setting the sensor types. b Error Bus Terminal Not Supported: Becomes TRUE if the Bus Terminal is not supported by the function block. b Error Sensor Type: Becomes TRUE if the type of sensor specified at e Sensor Type is not supported by the Bus Terminal. b Error Scan Sensor: Becomes TRUE if, when scanning, the type of sensor is not supported by the Bus Terminals specified in the Enum e Bus Terminal KL32xx. Types of sensor selectable via the Enum e Temperature Characteristic (see E_HVACBus Terminal_KL32xx [} 488]) Sen- KL3201/2/4-0 KL3201/2/4-0 KL3201/2/4-0 KL3201/2/4-0 KL3201/2/4-0 KL3201/2/4-0 sor 000 010 012 014 016 020 type Raw Raw Raw Raw Raw Raw value value value value value value PT100 x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C PT200 x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C PT500 x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C PT100 x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C 0 Ni100 x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C Ni120 x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C Ni100 x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C 0(DIN) Ni100 not not not not not not 0(Tk50 suppo suppo suppo suppo suppo suppo 00,LS) rted rted rted rted rted rted Resist x x x x x x ance measu remen t 10 ... 1200 Ω Resist x x x x x x ance measu remen t 10 ... 5000 Ω Resist not not not not not not ance suppo suppo suppo suppo suppo suppo measu rted rted rted rted rted rted remen t 10 ... 10000 Ω 84 Version: 1.3.0 TF8000
## Page 85

Programming Sen- KL3201/2/4-0 KL3201/2/4-0 KL3201/2/4-0 KL3201/2/4-0 KL3228 KL3208-0010 sor 023 025 029 031 type Raw Raw Raw Raw Raw Raw value value value value value value PT100 x 1/10°C x 1/10°C x 1/10°C x 1/10°C not not suppo suppo rted rted PT200 x 1/10°C x 1/10°C x 1/10°C x 1/10°C not not suppo suppo rted rted PT500 x 1/10°C x 1/10°C x 1/10°C x 1/10°C not not suppo suppo rted rted PT100 x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/100° 0 C Ni100 x 1/10°C x 1/10°C x 1/10°C x 1/10°C not not suppo suppo rted rted Ni120 x 1/10°C x 1/10°C x 1/10°C x 1/10°C not not suppo suppo rted rted Ni100 x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/10°C x 1/100° 0(DIN) C Ni100 not not x 1/10°C not x 1/10°C x 1/100° 0(Tk50 suppo suppo suppo C 00,LS) rted rted rted Resist x x x x not not ance suppo suppo measu rted rted remen t 10 ... 1200 Ω Resist x x x x not not ance suppo suppo measu rted rted remen t 10 ... 5000 Ω Resist not not not not not not ance suppo suppo suppo suppo suppo suppo measu rted rted rted rted rted rted remen t 10 ... 10000 Ω Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 85
## Page 86

Programming 5.1.3.6 FB_HVACScale A raw analog value is scaled to the specified measuring range and returned as the function value. If the raw value extends beyond the upper or lower measuring range, the corresponding limit value is output. There must be a difference of at least 0.01 between the upper and lower limit values for the raw data. If this is not the case, the lower limit value is output. The difference between the limits is necessary so as to avoid division by zero during the internal calculation of the linear equation. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; r Raw Data : REAL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. r Raw Data: Raw value from the terminal. 86 Version: 1.3.0 TF8000
## Page 87

Programming VAR_OUTPUT r Scaled Value : REAL; r Scaled Value: Scaled value. VAR_IN_OUT r Raw Data Low Off Limit : REAL; r Raw Data High Off Limit : REAL; r Scale Data Low Off Limit : REAL; r Scale Data High Off Limit : REAL; r Raw Data Low Off Limit: Lower limit for raw value. The variable is saved persistently. Preset to 0. r Raw Data High Off Limit: Upper limit for raw value. The variable is saved persistently. Preset to 32767. r Scale Data Low Off Limit: Lower limit of scaled measured value. The variable is saved persistently. Preset to 0. r Scale Data High Off Limit: Upper limit of scaled measured value. The variable is saved persistently. Preset to 100. Example in FBD: Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.3.7 FB_HVACScale_n Point Curves can be reproduced in the PLC with the function block FB_HVACScale_n Point. These can be, for example, positive or negative temperature coefficients (PTC/NTC). The analog raw resistance value of a PTC/NTC is applied to the input r X and output as a temperature value via the output r Y. The individual parameters and the number of individual points on the XY axis of the characteristic curve are specified by the structure st Parameter Scale_n Point [} 496]. Analog raw resistance values can be represented in the PLC with the KL32xx Bus Terminals. Detailed information can be found in the documentation on FB_HVACConfigure KL32xx [} 82]. When measuring resistances from 10 to 5000 Ω with the KL32xx, 1 digit = 0.5 Ω, i.e. the indicated raw value must be divided by 2 in the PLC. Example: 2500 Ω would be represented in the controller by a raw value of 5000. The raw value must be divided by 2 in the PLC in order to arrive at the ohmic value of 2500 Ω. TF8000 Version: 1.3.0 87
## Page 88

Programming The measurement of resistances from 10 to 10000 Ω is possible only with the special terminal KL320x-0027. Exclusively the resistance measurement 10...10000 Ω can be performed on this special terminal. The EL3692 Ether CAT Terminal is a resistance measurement terminal that covers the measuring range up to 10 MΩ. VAR_INPUT r X : REAL; st Parameter Scale_n Point : ST_HVACParameter Scale_n Point; r X: Raw value that scales to the indicated measured value of the structure st Parameter Scale_n Point [} 496] and is output via r Y. The raw value can be, for example, the raw resistance value of the KL32xx. The terminal must be set to resistance measurement for this. Detailed information on the procedure can be found in the documentation FB_HVACConfigure KL32xx [} 82]. st Parameter Scale_n Point: Structure via which the individual points of the XY coordinates are given their valency (see ST_HVACParameter Scale_n Point [} 496]). Regardless of which curve is to be reproduced, the following conditions must be met: either st Parameter Scale_n Point.r X[1] < st Parameter Scale_n Point.r X[2] < st Parameter Scale_n Point.r X[n] OR st Parameter Scale_n Point.r X[1] > st Parameter Scale_n Point.r X[2] > st Parameter Scale_n Point.r X[n]. st Parameter Scale_n Point.i Number Of Point must not be smaller than 2 OR larger than g_i Max No Of Scale_n Point(60). st Parameter Scale_n Point.r X[1..i Number Of Point] – array containing the valency of the individual points on the X axis. The number of points specified depends on i Number Of Point. st Parameter Scale_n Point.r Y[1 .. Number Of Point] – array containing the valency of the individual points on the Y axis. The number of points specified depends on i Number Of Point. VAR_OUTPUT r Y : REAL; st State Parameter Scale_n Point: ST_HVACParameter Scale_n Point; b Error Number Of Point : BOOL; b Error Parameter : BOOL; ui Error Position X_Parameter : INT; r Y: r Y is the scaled temperature value of the specified raw value r X. st State Parameter Scale_n Point: State of the structure st Parameter Scale_n Point. If b Error Number Of Point or b Error Paramter = TRUE, then the state of the individual parameters in the structure st State Parameter Scale_n Point = 0. If st Parameter Scale_n Point.i Numberof Point = 20, then the individual parameters of st State Parameter Scale_n Point.r X[1..20] / st State Parameter Scale_n Point.r Y[1..20] are displayed; from 21 to 60 the state = 0 (see ST_HVACParameter Scale_n Point [} 496]). b Error Number Of Point: Ifi Number Of Point < 2 or i Number Of Point > g_i Max No Of Scale_n Point, then b Error Number Of Point = TRUE and 0 is output at the output variable r Y. If the error has been rectified, then b Error Number Of Point goes FALSE. b Error Parameter: Care must be taken when parameterizing the structure st Parameter Scale_n Point [} 496] that either st Parameter Scale_n Point.r X[1] > st Parameter Scale_n Point.r X[2] > st Parameter Scale_n Point.r X[n] OR st Parameter Scale_n Point.r X[1] < st Parameter Scale_n Point.r X[2] < st Parameter Scale_n Point.r X[n]. If this is not adhered to, then b Error Parameter goes TRUE. If the error has been rectified, then b Error Parameter goes FALSE. The exact field position in the array st Parameter Scale_n Point.r X[ui Error Position X_Parameter] is specified via the output variables ui Error Position X_Parameter. ui Error Position X_Parameter: If b Error Parameter = TRUE, then the exact field position in the array st Parameter Scale_n Point.r X[ui Error Position X_Parameter] at which the error has occurred is indicated by ui Error Position X_Parameter. 88 Version: 1.3.0 TF8000
## Page 89

Programming VAR_GLOBAL CONSTANT g_i Max No Of Scale_n Point : INT := 60; g_i Max No Of Scale_n Point: Global constant that specifies the maximum number of points of the XY coordinates of the structure ST_HVACParameter Scale_n Point [} 496] (see Parameter [} 504]). Formulas for the linear equation, two-point form: m = gradient m = (Y2 - Y1) / (X2 - X1) m = (st Parameter Scale_n Point.r Y[2] - st Parameter Scale_n Point.r Y[1]) / (st Parameter Scale_n Point.r X[2] - st Parameter Scale_n Point.r X[1]) Y = Y1 + m * (X - X1) r Y = r Y[1] + m * (r X - st Parameter Scale_n Point.r X[1] Example curve 1 with calculation m = r M = slope X = r X = 1199.8 X2 = st Parameter Scale_n Point.r X[2] = 1209 X3 = st Parameter Scale_n Point.r X[3] = 1163 Y2 = st Parameter Scale_n Point.r Y[2] = 20 Y3 = st Parameter Scale_n Point.r Y[3] = 21 m = (Y3 - Y2) / (X3 - X2) r M = (st Parameter Scale_n Point.r Y[3] - st Parameter Scale_n Point.r Y[2]) / (st Parameter Scale_n Point.r X[3] - st Parameter Scale_n Point.r X[2]) r M = (21 - 20) / (1163 - 1209) = -0.02174 TF8000 Version: 1.3.0 89
## Page 90

Programming Y = Y2 + m * (X - X2) r Y = st Parameter Scale_n Point.r Y[2] + r M * (r X - st Parameter Scale_n Point.r X[2]) r Y = 20 + -0.02174 * (1199.8 - 1209) = 20.2 Example curve 2 with calculation m = r M = slope X = r X = 1124 X3 = st Parameter Scale_n Point.r X[2] = 1112 X4 = st Parameter Scale_n Point.r X[3] = 1142 Y3 = st Parameter Scale_n Point.r Y[2] = 20 Y4 = st Parameter Scale_n Point.r Y[3] = 25 m = (Y4 - Y3) / (X4 - X3) r M = (st Parameter Scale_n Point.r Y[4] - st Parameter Scale_n Point.r Y[3]) / (st Parameter Scale_n Point.r X[4] - st Parameter Scale_n Point.r X[3]) r M = (25 - 20) / 1142 - 1112) = 0.166 Y = Y3 + m * (X - X3) r Y = st Parameter Scale_n Point.r Y[3] + r M * (r X - st Parameter Scale_n Point.r X[3]) r Y = 20 + 0.166 * (1124 - 1112) = 21.992 90 Version: 1.3.0 TF8000
## Page 91

Programming Example curve 3 Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 91
## Page 92

Programming 5.1.3.8 FB_HVACScale XX Characteristic curves with 2, 4 or 7 interpolation points can be mapped with the function blocks FB_HVACScale02, FB_HVACScale04 and FB_HVACScale07 (shown here). The analog raw value is applied to the input Ir X and output as the calculated Y value at the output Ir Y. Different slopes of the characteristic curve can be specified in sections by specifying various interpolation points. The range is limited internally to the values lr Y01 and lr Y07 with the aid of the input b Lmt. VAR_INPUT lr X : LREAL; lr X0n : LREAL; lr Y0n : LREAL; b Lmt : BOOL; lr X: Applied raw value. lr X0n: X interpolation point of the characteristic curve. The characteristic curve has 2, 4 or 7 interpolation points, depending on the scaling function block. lr Y0n: X interpolation point of the characteristic curve. The characteristic curve has 2, 4 or 7 interpolation points, depending on the scaling function block. b Lmt: Input for limiting the output Y-range to values between lr Y01 and lr Y0n, depending on the maximum number of interpolation points. VAR_OUTPUT lr Y : LREAL; b Error : BOOL; e Error Code : E_HVACError Codes; udi Error Argument : UDINT; lr Y: Calculated Y-value of the characteristic curve. b Error: Incorrect entry of the X interpolation points. The values must be entered in ascending order. No two X-values may be the same. e Error Code: The error message e HVACError Codes_Err Idlr X0x [} 490] will be displayed. udi Error Argument: Indication of which interpolation point has been entered incorrectly. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 92 Version: 1.3.0 TF8000
## Page 93

Programming 5.1.3.9 FB_HVACTemperature Curve A temperature curve stored internally in the function block is selected from Tables 1 and 2 via the Enum e Temperature Curve [} 494] and output via the structure st Parameter Scale_n Point. Characteristic curves can then be reproduced with this structure in conjunction with the function block FB_HVACScale_n Point [} 87]. In order to arrive at the raw resistance value of a sensor, the KL32xx Bus Terminals must be set to resistance measurement; see FB_HVACConfigure KL32xx [} 82]. When measuring resistances from 10 to 5000 Ω with the KL32xx, 1 digit = 0.5 Ω, i.e. the indicated raw value must be divided by 2 in the PLC. Example: 2500 Ω would be represented in the controller by a raw value of 5000. The raw value must be divided by 2 in the PLC in order to arrive at the ohmic value of 2500 Ω. The measurement of resistances from 10 to 10000 Ω is possible only with the special terminal KL320x-0027. Exclusively the resistance measurement 10...10000 Ω can be performed on this special terminal. The EL3692 Ether CAT Terminal is a resistance measurement terminal that covers the measuring range up to 10 MΩ. VAR_INPUT e Temperature Curve : E_HVACTemperature Curve; e Temperature Curve: Enum via which a temperature curve stored internally in the function block can be selected from Tables 1 and 2 (see E_HVACTemperature Curve [} 494]). VAR_OUTPUT st Parameter Scale_n Point : ST_HVACParameter Scale_n Point; st Parameter Scale_n Point: Structure containing the number and valences of the points of the XY coordinates (see ST_HVACParameter Scale_n Point [} 496]). st Parameter Scale_n Point contains the curves stored in Tables 1 and 2, depending on the specification via the Enum e Temperature Curve. Example: e Temperature Curve = e HVACTemperature Curve_Ni1000Tk5000_TCR st Parameter Scale_n Point.i Number Of Point := 56; st Parameter Scale_n Point.r X[1] := 790.8; st Parameter Scale_n Point.r Y[1] := -50.0; st Parameter Scale_n Point.r X[2] := 826.8; st Parameter Scale_n Point.r Y[2] := -40.0; st Parameter Scale_n Point.r X[56] :=1625.4; st Parameter Scale_n Point.r Y[56] := 120.0; st Parameter Scale_n Point.r X[57] :=0; st Parameter Scale_n Point.r Y[57] := 0; st Parameter Scale_n Point.r X[60] :=0; st Parameter Scale_n Point.r Y[60] := 0; TF8000 Version: 1.3.0 93
## Page 94

Programming Specified temperature curves, selectable via the Enum e Temperature Curve 94 Version: 1.3.0 TF8000
## Page 95

Programming S+S S+S S+S S+S S+S S+S S+S Sensor Sensor Sensor Sensor Sensor Sensor Sensor type type type type type type type 1.8K3 A1 2.2K3 A1 3.3K3 A1 NI1000 PT1000 Ni1000/TCR 1K3 A1 NTC 1.8 NTC 2.2 NTC 3 DIN DIN (LAN1) NTC 1 k Ohm k Ohm k Ohm k Ohm Ni1000Tk50 00 e HVACTem-NTC1k_3_A NTC1k8_3_ NTC2k2_3_ NTC3k3_3_ Ni1000_DIN Pt1000_DIN Ni1000Tk50 pera- 1 A1 A1 A1 00_TCR ture Charac- teristic_ °C Ω Ω Ω Ω Ω Ω Ω - 50 32886 743 803 790.8 - 40 18641 791 843 826.8 - 30 11130 21695 27886 53093 842 882 871.7 - 20 6777 12987 16502 29125 893 922 913.4 - 15 5341 10153 12844 21887 920 941 934.7 - 10 4247 8011 10070 16599 946 961 956.2 - 5 3390 6347 8134 12698 973 980 978 0 2728 5071 6452 9795 1000 1000 1000 1 2613 4851 6164 9309 1004.4 2 2503 4640 5891 8849 1008.9 3 2399 4441 5631 8415 1013.3 4 2300 4252 5384 8005 1017.8 5 2205 4071 5150 7617 1028 1020 1022.3 6 2115 3899 4927 7251 1026.7 7 2030 3738 4715 6905 1031.2 8 1948 3582 4513 6575 1035.8 9 1870 3434 4321 6265 1040.3 10 1796 3294 4138 5971 1056 1039 1044.8 11 1724 3158 3964 5691 1049.3 12 1656 3029 3797 5427 1053.9 13 1590 2905 3639 5177 1058.4 14 1528 2788 3488 4938 1063 15 1469 2677 3345 4713 1084 1058 1067.6 16 1412 2570 3207 4500 1072.2 17 1358 2468 3076 4298 1076.8 18 1306 2371 2952 4104 1081.4 19 1256 2277 2832 3922 1086 20 1209 2189 2719 3747 1112 1078 1090.7 21 1163 2103 2610 3582 1095.3 22 1120 2023 2506 3426 1100 23 1078 1945 2407 3277 1104.6 24 1038 1871 2289 3135 1109.3 25 1000 1800 2200 3000 1142 1098 1114 26 963 1732 2115 2872 1120 27 928 1667 2034 2750 1123.4 28 894 1604 1957 2634 1128.1 29 862 1545 1883 2522 1132.9 30 831 1488 1812 2417 1171 1117 1137.6 TF8000 Version: 1.3.0 95
## Page 96

Programming S+S S+S S+S S+S S+S S+S S+S Sensor Sensor Sensor Sensor Sensor Sensor Sensor type type type type type type type 1.8K3 A1 2.2K3 A1 3.3K3 A1 NI1000 PT1000 Ni1000/TCR 1K3 A1 NTC 1.8 NTC 2.2 NTC 3 DIN DIN (LAN1) NTC 1 k Ohm k Ohm k Ohm k Ohm Ni1000Tk50 00 e HVACTem-NTC1k_3_A NTC1k8_3_ NTC2k2_3_ NTC3k3_3_ Ni1000_DIN Pt1000_DIN Ni1000Tk50 pera- 1 A1 A1 A1 00_TCR ture Charac- teristic_ °C Ω Ω Ω Ω Ω Ω Ω 35 694 1235 1500 1960 1200 1136 1161.5 40 583 1031 1248 1597 1230 1155 1185.7 45 491 865 1043 1310 1261 1175 1210.2 50 416 729 876 1081 1291 1194 1235 55 354 616 738 896 1322 1213 1260.1 60 302 524 626 746 1353 1232 1285.4 65 259 447 532 625 1385 1252 1311.1 70 223 383 454 526 1417 1271 1337.1 75 192 329 390 444 1450 1290 1363.5 80 167 284 335 346 1483 1309 1390.1 85 145 246 289 321 1516 1328 1417.1 90 127 214 251 275 1549 1347 1444.4 95 111 187 218 236 1584 1366 1472 100 97 163 190 204 1618 1385 1500 105 88 143 167 176 1528.3 110 76 126 146 138 1688 1423 1557 115 111 120 1586 120 99 105 1760 1461 1625.4 125 88 92 130 80 81 1833 1498 140 62 64 1909 1536 150 50 50 1987 1573 160 2066 1611 170 2148 1648 180 2232 1685 190 1722 200 1758 210 1795 220 1832 230 1868 240 1905 250 1941 260 1977 270 2013 280 2049 290 2085 300 2121 310 2156 96 Version: 1.3.0 TF8000
## Page 97

Programming S+S S+S S+S S+S S+S S+S S+S Sensor Sensor Sensor Sensor Sensor Sensor Sensor type type type type type type type 1.8K3 A1 2.2K3 A1 3.3K3 A1 NI1000 PT1000 Ni1000/TCR 1K3 A1 NTC 1.8 NTC 2.2 NTC 3 DIN DIN (LAN1) NTC 1 k Ohm k Ohm k Ohm k Ohm Ni1000Tk50 00 e HVACTem-NTC1k_3_A NTC1k8_3_ NTC2k2_3_ NTC3k3_3_ Ni1000_DIN Pt1000_DIN Ni1000Tk50 pera- 1 A1 A1 A1 00_TCR ture Charac- teristic_ °C Ω Ω Ω Ω Ω Ω Ω 320 2191 330 2227 340 2262 350 2297 360 2332 370 2367 380 2401 390 2436 400 2470 TF8000 Version: 1.3.0 97
## Page 98

Programming Specified temperature curves, selectable via the Enum e Temperature Curve Thermokon Thermokon Sensor type Sensor type Ni1000 Tk5000 NTC 1.8 k Ohm e HVACTemperature Characteris- NTC1K8 Ni1000Tk5000 tic_ °C Ω Ω - 50 790.88 - 40 830.83 - 30 24500 871.69 - 20 14000 913.48 - 10 8400 956.24 0 5200 1000 10 3330 1044.79 20 2200 1090.65 25 1800 1113.99 30 1480 1137.61 40 1040 1185.71 50 740 1234.97 60 540 1285.44 70 402 1337.14 80 306 1390.12 90 240 1444.39 100 187 1500 110 149 1556.98 120 118 1615.36 130 95 1675.18 140 77 1736.47 150 64 1799.26 Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 98 Version: 1.3.0 TF8000
## Page 99

Programming 5.1.3.10 FB_HVACTemperature Sensor This function block serves the acquisition and further processing of temperature values for sensor types PT100, PT200, PT1000, NI100, NI120 and NI1000. The function block FB_HVACTemperature Sensor is matched to the KL320x bus terminals. These Bus Terminals can either be ordered preconfigured or set to the corresponding sensor types in the software. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; i Raw Value : INT; by Status Raw Value : BYTE; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; b Enable Limit Ctrl : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. i Raw Value: Raw value of the temperature sensor in 1/10°C from the bus terminal by Status Raw Value: Status byte of the temperature sensor from the bus terminal. Serves for fault diagnosis, e.g. wire breakage or short circuit. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the cycle time of the calling task. t Task Cycle Time must be longer than T#0ms. TF8000 Version: 1.3.0 99
## Page 100

Programming t Ctrl Cycle Time: The variable t Ctrl Cycle Time specifies the cycle time with which the 2nd order filter is processed internally. The cycle time t Ctrl Cycle Time must be greater than or equal to t Task Cycle Time. If this is not the case, an error b Error Cycle Time occurs and either the replacement value r Replacement Value or the last valid measured value will be output at r Present Value, depending on the mode e Temperature Sensor Mode that is set. b Enable Limit Ctrl: Enables r High Limit and r Low Limit for limit monitoring b Reset: Acknowledge input in the event of an error. In addition the 2nd order filter can be synchronized via this input to the present measuring signal, so that this can be output at r Present Value. VAR_OUTPUT r Present Value : REAL; b Error General : BOOL; by Error : BYTE; b Error Short Circuit : BOOL; b Error Broken Sensor : BOOL; b Error High Limit : BOOL; b Error Low Limit : BOOL; b Error Cycle Time : BOOL; b Invalid Parameter : BOOL; r Present Value: Temperature output variable with one decimal place, r Present Value = (i Raw Value / 10.0) + r Offset, if b Error Short Circuit or b Error Broken Sensor = TRUE, then r Present Value depends on the operation mode e Temperature Sensor Mode. b Error General: The error message b Error General becomes TRUE as soon as one of the error messages b Error High Limit, b Error Low Limit, b Error Cycle Time, b Error Short Circuit or b Error Broken Sensor = TRUE. The value of the output variable r Present Value is then dependent on the operation mode e Temperature Sensor Mode and is enabled once the error has been rectified and, depending on the operation mode, acknowledged with b Reset. by Error: Delivers all error messages and warnings, by Error.1 := b Invalid Parameter by Error.2 := b Error General by Error.3 := b Error High Limit by Error.4 := b Error Low Limit by Error.5 := b Error Short Circuit by Error.6 := b Error Broken Sensor by Error.7 := b Error Cycle Time b Error Short Circuit: Error, short circuit in the connected temperature sensor. After rectification of the error, acknowledgment depends on the operation mode. b Error Broken Sensor: Error, wire breakage in the connected temperature sensor. After rectification of the error, acknowledgment depends on the operation mode. b Error High Limit: Warning upper limit value exceeded; becomes TRUE if r Present Value >= r High Limit. The warning that the upper limit value has been exceeded can only be acknowledged if r Present Value <= r High Limit -1.0 for a period of 5 seconds. b Error Low Limit: Warning: lower limit value undershot; goes TRUE if r Present Value <= r Low Limit. The warning that the lower limit value has been undershot can only be acknowledged if r Present Value >= r Low Limit +1.0 for a period of 5 seconds b Error Cycle Time: Error caused by an incorrect time input at the input variables t Task Cycle Time and t Ctrl Cycle Time, which must be acknowledged after correcting the error. b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables r Offset, r High Limit, r Low Limit, r Replacement Value, t Filter Time or e Temperature Sensor Mode. An incorrect parameter specification does not lead to a standstill of the function block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. VAR_IN_OUT r Offset : REAL; r High Limit : REAL; r Low Limit : REAL; 100 Version: 1.3.0 TF8000
## Page 101

Programming r Replacement Value : REAL; t Filter Time : TIME; e Temperature Sensor Mode : E_HVACTemperature Sensor Mode; r Offset: Temperature compensation in Kelvin (-50..+50), r Present Value = (i Raw Value / 10.0) + r Offset. The variable is saved persistently. Preset to 0. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. r High Limit: Upper limit value (-250..+850); the output b Error High Limit is set if r Present Value >= r High Limit. r High Limit must be greater than r Low Limit. The variable is saved persistently. Preset to 120. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. r Low Limit: Lower limit value (-250..+850); the output b Error Low Limit is set if r Present Value <= r Low Limit. The variable is saved persistently. Preset to -60. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. r Replacement Value: Replacement value (-250..+850) that is output at r Present Value in the case of the errors b Error Short Circuit and b Error Broken Sensor if the selected operation mode e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Replacement Value or e HVACTemperature Sensor Mode_Auto Reset Replacement Value. The variable is saved persistently. Preset to 0. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. t Filter Time: Filter constant (1ms..100s). To avoid large fluctuations and jumps in the measuring signal, the function block is provided with a 2nd order filter. Upon a restart of the controller, or following correction of the error b Error Short Circuit or b Error Broken Sensor, the 2nd order filter is synchronized immediately and additionally after 2 seconds with the present measuring signal, so that the latter is output at r Present Value. The measuring signal can be synchronized via the input b Reset during running operation. The variable is saved persistently. Preset to 10 s. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. e Temperature Sensor Mode: Enum that specifies the operation mode of the function block (see E_HVACTemperature Sensor Mode [} 494]). The variable is saved persistently. Preset to 3. e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Replacement Value: If b Error Short Circuit or b Error Broken Sensor = TRUE, then r Present Value = r Replacement Value. After correction of the error, the function block must be acknowledged with a rising edge at the input variable b Reset. e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Last Value: If b Error Short Circuit or b Error Broken Sensor = TRUE, then the last valid temperature value that was present 10 seconds previously is output at r Present Value. After correction of the error, it must be acknowledged with a rising edge at the input variable b Reset. e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Auto Reset Replacement Value : If b Error Short Circuit or b Error Broken Sensor = TRUE, then r Present Value = r Replacement Value. The function block acknowledges itself automatically following correction of the error. e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Auto Reset Last Value: If b Error Short Circuit or b Error Broken Sensor = TRUE, then the last valid temperature value that was present 10 seconds previously is output at r Present Value. The function block acknowledges itself automatically following correction of the error. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. TF8000 Version: 1.3.0 101
## Page 102

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.3.11 FB_HVACTemperature Sensor Ex This function block is used for the acquisition and subsequent processing of temperature values, e.g. for the sensor types PT100, PT200, PT1000, NI100, NI120, NI1000, NI1000Tk5000. The function block FB_HVACTemperature Sensor Ex is adapted to the Bus Terminals KL3201/02/04 and KL3228. These Bus Terminals can either be ordered preconfigured or set to the respective sensor type via the software. The raw temperature value is transferred to the function block in 1/10 °C via the input variable i Raw Value and output as a floating point number via r Present Value . i Raw Value, for example, can be linked directly with the raw temperature value of the following Bus Terminals: KL3201/02/04 and KL3228. The output value r Present Value depends on the following smoothing function: r Present Value := ((i Raw Value / 10 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; r Present Value Old is the value of r Present Value that was output in the previous PLC cycle. If b Enable goes TRUE, then r Present Value = r Present Value Old for one PLC cycle. If b Error Sensor = TRUE, the error has been corrected and b Error Sensor = FALSE, then r Present Value = r Present Value Old for one PLC cycle. The state of the connected temperature sensor is monitored via the input variable by Status Raw Value and returned to the controller via the variable b Error Sensor in the event of an error. by Status Raw Value can be linked, for example, directly with the status byte of the following Bus Terminals: KL3201/02/04 and KL3228. r High Limit/r Low Limit can be used to specify temperature limit values. In contrast to the FB_HVACTemperature Sensor [} 99] this function block has the input variable b Enable, which is useful if the characteristic sensor curves in the Bus Terminals KL3201/02/04 and KL3228 are to be set from the PLC via the function block FB_HVACConfigure KL32xx [} 82]. In this function block the second order filter in FB_HVACTemperature Sensor [} 99] is replaced by the smoothing function described above. The output b Error Sensor is new and replaces the two outputs b Error Short Circuit/b Error Broken Sensor. These outputs continue to be available in the error byte by Error. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; i Raw Value : INT; by Status Raw Value : BYTE; b Enable Limit Ctrl : BOOL; b Reset : BOOL; 102 Version: 1.3.0 TF8000
## Page 103

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If b Enable = FALSE, the value of r Replacement Value is output at the r Present Value output. All error messages and b Invalid Parameter are set to FALSE. If b Enable goes TRUE, then r Present Value = r Present Value Old for one PLC cycle. i Raw Value: Raw value of the temperature sensor in 1/10°C from the bus terminal. by Status Raw Value: Status byte of the temperature sensor from the bus terminal. Serves for fault diagnosis, e.g. wire breakage or short circuit. If the KL32xx is set to resistance measurement (Ω) there is no fault diagnosis. b Enable Limit Ctrl: Enables r High Limit and r Low Limit for limit monitoring b Reset: Acknowledgement input in the event of an error with rising edge from b Reset. Depending on mode e Temperature Sensor Mode [} 494], errors are acknowledged either with b Reset or automatically. VAR_OUTPUT r Present Value : REAL; b Error General : BOOL; by Error : BYTE; b Error Sensor : BOOL; b Error High Limit : BOOL; b Error Low Limit : BOOL; b Invalid Parameter : BOOL; r Present Value: Temperature output variable with one decimal place. The value for r Present Value is calculated and output according to the following formula: r Present Value := ((i Raw Value / 10 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; r Present Value Old is the value of r Present Value that was output in the previous PLC cycle. If b Enable goes TRUE, then r Present Value = r Present Value Old for one PLC cycle. If b Error Sensor = TRUE, the error has been corrected and b Error Sensor = FALSE, then r Present Value = r Present Value Old for one PLC cycle. If b Error Sensor = TRUE, the value of r Present Value depends on the operation mode e Temperature Sensor Mode [} 494]. b Error General: The error message b Error General becomes TRUE if one of the error messages b Error High Limit, b Error Low Limit or b Error Sensor is TRUE. The value of the output variable r Present Value is then dependent on the operation mode e Temperature Sensor Mode [} 494] and is enabled once the error has been rectified and, depending on the operation mode e Temperature Sensor Mode [} 494], acknowledged with b Reset. TF8000 Version: 1.3.0 103
## Page 104

Programming by Error: Delivers all error messages and warnings, by Error.1 := b Invalid Parameter by Error.2 := b Error General by Error.3 := b Error High Limit by Error.4 := b Error Low Limit by Error.5 := b Error Short Circuit by Error.6 := b Error Broken Sensor by Error.7 := b Error Sensor by Error.5 := b Error Short Circuit: Error, short circuit in the connected temperature sensor. Once the fault has been corrected, the message is acknowledged either with b Reset or automatically, depending on mode e Temperature Sensor Mode [} 494]. by Error.6 := b Error Broken Sensor: Error, wire breakage in the connected temperature sensor. Once the fault has been corrected, the message is acknowledged either with b Reset or automatically, depending on mode e Temperature Sensor Mode [} 494]. b Error Sensor: Becomes TRUE if by Error.5/b Error Short Circuit or by Error.6/b Error Broken Sensor is TRUE. Once the fault has been corrected, the message is acknowledged either with b Reset or automatically, depending on mode e Temperature Sensor Mode [} 494]. If b Error Sensor = TRUE, the error has been corrected and b Error Sensor = FALSE, then r Present Value = r Present Value Old for one PLC cycle. b Error High Limit: Warning upper limit value exceeded; becomes TRUE if r Present Value >= r High Limit. The warning that the upper limit value has been exceeded can only be acknowledged if r Present Value <= r High Limit -1.0 for a period of 5 seconds. Depending on mode e Temperature Sensor Mode [} 494], the warning is acknowledged either with b Reset or automatically. b Error Low Limit: Warning: lower limit value undershot; goes TRUE if r Present Value <= r Low Limit. The warning that the lower limit value has been undershot can only be acknowledged if r Present Value >= r Low Limit +1.0 for a period of 5 seconds. Depending on mode e Temperature Sensor Mode, the warning is acknowledged either with b Reset or automatically. b Invalid Parameter: Indicates that there is an incorrect parameter to one of the variables r High Limit, r Low Limit, r Smooth Factor or e Temperature Sensor Mode [} 494]. An incorrect parameter specification does not lead to a standstill of the function block; see description of variables. Once the incorrect parameter specification has been corrected, the message b Invalid Parameter is acknowledged either with b Reset or automatically, depending on mode e Temperature Sensor Mode [} 494]. VAR_IN_OUT r Offset : REAL; r High Limit : REAL; r Low Limit : REAL; r Replacement Value : REAL; r Smooth Factor : REAL; e Temperature Sensor Mode: E_HVACTemperature Sensor Mode; r Offset: Temperature compensation in Kelvin, r Present Value = (i Raw Value / 10.0) + r Offset. The variable is saved persistently. Preset to 0. r High Limit: Upper limit value. If r Present Value >= r High Limit , then output b Error High Limit is set. r High Limit must be greater than r Low Limit. The variable is saved persistently. Preset to 120. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. r Low Limit: Lower limit value. If r Present Value <= r Low Limit , then output b Error Low Limit is set. The variable is saved persistently. Preset to -60. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. r Replacement Value: Replacement value that is output at r Present Value in the case of the error b Error Short Circuit and b Error Broken Sensor if the selected operation mode e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Replacement Value or e HVACTemperature Sensor Mode_Auto Reset Replacement Value. The variable is saved persistently. Preset to 0. 104 Version: 1.3.0 TF8000
## Page 105

Programming r Smooth Factor: Smoothing factor (>= 1) for the output value r Present Value. The variable is saved persistently. Preset to 100. The value for r Present Value is calculated and output according to the following formula: r Present Value := ((i Raw Value / 10 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; r Present Value Old is the value of r Present Value that was output in the previous PLC cycle. If r Smooth Factor = 1, then r Present Value := ((i Raw Value / 10 + r Offset) If an incorrect variable value is present at r Smooth Factor , then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. e Temperature Sensor Mode: Enum that specifies the operation mode of the function block (see E_HVACTemperature Sensor Mode [} 494]). e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Replacement Value: If b Error Sensor = TRUE, then r Present Value = r Replacement Value. After correction of the error, the function block must be acknowledged with a rising edge at the input variable b Reset. e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Last Value: If b Error Sensor = TRUE, then the last valid temperature value that was present 10 seconds before is output at the output variable r Present Value. After correction of the error, it must be acknowledged with a rising edge at the input variable b Reset. e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Auto Reset Replacement Value : If b Error Short Circuit or b Error Broken Sensor = TRUE, then r Present Value = r Replacement Value. The function block acknowledges itself automatically following correction of the error. e Temperature Sensor Mode = e HVACTemperature Sensor Mode_Auto Reset Last Value: If b Error Sensor = TRUE, then the last valid temperature value that was present 10 seconds before is output at the output variable r Present Value. The function block acknowledges itself automatically following correction of the error. If an incorrect variable value is present at e Temperature Sensor Mode, the default value is used. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 3. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.3.12 FB_HVACTemperature Sensor Ex This function block is used for the acquisition and subsequent processing of temperature values, e.g. for the sensor types PT100, PT200, PT1000, NI100, NI120, NI1000, NI1000Tk5000. The function block FB_HVACTemperature Sensor Ex2 is tailored to the Bus Terminals KL3201/02/04, KL3222, KL3228 and KL3208-0010. These Bus Terminals can either be ordered preconfigured or set to the respective sensor type via the software. The raw temperature value is transferred either in 1/10 or 1/100 °C to the function block via the input variable TF8000 Version: 1.3.0 105
## Page 106

Programming i Raw Value and output via r Present Value as a floating point number. i Raw Value, for example, can be linked directly with the raw temperature value of the following Bus Terminals: KL3201/02/04, KL3222, KL3228 and KL3208-0010. The output value r Present Value depends on one of the following two smoothing functions: i Conversion Factor = 0: r Present Value := ((i Raw Value / 10 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; i Conversion Factor = 1: r Present Value := ((i Raw Value / 100 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; r Present Value Old is the value of r Present Value that was output in the previous PLC cycle. If b Enable goes TRUE, then r Present Value = r Present Value Old for one PLC cycle. If b Error Sensor = TRUE, the error has been corrected and b Error Sensor = FALSE, then r Present Value = r Present Value Old for one PLC cycle. The state of the connected temperature sensor is monitored via the input variable by Status Raw Value and returned to the controller via the variable b Error Sensor in the event of an error. by Status Raw Value can be linked, for example, directly with the status byte of the following Bus Terminals: KL3201/02/04, KL3222, KL3228 and KL3208-0010. r High Limit/r Low Limit can be used to specify temperature limit values. Unlike FB_HVACTemperature Sensor [} 99], this function block has the input variable b Enable, which is useful when the sensor characteristic curves in the Bus Terminals KL3201/02/04, KL3222, KL3228 and KL3208-0010 are to be adjusted from the PLC via the function block FB_HVACConfigure KL32xx [} 82]. In this function block the second order filter in FB_HVACTemperature Sensor [} 99] is replaced by the smoothing function described above. The output b Error Sensor is new and replaces the two outputs b Error Short Circuit/ b Error Broken Sensor. However, these outputs still exist in the error byte udi Error. Unlike FB_HVACTemperature Sensor Ex [} 102], sensors with the raw temperature value 1/10 or 1/100 °C can be transferred on this function block. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; i Raw Value : INT; by Status Raw Value : BYTE; i Conversion Factor : INT; b Enable Limit Ctrl : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. 106 Version: 1.3.0 TF8000
## Page 107

Programming b Enable: The function block is enabled if b Enable = TRUE. If b Enable = FALSE, the value of r Replacement Value is output at the r Present Value output. All error messages and b Invalid Parameter are set to FALSE. If b Enable goes TRUE, then r Present Value = r Present Value Old for one PLC cycle. i Raw Value: Raw value of the temperature sensor in 1/10 or 1/100 °C from the bus terminal. by Status Raw Value: Status byte of the temperature sensor from the bus terminal. Serves for fault diagnosis, e.g. wire breakage or short circuit. If the KL32xx is set to resistance measurement (Ω) there is no fault diagnosis. i Conversion Factor: Conversion factor (0..1) for the output value r Present Value. i Conversion Factor = 0: r Present Value := ((i Raw Value / 10 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; i Conversion Factor = 1: r Present Value := ((i Raw Value / 100 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; If a value outside its range of 0 to 1 is specified at i Conversion Factor, this is signaled by b Error Conversion Factor = TRUE. b Enable Limit Ctrl: Enables r High Limit and r Low Limit for limit monitoring b Reset: Acknowledgement input in the event of an error with rising edge at b Reset. Depending on mode i Temperature Sensor Mode, errors are acknowledged either with b Reset or automatically. VAR_OUTPUT r Present Value : REAL; b Error General : BOOL; udi Error : UDINT; b Error Sensor : BOOL; b Error High Limit : BOOL; b Error Low Limit : BOOL; b Error Conversion Factor : BOOL; b Invalid Parameter : BOOL; r Present Value: Temperature output variable with two decimal places. The value for r Present Value is calculated and output according to the following formula: i Conversion Factor = 0: r Present Value := ((i Raw Value / 10 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; i Conversion Factor = 1: r Present Value := ((i Raw Value / 100 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; r Present Value Old is the value of r Present Value that was output in the previous PLC cycle. If b Enable goes TRUE, then r Present Value = r Present Value Old for one PLC cycle. If b Error Sensor = TRUE, the error has been corrected and b Error Sensor = FALSE, then r Present Value = r Present Value Old for one PLC cycle. If b Error Sensor = TRUE, the value of r Present Value depends on the operation mode i Temperature Sensor Mode. b Error General: The error message b Error General becomes TRUE if one of the error messages b Error High Limit, b Error Low Limit or b Error Sensor is TRUE. The value of the output variable r Present Value is then dependent on the operation mode i Temperature Sensor Mode and is enabled once the error has been corrected and, depending on the operation mode i Temperature Sensor Mode, acknowledged with b Reset. udi Error: Delivers all error messages and warnings, udi Error.1 := b Invalid Parameter udi Error.2 := b Error General udi Error.3 := b Error High Limit udi Error.4 := b Error Low Limit udi Error.5 := b Error Short Circuit udi Error.6 := b Error Broken Sensor udi Error.7 := b Error Sensor udi Error.8 := b Error Conversion Factor TF8000 Version: 1.3.0 107
## Page 108

Programming by Error.5 := b Error Short Circuit: Error, short circuit in the connected temperature sensor. Once the fault has been corrected, the message is acknowledged either with b Reset or automatically, depending on mode i Temperature Sensor Mode. by Error.6 := b Error Broken Sensor: error, wire breakage in the connected temperature sensor. Once the fault has been corrected, the message is acknowledged either with b Reset or automatically, depending on mode i Temperature Sensor Mode. b Error Sensor: Goes TRUE if by Error.5 / b Error Short Circuit or by Error.6 / b Error Broken Sensor = TRUE. Once the fault has been corrected, the message is acknowledged either with b Reset or automatically, depending on mode i Temperature Sensor Mode. If b Error Sensor = TRUE, the error has been corrected and b Error Sensor = FALSE, then r Present Value = r Present Value Old for one PLC cycle. b Error High Limit: Warning upper limit value exceeded; becomes TRUE if r Present Value >= r High Limit. The warning that the upper limit value has been exceeded can only be acknowledged if r Present Value <= r High Limit -1.0 for a period of 5 seconds. Depending on mode i Temperature Sensor Mode, the warning is acknowledged either with b Reset or automatically. b Error Low Limit: Warning: lower limit value undershot; goes TRUE if r Present Value <= r Low Limit. The warning that the lower limit value has been undershot can only be acknowledged if r Present Value >= r Low Limit +1.0 for a period of 5 seconds. Depending on mode i Temperature Sensor Mode, the warning is acknowledged either with b Reset or automatically. b Error Conversion Factor: If a value outside its range of 0 to 1 is specified at i Conversion Factor, this is signaled by b Error Conversion Factor = TRUE. The message need not be acknowledged after rectifying the cause. b Invalid Parameter: Indicates that there is an incorrect parameter on one of the variables r High Limit, r Low Limit, r Smooth Factor, i Conversion Factor or i Temperature Sensor Mode. An incorrect parameter specification does not lead to a standstill of the function block; see description of variables. Once the incorrect parameter specification has been corrected, the message b Invalid Parameter is acknowledged either with b Reset or automatically, depending on mode i Temperature Sensor Mode. VAR_IN_OUT r Offset : REAL; r High Limit : REAL; r Low Limit : REAL; r Replacement Value : REAL; r Smooth Factor : REAL; i Temperature Sensor Mode: INT; r Offset: Temperature compensation in Kelvin. The variable is saved persistently. Preset to 0. r High Limit: Upper limit value. The variable is saved persistently. Preset to 120. If r Present Value >= r High Limit , then output b Error High Limit is set. r High Limit must be greater than r Low Limit. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. r Low Limit: Lower limit value. The variable is saved persistently. Preset to -60. If r Present Value <= r Low Limit , then output b Error Low Limit is set. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. r Replacement Value: Replacement value that is output at r Present Value in the case of the errors b Error Short Circuit and b Error Broken Sensor if the selected operation mode i Temperature Sensor Mode = 0 or 2. The variable is saved persistently. Preset to 0. r Smooth Factor: Smoothing factor (>= 1) for the output value r Present Value. The variable is saved persistently. Preset to 100. The value for r Present Value is calculated and output according to the following formula: i Conversion Factor = 0: r Present Value := ((i Raw Value / 10 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; 108 Version: 1.3.0 TF8000
## Page 109

Programming i Conversion Factor = 1: r Present Value := ((i Raw Value / 100 + r Offset) - r Present Value Old) / r Smooth Factor + r Present Value Old; r Present Value Old is the value of r Present Value that was output in the previous PLC cycle. If an incorrect variable value is present at r Smooth Factor , then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. i Temperature Sensor Mode: Specifies the operation mode of the function block. i Temperature Sensor Mode = 0: If b Error Sensor = TRUE, then r Present Value = r Replacement Value. After correction of the error, the function block must be acknowledged with a rising edge at the input variable b Reset. i Temperature Sensor Mode = 1: If b Error Sensor = TRUE, then the last valid temperature value that was present 10 seconds before is output at the output variable r Present Value. After correction of the error, it must be acknowledged with a rising edge at the input variable b Reset. i Temperature Sensor Mode = 2 : If b Error Short Circuit or b Error Broken Sensor = TRUE, then r Present Value = r Replacement Value. The function block acknowledges itself automatically following correction of the error. i Temperature Sensor Mode = 3: If b Error Sensor = TRUE, then the last valid temperature value that was present 10 seconds before is output at the output variable r Present Value. The function block acknowledges itself automatically following correction of the error. If there is an incorrect variable value on i Temperature Sensor Mode, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 3. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4 HVAC Controller 5.1.4.1 FB_HVAC2Point Ctrl This function block represents a 2-point controller. The controller is enabled via b Enable = TRUE and is then active. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r W : REAL; r X : REAL; b Reset : BOOL; TF8000 Version: 1.3.0 109
## Page 110

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The controller is enabled via a TRUE and is then active. r W: The setpoint is transferred with the r W variable. r X: The actual value of the control loop is transferred with the r X variable. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b Out : BOOL; b Invalid Parameter : BOOL; b Out: Switching output of the two-point controller. b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r High Limit : REAL; r Low Limit : REAL; b Direction : BOOL; t Delay On : TIME; t Delay Off : TIME; r High Limit: Upper limit of the control deviation (0..32767). The variable is saved persistently. Preset to 0. r Low Limit: Lower limit of the control deviation (0..32767). The variable is saved persistently. Preset to 0. b Direction: The control direction of the controller is determined by b Direction. FALSE = heating mode; TRUE = cooling mode. The variable is saved persistently. Preset to 0. t Delay On: Switch-on delay [s]. The variable is saved persistently. Preset to 0 s. t Delay Off: Switch-off delay [s]. The variable is saved persistently. Preset to 0 s. Timing characteristics Figure 1: Curve of switching output b Out for a two-point controller in relation to the upper/lower limits of the control deviation, with no switch-on or release delay. 110 Version: 1.3.0 TF8000
## Page 111

Programming Figure 2: Curve of switching output b Out for a two-point controller in relation to the upper limit r High Limit = 3 and the lower limit r Low Limit = 8 with a switch-on delay of t Delay On = 4s and a release delay of t Delay Off = 6s. TF8000 Version: 1.3.0 111
## Page 112

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.2 FB_HVACI_Ctrl Step The function block serves the sequential control of power generators. In conjunction with the power range table FB_HVACPower Range Table [} 135], the power step controller can be used for the control of several boilers, refrigerating machines or recooling plants. Switching up or down to the next higher or next lower power step respectively takes place via an integral (r W - r X) and a time delay. First of all, the actual temperature value r X must have exceeded or fallen below a threshold value r W_High / r W_Low. Subsequently the integral starts. If the upper or lower limit value (r Integral High / r Integral Low) is reached at the output r I_Ctrl, then a timing element is started upon whose expiry (udi Sec RT_Delay High / udi Sec RT_Delay Low) the output i Step is incremented or decremented; see Program flowchart [} 115] An integration time setting of udi Sec Ti High/udi Sec Ti Low = 60 seconds means that the I-transfer element changes by one Kelvin per minute. In the case of a control deviation of r E = 5, the output of the I-transfer element r I_Ctrl has the value 5 after one minute. Example: b Direction = FALSE; udi Sec Ti Low = 60; r E = 2; r Integral Low = 10 For the remaining control deviation of 2 and the lower integral limit of 10, r I_Ctrl = r Integral Low after 5 minutes. The consequence of this is that a timing element with the delay time udi Sec Delay Low is started. After its expiry (udi Sec RT_Delay High / udi Sec RT_Delay Low), the output i Step is incremented by 1 and the I-transfer element and the time delays are reset. i Step is set to 1 for one PLC cycle if b Enable = TRUE, b Error = FALSE, e Ctrl Mode [} 489] = e HVACCtrl Mode_Auto AND i Number Of Step In Profile > 0. 112 Version: 1.3.0 TF8000
## Page 113

Programming Conditions The I-transfer element is released, if b Enable = TRUE AND NOT b Error AND e Ctrl Mode = e HVACCtrl Mode_Auto AND NOT b Block ( (r X >= r W_High AND ((i Step > 0 AND NOT b Direction) OR (i Step < i Number Of Step In Profile AND b Direction)) OR (r X < r W_Low AND ((i Step < i Number Of Step In Profile AND NOT b Direction) OR (i Step > 0 ANDb Direction)) ) . If r I_Ctrl =r Integral High / r Integral Low, then the timing elements of the delay times udi Sec Delay High / udi Sec Delay Low are activated. After the expiry of the delay times udi Sec RT_Delay High / udi Sec RT_Delay Low, the steps of the power step sequence are controlled as follows: i Step = i Step + 1 if (r X < r W_Low AND i Step < i Number Of Step In Profile AND NOT b Direction) OR (r X >= r W_High AND i Step < i Number Of Step In Profile AND b Direction) i Step = i Step -1 if (r X < r W_Low AND i Step > 0 AND b Direction) OR (r X >= r W_High AND i Step > 0 AND NOT b Direction) The I-transfer element and the internal time delays (udi Sec Delay Low, udi Sec Delay High) are reset after each change of i Step. Transfer function of the I-transfer element (I_Ctrl) TF8000 Version: 1.3.0 113
## Page 114

Programming Program flowchart 114 Version: 1.3.0 TF8000
## Page 115

Programming Program flowchart Behavior of the different variables TF8000 Version: 1.3.0 115
## Page 116

Programming The figure shows when each variable is used and how. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r W : REAL; r X : REAL; e Ctrl Mode : E_HVACCtrl Mode; i Manual Step : INT; b Step Up : BOOL; b Step Down : BOOL; b Direction : BOOL; i Number Of Step In Profile : INT; b Block : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then i Step is set constantly to 0. The check of the variable i Number Of Step In Profile remains active. If an error occurs, it is displayed with b Error = TRUE and can be acknowledged with b Reset once the fault has been corrected. r W: The setpoint is transferred with the r W variable. r X: The variable r X is used to transfer the actual value. e Ctrl Mode: Enum that specifies the operation mode of the function block (see E_HVACCtrl Mode [} 489]). If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Number Of Step In Profile > 0, then the value of the output i Step can be specified via i Manual Step. On starting the PLC, e Ctrl Mode = e HVACCtrl Mode_Auto. i Manual Step: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual AND b Enable = TRUE AND b Error = FALSE AND i Number Of Step In Profile > 0, then the value of the output i Step can be specified via i Manual Step. The input range of i Manual Step can be 0 at the least and the value of i Number Of Step In Profile at the most. b Step Up: If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE, then the value of the output i Step can be incremented by 1 by a rising edge at the input b Step Up. This can be repeated until i Step = i Number Of Step In Profile. b Step Down: If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE, then the value of the output i Step can be decremented by 1 by a rising edge at the input b Step Down. This can be repeated until i Step = 0. b Direction: b Direction determines the control direction of the function block. FALSE = heating mode; TRUE = cooling mode 116 Version: 1.3.0 TF8000
## Page 117

Programming i Number Of Step In Profile: Number of steps in the power step sequence. i Number Of Step In Profile can be 0 at the least and the value of g_i Max Number Of Steps at the most. If the limit values are not adhered to, an error is output and displayed by b Error = TRUE and i Step becomes 0. b Block: Using the input variable b Block, the control of the function block can either be released or the output i Step is set to the value to the variable i Number Of Step In Profile. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE, then the I-transfer element and the internal timing elements are enabled for the control of the output i Step. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = TRUE, then the I-transfer element and the internal timing elements are blocked and i Step = i Number Of Step In Profile. b Reset: Input for acknowledgement of the faults once they have been corrected. Internally the system responds to a rising edge. VAR_OUTPUT i Step : INT; r I_Ctrl : REAL; r E : REAL; r W_High : REAL; r W_Low : REAL; b_r W_High : BOOL; b_r W_Low : BOOL; udi Sec RT_Delay High : UDINT; udi Sec RT_Delay Low : UDINT; b Error : BOOL; e Error Code : E_HVACError Codes; i Step: The output variable i Step indicates the step in a power step sequence. On starting the function block, i Step = 1 if b Enable = TRUE, b Error = FALSE, e Ctrl Mode = e HVACCtrl Mode_Auto AND i Number Of Step In Profile > 0. i Step can reach the value of i Number Of Step In Profile at the most and can be 0 at the least. The value of i Step can be specified manually via i Manual Step if b Enable = TRUE, b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Step can be incremented or decremented via the input variables b Step Up / b Step Down if b Enable = TRUE, b Error = FALSE, e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE. If b Enable = TRUE, b Error = FALSE, e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE and the value of i Step has changed, then the delay timing elements and the I-transfer element are reset. If b Enable = TRUE, b Error = FALSE, e Ctrl Mode = e HVACCtrl Mode_Auto, b Block = FALSE AND i Number Of Step In Profile > 0, the output of the I-transfer element r I_Ctrl = r Integral High or r Integral Low and one of the delay times t Remaining Time Delay High / t Remaining Time Delay Low = T#0s, then the output i Step is controlled as follows: i Step = i Step + 1 if (r X < r W_Low AND i Step < i Number Of Step In Profile AND NOT b Direction) OR (r X >= r W_High AND i Step < i Number Of Step In Profile AND b Direction). i Step = i Step -1 if (r X < r W_Low AND i Step > 0 AND b Direction) OR (r X >= r W_High AND i Step > 0 AND NOT b Direction), see Program flowchart [} 114] If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = TRUE, then the I-transfer element and the internal timing elements are blocked and i Step = i Number Of Step In Profile. r I_Ctrl: Output of the I-transfer element. If r I_Ctrl >= r Integral High or r Integral Low and t Remaining Time Delay High or t Remaining Time Delay Low = T#0s, then the number of steps is incremented or decremented by 1 via i Step. Subsequently, the I-transfer element and the timing elements for stepping up or down are reset, so that stepping up or down is restarted, see Program flowchart [} 114]. TF8000 Version: 1.3.0 117
## Page 118

Programming r E: Control deviation with which the internal I-transfer element works: r E = r W - r X r W_High: r W_High := r W + r Hysteresis High – upper setpoint limit which, when exceeded by r X, causes the I-transfer element to be activated first, followed by the timing element of the delay time udi Sec Delay High; see F [} 112]unctional description or Behavior of different variables [} 115]. r W_Low: r W_Low := r W - r Hysteresis Low – lower setpoint limit which, when undershot by r X, causes the I- transfer element to be activated first, followed by the timing element of the delay time udi Sec Delay Low; see F [} 112]unctional description or Behavior of different variables [} 115]. b_r W_High: b_r W_High goes TRUE if r X > r W_High. b_r W_Low: b_r W_Low goes TRUE if r X < r W_Low. udi Sec RT_Delay High: Remaining time of the delay time udi Sec Delay High. udi Sec RT_Delay Low: Remaining time of the delay time udi Sec Delay Low. b Error: This output signals with a TRUE that there is an error and that there is a wrong parameter on the variable i Number Of Step In Profile. i Step is set constantly to 0 and the Enum e Error Code indicates the error code. Once the fault has been corrected the b Error message must be acknowledged with b Reset. e Error Code: returns the error number if an output b Error is set (see E_HVACError Codes [} 490]). The following error can occur in this function block: e HVACError Codes_Invalid Param_Number Of Step In Profile. To access the enum error number in the PLC e Error Code [} 490] can assigned to a variable of data type WORD. e HVACError Codes_Error_i Number Of Step In Profil= 32 VAR_IN_OUT r Hysteresis High : REAL; r Hysteresis Low : REAL; udi Sec Delay High : UDINT; udi Sec Delay Low : UDINT; udi Sec Ti High : UDINT; udi Sec Ti Low : UDINT; r Integral High : REAL; r Integral Low : REAL; r Hysteresis High: Positive value of the upper limit of the control deviation; see Functional description [} 112] or Behavior of different variables [} 115]. r W_High := r W + r Hysteresis High. The variable is saved persistently. Preset to 5. r Hysteresis Low: Positive value of the lower limit of the control deviation; see Functional description [} 112] or Behavior of different variables [} 115]. r W_Low := r W – r Hysteresis Low. The variable is saved persistently. Preset to 5. udi Sec Delay High: Delay time (0..g_udi Max Sec) after whose expiry i Step is incremented or decremented, see Functional description [} 112] or Behavior of different variables [} 115]. The variable is saved persistently. Preset to 300 s. udi Sec Delay Low: Delay time (0..g_udi Max Sec) after whose expiry i Step is incremented or decremented, see Functional description [} 112] or Behavior of different variables [} 115]. The variable is saved persistently. Preset to 300 s. udi Sec Ti High: Integration time (0..g_udi Max Sec) for the upper limit of the I-transfer element in seconds; see Functional description [} 112] or Behavior of different variables [} 115]. udi Sec Ti High must be > 0. Otherwise the default value or the last valid variable value is used internally. The variable is saved persistently. Preset to 60 s. udi Sec Ti Low: Integration time (0..g_udi Max Sec) for the lower limit of the I-transfer element; see Functional description [} 112] or Behavior of different variables [} 115]. udi Sec Ti Low must be > 0. Otherwise the default value or the last valid variable value is used internally. The variable is saved persistently. Preset to 60 s. 118 Version: 1.3.0 TF8000
## Page 119

Programming r Integral High: Positive value for the upper limit at which the integration of the I-transfer element is stopped (anti-reset-windup measure) and one of the delay times starts; see Functional description [} 112] or Behavior of different variables [} 115]. The variable is saved persistently. Preset to 15. r Integral Low: Positive value for the lower limit at which the integration of the I-transfer element is stopped (anti-reset-windup measure) and one of the delay times starts; see Functional description [} 112] or Behavior of different variables [} 115]. The variable is saved persistently. Preset to 15. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.3 FB_HVACI_Ctrl Step Ex Functional description The function block serves the sequential control of power generators. It differs from FB_HVACI_Ctrl Step [} 112] in that the value of i Step is specified by the variable i Start Step when starting the function block. In conjunction with the power range table FB_HVACPower Range Table [} 135], the power step controller can be used for the stepped control of several boilers, refrigerating machines or recooling plants. Switching up or down to the next higher or next lower power step respectively takes place via an integral (r W - r X) and a time delay. First of all, the actual temperature value r X must have exceeded or fallen below a threshold value r W_High / r W_Low. Subsequently the integral starts. If the upper or lower limit value (r Integral High / r Integral Low) is reached at the output r I_Ctrl, then a timing element is started upon whose expiry (udi Sec RT_Delay High / udi Sec RT_Delay Low) the output i Step is incremented or decremented; see Program flowchart [} 122] TF8000 Version: 1.3.0 119
## Page 120

Programming An integration time setting of udi Sec Ti High/udi Sec Ti Low = 60 seconds means that the I-transfer element changes by one Kelvin per minute. In the case of a control deviation of r E = 5, the output of the I-transfer element r I_Ctrl has the value 5 after one minute. Example: b Direction = FALSE; udi Sec Ti Low = 60; r E = 2; r Integral Low = 10 For the remaining control deviation of 2 and the lower integral limit of 10, r I_Ctrl = r Integral Low after 5 minutes. The consequence of this is that a timing element with the delay time udi Sec Delay Low is started. After its expiry (udi Sec RT_Delay High / udi Sec RT_Delay Low), the output i Step is incremented by 1 and the I-transfer element and the time delays are reset. i Step is set to i Start Step for one PLC cycle if b Enable = TRUE and b Error = FALSE. Conditions The I-transfer element is released, if b Enable = TRUE AND NOTb Error AND e Ctrl Mode = e HVACCtrl Mode_Auto AND NOT b Block ( (r X >= r W_High AND ((i Step > 0 AND NOT b Direction) OR (i Step < i Number Of Step In Profile AND b Direction)) OR (r X < r W_Low AND ((i Step < i Number Of Step In Profile AND NOT b Direction) OR (i Step > 0 AND b Direction)) ) If r I_Ctrl =r Integral High / r Integral Low, then the timing elements of the delay times udi Sec Delay High / udi Sec Delay Low are activated. After the expiry of the delay times udi Sec RT_Delay High / udi Sec RT_Delay Low, the steps of the power step sequence are controlled as follows: i Step = i Step + 1 if (r X < r W_Low AND i Step < i Number Of Step In Profile AND NOT b Direction) OR (r X >= r W_High AND i Step < i Number Of Step In Profile AND b Direction) i Step = i Step -1 if (r X < r W_Low AND i Step > 0 AND b Direction) OR (r X >= r W_High AND i Step > 0 AND NOT b Direction) The I-transfer element and the internal time delays (udi Sec Delay Low, udi Sec Delay High) are reset after each change of i Step. Transfer function of the I-transfer element (I_Ctrl) 120 Version: 1.3.0 TF8000
## Page 121

Programming Program flowchart TF8000 Version: 1.3.0 121
## Page 122

Programming Program flowchart Program flowchart 122 Version: 1.3.0 TF8000
## Page 123

Programming Behaviour of the different variables The figure shows when each variable is used and how. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r W : REAL; r X : REAL; i Start Step : INT; e Ctrl Mode : E_HVACCtrl Mode; i Manual Step : INT; b Step Up : BOOL; b Step Down : BOOL; b Direction : BOOL; i Number Of Step In Profile : INT; b Block : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then i Step is set constantly to 0. The check of the variable i Number Of Step In Profile remains active. If an error occurs, it is displayed with b Error = TRUE and can be acknowledged with b Reset once the fault has been corrected. TF8000 Version: 1.3.0 123
## Page 124

Programming r W: The setpoint is transferred with the r W variable. r X: The variable r X is used to transfer the actual value. i Start Step: If the function block is enabled (b Enable = TRUE) and there is no error (b Error = FALSE), then i Step = i Start Step for one PLC cycle. e Ctrl Mode: Enum that specifies the operation mode of the function block. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Number Of Step In Profile > 0, then the value of the output i Step can be specified via i Manual Step. On starting the PLC, e Ctrl Mode = e HVACCtrl Mode_Auto. i Manual Step: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual AND b Enable = TRUE AND b Error = FALSE AND i Number Of Step In Profile > 0, then the value of the output i Step can be specified via i Manual Step. The input range of i Manual Step can be 0 at the least and the value of i Number Of Step In Profile at the most. b Step Up: If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE, then the value of the output i Step can be incremented by 1 by a rising edge at the input b Step Up. This can be repeated until i Step = i Number Of Step In Profile. b Step Down: If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE, then the value of the output i Step can be decremented by 1 by a rising edge at the input b Step Down. This can be repeated until i Step = 0. b Direction: b Direction determines the control direction of the function block. FALSE = heating mode; TRUE = cooling mode i Number Of Step In Profile: Number of steps in the power step sequence. i Number Of Step In Profile can be 0 at the least and the value of g_i Max Number Of Steps at the most. If the limit values are not adhered to, an error is output and displayed by b Error = TRUE and i Step becomes 0. b Block: Using the input variable b Block, the control of the function block can either be released or the output i Step is set to the value to the variable i Number Of Step In Profile. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE, then the I-transfer element and the internal timing elements are enabled for the control of the output i Step. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = TRUE, then the I-transfer element and the internal timing elements are blocked and i Step = i Number Of Step In Profile. b Reset: Input for acknowledgement of the faults once they have been corrected. Internally the system responds to a rising edge. VAR_OUTPUT i Step : INT; r I_Ctrl : REAL; r E : REAL; r W_High : REAL; r W_Low : REAL; b_r W_High : BOOL; b_r W_Low : BOOL; udi Sec RT_Delay High : UDINT; udi Sec RT_Delay Low : UDINT; b Error : BOOL; e Error Code : E_HVACError Codes; i Step: The output variable i Step indicates the step in a power step sequence. i Step = i Start Step on starting the function block if b Enable = TRUE AND b Error = FALSE. i Step can reach the value of i Number Of Step In Profile at the most and can be 0 at the least. The value of i Step can be specified manually via i Manual Step if b Enable = TRUE, b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Step can be incremented or decremented via the input variables b Step Up / b Step Down if b Enable = TRUE, b Error = FALSE, e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE. If b Enable = TRUE, b Error = FALSE, e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = FALSE and the value of i Step has changed, then the delay timing elements and the I-transfer element are reset. 124 Version: 1.3.0 TF8000
## Page 125

Programming If b Enable = TRUE, b Error = FALSE, e Ctrl Mode = e HVACCtrl Mode_Auto, b Block = FALSE AND i Number Of Step In Profile > 0, the output of the I-transfer element r I_Ctrl = r Integral High or r Integral Low and one of the delay times t Remaining Time Delay High / t Remaining Time Delay Low = T#0s, then the output i Step is controlled as follows: i Step = i Step + 1 if (r X < r W_Low AND i Step < i Number Of Step In Profile AND NOT b Direction) OR (r X >= r W_High AND i Step < i Number Of Step In Profile AND b Direction). i Step = i Step -1 if (r X < r W_Low AND i Step > 0 AND b Direction) OR (r X >= r W_High AND i Step > 0 AND NOT b Direction), see Program flowchart [} 121] If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Block = TRUE, then the I-transfer element and the internal timing elements are blocked and i Step = i Number Of Step In Profile. r I_Ctrl: Output of the I-transfer element. If r I_Ctrl >= r Integral High or r Integral Low and t Remaining Time Delay High or t Remaining Time Delay Low = T#0s, then the number of steps is incremented or decremented by 1 via i Step. Subsequently, the I-transfer element and the timing elements for stepping up or down are reset, so that stepping up or down is restarted, see Program flowchart [} 121]. r E: Control deviation with which the internal I-transfer element works: r E = r W - r X r W_High: r W_High := r W + r Hysteresis High – upper setpoint limit which, when exceeded by r X, causes the I-transfer element to be activated first, followed by the timing element of the delay time udi Sec Delay High; see Functional description [} 119] or Behavior of different variables [} 123]. r W_Low: r W_Low := r W - r Hysteresis Low – lower setpoint limit which, when undershot by r X, causes the I- transfer element to be activated first, followed by the timing element of the delay time udi Sec Delay Low; see Functional description [} 119] or Behavior of different variables [} 123]. b_r W_High: b_r W_High goes TRUE if r X > r W_High. b_r W_Low: b_r W_Low goes TRUE if r X < r W_Low. udi Sec RT_Delay High: Remaining time of the delay time udi Sec Delay High. udi Sec RT_Delay Low: Remaining time of the delay time udi Sec Delay Low. b Error: This output signals with a TRUE that there is an error and that there is a wrong parameter on the variable i Number Of Step In Profile. i Step is set constantly to 0 and the Enum e Error Code indicates the error code. Once the fault has been corrected the b Error message must be acknowledged with b Reset. e Error Code: Returns the error number if a b Error output is set (see E_HVACError Codes [} 490]). The following error can occur in this function block: e HVACError Codes_Invalid Param_Number Of Step In Profile To access the enum error number in the PLC e Error Code [} 490] can assigned to a variable of data type WORD. e HVACError Codes_Error_i Number Of Step In Profil= 32 VAR_IN_OUT r Hysteresis High : REAL; r Hysteresis Low : REAL; udi Sec Delay High : UDINT; udi Sec Delay Low : UDINT; udi Sec Ti High : UDINT; udi Sec Ti Low : UDINT; r Integral High : REAL; r Integral Low : REAL; TF8000 Version: 1.3.0 125
## Page 126

Programming r Hysteresis High: Positive value of the upper limit of the control deviation; see Functional description [} 119] or Behavior of different variables [} 123]. r W_High := r W + r Hysteresis High. The variable is saved persistently. Preset to 5. r Hysteresis Low: Positive value of the lower limit of the control deviation; see Functional description [} 119] or Behavior of different variables [} 123]. r W_Low := r W – r Hysteresis Low. The variable is saved persistently. Preset to 5. udi Sec Delay High: Delay time (0..g_udi Max Sec) after whose expiry i Step is incremented or decremented, see Functional description [} 119] or Behavior of different variables [} 123]. The variable is saved persistently. Preset to 300 s. udi Sec Delay Low: Delay time (0..g_udi Max Sec) after whose expiry i Step is incremented or decremented, see Functional description [} 119] or Behavior of different variables [} 123]. The variable is saved persistently. Preset to 300 s. udi Sec Ti High: Integration time (0..g_udi Max Sec) for the upper limit of the I-transfer element in seconds; see Functional description [} 119] or Behavior of different variables [} 123]. udi Sec Ti High must be > 0. Otherwise the default value or the last valid variable value is used internally. The variable is saved persistently. Preset to 60 s. udi Sec Ti Low: Integration time (0..g_udi Max Sec) for the lower limit of the I-transfer element; see Functional description [} 119] or Behavior of different variables [} 123]. udi Sec Ti Low must be > 0. Otherwise the default value or the last valid variable value is used internally. The variable is saved persistently. Preset to 60 s. r Integral High: Positive value for the upper limit at which the integration of the I-transfer element is stopped (anti-reset-windup measure) and one of the delay times starts; see Functional description [} 119] or Behavior of different variables [} 123]. The variable is saved persistently. Preset to 15. r Integral Low: Positive value for the lower limit at which the integration of the I-transfer element is stopped (anti-reset-windup measure) and one of the delay times starts; see Functional description [} 119] or Behavior of different variables [} 123]. The variable is saved persistently. Preset to 15. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 126 Version: 1.3.0 TF8000
## Page 127

Programming 5.1.4.4 FB_HVACPIDCtrl The PID controller is a standard controller for heating and air conditioning applications. It can be used to control temperatures, pressures, volumetric flows or humidity. The values of Ti and Tv can be set to zero. This allows a P, PI, or PD controller characteristic to be set. The controller has an anti-reset-windup function. This prevents continuous integration in the event of a perpetual pending control deviation. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r W : REAL; r X : REAL; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; e Ctrl Mode : E_HVACCtrl Mode; r YManual : REAL; r Initial Value : REAL; b Reset Controller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. TF8000 Version: 1.3.0 127
## Page 128

Programming NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: Input variable for enabling the controller. The controller is enabled if b Enable = TRUE. r W: The setpoint is transferred to the controller with the variable r W. r X: r X acquires the actual value of the control loop. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: The variable t Ctrl Cycle Time specifies the cycle time with which the PID controller is processed. The shortest possible cycle time is that of the controller. Since the controlled systems in building automation are predominantly slow, the cycle time of the controller can be several times that of the control cycle time. e Ctrl Mode: The operation mode is selected via this enum (see E_HVACCtrl Mode [} 489]). r YManual: The controller output r Y can be overridden for test purposes. The setpoint of r YManual will be found at the controller output in manual operation mode. r Initial Value: The restart behavior of the controller is influenced by r Initial Value. The initial values are adopted on a rising edge at the controller enable input b Enable. 0 = start with the value zero at output r Y <>0 = Start with the value of r Initial Value b Reset Controller: A positive edge on the input b Reset Controller resets the PID controller. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Control signal output of the PID controller. r XW: Control deviation. b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState) [} 493]. b Error: This output indicates with a TRUE that there is an error. e Error Code: Contains the command-specific error code (see E_HVACError Codes [} 490]). b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. 128 Version: 1.3.0 TF8000
## Page 129

Programming VAR_IN_OUT r Dead Range : REAL; b Direction : BOOL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r YMin : REAL; r YMax : REAL; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range (0..32767) can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. b Direction: The control direction of the controller can be changed with the parameter b Direction. If b Direction is TRUE, then the direct control direction is active for cooling operation of the controller. If b Direction is FALSE, then the indirect control direction of the controller is activated for heating operation. The variable is saved persistently. Preset to 0. r Kp: Proportional factor (0.01..100) gain. The variable is saved persistently. Preset to 1.0. t Ti: Integration time [s]. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. The variable is saved persistently. Preset to 30 s. t Tv: Rate time [s]. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. t Td: Damping time [s]. The variable is saved persistently. Preset to 0 s. r YMin / r YMax: Limiting the working range of the controller (0..32767). Several other function blocks, e.g. sequencers, require a symmetrical control range (-100 to +100). In the case of a cascade structure, the working range of the master controller determines the setpoint of the slave controller. For example, 15° to 25° as the limitation of the supply air setpoint for an exhaust/supply air cascade control. The variables are saved persistently. r YMin preset to 0. r YMax preset to 100. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 129
## Page 130

Programming 5.1.4.5 FB_HVACPIDCtrl_Ex Universal PID controller. The PID controller is a standard controller for heating and air conditioning applications. It can be used to control temperatures, pressures, volumetric flows or humidity. The values of Ti and Tv can be set to zero. This allows a P, PI, or PD controller characteristic to be set. The controller has an anti-reset-windup function. This prevents continuous integration in the event of a perpetual pending control deviation. In addition to FB_HVACPIDCtrl [} 127], the controller provides a slope compensation at the output. Passive-behaviour (b Enable = FALSE or b Error = TRUE) The outputs are set in the followiog scheme: r Y 0,0 r XW 0,0 b Max Limit FALSE b Min Limit FALSE b Dec Limit FALSE b Inc Limit FALSE b Active FALSE b ARWactive FALSE b2Ptactive FALSE In case of an error the output b Error is set to TRUE - e Error Code displays the actual errorcode. The internal values for the P-, I-, and D-part are set to "0", as well as the repective values for the previous cycle. Thus the controller can restart "clean" without any past values. Active behavior (b Enable = TRUE and b Error = FALSE) In the first cycle, the I and D components are calculated "clean", i.e. without historical values, as already mentioned. A positive signal on b Set Sync Value sets the I-component such that the control value assumes the value r Sync Value. If b Enable and b Set Sync Value are set at the same time, this method can be used to set an initial value from which the controller "sets off". If the I-component is not active, the D-component is set accordingly. Note that only the rising edge of b Set Sync Value is evaluated internally as this is a setting action. A TRUE signal must be applied again to the input b Set Sync Value for renewed synchronization, for instance with a transfer value. If the I-component is active, then the controller ensures that this is held 130 Version: 1.3.0 TF8000
## Page 131

Programming constant if the controller output r Y should be at the limits r YMin or r YMax and attempts to fall or rise further. This procedure is referred to as Anti-Reset-Windup. It ensures that the I-component is always only just sufficiently large to enable the control value to assume values within the limit immediately after a control deviation, without having to deal with an integral component that has become too large. Control direction If b Direction = FALSE, the control direction of the controller is reversed so that a control deviation of less than 0 causes a change in the control value in the positive direction. This is achieved by a negative calculation of the control deviation: b Direction r XW (control deviation) Control direction TRUE lr X-lr W (actual value setpoint) direct (cooling) FALSE lr W-lr X (setpoint actual value) indirect (heating) Anti-Reset-Windup when the maximum or minimum value is reached If the controller reaches its upper limit at the output and the control deviation is still positive, the integral component will continue to increase, until the control deviation is less than or equal to zero again. This may lead to an unnecessarily large integral component, which would have to be reduced again, if the sign of the control deviation changes and would make the control behavior sluggish. The same applies if the minimum values is reached at the output, while the control deviation is still negative. To prevent this in the event of leaving the control range, the I-component is set in such a way that, in addition to the P and D-components, it reaches the respective limit value lr Ymin or lr YMax at the control output. The further calculation of the P, I and D values is suspended until the sign of the control deviation allows the control range to be entered again; i.e. a control deviation of less than 0.0 when persisting at the maximum limit and or a control deviation of greater than 0.0 when persisting at the minimum limit. In the PLC cycle of the re-entry also, the output lr Y is set by manipulating the I-component so that it doesn't move erratically in the control range, but starts to change from the limit of the preceding persistence. Slope limitation If the controller is set faster than the actuator, it is unable to follow the controller, which can lead to jitter. It is therefore possible to limit the slope of the control value. It is based on the following parameters: t Min To Max: Slope limitation of controller output for increase: t Min To Max in seconds in reference to a change from r YMin to r YMax. t Max To Min: Slope limitation of controller output for decrease: t Max To Min in seconds in reference to a change from r YMax to r YMin. This can be used to calculate the maximum change per PLC cycle (maximum increment or decrement). If the calculated change of the control signal over a PLC cycle is now higher than that set under t Min To Max or t Max To Min, then the control signal is merely increased or decreased respectively by the maximum increment or decrement. Internally, the I-component is automatically adjusted in the same way (I-component of last PLC cycle + maximum increment or I-component of the last PLC cycle - maximum decrement). Deadrange If the setpoint is finally reached, the actual value may still swing around it, which causes swinging at the control-output and constant movement at the actuator. This can be surpressed by defining a deadrange around the setpoint. If the absolute value of the control-deviation is smaller than half of the defined r Dead Range, the P- I- and D-Part will be frozen and not calculated any more until the deviation gets above 0,5*r Dead Range again. A zero-entry at this input deactivates the deadrange. TF8000 Version: 1.3.0 131
## Page 132

Programming 2-point control behavior If the control parameters Ir, r Kp, t Tn, t Tv and t Td are set to 0.0 or t#0s, then the controller has by definition a 2-point behavior. The dead range r Dead Range defines the hysteresis. Switching to the maximum value at the output r Y fundamentally takes place when the control deviation r XW is larger than half of the hysteresis value r Dead Range, while switching to the minimum value always takes place when the control deviation r XW is smaller than the negative half of the hysteresis value r Dead Range: The different calculation methods for the control deviation for direct and indirect control direction result in the following switching characteristics in relation to the actual value r X: • direct control direction (cooling): Control deviation = actual value - setpoint r XW = r X - r W • indirect control direction (heating): Control deviation = actual value - setpoint r XW = r W-r X VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r W : REAL; 132 Version: 1.3.0 TF8000
## Page 133

Programming r X : REAL; t Task Cycle Time : TIME; ui Cycle Call : UINT; b Set Sync Value : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: Controller activation. At the moment of activation the controller reacts directly to the control deviation without internal synchronization to a value. r W: Setpoint r X: Actual value t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. ui Cycle Call: Call cycle of the function block as a multiple of the cycle time. A zero entry is automatically interpreted as ui Cycle Call=1. Example: t Task Cycle Time = 20 ms, ui Cycle Call = 10 -> the control algorithm is called every 200 ms. Thus the outputs are also updated only every 200 ms. b Set Sync Value: The control value r Y is set to the value r Sync Value (VAR_IN_OUT) on a rising edge at the input b Set Sync Value. In addition, the I-component is changed internally. If the I-component doesn't exist (PD controller), the D-component is changed. VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Dec Limit : BOOL; b Inc Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; b2Ptactive : BOOL; b Error : BOOL; e Error Code : E_HVACError Codes; r Y: Control value. Range limited by r YMin and r YMax. r XW: Control deviation (calculation dependent on control direction [} 131]) b Max Limit: The control value has reached its upper limit value. b Min Limit: The control value has reached its lower limit value. TF8000 Version: 1.3.0 133
## Page 134

Programming b Dec Limit: The control value slope has reached its limit value for the maximum decrease, see t Max To Min (VAR_IN_OUT). b Inc Limit: The control value slope has reached its limit value for the maximum increase, see t Min To Max (VAR_IN_OUT). b Active: The controller is active, i.e. enabled (b Enable = TRUE) and not in the error state (b Error = FALSE). b ARWactive: Anti-Reset-Windup function is active. b2Ptactive: The 2-point behavior of the controller is active. b Error: This output is switched to TRUE if the parameters entered are erroneous. e Error Code: Contains the command-specific error code (see E_HVACError Codes [} 490]). VAR_IN_OUT r Dead Range : REAL; r Sync Value : REAL; b Direction : BOOL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r YMin : REAL; r YMax : REAL; t Min To Max : TIME; t Max To Min : TIME; r Dead Range: A dead range can be set for the control deviation in order to avoid unnecessary movement and thus premature wear in the valves or damper drives. The P-I-D calculation and thus the control output r Y are "frozen" if the value of the control deviation is smaller than half of the dead range r Dead Range. The variable is saved persistently. Preset to 0. r Sync Value: The control value r Y is set to this value on a rising edge at the input b Sync. In addition, the I- component is changed internally. If the I-component doesn't exist (PD controller), the D-component is changed. The variable is saved persistently. Preset to 0. b Direction: The control direction [} 131] of the controller can be changed with the parameter b Direction. If b Direction is TRUE, then the direct control direction is active for cooling operation of the controller. If b Direction is FALSE, then the indirect control direction of the controller is activated for heating operation. The variable is saved persistently. Preset to 0. r Kp: Proportional factor amplification. Only affects the P-component. The variable is saved persistently. Preset to 1.0. t Ti: Integration time [s]. The I-component corrects the residual control deviation following correction of the P- component. The smaller t Ti is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. A zero value at this parameter disables the I-component. The variable is saved persistently. Preset to 30 s. t Tv: Rate time [s]. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. A zero value at this parameter disables the D-component. The variable is saved persistently. Preset to 0 s. t Td: Damping time [s]. The variable is saved persistently. Preset to 0 s. r YMin / r YMax: Limit the working range of the controller. Several other function blocks, e.g. sequencers, require a symmetrical control range (-100 to +100). In the case of a cascade structure, the working range of the master controller determines the setpoint of the slave controller. For example, 15° to 25° as the limitation of the supply air setpoint for an exhaust/supply air cascade control. The variables are saved persistently. r YMin preset to 0. r YMax preset to 100. t Min To Max: Slope limitation [s] of the controller output for increase: t Min To Max in seconds in reference to a change from r YMin to r YMax. The variable is saved persistently. Preset to 0 s. 134 Version: 1.3.0 TF8000
## Page 135

Programming t Max To Min: Slope limitation [s] of the controller output for decrease: t Max To Min in seconds in reference to a change from r YMax to r YMin. The variable is saved persistently. Preset to 0 s. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.6 FB_HVACPower Range Table This function block represents a power range table and serves the sequential control of power generators such as boilers or refrigerating machines. The power steps are determined by the upstream controller FB_HVACI_Ctrl_Step [} 112] and transferred to the power range table via the input i Step. All information or parameters relevant to system control are summarized in the power range table ARRAY arr Power Range Table. The power range table is a two-dimensional array with the structure ST_HVACPower Range [} 497]. The power range table can be compared to a normal table. An individual element is clearly designated by naming line and column. The columns are marked by the field range 1 to g_i Max Number Of Profiles. This range is called the profile and is addressed via the input variable i Profile. The field range 0 to g_i Max Number Of Steps represents the lines. This range is called the step and is addressed via the input variable i Step. The power range table consists of 16 profiles. Each profile can have up to 33 steps, from 0 to 32. Each individual step contains the parameter structure ST_HVACPower Range [} 497] needed for system control. The parameters indicated here are transferred via the output structures st I_Ctrl and st Aggregate1-6 to the function block FB_HVACI_Ctrl Step [} 112] for controlling the steps and to the function blocks for power generation. The number of steps in a profile is indicated by the output variable i Number Of Step In Profile. The number depends on the entries in the power range table and on the specification in the selected profile si Current Profile. The selected profile is checked internally from step 1 up to the step in which all variables of the structure ST_HVACPower Range [} 497] have the value 0. i Number Of Step In Profile is always intended only for the specified profile. i Number Of Step In Profile can thus be used to limit the steps in a profile for other function blocks such as for the input i Number Of Step In Profile of FB_HVACI_Ctrl Step [} 112], which could control the individual steps of the FB_HVACPower Range Table via its output i Step. The step 0 is not taken into account when evaluating the number of steps via i Number Of Step In Profile, because the power generators are switched off in this step; it can be considered to be a standby step. The values of the variables of the output structures st Aggregate1-6 then output the value 0. In the standby step, the parameters required for starting the power step sequence of the energy generators are transferred to the upstream controller FB_HVACI_Ctrl_Step [} 112] via the output structure st I_Ctrl. TF8000 Version: 1.3.0 135
## Page 136

Programming Table example for the power range table arr Power Range Table A unit is assigned to each power step within a profile (table columns). Hence, the order is specified in which the power generators are switched on or off within a sequence. The power of the units is specified as 0 to 6 in the case of stepped power generators or 0 to 100% in the case of constant power generators. After switching to a higher or lower power step, the integral component of the upstream function block FB_HVACI_Ctrl_Step [} 112] is re-initialized. The current values for the step-up and step-down integrals are then transferred to the controller by means of the structure st I_Ctrl. It is possible to switch to a different profile for a change of order of the units within the sequence. By skilfully entering different orders of the units in the profiles, it is possible to react with the utmost flexibility to all requirements with regard to the control of power generators. The switching of the power profiles (i Current Profile) usually takes place on the basis of time or operating hours so that all power generators in a plant are utilized evenly. In the case of power generators with different rated outputs, the power profile is changed in relation to the load. If a unit within a generator group is faulty, it is possible to switch to a profile in which the faulty generator is placed at the end of the power order. 136 Version: 1.3.0 TF8000
## Page 137

Programming The power range table shows three power profiles. The order of the power generators is entered in each power profile. Profile 1: In profile 1, unit 1 is switched to the first power step in power step 1. In the second power step, unit 2 is added with its first power step. Profile 2: In profile 2, unit 3 is switched to the first power step in power step 1. In the second power step, unit 3 is switched in its second power step. In the third power step, unit 1 is added with its first power step. Profile 3: In profile 3, unit 5 is switched to the first power step in power step 1. In the second power step, unit 4 is added with its first power step. In the third power step, unit 3 is added with its first power step. By skillful arrangement of the power profiles, it is possible to react to faults in individual units, the operating- hour dependent change of order or the load-optimized change of power orders. TF8000 Version: 1.3.0 137
## Page 138

Programming The relationship between the power range table arr Power Range and the output structures st Aggregate1-6 and st I_Ctrl is to be described in greater detail on the basis of the table example: 1. The column i Current Profile = 1 is intended to represent the first profile of the power range table arr Power Range. In this profile the output i Number Of Step In Profile has the value 2, because no variable value in the structure ST_HVACPower Range [} 497] (marked red) is greater than 0 in the line i Current Step = 3. If one assumes that the current power step i Current Step has the value 2, then the variable values are output as follows on the output structures: arr Power Range Table[i Current Profile,i Current Step]; st Aggregate1.i Aggregate Step :=arr Power Range Table[1,1].i Aggregate Step; st Aggregate1.r Y_Max := arr Power Range Table[1,1].r Y_Max; st Aggregate1.r Y_Min :=arr Power Range Table[1,1].r Y_Min; st Aggregate1.b Block := arr Power Range Table[1,1].b Block; st Aggregate2.i Aggregate Step :=arr Power Range Table[1,2].i Aggregate Step; st Aggregate2.r Y_Max := arr Power Range Table[1,2].r Y_Max; st Aggregate2.r Y_Min :=arr Power Range Table[1,2].r Y_Min; st Aggregate2.b Block := arr Power Range Table[1,2].b Block; st I_Ctrl.r Integral High := arr Power Range Table[1,2].r Integral High; st I_Ctrl.r Integral Low := arr Power Range Table[1,2].r Integral Low; st I_Ctrl.udi Sec Delay High :=arr Power Range Table[1,2,].udi Sec Delay High; st I_Ctrl.udi Sec Delay Low :=arr Power Range Table[1,2].udi Sec Delay Low; Contents of the output structures st Aggregate1, st Aggregate2 and st I_Ctrl. The variables of the output structures st Aggregate3-6 have the value 0. st Aggregate1.i Aggregate Step :=1; st Aggregate1.r Y_Max := 0; st Aggregate1.r Y_Min :=0; st Aggregate1.b Block := FALSE; st Aggregate2.i Aggregate Step :=1; st Aggregate2.r Y_Max := 0; st Aggregate2.r Y_Min :=0; st Aggregate2.b Block := TRUE; st I_Ctrl.r Integral High := 10; st I_Ctrl.r Integral Low := 10; st I_Ctrl.udi Sec Delay High :=300; st I_Ctrl.udi Sec Delay Low :=300; 2. The column i Current Profile = 2 represents the second profile of the power range table arr Power Range. In this profile the output i Number Of Step In Profile has the value 3, because no variable value in the structure ST_HVACPower Range [} 497] (marked red) is greater than 0 in the line i Current Step = 4. If one assumes that the current power step i Current Step has the value 3, then the variable values are output as follows on the output structures: arr Power Range Table[i Current Profile,i Current Step]; st Aggregate1.i Aggregate Step :=arr Power Range Table[2,3].i Aggregate Step; st Aggregate1.r Y_Max := arr Power Range Table[2,3].r Y_Max; st Aggregate1.r Y_Min :=arr Power Range Table[2,3].r Y_Min; st Aggregate1.b Block := arr Power Range Table[2,3].b Block; st Aggregate3.i Aggregate Step :=arr Power Range Table[2,2].i Aggregate Step; st Aggregate3.r Y_Max := arr Power Range Table[2,2].r Y_Max; st Aggregate3.r Y_Min :=arr Power Range Table[2,2].r Y_Min; st Aggregate3.b Block := arr Power Range Table[2,2].b Block; st I_Ctrl.r Integral High := arr Power Range Table[2,3].r Integral High; st I_Ctrl.r Integral Low := arr Power Range Table[2,3].r Integral Low; st I_Ctrl.udi Sec Delay High :=arr Power Range Table[2,3].udi Sec Delay High; st I_Ctrl.udi Sec Delay Low :=arr Power Range Table[2,3].udi Sec Delay Low; 138 Version: 1.3.0 TF8000
## Page 139

Programming Contents of the output structures st Aggregate1, st Aggregate3 and st I_Ctrl. The variables of the output structures st Aggregate2 and st Aggregate4-6 have the value 0. st Aggregate1.i Aggregate Step :=1; st Aggregate1.r Y_Max := 0; st Aggregate1.r Y_Min :=0; st Aggregate1.b Block := FALSE; st Aggregate3.i Aggregate Step :=2; st Aggregate3.r Y_Max := 60; st Aggregate3.r Y_Min :=30; st Aggregate3.b Block := FALSE; st I_Ctrl.r Integral High := 8; st I_Ctrl.r Integral Low := 8; st I_Ctrl.udi Sec Delay High :=23; st I_Ctrl.udi Sec Delay Low :=123; 3. The column i Current Profile = 3 represents the third profile of the power range table arr Power Range. In this profile the output i Number Of Step In Profile has the value 3, because no variable value in the structure ST_HVACPower Range [} 497] (marked red) is greater than 0 in the line i Current Step = 4. If one assumes that the current power step i Current Step has the value 3, then the variable values are output as follows on the output structures: arr Power Range Table[i Current Profile,i Current Step]; st Aggregate3.i Aggregate Step :=arr Power Range Table[3,3].i Aggregate Step; st Aggregate3.r Y_Max := arr Power Range Table[3,3].r Y_Max; st Aggregate3.r Y_Min :=arr Power Range Table[3,3].r Y_Min; st Aggregate3.b Block := arr Power Range Table[3,3].b Block; st Aggregate4.i Aggregate Step :=arr Power Range Table[3,2].i Aggregate Step; st Aggregate4.r Y_Max := arr Power Range Table[3,2].r Y_Max; st Aggregate4.r Y_Min :=arr Power Range Table[3,2].r Y_Min; st Aggregate4.b Block := arr Power Range Table[3,2].b Block; st Aggregate5.i Aggregate Step :=arr Power Range Table[3,1].i Aggregate Step; st Aggregate5.r Y_Max := arr Power Range Table[3,1].r Y_Max; st Aggregate5.r Y_Min :=arr Power Range Table[3,1].r Y_Min; st Aggregate5.b Block := arr Power Range Table[3,1].b Block; st I_Ctrl.r Integral High := arr Power Range Table[3,3].r Integral High; st I_Ctrl.r Integral Low := arr Power Range Table[3,3].r Integral Low; st I_Ctrl.udi Sec Delay High :=arr Power Range Table[3,3].udi Sec Delay High; st I_Ctrl.udi Sec Delay Low :=arr Power Range Table[3,3].udi Sec Delay Low; Contents of the output structures st Aggregate3, st Aggregate4,st Aggregate5 and st I_Ctrl. The variables of the output structures st Aggregate1, st Aggregate2 and st Aggregate6 have the value 0. st Aggregate3.i Aggregate Step :=1; st Aggregate3.r Y_Max := 0; st Aggregate3.r Y_Min :=0; st Aggregate3.b Block := FALSE; st Aggregate4.i Aggregate Step :=1; st Aggregate4.r Y_Max := 0; st Aggregate4.r Y_Min :=0; st Aggregate4.b Block := TRUE; st Aggregate5.i Aggregate Step :=1; st Aggregate5.r Y_Max := 0; st Aggregate5.r Y_Min :=0; st Aggregate5.b Block := FALSE; st I_Ctrl.r Integral High := 7; st I_Ctrl.r Integral Low := 7; st I_Ctrl.udi Sec Delay High :=400; st I_Ctrl.udi Sec Delay Low :=200; Output structure st I_Ctrl adjusted to the example TF8000 Version: 1.3.0 139
## Page 140

Programming Output structures st Aggregate1-6 adjusted to the example VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; i Number Of Profiles : INT; i Profile : INT; i Step : INT; e Ctrl Mode Profile : E_HVACCtrl Mode; i Manual Profile : INT; e Ctrl Mode Step : E_HVACCtrl Mode; i Manual Step : INT; i Number Of Aggregates : INT; b Reset : BOOL; 140 Version: 1.3.0 TF8000
## Page 141

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then all output variables and output structures are set constantly to 0. The checking of the variables i Number Of Profiles, i Profile, i Step, i Number Of Step In Profile, i Number Of Aggregates, arr Power Range Table[X,X].i Aggregate, arr Power Range Table[X,X].i Aggregate Steps, arr Power Range Table[i P,i S].udi Sec Delay High, and arr Power Range Table[i P,i S].udi Sec Delay Low remains active. If an error occurs, it is displayed with b Error = TRUE and can be acknowledged with b Reset once the fault has been corrected. i Number Of Profiles: The number of parameterized profiles in the power range table arr Power Range Table. The indication of the number of profiles must not be lower than g_i Min Number Of Profiles and must not be greater than g_i Max Number Of Profiles. Otherwise an error is indicated by b Error = TRUE and the execution of the function block is stopped. i Profile: Indicates the current profile with which the function block from the power range table arr Power Range Table [i Current Profile, i Current Step] is working. If e Ctrl Mode Profile = e HVACCtrl Mode_Auto, then i Current Profile = i Profile. The indication of the profile must not be lower than g_i Min Number Of Profiles and must not be greater than i Number Of Profiles. Otherwise an error is indicated by b Error = TRUE and the execution of the function block is stopped. i Step: Indicates the current step with which the function block from the power range table arr Power Range Table[i Current Profile, i Current Step] is working. If e Ctrl Mode Step = e HVACCtrl Mode_Auto, then i Current Step = i Step. The indication of the steps must not be smaller than g_i Min Number Of Steps and must not be greater than i Number Of Step In Profile. Otherwise an error is indicated by b Error = TRUE and the execution of the function block is stopped. e Ctrl Mode Profile: The input variable via which the profile from the power range table arr Power Range Table [i Current Profile, i Current Step] is specified is decided via this enum (see E_HVACCtrl Mode [} 489]). If e Ctrl Mode Profile = e HVACCtrl Mode_Auto, then i Current Profile = i Profile. If e Ctrl Mode Profile = e HVACCtrl Mode_Manual, then i Current Profile = i Manual Profile. i Manual Profile: Indicates which profile from the power range table arr Power Range Table[i Current Profile, i Current Step] is in use. If e Ctrl Mode Profile = e HVACCtrl Mode_Manual, then i Current Profile = i Manual Profile. The indication of the profile must not be lower than g_i Min Number Of Profiles and must not be greater than i Number Of Profiles. Otherwise i Manual Profile is set internally to g_i Min Number Of Profiles if it is lower than g_i Min Number Of Profiles or to i Number Of Profiles if it is greater than i Number Of Profiles. e Ctrl Mode Step: The input variable via which the steps from the power range table arr Power Range Table [i Current Profile, i Current Step] are specified is decided via this enum (see E_HVACCtrl Mode [} 489]). If e Ctrl Mode Step = e HVACCtrl Mode_Auto, then i Current Step = i Step. If e Ctrl Mode Step = e HVACCtrl Mode_Manual, then i Current Step = i Manual Step. TF8000 Version: 1.3.0 141
## Page 142

Programming i Manual Step: Indicates which step from the power range table arr Power Range Table[i Current Profile, i Current Step] is in use. If e Ctrl Mode Step = e HVACCtrl Mode_Manual, then i Current Step = i Manual Step. The indication of the steps must not be smaller than g_i Min Number Of Steps and must not be greater than i Number Of Step In Profile. Otherwise i Manual Step is set internally to g_i Min Number Of Steps if less than g_i Min Number Of Profiles or to i Number Of Step In Profile if greater than i Number Of Step In Profile. i Number Of Aggregates: i Number Of Aggregates specifies the number of units in the power generator sequence. For example, if i Number Of Aggregates = 4, then the parameters from the array arr Power Range Table are written to the output structures st Aggregate1-4, depending on the specification of i Current Step/i Current Profile. The specification must not be smaller than g_i Min Number Of Aggregates and must not be greater than g_i Max Number Of Aggregates. Otherwise an error is indicated by b Error = TRUE and the execution of the function block is stopped. b Reset: Input for acknowledgement of the faults once they have been corrected. Internally the system responds to a rising edge. VAR_OUTPUT b Enable Power Range Table : BOOL; i Number Of Step In Profile : INT; i Current Profile : INT; i Current Step : INT; st I_Ctrl : ST_HVACI_Ctrl; st Aggregate1 : ST_HVACAggregate; st Aggregate2 : ST_HVACAggregate; st Aggregate3 : ST_HVACAggregate; st Aggregate4 : ST_HVACAggregate; st Aggregate5 : ST_HVACAggregate; st Aggregate6 : ST_HVACAggregate; b Error : BOOL; e Error Code : E_HVACError Codes; i Error Pos Array Profile : INT; i Error Pos Array Step : INT; b Enable Power Range Table: Indicates that the function block is released. b Enable Power Range Table is TRUE if b Enable = TRUE AND b Error = FALSE. i Number Of Step In Profile: Indicates the number of parameterized steps from the specified profile i Current Profile of the power range table arr Power Range Table. Each individual step contains the parameter structure ST_HVACPower Range [} 497] needed for system control. Each profile can have up to 33 steps. The field for the steps in the power range table arr Power Range Table begins with 0 and ends with 32. The number of parameterized steps in a profile i Number Of Step In Profile is determined from step 1 upwards to step 32. The counting of the parameterized steps ends in the step in which all variables of the parameter structure ST_HVACPower Range [} 497] have the value 0. The minimum value that i Number Of Step In Profile can have is 1 and the maximum is 32. Step 0 is not taken into account, because the power generators are switched off in this step. The step can be considered to be a standby step. The values of the variables of the output structures st Aggregate1-6 then output the value 0. In the standby step, the parameters responsible for starting the power step sequence of the energy generators are transferred to the upstream controller FB_HVACI_Ctrl_Step [} 112] via the output structure st I_Ctrl. i Number Of Step In Profile can be used to limit the steps for other function blocks, such as for the input i Number Of Step In Profile of the function block FB_HVACI_Ctrl Step [} 112]. In turn, the output variable i Step of FB_HVACI_Ctrl Step [} 112] can be used to specify the step of the power range table FB_HVACPower Range Table via the input i Step. i Current Profile: Indicates the current profile with which the function block from the power range table arr Power Range Table [i Current Profile, i Current Step] is working. The indication depends on the input variables i Profile, i Manual Profile and e Ctrl Mode Profile. If e Ctrl Mode Profile = e HVACCtrl Mode_Auto, then i Current Profile = i Profile. If e Ctrl Mode Profile = e HVACCtrl Mode_Manual, then i Current Profile = i Manual Profile. i Current Step: Indicates the current power step with which the function block from the power range table arr Power Range Table[i Current Profile,i Current Step] is working. The most current step is always the highest step viewed from 1 upward. The indication depends on the input variables i Step, i Manual Step and e Ctrl Mode Step. If e Ctrl Mode Step = e HVACCtrl Mode_Auto, then i Current Step = i Step. If e Ctrl Mode Step = e HVACCtrl Mode_Manual, then i Current Step = i Manual Step. 142 Version: 1.3.0 TF8000
## Page 143

Programming st I_Ctrl: Output structure of the parameter ST_HVACI_Ctrl [} 495] for the function block FB_HVACI_Ctrl Step [} 112]. The values adopted by the variables of the output structure st I_Ctrl from the power range table arr Power Range Table depend on the selected profile and the current step. If the selected profile i Current Profile = 2 and the step i Current Step = 3, then the contents of the following variables from the power range table are written to the structure st I_Ctrl: st I_Ctrl.r Integral High := arr Power Range Table[i Current Profile, i Current Step].r Integral High; st I_Ctrl.r Integral Low := arr Power Range Table[i Current Profile, i Current Step].r Integral Low; st I_Ctrl.udi Sec Delay High :=arr Power Range Table[i Current Profile, i Current Step].udi Sec Delay High; st I_Ctrl.udi Sec Delay Low :=arr Power Range Table[i Current Profile, i Current Step].udi Sec Delay Low; st I_Ctrl.r Integral High := arr Power Range Table[2,3].r Integral High; st I_Ctrl.r Integral Low := arr Power Range Table[2,3].r Integral Low; st I_Ctrl.udi Sec Delay High :=arr Power Range Table[2,3].udi Sec Delay High; st I_Ctrl.udi Sec Delay Low :=arr Power Range Table[2,3].udi Sec Delay Low; st I_Ctrl.r Integral High: Positive value for the upper limit at which the integration of the I-transfer element is stopped. st I_Ctrl.r Integral Low: Positive value for the lower limit at which the integration of the I-transfer element is stopped. st I_Ctrl.udi Sec Delay High: Delay time after whose expiry the I-transfer element is activated. st I_Ctrl.udi Sec Delay Low: Delay time after whose expiry the I-transfer element is activated. st Aggregate1-6: Output structures of the parameter ST_HVACAggregate [} 494] for controlling units 1 to 6. i Number Of Aggregates specifies the number of units in the power generator sequence. The values adopted by the variables of the output structures st Aggregate1-6 from the power range table arr Power Range Table depend on the selected profile and the current step. If the selected profile i Current Profile = 8 and the step i Current Step = 5, then it is crucial that the variable arr Power Range Table[8, 5].i Aggregate has the value 1. The values parameterized in the power range table are then output via the output structure st Aggregate1. st Aggregate1.r Y_Max := arr Power Range Table[i Current Profile, i Current Step].r Y_Max; st Aggregate1.r Y_Min :=arr Power Range Table[i Current Profile, i Current Step].r Y_Min; st Aggregate1.i Aggregate Step :=arr Power Range Table[i Current Profile, i Current Step].i Aggregate Step; st Aggregate1.b Block := arr Power Range Table[i Current Profile, i Current Step].b Block; st Aggregate1.r Y_Max := arr Power Range Table[8,5].r Y_Max; st Aggregate1.r Y_Min :=arr Power Range Table[8,5].r Y_Min; st Aggregate1.i Aggregate Step :=arr Power Range Table[8,5].i Aggregate Step; st Aggregate1.b Block := arr Power Range Table[8,5].b Block; If the value of the variable arr Power Range Table [8,3].i Aggregate is also 1, then the values of the highest power step i Current Step = 5 are written to the corresponding output structure st Aggregate1, because arr Power Range Table [8,5].i Aggregate is also 1 here. Only if i Current Step = 3 does this mean that following values are output via the output structure st Aggregate1: st Aggregate1.r Y_Max := arr Power Range Table[8,3].r Y_Max; st Aggregate1.r Y_Min :=arr Power Range Table[8,3].r Y_Min; st Aggregate1.i Aggregate Step :=arr Power Range Table[8,3].i Aggregate Step; st Aggregate1.b Block := arr Power Range Table[8,3].b Block; If i Current Step = 4 and arr Power Range Table [8,4].i Aggregate = 2, then this means that the following values are output via the output structures st Aggregate1 and st Aggregate2: st Aggregate2.r Y_Max := arr Power Range Table[8,4].r Y_Max; st Aggregate2.r Y_Min :=arr Power Range Table[8,4].r Y_Min; st Aggregate2.i Aggregate Step :=arr Power Range Table[8,4].i Aggregate Step; st Aggregate2.b Block := arr Power Range Table[8,4].b Block; st Aggregate1.r Y_Max := arr Power Range Table[8,3].r Y_Max; st Aggregate1.r Y_Min :=arr Power Range Table[8,3].r Y_Min; st Aggregate1.i Aggregate Step :=arr Power Range Table[8,3].i Aggregate Step; st Aggregate1.b Block := arr Power Range Table[8,3].b Block; TF8000 Version: 1.3.0 143
## Page 144

Programming b Error: This output indicates with a TRUE that there is an error. The execution of the function block is stopped. The e Error Code enum indicates the error number. Once the fault has been corrected the b Error message must be acknowledged with b Reset. e Error Code: Returns the error number if a b Error output is set (see E_HVACError Codes [} 490]). The following errors can occur in this function block: e HVACError Codes_Invalid Param_i Step: Error when checking the specified steps. The value of i Step must be greater than or equal to g_i Min Number Of Steps or smaller than or equal to i Number Of Step In Profile. e HVACError Codes_Invalid Param_i Number Of Step In Profile: Error when checking the number of profiles, whether each of the specified profiles has parameterized steps. The profiles are checked in step 0. If none of the variable values of the structure ST_HVACPower Range [} 497] there is larger than 0, then there is an error. The variable i Error Pos Array Profile indicates the incorrect profile in the power range table arr Power Range Table[x1,x2]: x1 = i Error Pos Array Profile; e HVACError Codes_Invalid Param_i Number Of Aggregates: Error when checking the specified number of units. The value of i Number Of Aggregates must be smaller than g_i Min Number Of Aggregates and larger than g_i Max Number Of Aggregates. e HVACError Codes_Invalid Param_i Aggregate Steps: Error when checking the specified steps for the unit. The value of arr Power Range Table[x1,x2].i Aggregate Step must be greater than or equal to g_i Aggregate Min Number Of Steps and smaller than or equal to g_i Aggregate Max Number Of Steps. The variables i Error Pos Array Profile and i Error Pos Array Step indicate the incorrect point in the power range table arr Power Range Table[x1,x2]: x1 = i Error Pos Array Profile; x2 = i Error Pos Array Step e HVACError Codes_Invalid Param_i Number Of Profiles: Error when checking the number of profiles. The value of i Number Of Profiles must be greater than or equal to g_i Min Number Of Profiles and smaller than or equal to g_i Max Number Of Profiles. e HVACError Codes_Invalid Param_i Profile: Error when checking the specified profiles. The value of i Profile must be greater than or equal to g_i Min Number Of Profiles and smaller than or equal to i Number Of Profiles. e HVACError Codes_Invalid Param_i Aggregate: Error when checking the specified units. The value of arr Power Range Table[x1,x2].i Aggregate must be greater than or equal to g_i Min Number Of Aggregates and smaller than or equal to g_i Max Number Of Aggregates. The variables i Error Pos Array Profile and i Error Pos Array Step indicate the incorrect point in the power range table arr Power Range Table[x1,x2]: x1 = i Error Pos Array Profile; x2 = i Error Pos Array Step e HVACError Codes_Invalid Param_udi Sec Delay Up: Error when checking arr Power Range Table[x1,x2].udi Sec Delay Up. The value of arr Power Range Table[x1,x2].udi Sec Delay Up must not be larger than g_udi Max Sec. The variables i Error Pos Array Profile and i Error Pos Array Step indicate the incorrect point in the power range table arr Power Range Table[x1,x2]: x1 = i Error Pos Array Profile; x2 = i Error Pos Array Step e HVACError Codes_Invalid Param_udi Sec Delay Down: Error when checking arr Power Range Table[x1,x2].udi Sec Delay Down. The value of arr Power Range Table[x1,x2].udi Sec Delay Down must not be larger than g_udi Max Sec. The variables i Error Pos Array Profile and i Error Pos Array Step indicate the incorrect point in the power range table arr Power Range Table[x1,x2]: x1 = i Error Pos Array Profile; x2 = i Error Pos Array Step To access the enum error number in the PLC e Error Code [} 490] can assigned to a variable of data type WORD. e HVACError Codes_Invalid Param_i Step = 31, e HVACError Codes_Invalid Param_i Number Of Step In Profil = 32, e HVACError Codes_Invalid Param_i Number Of Aggregates = 33, e HVACError Codes_Invalid Param_i Aggregate Steps = 34, e HVACError Codes_Invalid Param_i Number Of Profiles = 35, e HVACError Codes_Invalid Param_i Profile = 36, e HVACError Codes_Invalid Param_i Aggregate = 39, e HVACError Codes_Invalid Param_udi Sec Delay Up = 40, e HVACError Codes_Invalid Param_udi Sec Delay Down = 41 i Error Pos Array Profile: The variable i Error Pos Array Profile indicates the profile in which the incorrect place in the power range table arr Power Range Table[i Error Pos Array Profile, i Error Pos Array Step] is to be found. If i Error Pos Array Profile > 0, then one of the following errors is present on e Error Code: 144 Version: 1.3.0 TF8000
## Page 145

Programming - e HVACError Codes_Invalid Param_i Number Of Step In Profile - e HVACError Codes_Invalid Param_i Aggregate Steps - e HVACError Codes_Invalid Param_i Aggregate - e HVACError Codes_Invalid Param_udi Sec Delay Up - e HVACError Codes_Invalid Param_udi Sec Delay Down The exact position of the step can be determined with the aid of the variable i Error Pos Array Step. Example 1 for the localization of an error: The following values are present on the output variables: b Error =TRUE; e Error Code= e HVACError Codes_Invalid Param_i Number Of Step In Profile; i Error Pos Array Profile = 2; No variable value of the structure ST_HVACPower Range [} 497] in profile 2 in step 0 of the power range table arr Power Range Table[2,x] is greater than 0. i Error Pos Array Step is not taken into account with this error. Example 2 for the localization of an error: The following values are present on the output variables: b Error =TRUE; e Error Code= e HVACError Codes_Invalid Param_i Aggregate Steps; i Error Pos Array Profile = 2; i Error Pos Array Step = 3; There is an incorrect value on the following variable in the power range table arr Power Range Table: arr Power Range Table[2,3].i Aggregate Step i Error Pos Array Step: If i Error Pos Array Profile > 0, then the variable i Error Pos Array Step indicates the step in the profile in which the incorrect place in the power range table is to be found. Example for the localization of an error: The following values are present on the output variables: b Error =TRUE; e Error Code= e HVACError Codes_Invalid Param_i Aggregate; i Error Pos Array Profile = 5; i Error Pos Array Step = 15; There is an incorrect value on the following variable in the power range table arr Power Range Table: arr Power Range Table[5,15].i Aggregate VAR_IN_OUT arr Power Range Table : ARRAY [1..g_i Max Number Of Profiles,0..g_i Max Number Of Steps] OF ST_HVACPower Range; arr Power Range Table: All information or parameters relevant to system control are summarized in the power range table arr Power Range Table. The power range table is a two-dimensional array with the structure ST_HVACPower Range [} 497]. The power range table can be compared to a normal table in that the horizontal entries are called lines and the vertical entries columns. An individual element is thus clearly designated by naming line and column. The field range 1..g_i Max Number Of Profiles of the power range table would be the vertical part, i.e. the columns. This range is called the profile and i Current Profile indicates which profile is being addressed. The field range 0..g_i Max Number Of Steps is regarded as the horizontal part, i.e. the lines. This range is called the step and i Current Step indicates which step is being addressed. The power range table consists of 16 profiles. Each profile can have up to 33 steps. Each individual step contains the parameter structure ST_HVACPower Range [} 497] needed for system control. The parameters indicated here are transferred via the output structures st I_Ctrl to the function block FB_HVACI_Ctrl Step [} 112] for controlling the steps and via st Aggregate1-6 to the function blocks for power generation. The number of steps in a profile is indicated by the output variable i Number Of Step In Profile. The number depends on the entries in the power range table and on the selected profile i Current Profile. The selected profile is checked internally in the function block from step 1 up to the step in which all variables of the TF8000 Version: 1.3.0 145
## Page 146

Programming structure ST_HVACPower Range [} 497] have the value 0. i Number Of Step In Profile is always intended only for the specified profile. Each profile can have up to 33 steps from 0 to 32; step 0 is not taken into account when evaluating the number of steps via i Number Of Step In Profile. Structure ST_HVACPower Range [} 497] arr Power Range Table[x,x].i Aggregate: Parameter that specifies to which output structure st Aggregate1-6 of the function block FB_HVACPower Range Table [} 135] the variables r Y_Min, r Y_Max, i Aggregate Step and b Block are written. arr Power Range Table[x,x].i Aggregate Step: Parameter that specifies the step in which the addressed unit should be fixed or should regulate; see b Block. i Aggregate Step is output via the structure st Aggregate X. arr Power Range Table[x,x].r Y_Max: Parameter specification for continuous units. r Y_Max is output via the structure st Aggregate X. arr Power Range Table[x,x].r Y_Min: Parameter specification for continuous units. r Y_Min is output via the structure st Aggregate X. arr Power Range Table[x,x].r Integral High: Positive value for the upper limit at which the integration of the I- transfer element is stopped; see the VAR_IN_OUT-Variable r Integral High in the FB_HVACI_Ctrl Step [} 112]. r Integral High is output via the structure st I_Ctrl. arr Power Range Table[x,x].r Integral Low : Positive value for the lower limit at which the integration of the I- transfer element is stopped; see the VAR_IN_OUT-Variable r Integral High in the FB_HVACI_Ctrl Step [} 112]. r Integral Low is output via the structure st I_Ctrl. arr Power Range Table[x,x].udi Sec Delay High: Delay time after whose expiry the I-transfer element is activated; see the VAR_IN_OUT-Variable udi Sec Delay High in the FB_HVACI_Ctrl Step [} 112]. udi Sec Delay High is output via the structure st I_Ctrl. arr Power Range Table[x,x].udi Sec Delay Low: Delay time after whose expiry the I-transfer element is activated; see the VAR_IN_OUT-Variable udi Sec Delay High in the FB_HVACI_Ctrl Step [} 112]. udi Sec Delay Low is output via the structure st I_Ctrl. arr Power Range Table[x,x].b Block: If b Block = FALSE, then the addressed unit is fixed in the specified step via i Aggregate Step. If b Block = TRUE, then the control of the addressed unit is released from the off step (0) to the specified step via i Aggregate Step. b Block is output via the structure st Aggregate X. The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.7 Sequence-Controller Introduction – sequence controller In heating, ventilation and air conditioning systems, it is often the case that several actuators, working in a so-called controller sequence, are used in order to achieve a control variable. In the air conditioning system shown below, four actuators are involved in the regulation of the supply air temperature. A dedicated sequence controller is instanced for each of these actuators in the HVAC library. During active control only one of these sequence controllers is active. The other, non-active controllers fix their control signal so that it is energetically optimal for the tempering of the supply air temperature. Depending on the control direction of the individual controller, this means either the maximum or the minimum for the control value r Y. If the effect of the active actuator (controller) is not sufficient when reaching an end position, the active controller switches to the adjacent controller to the left or right in the controller sequence. This then takes over control. The previously active controller remains at the end position of r Ymax or r Ymin, depending on 146 Version: 1.3.0 TF8000
## Page 147

Programming the control direction. This is repeated with the remaining actuators until the setpoint or the left or right end of the sequence is reached. In the sequence of the illustrated air conditioning system, all actuators that influence the control variable are shown from left to right. At the far left is the actuator that enables the greatest possible reduction of the control variable; at the far right is the actuator that effects the greatest possible increase of the control variable. Actuators that should drive in parallel or in opposite directions, e.g. outside air and circulating air dampers (HS2) are implemented once only. The individual actuators can have a positive control direction (more actuation results in a larger control variable, e.g. a heater) or a negative control direction (more actuation results in a smaller control variable, e.g. a cooler). Some actuators, e.g. a circulating air damper (HS1 & HS2), change their control direction during operation. Example: Supply air temperature regulation in an air conditioning system with an air cooler, a heat recovery unit, a mixed air chamber and an air heater, as shown in the diagram above. i My Number In Sequence 1. KS1 cooler 1 2. HS1 heat recovery 2 3. HS2 mixed air dampers 3 4. HS3 pre-heater 4 TF8000 Version: 1.3.0 147
## Page 148

Programming Each sequence controller is given the total number of controllers in the sequence. Four in this case. The PLC variable is called i Number Of Sequences in the function blocks. In addition each function block is given its own number. In the sequence i My Number In Sequence. The controllers are numbered from left to right in ascending order. Hence each controller knows which position it occupies within the sequence. The outer sequence controllers know that switching to a further sequence controller should not take place in the event of a residual control deviation. In the example, the controller FB_HVACPIDEnergy Recovery [} 168] would start control with the heat recovery unit in the event of the control variable being too small. All other actuators are closed. If the maximum or minimum position of the heat recovery unit has been reached, the controller switches to the damper controller FB_HVACPIDMixed Air [} 175]. The parameter e HVACSequence Ctrl Mode is thus raised to 3. If the control effect has still not been achieved and the mixed air damper has reached its limit (e.g. minimum outside air rate), the mixed air controller raises the value of e HVACSequence Ctrl Mode to 4. As a result the pre-heater or the sequence controller FB_HVACPIDPre Heating [} 178] respectively is activated. If the control variable is too high, the sequence is reversed until the cooler is activated by means of FB_HVACPIDCooling [} 162] being enabled. If the control value is at the lower or upper limit of a controller, the actual value of the controlled system oscillates around the setpoint with a small amplitude, frequent switching back and forth between two sequence controllers can be damped by an additional parameter for the switchover. To this end, the difference between the actual and setpoints of the controlled system is integrated after the sequence controller has reached its lower or upper limit. Switching to the next sequence only takes place if the sum of this integration is greater than the value of r Dead Range. Table of operation modes A further special feature of the sequence controller is its control by the Enum E_HVACSequence Ctrl Mode [} 492] Not only is the controller enabled by the Enum E_HVACSequence Ctrl Mode [} 492], it also transmits the operation mode of the air conditioning system to the controller blocks in the sequence. Depending on the operation modes, each sequence controller hence reacts specially to the Enum E_HVACSequence Ctrl Mode [} 492] as illustrated in the table. 148 Version: 1.3.0 TF8000
## Page 149

Programming Value of: 0 (Stop) 1 (On) 2 (night 3 (support 4 (overheat- 5 (night E_HVACSe- cooling) operation) ing protec- cooling and quence C- tion) overheating trl Mode protection) FB_HVACMa disabled 0 % Enable disabled 0 % Enable Enable Enable ster Sequenc r Y=Supply air r Y=Supply air r Y=Supply air e Ctrl min. temp. min. temp. max. temp. Master controller FB_HVACPI disabled 0 % Enable disabled 0 % Enable 0 % - disabled 0 % disabled 0 % DPre Heating 100 % Preheater FB_HVACPI disabled 0 % Enable disabled 0 % disabled 0 % disabled 0 % disabled 0 % DRe Heating Reheater FB_HVACPI disabled 0 % Enable disabled 0 % disabled 0 % Enable 0 % - Enable 0 % - DCooling 100 % 100 % Cooler FB_HVACPI disabled 0 % Enable disabled 0 % disabled 0 % disabled 0 % disabled 0 % DEnergy Rec overy Heat recovery FB_HVACPI disabled 0 % Enable max. outside 0 % air 0 % air max. outside DMixed Air air rate 100 circulation circulation air rate 100 Mixed air % only only % dampers 5.1.4.7.1 FB_HVAC2Point Ctrl Sequence This function block represents a 2-point sequence controller. It is used for sequential staged control of discontinuous units. If can be used for cascades of vessels and in sequences of refrigerating machines or recooling plants for controlling the power stages. For each power stage an instance of the function block is used. TF8000 Version: 1.3.0 149
## Page 150

Programming FB_HVAC2Point Ctrl Sequence can be used in a control sequence with other sequence controllers from Tc HVAC.lib. Depending on the application several actuators (stages) are used for reaching a controlled variable, which operate in a so-called control sequence. In the control sequence shown below four stages are enabled via the respective output b Out = TRUE of FB_HVAC2Point Ctrl Sequence. With active control only one of the 2- point sequence controllers is active at a time. The outputs of the non-active 2-point sequence controller are fixed. This means that depending on the control direction b Direction of the individual controller; b Out is either TRUE or FALSE. If the action of the active step is insufficient in the switched-on state, the active 2-point controller switches over to the neighboring 2-point controller on the left or right in the controller sequence via i Current Sequence. This then takes over control of the steps. The previously active controller remains in the end position b Out = TRUE or FALSE, depending on the control direction. Transfer function of the internal I-transfer element Through an internal AND link of the I-transfer element consisting of (t Ctrl_I_Ti_High Limit, t Ctrl_I_Ti_Low Limit, r Ctrl_I_High Limit, r Ctrl_I_Low Limit, st2Point Ctrl Sequence.r Ctrl_I_Out) and the delay times t Delay Increase Sequence/t Delay Decrease Sequence switching in the control sequence to the right or left is controlled via i Current Sequence. The active sequence controller is indicated via b Active Ctrl = TRUE (i Current Sequence = i My Number In Sequence). The I-transfer element and the timing elements for the delay times t Delay Increase Sequence/ t Delay Decrease Sequence are activated if b Active Ctrl = TRUE AND ( (*Decrease*) ( r X > st2Point Ctrl Sequence.r W_Max AND ((i My Number In Sequence <= 1) = FALSE) AND ( (b Direction = TRUE AND b Out = TRUE) OR (b Direction = FALSE AND b Out = FALSE) ) ) OR ( (*Increase*) r X < st2Point Ctrl Sequence.r W_Min AND((i My Number In Sequence >= i Number Of Sequences) = FALSE) AND ( (b Direction = FALSE AND b Out = TRUE) OR (b Direction = TRUE AND b Out = FALSE) ) ) ) Once the I-transfer element (st2Point Ctrl Sequence.r Ctrl_I_out output of the internal I-transfer element) AND the timing elements for the delay times t Delay Increase Sequence/t Delay Decrease Sequence have been activated, switching in the control sequence to the right or left via i Current Sequence is controlled as follows: i Current Sequence = i Current Sequence - 1 when st2Point Ctrl Sequence.r Ctrl_I_Out <= st2Point Ctrl Sequence.r Ctrl_I_Low Limit AND st2Point Ctrl Sequence.t Remaining Time Decrease Sequence = T#0s. i Current Sequence = i Current Sequence + 1 when st2Point Ctrl Sequence.r Ctrl_I_Out >= st2Point Ctrl Sequence.r Ctrl_I_High Limit AND st2Point Ctrl Sequence.t Remaining Time Increase Sequence = T#0s. 150 Version: 1.3.0 TF8000
## Page 151

Programming Behavior of the outputs of four FB_HVAC2Point Ctrl Sequence in a control sequence In the control sequence of four FB_HVAC2Point Ctrl Sequence controllers shown above there may be no gap in the allocation of i My Number In Sequence (1,2,3,4) and i Number Of Sequence (4), since otherwise automatic switching of the controllers from the active controller to the adjacent controller to the right or left in the control sequence would not work. If b Enable =FALSE OR b Error = TRUE OR (e2Point Ctrl Mode =e HVAC2Point Ctrl Mode_On_BMS OR e HVAC2Point Ctrl Mode_On_OP OR e HVAC2Point Ctrl Mode_Off_BMS OR e HVAC2Point Ctrl Mode_Off_OP), then the automatic switchover of the controller from the active controller to the neighboring controller on the left or right in the control sequence remains in operation. The switching mode is therefore always active. The active function block is displayed with b Active Ctrl = TRUE. Depending on the control deviation r E up- or down-switching of the sequence via i Current Sequence is directly executed. If r X >= r W, then i Current Sequence = i Current Sequence - 1. If r X < r W, then i Current Sequence = i Current Sequence + 1. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; e2Point Ctrl Mode : E_HVAC2Point Ctrl Mode; b Direction : BOOL; r W : REAL; r X : REAL; i Number Of Sequences : INT; i My Number In Sequence: INT; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. TF8000 Version: 1.3.0 151
## Page 152

Programming Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, the 2-point sequence controller is disabled. Validation of the variables i Number Of Sequences, i My Number In Sequence, i Current Sequence and t Ti_Ctrl_I is still active. If an error occurs, it is displayed with b Error = TRUE and can be acknowledged with b Reset once the fault has been corrected. e2Point Ctrl Mode: Enum that specifies the operation mode of the 2-point sequence controller (see E_HVAC2Point Ctrl Mode [} 487]). If b Enable = TRUE AND b Error = FALSE, then the output b Out can be switched on or off directly via the enum. On starting the PLC e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Auto_BMS. Up- or down-switching of the sequence via i Current Sequence does not depend on mode e2Point Ctrl Mode of the 2-point sequence controller. b Direction: b Direction determines the control direction of the internal 2-point controller. FALSE = heating mode; TRUE = cooling mode. r W: The setpoint is transferred with the r W variable. r X: The variable r X is used to transfer the actual value. i Number Of Sequences: Number of controllers in the sequence (1..32). If i Number Of Sequences <= 0 an error is issued and indicated with b Error = TRUE. The number of device in a sequence is not exceeded by the active sequence controller via i Current Sequence. i My Number In Sequence: The 2-point controller's own number in the sequence (1..32). If i My Number In Sequence > i Number Of Sequences OR i My Number In Sequence <= 0, then an error is output and indicated by b Error = TRUE. b Reset: Input for acknowledgement of the faults once they have been corrected. Internally the system responds to a rising edge. VAR_OUTPUT b Out : BOOL; b Active Ctrl : BOOL; b_r W_Max : BOOL; b_r W_Min : BOOL; r E : REAL; e2Point Ctrl State : E_HVAC2Point Ctrl Mode; st2Point Ctrl Sequence : ST_HVAC2Point Ctrl Sequence; b Error : BOOL; e Error Code : E_HVACError Codes; b Out: Output of the 2-point sequence controller. b Out becomes TRUE if 1. b Enable = TRUE AND b Error = FALSE AND ( e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Auto_BMS OR e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Auto_OP ) AND b Active Ctrl = TRUE AND ( 152 Version: 1.3.0 TF8000
## Page 153

Programming (b Direction = TRUE AND ( r X > st2Point Ctrl Sequence.r W_Max )) OR ( b Direction = FALSE AND ( r X < st2Point Ctrl Sequence.r W_Min )) ) 2. b Enable = TRUE AND b Error = FALSE AND ( e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Auto_BMS OR e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Auto_OP ) AND ( ( b Direction = TRUE AND ( i Current Sequence < i My Number In Sequence )) OR ( b Direction = FALSE AND ( i Current Sequence > i My Number In Sequence )) ) 3. b Enable = TRUE AND b Error = FALSE AND ( e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_On_BMS OR e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_On_OP ) b Out becomes FALSE if 1. b Enable = FALSE OR b Error = TRUE 2. b Enable = TRUE AND b Error = FALSE AND ( e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Auto_BMS OR e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Auto_OP ) AND b Active Ctrl = TRUE AND ( ( b Direction = TRUE AND ( r X < st2Point Ctrl Sequence.r W_Min )) OR ( b Direction = FALSE AND ( r X > st2Point Ctrl Sequence.r W_Max )) ) 3. b Enable = TRUE AND b Error = FALSE AND ( e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Auto_BMS OR e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Auto_OP ) AND ( ( b Direction = TRUE AND ( i Current Sequence > i My Number In Sequence )) OR ( b Direction = FALSE AND ( i Current Sequence < i My Number In Sequence )) ) 4. b Enable = TRUE AND b Error = FALSE AND ( e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Off_BMS OR e2Point Ctrl Mode = e HVAC2Point Ctrl Mode_Off_OP ) b Active Ctrl: b Active Ctrl indicates with TRUE that the function block is the active one in the sequence. b Active Ctrl goes TRUE if b Enable = TRUE, b Error = FALSE AND i Current Sequence = i My Number In Sequence. b_r W_Max: b_r W_Max goes TRUE if r X > st2Point Ctrl Sequence.r W_Max. b_r W_Min: b_r W_Min goes TRUE if r X < st2Point Ctrl Sequence.r W_Min. r E: Control deviation: r E = r W - r X e2Point Ctrl State: Enum that indicates the state of the operation mode e2Point Ctrl Mode of the 2-point sequence controller (see E_HVAC2Point Ctrl Mode [} 487]). st2Point Ctrl Sequence: The structure indicates various states, inputs and outputs of the function block (see ST_HVAC2Point Ctrl Sequence [} 494]). Furthermore the remaining times of the VAR_IN_OUT variables t Delay Increase Sequence and t Delay Decrease Sequence are output if their function is active. Via st2Point Ctrl Sequence.r Ctrl_I_Out the output signal of the internal I-transfer element is displayed. TF8000 Version: 1.3.0 153
## Page 154

Programming st2Point Ctrl Sequence.t Remaining Time Increase Sequence: Remaining time of delay time t Delay Increase Sequence. st2Point Ctrl Sequence.t Remaining Time Decrease Sequence: Remaining time of delay time t Delay Decrease Sequence. st2Point Ctrl Sequence.r X: State of r X. st2Point Ctrl Sequence.r W_Max: st2Point Ctrl Sequence.r W_Max := r W + r W_High Limit – upper setpoint limit; if r X exceeds it, the internal I-transfer element and the timing elements of the delay times t Delay Increase Sequence/t Delay Decrease Sequence can be activated or deactivated respectively, see Transfer function of the internal I-transfer element [} 150] in this document st2Point Ctrl Sequence.r W_Min: st2Point Ctrl Sequence.r W_Min := r W - r W_Low Limit – lower setpoint limit; if r X falls below it, the internal I-transfer element and the timing elements of the delay times t Delay Increase Sequence/t Delay Decrease Sequence can be activated or deactivated respectively, see Transfer function of the internal I-transfer element [} 150] in this document st2Point Ctrl Sequence.r E: Control deviation: r E = r W - r X st2Point Ctrl Sequence.r Ctrl_I_High Limit: Upper limit value at which the integration of the internal I-transfer element is stopped. st2Point Ctrl Sequence.r Ctrl_I_High Limit = r Ctrl_I_High Limit st2Point Ctrl Sequence.r Ctrl_I_Low Limit: Lower limit value at which the integration of the internal I-transfer element is stopped. st2Point Ctrl Sequence.r Ctrl_I_Low = r Ctrl_I_Low Limit * (-1) st2Point Ctrl Sequence.r Ctrl_I_Out: Output of the internal I-transfer element. If st2Point Ctrl Sequence.r Ctrl_I_Out = st2Point Ctrl Sequence.r Ctrl_I_High Limit OR st2Point Ctrl Sequence.r Ctrl_I_Low Limit AND either st2Point Ctrl Sequence.t Remaining Time Increase Sequence OR st2Point Ctrl Sequence.t Remaining Time Decrease Sequence = T#0s AND b Active = TRUE, then the number of the active controller i Current Sequence is incremented or decremented by 1, depending on b Direction. st2Point Ctrl Sequence.e2Point Ctrl State: see e2Point Ctrl State st2Point Ctrl Sequence.i Number Of Sequences: see i Number Of Sequences st2Point Ctrl Sequence.i My Number In Sequence: see i Number Of Sequences st2Point Ctrl Sequence.i Current Sequence: see i Current Sequence st2Point Ctrl Sequence.b Enable: see b Enable st2Point Ctrl Sequence.b Error: see b Error st2Point Ctrl Sequence.b Out: see b Out st2Point Ctrl Sequence.b Active Ctrl: see b Active Ctrl st2Point Ctrl Sequence.b_r W_Max: see b_r W_Max st2Point Ctrl Sequence.b_r W_Min: see b_r W_Min b Error: The output is TRUE if an error is active and one of the variables i Number Of Sequences, i My Number In Sequence or i Current Sequence has an incorrect parameter. Once the fault has been corrected the b Error message must be acknowledged with b Reset. The e Error Code enum indicates the error number. If b Error is TRUE, output b Out becomes FALSE. e Error Code: returns the error number if an output b Error is set (E_HVACError Codes [} 490] E_HVACError Codes). The following errors can occur in this function block: e HVACError Codes_Error_i My Number In Sequence, e HVACError Codes_Error_i Number Of Sequences, e HVACError Codes_Error_i Current Sequences 154 Version: 1.3.0 TF8000
## Page 155

Programming To access the enum error number in the PLC e Error Code [} 490] can assigned to a variable of data type WORD. e HVACError Codes_Error_i Number Of Sequences = 27 e HVACError Codes_Error_i My Number In Sequence = 28 e HVACError Codes_Error_i Current Sequences = 29 VAR_IN_OUT r W_High Limit : REAL; r W_Low Limit : REAL; t Delay Increase Sequence : TIME; t Delay Decrease Sequence : TIME; t Ctrl_I_Ti_High Limit : TIME; t Ctrl_I_Ti_Low Limit : TIME; r Ctrl_I_High Limit : REAL; r Ctrl_I_Low Limit : REAL; i Current Sequence : INT; r W_High Limit: Positive value of the upper control deviation limit. st2Point Ctrl Sequence.r W_Max =r W_Max := r W + r W_High Limit. The variable is saved persistently. Preset to 5. r W_Low Limit: Positive value of the lower control deviation limit. st2Point Ctrl Sequence.r W_Min =r W_Min := r W - r W_Low Limit. The variable is saved persistently. Preset to 5. t Delay Increase Sequence: Delay time after whose expiry i Current Sequence is incremented by 1, see Transfer function of the internal I-transfer element [} 150] in this document. The variable is saved persistently. Preset to 5 min. t Delay Decrease Sequence: Delay time after which i Current Sequence is decreased by 1, see Transfer function of the internal I-transfer element [} 150] in this document. The variable is saved persistently. Preset to 5 min. t Ctrl_I_Ti_High Limit: Integration time for the upper limit of the internal I-transfer element, see Transfer function of the internal I-transfer element [} 150] in this document. t Ctrl_I_Ti_High Limit must be > T#0s. The variable is saved persistently. Preset to 10 min. t Ctrl_I_Ti_Low Limit: Integration time for the lower limit of the internal I-transfer element, see Transfer function of the internal I-transfer element [} 150] in this document. t Ctrl_I_Ti_Low Limit must be > T#0s. The variable is saved persistently. Preset to 10 min. r Ctrl_I_High Limit: Positive value for the upper limit at which the integration of the internal I-transfer element is stopped (ARW measure, anti-reset windup), see Transfer function of the internal I-transfer element [} 150] in this document. The variable is saved persistently. Preset to 10. r Ctrl_I_Low Limit: Negative value for the lower limit at which the integration of the internal I-transfer element is stopped (ARW measure, anti-reset windup), see Transfer function of the internal I-transfer element [} 150] in this document. The variable is saved persistently. Preset to -10. i Current Sequence: Number of the active controller in the sequence (0..32). The number of devices in a sequence i Number Of Sequences is not exceeded by the active sequence controller over i Current Sequence. If i Current Sequence > i Number Of Sequences or i Current Sequence < 0 an error is indicated with b Error = TRUE. Up- or down-switching of the sequence via i Current Sequence depending on the control deviation r E takes place if the function block is active in the sequence b Active Ctrl = TRUE. 1. i Current Sequence = i Current Sequence - 1 if st2Point Ctrl Sequence.r Ctrl_I_Out >= st2Point Ctrl Sequence.r Limit_Ctrl_I_Min AND st2Point Ctrl Sequence.t Remaining Time Decrease Sequence = T#0s AND b Active Ctrl = TRUE 2. i Current Sequence = i Current Sequence + 1 if st2Point Ctrl Sequence.r Ctrl_I_Out >= st2Point Ctrl Sequence.r Limit_Ctrl_I_Max AND st2Point Ctrl Sequence.t Remaining Time Increase Sequence = T#0s AND b Active Ctrl = TRUE TF8000 Version: 1.3.0 155
## Page 156

Programming To ensure correct functioning of the automatic switchover of the controller from the active controller to the neighboring controller on the left or right in the control sequence, i Current Sequence may not be written to continuously from the outside in a control sequence. The active sequence controller must be defined when starting a control sequence. i Current Sequence must be written for one PLC cycle and must be > 0 and <= i Number Of Sequences. If b Enable =FALSE OR b Error = TRUE OR (e2Point Ctrl Mode =e HVAC2Point Ctrl Mode_On_BMS OR e HVAC2Point Ctrl Mode_On_OP OR e HVAC2Point Ctrl Mode_Off_BMS OR e HVAC2Point Ctrl Mode_Off_OP), then the automatic switchover of the controller from the active controller to the neighboring controller on the left or right in the control sequence remains in operation. The switching mode is therefore always active. The active function block is displayed with b Active Ctrl = TRUE. Depending on the control deviation r E up- or down-switching of the sequence via i Current Sequence is directly executed. If r X >= r W, then i Current Sequence = i Current Sequence - 1. If r X < r W, then i Current Sequence = i Current Sequence + 1. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.7.2 FB_HVACBasic Sequence Ctrl Unlike the sequence controllers FB_HVACPIDCooling [} 162], FB_HVACDehumidify [} 165], FB_HVACEnergy Recovery [} 168], FB_HVACPIDHumidify [} 171], FB_HVACPIDMixed Air [} 175], FB_HVACPIDPre Heating [} 178] and FB_HVACPIDRe Heating [} 181], the function block FB_HVACBasic Sequence Ctrl has no special system-specific extension or application. It is more general. The control direction of the controller is not automatically determined depending on the room air and outside air as is the case with the function blocks for heat recovery or the mixed air chamber. 156 Version: 1.3.0 TF8000
## Page 157

Programming A sequence of static heating and cooling ceiling can be implemented in the field of room automation with this function block. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; i Number Of Sequences : INT; i My Number In Sequence : INT; r W : REAL; r X : REAL; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; e Ctrl Mode : E_HVACCtrl Mode; r YManual : REAL; r Initial Value : REAL; b Reset Controller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: Input variable for enabling the controller. The controller is enabled if b Enable = TRUE. i Number Of Sequences: Number of sequence controllers in the system. i My Number In Sequence: The controller’s own number in the sequence. r W: The setpoint is transferred to the controller with the variable r W. r X: Actual value of the control loop. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: Cycle time with which the control loop is processed. This must be greater than or equal to Task Cycle Time. The function block uses this input variable to calculate internally whether the state and the output variables have to be updated in the current cycle. e Ctrl Mode: The operation mode is selected via this enum (see E_HVACCtrl Mode [} 489]). r YManual: Manual value. r Initial Value: The restart behavior of the controller is influenced by r Initial Value. b Reset Contoller: A positive edge on the input b Reset Controller resets the PID controller. b Reset: Acknowledge input in the event of a fault. TF8000 Version: 1.3.0 157
## Page 158

Programming VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Control signal output of the PID controller. r XW: Control deviation b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState) [} 493]. b Error: This output indicates with a TRUE that there is an error. e Error Code: Contains the command-specific error code (see E_HVACError Codes [} 490]). b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Dead Range : REAL; b Direction : BOOL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r Dead Band : REAL; r YMin : REAL; r YMax : REAL; i Current Sequence: INT; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range (0..32767) can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. b Direction: The control direction of the controller can be changed with the parameter b Direction. If b Direction is TRUE, then the direct control direction is active for cooling operation of the controller. If b Direction is FALSE, then the indirect control direction of the controller is activated for heating operation. The variable is saved persistently. Preset to FALSE. r Kp: Proportional factor amplification. The variable is saved persistently. Preset to 1. t Ti: Integration time. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. The variable is saved persistently. Preset to 30 s. t Tv: Rate time. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. 158 Version: 1.3.0 TF8000
## Page 159

Programming t Td: Damping time. The variable is saved persistently. Preset to 0 s. r Dead Band: If the control value is at the lower or upper limit of a controller and the actual value of the controlled system oscillates around the setpoint with a small amplitude, frequent switching back and forth between two sequence controllers can be avoided by an additional parameter for the switchover (0..32767). To this end, the difference between the actual and setpoints of the controlled system is integrated after the sequence controller has reached its lower or upper limit. Switching to the next sequence only takes place if the sum of this integration is greater than the value of r Deadband (See Example [} 506]). The variable is saved persistently. Preset to 0. r YMin: Lower limit of the working range of the controller. The variable is saved persistently. Preset to 0. r YMax: Upper limit of the working range of the controller. The variable is saved persistently. Preset to 100. i Current Sequence: Currently active controller in the sequence. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.7.3 FB_HVACMaster Sequence Ctrl Improved controllability can be achieved with the aid of the exhaust air or room temperature cascade control. The master controller measures the room or exhaust air temperature and adapts the setpoints for the supply air temperature to the room conditions. The setpoint for the supply air is limited by a minimum and a maximum value. In the backup mode of the air conditioning system (e Mode Seq Ctrl = e HVACSequence Ctrl Mode_Freeze Protection), the value of r YMax is switched directly through to the output r Y. If overheating protection is active (e Mode Seq Ctrl = e HVACSequence Ctrl Mode_ Overheating Protection), the value of r YMin is switched directly through to the output r Y. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; e Mode Seq Ctrl : E_HVACSequence Ctrl Mode; r W : REAL; TF8000 Version: 1.3.0 159
## Page 160

Programming r X : REAL; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; e Ctrl Mode : E_HVACCtrl Mode; r YManual : REAL; b Reset Controller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. e Mode Seq Ctrl: The system operation mode is transferred to the controller with the enum e Mode Seq Ctrl (see E_HVACSequence Ctrl Mode [} 492]). r X: Acquires the actual value of the control loop. r W: The setpoint is transferred to the controller with the variable r W. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: Cycle time with which the control loop is processed. This must be greater than or equal to t Task Cycle Time. The function block uses this input variable to calculate internally whether the state and the output variables have to be updated in the current cycle. e Ctrl Mode: The operation mode is selected via this Enum. Manual or automatic mode (see E_HVACCtrl Mode [} 489]). r YManual: Manual value for the manual operation mode. b Reset Controller: The internal variables of the PID controller are reset. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Set temperature value for the supply air temperature controller. r XW: Control deviation. 160 Version: 1.3.0 TF8000
## Page 161

Programming b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState [} 493]). b Error: This output indicates with a TRUE that there is an error. e Error Code: Contains the command-specific error code (see E_HVACError Codes [} 490]). b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Dead Range : REAL; r Initial Value : REAL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r YMin : REAL; r YMax : REAL; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range (0..32767) can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. r Initial Value: The restart behavior of the controller is influenced by r Initial Value (0..32767). The variable is saved persistently. Preset to 0. r Kp: Proportional factor amplification. The variable is saved persistently. Preset to 1. t Ti: Integration time. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper drive. The variable is saved persistently. Preset to 30 s. t Tv: Rate time. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. t Td: Damping time. The variable is saved persistently. Preset to 0 s. r YMin: Lower limit of the working range of the controller. The variable is saved persistently. Preset to 16. r YMax: Upper limit of the working range of the controller. The variable is saved persistently. Preset to 25. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 161
## Page 162

Programming 5.1.4.7.4 FB_HVACPIDCooling The control direction of the cooling controller is inverted compared to the heating controller. If the supply air setpoint is reduced, the sequence controller raises its control signal. In the operation mode Overheating Protection, the cooler regulates the supply air temperature to the minimum. Outside the normal sequence control operation the controller is also activated if overheating protection is active. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; e Mode Seq Ctrl : E_HVACSequence Ctrl Mode; i Number Of Sequences : INT; i My Number In Sequence : INT; r W : REAL; r X : REAL; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; e Ctrl Mode : E_HVACCtrl Mode; r YManual : REAL; b Reset Controller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. 162 Version: 1.3.0 TF8000
## Page 163

Programming NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. e Mode Seq Ctrl: Among other things, control is enabled via this enumeration (see E_HVACSequence Ctrl Mode [} 492]). In addition, the operation mode of the VAC system is transmitted to the controller blocks in the sequence. See also Table operation modes [} 508]. i Number Of Sequences: Number of sequence controllers in the system. i My Number In Sequence: The controller's own number from the sequence. r W: The setpoint is transferred to the controller with the variable r W. r X: Actual value of the control loop. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: The variable t Ctrl Cycle Time specifies the cycle time with which the PID controller is processed. The shortest possible cycle time is that of the controller. Since the controlled systems in building automation are predominantly slow, the cycle time of the controller can be several times that of the control cycle time. e Ctrl Mode: The operation mode is selected via this enumeration (see E_HVACCtrl Mode [} 489]). Manual or automatic operation mode. r YManual: Manual value that is set at the output r Y if e Ctrl Mode = e HVACCtrl Mode_Manual. b Reset Controller: A positive edge on the input b Reset Controller resets the PID controller. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Control signal output of the PID controller. r XW: Control deviation. b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState [} 493]). b Error: This output indicates with a TRUE that there is an error. e Error Code: E_HVACError Codes (see E_HVACError Codes [} 490]). TF8000 Version: 1.3.0 163
## Page 164

Programming b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Dead Range : REAL; r Initial Value : REAL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r Dead Band : REAL; r YMin : REAL; r YMax : REAL; i Current Sequence: INT; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. r Initial Value: The restart behavior of the controller is influenced by r Initial Value. The variable is saved persistently. Preset to 0. r Kp: Proportional factor amplification. The variable is saved persistently. Preset to 0. t Ti: Integration time. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. The variable is saved persistently. Preset to 30 s. t Tv: Rate time. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. t Td: Damping time. The variable is saved persistently. Preset to 0 s. r Dead Band: If the control value is at the lower or upper limit of a controller and the actual value of the controlled system oscillates around the set value with a small amplitude, frequent switching back and forth between two sequence controllers can be damped by an additional parameter for the switchover. To this end, the difference between the actual and set values of the controlled system is integrated after the sequence controller has reached its lower or upper limit. Switching to the next sequence only takes place if the sum of this integration is greater than the value of r Deadband (See Example [} 506]). The variable is saved persistently. Preset to 0. r YMin: Lower limit of the working range of the controller. The variable is saved persistently. Preset to 0. r YMax: Upper limit of the working range of the controller. The variable is saved persistently. Preset to 100. i Current Sequence: Number of the active controller from the sequence. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 164 Version: 1.3.0 TF8000
## Page 165

Programming 5.1.4.7.5 FB_HVACPIDDehumidify In order to dehumidify the supply air, it is cooled down by the cooler. The dehumidification is constantly controlled by dosing the coolant at the cooling register with the cooler valve. Two controllers, FB_HVACPIDCooling [} 162] and FB_HVACPIDDehumidify, act on the cooler valve. First of all the control signal r Y is relayed by FB_HVACPIDCooling [} 162] to the dehumidification sequence controller FB_HVACPIDDehumidify. Inside the FB_HVACPIDDehumidify function block, the larger of the two control signals is routed through to the controller output. If the air humidity is too high, the dehumidification controller takes precedence over the cooling controller. However, in order that the correct supply air temperature can still be achieved, the pre-heater is disabled if dehumidification is in operation. The reheater is put into operation in order to reheat the air. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; e Mode Seq Ctrl : E_HVACSequence Ctrl Mode; i Number Of Sequences : INT; i My Number In Sequence : INT; r W : REAL; r X : REAL; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; r YFrom PIDCooling : REAL; e Ctrl Mode : E_HVACCtrl Mode; r YManual : REAL; b Resetcontroller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. TF8000 Version: 1.3.0 165
## Page 166

Programming A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. e Mode Seq Ctrl: Among other things, control is enabled via this enum (see E_HVACSequence Ctrl Mode [} 492]). In addition, the operation mode of the VAC system is transmitted to the controller function block in the sequence. See also Table operation modes [} 508]. i Number Of Sequences: Number of sequence controllers in the system. i My Number In Sequence: The controller’s own number in the sequence. r W: The setpoint is transferred to the controller with the variable r W. r X: Actual value of the control loop. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: The variable t Ctrl Cycle Time specifies the cycle time with which the PID controller is processed. The shortest possible cycle time is that of the controller. Since the controlled systems in building automation are predominantly slow, the cycle time of the controller can be several times that of the control cycle time. r YFrom PIDCooling: In the case of a VAC system with dehumidification, the output of the cooling controller is connected to this input. Inside the function block FB_HVACPIDDehumidify there is a MAX selection that relays the larger of the control signals from the two controllers FB_HVACPIDDehumidify and FB_HVACPIDCooling to the cooler actuator valve. e Ctrl Mode: The operation mode is selected via this enum (see E_HVACCtrl Mode [} 489]). Manual or automatic operation mode. r YManual: Manual value that is set at the output r Y if e Ctrl Mode = e HVACCtrl Mode_Manual. b Reset Controller: A positive edge on the input b Reset Controller resets the PID controller. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Control signal output of the PID controller. r XW: Control deviation. 166 Version: 1.3.0 TF8000
## Page 167

Programming b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState [} 493]). b Error: This output indicates with a TRUE that there is an error. e Error Code: E_HVACError Codes (see E_HVACError Codes [} 490]). b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Dead Range : REAL; r Initial Value : REAL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r Dead Band : REAL; r YMin : REAL; r YMax : REAL; i Current Sequence: INT; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. r Initial Value: The restart behavior of the controller is influenced by r Initial Value. The variable is saved persistently. Preset to 0. r Kp: Proportional factor amplification. The variable is saved persistently. Preset to 0. t Ti: Integration time. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. The variable is saved persistently. Preset to 30 s. t Tv: Rate time. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. t Td: Damping time. The variable is saved persistently. Preset to 0 s. r Dead Band: If the control value is at the lower or upper limit of a controller and the actual value of the controlled system oscillates around the set value with a small amplitude, frequent switching back and forth between two sequence controllers can be damped by an additional parameter for the switchover. To this end, the difference between the actual and set values of the controlled system is integrated after the sequence controller has reached its lower or upper limit. Switching to the next sequence only takes place if the sum of this integration is greater than the value of r Deadband (See Example [} 506]). The variable is saved persistently. Preset to 0. r YMin: Lower limit of the working range of the controller. The variable is saved persistently. Preset to 0. r YMax: Upper limit of the working range of the controller. The variable is saved persistently. Preset to 100. i Current Sequence: Number of the active controller from the sequence. TF8000 Version: 1.3.0 167
## Page 168

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.7.6 FB_HVACPIDEnergy Recovery One of the special features of the heat recovery controller is the reversal of its control direction depending on the outside temperature and the exhaust air temperature. The enthalpies of the outside air and the exhaust air can be used instead of their temperatures. If the outside temperature is higher than the exhaust air temperature, the heat recovery system can use the exhaust air or room air, which was cooled with a high expenditure of energy, to cool the outside air. A reduction of the supply air temperature, leads in cooling mode to an increase in the control value for the heat recovery (curve falls from left to right). If the outside temperature is lower than the exhaust air temperature, the heat recovery system is used to feed the exhaust air heat back to the supply air. The heat recovery system is then in heating mode (curve rises from left to right). VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; e Mode Seq Ctrl : E_HVACSequence Ctrl Mode; i Number Of Sequences : INT; i My Number In Sequence : INT; r W : REAL; r X : REAL; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; r Outside Temp : REAL; r Return Air Temp : REAL; e Ctrl Mode : E_HVACCtrl Mode; 168 Version: 1.3.0 TF8000
## Page 169

Programming r YManual : REAL; b Reset Controller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. e Mode Seq Ctrl: Among other things, control is enabled via this enum (see E_HVACSequence Ctrl Mode [} 492]). In addition, the operation mode of the VAC system is transmitted to the controller function block in the sequence. See also Table operation modes [} 508]. i Number Of Sequences: Number of sequence controllers in the system. i My Number In Sequence: The controller’s own number in the sequence. r W: The setpoint is transferred to the controller with the variable r W. r X: Actual value of the control loop. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: The variable t Ctrl Cycle Time specifies the cycle time with which the PID controller is processed. The shortest possible cycle time is that of the controller. Since the controlled systems in building automation are predominantly slow, the cycle time of the controller can be several times that of the control cycle time. r Outside Temp: Outside temperature. r Return Air Temp: Exhaust air temperature. e Ctrl Mode: The operation mode is selected via this Enum. Manual or automatic mode (see E_HVACCtrl Mode [} 489]). r YManual: Manual value that is set at the output r Y if e Ctrl Mode = e HVACCtrl Mode_Manual. b Reset Controller: A positive edge on the input b Reset Controller resets the PID controller. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; TF8000 Version: 1.3.0 169
## Page 170

Programming b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Control signal output of the PID controller. r XW: Control deviation. b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState [} 493]). b Error: This output indicates with a TRUE that there is an error. e Error Code: E_HVACError Codes (see E_HVACError Codes [} 490]). b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Dead Range : REAL; r Initial Value : REAL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r Dead Band : REAL; r YMin : REAL; r YMax : REAL; i Current Sequence: INT; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. r Initial Value: The restart behavior of the controller is influenced by r Initial Value. The variable is saved persistently. Preset to 0. r Kp: Proportional factor amplification. The variable is saved persistently. Preset to 0. t Ti: Integration time. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. The variable is saved persistently. Preset to 30 s. t Tv: Rate time. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. t Td: Damping time. The variable is saved persistently. Preset to 0 s. r Dead Band: If the control value is at the lower or upper limit of a controller and the actual value of the controlled system oscillates around the set value with a small amplitude, frequent switching back and forth between two sequence controllers can be damped by an additional parameter for the switchover. To this end, the difference between the actual and set values of the controlled system is integrated after the sequence controller has reached its lower or upper limit. Switching to the next sequence only takes place if the sum of this integration is greater than the value of r Deadband (See Example [} 506]). The variable is saved persistently. Preset to 0. 170 Version: 1.3.0 TF8000
## Page 171

Programming r YMin: Lower limit of the working range of the controller. The variable is saved persistently. Preset to 0. r YMax: Upper limit of the working range of the controller. The variable is saved persistently. Preset to 100. i Current Sequence: Number of the active controller from the sequence. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.7.7 FB_HVACPIDHumidify Besides the temperature, the humidity of the air is also controlled in some air conditioning systems. Steam humidifiers or air washers are used for humidification. For dehumidification the supply air can be cooled down to the dew point by a cooler. As a result, the moisture in the air condenses on the air cooler. The control of humidification and dehumidification is realized with a sequence incuding a humidification controller and a dehumidification controller. TF8000 Version: 1.3.0 171
## Page 172

Programming PID humidification controller This function block is a special application of a PID controller. The humidity controller is only enabled if the function block input b Humidistat is TRUE. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; e Mode Seq Ctrl : E_HVACSequence Ctrl Mode; i Number Of Sequences : INT; i My Number In Sequence : INT; r W : REAL; r X : REAL; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; b Humidistat : BOOL; e Ctrl Mode : E_HVACCtrl Mode; r YManual : REAL; b Reset Contoller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. e Mode Seq Ctrl: Among other things, control is enabled via this enum (see E_HVACSequence Ctrl Mode [} 492]). In addition, the operation mode of the VAC system is transmitted to the controller blocks in the sequence. See also Table operation modes [} 508]. 172 Version: 1.3.0 TF8000
## Page 173

Programming i Number Of Sequences: Number of sequence controllers in the system. i My Number In Sequence: The controller’s own number in the sequence. r W: The setpoint is transferred to the controller with the variable r W. r X: Actual value of the control loop. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: The variable t Ctrl Cycle Time specifies the cycle time with which the PID controller is processed. The shortest possible cycle time is that of the controller. Since the controlled systems in building automation are predominantly slow, the cycle time of the controller can be several times that of the control cycle time. b Humidistat: A TRUE on this input enables the humidity control. The hygrostat is connected to this input so that over-humidification cannot occur. e Ctrl Mode: The operation mode is selected via this Enum. Manual or automatic mode (see E_HVACCtrl Mode [} 489]). r YManual: Manual value that is set at the output r Y if e Ctrl Mode = e HVACCtrl Mode_Manual. b Reset Controller: A positive edge on the input b Reset Controller resets the PID controller. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Control signal output of the PID controller. r XW: Control deviation. b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState [} 493]). b Error: This output indicates with a TRUE that there is an error. e Error Code: E_HVACError Codes (see E_HVACError Codes [} 490]). b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Dead Range : REAL; r Initial Value : REAL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r Dead Band : REAL; TF8000 Version: 1.3.0 173
## Page 174

Programming r YMin : REAL; r YMax : REAL; i Current Sequence: INT; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. r Initial Value: The restart behavior of the controller is influenced by r Initial Value. The variable is saved persistently. Preset to 0. r Kp: Proportional factor amplification. The variable is saved persistently. Preset to 0. t Ti: Integration time. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. The variable is saved persistently. Preset to 30 s. t Tv: Rate time. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. t Td: Damping time. The variable is saved persistently. Preset to 0 s. r Dead Band: If the control value is at the lower or upper limit of a controller and the actual value of the controlled system oscillates around the set value with a small amplitude, frequent switching back and forth between two sequence controllers can be damped by an additional parameter for the switchover. To this end, the difference between the actual and set values of the controlled system is integrated after the sequence controller has reached its lower or upper limit. Switching to the next sequence only takes place if the sum of this integration is greater than the value of r Deadband (See Example [} 506]). The variable is saved persistently. Preset to 0. r YMin: Lower limit of the working range of the controller. The variable is saved persistently. Preset to 0. r YMax: Upper limit of the working range of the controller. The variable is saved persistently. Preset to 100. i Current Sequence: Number of the active controller from the sequence. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 174 Version: 1.3.0 TF8000
## Page 175

Programming 5.1.4.7.8 FB_HVACPIDMixed Air One of the special features of the mixed air controller is the reversal of its control direction depending on the outside temperature and the exhaust air temperature. The enthalpies of the outside air and the exhaust air can be used instead of their temperatures. If the outside temperature is lower than the exhaust air temperature, the air can be used for cooling in the case of high thermal loads inside the building. Hence, the outside air rate increases as the control variable or the supply air temperature setpoint decreases (curve falls from left to right). If the outside temperature is higher than the exhaust air temperature, the outside air proportion can be increased in the event of the supply air temperature setpoint being increased (curve rises from left to right). The outside air temperature is applied to the input variable r Outside Temp. The variable r Return Air Temp is for the exhaust air or room temperature. The Night Cooling operation mode (e HVACSequence Ctrl Mode_Night Cooling) is transmitted to the function block by means of the Enum e Mode Seq Ctrl [} 492]. During night cooling the control is deactivated and 100 % control value is output at r Y. Further information on the Summer Night Cooling function can be found under FB_HVACSummer Night Cooling [} 450]. The maximum and minimum outside air rates can be set with the parameters r YMax and r YMin. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; e Mode Seq Ctrl : E_HVACSequence Ctrl Mode; i Number Of Sequences : INT; i My Number In Sequence : INT; r W : REAL; r X : REAL; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; r Outside Temp : REAL; r Return Air Temp : REAL; e Ctrl Mode : E_HVACCtrl Mode; TF8000 Version: 1.3.0 175
## Page 176

Programming r YManual : REAL; r YMin : REAL; b Reset Controller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. e Mode Seq Ctrl: Among other things, control is enabled via this enum (see E_HVACSequence Ctrl Mode [} 492]). In addition, the operation mode of the VAC system is transmitted to the controller blocks in the sequence. See also Table operation modes [} 508]. i Number Of Sequences: Number of sequence controllers in the system. i My Number In Sequence: The controller’s own number from the sequence. r W: The setpoint is transferred to the controller with the variable r W. r X: Actual value of the control loop. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: The variable t Ctrl Cycle Time specifies the cycle time with which the PID controller is processed. The shortest possible cycle time is that of the controller. Since the controlled systems in building automation are predominantly slow, the cycle time of the controller can be several times that of the control cycle time. r Outside Temp: Outside temperature r Return Air Temp: Exhaust air temperature e Ctrl Mode: The operation mode is selected via this enum (see E_HVACCtrl Mode [} 489]). Manual or automatic operation mode. r YManual: Manual value that is set at the output r Y if e Ctrl Mode = e HVACCtrl Mode_Manual. r YMin: Lower limit of the working range of the controller. b Reset Controller: A positive edge on the input b Reset Controller resets the PID controller. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; 176 Version: 1.3.0 TF8000
## Page 177

Programming b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Control signal output of the PID controller. r XW: Control deviation. b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState [} 493]). b Error: This output indicates with a TRUE that there is an error. e Error Code: E_HVACError Codes (see E_HVACError Codes [} 490]). b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Dead Range : REAL; r Initial Value : REAL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r Dead Band : REAL; r YMax : REAL; i Current Sequence: INT; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. r Initial Value: The restart behavior of the controller is influenced by r Initial Value. The variable is saved persistently. Preset to 0. r Kp: Proportional factor amplification. The variable is saved persistently. Preset to 0. t Ti: Integration time. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. The variable is saved persistently. Preset to 30 s. t Tv: Rate time. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. t Td: Damping time. The variable is saved persistently. Preset to 0 s. r Dead Band: If the control value is at the lower or upper limit of a controller and the actual value of the controlled system oscillates around the setpoint with a small amplitude, frequent switching back and forth between two sequence controllers can be damped by an additional parameter for the switchover. To this end, the difference between the actual and setpoints of the controlled system is integrated after the TF8000 Version: 1.3.0 177
## Page 178

Programming sequence controller has reached its lower or upper limit. Switching to the next sequence only takes place if the sum of this integration is greater than the value of r Deadband (See Example [} 506]). The variable is saved persistently. Preset to 0. r YMax: Upper limit of the working range of the controller. The variable is saved persistently. Preset to 100. i Current Sequence: Number of the active controller from the sequence. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.7.9 FB_HVACPIDPre Heating This function block is a special application of a PID controller. Besides the PID control algorithm, the block contains the conditions for changing to the sequence of the previous or next sequence controller. A special feature of the pre-heating controller is the input r YDehumidify. As soon as the signal of r YDehumidify is greater than zero, the preheater is disabled and the value of i Current Sequence is incremented by one. As a result of this the reheater FB_HVACPIDRe Heating [} 181] is activated in place of the preheater. If the value of r YDehumidify returns to zero, the preheater is automatically reactivated. Outside the normal sequence control operation the controller is also activated in the case of backup operation (freeze protection). VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; e Mode Seq Ctrl : E_HVACSequence Ctrl Mode; i Number Of Sequences : INT; i My Number In Sequence : INT; r W : REAL; r X : REAL; 178 Version: 1.3.0 TF8000
## Page 179

Programming t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; r YDehumidify : REAL; e Ctrl Mode : E_HVACCtrl Mode; r YManual : REAL; r Initial Value : REAL; b Reset Controller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. e Mode Seq Ctrl: Among other things, control is enabled via this enum (see E_HVACSequence Ctrl Mode [} 492]). In addition, the operation mode of the VAC system is transmitted to the controller function block in the sequence. See also Table operation modes [} 508]. i Number Of Sequences: Number of sequence controllers in the system. i My Number In Sequence: The controller’s own number in the sequence. r W: The setpoint is transferred to the controller with the variable r W. r X: Actual value of the control loop. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: The variable t Ctrl Cycle Time specifies the cycle time with which the PID controller is processed. The shortest possible cycle time is that of the controller. Since the controlled systems in building automation are predominantly slow, the cycle time of the controller can be several times that of the control cycle time. r YDehumidify: In the case of an VAC system with dehumidification, the control value of the dehumidification controller FB_HVACPIDDehumidify [} 165] is connected to this input. If the value of r YDehumidify > 0, then the VAR_IN_OUT variable i Current Sequence will be increased automatically by one. In dehumidification mode the system will thus be switched from the preheater FB_HVACPIDPre Heating to the reheater FB_HVACPIDRe Heating. e Ctrl Mode: The operation mode is selected via this enum (see E_HVACCtrl Mode [} 489]). Manual or automatic operation mode. r YManual: Manual value that is set at the output r Y if e Ctrl Mode = e HVACCtrl Mode_Manual. r Initial Value: The restart behavior of the controller is influenced by r Initial Value. b Reset Controller: A positive edge on the input b Reset Controller resets the PID controller. b Reset: Acknowledge input in the event of a fault. TF8000 Version: 1.3.0 179
## Page 180

Programming VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Control signal output of the PID controller. r XW: Control deviation. b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState [} 493]). b Error: This output indicates with a TRUE that there is an error. e Error Code: E_HVACError Codes (see E_HVACError Codes [} 490]). b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Dead Range : REAL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r Dead Band : REAL; r YMin : REAL; r YMax : REAL; i Current Sequence: INT; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. r Kp: Proportional factor amplification. The variable is saved persistently. Preset to 0. t Ti: Integration time. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. The variable is saved persistently. Preset to 30 s. t Tv: Rate time. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. t Td: Damping time. The variable is saved persistently. Preset to 0 s. r Dead Band: If the control value is at the lower or upper limit of a controller and the actual value of the controlled system oscillates around the setpoint with a small amplitude, frequent switching back and forth between two sequence controllers can be damped by an additional parameter for the switchover. To this end, the difference between the actual and setpoints of the controlled system is integrated after the 180 Version: 1.3.0 TF8000
## Page 181

Programming sequence controller has reached its lower or upper limit. Switching to the next sequence only takes place if the sum of this integration is greater than the value of r Deadband (See Example [} 506]). The variable is saved persistently. Preset to 0. r YMin: Lower limit of the working range of the controller. The variable is saved persistently. Preset to 0. r YMax: Upper limit of the working range of the controller. The variable is saved persistently. Preset to 100. i Current Sequence: Number of the active controller from the sequence. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.4.7.10 FB_HVACPIDRe Heating The reheater is used to reheat the supply air that was cooled down by the cooler for dehumidification. The controller can only be enabled within the normal sequence control operation. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; e Mode Seq Ctrl : E_HVACSequence Ctrl Mode; i Number Of Sequences : INT; i My Number In Sequence : INT; r W : REAL; r X : REAL; t Task Cycle Time : TIME; t Ctrl Cycle Time : TIME; r YDehumidify : REAL; e Ctrl Mode : E_HVACCtrl Mode; TF8000 Version: 1.3.0 181
## Page 182

Programming r YManual : REAL; b Reset Controller : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. e Mode Seq Ctrl: Among other things, control is enabled via this enum (see E_HVACSequence Ctrl Mode [} 492]). In addition, the operation mode of the VAC system is transmitted to the controller blocks in the sequence. See also Table operation modes. [} 508] i Number Of Sequences: Number of sequence controllers in the system. i My Number In Sequence: The controller’s own number in the sequence. r W: The setpoint is transferred to the controller with the variable r W. r X: Actual value of the control loop. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. t Ctrl Cycle Time: The variable t Ctrl Cycle Time specifies the cycle time with which the PID controller is processed. The shortest possible cycle time is that of the controller. Since the controlled systems in building automation are predominantly slow, the cycle time of the controller can be several times that of the control cycle time. r YDehumidify: Constant value. e Ctrl Mode: The operation mode is selected via this enum (see E_HVACCtrl Mode [} 489]). Manual or automatic operation mode. r YManual: Manual value that is set at the output r Y if e Ctrl Mode = e HVACCtrl Mode_Manual. b Reset Controller: A positive edge on the input b Reset Controller resets the PID controller. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Y : REAL; r XW : REAL; b Max Limit : BOOL; b Min Limit : BOOL; b Active : BOOL; b ARWactive : BOOL; e State : E_HVACState; 182 Version: 1.3.0 TF8000
## Page 183

Programming b Error : BOOL; e Error Code : E_HVACError Codes; b Invalid Parameter : BOOL; r Y: Control signal output of the PID controller. r XW: Control deviation. b Max Limit: The output b Max Limit is TRUE if the output r Y has reached the value r YMax. b Min Limit: The output b Min Limit is TRUE if the output r Y has reached the value r YMin. b Active: b Active is TRUE if the controller is active and enabled. b ARWactive: b ARWactive is TRUE if the integral component of the controller has reached the lower or upper control variable limit. e State: State of the controller (see E_HVACState [} 493]). b Error: This output indicates with a TRUE that there is an error. e Error Code: E_HVACError Codes (see E_HVACError Codes [} 490]). b Invalid Parameter: TRUE if an error has occurred during the plausibility check. The message must be acknowledged with b Reset. VAR_IN_OUT r Dead Range : REAL; r Initial Value : REAL; r Kp : REAL; t Ti : TIME; t Tv : TIME; t Td : TIME; r Dead Band : REAL; r YMin : REAL; r YMax : REAL; i Current Sequence: INT; r Dead Range: In order to avoid unnecessary driving and hence premature wear of the valves or damper drives, a dead range can be set for the controller output signal r Y. This means that a control signal change is only active if the change of value is greater than the dead range. A constant change of the control signal r Y is converted to a pulsating drive of the actuator if a dead range is specified. The larger the dead range the larger the pauses and the control signal jumps will be. The variable is saved persistently. Preset to 0. r Initial Value: The restart behavior of the controller is influenced by r Initial Value. The variable is saved persistently. Preset to 0. r Kp: Proportional factor amplification. The variable is saved persistently. Preset to 0. t Ti: Integration time. The I-component corrects the residual control deviation following correction of the P- component. The smaller the t Ti time is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. The variable is saved persistently. Preset to 30 s. t Tv: Rate time. The larger t Tv is, the stronger the controller corrects. The control loop becomes unstable if the time is too long. Often in normal building automation applications only a PI controller is used. In this case zero must be entered for t Tv. The variable is saved persistently. Preset to 0 s. t Td: Damping time. The variable is saved persistently. Preset to 0 s. r Dead Band: If the control value is at the lower or upper limit of a controller and the actual value of the controlled system oscillates around the set value with a small amplitude, frequent switching back and forth between two sequence controllers can be damped by an additional parameter for the switchover. To this end, the difference between the actual and set values of the controlled system is integrated after the sequence controller has reached its lower or upper limit. Switching to the next sequence only takes place if the sum of this integration is greater than the value of r Deadband (See Example [} 506]). The variable is saved persistently. Preset to 0. TF8000 Version: 1.3.0 183
## Page 184

Programming r YMin: Lower limit of the working range of the controller. The variable is saved persistently. Preset to 0. r YMax: Upper limit of the working range of the controller. The variable is saved persistently. Preset to 100. i Current Sequence: Number of the active controller from the sequence. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5 HVAC Room Functions 5.1.5.1 Air conditioning 5.1.5.1.1 FB_BAREnergy Level This function block is for the adaptation of the supply of energy for the use of the building. The type of room utilization is set by the BMS. The longer a building or room is not used, the further the energy level can be lowered. The energy level currently selected by the function block is transferred to the room temperature controller. Protection: This operation mode is activated in the case of long absence times e.g. during works holidays or also when a window is open. The energy level is very low and serves only to protect the building from damage caused by frost or overheating. Economy: The Economy energy level is used for the economy mode. Economy mode is activated, for example, at night by a scheduler. Pre Comfort: The Pre Comfort energy level is for an unused room which, however, can be occupied again shortly. The standby mode is frequently activated by a timer schedule. Comfort: If the room is occupied, it is in Comfort mode. Comfort mode can be activated by a scheduler or by presence. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b Window : BOOL; b Protection : BOOL; 184 Version: 1.3.0 TF8000
## Page 185

Programming b Economy : BOOL; b Pre Comfort : BOOL; b Comfort : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is activated by a TRUE at this input. b Window: The window contact is connected to this input. TRUE means that the window is OPEN. FALSE means that the window is CLOSED. b Protection: Protection mode is activated with the input b Protection. Protection mode is active if the input is TRUE. b Economy: Economy mode is activated with the input b Economy. Economy mode is active if the input is TRUE. b Pre Comfort: The Pre-comfort level is activated with this input. The Pre-comfort level is active if the input is TRUE. b Comfort: The Comfort level is activated with this input if the room is occupied. VAR_OUTPUT e Energy Level : E_BAREnergy Level; b State Protection : BOOL; b State Economy : BOOL; b State Pre Comfort : BOOL; b State Comfort : BOOL; e Energy Level: This output contains the current energy level (see E_BAREnergy Level [} 498]). b State Protection: The state of the b Protection input is relayed to the outside in the operation modes e BAREnergy Level_AUTO_I and e BAREnergy Level_AUTO_II. b State Economy: The state of the b Economy input is relayed to the outside in the operation modes e BAREnergy Level_AUTO_I and e BAREnergy Level_AUTO_II. b State Pre Comfort: The state of the b Pre Comfort input is relayed to the outside in the operation modes e BAREnergy Level_AUTO_I and e BAREnergy Level_AUTO_II. b State Comfort: The state of the b Comfort input is relayed to the outside in the operation modes e BAREnergy Level_AUTO_I and e BAREnergy Level_AUTO_II. VAR_IN_OUT e Ctrl Mode : E_BAREnergy Level; TF8000 Version: 1.3.0 185
## Page 186

Programming e Ctrl Mode: Using this ENUM the operation mode can be preselected from the building management level (see E_BAREnergy Level [} 498]). The variable is saved persistently. Preset to automatic. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.1.2 FB_BARFan Coil The function block maps a 3-speed fan with the corresponding switching hysteresis, which is the same for all three speeds. The speed is set stepwise via the control deviation of the actual room temperature value from the set room temperature value. Furthermore there is a possibility to manually override the fan controller via the i Stage Manual or b Stage Up or b Stage Down input. A minimum switch-on time can be set via the udi Sec MINPower On Time input, which is then valid for each stage. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; e Ctrl Fct : E_BARCtrl Fct; r Setpoint : REAL; r Room Temp : REAL; b Stage Up : BOOL; b Stage Down : BOOL; i Stage Manual : INT; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip 186 Version: 1.3.0 TF8000
## Page 187

Programming If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is activated if the variable b Enable is TRUE. No fan stage is activated with a FALSE. e Ctrl Fct: This input is connected to the output e Ctrl Fct [} 498] of FB_BARFct Selection. This information is important in order to know whether the plant is in heating or cooling mode. In automatic mode the fan stages are only activated, for example, if according to the control deviation the requirement for heating is active and the system is in heating mode, or if according to the control deviation the requirement for cooling is active and the system is in cooling mode. r Setpoint: Input for the set temperature. r Room Temp: Input for the room temperature. b Stage Up: Local adjustment of the fan stage, stepwise increase by pushbutton. b Stage Down: Local adjustment of the fan stage, stepwise decrease by pushbutton. i Stage Manual: The manual fan stage can be/is centrally adjusted via this input. i Stage Manual: = 0, corresponds to the fan stage OFF i Stage Manual: = 1, corresponds to the fan stage AUTO i Stage Manual: = 2, corresponds to fan stage 01 active i Stage Manual: = 3, corresponds to fan stage 02 active i Stage Manual: = 4, corresponds to fan stage 03 active b Reset: Acknowledge input in case of a fault or an incorrect parameter. VAR_OUTPUT b Stage Off : BOOL; b Stage Auto : BOOL; b Stage01 : BOOL; b Stage02 : BOOL; b Stage03 : BOOL; b Fan Coil Active : BOOL; b Presence : BOOL; by State : BYTE; by Error : BYTE; udi Sec RT_MINPower On Time : UDINT; udi RT_Time Period : UDINT; b Invalid Parameter : BOOL; b Stage Off: TRUE, fan stages are switched off. b Stage Auto: TRUE, fan controller is in automatic mode. b Stage01: TRUE, fan stage 01 active. b Stage02: TRUE, fan stage 02 active. b Stage03: TRUE, fan stage 03 active. b Fan Coil Active: TRUE if one of the three fan stages is active. This output can be/is used to enable controllers in order to avoid a build up of heat or cold. b Presence: TRUE means that presence was detected via the b Stage Up, b Stage Down or i Stage Manual inputs. by State: Indicates the state of the fan controller. by State.0: = function block is activated by State.3: = manual fan stage specification is active TF8000 Version: 1.3.0 187
## Page 188

Programming by State.4:= b Reset by State.5 = fan stage 01 active by State.6 = fan stage 02 active by State.7 = fan stage 03 active by Error: Output of the error as a byte. by Error.1:= b Invalid Parameter udi Sec RT_MINPower On Time: Indicates the remaining time of the minimum switch-on time. udi RT_Time Period: Indicates the remaining time of the manual override. b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT r Deviation XW_Stage01 : REAL; r Deviation XW_Stage02 : REAL; r Deviation XW_Stage03 : REAL; r Hysteresis Range : REAL; udi Sec MINPower On Time : UDINT; i Fct Mode Fan Coil : INT; udi Time Period : UDINT; r Deviation XW_Stage01: Limit value of the control deviation for fan stage 01. The variable is saved persistently. Preset to 0.7. r Deviation XW_Stage02: Limit value of the control deviation for fan stage 02. The variable is saved persistently. Preset to 1.7. r Deviation XW_Stage03: Limit value of the control deviation for fan stage 03. The variable is saved persistently. Preset to 2.1. r Hysteresis Range: Hysteresis range placed around the limit value. Example: A limit value of 0.7 and a hysteresis range of 0.2 results in fan stage 01 being switched on at a control deviation of > 0.8. At a control deviation of < 0.6 fan stage 01 is switched off. The variable is saved persistently. Preset to 0.2. udi Sec MINPower On Time: Minimum switch-on time that a fan must run for in a stage before switching to a different stage or switching off. Input in seconds (e.g. 120 corresponds to 120 s). The variable is saved persistently. Preset to 120 s. i Fct Mode Fan Coil: The user has the possibility to activate the fan controller for heating mode or cooling mode or both modes via the valence of this variable. Valid values are 1, 2 or 3. Other values are invalid and b Invalid Parameter is set to TRUE. The variable is saved persistently. Preset to 3. Cooling Heating Valence 0 1 1 (= fan controller active in heating mode) 1 0 2 (= fan controller active in cooling mode) 1 1 3 (= fan controller active in heating mode and cooling mode) udi Time Period: Timeframe during which the manual override is active in case of presence. The variable is saved persistently. Preset to 60 min. Illustration of the fan control with the default parameters: 188 Version: 1.3.0 TF8000
## Page 189

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.1.3 FB_BARFct Selection This function block is for enabling room heating or room cooling. It can be used for 2 pipe systems (changeover) or 4 pipe systems. In the case of a 4 pipe system the changeover from heating to cooling operation takes place automatically on the basis of a comparison of the setpoint for the room temperature with the actual value for the room temperature. Sketch: TF8000 Version: 1.3.0 189
## Page 190

Programming In the case of a 2 pipe system the heating operation or cooling operation may only be enabled when heating or cooling medium is present. The room temperature controller gets this information from the primary units. In both 2 and 4 pipe systems the changeover between heating operation and cooling operation can be delayed by a timer. The input variable udi Change Over Delay must be greater than zero for this. The following tables describe the interrelationship between the inputs and the e Ctrl Fct output of the FB_BARFct Selection function block. In the 2 pipe system b Enable b Pipe Sys- b Feedb- b Feedb- interim re- b Dew Point e Ctrl Fct tem Heat Medium Cool Medium sult 0 0 0 0 OFF TRUE / OFF FALSE 1 0 0 0 Heating TRUE / Heating FALSE 1 0 0 1 Cooling TRUE OFF FALSE Cooling 1 0 1 0 Heating TRUE / Heating FALSE 1 0 1 1 Heating TRUE / Heating FALSE In the 4 pipe system b Enable b Pipe Sys- T_Room < = T_Room > interim re- b Dew Point e Ctrl Fct tem Tsetpoint Tsetpoint sult 0 1 0 0 OFF TRUE / OFF FALSE 1 1 0 1 Cooling TRUE OFF FALSE Cooling 1 1 1 0 Heating TRUE / Heating FALSE 1 1 1 1 Heating TRUE / Heating FALSE 190 Version: 1.3.0 TF8000
## Page 191

Programming VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b Pipe System : BOOL; b Feedb Heat Medium : BOOL; b Feedb Cool Medium : BOOL; b Dew Point : BOOL; r Room Temp : REAL; st Setpoint : ST_BARSetpoint Room; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: TRUE enables the function block. If FALSE the function block is disabled and e Ctrl Fct := e HVACCtrl Fct_Off. b Pipe System: FALSE means that a 2 pipe system is present. TRUE means that a 4 pipe system is present. b Feedb Heat Medium: Signal from the power generation or distribution that heating medium is available. b Feedb Cool Medium: Signal from the power generation or distribution that cooling medium is available. b Dew Point: The dew point sensor is connected to this input. If this is triggered the cooling control function is deactivated and e Ctrl Fct := e HVACCtrl Fct_Off is set. r Room Temp: This input variable transfers the current room temperature to the function block. st Setpoint: STRUCTURE containing the setpoints for the individual energy levels (see ST_BARSetpoint Room [} 502]). VAR_OUTPUT e Ctrl Fct : E_BARCtrl Fct; ui Req Heating : UINT; ui Req Cooling : UINT; udi RT_Change Over Delay : UDINT; e Ctrl Fct: This output contains the current control function (see E_BARCtrl Fct [} 498]). ui Req Heating: is 1 if the room/zone requests heating energy. It is 0 if there is no heating requirement. ui Req Cooling: is 1 if the room/zone requests cooling energy. It is 0 if there is no cooling requirement. udi RT_Change Over Delay: Indicates the time remaining until the active control function is changed over. VAR_IN_OUT ui Change Over Delay : UINT; TF8000 Version: 1.3.0 191
## Page 192

Programming ui Change Over Delay: Changeover time between the control functions. Must be specified in seconds. If the input is greater than 0 it will always be observed. The variable must be 0 if there is to be no changeover time between the control functions. The variable is saved persistently. Preset to 0. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.1.4 FB_BARSetpoint Room The function block FB_BARSetpoint Room assigns setpoints for cooling and heating operation to each of the energy levels Protection, Economy, Pre Comfort and Comfort. In connection with the function block FB_BAREnergy Level the room temperature controller is provided with an energetical optimum setpoint regarding the use of the room and the selected heating or cooling operation. The resulting setpoint for the different energy levels is made up of: 1. the base setpoint value 2. the local setpoint value shift (not in the case of the Protection and Economy setpoints) 192 Version: 1.3.0 TF8000
## Page 193

Programming 3. the central setpoint value shift (not in the case of the Protection and Economy setpoints) The local shift due to a room setpoint generator and also the remote adjustment of the setpoints by a building management system only affect the Comfort and Pre Comfort energy levels. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r Setpoint Shift Heat : REAL; r Setpoint Shift Cool : REAL; r Setpoint Shift User : REAL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. TF8000 Version: 1.3.0 193
## Page 194

Programming NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is activated if the variable b Enable is TRUE. r Setpoint Shift Heat: the r Setpoint Shift Heat variable is used for the adaptation of the Comfort Heating setpoint of the building management system. If the Comfort Heating setpoint is raised, then the setpoints for the Comfort Cooling and Pre Comfort Cooling are also increased. Example: Energy Protec- Econo- Pre- Com- Com- Pre- Econo- Protec- levels tion- my- Com- fort He- fort- Com- my- tion- Heat- Heat- fort He- ating Cool- fort- Cool- Cool- ing ing ating ing Cool- ing ing ing Base 12 15 19 21 24 28 35 40 setpoint value [°C] Setpoin +3 - - - +3 +3 +3 - - t Shift He at [K] Resultin 12 15 19 24 27 31 35 40 g setpoint [°C] A lowering of the Comfort Heating setpoint affects only the Comfort Heating and Pre Comfort Heating setpoints. Example: Energy Protec- Econo- Pre- Com- Com- Pre- Econo- Protec- levels tion- my- Com- fort He- fort- Com- my- tion- Heat- Heat- fort He- ating Cool- fort- Cool- Cool- ing ing ating ing Cool- ing ing ing Base 12 15 19 21 24 28 35 40 setpoint value [°C] Setpoin -3 - - -3 -3 - - - - t Shift He at [K] Resultin 12 15 16 18 24 28 35 40 g setpoint [°C] r Setpoint Shift Cool: The r Setpoint Shift Cool variable is used for the adaptation of the Comfort Cooling setpoint of the building management system. If the Comfort Cooling setpoint is raised, then the setpoint for the Pre Comfort Cooling is also raised. Example: 194 Version: 1.3.0 TF8000
## Page 195

Programming Energy Protec- Econo- Pre- Com- Com- Pre- Econo- Protec- levels tion- my- Com- fort He- fort- Com- my- tion- Heat- Heat- fort He- ating Cool- fort- Cool- Cool- ing ing ating ing Cool- ing ing ing Base 12 15 19 21 24 28 35 40 setpoint value [°C] Setpoin +3 - - - - +3 +3 - - t Shift Co ol [K] Resultin 12 15 19 21 27 31 35 40 g setpoint [°C] A lowering of the Comfort Cooling setpoint only affects the Comfort Cooling. The Pre Comfort Cooling is not changed. Example: Energy Protec- Econo- Pre- Com- Com- Pre- Econo- Protec- levels tion- my- Com- fort He- fort- Com- my- tion- Heat- Heat- fort He- ating Cool- fort- Cool- Cool- ing ing ating ing Cool- ing ing ing Base 12 15 19 21 24 28 35 40 setpoint value [°C] Setpoin -3 - - - - -3 - - - t Shift Co ol [K] Resultin 12 15 19 21 21 28 35 40 g setpoint [°C] If the setpoint of the Pre Comfort energy level is shifted beyond the setpoint of the Economy level, then the setpoint of the Economy level adopts the value of the Pre Comfort level. Example: Energy Protec- Econo- Pre- Com- Com- Pre- Econo- Protec- levels tion- my- Com- fort He- fort- Com- my- tion- Heat- Heat- fort He- ating Cool- fort- Cool- Cool- ing ing ating ing Cool- ing ing ing Base 12 15 19 21 24 28 35 40 setpoint value [°C] Setpoin +8 - - - - +8 +8 - - t Shift Co ol [K] Resultin 12 15 19 21 32 36 36 40 g setpoint [°C] TF8000 Version: 1.3.0 195
## Page 196

Programming r Setpoint Shift User: The r Setpoint Shift User variable is used for the user's local setpoint value shift. A positive value of r Setpoint Shift User affects the setpoints of Comfort Heating, Comfort Cooling and Pre Comfort Cooling. Example: Energy Protec- Econo- Pre Com- Com- Comfort- Pre Com- Econo- Protec- levels tion- my Heat- fort Heat- fort Heat- Cooling fort Cool- my Cool- tion- Heating ing ing ing ing ing Cooling Base 12 15 19 21 24 28 35 40 setpoint value [°C] Setpoint +3 - - - +3 +3 +3 - - Shift User [K] Resulting 12 15 19 24 27 31 35 40 setpoint [°C] A negative value of r Setpoint Shift User affects the setpoints of Pre Comfort Heating, Comfort Heating and Comfort Cooling. Example: Energy Protec- Econo- Pre Com- Com- Comfort- Pre Com- Econo- Protec- levels tion- my Heat- fort Heat- fort Heat- Cooling fort Cool- my Cool- tion- Heating ing ing ing ing ing Cooling Base 12 15 19 21 24 28 35 40 setpoint value [°C] Setpoint -3 - - -3 -3 -3 - - - Shift User [K] Resulting 12 15 16 18 21 28 35 40 setpoint [°C] b Reset: Acknowledge input in case of a fault or an incorrect parameter. VAR_OUTPUT st Setpoint : ST_BARSetpoint Room; b Invalid Parameter : BOOL; st Setpoint: Structure containing the setpoints for all the energy levels (see ST_BARSetpoint Room [} 502]). b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT r Setpoint Comfort Heat : REAL; r Setpoint Pre Comfort Heat : REAL; r Setpoint Economy Heat : REAL; r Setpoint Protection Heat : REAL; r Setpoint Comfort Cool : REAL; r Setpoint Pre Comfort Cool : REAL; r Setpoint Economy Cool : REAL; r Setpoint Protection Cool : REAL; r Setpoint Comfort Heat: Setpoint for the Comfort heating energy level. The variable is saved persistently. Preset to 21.0. r Setpoint Pre Comfort Heat: Setpoint for the Pre Comfort heating energy level. The variable is saved persistently. Preset to 19.0. 196 Version: 1.3.0 TF8000
## Page 197

Programming r Setpoint Economy Heat: Setpoint for the Economy heating energy level. The variable is saved persistently. Preset to 15.0. r Setpoint Protection Heat: Setpoint for the Protection heating energy level. The variable is saved persistently. Preset to 12.0. r Setpoint Comfort Cool: Setpoint for the Comfort cooling energy level. The variable is saved persistently. Preset to 24.0. r Setpoint Pre Comfort Cool: Setpoint for the Pre Comfort cooling energy level. The variable is saved persistently. Preset to 28.0. r Setpoint Economy Cool: Setpoint for the Economy cooling energy level. The variable is saved persistently. Preset to 35.0. r Setpoint Protection Cool: Setpoint for the Protection cooling energy level. The variable is saved persistently. Preset to 40.0. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.2 Controller 5.1.5.2.1 FB_BARPICtrl Simple PI controller. The control gain has no influence on the I-component. This PI controller does not work directly with an adjustable gain factor K , but with the so-called proportional p band (input r Xp) in relation to the control value limits (r Ymin and r Ymax), from which K is then determined p internally. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r W : REAL; r X : REAL; t Task Cycle Time : TIME; ui Ctrl Cycle Call : UINT; b Sync : BOOL; TF8000 Version: 1.3.0 197
## Page 198

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: Controller activation r W: Setpoint. r X: Actual value. t Task Cycle Time: Cycle time with which the function block is called. If the function block is called in every cycle this corresponds to the task cycle time of the calling task. ui Ctrl Cycle Call : Call cycle of the function block as a multiple of the cycle time. A zero entry is automatically evaluated as ui Ctrl Cycle Call =1. Example: t Task Cycle Time = 20ms, ui Ctrl Cycle Call =10 -> The control algorithm is called every 200 ms. Thus the outputs are also updated only every 200 ms. b Sync: A rising edge at this input sets the (internal) I-component such that r Sync Value is output at the control value output. If the I-component is deactivated by t Tn=0 ms, however, then this command is ignored. VAR_OUTPUT r Y : REAL; r E : REAL; b ARW : BOOL; b Max Limit : BOOL; b Min Limit : BOOL; b Error : BOOL; udi Error Id : UDINT; r Y: Control value. r E: Control deviation (calculation dependent on control direction [} 201]) r EMin: lower control deviation limit value, which results from the input proportional band. r EMax: upper control deviation limit value, which results from the input proportional band. b ARW: Anti-Reset-Windup function is active. b Max Limit: The control value has reached its upper limit value. b Min Limit: The control value has reached its lower limit value. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. 198 Version: 1.3.0 TF8000
## Page 199

Programming VAR_IN_OUT b Direction : BOOL; r Xp : REAL; t Tn : TIME; r YMin : REAL; r YMax : REAL; r Sync Value : REAL; b Direction: The control direction [} 201] of the controller can be changed with the parameter b Direction. If b Direction is TRUE, then the direct control direction is active for cooling operation of the controller. If b Direction is FALSE, then the indirect control direction of the controller is activated for heating operation. The variable is saved persistently. Preset to FALSE. r Xp: Proportional band. This defines the internal proportional factor, see below. The proportionality factor or gain affects only the P-component. The variable is saved persistently. Preset to 100.0. t Tn: Integral action time in seconds. The I-component corrects the residual control deviation following the correction of the P-component. The smaller t Ti is set, the faster the controller corrects. The control loop becomes unstable if the time is too short. Larger t Ti-times must be entered in order to reduce the integration component. The integral action time should be selected to be longer than the stroke time of the valve or damper actuator. A zero value at this input deactivates the I-component. The variable is saved persistently. Preset to 30 s. r YMin / r YMax: Limit the working range of the controller. Several other function blocks, e.g. sequencers, require a symmetrical control range (-100 to +100). In the case of a cascade structure, the working range of the master controller determines the setpoint of the slave controller. For example, 15° to 25° as the limitation of the supply air setpoint for an exhaust/supply air cascade control. The variable is saved persistently. Preset to 0.0 or 100.0 respectively. r Sync Value: The control value r Y is set to this value on a rising edge at the input b Sync. In addition, the I- component is changed internally. If the I-component doesn't exist (PD controller), the D-component is changed. The variable is saved persistently. Preset to 0.0. Functional description Step response of a simple PI controller; the control gain has no influence on the integral component. Reaction of the output Y(t) to a control deviation jump by E: In the case of a jump of the control deviation by E, the output Y initially jumps to K *E due to the proportional component and then grows by a further E in P each interval T . N The controller is designed so that it begins at 0, i.e. without the K *E jump, each time the PLC is reset or P restarted. TF8000 Version: 1.3.0 199
## Page 200

Programming Basic Function A TRUE signal at the input b Enable enables the module. Then the internal controlling algorithm is processed. The input value ui Ctrl Cycle Call indicates, after what number of PLC cycles the internal controlling algorithm is going to be processed. If ui Ctrl Cycle Call =1, a recalculation is executed in each PLC cycle, if it is set to 100, a new calculation is executed only each 100 PLC cycles. The PLC cycle time is part of the calculation of the actuating variable. A wrong input value causes a wrong calculation. The inputs r W (desired value), r X (actual value), r Xp (proportional band) and r Tn (reset time) are the input parameters of the PI-controller. Via them the output parameters r Y (actuating variable) and r E (control deviation) are evaluated in each calculation cycle. The actuating variable can additionally be limited via the inputs r YMin and r YMax . Setting via the proportional band The adjustment of the gain factor K of a controller often includes the difficulty for the user that there is no p size reference to the application. If a heating controller normally operates within the two-figure range, then a flow rate controller can accept values in the five-figure range. It therefore makes sense to represent the K p factor in such a way that it has a reference to the possible control deviation and change of control value. The P-component of the controller is regarded for the dimensioning of the K factor. p The equation for this is: • Control value = control deviation x gain factor→ Y=E*K p This relationship also applies to the changes in the control deviation and the control value: • Control value change = control deviation change •gain factor→ ΔY=ΔE*K p Referenced to the minimum and maximum value of the control value, Y and Y : min max • Y -Y =(E(Y )-E(Y ))*K max min max min p This difference, E(Y ) - E(Y ), is called the proportional band (Xp). Transposed, the equation is then: max min • K =(Y -Y )/X p max min p The following diagram clarifies the functional interrelationship: 200 Version: 1.3.0 TF8000
## Page 201

Programming The proportional band X therefore indicates the size of the range of the control deviation that leads to an p output of Y to Y from the controller. min max A smaller X leads to a steeper function and thus to an increase in the Kp factor. However, the control p deviation limit values E(Y )-E(Y ) are shifted: max min Control-direction Control-direction If b Direction is set to FALSE, the control-direction will be changed, so a negative control-deviation will cause a positive value at the control-output. This is done by changing the internal calculation of the control- deviation. b Direction r E (control-deviation) control-direction TRUE lr X-lr W (actual value-setpoint) direct (cooling) FALSE lr W-lr X (setpoint-actual value) reverse (heating) TF8000 Version: 1.3.0 201
## Page 202

Programming Anti-Reset-Windup (ARW) If the controller runs in this limitation, the I-component is hold internally at the last value. Without this, the I- component-values could increase unhindered. In case of a direction reversal of the controller, a huge I- component has to be eliminated, before the controller can operate within its normal limitations again. If calculation of the I-component is stopped, the output b ARW is set. Special Case Tn=0 to switch-off the I-component In the step response diagram above you see, that the I-component's influence is the weaker, the bigger the integral-time T has been set. If the integral-time goes to infinity, the I-component's influence goes to zero. n Reverse a constantly decreasing reset time would nurture the I-component, by T =0 the actuating variable n would go to infinity. This special case is used to switch-off the I-component. This is an internal exception, because the integral-time directly belongs to the I-component and should switch-off the I-component via "0- item" metaphorically. Synchronisation A rising edge at b Sync sets the controller output r Y directly to r Sync Value, if the controller has been activated via a TRUE signal at b Enable. If not, the rising edge at b Sync is ignored. Passive-behaviour (b Enable = FALSE or b Error = TRUE) If the controller is wrong parameterized, the execution is stopped, the output b Error is set and the corresponding error code is provided to udi Error ID, see Error codes [} 317]. The Module is also stopped, if the input b Enable is not set. In both cases the outputs are set as follows: r Y 0.0 r E 0.0 b ARW FALSE b Max Limit FALSE b Min Limit FALSE Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.3 Lighting functions – overview The lighting is subdivided into two different function groups, which can be combined to form arbitrary solutions: • User functions • Actuator functions The user functions are control and closed loop circuits, which, served by the sensor functions, each output a light value. FB_BARLight Circuit [} 219] - simple light switching circuit without dimming function. FB_BARLight Circuit Dim [} 221] - simple light switching circuit with dimming function. FB_BARAutomatic Light [} 203] - presence-controlled automatic light with switch-off delay. FB_BARStairwell Automatic [} 224] - stairwell lighting with early warning sequence. FB_BARTwilight Automatic [} 227] - twilight circuit. FB_BARDaylight Control [} 212] - daylight controller without dimming processes 202 Version: 1.3.0 TF8000
## Page 203

Programming FB_BARConstant Light Control [} 206] - constant light control with continuous output of analog values. The group of actuator functions is currently represented by only one function block. FB_BARLight Actuator [} 216] - output of a preset proportional dimming value via a ramp function. Output is alternatively in percent, INTEGER or BOOL. This function block likewise encompasses a light scene memory of 21 adjustable dimming values. 5.1.5.3.1 FB_BARAutomatic Light Function block for an automatic light circuit as used in corridors or sanitary facilities. The function block knows 3 different modes, which can be set via the input ui Light Ctrl Mode: • Automatic mode • Manual On mode • Manual Off mode The automatic light circuit is active in automatic mode (ui Light Ctrl Mode=0). A positive edge on b Switch sets the output lr Dim Value to the value entered under lr Manual Dim Value. A negative edge starts the holding time generator. If the holding time ui Hold Time [s] has expired, the output lr Dim Value is reset to 0.0. The sequence can be restarted at any time: TF8000 Version: 1.3.0 203
## Page 204

Programming The b Switch input has no function in the manual modes: if ui Light Ctrl Mode=1 the output value lr Dim Value is set constantly to lr Manual Dim Value and if ui Light Ctrl Mode=2 it is set constantly to 0.0. Resetting the holding time Changing to manual mode resets any holding time that had started up to that point. VAR_INPUT e Data Security Type : E_HVACData Security Type; ui Light Ctrl Mode : UINT; b Switch : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. ui Light Ctrl Mode: Operation mode. • 0: Automatic mode; the automatic light circuit is active and reacts to the input b Switch. • 1: Manual On; the automatic light circuit is inactive - the output lr Dim Value is set constantly to lr Manual Dim Value. • 2: Manual Off; the automatic light circuit is inactive - the output lr Dim Value is set constantly to 0.0. b Switch: A rising edge switches the light on in automatic mode (ui Light Ctrl Mode=0), a falling edge starts the holding time generator. This input has no function in manual operation mode (ui Light Ctrl Mode=1 or 2). VAR_OUTPUT lr Dim Value : LREAL; ui Remaining Hold Time : UINT; b Error : BOOL; udi Error Id : UDINT; lr Dim Value: Output dimming value for the lighting in percent. 204 Version: 1.3.0 TF8000
## Page 205

Programming ui Remaining Time Hold: Remaining holding time in seconds. If the light is off or if manual operation mode is active, then this output is "0". With a rising edge on b Switch in automatic mode, this output initially indicates the complete number of seconds of the holding time (ui Hold Time), in order to illustrate the countdown of the holding time, starting with a falling edge on b Switch. This output is 0 as long as no countdown of the time is taking place. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Hold Time : UINT; lr On Dim Value : LREAL; lr Manual Dim Value : LREAL; ui Hold Time : Holding time [s] of the automatic light controller after a falling edge on b Switch. lr On Dim Value : A dimming value in automatic mode (ui Light Ctrl Mode=0). lr Manual Dim Value : Output dimming value in Manual On mode (ui Light Ctrl Mode=1). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher Documents about this 2 https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/5090272523.zip TF8000 Version: 1.3.0 205
## Page 206

Programming 5.1.5.3.2 FB_BARConstant Light Control The constant light control function block controls the lighting when the room is occupied such that the lighting intensity does not fall below a preset minimum. This ensures adequate lighting whilst at the same time minimizing energy consumption. The constant light control is enabled when the room is entered or by a rising edge on the input b Presence. Optionally the constant light control can also be operated by a pushbutton. A short pulse on the input b Toggle enables the constant light control or switches it off, depending on the current state. If many constant light controllers are to be switched on by a central command, for example on an office floor, this can be realized with the input b Central On. A central command to switch off can be connected to the input b Central Off. Actuating the pushbutton on b Toggle for a longer period manually changes the setpoint value for the room brightness. Upon a falling edge on b Toggle the current room brightness value is stored as a setpoint value. The rate of change when manually increasing or decreasing the room brightness can be set by means of a parameter. The manually set setpoint value for the constant light control is retained until the next time the lighting is switched off. On restarting the controller by a rising edge on b Presence, a rising edge on b Central On or a pulse on b Toggle, the last manually selected setpoint value or the value of ui Setpointl Value is adopted, depending on the setting of the parameter b Initial Mode. In automatic mode the lighting is switched on only if the room brightness lies below an adjustable hysteresis value (ui Target Range). As the external brightness increases, the constant light controller reduces the artificial light portion until a minimum load control value lr Min Dim Value lies at the output of the controller lr Dim Value. Subsequently, the controller switches the lighting off following a time delay with the timer ui Off Delay. If the external brightness decreases and the light should be turned on again, it can be delayed by ui On Delay [sec]. In order to avoid unpleasant visible changes in the brightness, the rate of change of the control signal is retarded with the parameter ui Control Ramp Time. For maintenance and test purposes the automatic constant light control can be deactivated and the lighting can be switched on and off in manual mode. This deactivates the edge detection at the inputs b Centrol On,b Cental Off and b Toggle. The function block knows three different modes, which can be set via the input ui Light Ctrl Mode: 206 Version: 1.3.0 TF8000
## Page 207

Programming • Automatic mode • Manual On mode • Manual Off mode Automatic mode In automatic mode the control can be activated or deactivated in three different ways: 1. Via the input b Switch: A short TRUE signal (shorter than ui Switch Over Time in milliseconds) at b Switch activates the constant light control if it had been inactive before. Another short signal at b Switch deactivates the constant light control again. A long TRUE signal on b Switch switches the function block to setpoint value adjustment mode; this is described below. 2. Via the input b Presence: Switching on via this input must be explicitly enabled by a TRUE signal on b Presence On Active (VAR_IN_OUT). A rising edge then activates the control, while a falling edge always deactivates the control independent of the state of b Presence On Active. 3. The control is explicitly switched on and off via TRUE edges on the inputs b Central On and b Central Off, independent of the previous state of the control. These inputs do not have an override function: for example, if switching off has taken place via b Central Off, b Switch can be used to switch on again at any time. The light output value lr Dim Value is initially set in the active state to the starting value lr Start Dim Value. After that an actual value/setpoint value comparison takes place continuously. If the actual room value ui Brightness [lux] thereby leaves the target range ui Target Range [lux] around the setpoint value ui Setpoint Value [lux], then this is counteracted by dimming the lighting up or down. The control always operates with a constant, parameterizable dimming ramp ui Ramptime [s], which indicates the time of a complete dimming process from 0% to 100%. The control target values are likewise constant: 0% for dimming down and 100% for dimming up. In the inactive state the light output value lr Dim Value is set to 0.0. TF8000 Version: 1.3.0 207
## Page 208

Programming Switch-on and switch-off delay, minimum output value 208 Version: 1.3.0 TF8000
## Page 209

Programming If the external brightness increases, then less and less artificial light is necessary in order to obtain the desired total brightness. The lighting can be switched off completely if the external brightness is sufficient. However, switch-on and switch-off processes can be perceived as distracting, as can very low output dimming values. Therefore a switch-on and switch-off delay ui On Delay/ui Off Delay can be defined in the function block around a lower limit value lr Min Dim Value. If the internally determined output value sinks below this minimum value, then the output remains at this minimum for the time ui Off Delay [s]. Only after that is 0.0 output at the output lr Dim Value. If in the reverse case switching off to 0.0 has taken place, then if artificial light is required this is only switched on after the expiry of ui On Delay [s] and then to the value lr Min Dim Value. The following diagram is intended to clarify the behavior: The yellow areas indicate the ranges where the external brightness permits the lighting to be dimmed down; in the blue areas, conversely, the external brightness alone is not sufficient to obtain the desired room brightness. In the white areas the output control value lr Dim Value is appropriate for the lighting conditions. Manual adjustment of the setpoint value In order to be able to adapt the light control to personal brightness needs, there is an option to increase or decrease the setpoint value. A long TRUE signal on b Switch (longer than ui Switch Over Time in milliseconds) switches the function block to the dimming mode and the light is dimmed up if it had been dimmed down in the preceding dimming mode and vice versa. If b Switch resets to FALSE, then the brightness value now measured on ui Brightness is adopted as the new setpoint value to which control is to take place. Manual operation The inputs b Switch, b Central On and b Central Off have no function in the manual operation modes: if ui Light Ctrl Mode=1 the output value lr Dim Value is set constantly to lr Manual Dim Value and if ui Light Ctrl Mode=2 it is set constantly to 0.0. Manual mode / automatic mode Changing to manual mode resets any control process that had previously started. On re-entering automatic mode the output value is 0.0 and the controller must be restarted. TF8000 Version: 1.3.0 209
## Page 210

Programming VAR_INPUT e Data Security Type : E_HVACData Security Type; ui Light Ctrl Mode : UINT; b Switch : BOOL; b Presence : BOOL; b Central On : BOOL; b Central Off : BOOL; ui Brightness : UINT; ui Setpoint : UINT; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. ui Light Ctrl Mode: Operation mode. • 0: Automatic mode; the commands b Switch, b Central On and b Central Off are executable and can be used to switch the controller on and off. • 1: Manual On mode; constant light control is inactive – the value lr Manual Dim Value is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. • 2: Manual Off mode; constant light control is inactive – the value 0.0 is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. b Switch: Rising edges on this input switch the control on and off alternately. When switching off the output lr Dim Value is set to 0.0. This command input is active only in automatic mode (ui Light Ctrl Mode=0). b Presence: A continuous TRUE signal on this input activates the control if the presence function is activated by b Presence On Active=TRUE (VAR_IN_OUT). Conversely, a falling edge on this input always deactivates the control. This command input is active only in automatic mode (ui Light Ctrl Mode=0). b Central On: A positive edge on this input switches the control on. This command input is active only in automatic mode (ui Light Ctrl Mode=0). b Central Off: A positive edge on this input switches the control off and sets the output lr Dim Value to 0.0. This command input is active only in automatic mode (ui Light Ctrl Mode=0). ui Brightness: Light actual value [lux]. ui Setpoint Value: Light setpoint value [lux]. VAR_OUTPUT lr Dim Value : LREAL; b Control Active : BOOL; b Adjusted Setpoint Active : BOOL; ui Adjusted Setpoint : UINT; di Act Deviation : DINT; b Error : BOOL; udi Error Id : UDINT; lr Dim Value: Light output value, 0..100%. 210 Version: 1.3.0 TF8000
## Page 211

Programming b Control Active: This output is TRUE if the function block is in automatic mode and the control is activated. This is intended to serve as an additional feedback signal if switch-on has taken place but the control outputs a light value of lr Dim Value=0.0. b Adjusted Setpoint Active: If the control is active and the setpoint value has been manually adjusted (see above), then the state of this output changes to TRUE in order to indicate that the setpoint value on the input ui Setpoint Value is no longer active. ui Adjusted Setpoint: This output indicates the active setpoint value if this has been manually adjusted (b Adjusted Setpoint Active = TRUE). This output is set to 0 if no manually adjusted setpoint value is active. di Act Deviation: Current control deviation in lux. This output indicates a valid value only if the function block is in automatic mode and activated. Otherwise 0.0 is output. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT ui Switch Over Time : UINT; ui Adjust Ramp Time : UINT; b Presence On Active : BOOL; b Initial Mode : BOOL; ui Target Range : UINT; ui Control Ramp Time : UINT; ui On Delay : UINT; ui Off Delay : UINT; lr Min Dim Value : LREAL; lr Max Dim Value : LREAL; lr Start Dim Value : LREAL; lr Manual Dim Value : LREAL; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Switch Over Time: Switching time in milliseconds for the input b Switch for the recognition of short and long signals. (short signal: switch-on/switch-off function; long signal: dimming function) ui Adjust Ramp Time: Ramp time in seconds with which the setpoint value is changed during manual adjustment. b Presence On Active: If this input is TRUE, then the control is activated by a positive edge on b Presence if the function block is in automatic mode (ui Light Ctrl Mode = 0). b Initial Mode: A TRUE signal on this input makes the function block begin with the setpoint value on ui Setpoint each time it is activated. If on the other hand this input is FALSE, then the setpoint value that was last active – i.e. including manually adjusted setpoint values – is adopted on activation of the function block. ui Target Range: Target range around the setpoint value in which no further control is to take place. ui Control Ramp Time: Ramp time in seconds (time required to dim from 0% to 100%). ui On Delay: Switch-on delay in seconds around the minimum value lr Min Dim Value. ui Off Delay: Switch-off delay in seconds around the minimum value lr Min Dim Value. lr Min Dim Value: Lower limit value for dimming, see introduction [} 206]. lr Max Dim Value: Upper limit to which the output lr Dim Value can be controlled. lr Start Dim Value: Value to which the light should jump on activating the control. lr Manual Dim Value: Output dimming value in Manual On mode (ui Light Ctrl Mode=1). TF8000 Version: 1.3.0 211
## Page 212

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher Documents about this 2 https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/5090272523.zip 5.1.5.3.3 FB_BARDaylight Control Daylight switch. Unlike the constant light control [} 206], this automatic switch operates not with dimming values, but merely switches the light on or off depending on the measured brightness. The function block knows three different modes, which can be set via the input ui Light Ctrl Mode: • Automatic mode • Manual On mode • Manual Off mode Automatic mode If the brightness in the room, ui Brightness, falls below the value ui Switch On Value [lux] for the time ui On Delay [s], then the light is switched on. There is now a delay, ui Light On Time, to allow the lamps reach their full luminosity. The measured brightness in the room – assuming constant external brightness – is then higher than before switching on by the amount of the increase in brightness. Switching the lighting off again makes sense only after the external brightness has significantly increased again. This limit value is calculated from the light switch-on value plus the brightness increase plus the parameter ui Switch Off Offset. If an increase in the external brightness causes the room brightness to exceed this determined re-switch-off value for the duration of ui Off Delay [s], then the lighting is switched off again. 212 Version: 1.3.0 TF8000
## Page 213

Programming TF8000 Version: 1.3.0 213
## Page 214

Programming Manual operation The inputs b Switch, b Central On and b Central Off have no function in the manual operation modes: the output value b On is set to TRUE if ui Light Ctrl Mode=1 and to FALSE if ui Light Ctrl Mode=2. Manual mode / automatic mode Changing to manual mode resets any control process that had previously started. On re-entering automatic mode the output value b On is FALSE and the controller must be restarted. VAR_INPUT e Data Security Type : E_HVACData Security Type; ui Light Ctrl Mode : UINT; b Switch : BOOL; b Central On : BOOL; b Central Off : BOOL; ui Brightness : UINT; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. ui Light Ctrl Mode: Operation mode. • 0: Automatic mode; the commands b Switch, b Central On and b Central Off are executable and can be used to switch the controller on and off. • 1: Manual On mode; constant light control is inactive – the value lr Manual Dim Value is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. • 2: Manual Off mode; constant light control is inactive – the value 0.0 is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. 214 Version: 1.3.0 TF8000
## Page 215

Programming b Switch: Rising edges on this input switch the control on and off alternately. When switching off the output lr Dim Value is set to 0.0. This command input is active only in automatic mode (ui Light Ctrl Mode=0). b Central On: A positive edge on this input switches the control on. This command input is active only in automatic mode (ui Light Ctrl Mode=0). b Central Off: A positive edge on this input switches the control off and sets the output lr Dim Value to 0.0. This command input is active only in automatic mode (ui Light Ctrl Mode=0). ui Brightness: Light actual value [lux]. VAR_OUTPUT lr Dim Value : LREAL; b On : BOOL; ui Remaining On Delay : UINT; ui Remaining Off Delay : UINT; ui Pre On Value : UINT; ui Light Gain : UINT; ui Switch Off Value : UINT; b Control Active : BOOL; b Error : BOOL; udi Error Id : UDINT; lr Dim Value: In order to keep this function the same as the other light user functions, a light output value exists here too in the form of a floating point number in percent, even though the light is only switched on or off. This means: light off: lr Dim Value = 0.0, light on: lr Dim Value = 100.0. b On: Switch output for the lighting. ui Remaining On Delay: Countdown of the switch-on delay in seconds. This output is 0 as long as no countdown of the time is taking place. ui Remaining Off Delay: Countdown of the switch-off delay in seconds. This output is 0 as long as no countdown of the time is taking place. ui Pre On Value: Measured light value immediately before switching the lighting on. This output is "0" if the controller is switched off or in manual mode. ui Light Gain: Calculated brightness increase after switching on the lighting and expiry of an additional waiting time of 1s. This output is "0" if the controller is switched off or in manual mode. ui Switch Off Value: Determined re-switch-off value, wherein the measured brightness must be larger. During the waiting phase (ui Light On Time) this value jumps to 65535 in order to avoid the light switching off during this time. This output is "0" if the controller is switched off or in manual mode. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT ui Switch On Value : UINT; ui Switch Off Offset : UINT; ui Light On Time : UINT; ui On Delay : UINT; ui Off Delay : UINT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Switch On Value: Light switch-on value. The lighting is switched on after the expiry of the switch-on delay if the external brightness is lower than this value. TF8000 Version: 1.3.0 215
## Page 216

Programming ui Switch Off Offset: If the light is switched on for the time ui Light On Time (see above), the light switch-off value is calculated from the currently measured light intensity plus this value. ui Light On Time: The lighting does not reach its true switch-on value immediately. In order to judge the increase in light intensity, this time delay in milliseconds is allowed to elapse before the increase and the light switch-off value that depends on it are calculated. ui On Delay: Switch-on delay in seconds. Constant switching on and off of the lighting is perceived as very distracting. If the external brightness sinks in such a manner that the constant light control needs to be switched on for support, then this should take place only after this time delay. ui Off Delay: Switch-off delay in seconds. If the external brightness increases in such a manner that the constant light control needs to be switched off, then this should take place only after this time delay in order to mask out short-term fluctuations. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher Documents about this 2 https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/5090272523.zip 5.1.5.3.4 FB_BARLight Actuator This function block serves to control a conventional light actuator. The outputs cover the value ranges 0..100%, 0..32767 and On/Off. On top of that the function block contains a scene memory in which up to 21 different light values can be saved. In principle the function block passes the values on the input lr Target Value through to the output lr Dim Value. Conversely, a rising edge on the input b Call Scene sets the output to the light value that is saved in the scene table arr Light Scenes under the index usi Selected Scene. The output b Scene Mode then changes to TRUE. If the scene index usi Selected Scene changes, then the newly selected scene value is adopted only on another rising edge on b Call Scene. The scene mode is quit again by a change of value on the input lr Target Value or a rising edge on b Stop Scene. The output b Scene Mode goes back to FALSE and the output lr Dim Value once again follows the input lr Target Value. A TRUE signal on b Save Scene saves the current light output value into the scene table arr Light Scenes under the index usi Selected Scene. The light output value lr Dim Value always follows the target values specified to it via a ramp. As in the case of the user function FB_BARLight Circuit Dim [} 221], this is defined by a ramp time – in this case ui Sec Dim Time – which indicates the time interval in seconds that the light output value should require in order to change by 100%. 216 Version: 1.3.0 TF8000
## Page 217

Programming Since the light sensor function block FB_BARLight Circuit Dim [} 221] also contains a ramp function for presetting the target value, the light actuator function described here is called the "secondary dimtime" - ui Sec Dim Time. If the two have different values, then the longer ramp time is always the relevant one: Example 1: In this constellation the function block FB_BARLight Circuit Dim [} 221] will change its output value lr Dim Value from 0% to 100% in 10 s. However, the function block FB_BARLight Actuator can follow these continuously changing setpoint values only with a ramp time of 20 s (related to a change from 0% to 100%). Therefore this is ultimately the resulting ramp time. Example 2: TF8000 Version: 1.3.0 217
## Page 218

Programming Conversely the function block FB_BARLight Actuator could follow much faster here with a ramp time of 10 s. However, since the dimming function block FB_BARLight Circuit Dim [} 221] presets its setpoints in this example only with a ramp time of 20 s, this longer time is also relevant in this case. It must be noted in this example that a short button press on the function block FB_BARLight Circuit Dim immediately changes the output lr Dim Value to the internally-saved value (see FB_BARLight Circuit Dim [} 221]). Hence, the ramp time on the FB_BARLight Actuator is then relevant. VAR_INPUT e Data Security Type : E_HVACData Security Type; lr Target Value : LREAL; usi Selected Scene : USINT; b Call Scene : BOOL; b Stop Scene : BOOL; b Save Scene : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. lr Target Value: Target value of the light output in 0..100%; usi Selected Scene: Selected lighting scene, 0..20; b Call Scene: Sets the output value, controlled by a ramp, to the light value entered in the index usi Selected Scene (arr Light Scenes). b Stop Scene: Resets the output value to the value lr Target Value. The change is likewise controlled by a ramp. b Save Scene: Saves the current light value at the output lr Dimvalue in the light value table arr Light Scenes under the index usi Selected Scene. 218 Version: 1.3.0 TF8000
## Page 219

Programming VAR_OUTPUT lr Dim Value : LREAL; i Dim Value : INT; b On : BOOL; b Scene Mode : BOOL; b Error : BOOL; udi Error Id : UDINT; lr Dim Value: Output light value in 0..100%. i Dim Value: Output light value in 0..32767. b On: Output light state: lr Dimm Value=0.0 => b On=FALSE - lr Dimm Value>0.0 => b On=TRUE. b Scene Mode: The function block presently outputs a scene value and not the value lr Target Value on the input. b Error : This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT ui Sec Dim Time : UINT; arr Light Scenes : ARRAY[0..20] OF LREAL; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Sec Dim Time: Ramp time in seconds. This is the time that the light actuator function requires in order to regulate from 0..100%. arr Light Scenes: Table of saved light values. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher Documents about this 2 https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/5090272523.zip 5.1.5.3.5 FB_BARLight Circuit This function block represents a simple light switching circuit without a dimming function. The function block knows three different modes, which can be set via the input ui Light Ctrl Mode: • Automatic mode • Manual On mode • Manual Off mode TF8000 Version: 1.3.0 219
## Page 220

Programming In automatic mode (ui Light Ctrl Mode=0) the function block can be controlled via the inputs b Switch, b Central Off and b Central On. A rising edge on b Central Off switches the output lr Dim Value to 0.0, while a rising edge on b Central On sets the output to 100.0. Rising edges on b Switch make the output lr Dim Value change each time between 0.0 and 100.0. In the manual operation modes the output value lr Dim Value Out is set constantly to the value 100.0 if ui Light Ctrl Mode=1 and constantly to the value 0.0 if ui Light Ctrl Mode=2. VAR_INPUT ui Light Ctrl Mode : UINT; b Switch : BOOL; b Central On : BOOL; b Central Off : BOOL; ui Light Ctrl Mode: Operation mode. • 0: Automatic mode; the output value lr Dimm Value can be influenced by the command inputs b Switch, b Central On and b Central Off • 1: Manual On mode; the value 100.0 is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. • 2: Manual Off mode; the value 0.0 is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. b Switch: Rising edges on b Switch make the output lr Dim Value change each time between 0.0 and 100.0. b Central On: Switches the output lr Dim Value Out to 100.0. b Central Off: Switches the output lr Dim Value Out to 0.0. Note: All switching commands, b Switch, b Central On and b Central Off are effective only in automatic mode. VAR_OUTPUT lr Dim Value : LREAL; b Light : BOOL; b Error : BOOL; udi Error Id : UDINT; lr Dim Value: Light output value in percent; 0.0 if the light is switched off and 100.0 if the light is switched on. b Light: FALSE if lr Dimm Value = 0.0, otherwise TRUE. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 220 Version: 1.3.0 TF8000
## Page 221

Programming 5.1.5.3.6 FB_BARLight Circuit Dim This function block represents a light switching circuit with a dimming function. The function block knows three different modes, which can be set via the input ui Light Ctrl Mode: • Automatic mode • Manual On mode • Manual Off mode In automatic mode (ui Light Ctrl Mode=0) the function block can be controlled via the inputs b Switch, b Central Off and b Central On. Whereas the output lr Dim Value is set to 0.0 or to the value reached before the last switch-off by rising edges on b Central Off and b Central On, the behavior of the input b Switch depends on the duration of the signal. A short TRUE signal that is shorter than ui Switch Over Time in milliseconds switches the output lr Dim Value. If the output lr Dim Value is initially larger than 0.0, then it is switched to 0 and the previous value is saved. If on the other hand it is 0.0, then the output is set to the previously internally saved value. This saved value is set to the maximum value in the switch-on state of the program, see below. Unlike in the case of the inputs b Central Off and b Central On, the falling edge triggers the switching event here. A long TRUE signal on b Switch starts the dimming process. In principle dimming takes place only between the set minimum and maximum values (lr Min Dim Value and lr Max Dim Value). The dimming ramp is defined in seconds by ui Ramp Time. This dimming time refers to the dimming range from 0 to 100 percent, even if the limits lr Min Dim Value and lr Max Dim Value are set differently. If the output value lr Dimm Value reaches one of the limits without b Switch resetting to FALSE, then it remains there for the time ui Cycle Delay in milliseconds, before dimming takes place again to the other limit value. Exception: A ui Cycle Delay value of 0 is not interpreted as an immediate dimming direction reversal, but instead deactivates this. Only another long TRUE signal on b Switch starts the dimming in the opposite direction. TF8000 Version: 1.3.0 221
## Page 222

Programming In the manual operation modes the output value lr Dim Value Out is set constantly to the value lr Manual Dim Value if ui Light Ctrl Mode=1 and constantly to the value 0.0 if ui Light Ctrl Mode=2. VAR_INPUT e Data Security Type : E_HVACData Security Type; ui Light Ctrl Mode : UINT; b Switch : BOOL; b Central On : BOOL; b Central Off : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. 222 Version: 1.3.0 TF8000
## Page 223

Programming A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. ui Light Ctrl Mode: Operation mode. • 0: Automatic mode; the output value lr Dimm Value can be influenced by the command inputs b Switch, b Central On and b Central Off • 1: Manual On mode; the value lr Manual Dim Value is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. • 2: Manual Off mode; the value 0.0 is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. b Switch: A short TRUE signal that is shorter than ui Switch Over Time in milliseconds switches the output lr Dim Value. If the output lr Dim Value is initially larger than 0.0, then it is switched to 0 and the previous value is saved. If on the other hand it is 0.0, then the output is set to the previously internally saved value. This saved value is set to the maximum value in the switch-on state of the program, see below. A long TRUE signal that is longer than ui Switch Over Time in milliseconds starts the dimming process, wherein the dimming direction changes if two long signals follow one another on the input b Switch. b Central On: Switches the output lr Dim Value Out to the previously saved (at the last switch-off) dimming value, see b Switch. b Central Off: Switches the output lr Dim Value Out to 0.0. Note: All switching commands, b Switch, b Central On and b Central Off are effective only in automatic mode. VAR_OUTPUT lr Dim Value : LREAL; b Light : BOOL; b Error : BOOL; udi Error Id : UDINT; lr Dim Value: Light output value; can adopt values between lr Min Dim Value and lr Max Dim Value, see VAR_IN_OUT, but maximally 0..100%. b Light: FALSE if lr Dimm Value = 0.0, otherwise TRUE. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT ui Switch Over Time : UINT; ui Dim Ramp Time : UINT; ui Cycle Delay : UINT; lr Min Dim Value : LREAL; lr Max Dim Value : LREAL; lr Manual Dim Value : LREAL; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input TF8000 Version: 1.3.0 223
## Page 224

Programming variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Switch Over Time: Switching time in milliseconds from button to dimming mode. ui Dim Ramp Time: Ramp time in seconds (time required to dim from 0% to 100%). ui Cycle Delay: Switching time in milliseconds of the automatic change between dimming up and dimming down. The automatic change is inactive if this value is zero. lr Dim Min Value: Minimum light value in % that can be reached by dimming. lr Dim Max Value: Maximum light value in %. lr Manual Dim Value: Output dimming value in Manual On mode (ui Light Ctrl Mode=1). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher Documents about this 2 https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/5090272523.zip 5.1.5.3.7 FB_BARStairwell Automatic Function block for a stairwell light circuit. The function block knows 3 different modes, which can be set via the input ui Light Ctrl Mode: • Automatic mode • Manual On mode • Manual Off mode The stairwell control is active in automatic mode (ui Light Ctrl Mode=0) . A positive edge on b Switch initially only switches the light on (output b On). A negative edge starts the holding time generator. If the holding time ui Hold Time [s] has expired, a flash sequence with a number of flash pulses programmable by ui Number Pulses begins as a warning of the impending switch-off. These pulses have an on-time of ui Pulse Time On [ms] and an off-time of ui Pulse Time Off [ms]. 224 Version: 1.3.0 TF8000
## Page 225

Programming The sequence can be restarted at any time: The b Switch input has no function in the manual modes: the output value b On is set constantly to TRUE if ui Light Ctrl Mode=1 and constantly to FALSE if ui Light Ctrl Mode=2. Manual mode Changing to manual mode resets any lighting sequence that had started up to that point. VAR_INPUT e Data Security Type : E_HVACData Security Type; ui Light Ctrl Mode : UINT; b Switch : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. TF8000 Version: 1.3.0 225
## Page 226

Programming NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. ui Light Ctrl Mode: Operation mode. • 0: Automatic mode; the stairwell light circuit is active and reacts to the input b Switch. • 1: Manual On mode; the stairwell circuit is inactive - the output b On is set constantly to TRUE. • 2: Manual Off mode; the stairwell circuit is inactive - the output b On is set constantly to FALSE. b Switch: A rising edge switches the light on in automatic mode (ui Light Ctrl Mode=0), a falling edge starts the holding time generator. This input has no function in manual operation mode (ui Light Ctrl Mode=1 or 2). VAR_OUTPUT lr Dim Value : LREAL; b On : BOOL; ui Remaining Hold Time : UINT; b Error : BOOL; udi Error Id : UDINT; lr Dim Value: In order to keep this function the same as the other light user functions, a light output value exists here too in the form of a floating point number in percent, even though the light is only switched on or off. This means: light off: lr Dim Value = 0.0, light on: lr Dim Value = 100.0. b On: Switch output for the lighting. ui Remaining Time Hold: Remaining holding time in seconds. If the light is off or if manual operation mode is active, then this output is "0". With a rising edge on b Switch in automatic mode, this output initially indicates the complete number of seconds of the holding time (ui Hold Time), in order to illustrate the countdown of the holding time, starting with a falling edge on b Switch. This output is 0 as long as no countdown of the time is taking place. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT ui Hold Time : UINT; ui Pulse Time On : UINT; ui Pulse Time Off : UINT; ui Number Pulses : UINT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Hold Time: Holding time [s] of the stairwell controller after a falling edge on b Switch. ui Pulse Time On: ON-time of the early warning pulses in milliseconds. ui Pulse Time Off: OFF-time of the early warning pulses in milliseconds. ui Number Pulses: Number of early warning pulses. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 226 Version: 1.3.0 TF8000
## Page 227

Programming Documents about this 2 https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/5090272523.zip 5.1.5.3.8 FB_BARTwilight Automatic Automatic twilight function The function block knows three different modes, which can be set via the input ui Light Ctrl Mode: • Automatic mode • Manual On mode • Manual Off mode Automatic mode In automatic mode a positive edge on b Switch activates the automatic twilight function, if it had been inactive beforehand. A further edge on b Switch deactivates the automatic twilight function again. The automatic function is explicitly switched on and off with b Central On and b Central Off, independent of the previous state of the automatic function. If the automatic twilight function is activated, then the function block switches the output lr Dim Value to the switch-on value lr Dim Value On when the brightness falls below a switch-on threshold value ui Switch On Value for an entered delay time ui On Delay. Conversely, if a switch-off threshold value ui Switch Off Value is exceeded for an entered time delay ui Off Delay, then the output is switched to the value lr Dim Value Off. In the inactive state the light output value lr Dim Value is set to 0.0. Manual operation The inputs b Switch, b Central On and b Central Off have no function in the manual operation modes: if ui Light Ctrl Mode=1 the output value lr Dim Value is set constantly to lr Manual Dim Value and if ui Light Ctrl Mode=2 it is set constantly to 0.0. Switch-on and switch-off delay The switch-on and switch-off delays, as described above (“automatic mode”), are always run through irrespective of the state of the automatic function (active or inactive) and the operation mode, i.e. the timers are not reset by these operating states. VAR_INPUT e Data Security Type : E_HVACData Security Type; ui Light Ctrl Mode : UINT; b Switch : BOOL; b Central On : BOOL; b Central Off : BOOL; ui Brightness : UINT; TF8000 Version: 1.3.0 227
## Page 228

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. ui Light Ctrl Mode: Operation mode. • 0: Automatic mode; the commands b Switch, b Central On and b Central Off are executable and can be used to switch the automatic twilight function on and off. • 1: Manual On mode; automatic twilight function is inactive – the value lr Manual Dim Value is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. • 2: Manual Off mode; automatic twilight function is inactive – the value 0.0 is output without a delay at the output lr Dim Value Out, all other command inputs are ineffective. b Switch: Positive edges on this input switch the automatic twilight function on and off alternately. When switching off the output lr Dim Value is set to 0.0. This command input is active only in automatic mode (ui Light Ctrl Mode=0). b Central On: A positive edge on this input switches the automatic twilight function on. This command input is active only in automatic mode (ui Light Ctrl Mode=0). b Central Off: A positive edge on this input switches the automatic twilight function off and sets the output lr Dim Value to 0.0. This command input is active only in automatic mode (ui Light Ctrl Mode=0). ui Brightness: Light actual value [lux]. VAR_OUTPUT lr Dim Value : LREAL; ui Remaining On Delay : UINT; ui Remaining Off Delay : UINT; b Control Active : BOOL; b Error : BOOL; udi Error Id : UDINT; lr Dim Value: Light output value, 0..100%. ui Remaining On Delay: Countdown of the switch-on delay in seconds. This output is 0 as long as no countdown of the time is taking place. ui Remaining Off Delay: Countdown of the switch-off delay in seconds. This output is 0 as long as no countdown of the time is taking place. b Control Active: This output is TRUE if the function block is in automatic mode and the automatic twilight function is activated. This is intended to serve as an additional feedback signal if switch-on has taken place but the controller outputs a light value of lr Dim Value=0.0. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. 228 Version: 1.3.0 TF8000
## Page 229

Programming If an error should occur, then this automatic function is deactivated and position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. VAR_IN_OUT ui Switch On Value : UINT; ui Switch Off Value : UINT; ui On Delay : UINT; ui Off Delay : UINT; lr Dim On Value : LREAL; lr Dim Off Value : LREAL; lr Manual Dim Value : LREAL; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Switch On Value: Switch-on threshold value. This is compared with the brightness value at the input ui Brightness. This value must be greater than the output threshold value ui Switch Off Value. ui Switch Off Value: Switch-off threshold value. This is compared with the brightness value at the input ui Brightness. ui On Delay: Switch-on delay in seconds. ui Off Delay: Switch-off delay in seconds. lr Dim On Value: Switch-on light value in %. lr Dim Off Value: Switch-off light value in %. lr Manual Dim Value: Output dimming value in Manual On mode (ui Light Ctrl Mode=1). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher Documents about this 2 https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/5090272523.zip TF8000 Version: 1.3.0 229
## Page 230

Programming 5.1.5.4 Sun protection 5.1.5.4.1 Overview shading 230 Version: 1.3.0 TF8000
## Page 231

Programming TF8000 Version: 1.3.0 231
## Page 232

Programming 5.1.5.4.2 Overview sun protection 232 Version: 1.3.0 TF8000
## Page 233

Programming 5.1.5.4.3 Sun protection: Basic principles and definitions The direct incidence of daylight is regarded as disturbing by persons in rooms. On the other hand, however, people perceive natural light to be more pleasant in comparison with artificial light. Two options for glare protection are to be presented here: • Slat adjustment • Height adjustment Lamella setpoint tracing A blind with lamellas that can be adjusted offers the option of intelligent sun protection here. The position of the lamellas is cyclically adapted to the current position of the sun, so that no direct daylight enters through the blinds, but as much diffuse daylight can be utilized as possible. The illustration shows that diffuse light can still enter from underneath, whereas no further direct daylight, or theoretically only a single ray, can enter. The following parameters are necessary for the calculation of the lamella angle: • the current sun elevation (elevation angle) • the sun position, i.e. the azimuth angle • the facade orientation • the lamella width • the lamella spacing Effective elevation angle If the blind is viewed in section as above, the angle of incidence does not depend solely on the sun elevation, but also on the direction of the sun: • If the facade orientation and the sun position (azimuth) are the same, i.e. the sunlight falls directly onto the facade, the effective light incidence angle is the same as the current elevation angle. • However, if the sunlight falls at an angle onto the facade as seen from the sun direction, the effective angle is larger for the same elevation angle. This relationship can easily be illustrated with a set square positioned upright on the table: Viewed directly from the side you can see a triangle with two 45° angles and one 90° angle. If the triangle is rotated, the side on the table appears to become shorter and the two original 45° angles change. The triangle appears to be getting steeper. We therefore refer to the "effective elevation angle", which describes the proportion of light that falls directly onto the blind. The following three images illustrate the relationship between the effective elevation angle and the blind dimensions, and how the resulting lamella angle λ changes during the day: TF8000 Version: 1.3.0 233
## Page 234

Programming More detailed information on this topic can be found in the chapter Effective elevation angle [} 238]. 234 Version: 1.3.0 TF8000
## Page 235

Programming Height adjustment With a high position of the sun at midday, the direct rays of sunlight do not penetrate into the full depth of the room. If direct rays of sunlight in the area of the window sill are regarded as uncritical, the height of the sun protection can be adapted automatically in such a way that the rays of sunlight only ever penetrate into the room up to an uncritical depth. In order to be able to calculate at any time the appropriate blind height that guarantees that the incidence of sunlight does not exceed a certain value, the following values are necessary. Required for the calculation of the respective blind height: • Height of the sun (elevation) • Window height • Distance between the window and the floor The following illustration shows where these parameters are to be classified: TF8000 Version: 1.3.0 235
## Page 236

Programming Influence of the facade inclination In both of the methods of sun protection described, it was assumed that the facade and thus the windows are perpendicular to the ground. In the case of an inclined facade, however, the incidence of light changes such that this influence will also be taken into account. The facade inclination is defined as follows: 236 Version: 1.3.0 TF8000
## Page 237

Programming TF8000 Version: 1.3.0 237
## Page 238

Programming 5.1.5.4.3.1 Effective elevation angle This chapter describes the relationship between the incidence of sunlight on the facade and the elevation angle. 238 Version: 1.3.0 TF8000
## Page 239

Programming Case 1 shows a typical incidence of sunlight on a south-facing facade at midday. The sun is high compared to the morning and evening. The green shaded triangle represents the elevation angle ԑ. Seen from the direction of the sun (azimuth), only the orthogonal component has a direct effect on the facade! In this case, the elevation angle ԑ is therefore equal to the effective elevation angle ԑ or the profile angle for eff the calculation. Case 2 shows a typical incidence of sunlight at midday on a south-facing facade, but lower. The green shaded triangle represents the elevation angle ԑ, which is smaller compared to case 1. Here too, the elevation angle ԑ is equal to the effective elevation angle ԑ or the profile angle for the eff calculation. Case 3 shows a typical incidence of sunlight on a south-facing facade in the evening. The elevation angle is the same as in case 2, so case 3 is the continuation of case 1 on the same day. The green shaded triangle from case 2 (building in profile) is now tilted forwards. However, it represents the orthogonal lighting component. The elevation angle for this component is visibly larger than in case 2, where the sun shines orthogonally onto the facade. 5.1.5.4.4 Shading correction: basic principles and definitions The shading correction can be used in conjunction with the automatic sun function or louvre adjustment. The function checks whether a window or a window group that is assigned to a room, for example, is temporarily placed in the shade by surrounding buildings or parts of its own building. Sun shading for windows that stand in the shadow of surrounding buildings or trees is not necessary and may even be disturbing under certain circumstances. On the basis of data entered regarding the facade and its surroundings, the shading correction determines which parts of the front are in the shade. Hence, it is then possible to decide whether the sun protection should be active for individual windows or window groups. Apart from the current position of the sun, the shading of the individual windows depends on three things: • the orientation of the facade • the position of the windows • the positioning of the shading objects The following illustrations are intended to describe these interrelationships and to present the parameters to be entered. TF8000 Version: 1.3.0 239
## Page 240

Programming Orientation of the facade Observation from above For the pure observation of the shadow thrown on the facade, a two-dimensional coordinate system is ultimately required, therefore the x and y axis were placed on the facade. The zero point is thereby at the bottom left on the base, as if one were regarding the facade from the front. For the calculation of the shading objects the Z component is then also added. Its axis points from away the facade and has the same zero point as the X and Y axis. The horizontal position of the sun (azimuth angle)in the northern hemisphere is by definition measured from the north. The facade orientation is likewise related to north, wherein the following applies to the line of sight from a window in the facade: Line of sight Facade orientation North β=0° East β=90° South β=180° West β=270° The course of the sun in the southern hemisphere is different. The sun rises in the east as well. but at noon it is located in the north. Thus the definition of the facade-orientation is changed as well: Line of sight Facade orientation South β=0° East β=90° North β=180° West β=270° 240 Version: 1.3.0 TF8000
## Page 241

Programming All further explanations in this chapter are referring to the characteristics of the northern hemisphere. For the the subsequent parameterization of the shading-correction (FB_BARShading Correction [} 263] / FB_BARShading Correction South [} 266]) only the facade-orientation is important, which can be taken from the above mentioned tables for either the northern or southern hemisphere. The following two illustrations are intended to further clarify the position of the point of origin P as well as the 0 orientation of the coordinate system: Observation from the side TF8000 Version: 1.3.0 241
## Page 242

Programming The angle of elevation (height of the sun) can be represented using this illustration: by definition this is 0° at sunrise (horizontal incidence of light) and can reach maximally 90°, but this applies only to places within the Tropic of Cancer and the Tropic of Capricorn. Observation from the front Here, the position of the point of origin, P , at the bottom left base point of the facade is once more very 0 clear. Beyond that the X-Y orientation is illustrated, which is important later for the entry of the window elements. Position of the windows The position of the windows is defined by the specification of their bottom left corner in relation to the facade coordinate system. Since a window lies flat on the facade, the entry is restricted to the X and Y coordinates. 242 Version: 1.3.0 TF8000
## Page 243

Programming The width and height must additionally be specified. TF8000 Version: 1.3.0 243
## Page 244

Programming The position of each window corner on the facade is determined internally from the values entered. A window is considered to be in the shade if all corners lie in the shade. Positioning of the shading objects When describing the shading objects, distinction is made between angular objects (building, column) and objects that are approximately spherical (e.g. trees). Angular objects can be categorised according to the shadow they cast into square, shadow-casting facades, wherein one must consider which ones cast the main shadows over the course of the day: 244 Version: 1.3.0 TF8000
## Page 245

Programming Morning/midday In the morning and at midday, the shadows are mainly cast by the sides S and S ; S und S need not be 1 4 2 3 considered if they are not higher. TF8000 Version: 1.3.0 245
## Page 246

Programming Afternoon / evening In the afternoon and in the evening too, the total shade can be determined alone by the observation of S 1 and S . In this case, therefore, it is sufficient to specify S and S as shadow-casters. The entry is made on 2 1 2 the basis of the four corners or their coordinates in relation to the zero point of the facade: 246 Version: 1.3.0 TF8000
## Page 247

Programming In this sketch only the upper points, P and P , are illustrated due to the plan view. The lower point P lies 2 3 1 underneath P and P lies underneath P . 2 4 3 The input of shadow-casting ball elements is done by entering the centre of the ball and its radius: Ball elements A "classification" of the ball element as in the case of the angular building is of course unnecessary, since the shadow cast by a ball changes only its direction, but not its size. 5.1.5.4.5 FB_BARBlind Position Entry This function block serves for the input of interpolation points for the function block FB_BARSun Protection Ex [} 305], if this should be operated in the height positioning mode with the help of a table, see E_BARPos Mode [} 500]. TF8000 Version: 1.3.0 247
## Page 248

Programming In addition to the operation modes "Fixed shutter height" and "Maximum light incidence", the function block FB_BARSun Protection Ex [} 305] also offers the possibility to control the blind height in relation to the position of the sun by means of table entries. By entering several interpolation points, the shutter height relative to the respective sun position is calculated by linear interpolation. However, since incorrectly entered values can lead to malfunctions in FB_BARSun Protection Ex [} 305] , this function block is to be preceded by the function block FB_BARBlind Position Entry. Four interpolation points can be parameterized on this function block, whereby a missing entry is evaluated as a zero entry. The function block does not sort the values entered independently, but instead ensures that the positions of the sun entered in the respective interpolation points are entered in ascending order. Unintentional erroneous entries are noticed faster as a result. The selected values for r Sun Elevation1 .. r Sun Elevation4 must also be unique; for example, they may not be: [r Sun Elevation1 = 10; ui Blind Position1 = 50] and at the same time [r Sun Elevation2 = 10; ui Blind Position2 = 30]. This would mean that there would be two different target values for one and the same value, which does not allow a unique functional correlation to be established. On top of that the entries for the position of the sun and shutter height must lie within the valid range. Mathematically this means that the following conditions must be satisfied: • r Sun Elevation1 < r Sun Elevation2 < r Sun Elevation3 < r Sun Elevation4 - (values ascending and unequal) • 0 ≤r Sun Elevation≤ 90 (in degrees - range of validity of source values) • 0 ≤ui Blind Position≤ 100 (in percent - range of validity of target values) The function block checks the values entered for these conditions and outputs an error code [} 317] if they are not satisfied. In addition, the output b Valid is set to FALSE. Furthermore the function block independently ensures that the boundary areas are filled out: Internally a further interpolation point is setup at r Sun Elevation = 0 with ui Blind Position1 and a further one above r Sun Elevation4 at r Sun Elevation = 90 with ui Blind Position4. This ensures that a sensible target value exists for all valid input values 0 ≤r Sun Elevation≤ 90 without the user having to assign an entry for r Sun Elevation = 0 and r Sun Elevation = 90: The actual number of interpolation points transferred to the function block FB_BARSun Protection Ex [} 305] thus increases to 6, see ST_BARBlind Position Table [} 501]. The interpolation of the values takes place in the glare protection block. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; 248 Version: 1.3.0 TF8000
## Page 249

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. VAR_OUTPUT b Valid : BOOL; ui Error Id : UDINT; st Blind Position Table : ST_BARBlind Position Table; b Valid: this output will be TRUE as long as the entries correspond to the criteria listed above. ui Error Id: contains the error code, if the entries should not correspond to the criteria listed above. See Error codes [} 317]. st Blind Position Table : Transfer structure of the interpolation points, see ST_BARBlind Position Table [} 501]. VAR_IN_OUT lr Sun Elevation1 : REAL;; ui Blind Position1 : UINT; lr Sun Elevation2 : REAL; ui Blind Position2 : UINT; lr Sun Elevation3 : REAL; ui Blind Position3 : UINT; lr Sun Elevation4 : REAL; ui Blind Position4 : UINT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. lr Sun Elevation1: Sun position at the first interpolation point (0°..90°). ui Blind Position1: Blind position (degree of closure) at the first interpolation point (0%..100%). lr Sun Elevation2: Sun position at the second interpolation point (0°..90°). ui Blind Position2: Blind position (degree of closure) at the second interpolation point (0%..100%). lr Sun Elevation3: Sun position at the third interpolation point (0°..90°). ui Blind Position3: Blind position (degree of closure) at the third interpolation point (0%..100%). lr Sun Elevation4: Sun position at the fourth interpolation point (0°..90°). TF8000 Version: 1.3.0 249
## Page 250

Programming ui Blind Position4: Blind position (degree of closure) at the fourth interpolation point (0%..100%). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.6 FB_BARDelayed Hysteresis This function block represents a threshold switch for brightness. The switch-on and switch-off behavior can additionally be delayed. VAR_INPUT e Data Security Type : E_HVACData Security Type; ui Brightness : UINT; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. ui Brightness: External brightness in lux. VAR_OUTPUT b Out : BOOL; b Error : BOOL; udi Error Id : UDINT; b Out: binary delayed output of the threshold switch b Error: this output is switched to TRUE if the parameters entered are erroneous. udi Error Id: contains the error code if the values entered should be erroneous. See Error codes [} 317]. 250 Version: 1.3.0 TF8000
## Page 251

Programming VAR_IN_OUT ui On Value : UINT; ui Off Value : UINT; ui On Delay : UINT; ui On Delay : UINT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui On Value: Switch-on threshold value in lux. This must be larger than the switch-off threshold value ui Off Value. ui Off Value: Switch-off threshold value in lux. This must be smaller than the switch-on threshold value ui On Value. ui On Delay: Switch-on delay in seconds. ui Off Delay: Switch-off delay in seconds. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.7 FB_BARFacade Element Entry This function block serves the administration of all facade elements (windows) in a facade, which are saved globally in a list of facade elements [} 315]. It is intended to facilitate the input of the element information - also with regard to the use of the target visualization. A schematic illustration of the objects with description of the coordinates is given in Shading correction: principles and definitions [} 239]. The facade elements are declared in the global variables as a two-dimensional field above the window columns and rows: VAR_GLOBAL arr Facade Element : ARRAY[1..i Columns Per Facade, 1..i Rows Per Facade] OF ST_BARFacade Element; END_VAR Each individual element arr Facade Element carries the information for one facade element (ST_BARFacade Element [} 501]). The information includes the group affiliation, the dimensions (width, height) and the coordinates of the corners. The function block thereby accesses this field directly via the IN-OUT variable arr Facade Element. Note: The fact that the coordinates of corners 2 to 4 are output values arises from the fact that they are formed from the input parameters and are to be available for use in a visualization: TF8000 Version: 1.3.0 251
## Page 252

Programming All data in meters! lr Corner2X = lr Corner1X lr Corner2Y = lr Corner1Y + lr Window Height (window height) lr Corner3X = lr Corner1X + lr Window Width (window width) lr Corner3Y = lr Corner2Y lr Corner4X = lr Corner1X + lr Window Width (window width) lr Corner4Y = lr Corner1Y The function block is used in three steps: • Read • Change • Write Read With the entries in i Column and i Row the corresponding element is selected from the list arr Facade Element[i Column,i Row]. A rising edge on b Read reads the following data from the list element: • usi Group Group membership, • lr Corner1X X-coordinate of corner 1 in metres • lr Corner1Y Y-coordinate of corner 1 in metres • lr Window Width Window width in metres • lr Window Height Window height in metres These are then assigned to the corresponding input variables of the block, which uses them to calculate the coordinates of corners 2-4 as output variables in accordance with the correlation described above. It is important here that the input values are not overwritten in the reading step. Hence, all values can initially be displayed in a visualisation. 252 Version: 1.3.0 TF8000
## Page 253

Programming Change In a next program step the listed input values can then be changed. The values entered are constantly checked for plausibility. The output b Valid indicates whether the values are valid (b Valid=TRUE). If this is not the case, a corresponding error code [} 317] is output at the output udi Error Id. See also below "Errors (b Valid=FALSE)". Write The parameterised data are written to the list element with the index n Id upon a rising edge on b Write, regardless of whether they represent valid values or not. Therefore the element structure ST_BARFacade Element [} 501] also contains a plausibility bit, b Value, that relays precisely this information to the function block FB_BARShading Correction [} 263] / FB_BARShading Correction South [} 266] and prevents incorrect calculations there. Error (b Valid=FALSE) The function block FB_BARShading Correction [} 263] / FB_BARShading Correction South [} 266], which judges whether all windows in a group are shaded, will only perform its task if all windows in the examined group have valid entries. This means: • usi Group must be greater than 0 • lr Corner1X must be greater than or equal to 0.0 • lr Corner1Y must be greater than or equal to 0.0 • lr Window Width must be greater than 0 • lr Window Height must be greater than 0 If one of these criteria is not fulfilled, then this is interpreted as an incorrect input and b Valid is set to FALSE at the block output of FB_BARFacade Element Entry as well as in the window element ST_BARFacade Element [} 501]. If on the other hand all entries of a facade element are zero, it is regarded as a valid, deliberately omitted facade element: TF8000 Version: 1.3.0 253
## Page 254

Programming In the case of a facade of 6x4 windows, the elements window (2,1), window (3,5) and window (4,4) would be empty elements here. VAR_INPUT e Data Security Type : E_HVACData Security Type; i Column : INT; i Row : INT; b Write : BOOL; b Read : BOOL; usi Group : USINT; lr Corner1X : LREAL; lr Corner1Y : LREAL; lr Window Width : LREAL; lr Window Height : LREAL; 254 Version: 1.3.0 TF8000
## Page 255

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. i Column: Column index of the selected component on the facade. This refers to the selection of a field element of the array stored in the IN-OUT variable arr Facade Element. i Row: dto. Row index. i Row and i Column may not be zero! This arises from the field definition, see above. b Read: With a positive edge on this input, the information from the selected element arr Facade Element [i Column,i Row] is read into the function block and assigned to the input variables usi Group to r Window Height. This gives rise to the output variables r Corner2X to r Corner4Y. If data are already present on the inputs usi Group to r Window Height at time of reading, then the data previously read are immediately overwritten with these data. b Write: A rising edge writes both the entered values and the calculated values into the selected field element arr Facade Element [i Column,i Row]. usi Group: Group membership, lr Corner1X: X-coordinate of corner point 1 in meters. lr Corner1Y: Y-coordinate of corner point 1 in meters. lr Window Width: Window width in meters. lr Window Height: Window height in meters. VAR_OUTPUT lr Corner2X : LREAL; lr Corner2Y : LREAL; lr Corner3X : LREAL; lr Corner3Y : LREAL; lr Corner4X : LREAL; lr Corner4Y : LREAL; b Valid : BOOL; udi Error Id : UDINT; lr Corner2X: determined X-coordinate of corner 2 of the window in metres. See "Note" above. lr Corner2Y: determined Y-coordinate of corner 2 of the window in metres. See "Note" above. lr Corner3X: determined X-coordinate of corner 3 of the window in metres. See "Note" above. lr Corner3Y: determined Y-coordinate of corner 3 of the window in metres. See "Note" above. lr Corner4X: determined X-coordinate of corner 4 of the window in metres. See "Note" above. lr Corner4Y: determined Y-coordinate of corner 4 of the window in metres. See "Note" above. b Valid: result check for the entered values. TF8000 Version: 1.3.0 255
## Page 256

Programming udi Error Id: contains the error code if the values entered are not OK. See Error codes [} 317]. VAR_IN_OUT arr Facade Element : ARRAY[1..i Columns Per Facade, 1..i Rows Per Facade] OF ST_BARFacade Element; arr Facade Element: List of facade elements [} 315]. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.8 FB_BARRead Facade Element List With the help of this function block, data for facade elements (windows) can be imported from a pre-defined Excel table in csv format into the list of facade elements [} 315]. In addition the imported data are checked for plausibility and errors are written to a log file. VAR_INPUT b Start : BOOL; s Data File : STRING; s Log File : STRING; s Net Id : STRING; b Start: A TRUE edge on this input starts the reading process. s Data File: Contains the path and file name for the data file to be opened. This must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". If the file is opened with a simple text editor, then the values must be displayed separated by semicolons. Example of an entry: s Data File:= 'C: \Projects\Facade Elements.csv' s Log File: dto. Log file for the accumulating errors. This file is overwritten each time the function block is activated, so that only current errors are contained. s Net Id: A string can be entered here with the AMS Net ID of the Twin CAT computer on which the files are to be written/read. If it is to be run on the local computer, an empty string can be entered. The data can be saved only on the control computer itself and on the computers that are connected by ADS to the control computer. Links to local hard disks in this computer are possible, but not to connected network hard drives. VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; ui Amount Of Sets Read : UINT; b Busy: This output is TRUE as long as elements are being read from the file. b Error: This output is switched to TRUE if the parameters entered are erroneous or if an error has occurred while writing to or reading from the file. udi Error Id: Contains the error code of the error that occurred last. See Error codes [} 317] or ADS_Error codes. 256 Version: 1.3.0 TF8000
## Page 257

Programming ui Amount Of Sets Read: Number of data sets read VAR_IN_OUT arr Facade Element : ARRAY[1..i Columns Per Facade, 1..i Rows Per Facade] OF ST_BARFacade Element; arr Facade Element: List of facade elements [} 315]. Excel table The following example shows the Excel table with the entries of the window elements. All text fields are freely writeable; important are the green marked fields, wherein each line of a data set is marked there. The following rules are to be observed: • A data set must always start with a '@'. • The indices Index Column and Index Row must lie within the defined limits, see List of facade elements [} 315]. These indices directly describe the facade element in the list arr Facade Elements to which the data from the set are saved. • Window width and window height must be greater than zero • The corner coordinates P1x and P1y must be greater than or equal to zero. • Each window element must be assigned to a group 1..255. • For system-related reasons the total size of the table may not exceed 65534 bytes. • The table has to be saved in Excel as file type "CSV (comma-separated values) (*.csv)". It is not necessary to describe all window elements that would be possible by definition or declaration. Before the new list is read in, the function block deletes the entire old list in the program. All elements that are not described by entries in the Excel table then have pure zero entries and are thus marked as non-existent and also non-evaluable, since the function block for shading correction, FB_BARSun Protection Ex [} 305], does not accept elements with the group entry '0'. TF8000 Version: 1.3.0 257
## Page 258

Programming Log file Each time the reading function block is restarted, the log file is rewritten and the old contents are deleted. If there is no log file, it will be automatically created first. The log file then contains either an OK message or a list of all errors that have occurred. Errors connected with the opening, writing or closing of the log file itself cannot be written at the same time. Therefore the output udi Error Id of the reading function block must also always be observed, since it displays the last error code. Since the log file is always closed last during the reading process, a corresponding alarm is ensured in the event of an error. 258 Version: 1.3.0 TF8000
## Page 259

Programming Program sample In this sample the variable b Init is initially set to TRUE when the PLC starts. Hence, the input b Start on the function block fb Read Facade Element List receives a once-only rising edge that triggers the reading process. The file "Facade Elements.csv" is read, which is located in the folder "C:\Projects\". The log file "Logfile.txt" is then saved in the same folder. If this log file does not yet exist it will be created, otherwise the existing contents are overwritten. Reading and writing take place on the same computer on which the PLC is located. This is defined by the input s Net ID = '' (=local). All data are written to the list arr Facade Element declared in the program. The output b Busy is TRUE as long as reading and writing are taking place. The error that occurred last is indicated on udi Error Id; b Error is then TRUE. The number of data lines found and read is indicated on ui Amount Of Sets Read for checking purposes. The errors marked were "built into" the following Excel list. This results in the shown log file: TF8000 Version: 1.3.0 259
## Page 260

Programming The first error is in data set 2 and is an index error, since "0" is not permitted. The next error in data set 6 was found after validation of the data with the internally used function block FB_BARShading Objects Entry [} 269] and was therefore provided in greater detail with an error number, which is explained in greater detail under error codes [} 317]. The third and the fourth errors likewise occurred after the internal validation. Important here is that the data set numbers (in this case 22 and 24) do not go by the numbers entered in the list, but by the actual sequential numbers: only 30 data sets were read in here. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.9 FB_BARRead Shading Objects List 260 Version: 1.3.0 TF8000
## Page 261

Programming With the help of this function block, data for shading objects can be imported from a pre-defined Excel table in csv format into the list of shading objects [} 316]. In addition the imported data are checked for plausibility and errors are written to a log file. VAR_INPUT b Start : BOOL; s Data File : STRING; s Log File : STRING; s Net Id : STRING; b Start: A TRUE edge on this input starts the reading process. s Data File: Contains the path and file name for the data file to be opened. This must have been saved in Excel as file type "CSV (comma-separated values) (*.csv)". If the file is opened with a simple text editor, then the values must be displayed separated by semicolons. Example of an entry: s Data File:= 'C: \Projects\Shading Objects.csv' s Net Id: A string can be entered here with the AMS Net ID of the Twin CAT computer on which the files are to be written/read. If it is to be run on the local computer, an empty string can be entered. The data can be saved only on the control computer itself and on the computers that are connected by ADS to the control computer. Links to local hard disks in this computer are possible, but not to connected network hard drives. VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; ui Amount Of Sets Read : UINT; b Busy: This output is TRUE as long as elements are being read from the file. b Error: This output is switched to TRUE if the parameters entered are erroneous or if an error has occurred while writing to or reading from the file. udi Error Id: Contains the error code of the error that occurred last. See Error codes [} 317] or ADS_Error codes. ui Amount Of Sets Read: Number of data sets read. VAR_IN_OUT arr Shading Object : ARRAY[1..i Shading Objects] OF ST_BARShading Object; arr Shading Object: List of shading objects [} 316]. Excel table The following example shows the Excel table with the entries of the window elements. All text fields are freely writeable; important are the green marked fields, wherein each line of a data set is marked there. The columns G to J have a different meaning depending on whether the type square or ball is concerned. The columns K to M are to be left empty in the case of balls. With regard to the square coordinates, only the relevant data are entered and the remainder are internally calculated, see FB_BARShading Objects Entry [} 269]. The following rules are to be observed: • A data set must always start with a '@'. • The monthly entries may not be 0 or greater than 12, otherwise all combinations are possible. Examples: Start=1, End=1: shading in January. Start=1, End=5: shading from the beginning of January to the end of May. Start=11, End=5: shading from the beginning of November to the end of May (the following year). • Window width and window height must be greater than zero • The z-coordinates P1z and P3z or Mz must be greater than zero. TF8000 Version: 1.3.0 261
## Page 262

Programming • The radius must be greater than zero. • For system-related reasons the total size of the table may not exceed 65534 bytes. • The table has to be saved in Excel as file type "CSV (comma-separated values) (*.csv)". Is not necessary to describe all shading objects that are possible per facade. Only those contained in the list ultimately take effect. Log file Each time the reading function block is restarted, the log file is rewritten and the old contents are deleted. If there is no log file, it will be automatically created first. The log file then contains either an OK message or a list of all errors that have occurred. However, errors connected with the opening, writing or closing of the log file itself cannot be written at the same time. Therefore the output udi Error Id of the reading function block must also always be observed, since it displays the last error code. Since the log file is always closed last during the reading process, a corresponding alarm is ensured in the event of an error. Program Example In this example the variable b Init is initially set to TRUE when the PLC starts. Hence, the input b Start on the function block fb Read Shading Objects List receives a once-only rising edge that triggers the reading process. The file "Shading Objects.csv" is read, which is located in the folder "C:\Projects\". The log file "Logfile.txt" is then saved in the same folder. If this log file does not yet exist it will be created, otherwise the existing contents are overwritten. Reading and writing takes place on the same computer on which the PLC is located. This is defined by the input s Net ID = '' (=local). All data are written to the list arr Shading Object declared in the program. The output b Busy is TRUEs as long as reading and writing are taking place. The error that occurred last is indicated on udi Error Id; b Error is then TRUE. The number of data lines found and read is indicated on ui Amount Of Sets Read for checking purposes. The errors marked were built into the following Excel list. This results in the shown log file: 262 Version: 1.3.0 TF8000
## Page 263

Programming The first error is in data set 3 and is a type error, since "2" is not defined. The next error in data set 6 was found after validation of the data with the internally used function block FB_BARShading Objects Entry [} 269] and was therefore provided in greater detail with an error number, which is explained in greater detail under error codes [} 317]. The third error likewise occurred after the internal validation. Important here it that the data set number (in this case 11) does not go by the number entered in the list, but by the actual sequential number: only 16 data sets were read in here. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.10 FB_BARShading Correction Function block for the shading evaluation of a window group on a facade. This function block is valid only for the northern hemisphere. The valid function block for the southern hemisphere is FB_BARShading Correction South [} 266]. The function block FB_BARShading Correction calculates whether a window group lies in the shadow of surrounding objects. The result, which is output at the output b Group Not Shaded, can be used to judge whether sun shading makes sense for this window group. The function block thereby accesses two lists, which are to be defined: TF8000 Version: 1.3.0 263
## Page 264

Programming • The data of the elements (window) of the facade in which the group to be regarded is located. This list of facade elements [} 315] is accessed via the IN-OUT variable arr Facade Element, which itself is globally defined. • The parameters that describe the shading elements that are relevant to the facade on which the window group is located. This list of shading objects [} 316] is likewise globally defined. The IN-OUT variable arr Shading Object accesses it directly. On the basis of the facade orientation (lr Facade Orientation), the direction of the sun (lr Azimuth) and the height of the sun (lr Elevation), a calculation can be performed for each corner of a window to check whether this lies in a shaded area. A window group is considered to be completely shaded if all corners are shaded. In the northern hemisphere, the following applies for the facade orientation (looking out of the window): Line of sight Facade orientation North β=0° East β=90° South β=180° West β=270° The function block performs its calculations only if the sun is actually shining on the facade. If one regards the drawing presented in the introduction, then this is the case if the following is true: Facade orientation < azimuth angle < facade orientation + 180° In addition, a calculation is also not required, if the sun has not yet risen, i.e. the solar elevation is below 0°. In both cases the output b Facade Sunlit is set to FALSE. VAR_INPUT e Data Security Type : E_HVACData Security Type; st Time Act : TIMESTRUCT; lr Azimuth : LREAL; lr Elevation : LREAL; 264 Version: 1.3.0 TF8000
## Page 265

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. st Time Act: Entry of the current time in GMT (Greenwich Mean Time). lr Azimuth: Sun direction in degrees at the time of observation. lr Elevation: Sun elevation in degrees at the time of observation. VAR_OUTPUT b Group Not Shaded : BOOL; b Facade Sunlit : BOOL; b Error : BOOL; udi Error Id : UDINT; b Group Not Shaded: is TRUE as long as the window group is not calculated as shaded. b Facade Sunlit: this output is set to TRUE if the sun is shining on the facade. See description above. b Error: this output is set to TRUE if an error is detected during the execution of the function block. udi Error Id: contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT arr Facade Element : ARRAY[1..i Columns Per Facade, 1..i Rows Per Facade] OF ST_BARFacade Element; arr Shading Object : ARRAY[1..i Shading Objects] OF ST_BARShading Object; lr Facade Orientation : LREAL; usi Group ID : USINT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. arr Facade Element: List of facade elements [} 315]. arr Shading Object: List of shading objects [} 316]. lr Facade Orientation: Facade orientation, see illustration above. usi Group Id: Window group regarded. The group 0 is reserved here for unused window elements, see FB_BARFacade Element Entry [} 251]. A 0-entry would lead to an error output (b Error=TRUE). The function block is then not executed any further and b Group Not Shaded is set to FALSE. TF8000 Version: 1.3.0 265
## Page 266

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.11 FB_BARShading Correction South Function block for the shading evaluation of a window group on a facade. This function block is valid only for the southern hemisphere. The valid function block for the northern hemisphere is FB_BARShading Correction [} 263]. The function block FB_BARShading Correction South calculates whether a window group lies in the shadow of surrounding objects. The result, which is output at the output b Group Not Shaded, can be used to judge whether sun shading makes sense for this window group. The function block thereby accesses two lists, which are to be defined: • The data of the elements (window) of the facade in which the group to be regarded is located. This list of facade elements [} 315] is accessed via the IN-OUT variable arr Facade Element, which itself is globally defined. • The parameters that describe the shading elements that are relevant to the facade on which the window group is located. This list of shading objects [} 316] is likewise globally defined. The IN-OUT variable arr Shading Object accesses it directly. On the basis of the facade orientation (lr Facade Orientation), the direction of the sun (lr Azimuth) and the height of the sun (lr Elevation), a calculation can be performed for each corner of a window to check whether this lies in a shaded area. A window group is considered to be completely shaded if all corners are shaded. In the southern hemisphere, the following applies for the facade orientation (looking out of the window): Line of sight Facade orientation South β=0° East β=90° North β=180° West β=270° The function block performs its calculations only if the sun is actually shining on the facade. If one regards the drawing presented in the introduction, then this is the case if the following is true: Facade orientation < azimuth angle < facade orientation + 180° 266 Version: 1.3.0 TF8000
## Page 267

Programming In addition, a calculation is also not required, if the sun has not yet risen, i.e. the solar elevation is below 0°. In both cases the output b Facade Sunlit is set to FALSE. VAR_INPUT e Data Security Type : E_HVACData Security Type; st Time Act : TIMESTRUCT; lr Azimuth : LREAL; lr Elevation : LREAL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. st Time Act: Entry of the current time in GMT (Greenwich Mean Time). lr Azimuth: Sun direction in degrees at the time of observation. lr Elevation: Sun elevation in degrees at the time of observation. TF8000 Version: 1.3.0 267
## Page 268

Programming VAR_OUTPUT b Group Not Shaded : BOOL; b Facade Sunlit : BOOL; b Error : BOOL; udi Error Id : UDINT; b Group Not Shaded: is TRUE as long as the window group is not calculated as shaded. b Facade Sunlit: this output is set to TRUE if the sun is shining on the facade. See description above. b Error: this output is set to TRUE if an error is detected during the execution of the function block. udi Error Id: contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT arr Facade Element : ARRAY[1..i Columns Per Facade, 1..i Rows Per Facade] OF ST_BARFacade Element; arr Shading Object : ARRAY[1..i Shading Objects] OF ST_BARShading Object; lr Facade Orientation : LREAL; usi Group ID : USINT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. arr Facade Element: List of facade elements [} 315]. arr Shading Object: List of shading objects [} 316]. lr Facade Orientation: Facade orientation, see illustration above. usi Group Id: Window group regarded. The group 0 is reserved here for unused window elements, see FB_BARFacade Element Entry [} 251]. A 0-entry would lead to an error output (b Error=TRUE). The function block is then not executed any further and b Group Not Shaded is set to FALSE. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 268 Version: 1.3.0 TF8000
## Page 269

Programming 5.1.5.4.12 FB_BARShading Objects Entry This function block serves for the administration of all shading elements in a facade, which is globally saved in a list of shading elements [} 316]. It is intended to facilitate the input of the element information - also with regard to the use of the target visualization. A schematic illustration of the objects with description of the coordinates is given in Shading correction: principles and definitions [} 239]. The shading elements are declared in the global variables: VAR_GLOBAL arr Shading Object : ARRAY[1..i Shading Objects] OF ST_BARShading Object; END_VAR Each individual element arr Shading Object[1] to arr Shading Object[i Shading Objects] carries the information for one shading element (ST_BARShading Object [} 502]). This information consists of the selected type of shading (rectangle or ball) and the respectively associated coordinates. For a rectangle, these are the corner points (lr P1x, lr P1y, lr P1z), (lr P2x, lr P2y, lr P2z),(lr P3x, lr P3y, lr P3z) and (lr P4x, lr P4y, lr P4z), for a ball the center (lr Mx, lr My, lr Mz) and the radius lr Radius. In addition, the phase of the shading can be defined via the inputs usi Begin Month and usi End Month, which is important in the case of objects such as trees that bear no foliage in winter. The function block thereby directly accesses the field of this information via the IN-OUT variable arr Shading Object. Note: The fact that the square coordinates lr P2x, lr P2z, lr P4x, lr P4y and lr P4z are output values arises from the fact that they are formed from the input parameters: lr P2x = lr P1x; lr P2z = lr P1z; lr P4x = lr P3x; lr P4y = lr P1y; lr P4z = lr P3z; This limits the input options for a rectangle such that the side edges are perpendicular to the floor (lr P2x = lr P1x and lr P4x = lr P3x), that the rectangle is not tilted (lr P2z = lr P1z and lr P4z = lr P3z), and that it can only have a positive height (y-direction) (lr P4y = lr P1y). The function block is used in three steps: • Read • Change • Write TF8000 Version: 1.3.0 269
## Page 270

Programming Read With the entry to i Id the appropriate element is selected from the list arr Shading Object, [i Id]. A rising edge on b Read reads the data. These values are assigned to the input and output variables of the function block. This concerns the input values lr P1x, lr P1y, lr P1z, lr P2y, lr P3x, lr P3y, lr P3z, lr Mx, lr My, lr Mz and lr Radius and the object enumerator e Type and the output values lr P2x, lr P2z, lr P4x, lr P4y, and lr P4z. It is important here that the input values are not overwritten in the reading step. Hence, all values can initially be displayed in a visualisation. Change In a next program step the listed input values can then be changed. If the use of a square is preselected via the value "e Object Type Tetragon" at the input e Type [} 500], then the output values lr P2x, lr P2z, lr P4x, lr P4y and lr P4z result from the square coordinates entered, see above. The values entered are constantly checked for plausibility. The output b Valid indicates whether the values are valid (b Valid=TRUE). If this is not the case, a corresponding error code [} 317] is output at the output udi Error Id. If a square is defined, then only the inputs lr P1x, lr P1y, lr P1z, lr P2y, lr P3x, lr P3y and lr P3z need to be described; the inputs lr Mx, lr My, lr Mz and lr Radius do not need to be linked. In case of a ball definition, only lr Mx, lr My, lr Mz and lr Radius need to be described and the square coordinates can remain unlinked. The parameterised data are written to the list element with the index i Id upon a rising edge on b Write, regardless of whether they represent valid values or not. Therefore the element structure ST_BARShading Object [} 502] also contains a plausibility bit, b Valid, that relays precisely this information to the function block FB_BARShading Correction [} 263] / FB_BARShading Correction South [} 266] and prevents incorrect calculations there. This approach is to be regarded only as a proposal. It is naturally also possible to parameterise the function block quite normally in one step and to write the values entered to the corresponding list element with a rising edge on b Write. VAR_INPUT i Id : INT; b Read : BOOL; b Write : BOOL; lr P1x : LREAL; lr P1y : LREAL; lr P1z : LREAL; lr P2y : LREAL; lr P3x : LREAL; lr P3y : LREAL; lr P3z : LREAL; lr Mx : LREAL; lr My : LREAL; lr Mz : LREAL; lr Radius : LREAL; usi Begin Month : USINT; usi End Month : USINT; e Type : E_BARShading Object Type; i Id: Index of the selected element. This refers to the selection of a field element of the array saved in the IN- OUT variable arr Shading Object. i Id may not be zero! This results from the field definition [} 269], arr Shading Object: ARRAY[1..i Shading Objects] OF ST_BARShading Object; b Read: With a rising edge on this input the information of the selected element, arr Shading Object [i Id], is read into the function block and assigned to the input variables lr P1x to e Type as well as the output variables lr P2x to lr P4z. If data are already present on the inputs lr P1x to e Type at this time, then the data previously read are immediately overwritten with these data. b Write: A positive edge writes the values on the inputs r P1x to e Type as well as the values determined and assigned to the outputs lr P2x to lr P4z into the selected field element arr Shading Object[i Id]. lr P1x: X-coordinate of point 1 of the shading element (square) in meters. lr P1y: Y-coordinate of point 1 of the shading element (square) in meters. 270 Version: 1.3.0 TF8000
## Page 271

Programming lr P1z: Z-coordinate of point 1 of the shading element (square) in meters. lr P2y: Y-coordinate of point 2 of the shading element (square) in meters. lr P3x: X-coordinate of point 3 of the shading element (square) in meters. lr P3y: Y-coordinate of point 3 of the shading element (square) in meters. lr P3z: Z-coordinate of point 3 of the shading element (square) in meters. lr Mx: X-coordinate of the center of the shading element (ball) in meters. lr My: Y-coordinate of the center of the shading element (ball) in meters. lr Mz: Z-coordinate of the center of the shading element (ball) in meters. lr Radius: Radius of the shading element (ball) in meters. usi Begin Month: Beginning of the shading period (month). usi End Month: End of the shading period (month). e Type: Selected type of element: Rectangle or ball. See E_BARShading Object Type [} 500]. Remark about the shading period: The entries for the months may not be 0 or greater than 12, otherwise all combinations are possible. Examples: Start=1, End=1: shading in January. Start=1, End=5: shading from the beginning of January to the end of May. Start=11, End=5: shading from the beginning of November to the end of May (the following year). VAR_OUTPUT lr P2x : LREAL; lr P2z : LREAL; lr P4x : LREAL; lr P4y : LREAL; lr P4z : LREAL; b Valid : BOOL; udi Error Id : UDINT; lr P2x: determined X-coordinate of point 2 of the shading element (square) in metres. See "Note" above. lr P2z: determined Z-coordinate of point 2 of the shading element (square) in metres. See "Note" above. lr P4x: determined X-coordinate of point 4 of the shading element (square) in metres. See "Note" above. lr P4y: determined Y-coordinate of point 4 of the shading element (square) in metres. See "Note" above. lr P4z: determined Z-coordinate of point 4 of the shading element (square) in metres. See "Note" above. b Valid: Result of the plausibility check for the values entered. With respect to a square it is required that the internal angle is 360° and that the points lie in one plane and in front of the facade regarded. In the case of a ball the centre must likewise lie in front of the facade and the radius must be greater than zero. udi Error Id: contains the error code, if the entries should not correspond to the criteria mentioned. See Error codes [} 317]. VAR_IN_OUT arr Shading Object : ARRAY[1..i Shading Objects] OF ST_BARShading Object; arr Shading Object : List of shading objects [} 316]. Values are persistently saved. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 271
## Page 272

Programming 5.1.5.4.13 FB_BARSunblind Actuator This function block is used for positioning of a slatted blind via two outputs: drive up and drive down. The blind can be driven to any desired (height) position and slat angle via the positioning telegram st Sunblind [} 503]. On top of that, the positioning telegram st Sunblind [} 503] also contains manual commands with which the blind can be moved individually to certain positions. These manual commands are controlled by the function block FB_BARSunblind Switch [} 291]. The total stroke time in milliseconds is limited here by the UINT format to 65535 ms. FB_BARSunblind Actuator Ex [} 278] should be used for longer stroke times as it represents these times in UDINT format (udi Total Time Up/udi Total Time Down). Structure of the blind positioning telegram st Sunblind [} 503]. TYPE ST_BARSunblind: STRUCT ui Position : UINT; i Angle : INT; b Man Up : BOOL; b Man Down : BOOL; b Manual Mode : BOOL; b Active : BOOL; END_STRUCT END_TYPE The current height position and the slat angle are not read in by an additional encoder, but determined internally by the travel time of the blind. The calculation is based on the following travel profile (regarded from the highest and lowest position of the blind): 272 Version: 1.3.0 TF8000
## Page 273

Programming Downward drive profile: More detailed explanations of the terms "backlash" and "turning" are given here in the downward movement: The blind normally describes its downward movement with the louvre low point directed outwards, as in fig. 3. If the blind is in an initial position with the low point directed inwards (i.e. after the conclusion of an upward movement), then a certain time elapses after a new downward movement begins before the louvres start to turn from the "inward low point" to the "outward low point". During this time the louvre angle does not change; the blind only drives downward (fig.1 and fig. 2). This time is an important parameter for the movement calculation and is entered in the function block in ms under ui Backlash Time Down. Since it is not known at an arbitrary point after a blind movement of an arbitrary length whether part of the backlash has already been travelled, the most secure way to measure the backlash of the downward movement or its travel time is when the blind has initially been driven fully upward. A further important parameter is the time interval of the subsequent turning of the louvres from the "Inward low point" to the "Outward low point". This time is to be entered as ui Turning Time Down in ms in the function block. TF8000 Version: 1.3.0 273
## Page 274

Programming Upward travel profile: More detailed explanations of the terms "backlash" and "turning" are given here in the upward movement: The circumstances are similar to the downward movement described above: The blind normally describes its upward movement with the slat low point directed inwards, as in fig. 3. If the blind is in an initial position with the low point directed outwards (i.e. after the conclusion of a downward movement), then a certain time elapses after a new upward movement begins before the slats start to turn from the "Outward low point" to the "Inward low point". During this time the slat angle does not change; the blind only drives upward (fig. 1 and fig. 2). This time is also an important parameter for the movement calculation and is entered in the function block in ms under ui Backlash Time Up. Since it is not known at an arbitrary point after a blind movement of an arbitrary length whether part of the reversal backlash has already been traversed, the most secure way to measure the reversal backlash of the upward movement or its extension time is when the blind has initially been driven fully downward. A further important parameter is the time interval of the subsequent turning of the slats from the "Outward low point" to the "Inward low point". This time is to be entered as ui Turning Time Up in ms in the function block. Parameterisation For the calculation of the (height) position and the louvre angle, the following times now have to be determined for both the upward and downward movement: • the travel time of the backlash (ui Backlash Time Up / ui Backlash Time Down in ms) • the turning duration (ui Turning Time Up / ui Turning Time Down in ms) • the total travel time (ui Total Up Time / ui Total Down Time in ms) Furthermore the following are required for the calculation: • the total extended blind height (ui Blind Height in mm) • the highest louvre angle after turning upwards (i Angle Limit Up in degrees) • the lowest louvre angle after turning downwards (i Angle Limit Down in degrees) The louvre angle λ is defined by a notional straight line through the end points of the louvre to the horizontal. 274 Version: 1.3.0 TF8000
## Page 275

Programming Functioning The function block fundamentally controls the blind via the information from the positioning telegram st Sunblind [} 503]. If automatic mode is active (b Manual Mode=FALSE), then the current position and louvre angle are always driven to, wherein changes are immediately accounted for. The height positioning takes priority: First the entered height and afterwards the louvre angle are driven to. For reasons of the simplicity the position error due to the angle movement is disregarded. In manual mode (b Manual Mode=TRUE) the commands b Man Up and b Man Down control the blind. Referencing Secure referencing is ensured if the blind is driven upward for longer than its complete drive-up time. The position is then in any case "0" and the louvre angle is at its maximum. Since blind positioning without an encoder is naturally always susceptible to error, it is important to automatically reference as often as possible: each time the "0" position is to be driven to (the angle is unimportant), the blind initially drives upward quite normally with continuous position calculation. Once the calculated position value of 0% has been reached, the output b Blind Up is kept active until another complete drive-up time + 5 s has elapsed. For reasons of flexibility there are now two possibilities to interrupt the referencing procedure: Until the calculated 0% position has been reached, a change of position is still accepted and executed; after reaching this 0% position, the manual command "down" can still move the blind differently. These two sensible limitations make it necessary for the user to ensure that the blind is securely referenced as often as possible. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; st Sunblind : ST_BARSunblind; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. TF8000 Version: 1.3.0 275
## Page 276

Programming b Enable: Enable input for the function block. As long as this input is TRUE, the actuator function block accepts and executes commands as described above. A FALSE signal on this input resets the control outputs b Blind Up and b Blind Down and the function block remains in a state of rest. st Sunblind: Positioning telegram, see ST_BARSunblind [} 503]. VAR_OUTPUT b Blind Up : BOOL; b Blind Down : BOOL; ui Act Position : UINT; ui Act Angle : UINT; b Referencing : BOOL; b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; b Blind Up: control output for blind up. b Blind Down: control output for blind down. ui Act Position: current position in percent. ui Act Angle: current louvre angle in degrees. b Referencing: the blind is in the reference-process, which means, that the output b Blind Up will be set for the complete drive-up time + 5 s. Only the manual command "down" can move the blind in the opposite direction an terminate the reference-mode. b Busy: a positioning or a referencing procedure is in progress. b Error: this output is switched to TRUE if the parameters entered are erroneous. udi Error Id: contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT ui Backlash Time Up : UINT; ui Backlash Time Down : UINT; ui Turning Time Up : UINT; ui Turning Time Down : UINT; ui Total Time Up : UINT; ui Total Time Down : UINT; ui Blind Height : UINT; i Angle Limit Up : INT; i Angle Limit Down : INT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Backlash Time Up: Time to traverse the backlash in the upward direction in ms. ui Backlash Time Down: Time to traverse the backlash in the downward direction in ms. ui Turning Time Up: Time for turning the slats in the upward direction in ms. ui Turning Time Down: Time for turning the slats in the downward direction in ms. ui Total Time Up: Complete time for driving up in ms. ui Total Time Down: Complete time for driving down in ms. ui Blind Height: This input is currently not used and does not need to be described by the user. i Angle Limit Up: Highest position of the slats in degrees. This position is reached once the blind has moved to the top position. 276 Version: 1.3.0 TF8000
## Page 277

Programming The slat angle λ, as defined above, is then typically greater than zero. i Angle Limit Down: Lowest position of the slats in degrees. This position is reached once the blind has moved to the bottom position. The slat angle λ, as defined above, is then typically less than zero. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 277
## Page 278

Programming 5.1.5.4.14 FB_BARSunblind Actuator Ex This function block is used for positioning of a slatted blind via two outputs: drive up and drive down. The blind can be driven to any desired (height) position and slat angle via the positioning telegram st Sunblind [} 503]. On top of that, the positioning telegram st Sunblind [} 503] also contains manual commands with which the blind can be moved individually to certain positions. These manual commands are controlled by the function block FB_BARSunblind Switch [} 291]. As opposed to the function block FB_BARSunblind Actuator [} 272], this allows the input of longer stroke times because they are represented here not in UINT, but in the UDINT format (udi Total Time Up/ udi Total Time Down). Structure of the blind positioning telegram st Sunblind [} 503]. TYPE ST_BARSunblind: STRUCT ui Position : UINT; i Angle : INT; b Man Up : BOOL; b Man Down : BOOL; b Manual Mode : BOOL; b Active : BOOL; END_STRUCT END_TYPE The current height position and the slat angle are not read in by an additional encoder, but determined internally by the travel time of the blind. The calculation is based on the following travel profile (regarded from the highest and lowest position of the blind): 278 Version: 1.3.0 TF8000
## Page 279

Programming Downward travel profile: More detailed explanations of the terms "backlash" and "turning" are given here in the downward movement: The blind normally describes its downward movement with the slat low point directed outwards, as in fig. 3. If the blind is in an initial position with the low point directed inwards (i.e. after the conclusion of an upward movement), then a certain time elapses after a new downward movement begins before the slats start to turn from the "inward low point" to the "outward low point". During this time the slat angle does not change; the blind only drives downward (fig.1 and fig. 2). This time is an important parameter for the movement calculation and is entered in the function block in ms under ui Backlash Time Down. Since it is not known at an arbitrary point after a blind movement of an arbitrary length whether part of the reversal backlash has already been traversed, the most secure way to measure the reversal backlash of the downward movement or its extension time is when the blind has initially been driven fully upward. A further important parameter is the time interval of the subsequent turning of the slats from the "Inward low point" to the "Outward low point". This time is to be entered as ui Turning Time Down in ms in the function block. TF8000 Version: 1.3.0 279
## Page 280

Programming Upward travel profile: More detailed explanations of the terms "backlash" and "turning" are given here in the upward movement: The circumstances are similar to the downward movement described above: The blind normally describes its upward movement with the slat low point directed inwards, as in fig. 3. If the blind is in an initial position with the low point directed outwards (i.e. after the conclusion of a downward movement), then a certain time elapses after a new upward movement begins before the slats start to turn from the "Outward low point" to the "Inward low point". During this time the slat angle does not change; the blind only drives upward (fig. 1 and fig. 2). This time is also an important parameter for the movement calculation and is entered in the function block in ms under ui Backlash Time Up. Since it is not known at an arbitrary point after a blind movement of an arbitrary length whether part of the reversal backlash has already been traversed, the most secure way to measure the reversal backlash of the upward movement or its extension time is when the blind has initially been driven fully downward. A further important parameter is the time interval of the subsequent turning of the slats from the "Outward low point" to the "Inward low point". This time is to be entered as ui Turning Time Up in ms in the function block. Parameterization For the calculation of the (height) position and the slat angle, the following times now have to be determined for both the upward and downward movement: • the travel time of the backlash (ui Backlash Time Up / ui Backlash Time Down in ms) • the turning duration (ui Turning Time Up / ui Turning Time Down in ms) • the total stroke time (udi Total Time Up / udi Total Time Down in ms) Furthermore the following are required for the calculation: • the total extended blind height (ui Blind Height in mm) • the highest slat angle after turning upwards (i Angle Limit Up in degrees) • the lowest slat angle after turning downwards (i Angle Limit Down in degrees) The slat angle λ is defined by a notional straight line through the end points of the slat to the horizontal. 280 Version: 1.3.0 TF8000
## Page 281

Programming Functioning The function block fundamentally controls the blind via the information from the positioning telegram st Sunblind [} 503]. If automatic mode is active (b Manual Mode=FALSE), then the current position and louvre angle are always driven to, wherein changes are immediately accounted for. The height positioning takes priority: First the entered height and afterwards the louvre angle are driven to. For reasons of the simplicity the position error due to the angle movement is disregarded. In manual mode (b Manual Mode=TRUE) the commands b Man Up and b Man Down control the blind. Referencing Secure referencing is ensured if the blind is driven upward for longer than its complete drive-up time. The position is then in any case "0" and the louvre angle is at its maximum. Since blind positioning without an encoder is naturally always susceptible to error, it is important to automatically reference as often as possible: each time the "0" position is to be driven to (the angle is unimportant), the blind initially drives upward quite normally with continuous position calculation. Once the calculated position value of 0% has been reached, the output b Blind Up is kept active until another complete drive-up time + 5 s has elapsed. For reasons of flexibility there are now two possibilities to interrupt the referencing procedure: Until the calculated 0% position has been reached, a change of position is still accepted and executed; after reaching this 0% position, the manual command "down" can still move the blind differently. These two sensible limitations make it necessary for the user to ensure that the blind is securely referenced as often as possible. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; st Sunblind : ST_BARSunblind; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. TF8000 Version: 1.3.0 281
## Page 282

Programming b Enable: Enable input for the function block. As long as this input is TRUE, the actuator function block accepts and executes commands as described above. A FALSE signal on this input resets the control outputs b Blind Up and b Blind Down and the function block remains in a state of rest. st Sunblind: Positioning telegram, see ST_BARSunblind [} 503]. VAR_OUTPUT b Blind Up : BOOL; b Blind Down : BOOL; ui Act Position : UINT; ui Act Angle : UINT; b Referencing : BOOL; b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; b Blind Up: control output for blind up. b Blind Down: control output for blind down. ui Act Position: current position in percent. ui Act Angle: current louvre angle in degrees. b Referencing: the blind is in the reference-process, which means, that the output b Blind Up will be set for the complete drive-up time + 5 s. Only the manual command "down" can move the blind in the opposite direction and terminate the reference-mode. b Busy: a positioning or a referencing procedure is in progress. b Error: this output is switched to TRUE if the parameters entered are erroneous. udi Error Id: contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT ui Backlash Time Up : UINT; ui Backlash Time Down : UINT; ui Turning Time Up : UINT; ui Turning Time Down : UINT; udi Total Time Up : UDINT; udi Total Time Down : UDINT; ui Blind Height : UINT; i Angle Limit Up : INT; i Angle Limit Down : INT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Backlash Time Up: Time to traverse the backlash in the upward direction in ms. ui Backlash Time Down: Time to traverse the backlash in the downward direction in ms. ui Turning Time Up: Time for turning the slats in the upward direction in ms. ui Turning Time Down: Time for turning the slats in the downward direction in ms. udi Total Time Up: Complete time for driving up in ms. udi Total Time Down: Complete time for driving down in ms. ui Blind Height: This input is currently not used and does not need to be described by the user. i Angle Limit Up: Highest position of the slats in degrees. This position is reached once the blind has moved to the top position. 282 Version: 1.3.0 TF8000
## Page 283

Programming The slat angle λ, as defined above, is then typically greater than zero. i Angle Limit Down: Lowest position of the slats in degrees. This position is reached once the blind has moved to the bottom position. The slat angle λ, as defined above, is then typically less than zero. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.15 FB_BARSunblind Event This function block serves to preset the position and angle for any desired event. It can be used, for example, in order to drive to a parking position or to drive the blind upward for maintenance. The function is activated via the input b Activate. If this is the case, then the active flag is set in the positioning telegram (b Active in st Sunblind) at the output st Sunblind [} 503] and the values ui Position Event for the shutter height in % and i Angle Event for the slat angle in degrees, which are entered in the In-Out variables, are passed on in this telegram. If the function is no longer active due to the resetting of b Active, then the active flag in the positioning telegram st Sunblind [} 503] is reset and the positions for height and angle are set to "0". If the priority function block is used, then a function with a lower priority can take over the control. TF8000 Version: 1.3.0 283
## Page 284

Programming VAR_INPUT e Data Security Type : E_HVACData Security Type; b Activate : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Activate: A TRUE signal on this input activates the function block and transfers the entered setpoint values together with the active flag in the positioning telegram ST_BARSunblind [} 503]. A FALSE signal resets the active flag again and sets position and angle to zero. VAR_OUTPUT st Sunblind : ST_BARSunblind; b Active : BOOL; b Active: Corresponds to the Boolean value b Active in the blind telegram ST_BARSunblind [} 503] and serves merely to indicate whether the function block is sending an active telegram. st Sunblind : Output structure of the blind positions, see ST_BARSunblind [} 503] VAR_IN_OUT ui Position Park : UINT; i Angle Park : INT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Position Event: Height position of the blind in % in case of activation. i Angle Event: Slat angle of the blind in degrees in case of activation. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 284 Version: 1.3.0 TF8000
## Page 285

Programming 5.1.5.4.16 FB_BARSunblind Priority Switch Priority controller for up to 9 positioning telegrams (st Sunblind_Prio1 ... st Sunblind_Prio9) of the type ST_BARSunblind [} 503]. Structure of the blind positioning telegram ST_BARSunblind [} 503]. TYPE ST_BARSunblind: STRUCT ui Position : UINT; i Angle : INT; b Man Up : BOOL; b Man Down : BOOL; b Manual Mode : BOOL; b Active : BOOL; END_STRUCT END_TYPE Up to 9 positioning telegrams from different control function blocks can be applied to this function block. The telegram on st Sunblind_Prio1 has the highest priority and that on st Sunblind_Prio9 the lowest. The active telegram with the highest priority is output at the output st Sunblind. "Active" means that the variable b Active is set within the structure of the positioning telegram. Note: This function block is to be programmed in such a way that one of the applied telegrams is always active. If this is not the case, then an empty telegram is output, i.e. ui Position=0, i Angle=0, b Man Up=FALSE, b Man Down=FALSE, b Manual Mode=FALSE and b Active=FALSE. Since the blind function block FB_BARSunblind Actuator [} 272] or the roller shutter function block FB_BARRollerblind [} 286] for its part ignores the b Active flag, this telegram would thus be evaluated as a command to drive to position "0", i.e. fully open. The absence of an active telegram therefore does not represent a safety risk for the blind. VAR_INPUT st Sunblind_Prio1 : ST_BARSunblind; st Sunblind_Prio2 : ST_BARSunblind; st Sunblind_Prio3 : ST_BARSunblind; st Sunblind_Prio4 : ST_BARSunblind; st Sunblind_Prio5 : ST_BARSunblind; st Sunblind_Prio6 : ST_BARSunblind; st Sunblind_Prio7 : ST_BARSunblind; st Sunblind_Prio8 : ST_BARSunblind; st Sunblind_Prio9 : ST_BARSunblind; st Sunblind_Prio1..st Sunblind_Prio9: Positioning telegrams available for selection. st Sunblind_Prio1 has the highest priority and st Sunblind_Prio9 the lowest. VAR_OUTPUT st Sunblind : ST_BARSunblind; st Sunblind: resulting positioning telegram. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 285
## Page 286

Programming 5.1.5.4.17 FB_BARRoller Blind This function block is used for positioning a roller blind via two outputs: blind up and blind down. The blind can be driven to any desired position with the position telegram st Sunblind [} 503]. In addition, the positioning telegram st Sunblind [} 503] offers manual commands, which can be used to move the blind to particular positions. These manual commands are controlled by the function block FB_BARSunblind Switch [} 291]. Structure of the blind positioning telegram st Sunblind [} 503]. TYPE ST_BARSunblind: STRUCT ui Position : UINT; i Angle : INT; b Man Up : BOOL; b Man Down : BOOL; b Manual Mode : BOOL; b Active : BOOL; END_STRUCT END_TYPE The current height position and the slat angle are not read in by an additional encoder, but determined internally by the travel time of the blind. Allowance is made for the different driving characteristics through the two different runtime parameters udi Total Time Up (upward runtime of the blind in ms) and udi Total Time Down (downward runtime of the blind in ms). Functioning The function block fundamentally controls the blind via the information from the positioning telegram st Sunblind [} 503]. If automatic mode is active (b Manual Mode=FALSE), then the current position is always driven to, wherein changes are immediately accounted for. In manual mode (b Manual Mode=TRUE) the commands b Man Up and b Man Down control the blind. Referencing Secure referencing is ensured if the blind is driven upward for longer than its complete drive-up time. The position is then in any case "0". Since blind positioning without an encoder is naturally always susceptible to error, it is important to automatically reference as often as possible: each time the "0" position is to be driven to, the blind initially drives upward quite normally with continuous position calculation. Once the calculated position value of 0% has been reached, the output b Blind Up is kept active until another complete drive-up time + 5 s has elapsed. For reasons of flexibility there are now two possibilities to interrupt the referencing procedure: Until the calculated 0% position has been reached, a change of position is still accepted and executed; after reaching this 0% position, the manual command "down" can still move the blind differently. These two sensible limitations make it necessary for the user to ensure that the blind is securely referenced as often as possible. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; st Sunblind : ST_BARSunblind; 286 Version: 1.3.0 TF8000
## Page 287

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable: Enable input for the function block. As long as this input is TRUE, the actuator function block accepts and executes commands as described above. A FALSE signal on this input resets the control outputs b Blind Up and b Blind Down and the function block remains in a state of rest. st Sunblind: Positioning telegram, see ST_BARSunblind [} 503]. VAR_OUTPUT b Blind Up : BOOL; b Blind Down : BOOL; ui Act Position : UINT; b Referencing : BOOL; b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; b Blind Up: control output for blind up. b Blind Down: control output for blind down. ui Act Position: current position in percent. b Referencing: the blind is in the reference-process, which means, that the output b Blind Up will be set for the complete drive-up time + 5 s. Only the manual command "down" can move the blind in the opposite direction an terminate the reference-mode. b Busy: a positioning or a referencing procedure is in progress. b Error: this output is switched to TRUE if the parameters entered are erroneous. udi Error Id: contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT udi Total Time Up : UDINT; udi Total Time Down : UDINT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. udi Total Time Up: Complete time for driving up in ms. TF8000 Version: 1.3.0 287
## Page 288

Programming udi Total Time Down: Complete time for driving down in ms. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.18 FB_BARSunblind Scene This function block represents an extension of the manual operation FB_BARSunblind Switch [} 291] by a scene memory and a call function. The blind actuator FB_BARSunblind Actuator [} 272] or the roller shutter actuator FB_BARRollerblind [} 286] can thus be controlled in manual operation mode and can also drive directly to previously saved positions (scenes). Up to 21 scenes can be saved. Structure of the blind positioning telegram st Sunblind [} 503]. TYPE ST_BARSunblind: STRUCT ui Position : UINT; i Angle : INT; b Man Up : BOOL; b Man Down : BOOL; b Manual Mode : BOOL; b Active : BOOL; END_STRUCT END_TYPE Mode of operation This function block controls the blind function blocks FB_BARSunblind Actuator [} 272] and FB_BARRoller Blind [} 286] in manual mode via the command inputs b Switch Up and b Switch Down, wherein b Switch Up takes priority. The commands are passed on to the respective commands b Man Up and b Man Down in the positioning telegram. If a command input is activated that is longer than the entered time ui Switch Over Time (in ms), then the corresponding control command latches. Activating a command input again releases this latch. A rising edge on b Save Scene saves the current position and louvre angle in the scene selected in usi Selected Scene. This procedure is possible at any time, even during active positioning. The selected scene is called with b Invoke Scene, i.e. the saved position and angle values are driven to. Linking to the blind function block Like the "normal" manual control function block, FB_BARSunblind Switch [} 291], the scene selection function block can be connected to the blind function block either directly or via an upstream priority controller FB_BARSunblind Priority Switch [} 285]. The connection is made via the positioning telegram st Sunblind [} 503]. Furthermore the scene function block requires the current positions from the blind function block for the reference blind: Use of a priority controller: 288 Version: 1.3.0 TF8000
## Page 289

Programming Direct connection: VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; usi Selected Scene : USINT; b Switch Up : BOOL; b Switch Down : BOOL; b Invoke Scene : BOOL; b Save Scene : BOOL; ui Setpoint Position : UINT; i Setpoint Angle : INT; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. TF8000 Version: 1.3.0 289
## Page 290

Programming b Enable: The function block has no function if this input is FALSE. 0 is output for both position and angle in the positioning telegram st Sunblind [} 503] - b Manual Mode and b Active are both FALSE. For a connection with priority controller this means that another functionality takes over control of the blind. Conversely, a direct connection allows the blind to drive directly to the 0 position, i.e. fully up, since the actuator function block does not evaluate the bit b Active itself. usi Selected Scene : Selected scene, which is to be either stored (b Save Scene) or called (b Invoke Scene). b Switch Up: Command input for blind up. b Switch Down: Command input for blind down. b Invoke Scene: Call selected scene. b Save Scene: Save selected scene. ui Setpoint Position: Setpoint position in % that is to be saved in the selected scene. Must be linked to the actual position of the actuator function block FB_BARSunblind Actuator [} 272] or FB_BARRollerblind [} 286] for the reference blind/roller shutter in order to be able to save a position that was previously driven to manually. i Setpoint Angle: dto. Slat angle in degrees. VAR_OUTPUT st Sunblind : ST_BARSunblind; b Active : BOOL; ui Position Act Scene : UINT; i Angle Position Act Scene : INT; b Error : BOOL; udi Error Id : UDINT; st Sunblind : Positioning telegram, see ST_BARSunblind [} 503]. b Active : Corresponds to the Boolean value b Active in the blind telegram ST_BARSunblind [} 503] and serves merely to indicate whether the function block is sending an active telegram. ui Position Act Scene : Indicates the saved relative blind height position in % for the currently selected scene. i Angle Position Act Scene : dto. Slat angle in degrees. b Error : This output is switched to TRUE if the parameters entered are erroneous. udi Error Id : Contains the error code if the values entered should be erroneous. See Error codes [} 317]. If an error should occur, then this automatic function is deactivated and position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview [} 230]) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. VAR_IN_OUT ui Switch Over Time : UINT; arr Blind Scenes : ARRAY[0..20] OF ST_BARSunblind Scene; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Switch Over Time : Time in milliseconds until the corresponding manual command in the positioning telegram st Sunblind [} 503] latches in the case of a continuous active command input. 290 Version: 1.3.0 TF8000
## Page 291

Programming arr Blind Scenes : Table with the scene entries of the type ST_BARSunblind Scene [} 503]. Up to 21 scenes can be saved: 0..20. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.19 FB_BARSunblind Switch With the help of this function block the blind controller FB_BARSunblind Actuator [} 272] or the roller shutter controller FB_BARRollerblind [} 286] can be controlled in manual operation mode. The connection takes place via the positioning telegram st Sunblind [} 503] either directly or with an additional priority controller. Structure of the blind positioning telegram st Sunblind [} 503]. TYPE ST_BARSunblind: STRUCT ui Position : UINT; i Angle : INT; b Man Up : BOOL; b Man Down : BOOL; b Manual Mode : BOOL; b Active : BOOL; END_STRUCT END_TYPE Operation This function block controls the blind function blocks FB_BARSunblind Actuator [} 272] and FB_BARRoller Blind [} 286] in manual mode via the command inputs b Switch Up and b Switch Down, wherein b Switch Up takes priority. The commands are passed on to the respective commands b Man Up and b Man Down in the positioning telegram. If a command input is activated that is longer than the entered time ui Switch Over Time (in ms), then the corresponding control command latches. Activating a command input again releases this latch. Linking to the blind function block The manual control function block can be connected to the blind function block either directly or via an upstream priority controller FB_BARSunblind Priority Switch [} 285]. The connection is made via the positioning telegram st Sunblind [} 503]. Use of a priority controller: TF8000 Version: 1.3.0 291
## Page 292

Programming Direct connection: VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; b Switch Up : BOOL; b Switch Down : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable : The function block has no function if this input is FALSE. 0 is output for both position and angle in the positioning telegram st Sunblind [} 503] - b Manual Mode and b Active are both FALSE. For a connection with priority controller this means that another functionality takes over control of the blind. Conversely, a direct connection allows the blind to drive directly to the 0 position, i.e. fully up, since the actuator function block does not evaluate the bit b Active itself. b Switch Up: Command input for blind up. b Switch Down: Command input for blind down. VAR_OUTPUT st Sunblind : ST_BARSunblind; b Active : BOOL; st Sunblind: positioning telegram, see ST_BARSunblind [} 503]. b Active: corresponds to the Boolean value b Active in the blind telegram ST_BARSunblind [} 503] and serves merely to indicate whether the function block is sending an active telegram. 292 Version: 1.3.0 TF8000
## Page 293

Programming VAR_IN_OUT ui Switch Over Time : UINT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Switch Over Time : Time in milliseconds until the corresponding manual command in the positioning telegram st Sunblind [} 503] latches in the case of a continuous active command input. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.20 FB_BARSunblind Thermo Automatic This function block controls the blind in relation to the temperature inside the room if the room is unoccupied. The objective is to block radiant heat when cooling and to increase the input of heat by opening the blinds when heating. The thermo-automatic function is active only if there is sufficient sunshine and the room concerned is unoccupied. To this end, the external brightness value ui Brightness [lux] must have exceeded the activation limit value ui Brightness Activate Value for the time ui Activate Delay (in seconds) and the presence input b Presence must be FALSE. The automatic function is deactivated again if either presence is signaled (b Presence = TRUE) or the external brightness value ui Brightness falls below the value ui Brightness Deactivate Value for the time ui Deactivate Delay. A structure of the type ST_BARSetpoint Room, which carries the information about the temperature switching points for the air conditioning of the room, is to be applied at the input st BARSetpoint Room: TYPE ST_BARSetpoint Room : STRUCT st BARSetpoint Room_Comfort Heat : REAL:= 21.0; st BARSetpoint Room_Pre Comfort Heat : REAL:= 19.0; st BARSetpoint Room_Economy Heat : REAL:= 15.0; st BARSetpoint Room_Protection Heat : REAL:= 12.0; st BARSetpoint Room_Comfort Cool : REAL:= 24.0; TF8000 Version: 1.3.0 293
## Page 294

Programming st BARSetpoint Room_Pre Comfort Cool : REAL:= 28.0; st BARSetpoint Room_Economy Cool : REAL:= 35.0; st BARSetpoint Room_Protection Cool : REAL:= 40.0; END_STRUCT END_TYPE Once activated, the thermo-automatic function distinguishes between three cases: • Remain in the current position if the room temperature r Act Room Temperature lies between the values st BARSetpoint Room_Comfort Heat and st BARSetpoint Room_Comfort Cool. • Heating case if the room temperature r Act Room Temperature falls below the value st BARSetpoint Room_Comfort Heat. • Cooling case if the room temperature r Act Room Temperature exceeds the value st BARSetpoint Room_Comfort Cool. Once the heating or the cooling case has been reached, the thermo-automatic function remembers this until it becomes inactive itself once again due to renewed presence detection or insufficient external brightness (see above). In both cases, however – heating or cooling – the mechanism operates like a 2-point controller. Heating case In the heating case, the blind drives to the heating position ui Position Heating Mode and i Angle Heating Mode if the room temperature falls below the lower limit value. If the room temperature exceeds the upper limit value, then the blind drives to the cooling position ui Position Cooling Mode and i Angle Cooling Mode. The upper limit value is selectable by the parameter b Comfort Cooling As Switch Point Heating ; the lower limit value is not selectable: b Comfort Cooling As Switch Point Hea b Comfort Cooling As Switch Point Hea ting = FALSE ting = TRUE upper limit value st BARSetpoint Room_Pre Comfort C st BARSetpoint Room_Comfort Cool ool lower limit value st BARSetpoint Room_Comfort Heat st BARSetpoint Room_Comfort Heat 294 Version: 1.3.0 TF8000
## Page 295

Programming Diagram TF8000 Version: 1.3.0 295
## Page 296

Programming Cooling case In the cooling case the blind drives to the cooling position ui Position Cooling Mode and i Angle Cooling Mode if the room temperature exceeds the upper limit value. If the room temperature falls below the lower limit, then the blind drives to the heating position ui Position Heating Mode and i Angle Heating Mode. The lower limit value is selectable by the parameter b Comfort Heating As Switch Point Cooling ; the upper limit value is not selectable: b Comfort Heating As Switch Point Co b Comfort Heating As Switch Point Co oling = FALSE oling = TRUE upper limit value st BARSetpoint Room_Comfort Cool st BARSetpoint Room_Comfort Cool lower limit value st BARSetpoint Room_Pre Comfort H st BARSetpoint Room_Comfort Heat eat 296 Version: 1.3.0 TF8000
## Page 297

Programming Diagram A lower average room temperature is obtained by selecting the Precomfort Cool value instead of the Comfort Cool value as the upper hysteresis point. This could be perceived as more pleasant when re-entering the room. TF8000 Version: 1.3.0 297
## Page 298

Programming VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; ui Brightness : UINT; b Presence : BOOL; lr Act Room Temperature : LREAL; st BARSetpoint Room : ST_BARSetpoint Room; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable : The function block has no function if this input is FALSE. 0 is output for both position and angle in the positioning telegram st Sunblind [} 503] and b Active is FALSE. This means that another function takes over control of the blind via the priority controller. ui Brightness: External brightness in lux. b Presence: The automatic function is active only it the room is unoccupied, since otherwise the sun shading takes priority. If this input is FALSE, the room is considered to be unoccupied and the thermo-automatic function is active. A TRUE signal at b Presence deactivates the thermo-automatic function immediately. lr Act Room Temperature: Input for the room temperature in °C. st BARSetpoint Room: Structure of the type ST_BARSetpoint Room [} 293], which contains the information about the temperature switching points for the air conditioning of the room, see above. VAR_OUTPUT st Sunblind : ST_BARSunblind; b Active : BOOL; ui Remaining Time Activate : UINT; ui Remaining Time Deactivate : UINT; b Heating : BOOL; b Cooling : BOOL; lr Upper Switch Point Heating : LREAL; lr Lower Switch Point Heating : LREAL; lr Upper Switch Point Cooling : LREAL; lr Lower Switch Point Cooling : LREAL; b Error : BOOL; udi Error Id : UDINT; st Sunblind: Output structure of the blind positions, see ST_BARSunblind [} 503]. b Active : Corresponds to the Boolean value b Active in the blind telegram ST_BARSunblind [} 503] and serves merely to indicate whether the function block is sending an active telegram. ui Remaining Time Activate: The thermo-automatic function is active if no presence is detected AND the brightness lies above the limit value ui Brightness Activate Value for the time ui Activate Delay (switching delay). This output indicates the remaining duration of the switching delay in seconds. This output is 0 as long as no countdown of the time is taking place. 298 Version: 1.3.0 TF8000
## Page 299

Programming ui Remaining Time Deactivate: The thermo-automatic function is not active if presence is detected OR if the brightness lies below the limit value ui Brightness Deactivate Value for the time ui Deactivate Delay (switching delay). This output indicates the remaining duration of the switching delay in seconds. This output is 0 as long as no countdown of the time is taking place. b Heating: Indicates whether the heating case is active. b Cooling: Indicates whether the cooling case is active. lr Upper Switch Point Heating: Indicates the selected upper switch point in heating mode at which the blind is driven to the position ui Position Cooling Mode for cooling. This is either st BARSetpoint Room_Comfort Cool or st BARSetpoint Room_Pre Comfort Cool, depending on the preselection (see diagrams above). lr Lower Switch Point Heating: Indicates the lower switch point in heating mode at which the blind is driven to the position ui Position Heating Mode for heating. This is permanently set as the value st BARSetpoint Room_Comfort Heat (see diagrams above). lr Upper Switch Point Cooling: Indicates the selected upper switch point in cooling mode at which the blind is driven to the position ui Position Cooling Mode for cooling. This is permanently set as the value st BARSetpoint Room_Comfort Cool (see diagrams above). lr Lower Switch Point Cooling: Indicates the selected lower switch point in cooling mode at which the blind is driven to the position ui Position Heating Mode for heating. This is either st BARSetpoint Room_Comfort Heat or st BARSetpoint Room_Pre Comfort Heat, depending on the preselection (see diagrams above). b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. If an error should occur, then this automatic function is deactivated and position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview [} 230]) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. VAR_IN_OUT ui Brightness Activate Value : UINT;(*lux*) ui Brightness Deactivate Value : UINT;(*lux*) ui Activate Delay : UINT;(*sec*) ui Deactivate Delay : UINT;(*sec*) b Comfort Heating As Switch Point Cooling : BOOL; b Comfort Cooling As Switch Point Heating : BOOL; ui Position Heating Mode : UINT; i Angle Heating Mode : INT; ui Position Cooling Mode : UINT; i Angle Cooling Mode : INT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Brightness Activate Value / ui Activate Delay : Activation limit value. The thermo-automatic function is active only if the external brightness is adequate. Otherwise there would be no radiant heat from the sun which could be utilized or which would need to be blocked. If the external brightness ui Brightness [lux] exceeds the value ui Brightness Activate Value [lux] for the time ui Activate Delay [s], then the automatic function becomes active if in addition no presence is detected (b Presence = FALSE). ui Brightness Deactivate Value / ui Deactivate Delay : Deactivation limit value of the brightness: If the external brightness ui Brightness [lux] falls below the value ui Brightness Deactivate Value [lux] for the time ui Deactivate Delay [s], then the automatic function becomes inactive. The value ui Brightness Deactivate Value must be smaller than the value ui Brightness Activate Value. Otherwise an error is output. TF8000 Version: 1.3.0 299
## Page 300

Programming b Comfort Heating As Switch Point Cooling : If this input is TRUE, then the value st BARSetpoint Room_Comfort Heat is considered to be the lower value in cooling mode from which the blinds are opened again. If the input is set to FALSE, then the value st BARSetpoint Room_Pre Comfort Heat applies (see introductory description). b Comfort Cooling As Switch Point Heating : If this input is TRUE, then the value st BARSetpoint Room_Comfort Cool is considered to be the upper value in heating mode from which the blinds are closed again. If the input is set to FALSE, then the value st BARSetpoint Room_Pre Comfort Cool applies (see introductory description) ui Position Heating Mode : Height position of the blind in % in the heating case (intended heat irradiation). The following applies for the height position: 0% = fully open, 100% = fully closed. i Angle Heating Mode : Slat angle of the blind in degrees in the heating case (intended heat irradiation). ui Position Cooling Mode : Height position of the blind in % in the cooling case (sun protection). The following applies for the height position: 0% = fully open, 100% = fully closed. The value of the height position must be higher than in the heating case, i.e. the blind must be closed more in the cooling case than in the heating case. Otherwise the supply of heat from the sun cannot be meaningfully controlled according to the above description. In this case an error is output. i Angle Cooling Mode : Slat angle of the blind in degrees in the cooling case (sun protection). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.21 FB_BARSunblind Twilight Automatic This function block controls the blind if the outdoor brightness has fallen below a limit value. The automatic twilight function operates with both a value hysteresis and a temporal hysteresis: If the external brightness value usi Brightness [lux] falls below the value usi Activate Value [lux] for the time ui Activate Delay [s], then the function block is active and will supply the blind positions ui Position Active Mode (height in %) and ui Angle Active Mode (slat angle in degrees), which are specified on the IN-OUT variables, at the output in the position telegram st Sunblind [} 503]. Conversely, if the external brightness exceeds the value usi Deactivate Value [lux] for the time ui Deactivate Delay [s], then the automatic function is no longer active. The active flag in the positioning telegram st Sunblind [} 503] is reset and the positions for height and angle are set to "0". A function with a lower priority can then take over control. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; ui Brightness : UINT; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. 300 Version: 1.3.0 TF8000
## Page 301

Programming A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable : The function block has no function if this input is FALSE. 0 is output for both position and angle in the positioning telegram st Sunblind [} 503] and b Active is FALSE. This means that another function takes over control of the blind via the priority controller. ui Brightness: External brightness in lux. VAR_OUTPUT st Sunblind : ST_BARSunblind; b Active : BOOL; ui Remaining Time Activate : UINT; ui Remaining Time Deactivate : UINT; b Error : BOOL; udi Error Id : UDINT; st Sunblind: Output structure of the blind positions, see ST_BARSunblind [} 503]. b Active : Corresponds to the Boolean value b Active in the blind telegram ST_BARSunblind [} 503] and serves merely to indicate whether the function block is sending an active telegram. ui Remaining Time Activate: Indicates the time remaining in seconds until the activation of the automatic function after falling below the switch value usi Activate Value. This output is 0 as long as no countdown of the time is taking place. ui Remaining Time Deactivate: Indicates the time remaining in seconds until the deactivation of the automatic function after the switch value usi Deactivate Value has been exceeded. This output is 0 as long as no countdown of the time is taking place. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. If an error should occur, then this automatic function is deactivated and position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview [} 230]) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. VAR_IN_OUT ui Activate Value : UINT; ui Deactivate Value : UINT; ui Activate Delay : UINT; ui Deactivate Delay : UINT; ui Position Active Mode : UINT; i Angle Active Mode : INT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input TF8000 Version: 1.3.0 301
## Page 302

Programming variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Activate Value: Activation limit value in lux. ui Deactivate Value: Deactivation limit value in lux. ui Activate Delay: Activation delay in seconds. ui Deactivate Delay: Deactivation delay in seconds. ui Position Active Mode: Height position of the blind in % if the automatic twilight function is active. i Angle Active Mode: Slat angle of the blind in degrees if the automatic twilight function is active. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.22 FB_BARSunblind Weather Protection The weather protection has the highest priority in the blind controller (see overview [} 230]) and is intended to ensure that the blind is not damaged by ice or wind. The task of the automatic weather protection function is to protect the blind against two impending dangers and, in order to do so, to drive it to a safe position: • Icing up: Impending icing up is detected when the measured outside temperature lr Outside Temperature falls below the frost limit value lr Frost Temperature while at the same time rain is detected on b Rain Sensor. This event is saved internally and remains active until it is ensured that the ice has melted again. In addition, the outside temperature must have exceeded the frost limit value for the entered deicing time ui Deice Time (in minutes). For safety reasons the icing event is persistently saved, i.e. also beyond a PLC failure. Thus, if the controller fails during the icing up or deicing period, the blind is considered to be newly iced up when then the controller restarts and the deicing timer starts from the beginning again. • Storm: If the measured wind speed lies above the value lr Wind Speed Storm Upcoming for the time ui Delay Storm Upcoming [s], then it is assumed that a storm is directly impending. Only if the wind speed falls below the value lr Wind Speed Storm Abating for the time ui Delay Storm Abating [s] is the storm considered to have abated and the driving of the blind considered to be safe. For safety reasons the storm event is also persistently saved. Thus, if the controller fails during a storm, the abating timer is started again from the beginning when the controller is restarted. 302 Version: 1.3.0 TF8000
## Page 303

Programming In both cases of danger the blind is driven to the protection position specified by ui Position Protection (height position in percent) and i Angle Protection (slat angle in degrees). VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; lr Wind Speed : LREAL; lr Outside Temperature : LREAL; b Rain Sensor : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable : The function block has no function if this input is FALSE. 0 is output for both position and angle in the positioning telegram st Sunblind [} 503] and b Active is FALSE. This means that another function takes over control of the blind via the priority controller. lr Wind Speed: Wind speed. The unit of entry is arbitrary, but it is important that no value is smaller than 0 and that the values become larger with increasing speed. lr Outside Temperature: Outside temperature in degrees Celsius. b Rain Sensor: Input for a rain sensor. VAR_OUTPUT st Sunblind : ST_BARSunblind; b Ice Alarm : BOOL; udi Remaining Time Ice Alarm : UDINT; b Storm Alarm : BOOL; ui Remaining Time Storm Detect : UINT; ui Remaining Time Storm Alarm : UINT; b Error : BOOL; udi Error Id : UDINT; st Sunblind: Output structure of the blind positions, see ST_BARSunblind [} 503]. b Active : Corresponds to the Boolean value b Active in the blind telegram ST_BARSunblind [} 503] and serves merely to indicate whether the function block is sending an active telegram. b Ice Alarm: Indicates the icing up alarm. udi Remaining Time Ice Alarm: in the case of impending icing up (b Ice Alarm=TRUE), this second counter is set to the deicing time. As soon as the temperature lies above the frost point entered (lr Frost Temperature), the remaining number of seconds until the 'all-clear' signal is given (b Ice Alarm=FALSE) are indicated here. This output is 0 as long as no countdown of the time is taking place. b Storm Alarm: Indicates the storm alarm. TF8000 Version: 1.3.0 303
## Page 304

Programming ui Remaining Time Storm Detect: In an uncritical case this second counter constantly indicates the alarm delay time ui Delay Storm Upcoming. If the measured wind force lr Wind Speed lies above the activation limit value lr Wind Speed Storm Upcoming, then the seconds until the alarm is given are counted down. This output is 0 as long as no countdown of the time is taking place. ui Remaining Time Storm Alarm: As soon as the storm alarm is initiated, this second counter initially constantly indicates the deactivation time delay of the storm alarm ui Delay Storm Abating. If the measured wind force lr Wind Speed falls below the deactivation limit value lr Wind Speed Storm Abating, then the seconds remaining until the 'all-clear' signal is given (b Storm Alarm = FALSE) are counted down. This output is 0 as long as no countdown of the time is taking place. b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. If an error should occur, then this automatic function is deactivated and position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview [} 230]) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. VAR_IN_OUT lr Frost Temperature : LREAL; lr Wind Speed Storm Upcoming : LREAL; lr Wind Speed Storm Abating : LREAL; ui Deice Time : UINT; ui Delay Storm Upcoming : UINT; ui Delay Storm Abating : UINT; ui Position Protection : UINT; i Angle Protection : INT; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. lr Frost Temperature: Icing up temperature limit value in degrees Celsius. This value may not be greater than 0. Otherwise an error is output. lr Wind Speed Storm Upcoming: Wind speed limit value for the activation of the storm alarm. This value may be not smaller than 0 and must lie above the value for the deactivation. Otherwise an error is output. The unit of entry must be the same as that of the input lr Wind Speed. A value greater than this limit value triggers the alarm after the entered time ui Delay Storm Upcoming. lr Wind Speed Storm Abating: Wind speed limit value for the deactivation of the storm alarm. This value may be not smaller than 0 and must lie below the value for the activation. Otherwise an error is output. The unit of entry must be the same as that of the input lr Wind Speed. A value smaller than or equal to this limit value resets the alarm after the entered time ui Delay Storm Abating. ui Deice Time: Time until the deicing of the blind after icing up (in minutes). After that the icing up alarm is reset. ui Delay Storm Upcoming: Time delay in seconds until the storm alarm is triggered. ui Delay Storm Upcoming: Time delay in seconds until the storm alarm is reset. ui Position Protection: Height position of the blind in % in the case of protection. i Angle Protection: Slat angle of the blind in degrees in the case of protection. 304 Version: 1.3.0 TF8000
## Page 305

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.23 FB_BARSun Protection Ex Function block for the control of glare protection with the aid of a slatted blind. The function block FB_BARSun Protection Ex enables glare protection in two ways that operate in parallel: • Slat adjustment, so that the direct incident light cannot quite enter through the lowered part of the blind. • Control of the shutter height, with three different options (adjustable via the enumerator on e Positioning Mode): 1) Fixed shutter height, i.e. no change (preset) 2) Shutter height in relation to the position of the sun, defined via a table (st Blind Pos Table [} 501]), see also description of the function block FB_BARBlind Position Entry [} 247] 3) Maximum desired incidence of light On the basis of the parameters entered, which are described further below, the function block calculates the necessary slat angle and blind position and transfers them to the output structure st Sunblind [} 503]. Of course, the output does not take place continuously, since a constant blind movement would be perceived as extremely distracting. The interval in seconds at which new position values are to be output can be set on the input ui Positioning Interval. However, the shading criteria must always be fulfilled between two positioning times: no direct light may enter through the slats and the desired incidence of light must remain limited by the shutter height, if one initially assumes that the shutter height is controlled via the mode "maximum desired incidence of light". Therefore two blind and slat positions are internally calculated: those for the current switching point and those for the next. The position in which the blind is more closed is then the valid position. The positioning in intervals starts precisely when the following three conditions are satisfied: • the input b Enable must be TRUE. • the function block must not be in an error state due to incorrect parameterization (b Error=TRUE). • the sun must have risen, i.e. the sun elevation must be greater than 0°. This is an internal safety query, since the limitation to at least 0° should actually be done by the user by programming the input b Enable; see Overview of automatic sun protection (shading correction) [} 232]. If these three conditions are not satisfied, then the active bit (b Active) is set to FALSE, the shutter height to 0% and the slat angle to 0% in the positioning structure. TF8000 Version: 1.3.0 305
## Page 306

Programming VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; st Time Act : TIMESTRUCT; st Blind Position Table : ST_BARBlind Position Table; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable: If this input is set to FALSE the positioning is inactive, i.e. the active bit (b Active) is reset in the positioning structure st Sunblind of the type ST_BARSunblind [} 503] and the function block itself remains in a standstill mode. If on the other hand the function block is activated, then the active bit is TRUE and the function block outputs its control values (ui Shutter Height, i Louvre Angle) in the positioning structure at the appropriate times. st Time Act: Entry of the current time in GMT (Greenwich Mean Time). st Blind Position Table: Table of 6 interpolation points, 4 of which are parameterizable, from which a blind position is then given in relation to the position of the sun by linear interpolation. Valid if e Positioning Mode = e Pos Mode Fixed (see enumerator E_BARPos Mode [} 500]). See FB_BARBlind Position Entry [} 247] for further description. VAR_OUTPUT st Sunblind : ST_BARSunblind; b Error : BOOL; udi Error Id : UDINT; st Sunblind: Output structure of the blind positions, see ST_BARSunblind [} 503] b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. If an error should occur, then this automatic function is deactivated and position and angle are set to 0. This means that if a priority controller is in use, another function with a lower priority (see Overview [} 230]) automatically takes over control of the blind. In the case of a direct connection, conversely, the blind will drive to position/angle 0. VAR_IN_OUT ui Positioning Interval : UINT; lr Degree Of Longitude : LREAL; lr Degree Of Latitude : LREAL; lr Facade Orientation : LREAL; lr Facade Angle : LREAL; ui Louvre Width : UINT; ui Louvre Spacing : UINT; ui Fixed Shutter Height : UINT; ui Max Light Incidence : UINT; 306 Version: 1.3.0 TF8000
## Page 307

Programming ui Window Height : UINT; ui Window Distance Floor : UINT; e Positioning Mode : E_BARPOSMODE; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Positioning Interval: Positioning interval in seconds – time interval between two outputs of blind positions. Valid range: 1s..7200s. lr Degree Of Longitude: Longitude in degrees. Valid range: -180°...180°. lr Degree Of Latitude: Latitude in degrees. Valid range: -90°..90°. lr Facade Orientation: Facade orientation in degrees: In the northern hemisphere, the following applies for the facade orientation (looking out of the window): Line of sight Facade orientation North β=0° East β=90° South β=180° West β=270° The following applies for the southern hemisphere: Line of sight Facade orientation South β=0° East β=90° North β=180° West β=270° lr Facade Angle: Facade inclination in degrees. See facade inclination. ui Louvre Width: Width of the slats in mm, see sketch. ui Louvre Spacing: Slat spacing in mm, see sketch. ui Fixed Shutter Height: Fixed (constant) shutter height [0..100%]. Valid if e Positioning Mode = e Pos Mode Fixed (see enumerator E_BARPos Mode [} 500]). ui Max Light Incidence: Maximum desired incidence of light in mm measured from the outside of the wall (see Height adjustment). With the aid of the parameters ui Window Height and ui Window Distance Floor, a calculation is performed in relation to the position of the sun to determine how high the blind must be so that the incidence of light does not exceed the value ui Max Light Incidence. Valid if e Positioning Mode = e Pos Mode Max Incidence (see enumerator E_BARPos Mode [} 500]). ui Window Height: Window height in mm for the calculation of the shutter height if the mode "maximum desired incidence of light" is selected. ui Window Distance Floor: Distance between the floor and the window sill in mm for the calculation of the shutter height if the mode "maximum desired incidence of light" is selected. e Positioning Mode: Selection of the positioning mode, see enumerator E_BARPos Mode [} 500]. TF8000 Version: 1.3.0 307
## Page 308

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.24 FB_BARWithin Range Azimuth This function block checks whether the current azimuth angle (horizontal position of the sun) lies within the limits entered. As can be seen in the overview [} 232], the function block provides an additionally evaluation as to whether the sun shading of a window group should be activated. Therefore the observations in the remainder of the text always apply to one window group. A smooth facade is always irradiated by the sun at an azimuth angle of Facade orientation-90° to Facade orientation+90°. If the facade has lateral projections, however, this range is limited. This limitation can be checked with the help of this function block. However, the position of the window group on the facade also plays a role. If it lies centrally, this gives rise to the following situation (the values are only examples): 308 Version: 1.3.0 TF8000
## Page 309

Programming The values change for a group at the edge: The beginning of the range lr Begin Range may thereby be larger than the end lr End Range; it is then regarded beyond 0°: Example: lr Azimuth 10.0° lr Begin Range 280.0° lr End Range 20.0° b Out TRUE However, the range regarded may not be greater than 180° or equal to 0° – this would be unrealistic. Such entries result in an error on the output b Error – the test output b Out is then additionally set to FALSE. VAR_INPUT e Data Security Type : E_HVACData Security Type; lr Azimuth : LREAL; TF8000 Version: 1.3.0 309
## Page 310

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. lr Azimuth: Current azimuth angle. VAR_OUTPUT b Out : BOOL; b Error : BOOL; udi Error Id : UDINT; b Out: binary delayed output of the threshold switch b Error: this output is switched to TRUE if the parameters entered are erroneous. udi Error Id: contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT lr Begin Range : LREAL; lr End Range : LREAL; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. lr Begin Range: Beginning of the range in degrees. lr End Range: End of the range in degrees. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.25 FB_BARWithin Range Elevation 310 Version: 1.3.0 TF8000
## Page 311

Programming This function block checks whether the current angle of elevation (vertical position of the sun) lies within the limits entered. As can be seen in the overview [} 232], the function block provides an additionally evaluation as to whether the sun shading of a window group should be activated. Therefore the observations in the remainder of the text always apply to one window group. A normal vertical facade is irradiated by the sun at an angle of elevation of 0° to maximally 90°. If the facade has projections, however, this range is limited. This limitation can be checked with the help of this function block. However, the position of the window group on the facade also plays a role. If it lies in the lower range, this gives rise to the following situation (the values are only examples): TF8000 Version: 1.3.0 311
## Page 312

Programming The values change for a group below the projection: 312 Version: 1.3.0 TF8000
## Page 313

Programming The lower observation limit, lr Low Limit, may thereby not be greater than or equal to the upper limit, lr High Limit. Such entries result in an error on the output b Error – the test output b Out is then additionally set to FALSE. VAR_INPUT e Data Security Type : E_HVACData Security Type; lr Elevation : LREAL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. lr Elevation: Current angle of elevation in degrees. VAR_OUTPUT b Out : BOOL; b Error : BOOL; udi Error Id : UDINT; b Out: binary delayed output of the threshold switch b Error: this output is switched to TRUE if the parameters entered are erroneous. udi Error Id: contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT lr Low Limit : LREAL; lr High Limit : LREAL; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. lr Low Limit: Lower limit value in degrees. lr High Limit: Upper limit value in degrees. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 313
## Page 314

Programming 5.1.5.4.26 Program example 5.1.5.4.26.1 Program example FB_BARSunblind Switch This example is intended to show how a possible activation (input b Enable) of the manual blind controller might look. The input and output variables (bordered) have the following meaning: t Auto Reset Time : Time after which the activation is to be automatically reset. b Switch Up : Blind up button. b Switch Down : Blind down button. b Pause Clock : Pause signal from the property, e.g. lunch break: 12:00 - 13:00. b Pause Clock = TRUE: Pause. b Presence Detection : Occupied signal from the room in which the blinds are controlled. b Presence Detection= TRUE: Room is occupied. ui Switch Over Time : Time in milliseconds until the corresponding manual command latches with a continuous command input. st Sunblind : Positioning telegram, see ST_BARSunblind [} 503]. For further linking to a priority selection, see FB_BARSunblind Priority Switch [} 285]. Switch With Reset Enable: Functioning If one of the blind pushbuttons b Switch Up or b Switch Down is actuated, the output of the flip-flop will initially be set to TRUE, but only if there is currently no pause signal applied (b Pause Clock) or if the room is currently occupied (b Presence Detection). The b Enable input of the function block fb BARSunblind Switch is thus TRUE, which activates it. The respective switch signal that has led to the activation can be passed on directly by the function block in the command telegram st Sunblind. At the same time a TRUE signal is applied to the input of the switch-off delay tof Auto Reset Timer and its output Q is set directly to TRUE. On releasing the blind button the switch-off delay is started, and after the expiry of t Auto Reset Time the output Q is reset to FALSE. This falling edge is in turn recognized by ft Auto Reset Timer and a trigger pulse is sent that resets the flip-flop. The activation input b Enable is thus FALSE once again and the function block fb BARSunblind Switch is passive. If this function block is linked via the command telegram to a priority selection FB_BARSunblind Priority Switch [} 285], then the telegram will be passed through there to the next priority: 314 Version: 1.3.0 TF8000
## Page 315

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.27 List descriptions 5.1.5.4.27.1 List of facade elements The data of all windows (facade elements) per facade are saved within the program in a field of structure elements of the type ST_BARFacade Element [} 501]. The declaration is global, since the administration function block FB_BARFacade Element Entry [} 251] as well as the shading correction FB_BARShading Correction [} 263] / FB_BARShading Correction South [} 266] access this field directly by input/output variable: TF8000 Version: 1.3.0 315
## Page 316

Programming VAR_GLOBAL arr Facade Element : ARRAY[1..i Columns Per Facade, 1..i Rows Per Facade] OF ST_BARFacade Element; END_VAR The variables i Columns Per Facade and i Rows Per Facade thereby define the upper limit of the available elements and are to be globally declared as constants: VAR_GLOBAL CONSTANT i Rows Per Facade : INT :=10; i Columns Per Facade : INT :=20; END_VAR Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.5.4.27.2 List of shading elements The shading elements per facade are saved within the program in a field of structure elements of the type ST_BARShading Object [} 502]. The declaration is global, since the administration function block FB_BARShading Objects Entry [} 269] as well as the shading correction FB_BARShading Correction [} 263] / FB_BARShading Correction South [} 266] access this field directly by input/output variable: VAR_GLOBAL arr Shading Object : ARRAY[1..i Shading Objects] OF ST_BARShading Object; END_VAR The variable i Shading Objects thereby represents the upper limit of the available elements and is to be globally defined as a constant: VAR_GLOBAL CONSTANT i Shading Objects : INT := 20; END_VAR Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 316 Version: 1.3.0 TF8000
## Page 317

Programming 5.1.5.4.27.3 Error Codes TF8000 Version: 1.3.0 317
## Page 318

Programming udi Error Id udi Error Id Error (hex) (dec) 0x0 0 No error 0x8001 32769 FB_BARBlind Position Entry [} 247]: Values for lr Sun Elevation are not ascending or unequal 0x8002 32770 FB_BARBlind Position Entry [} 247]: Values for lr Sun Elevation are not within the valid range from 0°..90° 0x8003 32771 FB_BARBlind Position Entry [} 247]: Values for ui Blind Position are not within the valid range from 0%..100% 0x8004 32772 FB_BARSun Protection Ex [} 305]: The duration of the positioning interval is zero or exceeds 7200 s. 0x8005 32773 FB_BARSun Protection Ex [} 305]: The longitude entered is not within the valid range from -180°..180°. 0x8006 32774 FB_BARSun Protection Ex [} 305]: The latitude entered is not within the valid range from -90°..90°. 0x8007 32775 FB_BARSun Protection Ex [} 305]: The value for the slat spacing (ui Louvre Spacing) is greater than or equal to the value for the slat width (ui Louvre Width). 0x8008 32776 FB_BARSun Protection Ex [} 305]: The "Values valid" bit (b Valid) in the position table st Blind Position Table is not set - invalid values, see FB_BARBlind Position Entry [} 247]. 0x8009 32777 FB_BARSun Protection Ex [} 305]: The value entered for the fixed shutter height (ui Fixed Shutter Height) exceeds 100% 0x801A 32778 FB_BARSun Protection Ex [} 305]: The value entered for the window height is zero 0x801B 32779 FB_BARSun Protection Ex [} 305]: The value entered for the slat spacing is zero 0x801C 32780 FB_BARSun Protection Ex [} 305]: The value entered for the slat width is zero 0x801D 32781 FB_BARShading Objects Entry [} 269]: The sum of the angles of the rectangle is not 360°. This means that the corners are not in the order P1, P2, P3 and P4 but rather P1, P3, P2 and P4. This results in a crossed-over rectangle. 0x801E 32782 FB_BARShading Objects Entry [} 269]: The corners of the square are not on the same level. 0x801F 32783 FB_BARShading Objects Entry [} 269]: The z-component of P1 is less than zero. This corner would thus lie behind the facade. 0x8010 32784 FB_BARShading Objects Entry [} 269]: The z-component of P3 is less than zero. This corner would thus lie behind the facade. 0x8011 32785 FB_BARShading Objects Entry [} 269]: P1 is equal to P2. The object entered is thus not a rectangle. 0x8012 32786 FB_BARShading Objects Entry [} 269]: P1 is equal to P3. The object entered is thus not a rectangle. 0x8013 32787 FB_BARShading Objects Entry [} 269]: P1 is equal to P4. The object entered is thus not a rectangle. 0x8014 32788 FB_BARShading Objects Entry [} 269]: P2 is equal to P3. The object entered is thus not a rectangle. 0x8015 32789 FB_BARShading Objects Entry [} 269]: P2 is equal to P4. The object entered is thus not a rectangle. 0x8016 32790 FB_BARShading Objects Entry [} 269]: P3 is equal to P4. The object entered is thus not a rectangle. 0x8017 32791 FB_BARShading Objects Entry [} 269]: The radius entered is zero 0x8018 32792 FB_BARShading Objects Entry [} 269]: The z-component of the ball center is less than zero. This point would thus lie behind the facade. 0x8019 32793 FB_BARFacade Element Entry [} 251]: The group index is 0, but at the same time another entry of the facade element is not zero. Only if all entries of a facade element are zero is it considered to be a valid, deliberately omitted facade component, otherwise it is interpreted as an incorrect entry. 0x801A 32794 FB_BARFacade Element Entry [} 251]: The X-component of the first corner (Corner1) is less than zero. 0x801B 32795 FB_BARFacade Element Entry [} 251]: The Y-component of the first corner (Corner1) is less than zero. 0x801C 32796 FB_BARFacade Element Entry [} 251]: The window width is less than or equal to zero. 0x801D 32797 FB_BARFacade Element Entry [} 251]: The window height is less than or equal to zero. 0x801E 32798 FB_BARDelayed Hysteresis [} 250]: The switch-on value b On Value is smaller than the switch-off value b Off Value. 0x801F 32799 FB_BARWithin Range Azimuth [} 308]: The beginning of the range lr Begin Range and the end of the range lr End Range are the same. 0x8020 32800 FB_BARWithin Range Azimuth [} 308]: One of the range limits entered is greater than 360° or less than 0° 318 Version: 1.3.0 TF8000
## Page 319

Programming udi Error Id udi Error Id Error (hex) (dec) 0x8021 32801 FB_BARWithin Range Azimuth [} 308]: The range entered is greater than 180°. 0x8022 32802 FB_BARWithin Range Elevation [} 310]: The lower limit value lr Low Limit entered is greater than or equal to the upper limit value lr High Limit. 0x8023 32803 FB_BARWithin Range Elevation [} 310]: The upper limit value lr High Limit is greater than 90° or the lower limit value lr Low Limit is less than 0°. 0x8024 32804 FB_BARShading Objects Entry [} 269]: The number of the month when shading begins or when shading ends is zero or greater than 12. 0x8025 32805 FB_BARShading Objects Entry [} 269]: Index error! i Id lies outside the permissible limits 1..i Shading Objects. See list of shading elements [} 316]. 0x8026 32806 FB_BARSunblind Actuator [} 272]/FB_BARSunblind Actuator Ex [} 278]: The shutter height entered is 0. 0x8027 32807 FB_BARSunblind Actuator [} 272]/FB_BARSunblind Actuator Ex [} 278]: The total "up" stroke time (ui Total Time Up/udi Total Time Up) or the total "down" stroke time (ui Total Time Down/ udi Total Time Down) respectively is 0 ms. 0x8028 30808 FB_BARSunblind Actuator [} 272]/FB_BARSunblind Actuator Ex [} 278]: the slat "Up" turning time (ui Turning Time Up) or the slat "Down" turning time (ui Turning Time Down) is 0 ms. 0x8029 32809 FB_BARSunblind Actuator [} 272]/FB_BARSunblind Actuator Ex [} 278]: The upper slat angle limit value (i Angle Limit Up) is smaller than or equal to the lower slat angle limit value (i Angle Limit Down) 0x802A 32810 FB_BARSunblind Scene [} 288]: The selected scene number exceeds the maximum number of 20. 0x802B 32811 FB_BARSunblind Thermo Automatic [} 293]: The preset room temperature values are in the wrong order. 0x802C 32812 FB_BARSunblind Thermo Automatic [} 293]: The brightness activation limit value is smaller than or equal to the deactivation limit value. 0x802D 32813 FB_BARSunblind Thermo Automatic [} 293]: The blind position (height in %) of the heating mode is greater than or equal to that of the cooling mode. 0x802E 32814 FB_BARSunblind Twilight Automatic [} 293]: The brightness limit value for the activation of the automatic twilight function is greater than or equal to the deactivation value. 0x802F 32815 FB_BARSunblind Weather Protection [} 302]: The frost limit value is greater than 10 °C. 0x8030 32816 FB_BARSunblind Weather Protection [} 302]: The limit value for the activation of the storm alarm is smaller than or equal to the deactivation value. 0x8031 32817 FB_BARSunblind Weather Protection [} 302]: The input of wind force limit values of less than 0 is not permissible. 0x8032 32818 FB_BARShading Correction [} 263] / FB_BARShading Correction South [} 266]: The group index is 0. This index is intended only for facade elements that are to be marked as non-existent, for example if windows are omitted from an even facade grid or if a door is installed instead of a window. 0x8033 32819 FB_BARShading Correction [} 263] / FB_BARShading Correction South [} 266]: A window element in the selected group is marked as invalid (b Valid=FALSE). 0x8034 32820 FB_BARFacade Element Entry [} 251]: Index error! i Column or i Row lies outside the permissible limits 1..i Columns Per Facade or 1..i Rows Per Facade. respectively. See list of facade elements [} 315]. 0x8035 32821 FB_BARSun Protection Ex [} 305]: The façade inclination entered (lr Facade Angle) is not within the valid range of -90°..90°. 0x8036 32822 FB_BARSunblind Actuator [} 272]/FB_BARSunblind Actuator Ex [} 278]: The time for extending the backlash (ui Backlash Time Up) or (ui Backlash Time Down) respectively is 0 ms. 0x8037 32823 FB_BARRoller Blind [} 286]: The entire "Up" travel time (udi Total Time Up) or the total "Down" travel time (udi Total Time Down) is 0 ms. 0x8038 32824 FB_BARSMISunblind Actuator: The value for w Louvre Range may not be 0. 0x8039 32825 FB_BARSMISunblind Actuator: The ratio w Louvre Range / (i Angle Limit Up + i Angle Limit Down) must be greater than 0. 0x803A.. 32826.. reserved for shading function blocks 0x80FF 33023 0x8100 33024 FB_BARLight Circuit [} 219]: The operation mode ui Light Ctrl Mode is greater than 2. However, only 0, 1 or 2 is permitted. 0x8101 33025 FB_BARLight Circuit Dim [} 221]: The operation mode ui Light Ctrl Mode is greater than 2. However, only 0, 1 or 2 is permitted. 0x8102 33026 FB_BARLight Circuit Dim [} 221]: The lower limit value, lr Min Dim Value, is less than zero or greater than 100%. TF8000 Version: 1.3.0 319
## Page 320

Programming udi Error Id udi Error Id Error (hex) (dec) 0x8103 33027 FB_BARLight Circuit Dim [} 221]: The upper limit value, lr Max Dim Value, is less than zero or greater than 100%. 0x8104 33028 FB_BARLight Circuit Dim [} 221]: The lower limit value, lr Min Dim Value, is greater than the upper limit value, lr Max Dim Value. 0x8105 33029 FB_BARLight Circuit Dim [} 221]: The value for "Manual On", lr Manual Dim Value, is less than zero or greater than 100%. 0x8106 33030 FB_BARAutomatic Light [} 203]: The operation mode ui Light Ctrl Mode is greater than 2. However, only 0, 1 or 2 is permitted. 0x8107 33031 FB_BARAutomatic Light [} 203]: The value for "Manual On", lr Manual Dim Value, is less than zero or greater than 100%. 0x8108 33032 FB_BARAutomatic Light [} 203]: The light switch-on value, lr On Dim Value, is less than zero or greater than 100%. 0x8109 33033 FB_BARStairwell Automatic [} 224]: The operation mode ui Light Ctrl Mode is greater than 2. However, only 0, 1 or 2 is permitted. 0x810A 33034 FB_BARTwilight Automatic [} 227]: The operation mode ui Light Ctrl Mode is greater than 2. However, only 0, 1 or 2 is permitted. 0x810B 33035 FB_BARTwilight Automatic [} 227]: The value for "Manual On", lr Manual Dim Value, is less than zero or greater than 100%. 0x810C 33036 FB_BARTwilight Automatic [} 227]: The ON value for the automatic function, lr Dim On Value, is less than zero or greater than 100%. 0x810D 33037 FB_BARTwilight Automatic [} 227]: The OFF value for the automatic function, lr Dim Off Value, is less than zero or greater than 100%. 0x810E 33038 FB_BARTwilight Automatic [} 227]: The switch-on threshold value, ui Switch On Value, is greater than or equal to the switch-off threshold value, ui Switch Off Value. 0x810F 33039 FB_BARDaylight Control [} 212]: The operation mode ui Light Ctrl Mode is greater than 2. However, only 0, 1 or 2 is permitted. 0x8110 33040 FB_BARConstant Light Control [} 206]: The operation mode ui Light Ctrl Mode is greater than 2. However, only 0, 1 or 2 is permitted. 0x8111 33041 FB_BARConstant Light Control [} 206]: The lower limit value, lr Min Dim Value, is less than zero or greater than 100%. 0x8112 33042 FB_BARConstant Light Control [} 206]: The upper limit value, lr Max Dim Value, is less than zero or greater than 100%. 0x8113 33043 FB_BARConstant Light Control [} 206]: The lower limit value, lr Min Dim Value, is greater than the upper limit value, lr Max Dim Value. 0x8114 33044 FB_BARConstant Light Control [} 206]: The starting value of the controller, lr Start Dim Value, is less than zero or greater than 100%. 0x8115 33045 FB_BARConstant Light Control [} 206]: The value for "Manual On", lr Manual Dim Value, is less than zero or greater than 100%. 0x8116.. 33046.. reserved for light function blocks 0x81FF 33279 0x8200 33280 FB_BARPICtrl [} 197]: The execution cycle number ui Ctrl Cycle Call is zero 0x8201 33281 FB_BARPICtrl [} 197]: The proportional band r Xp is zero. 0x8202 33282 FB_BARPICtrl [} 197]: The lower control value limit value r YMin is greater than or equal to the upper limit value r YMax. 0x8203 33283 FB_BARPICtrl [} 197]: The task cycle time t Task Cycle Time is set to 0. 0x8204 33284 FB_HVACOptimized On [} 422]: The outside temperature values lr Outside Temp[i] of the pre- start function st Temp Change Function are not in ascending order or 2 values are the same. 0x8205 33285 FB_HVACOptimized On [} 422]: One or more values of the room temperature change lr Room Temp Change[i] in the pre-start function st Temp Change Function are higher than the upper limit value lr Max Temp Change. 0x8206 33286 FB_HVACOptimized On [} 422]: One or more values of the room temperature change lr Room Temp Change[i] in the pre-start function st Temp Change Function are lower than the lower limit value lr Min Temp Change. 0x8207 33287 FB_HVACOptimized On [} 422]: The control input e Ctrl Fct is set neither to heating nor to cooling mode (e BARCtrl Fct_Heating or e BARCtrl Fct_Cooling). 0x8208 33288 FB_HVACOptimized Off [} 432]: The outside temperature values lr Outside Temp[i] of the pre- start function st Temp Change Function are not in ascending order or 2 values are the same. 0x8209 33289 FB_HVACOptimized Off [} 432]: One or more values of the room temperature change lr Room Temp Change[i] in the pre-start function st Temp Change Function are higher than the upper limit value lr Max Temp Change. 320 Version: 1.3.0 TF8000
## Page 321

Programming udi Error Id udi Error Id Error (hex) (dec) 0x820A 33290 FB_HVACOptimized Off [} 432]: One or more values of the room temperature change lr Room Temp Change[i] in the pre-start function st Temp Change Function are lower than the lower limit value lr Min Temp Change. 0x820B 33291 FB_HVACOptimized Off [} 432]: The control input e Ctrl Fct is set neither to heating nor to cooling mode (e BARCtrl Fct_Heating or e BARCtrl Fct_Cooling). 0x820C 33292 FB_HVACTemp Change Function Entry [} 442]: The outside temperature values lr Outside Temp[i] of the pre-start function st Temp Change Function are not in ascending order or 2 values are the same. 0x8C00.. 35840.. See SMI error codes 0x8CFF 36095 Subtract the value 0x0C00 from the error code to obtain the SMI-specific error code. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.6 HVAC Setpoint modules 5.1.6.1 FB_HVACHeating Curve The four-point heating curve serves to determine the setpoint for the flow temperature of a heating circuit, depending on the outside temperature. For functional reasons, this function block must be used together with FB_HVACSetpoint Heating. The reason for this is that the value for the night setback is taken into account in FB_HVACHeating Curve. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; r Outside Temp Damped : REAL; b Day Operation : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. TF8000 Version: 1.3.0 321
## Page 322

Programming A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. r Outside Temp Damped: This input variable transfers the current damped outside temperature to the function block. b Day Operation: TRUE = day operation, FALSE = night operation. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Temp Setpoint : REAL; b Invalid Parameter : BOOL; r Temp Setpoint: The calculated setpoint for the flow temperature (0°C..500°C). b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT r Min Temp : REAL; r Max Temp : REAL; r Night Setback : REAL; r Temp Setpoint_Y1 : REAL; r Temp Setpoint_Y2 : REAL; r Temp Setpoint_Y3 : REAL; r Temp Setpoint_Y4 : REAL; r Outside Temp_X1 : REAL; r Outside Temp_X2 : REAL; r Outside Temp_X3 : REAL; r Outside Temp_X4 : REAL; r Min Temp: The minimum value for the setpoint of the flow temperature is defined by this variable. The variable is saved persistently. Preset to 0. r Max Temp: The maximum value for the setpoint of the flow temperature is defined by this variable. The variable is saved persistently. Preset to 500. r Night Setback: The value for the night setback is specified by this variable. The variable is saved persistently. Preset to 20. r Temp Setpoint_Y1 / r Outside Temp_X1: The course of point 1 of the heating curve is parameterized by this value pair. The variable is saved persistently. Preset to 20. r Temp Setpoint_Y2 / r Outside Temp_X2: The course of point 2 of the heating curve is parameterized by this value pair. The variable is saved persistently. Preset to 65 and 0. r Temp Setpoint_Y3 / r Outside Temp_X3: The course of point 3 of the heating curve is parameterized by this value pair. The variable is saved persistently. Preset to 74 and -10. r Temp Setpoint_Y4 / r Outside Temp_X4: The course of point 4 of the heating curve is parameterized by this value pair. The variable is saved persistently. Preset to 80 and -20. 322 Version: 1.3.0 TF8000
## Page 323

Programming Course of the heating characteristic curves Conditions The following applies to the input of the values: X1 > X 2 > X3 > X4 and Y1 < Y2 < Y3 <Y4. Furthermore the minimum value for the setpoint of the feed temperature must be <= r Temp Setpoint_Y1 and >= 0. The maximum value for the setpoint of the feed temperature must be >= r Temp Setpoint_Y4. If one of these conditions is not met, the variable b Invalid Parameter will be set to TRUE and the default values of the VAR_IN_OUT variables will be adopted. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.6.2 FB_HVACHeating Curve Ex TF8000 Version: 1.3.0 323
## Page 324

Programming The heating curve serves to determine the setpoint for the flow temperature of a heating circuit, depending on the outside temperature. Compared with the FB_HVACHeating Curve, the heating curve is shown as a function. z = 20 - r Design Temp; u = 20 - r Outside Temp; VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; r Outside Temp Damped : REAL; b Day Operation : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. r Outside Temp Damped: This input variable transfers the current damped outside temperature to the function block. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Temp Setpoint : REAL; b Invalid Parameter : BOOL; r Temp Setpoint: The calculated setpoint [°C] for the flow temperature. b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. 324 Version: 1.3.0 TF8000
## Page 325

Programming VAR_IN_OUT r Min Temp Setpoint : REAL; r Max Temp Setpoint : REAL; r Design Temp : REAL; r Slope : REAL; r Curve : REAL; r Min Temp Setpoint: The minimum value for the setpoint of the flow temperature [°C] is defined by this variable. The variable is saved persistently. Preset to 20. r Max Temp Setpoint: The maximum value for the setpoint of the flow temperature [°C] is defined by this variable. The variable is saved persistently. Preset to 90. r Design Temp: Design temperature [°C] for the dimensioning of a heating system. Typical values for Germany lie between -12 ° C and -16 ° C. The variable is saved persistently. Preset to -16. r Slope: Factor for the slope. The variable is saved persistently. Preset to 1. r Curve: Factor for the curve. The variable is saved persistently. Preset to 0.5. Course of the heating characteristic curves Flow temperature of 50 °C at approx. -9.2 °C Flow temperature of 50 °C at approx. -9.4 °C TF8000 Version: 1.3.0 325
## Page 326

Programming Flow temperature of 50 °C at approx. -7.8 °C Flow temperature of 50 °C at approx. -8.3 °C Flow temperature of 60 °C at approx. -0.2 °C Flow temperature of 60 °C at approx. -3.0 °C Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 326 Version: 1.3.0 TF8000
## Page 327

Programming 5.1.6.3 FB_HVACOutside Temp Damped This function block serves to determine the average or damped outside temperature. In automatic mode the mean outside temperature is calculated from the outside temperature values at 7 am, 2 pm and 9 pm. The measurement taken at 9 pm receives double the weighting. VAR_INPUT b Enable : BOOL; r Outside Temp : REAL; dt System Time : DT; b Reset Internal Values : BOOL; e Ctrl Mode : E_HVACCtrl Mode; r Manual Value : REAL; b Enable: The function block is enabled by the PLC program with the input variable b Enable. If b Enable = FALSE, the last valid value of the damped outside temperature is output. r Outside Temp: This input variable transfers the current outside temperature to the function block. dt System Time: This input variable transfers the date and time to the function block. b Reset Internal Values: Using this input variable, the internally stored outside temperatures are reset and the current outside temperature is then adopted. e Ctrl Mode: The operation mode is selected via this Enum. Manual or automatic mode (see E_HVACCtrl Mode [} 489]). r Manual Value: Manual value that is set at the output r Outside Temp Damped if e Ctrl Mode = e HVACCtrl Mode_Manual. VAR_OUTPUT r Outside Temp Damped : REAL; r Outside Temp Damped: Damped outside temperature. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 327
## Page 328

Programming 5.1.6.4 FB_HVACSetpoint Heating By using this function block a heating circuit can be switched through different operation modes. Depending on the operation mode a corresponding setpoint for controlling the supply air temperature of a static heating circuit is output from the function block. The output b Heating is set or reset depending on the operation mode and the state of the parameters described below. For functional reasons this function block must be used together with the function block FB_HVACHeating Curve. The reason for this is that the value for the night setback is taken into account in FB_HVACHeating Curve. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r Setpoint In : REAL; r Outside Temp Damped : REAL; dt System Time : DT; b Day Operation : BOOL; b Freeze Protec : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. 328 Version: 1.3.0 TF8000
## Page 329

Programming b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is activated if the variable b Enable is TRUE. If it is FALSE, zero will be output at r Setpoint Out and the pump output remains FALSE. r Setpoint In: In the case of a heating circuit controlled by the room temperature, the value of a room setpoint module is applied at r Setpoint In. If the heating circuit is controlled by the outside temperature, the setpoint comes from the heating characteristic curve. See FB_HVACHeating Curve [} 321]. r Outside Temp Damped: Short-term fluctuations in the outside temperature must not be allowed to have an unfiltered effect on the setpoint of the flow temperature. For this reason the outside temperature must not be connected directly, but rather via a damping function block. See also FB_HVACOutside Temp Damped [} 327] regarding this point. dt Systemtime: This variable transfers the computer system time to the function block. b Day Operation: The output variable of the program is transferred at this input variable. If b Day Operation is TRUE, then the heating circuit is in day operation mode. The night setback of the flow temperature is hence deactivated. b Freeze Protec: Input to which the frost protection signal is applied. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Setpoint Out : REAL; b Heating : BOOL; b Req Outside Temp : BOOL; b Req Date : BOOL; b Req Permanent : BOOL; b Req Freeze Protec : BOOL; b Req Night : BOOL; b Req Day : BOOL; b Invalid Parameter : BOOL; r Setpoint Out: Setpoint for the supply air temperature control. b Heating: The output b Heating is set (TRUE) or reset (FALSE) immediately or after a delay, depending on the selected operating mode as well as the switch-on and switch-off delays. The output can be used to enable the controller. b Req Outside Temp: The heating circuit is in the operating mode ‘heating period according to outside temperature’. b Req Date: The heating circuit is in the operating mode ‘heating period according to date’. b Req Permanent: The heating circuit is in the operating mode ‘heating circuit always on’. b Req Freeze Protec: The heating circuit is in the operating mode ‘frost protection mode’. b Req Night: The heating circuit is in the operating mode ‘night operation’. b Req Day: The heating circuit is in the operating mode ‘day operation’. b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT e Setpoint Heating Mode : E_HVACSetpoint Heating Mode; r Heating Limit : REAL; ui On_Day : UINT; ui On_Month : UINT; ui Off_Day : UINT; ui Off_Month : UINT; r Freeze Protec Setpoint : REAL; r Night Setback : REAL; t Delay Heating On : TIME; t Delay Heating Off : TIME; TF8000 Version: 1.3.0 329
## Page 330

Programming e Setpoint Heating Mode: Enum that specifies the operation mode of the heating circuit (see E_HVACSetpoint Heating Mode [} 493]). The variable is saved persistently. Preset to 1. r Heating Limit: Heating limit (-60°C..100°C). Necessary for the operation modes of the heating circuit; heating period according to the outside temperature and heating period according to the date. The variable is saved persistently. Preset to 19. ui On_Day: Switch-on day of the month. Necessary for the operation mode ‘heating period according to date’. The variable is saved persistently. Preset to 1. ui On_Month: Switch-on month of the year. Necessary for the operation mode ‘heating period according to date’. The variable is saved persistently. Preset to 9. ui Off_Day: Switch-off day of the month. Necessary for the operation mode ‘heating period according to date’. The variable is saved persistently. Preset to 1. ui Off_Month: Switch-off month of the year. Necessary for the operation mode ‘heating period according to date’. The variable is saved persistently. Preset to 5. r Freeze Protec Setpoint: Setpoint for the heating circuit in frost protection mode (0°C..100°C). The variable is saved persistently. Preset to 8. r Night Setback: r Night Setback specifies the value for the night setback in °C (0°C..100°C). r Night Setback is taken into account in the operation mode e HVACSetpoint Heating Mode_On Night. The variable is saved persistently. Preset to 10. t Delay Heating On: Time delay for the setting of the output b Heating to TRUE after the damped outside temperature has undershot the heating limit or the date has been reached (0h..100h). The variable is saved persistently. Preset to 0. t Delay Heating Off: Time delay for the resetting of the output b Heating to FALSE after the damped outside temperature has exceeded the heating limit or the date has been reached (0h..100h). The variable is saved persistently. Preset to 0. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.6.5 FB_HVACSetpoint Ramp The function block generates a sliding setpoint ramp. This function block must be called in every PLC cycle, because the calculation for reaching the final setpoint depends on the Task Time. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r Setpoint In : REAL; b Reset : BOOL; 330 Version: 1.3.0 TF8000
## Page 331

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: Enables the function block. r Setpoint In: Setpoint to which the output r Setpoint Out is regulated, depending on the absolute temperature change r Setpoint Slide per time change t Ramp Time. Each change of the setpoint starts a new calculation of the setpoint to the target value of the ramp. The target value is the current value of r Setpoint In. The starting value of the ramp is the last value before the change of r Setpoint In to the new target value; see fig. 1.1. The value range for r Setpoint In is specified by the parameters r Max Setpoint and r Min Setpoint. If no correct variable value is present at r Setpoint In, then the last valid variable value, if one exists, will be taken. If no valid last value exists, operation continues internally with r Min Setpoint. b Invalid Parameter will be set in the event of an incorrect variable value; the function block continues to work normally. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Setpoint Out : REAL; t Remaining Time : TIME; b Value Reached : BOOL; b Invalid Parameter : BOOL; r Setpoint Out: Output of the ramp generator t Remaining Time: Time duration in which the output r Setpoint Out has reached the target value r Setpoint In. b Value Reached: A TRUE at this output indicates that the output r Setpoint Out has reached the target value r Setpoint In. b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables r Setpoint Slide or t Ramp Time. An incorrect parameter entry does not lead to a standstill of the block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. VAR_IN_OUT r Min Setpoint : REAL; r Max Setpoint : REAL; r Setpoint Slide : REAL; t Ramp Time : TIME; r Min Setpoint/r Max Setpoint: The value range for r Setpoint In is specified by the parameters r Max Setpoint and r Min Setpoint (-10000..10000). r Max Setpoint must be greater than r Min Setpoint. TF8000 Version: 1.3.0 331
## Page 332

Programming If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 10 or 40 respectively. r Setpoint Slide: Absolute temperature change in [Kelvin/t Ramp Time] with which the output is converted in sliding steps from a lower to a higher value or from a higher to a lower value, see fig. 1.1 If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 1. t Ramp Time: Ramp time (1s..24h) during which the final setpoint is reached in sliding steps, depending on the absolute temperature change r Setpoint Slide, see fig. 1.1 If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 3600 s. Fig. 1.1: Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.6.6 FB_HVACSummer Compensation 332 Version: 1.3.0 TF8000
## Page 333

Programming This function block is a setpoint generator for the exhaust air temperature or room temperature of an air conditioning system. With the aid of this summer compensation, overly large temperature differences between the outside temperature and the exhaust air/room temperature are avoided. This helps to save energy whilst at the same time increasing comfort. If the outside temperature increases to the point where the difference between it and the room temperature is greater than the set difference of r Setpoint Shift Absolute, then the room temperature setpoint r Setpoint Out is raised. The permissible difference can be set from 0 to 10 Kelvin. A check is performed in the function block that the maximum room temperature setpoint is not exceeded if e Setpoint Mode:= e HVACSetpoint Mode_DINLimited. Example I: Room setpoint r Setpoint In: = 21 °C external setpoint r Setpoint External = 2K (e.g. +/- 3K can be set via a potentiometer, but are not taken into account because e External Mode: = e HVACExternal Mode_Off ) set differential value between outside temperature and room temperature r Setpoint Shift Absolute: = 6K outside temperature r Outside Temp: = 28 °C e External Mode:= e HVACExternal Mode_Off e Setpoint Mode:= e HVACSetpoint Mode_DIN calculated room temperature setpoint (r Setpoint Out): = 22 Example II: Room setpoint r Setpoint In: = 20 °C external setpoint r Setpoint External: = -2K (e.g. +/- 3K can be set via a potentiometer). The set differential value between outside temperature and room temperature r Setpoint Shift Absolute: = 6K outside temperature r Outside Temp: = 28 °C e External Mode:= e HVACExternal Mode_On e Setpoint Mode:= e HVACSetpoint Mode_DIN calculated room temperature setpoint r Setpoint Out:= 20°C Example III: Room setpoint r Setpoint In: = 23 °C external setpoint r Setpoint External: = -3K (e.g. +/- 3K can be set via a potentiometer). The set differential value between outside temperature and room temperature r Setpoint Shift Absolute: = 6K outside temperature r Outside Temp: = 34 °C r Setpoint High Limit: = 35 °C e External Mode:= e HVACExternal Mode_On e Setpoint Mode:= e HVACSetpoint Mode_DINLimited calculated room temperature setpoint r Setpoint Out:= 31°C Example IV: Room setpoint r Setpoint In: = 24 °C external setpoint r Setpoint External: = -3K (e.g. +/- 3K can be set via a potentiometer). The set differential value between outside temperature and room temperature r Setpoint Shift Absolute: = 6K TF8000 Version: 1.3.0 333
## Page 334

Programming outside temperature r Outside Temp:= 36°C r Setpoint High Limit: = 30 °C e External Mode:= e HVACExternal Mode_On e Setpoint Mode:= e HVACSetpoint Mode_DINLimited calculated room temperature setpoint: = 31 °C, but is limited to 30 °C on account of r Setpoint High Limit being set to 30 °C ==> r Setpoint Out: = 30 °C VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; r Setpoint In : REAL; r Setpoint External : REAL; r Outside Temp : REAL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. r Setpoint In: The setpoint for the room is applied to this input. r Setpoint External: The setpoint adjustment or correction, e.g. from a potentiometer, is applied to this input. r Outside Temp: Input for the outside temperature. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT r Setpoint Out : REAL; b Invalid Parameter : BOOL; r Setpoint Out: Setpoint for the room. b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT r Setpoint High Limit : REAL; r Setpoint Shift Absolute : REAL; e External Mode : E_HVACExternal Mode; e Setpoint Mode : E_HVACSetpoint Mode; r Setpoint High Limit: Upper limit for the room temperature setpoint (0°C..100°C). The variable is saved persistently. Preset to 35. 334 Version: 1.3.0 TF8000
## Page 335

Programming r Setpoint Shift Absolute: Parameter value that defines the permissible difference between the outside temperature and the room temperature. The permissible difference can be set from 0 to 10 Kelvin. If the difference between the outside temperature and the room temperature is greater than the set parameter value, the room temperature setpoint is raised. The variable is saved persistently. Preset to 6. e External Mode: The external setpoint is activated/deactivated via the enum E_HVACExternal Mode (see E_HVACExternal Mode [} 490]). e HVACExternal Mode_Off means that the external setpoint set via the potentiometer on the control panel is deactivated. e HVACExterna Mode_On means that the external setpoint is activated, e.g. +/- 3 °C e HVACExternal Mode_Shift Absolut corresponds to an absolute external setpoint in °C e Setpoint Mode: Enum that specifies the type of setpoint determination (see E_HVACSetpoint Mode [} 493]). This increase of the setpoint in the case of high outside temperatures can be unlimited or limited according to DIN. Selection takes place with the ENUM E_HVACSetpoint Mode. Besides these two modes for summer compensation it is also possible to specify a fixed setpoint. 1. According to DIN (e HVACSetpoint Mode_DIN). The room temperature setpoint follows the outside temperature, guided by a difference. 2. Limited (e HVACSetpoint Mode_DINLimited). The room temperature setpoint follows the outside temperature, guided by a difference. However, it is limited. The limit value is r Setpoint High Limit. 3. Constant (e HVACSetpoint Mode_Constant Value Base). The room temperature setpoint is specified as a constant value; the outside temperature does not exert any influence. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7 HVAC Special functions 5.1.7.1 FB_HVACAir Conditioning2Speed The function block FB_HVACAir Conditioning2Speed controls switching to the second stage of air conditioning systems with two-speed fans. Switching to the second stage via the output variable b Speed2 can be performed either by a scheduler via the input variable b Time Scheduler or load-dependent via a difference between the setpoint of the room or exhaust temperature, r Setpoint, and the actual value of the room or exhaust temperature, r Actual Value, depending on the time delays t Delay Hysteresis On/ t Delay Hysteresis Off, the switch-on and release hystereses r Hysteresis On/r Hysteresis Off and the setting of the operation mode via the Enum e Air Conditioning2Speed Mode. TF8000 Version: 1.3.0 335
## Page 336

Programming VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b Time Scheduler : BOOL; r Setpoint : REAL; r Actual Value : REAL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the PLC program with the input variable b Enable= TRUE. The output variable b Speed2 is FALSE if the function block is not enabled. b Time Scheduler: Request by a timer program for the second fan stage. If b Enable and b Time Scheduler are TRUE, then b Speed2 and b Request Scheduler are also TRUE. r Setpoint: Setpoint of room or exhaust temperature r Actual Value: actual value of room air or exhaust air temperature b Reset: Input for acknowledging an incorrect parameter entry or an error via a rising edge. VAR_OUTPUT b Speed2 : BOOL; b Request Scheduler : BOOL; b Request Temperature : BOOL; b Invalid Parameter : BOOL; b Speed2: Output for controlling the second fan speed. b Request Scheduler: Request for the second fan speed via the input variable b Time Scheduler. b Request Temperature: Request for the second stage, depending on the load, via a difference between the setpoint of the room or exhaust temperature, r Setpoint, and the actual value of the room or exhaust temperature, r Actual Value, depending on the time delays t Delay Hysteresis On/t Delay Hysteresis Off, the switch-on and release hystereses r Hysteresis On/r Hysteresis Off and the setting of the operating mode via the Enum e Air Conditioning2Speed Mode. b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables r Hysteresis On , r Hysteresis Off and e Air Conditioning2Speed Mode. An incorrect parameter entry does not lead to a standstill of the block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. 336 Version: 1.3.0 TF8000
## Page 337

Programming VAR_IN_OUT r Hysteresis On : REAL; r Hysteresis Off : REAL; t Delay Hyteresis On : TIME; t Delay Hyteresis Off : TIME; e Air Conditioning2Speed Mode : E_HVACAir Conditioning2Speed Mode; r Hysteresis On: Parameter to switch on the second fan stage via a hysteresis loop, load-dependent, via the output variable b Speed2 depending on the enum e Air Conditioning2Speed Mode (0..1000). r Hysteresis On must be larger than r Hysteresis Off if the operation mode e Air Conditioning2Speed Mode=e HVACAir Conditioning2Speed Mode Heating And Cooling. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 5. r Hysteresis Off: Parameter to switch off the second fan stage via a hysteresis loop, load-dependent, via the output variable b Speed2 depending on the enum e Air Conditioning2Speed Mode (0..1000). If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 1. t Delay Hysteresis On: Switch-on delay of the output variable b Speed2 in the event of a load-dependent request for the second fan stage. The variable is saved persistently. Preset to 300 s. t Delay Hysteresis Off: Switch-off delay of the output variable b Speed2 in the event of a load-dependent request for the second fan stage. The variable is saved persistently. Preset to 300 s. e Air Conditioning2Speed Mode: Enum that specifies the load-dependent operation mode for switching on the second fan stage via the output variable b Speed2 (see E_HVACAir Conditioning2Speed Mode [} 488]). e Air Conditioning2Speed Mode = e HVACAir Conditioning2Speed Mode_Off: Operation mode off e Air Conditioning2Speed Mode = e HVACAir Conditioning2Speed Mode_Heating: Heating operation mode. This is an air conditioning system with heating operation only. e Air Conditioning2Speed Mode = e HVACAir Conditioning2Speed Mode_Cooling: Cooling operation mode. This is an air conditioning system with cooling operation only. e Air Conditioning2Speed Mode = e HVACAir Conditioning2Speed Mode_Heating And Cooling: Heating and cooling operation mode. This is an air conditioning system with heating and cooling operation. The variable is saved persistently. Preset to 1. Operating mode e Air Conditioning2Speed Mode = e HVACAir Conditioning2Speed Mode_Heating TF8000 Version: 1.3.0 337
## Page 338

Programming Operating mode e Air Conditioning2Speed Mode = e HVACAir Conditioning2Speed Mode_Cooling Operating mode e Air Conditioning2Speed Mode = e HVACAir Conditioning2Speed Mode_Heating And Cooling Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 338 Version: 1.3.0 TF8000
## Page 339

Programming 5.1.7.2 FB_HVACAlarm A TRUE on the input b Alarm In indicates that an alarm signal is present. The alarm is routed through to the output b Alarm only if b Alarm In is present for longer than the preset time t Alarm Delay. Furthermore, the input b Ctrl Voltage must be TRUE in order for an alarm to be announced. Output b Alarm remains set to TRUE until b Alarm In = FALSE and the alarm is acknowledged by a positive edge on b Reset. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Alarm In : BOOL; b Ctrl Voltage : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Alarm In: A TRUE on the input b Alarm In indicates that an alarm signal is present. b Ctrl Voltage: Via the input b Ctrl Voltage a check is made of whether control voltage is present. b Reset: Acknowledge input. VAR_OUTPUT b Alarm : BOOL; b Alarm: TRUE if an alarm is announced. VAR_IN_OUT t Alarm Delay : TIME; t Alarm Delay: Delay after the alarm is first signaled if, during the preset time, b Alarm In was constantly present (0s..500s). The variable is saved persistently. Preset to 500 s. TF8000 Version: 1.3.0 339
## Page 340

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.3 FB_HVACAnti Blocking Damper This function block prevents the blocking of an actuator over long time intervals with an unchanged control value. When activated, the blocking protection forces the actuator to drive from fully closed to fully open. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b Disable : BOOL; ry Damper : REAL dt System Time : DT; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The Anti Blocking function is enabled by the input variable b Enable. If b Enable = FALSE, only the input value will be applied at the output; the Anti Blocking function is not active. b Disable: Resets the outputs r QDamper, i QDamper and b QAnti Blocking to 0. 340 Version: 1.3.0 TF8000
## Page 341

Programming ry Damper: Control value from the controller to the valve, which is fed to the outputs r QDamper and i QDamper (0%..100%). The value must be smaller than 1 % in order for the function block to recognize this as standstill time. No standstill time will be determined for a valve with a control value >= 1 %. dt System Time: System time b Reset: Acknowledge input in the event of a fault. Resets the flag b Invalid Parameter. VAR_IN_OUT e Anti Blocking Mode : E_HVACAnti Blocking Mode; i Hours Downtime : INT; i Day Weekly : INT; i Hour : INT; i Minute : INT; i Length Impulse : INT; e HVACAnti Blocking Mode: Enumeration value that specifies the type of Antiblocking method (see E_HVACAnti Blocking Mode [} 488]). e HVACAnti Blocking Mode_Off:= 0: Off e HVACAnti Blocking Mode_Downtime:= 1: After the expiry of a standstill time in hours, the Antiblocking-pulse will be routed to the b Out output. e HVACAnti Blocking Mode_Weekly:= 2: The antiblocking pulse is only generated on a certain day of the week and at a certain time, independent of how long the standstill has lasted. The variable is saved persistently. i Hours Downtime: For e HVACAnti Blocking Mode_Downtime, the time in hours for which the input b In may not be active until the Anti Blocking pulse is formed (0h..6000h). The variable is saved persistently. Preset to 24. i Day Weekly: For e HVACAnti Blocking Mode_Weekly, Anti Blocking pulse is formed on this day. Sun=0, Mon=1, Tue=2, Wed=3, Thu=4, Fri=5, Sat=6 The variable is saved persistently. Preset to 6. i Hour: Switch-on time in hours (0..23 h). The variable is saved persistently. Preset to 12. i Minute: Switch-on time in minutes (0min..59min). The variable is saved persistently. Preset to 0. i Length Impulse: Switch-on time in seconds (0s..600s). The variable is saved persistently. Preset to 150. VAR_OUTPUT r QDamper : REAL; i QDamper : INT; b QAnti Blocking : BOOL; b Invalid Parameter: BOOL; r QDamper: This output corresponds to the input value of the control value (0%..100%). As soon as the input b Enable is TRUE, the Antiblocking pulse is additionally applied to the output. 100 % is present at the output when the Antiblocking state is reached. i QDamper: This output behaves like r QDamper, but in order to suit an analog output it is output as an integer value from 0 - 32767, corresponding to 0 - 100 %. b QAnti Blocking: This output is independent of the switch-on signal and shows only the Antiblocking-pulse. b Invalid Parameter: An error occurred during the plausibility check. It is deleted again by b Reset. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 341
## Page 342

Programming 5.1.7.4 FB_HVACAnti Blocking Pump This function block relays the switch-on condition for a pump drive and can generate an additional switch-on pulse, depending on the mode and the switch-off time, in order e.g. to prevent the blockage of a pump. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; b Disable : BOOL; b In : BOOL; dt System Time : DT; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The Anti Blocking function is enabled by the input variable b Enable. If b Enable = FALSE, only the switch-on condition will be applied at the output; the Anti Blocking function is not active. b Disable: Resets the outputs b Out, b Out And Anti Blocking and b QAnti Blocking to 0. (see example below) b In: Switch-on condition that is relayed to the output b Out. dt System Time: System time b Reset: Acknowledge input in the event of a fault. Resets the flag b Invalid Parameter. 342 Version: 1.3.0 TF8000
## Page 343

Programming VAR_IN_OUT e Anti Blocking Mode: E_HVACAnti Blocking Mode; i Hours Downtime : INT; i Day Weekly : INT; i Hour : INT; i Minute : INT; i Length Impulse : INT; e HVACAnti Blocking Mode: Enumeration value that specifies the type of Antiblocking method (see E_HVACAnti Blocking Mode [} 488]). e HVACAnti Blocking Mode_Off:=0 : Off e HVACAnti Blocking Mode_Downtime:=1 : After the expiry of a standstill time in hours, the Antiblocking-pulse will be routed to the b Out output. e HVACAnti Blocking Mode_Weekly:=2 : The antiblocking pulse is only generated on a certain day of the week and at a certain time, independent of how long the standstill has lasted. The variable is saved persistently. i Hours Downtime: For e HVACAnti Blocking Mode_Downtime, the time in hours for which the input b In may not be active until the Anti Blocking pulse is formed (0h..6000h). The variable is saved persistently. Preset to 24. i Day Weekly: For e HVACAnti Blocking Mode_Weekly, Anti Blocking pulse is formed on this day. Sun=0, Mon=1, Tue=2, Wed=3, Thu=4, Fri=5, Sat=6 The variable is saved persistently. Preset to 6. i Hour: Switch-on time in hours (0h..23h). The variable is saved persistently. Preset to 12. i Minute: Switch-on time in minutes (0min..23min). The variable is saved persistently. Preset to 0. i Length Impulse: Switch-on time in seconds (0s..600s). The variable is saved persistently. Preset to 150. VAR_OUTPUT b Out : BOOL; b Out And Anti Blocking : BOOL; b QAnti Blocking : BOOL; b Invalid Parameter : BOOL; b Out: If TRUE, then the request comes from the pump function block. This output corresponds to the switch- on condition independent of the state of the Antiblocking pulse and the input b Enable. b Out And Anti Blocking: The output can go TRUE if the request comes from the pump function block OR from the anti-blocking function. The pump is connected to this output. This output corresponds to the switch-on condition and is dependent upon the state of the Antiblocking-pulse and the inputs b Enable and b Disable. If b Enable = FALSE, then the output corresponds to the output b Out. If b Enable = TRUE, then the output corresponds to the output b Out and is additionally Ored° with the Antiblocking-pulse. b QAnti Blocking: If TRUE, then request comes from the anti-blocking function. This output is independent of the switch-on signal and shows only the Antiblocking-pulse. b Invalid Parameter: An error occurred during the plausibility check. It is deleted again by b Reset. Example of a combination of a pump block and the FB_HVACAnti Blocking: • The pump output b Pump is applied to b In of the FB_HVACAnti Blocking also without b Enable. • If the input b Pump Protec goes to FALSE, b Pump is switched off and b Disable becomes active via the message b Error Pump Protec, so that b Out is switched off. TF8000 Version: 1.3.0 343
## Page 344

Programming Example of the control of several pumps via one Anti Blocking instance: • Enable fb HVACAnti Blocking via b Enable. • Select weekly mode (e.g. Monday at 6.30 pm for 10 secs). 344 Version: 1.3.0 TF8000
## Page 345

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.5 FB_HVACBlink The function block delivers a flash sequence at the output b Blink that is dependent on the two adjustable times t Time On and t Time Off. VAR_INPUT b Enable :REAL; t Time On :TIME; t Time Off :TIME; b Enable: Enables the function block. t Time On: Switch-on duration of the flash pulse, b Blink = TRUE. t Time Off: Switch-off duration of the flash pulse, b Blink = FALSE. VAR_OUTPUT b Blink :BOOL; t Next Switching :TIME; b Blink: Flash output t Next Switching: Time until the next change of state of the output b Blink. Behavior of the output value Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 345
## Page 346

Programming 5.1.7.6 FB_HVACCmd Ctrl_8 With this function block, individual units in a system can be sequentially switched on (b Q_Cmd > b Q1 > b Q2… b Q8) or switched off (b Q8 > b Q7 > b Q6… b Q_Cmd) in a certain order. FB_HVACCmd Ctrl_8 can be used as the starting function block of a ventilation system. An event and a parameter structure with time variables belong to each output. These can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output. Switch-on condition if and are TRUE: b En b Cmd Q(n) = Q(n - 1) AND Event(n) AND (Delay On(n) = 0 AND (Min Off(n) = 0 AND st State.udi Step = n Example for the output b Q_Cmd b Q_Cmd = b Cmd AND st State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[0] = 0 AND st State.udi Step = 0 Example for the output b Q2 b Q2 = b Q1 AND b Evt2 AND st State.udi Sec RT_Delay On = 0 AND st State[2].udi Sec RT_Min Off = 0 AND st State.udi Step = 2 Switch-off condition if is TRUE and is FALSE: b En b Cmd Q(n) = NOT Q(n + 1) AND (Delay Off(n) = 0 AND (Min On(n) = 0 AND st State.udi Step = n Example for the output b Q8 b Q8 = st State.udi Sec RT_Delay Off = 0 AND st State[7].udi Sec RT_Min On = 0 AND st State.udi Step = 8 Example for the output b Q_Cmd b Q_Cmd = NOTb Q1 AND st State.udi Sec RT_Delay Off = 0 AND st State[0].udi Sec RT_Min On = 0 AND st State.udi Step = 0 Current step On the basis of the status variable st State.udi Step it is possible to see which step the function block is currently in. 346 Version: 1.3.0 TF8000
## Page 347

Programming Switch-on and switch-off sequence If b En and b Cmd are TRUE the switch-on sequence is (b Q_Cmd > b Q1 > b Q2 … b Q8). The switch-off sequence (b Q8 > b Q7 > b Q6 … b Q_Cmd) is active if b En = TRUE and b Cmd = FALSE. If an output has been set in the switch-on sequence, then it remains latched and is only reset in the switch- off phase. In the switch-off sequence, no event (b Evt1-8) has any effect on the switch-off conditions of the outputs. If the function block is in the switch-off sequence and the switch-on phase is activated by b Cmd = TRUE, then the function block starts in step 0 with the switch-on conditions of b Q_Cmd. For the other outputs the minimum switch-on or switch-off times are active until their expiry. TF8000 Version: 1.3.0 347
## Page 348

Programming Time responses of an individual step The diagram shows the time responses of step 1 or the output b Q1. 348 Version: 1.3.0 TF8000
## Page 349

Programming VAR_INPUT e DST : E_HVACData Security Type; b En : BOOL; b Cmd : BOOL; b Evt1 : BOOL; b Evt2 : BOOL; b Evt3 : BOOL; b Evt4 : BOOL; b Evt5 : BOOL; b Evt6 : BOOL; b Evt7 : BOOL; b Evt8 : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b En: Enables the function block. The function block is disabled if b En is FALSE. All outputs go to FALSE and the timers for the switch-on and switch-off delays as well as the minimum switch-on and switch-off times are reset. A collective error message or an emergency stop switch for immediately switching off a system can be connected to the input b En. b Cmd: The switch-on or switch-off sequence of the function block is defined with b Cmd. If b Cmd is TRUE, then the function block is in the switch-on sequence of the outputs. The switching on of a system could come, for example, from a timer program. If b Cmd is FALSE, then the function block is in the switch-off sequence of the outputs. b Cmd counts as one of the switch-on conditions of b Q_Cmd. b Evt1: The event b Evt1 counts as one of the switch-on conditions of b Q1. In the switch-on phase of b Q1, the switch-on delay of the output is active only if b Evt1 is TRUE. Switch-on condition: b Q1 = b Q_Cmd ANDb Evt1ANDst State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[1] = 0 AND st State.udi Step = 1 The event b Evt1 has no effect on the switch-off condition of b Q1. b Evt2: The event b Evt2 counts as one of the switch-on conditions of b Q2. In the switch-on phase of b Q2, the switch-on delay of the output is active only if b Evt2 is TRUE. Switch-on condition: b Q2 = b Q1ANDb Evt2 AND st State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[2] = 0 AND st State.udi Step = 2 The event b Evt2 has no effect on the switch-off condition of b Q2. b Evt3: The event b Evt3 counts as one of the switch-on conditions of b Q3. In the switch-on phase of b Q3, the switch-on delay of the output is active only if b Evt3 is TRUE. TF8000 Version: 1.3.0 349
## Page 350

Programming Switch-on condition: b Q3 = b Q2 AND b Evt3ANDst State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[3] = 0 AND st State.udi Step = 3 The event b Evt3 has no effect on the switch-off condition of b Q3. b Evt4: The event b Evt4 counts as one of the switch-on conditions of b Q4. In the switch-on phase of b Q4, the switch-on delay of the output is active only if b Evt4 is TRUE. Switch-on condition: b Q4 = b Q3 AND b Evt4ANDst State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[4] = 0 AND st State.udi Step = 4 The event b Evt4 has no effect on the switch-off condition of b Q4. b Evt5: The event b Evt5 counts as one of the switch-on conditions of b Q5. In the switch-on phase of b Q5, the switch-on delay of the output is active only if b Evt5 is TRUE. Switch-on condition: b Q5 = b Q4 AND b Evt5ANDst State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[5] = 0 AND st State.udi Step = 5 The event b Evt5 has no effect on the switch-off condition of b Q5. b Evt6: The event b Evt6 counts as one of the switch-on conditions of b Q6. In the switch-on phase of b Q6, the switch-on delay of the output is active only if b Evt6 is TRUE. Switch-on condition: b Q6 = b Q5 AND b Evt6ANDst State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[6] = 0 AND st State.udi Step = 6 The event b Evt6 has no effect on the switch-off condition of b Q6. b Evt7: The event b Evt7 counts as one of the switch-on conditions of b Q7. In the switch-on phase of b Q7, the switch-on delay of the output is active only if b Evt7 is TRUE. Switch-on condition: b Q7 = b Q6ANDb Evt7 AND st State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[7] = 0 AND st State.udi Step = 7 The event b Evt7 has no effect on the switch-off condition of b Q7. b Evt8: The event b Evt8 counts as one of the switch-on conditions of b Q8. In the switch-on phase of b Q8, the switch-on delay of the output is active only if b Evt8 is TRUE. Switch-on condition: b Q8 = b Q7 AND b Evt8ANDst State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[8] = 0 AND st State.udi Step = 8 The event b Evt8 has no effect on the switch-off condition of b Q8. VAR_OUTPUT b Q_Cmd : BOOL; b Q1 : BOOL; b Q2 : BOOL; b Q3 : BOOL; b Q4 : BOOL; b Q5 : BOOL; b Q6 : BOOL; b Q7 : BOOL; b Q8 : BOOL; st State : ST_HVACCmd Ctrl_8State; 350 Version: 1.3.0 TF8000
## Page 351

Programming b Q_Cmd: Output to enable a device. If the output b Q_Cmd has been set in the switch-on sequence, then it remains latched and is only reset in the switch-off sequence. The input variable b Cmd and the parameter structure st Param Cmd belong to b Q_Cmd. b Cmd is one of the switch-on conditions of b Q_Cmd. The time variables of the parameter structure can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration for the output. The state of the time responses is indicated with the output structure st State. Switch-on condition b Q_Cmd = b Cmd ANDst State.udi Sec RT_Delay On = 0 ANDst State.udi Sec RT_Min Off[0] = 0 ANDst State.udi Step = 0 Switch-off condition b Q_Cmd = NOTb Q1ANDst State.udi Sec RT_Delay Off = 0 ANDst State.udi Sec RT_Min On[0] = 0 ANDst State.udi Step = 0 b Q1: Output to enable a device. If the output b Q1 has been set in the switch-on sequence, then it remains latched and is only reset in the switch-off sequence. The event 1 b Evt1 and the parameter structure st Param1 belong to b Q1. b Evt1 is one of the switch-on conditions of b Q1. The time variables of the parameter structure can be used to define a switch-on or switch- off delay as well as a minimum switch-on or minimum switch-off duration for the output. The state of the time responses is indicated with the output structure st State. Switch-on condition b Q1 = b Evt1ANDst State.udi Sec RT_Delay On = 0 ANDst State.udi Sec RT_Min Off[1] = 0 ANDst State.udi Step = 1 Switch-off condition b Q1 = NOTb Q1ANDst State.udi Sec RT_Delay Off = 0 ANDst State.udi Sec RT_Min On[1] = 0 ANDst State.udi Step = 1 b Q2: Output to enable a device. If the output b Q2 has been set in the switch-on sequence, then it remains latched and is only reset in the switch-off sequence. The event 2 b Evt2 and the parameter structure st Param2 belong to b Q2. b Evt2 is one of the switch-on conditions of b Q2. The time variables of the parameter structure can be used to define a switch-on or switch- off delay as well as a minimum switch-on or minimum switch-off duration for the output. The state of the time responses is indicated with the output structure st State. Switch-on condition b Q2 = b Evt2 AND st State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[2] = 0 AND st State.udi Step = 2 Switch-off condition b Q2 = NOTb Q2 AND st State.udi Sec RT_Delay Off = 0 AND st State.udi Sec RT_Min On[2] = 0 AND st State.udi Step = 2 b Q3: Output to enable a device. If the output b Q3 has been set in the switch-on sequence, then it remains latched and is only reset in the switch-off sequence. The event 3 b Evt3 and the parameter structure st Param3 belong to b Q3. b Evt3 is one of the switch-on conditions of b Q3. The time variables of the parameter structure can be used to define a switch-on or switch- off delay as well as a minimum switch-on or minimum switch-off duration for the output. The state of the time responses is indicated with the output structure st State. Switch-on condition b Q3 = b Evt3 AND st State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[3] = 0 ANDst State.udi Step = 3 Switch-off condition TF8000 Version: 1.3.0 351
## Page 352

Programming b Q3 = NOTb Q3 AND st State.udi Sec RT_Delay Off = 0 AND st State.udi Sec RT_Min On[3] = 0 AND st State.udi Step = 3 b Q4: Output to enable a device. If the output b Q4 has been set in the switch-on sequence, then it remains latched and is only reset in the switch-off sequence. The event 4 b Evt4 and the parameter structure st Param4 belong to b Q4. b Evt4 is one of the switch-on conditions of b Q4. The time variables of the parameter structure can be used to define a switch-on or switch- off delay as well as a minimum switch-on or minimum switch-off duration for the output. The state of the time responses is indicated with the output structure st State. Switch-on condition b Q4 = b Evt4 AND st State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[4] = 0 AND st State.udi Step = 4 Switch-off condition b Q4 = NOTb Q4 AND st State.udi Sec RT_Delay Off = 0 AND st State.udi Sec RT_Min On[4] = 0 AND st State.udi Step = 4 b Q5: Output to enable a device. If the output b Q5 has been set in the switch-on sequence, then it remains latched and is only reset in the switch-off sequence. The event 5 b Evt5 and the parameter structure st Param5 belong to b Q5. b Evt5 is one of the switch-on conditions of b Q5. The time variables of the parameter structure can be used to define a switch-on or switch- off delay as well as a minimum switch-on or minimum switch-off duration for the output. The state of the time responses is indicated with the output structure st State. Switch-on condition b Q5 = b Evt5 AND st State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[5] = 0 AND st State.udi Step = 5 Switch-off condition b Q5 = NOT b Q5 AND st State.udi Sec RT_Delay Off = 0 AND st State.udi Sec RT_Min On[5] = 0 AND st State.udi Step = 5 b Q6: Output to enable a device. If the output b Q6 has been set in the switch-on sequence, then it remains latched and is only reset in the switch-off sequence. The event 6 b Evt6 and the parameter structure st Param6 belong to b Q6. b Evt6 is one of the switch-on conditions of b Q6. The time variables of the parameter structure can be used to define a switch-on or switch- off delay as well as a minimum switch-on or minimum switch-off duration for the output. The state of the time responses is indicated with the output structure st State. Switch-on condition b Q6 = b Evt6 AND st State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[6] = 0 AND st State.udi Step = 6 Switch-off condition b Q6 = NOTb Q6 AND st State.udi Sec RT_Delay Off = 0 AND st State.udi Sec RT_Min On[6] = 0 AND st State.udi Step = 6 b Q7: Output to enable a device. If the output b Q7 has been set in the switch-on sequence, then it remains latched and is only reset in the switch-off sequence. The event 7 b Evt7 and the parameter structure st Param7 belong to b Q7. b Evt7 is one of the switch-on conditions of b Q7. The time variables of the parameter structure can be used to define a switch-on or switch- off delay as well as a minimum switch-on or minimum switch-off duration for the output. The state of the time responses is indicated with the output structure st State. Switch-on condition b Q7 = b Evt7 AND st State.udi Sec RT_Delay On = 0 AND st State.udi Sec RT_Min Off[7] = 0 AND st State.udi Step = 7 352 Version: 1.3.0 TF8000
## Page 353

Programming Switch-off condition b Q7 = NOTb Q7 AND st State.udi Sec RT_Delay Off = 0 AND st State.udi Sec RT_Min On[7] = 0 AND st State.udi Step = 7 b Q8: Output to enable a device. If the output b Q8 has been set in the switch-on sequence, then it remains latched and is only reset in the switch-off sequence. The event 8 b Evt8 and the parameter structure st Param8 belong to b Q8. b Evt8 is one of the switch-on conditions of b Q8. The time variables of the parameter structure can be used to define a switch-on or switch- off delay as well as a minimum switch-on or minimum switch-off duration for the output. The state of the time responses is indicated with the output structure st State. Switch-on condition b Q8 = b Evt8ANDst State.udi Sec RT_Delay On = 0 ANDst State.udi Sec RT_Min Off[8] = 0 ANDst State.udi Step = 8 Switch-off condition b Q8 = st State.udi Sec RT_Delay Off = 0 AND st State.udi Sec RT_Min On[8] = 0 AND st State.udi Step = 8 st State: This structure indicates the remaining times of the switch-on or switch-off delay of the active step and the minimum switch-on or minimum switch-off duration of the outputs (see ST_HVACCmd Ctrl_8State [} 495]). st State.udi Sec RT_Delay On: In the switch-on phase of the outputs (b Cmd = TRUE), the remaining time of the switch-on delay of the current step st State.udi Step is indicated by st State.udi Sec RT_Delay On. Example: If st State.udi Step = 5, then the function block is in step 5. The time variable of the parameter structure st Param5.udi Sec Delay On is used for the switch-on delay of the output b Q5 and the remaining time is indicated by udi Sec RT_Delay On. st State.udi Sec RT_Delay Off: In the switch-off phase of the outputs (b Cmd = FALSE) the remaining time of the switch-off delay of the current step st State.udi Step is indicated by udi Sec RT_Delay Off. Example: If st State.udi Step = 0, then the function block is in step 0. The time variable st Param Cmd.udi Sec Delay Off is used for the switch-off delay of the output b Q_Cmd and the remaining time is indicated by udi Sec RT_Delay Off. st State.udi Step: State indicating which step the function block is in. Examples: - If st State.udi Step = 0, then the function block is in the switch-on or switch-off sequence of the output b Q_Cmd. - If st State.udi Step = 1, then the function block is in the switch-on or switch-off sequence of the output b Q1. - If st State.udi Step = 8, then the function block is in the switch-on or switch-off sequence of the output b Q8 st State.udi Sec RT_Min On[0]: .. g_i Num Of Cmd Ctrl_8 The remaining time of the minimum switch-on duration of the outputs is indicated in the one-dimensional field (Table) st State.udi Sec RT_Min On[0..g_i Num Of Cmd Ctrl_8]. Following the expiry of the minimum switch-on duration of an output, the output can be switched off in the current step st State.udi Step. st State.udi Sec RT_Min Off[0]: .. g_i Num Of Cmd Ctrl_8 The remaining time of the minimum switch-off duration of the outputs is indicated in the one-dimensional field (Table) st State.udi Sec RT_Min Off[0..g_i Num Of Cmd Ctrl_8]. Following the expiry of the minimum switch-off duration of an output, the output can be switched on in the current step st State.udi Step. VAR_IN_OUT st Param Cmd : ST_HVACCmd Ctrl_8Param; st Param1 : ST_HVACCmd Ctrl_8Param; st Param2 : ST_HVACCmd Ctrl_8Param; st Param3 : ST_HVACCmd Ctrl_8Param; st Param4 : ST_HVACCmd Ctrl_8Param; st Param5 : ST_HVACCmd Ctrl_8Param; TF8000 Version: 1.3.0 353
## Page 354

Programming st Param6 : ST_HVACCmd Ctrl_8Param; st Param7 : ST_HVACCmd Ctrl_8Param; st Param8 : ST_HVACCmd Ctrl_8Param; st Param Cmd: The structure contains time variables that can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output b Q_CMD (see ST_HVACCmd Ctrl_8Param [} 495]). The variable is saved persistently. st Param1: The structure contains time variables that can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output b Q1. The variable is saved persistently. st Param2: The structure contains time variables that can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output b Q2. The variable is saved persistently. st Param3: The structure contains time variables that can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output b Q3. The variable is saved persistently. st Param4: The structure contains time variables that can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output b Q4. The variable is saved persistently. st Param5: The structure contains time variables that can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output b Q5. The variable is saved persistently. st Param6: The structure contains time variables that can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output b Q6. The variable is saved persistently. st Param7: The structure contains time variables that can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output b Q7. The variable is saved persistently. st Param8: The structure contains time variables that can be used to define a switch-on or switch-off delay as well as a minimum switch-on or minimum switch-off duration of the output b Q8. The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.7 FB_HVACCmd Ctrl System1Stage 354 Version: 1.3.0 TF8000
## Page 355

Programming This function block FB_HVACCmd Ctrl System1Stage is a system switch. It is used, for example, to switch a single-stage ventilation system to automatic or manual operation mode. In automatic operation mode the system can be controlled via a timer program or via the request from a control panel. The function block FB_HVACCmd Ctrl System1Stage is active if the input variable b Enable is TRUE and e Ctrl Mode Actuator = e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; e Ctrl Mode Actuator : E_HVACActuator Mode; b External Request : BOOL; b Time Scheduler : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If b Enable = FALSE, then b On is also FALSE. e Ctrl Mode Actuator: Enum that specifies the system operation modes Manual, Auto and Off (see E_HVACActuator Mode [} 488]). If specified incorrectly, operation continues internally with the last valid operation mode. This is e HVACActuator Mode_Auto_BMS in the case of initial commissioning. b Invalid Parameter is set in the case of an incorrect parameter specification. b External Request: External request for the system, e.g. from a control panel via a button or switch. b Time Scheduler: Request for the system via a timer program. b Reset: Acknowledge input in the event of an error VAR_OUTPUT b On : BOOL; e State Mode Actuator : E_HVACActuator Mode; b Request Scheduler : BOOL; b Request External : BOOL; b Invalid Parameter : BOOL; b On: This output variable enables the system. e State Mode Actuator: Enum via which the state of the operation mode of the motor is fed back to the controller (see E_HVACActuator Mode [} 488]). b Request Scheduler: This output indicates that the system is requested by the input variable b Time Scheduler. TF8000 Version: 1.3.0 355
## Page 356

Programming b Request External: This output indicates that the system is requested by the input variable b External Request. b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables e Ctrl Mode Actuator,e Plant Mode or e External Request Mode. An incorrect parameter entry does not lead to a standstill of the function block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. VAR_IN_OUT e Plant Mode : E_HVACPlant Mode; e External Request Mode : E_HVACExternal Request Mode; t Off Delay : TIME; e Plant Mode: With this enumeration variable various system functions can be executed in automatic mode, depending on the input variables b External Request and b Time Scheduler (see E_HVACPlant Mode [} 491]). e Plant Mode = e HVACPlant Mode_Time Scheduling Only: The system is switched on and off exclusively via the input variable b Time Scheduler. e Plant Mode = e HVACPlant Mode_Time Scheduling_And_External Request: The system is switched on if the input variables b Time Scheduler AND b External Request are TRUE. e Plant Mode = e HVACPlant Mode_Time Scheduling_Or_External Request: The system is switched on via the input variable b Time Scheduler OR b External Request. e Plant Mode = e HVACPlant Mode_External Request Only: The system is switched on and off exclusively via the input variable b External Request. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 0. e External Request Mode: The enum e External Request Mode specifies the mode of operation of the input variable b External Request in automatic mode, depending on the enum e Plant Mode (see E_HVACExternal Request Mode [} 491]). e External Request Mode = e HVACExternal Request Mode_Button On_Off: The external request is set to TRUE following a rising edge on b External Request. A further rising edge resets the request to FALSE. e External Request Mode = e HVACExternal Request Mode_Button Off Delay: Following a rising edge on the input variable b External Request, the external request extends or sets the utilization time of the system by the time setting of t Off Delay. e External Request Mode = e HVACExternal Request Mode_Switch On_Off: The external request is active if b External Request = TRUE. It is deactivated if b External Request = FALSE. If an incorrect variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 0. t Off Delay: Time value for the extension of the system utilization time. The extension of the utilization time can only be activated if e Mode External Request = 2. The variable is saved persistently. Preset to 30 min. 356 Version: 1.3.0 TF8000
## Page 357

Programming Behavior of the output value TF8000 Version: 1.3.0 357
## Page 358

Programming 358 Version: 1.3.0 TF8000
## Page 359

Programming TF8000 Version: 1.3.0 359
## Page 360

Programming 360 Version: 1.3.0 TF8000
## Page 361

Programming TF8000 Version: 1.3.0 361
## Page 362

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 362 Version: 1.3.0 TF8000
## Page 363

Programming 5.1.7.8 FB_HVACCmd Ctrl System2Stage This function block FB_HVACCmd Ctrl System2Stage is a system switch. It is used, for example, to switch a two-stage ventilation system to automatic or manual operation mode. In automatic operation mode the system can be controlled via a timer program or via the request from a control panel. The FB_HVACCmd Ctrl System2Stage function block is active if the input variable b Enable is TRUE and e Ctrl Mode Actuator = e HVACActuator Mode_Auto_BMS or e HVACActuator Mode_Auto_OP. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; e Ctrl Mode Actuator : E_HVACActuator Mode; b External Request1 : BOOL; b External Request2 : BOOL; b Time Scheduler1 : BOOL; b Time Scheduler2 : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. If b Enable = FALSE, then b On1 and b On2 are also FALSE. e Ctrl Mode Actuator: Enum that specifies the system operation modes Manual, Auto and Off (see E_HVACActuator Mode [} 488]). If specified incorrectly, operation continues internally with the last valid operation mode. This is e HVACActuator Mode_Auto_BMS in the case of initial commissioning. b Invalid Parameter is set in the case of an incorrect parameter specification. TF8000 Version: 1.3.0 363
## Page 364

Programming b External Request1: External request for the system in stage 1, e.g. from a control panel via a button or switch. b External Request2: External request for the system in stage 2, e.g. from a control panel via a button or switch. b Time Scheduler1: Request for the system in stage 1 via a timer program. b Time Scheduler2: Request for the system in stage 2 via a timer program. b Reset: Acknowledge input in the event of an error. VAR_OUTPUT b On1 : BOOL; b On2 : BOOL; e State Mode Actuator : E_HVACActuator Mode; b Request Scheduler1 : BOOL; b Request Scheduler2 : BOOL; b Request External1 : BOOL; b Request External2 : BOOL; b Invalid Parameter : BOOL; b On1: The system is enabled for stage 1 by this output variable. b On2: The system is enabled for stage 2 by this output variable. If stage 2 is enabled, then stage 1 is automatically also enabled. e State Mode Actuator: Enum via which the state of the operation mode of the motor is fed back to the controller (see E_HVACActuator Mode [} 488]). b Request Scheduler1: This output indicates that the system is requested by the input variable b Time Scheduler1. b Request Scheduler2: This output indicates that the system is requested by the input variable b Time Scheduler2. b Request External1: This output indicates that the system is requested by the input variable b External Request1. b Request External2: This output indicates that the system is requested by the input variable b External Request2. b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables e Ctrl Mode Actuator,e Plant Mode or e External Request Mode. An incorrect parameter entry does not lead to a standstill of the function block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. VAR_IN_OUT e Plant Mode : E_HVACPlant Mode; e External Request Mode: E_HVACExternal Request Mode; t Off Delay1 : TIME; t Off Delay2 : TIME; e Plant Mode: With this enumeration variable various system functions can be executed in automatic operation mode, depending on the input variables b External Request1, b External Request2, b Time Scheduler1 and b Time Scheduler2 (see E_HVACPlant Mode [} 491]). e Plant Mode = e HVACPlant Mode_Time Scheduling Only: The system is switched to the respective stage exclusively via the input variables b Time Scheduler1 or b Time Scheduler2. e Plant Mode = e HVACPlant Mode_Time Scheduling_And_External Request: The system is switched to stage 1 if the input variables b Time Scheduler1 AND b External Request1 are both TRUE. If the input variables b Time Scheduler2 AND b External Request2 are both TRUE, the system is switched to stage 2. e Plant Mode = e HVACPlant Mode_Time Scheduling_Or_External Request: The system is switched to the respective stage via the input variables b External Request1, b External Request2 OR b Time Scheduler1, b Time Scheduler2. e Plant Mode = e HVACPlant Mode_External Request Only: The system is switched to the respective stage exclusively via the input variable b External Request1 or b External Request2. 364 Version: 1.3.0 TF8000
## Page 365

Programming If an incorrect variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 0. e External Request Mode: The enum e External Request Mode specifies the mode of operation of the input variables b External Request1 and b External Request2 in automatic operation mode, depending on the enum e Plant Mode (see E_HVACExternal Request Mode [} 491]). e External Request Mode = e HVACExternal Request Mode_Button On_Off: The external request is set to TRUE following a rising edge on b External Request1 or b External Request2. A further rising edge resets the request to FALSE. e External Request Mode = e HVACExternal Request Mode_Button Off Delay. Following a rising edge on the input variable b External Request1 or b External Request2, the external request extends or sets the utilization time of the system in the respective stage by the time setting of t Off Delay1 or t Off Delay2. e External Request Mode = e HVACExternal Request Mode_Switch On_Off: The external request is active if b External Request1 or b External Request2 = TRUE. It is deactivated if b External Request1 or b External Request2 = FALSE. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 0. t Off Delay1: Time value for the extension of the system utilization time in stage 1. The extension of the utilization time can only be activated if e Mode External Request = 2. The variable is saved persistently. Preset to 30 min. t Off Delay2: Time value for the extension of the system utilization time in stage 2. The extension of the utilization time can only be activated if e Mode External Request = 2. The variable is saved persistently. Preset to 30 min. TF8000 Version: 1.3.0 365
## Page 366

Programming Behavior of the output value 366 Version: 1.3.0 TF8000
## Page 367

Programming TF8000 Version: 1.3.0 367
## Page 368

Programming 368 Version: 1.3.0 TF8000
## Page 369

Programming TF8000 Version: 1.3.0 369
## Page 370

Programming 370 Version: 1.3.0 TF8000
## Page 371

Programming TF8000 Version: 1.3.0 371
## Page 372

Programming 372 Version: 1.3.0 TF8000
## Page 373

Programming TF8000 Version: 1.3.0 373
## Page 374

Programming 374 Version: 1.3.0 TF8000
## Page 375

Programming TF8000 Version: 1.3.0 375
## Page 376

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.9 FB_HVACConvert Enum This function block converts an Enum into an integer value and vice versa. This conversion is particularly suitable for Enums that are used as VAR_IN_OUT variables on function blocks. VAR_INPUT p Enum : UDINT; udi Len Enum : UDINT; p Int : UDINT; udi Len Int : UDINT; p Enum: Address of the enum to be converted. The address is determined with the ADR operator. udi Len Enum: Number of bytes of which the data type Enum consists. The number is determined with the SIZEOF operator. p Int: Address the integer variable to be converted. The address is determined with the ADR operator. 376 Version: 1.3.0 TF8000
## Page 377

Programming udi Len Int: Number of bytes of which the data type Integer consists. The number is determined with the SIZEOF operator. VAR_OUTPUT b Error : BOOL; e Error Code : E_HVACError Codes; b Error: This output indicates with a TRUE that there is an error. (The number of bytes of which the data types Integer or Enum consist is wrong.) e Error Code: Supplies the error number [} 490] when the output b Error is set. The following errors can occur in this function block: e HVACError Codes_Error_LEN_Int (43), e HVACError Codes_Error_LEN_Enum (44) (see E_HVACError Codes [} 490]). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.10 FB_HVACEnthalpy This function block is used to calculate the dew point, the specific enthalpy and the absolute humidity. The temperature, the relative humidity and the barometric pressure are required for calculating these parameters. The enthalpy is a measure for the energy of a thermodynamic system. VAR_INPUT r Temperature : REAL; r Relative Humidity : REAL; r Barometric Pressure : REAL; r Temperature: Input for the temperature value [°C]. r Relative Humidity: Input for the relative humidity [%]. The value must equal or greater 1. r Barometric Pressure: Input for the air pressure [h Pa]. VAR_OUTPUT r Dew Point : REAL; r Enthalpy : REAL; r Absolute Humidity : REAL; r Rho : REAL; r Ypsilon : REAL; b Invalid Parameter : BOOL; r Dew Point: Dew point [°C ]. r Enthalpy: Enthalpy [k J / kg]. r Absolute Humidity: Absolute humidity [kg/kg]. The result must be multiplied by 1000 in order to obtain the absolute humidity in [g/kg]. r Rho: Density of moist air, which specifies the mixture as a mass in relation to the volume. The unit is [kg/ m³]. r Ypsilon: Specific volume per 1 kg of dry air. The unit is [m³/kg] dry air. TF8000 Version: 1.3.0 377
## Page 378

Programming b Invalid Parameter: Set to TRUE if the input variable r Relative Humidity or r Barometric Pressure is smaller than or equal to zero. H,x-diagram [www.air2000.de]: Example 1: r Temperature: = 20 °C r Relative Humidity:= 50% r Barometric Pressure:= 1013.15h Pa Results from the function block: r Dew Point:= 9.4°C r Enthalpy:= 38.6k J/kg r Absolute Humidity:= 0.0072kg/kg, converted to g/kg ==> 7.2 g/kg Example 2: r Temperature: = 25 °C r Relative Humidity:= 60% r Barometric Pressure:= 1013.15h Pa Results from the function block: r Dew Point:= 17°C r Enthalpy:= 55.6k J/kg r Absolute Humidity:= 0.0119kg/kg, converted to g/kg ==> 11.9 g/kg 378 Version: 1.3.0 TF8000
## Page 379

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.11 FB_HVACFixed Limit This function block represents a limit value switch, whose output signal is switched depending on the time delays t Delay High Limit / t Delay Low Limit, the mode b Mode Fixed Limit, the limit values r High Limit / r Low Limit and the input signal r Input Value. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r Input Value : REAL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: The default values of the VAR_IN_OUT variables are adopted with a rising edge at this input variable. b Enable: The function block is enabled if b Enable = TRUE. r Input Value: Input signal b Reset: Input for acknowledging the incorrect parameter entry via a rising edge. TF8000 Version: 1.3.0 379
## Page 380

Programming VAR_OUTPUT b Event : BOOL; b Edge High Limit : BOOL; b Edge Low Limit : BOOL; b Invalid Parameter : BOOL; b Event: Output signal, which is switched depending on the time delays t Delay High Limit / t Delay Low Limit, the mode b Mode Fixed Limit, the input signal r Input Value and the limit values r High Limit / r Low Limit. b Edge High Limit: Is TRUE for one PLC cycle after the input signal r Input Value has exceeded the variable r High Limit for the duration of t Delay High Limit. b Edge Low Limit: Is TRUE for one PLC cycle after the input signal r Input Value has undershot the variable r Low Limit for the duration of t Delay Low Limit. b Invalid Parameter: Indicates that an incorrect parameter is present at one of the variables r High Limit, r Low Limit, t Delay High Limit or t Delay High Limit. An incorrect parameter entry does not lead to a standstill of the block; see description of variables. After rectifying the incorrect parameter entry, the message b Invalid Parameter must be acknowledged via b Reset. VAR_IN_OUT b Mode Fixed Limit : BOOL; r High Limit : REAL; r Low Limit : REAL; t Delay High Limit : TIME; t Delay Low Limit : TIME; b Mode Fixed Limit: If b Mode Fixed Limit = TRUE then the output variable b Event becomes TRUE if the input signal r Input Value has exceeded the variable r High Limit for the duration of t Delay High Limit. If b Event = TRUE, then b Edge High Limit is set for one PLC cycle. If the input signal r Input Value undershoots the variable r Low Limit for the duration of t Delay Low Limit, then b Event becomes FALSE and b Edge Low Limit is set for one PLC cycle. If b Mode Fixed Limit = FALSE then the output variable b Event becomes TRUE if the input signal r Input Value has undershot the variable r Low Limit for the duration of t Delay Low Limit. If b Event = TRUE, then b Edge Low Limit is set for one PLC cycle. If the input signal r Input Value exceeds the variable r High Limit for the duration of t Delay High Limit, then b Event becomes FALSE and b Edge High Limit is set for one PLC cycle. The variable is saved persistently. Preset to 1. r High Limit: Upper limit value. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 22. r Low Limit: Lower limit value. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 18. t Delay High Limit: Switching delay [s] when the upper limit value is exceeded. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 1 s. t Delay Low Limit: Switching delay [s] when the lower limit value is undershot. If no correct variable value is present, then the last valid variable value, if one exists, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter will be set in the event of an incorrect parameter entry; the function block continues to work normally. The variable is saved persistently. Preset to 1 s. 380 Version: 1.3.0 TF8000
## Page 381

Programming Behavior of the output value Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.12 FB_HVACFreeze Protection Heater This function block is for the frost protection monitoring of an air heater in an air conditioning system. Frost protection monitoring takes place both on the air side via a frost protection thermostat and on the water side via a temperature sensor in the heater return flow. The frost protection program is activated if the return flow temperature of the air heater r Return Water Temp is lower than the limit value r Return Water Alarm Limit or if the input b Thermostat is FALSE = error. For each of these errors, the respective message b Alarm Return Water Temp and/or b Alarm Thermostat at the output of the function block is TRUE. Similarly, the output b Alarm Frost becomes TRUE and the activation of the frost protection program is indicated by a TRUE at the output variable b Frost Protection Running. In order to avoid the air heater freezing up when the frost protection is activated, the heater pump must be switched on and the heater valve compulsorily opened. In many systems this function is implemented not only on the software side, but for reasons of safety on the hardware side also by means of a relay circuit in TF8000 Version: 1.3.0 381
## Page 382

Programming the control cabinet. In the normal case the frost protection relay is self-latched, since the frost protection circuit is based on the quiescent current principle. Following a fault the frost protection relay is normally brought back to its self-latched state by a reset button on the control cabinet. This function is implemented automatically by means of a short pulse at the output b Hardware Reset. The condition for this is that the frost protection thermostat has returned to its normal state, the temperature in the return flow of the heater has reached the value of r Return Water Normal Limit and the time t Delay First Warning has elapsed. Once the system has restarted following an automatic reset, the timer t Monitoring After Reset is started. If another frost warning occurs during this time, the output b Alarm Frost becomes TRUE again. It is only possible to reset the frost alarm by means of a rising edge at the input b Reset. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Thermostat : BOOL; r Return Water Temp : REAL; b Ctrl Voltage : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Thermostat: signal from the frost protection thermostat. In the normal case TRUE. r Return Water Temp: water temperature in the return flow of the air heater. b Ctrl Voltage: control voltage monitor. If control voltage is present b Ctrl Voltage = TRUE. b Reset: Input for acknowledging the fault. VAR_OUTPUT by State : BYTE; b Frost Protec Running : BOOL; b Hardware Reset : BOOL; b Error General : BOOL; b Alarm Return Water Temp : BOOL; b Alarm Thermostat : BOOL; by Error : BYTE; b Invalid Parameter : BOOL; by State: Output of the state as a byte. by State.0:= b Frost Protec Running; by State.1:= b Hardware Reset; by State.2:= b Thermostat; by State.7:= b Ctrl Voltage; b Frost Protec Running: TRUE if the frost protection program is active. 382 Version: 1.3.0 TF8000
## Page 383

Programming b Hardware Reset: Output that indicates with a 1 s pulse that the frost protection relay is self-latched again following an error. b Error General: There is a general error. b Alarm Frost: TRUE if there is a frost warning. b Alarm Return Water Temp: The water temperature limit in the return flow of the air heater was undershot. b Alarm Thermostat: TRUE if there is an error in the frost protection thermostat. by Error: Output of the error as a byte. by Error.1:= b Invalid Parameter; by Error.2:= b Error General; by Error.3:= b Alarm Frost; by Error.4:= b Alarm Return Water Temp; by Error.5:= b Alarm Thermostat; b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT r Return Water Alarm Limit : REAL; r Return Water Normal Limit : REAL; t Delay Hardware Reset : TIME; t Monitoring After Reset : TIME; r Return Water Alarm Limit: The frost alarm is activated below the temperature value r Return Water Alarm Limit in the return flow of the air heater (0°C..22°C). The variable is saved persistently. r Return Water Normal Limit: The air heater returns to its normal state when the temperature is once again above b Return Water Normal Limit following the temperature having been undershot (0°C..70°C). The variable is saved persistently. t Delay Hardware Reset: Time that elapses, after input, between the input of the frost error and output of a reset pulse in order to return the system to normal operation. The variable is saved persistently. t Monitoring After Reset: Monitoring time after the first frost warning. The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 383
## Page 384

Programming 5.1.7.13 FB_HVACMUX_INT_8 This function block contains two different types of multiplexers, one each for the operation modes e HVACCtrl Mode_Auto or e HVACCtrl Mode_Manual. This selection is made with the help of the Enum e Ctrl Mode [} 489]. The following conditions must first be fulfilled for this: b Enable = TRUE AND b Error = FALSE If e Ctrl Mode = e HVACCtrl Mode_Auto, the variable b Direction determines whether the output variable i Value Number is incremented or decremented when using the input b Edge New Value. If b Direction = FALSE it is incremented, if b Direction = TRUE it is decremented. If e Ctrl Mode = e HVACCtrl Mode_Manual, the output i Value Number is determined by the variable i Manual Value. The variables i Number Of Values, b Edge New Value and b Direction are not taken into account in this operation mode. The output i Value Number always indicates the number of the variable i Value X, whose content is output in the output variable i Value Out. Examples of e Ctrl Mode = e HVACCtrl Mode_Auto - If b Direction = FALSE AND i Number Of Values = 7 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 4, then i Value Out = i Value4. If i Value Number = i Number Of Values(7) and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence i Value Out = i Value1. - If b Direction = TRUE AND i Number Of Values = 8 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 3, then i Value Out = i Value3. If i Value Number = 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(8) and hence i Value Out = i Value8. The start behavior of the outputs i Value Number and i Value Out is as follows: - If b Direction = FALSE AND i Number Of Values > 0, then i Value Number = 1 and i Value Out = i Value1. - If b Direction = TRUE AND i Number Of Values = 6, then i Number Of Values = 6 and i Value Out = i Value6. Examples of e Ctrl Mode = e HVACCtrl Mode_Manual - The value of i Value Number is determined by i Manual Value. If i Manual Value = 7 then i Value Number = 7, which then means that i Value Out = i Value7. The start behavior of the outputs i Value Number and i Value Out is as follows: - If i Manual Value = 13, then i Value Number = 13 and i Value Out = i Value13. 384 Version: 1.3.0 TF8000
## Page 385

Programming - If i Manual Value = 0, then i Value Number = 0 and i Value Out = 0. NOTICE A frequently changing variable may not be applied to the VAR_IN_OUT variables i Value1-8 if e Data Security Type = e HVACData Security Type_Persistent. This would lead to premature wear of the storage medium of the controller. If the VAR_IN_OUT variables i Value1-8 change frequently and are not to be stored persistently, then e Data Security Type must be e Data Security Type_Idle. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; i Number Of Values : INT; b Edge New Value : BOOL; b Direction : BOOL; e Ctrl Mode : E_HVACCtrl Mode; i Manual Value : INT; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then i Value Out and i Value Number are set constantly to 0. i Number Of Values: Indicates the number of variables i Value1-8 that can be output via i Value Out. If i Number Of Values = 8 is, then the output i Value Number varies between 1 and 8. The variables i Value1 to i Value8 are then taken into account for the output i Value Out (see Application [} 384]). i Number Of Values determines the start behavior of the outputs i Value Out and i Value Number, (see Application [} 384]). i Number Of Values is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. i Number Of Values must not fall below 1 and must not exceed 8. Otherwise an error is indicated by b Error = TRUE and the execution of the function block is stopped. b Edge New Value: i Value Number is incremented or decremented if there is a rising edge on b Edge New Value. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 6, then i Value Out = i Value6. If i Value Number = i Number Of Values and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence i Value Out = i Value1. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 6 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 5, then i Value Out = i Value5. If i Value Number = 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(6) and hence i Value Out = i Value6. b Edge New Value is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. TF8000 Version: 1.3.0 385
## Page 386

Programming b Direction: b Direction determines the control direction of the function block. b Direction = FALSE means that i Value Number increments from 1 to i Number Of Values in ascending form and thus determines the output value i Value Out (see Application [} 384]). b Direction = TRUE means that i Value Number decrements from i Number Of Values to 1 in descending form and thus determines the output value i Value Out (see Application [} 384]). b Direction is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. e Ctrl Mode: This enum specifies the operation mode of the function block (see E_HVACCtrl Mode [} 489]). If the operation mode e Ctrl Mode = e HVACCtrl Mode_Auto, then the variable i Manual Value is not taken into account. If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual, then the variables i Number Of Values, b Edge New Value and b Direction are not taken into account. i Manual Value: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual AND b Enable = TRUE AND b Error = FALSE AND i Manual Value = 15, then i Value Number = 15. The contents of the variable i Value15 are then output via i Value Out (see Application [} 384]). i Manual Value is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Value Number is determined by i Manual Value. i Manual Value should lie within the range of 0 to 16. If i Manual Value falls below the value 0, then 0 is output via i Value Number. If i Manual Value exceeds the value 16, then 16 is output via i Value Number. If i Manual Value = 0, then i Value Number = 0 and i Value Out = 0. VAR_OUTPUT i Value Out : INT; b Active : BOOL; b Edge New Value Out : BOOL; i Value Number : INT; b Error : BOOL; e Error Code : E_HVACError Codes; i Value Out: The value of the variable i Value1-8 is output via i Value Out. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 6, then i Value Out = i Value6. If i Value Number = i Number Of Values and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence i Value Out = i Value1. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 7 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 5, then i Value Out = i Value5. If i Value Number = 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(7) and hence i Value Out = i Value7. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual, then the value of i Value Number is determined by i Manual Value. If i Manual Value = 7 then i Value Number = 7, which then means that i Value Out = i Value7. The start behavior of the output i Value Out is as follows: if b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0, then i Value Number = 1 and i Value Out = i Value1. - e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 7, then i Number Of Values = 7 and i Value Out = i Value7. - e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 13, then i Value Number = 13 and i Value Out = i Value13. - e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 0, then i Value Number = 0 and i Value Out = 0. b Active: b Active goes TRUE if 1. b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto. 2. b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value > 0. b Edge New Value Out: Is TRUE for one PLC cycle if b Enable = TRUE AND b Error = FALSE AND i Value Number changes its value. 386 Version: 1.3.0 TF8000
## Page 387

Programming i Value Number: The output i Value Number always indicates the number of the variable i Value X, whose content is output in the output variable i Value Out. If e Ctrl Mode = e HVACCtrl Mode_Auto, the variable b Direction determines whether the output variable i Value Number is incremented or decremented when using the input b Edge New Value. If b Direction = FALSE it is incremented, if b Direction = TRUE it is decremented. If e Ctrl Mode = e HVACCtrl Mode_Manual the value of i Value Number is determined by i Manual Value. b Error: The output signals with a TRUE that there is an error and that there is a wrong parameter on the variable i Number Of Values. i Value Out and i Value Number are set constantly to 0 and the Enum e Error Code indicate the error code. The message b Error does not have to be acknowledged after rectification of the error. e Error Code: Supplies the error number [} 490] when the output b Error is set. The following error can occur in this function block: e HVACError Codes_Invalid Param_i Number Of Values: There is an incorrect value on i Number Of Values. i Number Of Values must not fall below 1 and must not exceed 8. To access the enum error numbers in the PLC, e Error Code can be assigned to a variable of the data type WORD. e HVACError Codes_Invalid Param_i Number Of Values = 42 VAR_IN_OUT i Value1-8 : INT; i Value1-8: The value of the output variable i Value Out is determined by the variables i Value1 to i Value8. If i Value Number = 6, then i Value Out = i Value6. If i Number Of Values = 8 is, then the output i Value Number varies between 1 and 8. The variables i Value1 to i Value8 are then taken into account for the output i Value Out if the operation mode e Ctrl Mode = e HVACCtrl Mode_Auto (see Application [} 384]). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 387
## Page 388

Programming 5.1.7.14 FB_HVACMUX_INT_16 This function block contains two different types of multiplexers, one each for the operation modes e HVACCtrl Mode_Auto or e HVACCtrl Mode_Manual. This selection is made with the help of the Enum e Ctrl Mode [} 489]. The following conditions must first be fulfilled for this: b Enable = TRUE AND b Error = FALSE If e Ctrl Mode = e HVACCtrl Mode_Auto, the variable b Direction determines whether the output variable i Value Number is incremented or decremented when using the input b Edge New Value. If b Direction = FALSE it is incremented, if b Direction = TRUE it is decremented. If e Ctrl Mode = e HVACCtrl Mode_Manual, the output i Value Number is determined by the variable i Manual Value. The variables i Number Of Values, b Edge New Value and b Direction are not taken into account in this operation mode. The output i Value Number always indicates the number of the variable i Value X, whose content is output in the output variable i Value Out. Examples of e Ctrl Mode = e HVACCtrl Mode_Auto - If b Direction = FALSE AND i Number Of Values = 12 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 6, then i Value Out = i Value6. If i Value Number = i Number Of Values(12) and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence i Value Out = i Value1. - If b Direction = TRUE AND i Number Of Values = 8 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 5, then i Value Out = i Value5. If i Value Number = 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(8) and hence i Value Out = i Value8. The start behavior of the outputs i Value Number and i Value Out is as follows: - If b Direction = FALSE AND i Number Of Values > 0, then i Value Number = 1 and i Value Out = i Value1. 388 Version: 1.3.0 TF8000
## Page 389

Programming - If b Direction = TRUE AND i Number Of Values = 12, then i Number Of Values = 12 and i Value Out = i Value12. Examples of e Ctrl Mode = e HVACCtrl Mode_Manual - The value of i Value Number is determined by i Manual Value. If i Manual Value = 7 then i Value Number = 7, which then means that i Value Out = i Value7. The start behavior of the outputs i Value Number and i Value Out is as follows: - If i Manual Value = 13, then i Value Number = 13 and i Value Out = i Value13. - If i Manual Value = 0, then i Value Number = 0 and i Value Out = 0. NOTICE A frequently changing variable may not be applied to the VAR_IN_OUT variables i Value1-8 if e Data Security Type = e HVACData Security Type_Persistent. This would lead to premature wear of the storage medium of the controller. If the VAR_IN_OUT variables i Value1-8 change frequently and are not to be stored persistently, then e Data Security Type must be e Data Security Type_Idle. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; i Number Of Values : INT; b Edge New Value : BOOL; b Direction : BOOL; e Ctrl Mode : E_HVACCtrl Mode; i Manual Value : INT; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then i Value Out and i Value Number are set constantly to 0. i Number Of Values: Indicates the number of variables i Value1-16 that can be output via i Value Out. If i Number Of Values = 8 is, then the output i Value Number varies between 1 and 8. The variables i Value1 to i Value8 are then taken into account for the output i Value Out (see Application [} 388]). i Number Of Values determines the start behavior of the outputs i Value Out and i Value Number. i Number Of Values is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual (see Application [} 388]). i Number Of Values must not fall below 1 and must not exceed 16. Otherwise an error is indicated by b Error = TRUE and the execution of the function block is stopped. b Edge New Value: i Value Number is incremented or decremented if there is a rising edge on b Edge New Value. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0 and there is a rising edge on b Edge New Value, then i Value Number is TF8000 Version: 1.3.0 389
## Page 390

Programming incremented. If i Value Number = 6, then i Value Out = i Value6. If i Value Number = i Number Of Values and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence i Value Out = i Value1. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 12 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 5, then i Value Out = i Value5. If i Value Number = 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(12) and hence i Value Out = i Value6. b Edge New Value is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. b Direction: b Direction determines the control direction of the function block. b Direction = FALSE means that i Value Number increments from 1 to i Number Of Values in ascending form and thus determines the output value i Value Out (see Application [} 388]). b Direction = TRUE means that i Value Number decrements from i Number Of Values to 1 in descending form and thus determines the output value i Value Out (see Application [} 388]). b Direction is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. e Ctrl Mode: The operation mode of the function block is specified by means of this Enum. If the operation mode e Ctrl Mode = e HVACCtrl Mode_Auto, then the variable i Manual Value is not taken into account (see E_HVACCtrl Mode [} 489]). If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual, then the variables i Number Of Values, b Edge New Value and b Direction are not taken into account. i Manual Value: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual AND b Enable = TRUE AND b Error = FALSE AND i Manual Value = 15, then i Value Number = 15. The contents of the variable i Value15 are then output via i Value Out (see Application [} 388]). i Manual Value is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Value Number is determined by i Manual Value. i Manual Value should lie within the range of 0 to 16. If i Manual Value falls below the value 0, then 0 is output via i Value Number. If i Manual Value exceeds the value 16, then 16 is output via i Value Number. If i Manual Value = 0, then i Value Number = 0 and i Value Out = 0. VAR_OUTPUT i Value Out : INT; b Active : BOOL; b Edge New Value Out : BOOL; i Value Number : INT; b Error : BOOL; e Error Code : E_HVACError Codes; i Value Out: The value of the variable i Value1-16 is output via i Value Out. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 6, then i Value Out = i Value6. If i Value Number = i Number Of Values and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence i Value Out = i Value1. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 12 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 5, then i Value Out = i Value5. If i Value Number = 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(12) and hence i Value Out = i Value7. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual, then the value of i Value Number is determined by i Manual Value. If i Manual Value = 7 then i Value Number = 7, which then means that i Value Out = i Value7. The start behavior of the output i Value Out is as follows: if b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0, then i Value Number = 1 and i Value Out = i Value1. - e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 12, then i Number Of Values = 12 and i Value Out = i Value12. - e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 13, then i Value Number = 13 and i Value Out = i Value13. - e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 0, then i Value Number = 0 and i Value Out = 0. b Active: b Active goes TRUE if 1. b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto. 390 Version: 1.3.0 TF8000
## Page 391

Programming 2. b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value > 0. b Edge New Value Out: Is TRUE for one PLC cycle if b Enable = TRUE AND b Error = FALSE AND i Value Number changes its value. i Value Number: The output i Value Number always indicates the number of the variable i Value X, whose content is output in the output variable i Value Out. If e Ctrl Mode = e HVACCtrl Mode_Auto, the variable b Direction determines whether the output variable i Value Number is incremented or decremented when using the input b Edge New Value. If b Direction = FALSE it is incremented, if b Direction = TRUE it is decremented. If e Ctrl Mode = e HVACCtrl Mode_Manual the value of i Value Number is determined by i Manual Value. b Error: The output signals with a TRUE that there is an error and that there is a wrong parameter on the variable i Number Of Values. i Value Out and i Value Number are set constantly to 0 and the Enum e Error Code indicate the error code. The message b Error does not have to be acknowledged after rectification of the error. e Error Code: Supplies the error number [} 490] when the output b Error is set. The following error can occur in this function block: e HVACError Codes_Invalid Param_i Number Of Values: There is an incorrect value on i Number Of Values. i Number Of Values must not fall below 1 and must not exceed 8. To access the enum error number in the PLC e Error Code can assigned to a variable of data type WORD. e HVACError Codes_Invalid Param_i Number Of Values = 42 VAR_IN_OUT i Value1-16 : INT; i Value1-16: The value of the output variable i Value Out is determined by the variables i Value1 to i Value16. If i Value Number = 6, then i Value Out = i Value6. If i Number Of Values = 8 is, then the output i Value Number varies between 1 and 8. The variables i Value1 to i Value8 are then taken into account for the output i Value Out if the operation mode e Ctrl Mode = e HVACCtrl Mode_Auto (see Application [} 388]). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 391
## Page 392

Programming 5.1.7.15 FB_HVACMUX_REAL_8 This function block contains two different types of multiplexers, one each for the operation modes e HVACCtrl Mode_Auto or e HVACCtrl Mode_Manual. This selection is made with the help of the Enum e Ctrl Mode [} 489]. The following conditions must first be fulfilled for this: b Enable = TRUE AND b Error = FALSE If e Ctrl Mode = e HVACCtrl Mode_Auto, the variable b Direction determines whether the output variable i Value Number is incremented or decremented when using the input b Edge New Value. If b Direction = FALSE it is incremented, if b Direction = TRUE it is decremented. If e Ctrl Mode = e HVACCtrl Mode_Manual, the output i Value Number is determined by the variable i Manual Value. The variables i Number Of Values, b Edge New Value and b Direction are not taken into account in this operation mode. The output i Value Number always indicates the number of the variable i Value X, whose content is output in the output variable i Value Out. Examples of e Ctrl Mode = e HVACCtrl Mode_Auto - If b Direction = FALSE AND i Number Of Values = 7 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 4, then r Value Out = i Value4. If i Value Number= i Number Of Values(7) and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence r Value Out = r Value1. - If b Direction = TRUE AND i Number Of Values = 8 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 3, then r Value Out = r Value3. If i Value Number= 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(8) and hence r Value Out = r Value8. The start behavior of the outputs i Value Number and r Value Out is as follows: - If b Direction = FALSE AND i Number Of Values > 0, then i Value Number = 1 and r Value Out = r Value1. - If b Direction = TRUE AND i Number Of Values = 6, then i Number Of Values = 6 and r Value Out = r Value6. Examples of e Ctrl Mode = e HVACCtrl Mode_Manual - The value of i Value Number is determined by i Manual Value. If i Manual Value = 7 then i Value Number = 7, which then means that r Value Out = r Value7. The start behavior of the outputs i Value Number and r Value Out is as follows: - If i Manual Value = 13, then i Value Number = 13 and r Value Out = r Value13. 392 Version: 1.3.0 TF8000
## Page 393

Programming - If i Manual Value = 0, then i Value Number = 0 and r Value Out = 0. NOTICE A frequently changing variable may not be applied to the VAR_IN_OUT variables r Value1-n if e Data Security Type = e HVACData Security Type_Persistent. This would lead to premature wear of the storage medium of the controller. If the VAR_IN_OUT variables r Value1-n change frequently and are not to be stored persistently, then e Data Security Type must be e Data Security Type_Idle. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; i Number Of Values : INT; b Edge New Value : BOOL; b Direction : BOOL; e Ctrl Mode : E_HVACCtrl Mode; i Manual Value : INT; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then r Value Out and i Value Number are set constantly to 0. i Number Of Values: Indicates the number of variables r Value1-8 that can be output via r Value Out. If i Number Of Values = 8 is, then the output i Value Number varies between 1 and 8. The variables r Value1 to r Value8 are then taken into account for the output r Value Out (see Application [} 392]). i Number Of Values determines the start behavior of the outputs r Value Out and i Value Number, (see Application [} 392]). i Number Of Values is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. i Number Of Values must not fall below 1 and must not exceed 8. Otherwise an error is indicated by b Error = TRUE and the execution of the function block is stopped. b Edge New Value: i Value Number is incremented or decremented if there is a rising edge on b Edge New Value. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 6, then r Value Out = r Value6. If i Value Number= i Number Of Values and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence r Value Out = r Value1. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 6 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 5, then r Value Out = r Value5. If i Value Number= 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(6) and hence r Value Out = r Value6. b Edge New Value is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. TF8000 Version: 1.3.0 393
## Page 394

Programming b Direction: b Direction determines the control direction of the function block. b Direction = FALSE means that i Value Number increments from 1 to i Number Of Values in ascending form and thus determines the output value r Value Out (see Application [} 392]). b Direction = TRUE means that i Value Number decrements from i Number Of Values to 1 in descending form and thus determines the output value r Value Out (see Application [} 392]). b Direction is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. e Ctrl Mode: This enum specifies the operation mode of the function block (see E_HVACCtrl Mode [} 489]). If the operation mode e Ctrl Mode = e HVACCtrl Mode_Auto, then the variable i Manual Value is not taken into account. If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual, then the variables i Number Of Values, b Edge New Value and b Direction are not taken into account. i Manual Value: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual AND b Enable = TRUE AND b Error = FALSE AND i Manual Value = 15, then i Value Number = 15. The contents of the variable r Value15 are then output via r Value Out (see Application [} 392]). i Manual Value is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Value Number is determined by i Manual Value. i Manual Value should lie within the range of 0 to 16. If i Manual Value falls below the value 0, then 0 is output via i Value Number. If i Manual Value exceeds the value 16, then 16 is output via i Value Number. If i Manual Value = 0, then i Value Number = 0 and r Value Out = 0. VAR_OUTPUT r Value Out : INT; b Active : BOOL; b Edge New Value Out : BOOL; i Value Number : INT; b Error : BOOL; e Error Code : E_HVACError Codes; r Value Out: The value of the variable r Value1-8 is output via r Value Out. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 6, then r Value Out = r Value6. If i Value Number= i Number Of Values and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence r Value Out = r Value1. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 7 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 5, then r Value Out = r Value5. If i Value Number= 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(7) and hence r Value Out = r Value7. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual, then the value of i Value Number is determined by i Manual Value. If i Manual Value = 7 then i Value Number = 7, which then means that r Value Out = r Value7. The start behavior of the output r Value Out is as follows: if b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0, then i Value Number = 1 and r Value Out = r Value1. - e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 7, then i Number Of Values = 7 and r Value Out = r Value7. - e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 13, then i Value Number = 13 and r Value Out = r Value13. - e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 0, then i Value Number = 0 and r Value Out = 0. b Active: b Active goes TRUE if 1. b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto. 2. b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value > 0. b Edge New Value Out: Is TRUE for one PLC cycle if b Enable = TRUE AND b Error = FALSE AND i Value Number changes its value. 394 Version: 1.3.0 TF8000
## Page 395

Programming i Value Number: The output i Value Number always indicates the number of the variable r Value X, whose content is output in the output variable r Value Out. If e Ctrl Mode = e HVACCtrl Mode_Auto, the variable b Direction determines whether the output variable i Value Number is incremented or decremented when using the input b Edge New Value. If b Direction = FALSE it is incremented, if b Direction = TRUE it is decremented. If e Ctrl Mode = e HVACCtrl Mode_Manual the value of i Value Number is determined by i Manual Value. b Error: The output signals with a TRUE that there is an error and that there is a wrong parameter on the variable i Number Of Values. r Value Out and i Value Number are set constantly to 0 and the Enum e Error Code indicate the error code. The message b Error does not have to be acknowledged after rectification of the error. e Error Code: Supplies the error number [} 490] when the output b Error is set. The following error can occur in this function block: e HVACError Codes_Invalid Param_i Number Of Values: There is an incorrect value on i Number Of Values. i Number Of Values must not fall below 1 and must not exceed 8. To access the enum error numbers in the PLC, e Error Code can be assigned to a variable of the data type WORD. e HVACError Codes_Invalid Param_i Number Of Values = 42 VAR_IN_OUT r Value1-8 : INT; r Value1-8: The value of the output variable r Value Out is determined by the variables r Value1 to r Value8. If i Value Number = 6, then r Value Out = i Value6. If i Number Of Values = 8 is, then the output i Value Number varies between 1 and 8. The variables r Value1 to r Value8 are then taken into account for the output r Value Out if the operation mode e Ctrl Mode = e HVACCtrl Mode_Auto (see Application [} 392]). The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 395
## Page 396

Programming 5.1.7.16 FB_HVACMUX_REAL_16 This function block contains two different types of multiplexers, one each for the operation modes e HVACCtrl Mode_Auto or e HVACCtrl Mode_Manual. This selection is made with the help of the Enum e Ctrl Mode [} 489]. The following conditions must first be fulfilled for this: b Enable = TRUE AND b Error = FALSE If e Ctrl Mode = e HVACCtrl Mode_Auto, the variable b Direction determines whether the output variable i Value Number is incremented or decremented when using the input b Edge New Value. If b Direction = FALSE it is incremented, if b Direction = TRUE it is decremented. If e Ctrl Mode = e HVACCtrl Mode_Manual, the output i Value Number is determined by the variable i Manual Value. The variables i Number Of Values, b Edge New Value and b Direction are not taken into account in this operation mode. The output i Value Number always indicates the number of the variable i Value X, whose content is output in the output variable i Value Out. Examples of e Ctrl Mode = e HVACCtrl Mode_Auto - If b Direction = FALSE AND i Number Of Values = 12 and there is a rising edge on b Edge New Value, then i Value Number increments. If i Value Number = 6, then r Value Out = r Value6. If i Value Number= i Number Of Values(12) and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence r Value Out = r Value1. - If b Direction = TRUE AND i Number Of Values = 8 and there is a rising edge on b Edge New Value, then i Value Number decrements. If r Value Number = 5, then r Value Out = r Value5. If i Value Number= 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(8) and hence r Value Out = r Value8. The start behavior of the outputs i Value Number and r Value Out is as follows: - If b Direction = FALSE AND i Number Of Values > 0, then i Value Number = 1 and hence r Value Out = r Value1. 396 Version: 1.3.0 TF8000
## Page 397

Programming - If b Direction = TRUE AND i Number Of Values = 12, then i Number Of Values = 12 and hence r Value Out = r Value12. Examples of e Ctrl Mode = e HVACCtrl Mode_Manual - The value of i Value Number is determined by i Manual Value. If i Manual Value = 7 then i Value Number = 7, which then means that r Value Out = r Value7. The start behavior of the outputs i Value Number and r Value Out is as follows: - If i Manual Value = 13, then i Value Number = 13 and r Value Out = r Value13. - If i Manual Value = 0, then i Value Number = 0 and r Value Out = 0. NOTICE A frequently changing variable may not be applied to the VAR_IN_OUT variables r Value1-n if e Data Security Type = e HVACData Security Type_Persistent. This would lead to premature wear of the storage medium of the controller. If the VAR_IN_OUT variables r Value1-n change frequently and are not to be stored persistently, then e Data Security Type must be e Data Security Type_Idle. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; i Number Of Values : INT; b Edge New Value : BOOL; b Direction : BOOL; e Ctrl Mode : E_HVACCtrl Mode; i Manual Value : INT; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then r Value Out and i Value Number are set constantly to 0. i Number Of Values: Indicates the number of variables r Value1-16 that can be output via r Value Out. If i Number Of Values = 8 is, then the output i Value Number varies between 1 and 8. The variables r Value1 to r Value8 are then taken into account for the output r Value Out (see Application [} 396]). i Number Of Values determines the start behavior of the outputs r Value Out and i Value Number, (see Application [} 396]). i Number Of Values is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. i Number Of Values must not fall below 1 and must not exceed 16. Otherwise an error is indicated by b Error = TRUE and the execution of the function block is stopped. b Edge New Value: i Value Number is incremented or decremented if there is a rising edge on b Edge New Value. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE TF8000 Version: 1.3.0 397
## Page 398

Programming AND i Number Of Values > 0 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 6, then r Value Out = r Value6. If i Value Number= i Number Of Values and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence r Value Out = r Value1. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 12 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 5, then r Value Out = r Value5. If i Value Number= 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(12) and hence r Value Out = r Value12. b Edge New Value is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. b Direction: b Direction determines the control direction of the function block. b Direction = FALSE means that i Value Number increments from 1 to i Number Of Values in ascending form and thus determines the output value r Value Out (see Application [} 396]). b Direction = TRUE means that i Value Number decrements from i Number Of Values to 1 in descending form and thus determines the output value r Value Out (see Application [} 396]). b Direction is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. e Ctrl Mode: This enum specifies the operation mode of the function block (see E_HVACCtrl Mode [} 489]). If the operation mode e Ctrl Mode = e HVACCtrl Mode_Auto, then the variable i Manual Value is not taken into account. If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual, then the variables i Number Of Values, b Edge New Value and b Direction are not taken into account. i Manual Value: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual AND b Enable = TRUE AND b Error = FALSE AND i Manual Value = 15, then i Value Number = 15. The contents of the variable r Value15 are then output via r Value Out (see Application [} 396]). i Manual Value is not taken into account in the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Value Number is determined by i Manual Value. i Manual Value should lie within the range of 0 to 16. If i Manual Value falls below the value 0, then 0 is output via i Value Number. If i Manual Value exceeds the value 16, then 16 is output via i Value Number. If i Manual Value = 0, then i Value Number = 0 and r Value Out = 0. VAR_OUTPUT r Value Out : REAL; b Active : BOOL; b Edge New Value Out : BOOL; i Value Number : INT; b Error : BOOL; e Error Code : E_HVACError Codes; r Value Out: The value of the variable r Value1-16 is output via r Value Out. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0 and there is a rising edge on b Edge New Value, then i Value Number is incremented. If i Value Number = 6, then r Value Out = r Value6. If i Value Number= i Number Of Values and there is a rising edge on b Edge New Value, then i Value Number = 1 and hence r Value Out = r Value1. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 12 and there is a rising edge on b Edge New Value, then i Value Number is decremented. If i Value Number = 5, then r Value Out = r Value5. If i Value Number= 1 and there is a rising edge on b Edge New Value, then i Value Number = i Number Of Values(12) and hence r Value Out = r Value12. If b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual, then the value of i Value Number is determined by i Manual Value. If i Manual Value = 7 then i Value Number = 7, which then means that r Value Out = r Value7. The start behavior of the output r Value Out is as follows: if b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND i Number Of Values > 0, then i Value Number = 1 and r Value Out = r Value1. - e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND i Number Of Values = 12, then i Number Of Values = 12 and r Value Out = r Value12. - e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 13, then i Value Number = 13 and r Value Out = r Value13. - e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 0, then i Value Number = 0 and r Value Out = 0. b Active: b Active goes TRUE if 1. b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Auto. 398 Version: 1.3.0 TF8000
## Page 399

Programming 2. b Enable = TRUE AND b Error = FALSE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value > 0. b Edge New Value Out: Is TRUE for one PLC cycle if b Enable = TRUE AND b Error = FALSE AND i Value Number changes its value. i Value Number: The output i Value Number always indicates the number of the variable r Value X, whose content is output in the output variable r Value Out. If e Ctrl Mode = e HVACCtrl Mode_Auto, the variable b Direction determines whether the output variable i Value Number is incremented or decremented when using the input b Edge New Value. If b Direction = FALSE it is incremented, if b Direction = TRUE it is decremented. If e Ctrl Mode = e HVACCtrl Mode_Manual the value of i Value Number is determined by i Manual Value. b Error: The output signals with a TRUE that there is an error and that there is a wrong parameter on the variable i Number Of Values. r Value Out and i Value Number are set constantly to 0 and the Enum e Error Code indicate the error code. The message b Error does not have to be acknowledged after rectification of the error. e Error Code: Supplies the error number [} 490] when the output b Error is set. The following error can occur in this function block: e HVACError Codes_Invalid Param_i Number Of Values: There is an incorrect value on i Number Of Values. i Number Of Values must not fall below 1 and must not exceed 16. To access the enum error number in the PLC e Error Code can assigned to a variable of data type WORD. e HVACError Codes_Invalid Param_i Number Of Values = 42 VAR_IN_OUT r Value1-16 : REAL; r Value1-16: The value of the output variable r Value Out is determined by the variables r Value1 to r Value16. If i Value Number = 6, then r Value Out = i Value6. If i Number Of Values = 8 is, then the output i Value Number varies between 1 and 8. The variables r Value1 to r Value8 are then taken into account for the output r Value Out if the operation mode e Ctrl Mode = e HVACCtrl Mode_Auto (see Application [} 396]). The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.17 FB_HVACOverwrite Analog This function block overrides the input r Value In if e Ctrl Mode = e HVACCtrl Mode_Manual and forwards r Manual Value In to the output r Value Out. VAR_INPUT r Value In :REAL; e Ctrl Mode :E_HVACCtrl Mode; r Manual Value In :REAL; r Value In: Analog input value that is forwarded to the output r Value Out if e Ctlr Mode = e HVACCtrl Mode_Auto. e Ctrl Mode: The operation mode is selected via this enum (see E_HVACCtrl Mode [} 489]). Manual or automatic operation mode. TF8000 Version: 1.3.0 399
## Page 400

Programming r Manual Value In: Analog manual input value that is forwarded to the output r Value Out if e Ctrl Mode = e HVACCtrl Mode_Manual. VAR_OUTPUT r Value Out :REAL; r Value Out: Analog output value. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.18 FB_HVACOverwrite Digital This function block overrides the state of the input b In if e Ctrl Mode = e HVACCtrl Mode_Manual and forwards it to the output b Out. VAR_INPUT b In :BOOL; e Ctrl Mode :E_HVACCtrl Mode; b Manual In :BOOL; b In: Digital input variable whose state is forwarded to the output b Out if e Ctlr Mode = e HVACCtrl Mode_Auto. e Ctrl Mode: The operation mode is selected via this enum (see E_HVACCtrl Mode [} 489]). Manual or automatic operation mode. b Manual In: Digital input variable whose state is forwarded to the output b Out if e Ctlr Mode = e HVACCtrl Mode_Manual. VAR_OUTPUT b Out :BOOL; b Out:Digital output variable. . Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 400 Version: 1.3.0 TF8000
## Page 401

Programming 5.1.7.19 FB_HVACPower Measurement KL3403 This function block serves to control a 3-phase power measurement terminal (KL/KS3403). The terminal data is read out and all variables that depend on it are derived. The Bus Terminal KL3403 enables the measurement of all relevant electrical data of the supply network. The voltage is measured via the direct connection of L1, L2, L3 and N. The current of the three phases L1, L2 and L3 is fed via simple current transformers. All measured currents and voltages are available as RMS values. In the KL3403 version, the active power and the energy consumption for each phase are calculated. Through the relationship of the RMS values of voltage U, current I and the active power P, all other information such as apparent power or phase shift angle cos φ can be derived. For each fieldbus, KL3403 provides a comprehensive network analysis and an energy management option. The data is read out in 8 groups one after the other. Dependent values are calculated cyclically. The energy measurement is read out from the terminal as a 32-bit value with the overflow from register 1. The input b Del Energy Consumption can be used to delete this value. The results of the power measurement are available in the output structure ST_HVACPower Measurement. The structure is 120 bytes long. The input and output variables w Data L1, w Data L2, w Data L3, by SBL1, by SBL2, by SBL3, by CBL1, by CBL2, by CBL3, i Data Out L1, i Data Out L2 and i Data Out L3 must be linked with the KL3403 Bus Terminal. They are needed in order to obtain all the data from the terminal. TYPE ST_HVACPower Measurement STRUCT di IL1, di IL2, di IL3 : DINT; A Ieff Auflösung: 0,1 A di UL1, di UL2, di UL3 : DINT; V Ueff Auflösung: 0,1 V di PL1, di PL2, di PL3 : DINT; k W Pw pro Phase Auflösung: 0,1 k W di Pg : DINT; k W Pges Auflösung: 0,1 k W di Cos Phi L1, di Cos Phi L2, di Cos Phi L3 : DINT; cos Phi pro Phase Auflösung: 0,01 di Cos Phi : DINT; cos Phiges Auflösung: 0,01 di WL1, di WL2, di WL3 : DINT; k Wh Energieverbrauch Auflösung: 1 k Wh di Wg : DINT; k Wh Energieverbrauch Auflösung: 1 k Wh di Imax L1, di Imax L2, di Imax L3 : DINT; A Imax Auflösung: 0,1 A di Umax L1, di Umax L2, di Umax L3 : DINT; V Umax Auflösung: 0,1 V di Pmax L1, di Pmax L2, di Pmax L3 : DINT; k W Pmax Auflösung: 0,1 k W di Sg : DINT; k VA Sges Auflösung: 0,1 k VA di Qg : DINT; kvar Qges Auflösung: 0,1 kvar dummy : DINT; Reserve, füllt die Struktur auf 120Bytes auf END_STRUCT VAR_INPUT w Data L1, w Data L2, w Data L3 : WORD; by SBL1, by SBL2, by SBL3 : BYTE; di Curr Trans Factor : DINT; e Mode Power Measurement : E_HVACPower Measurement Mode; b Del Energy Consumption : BOOL; w Data Lx: Input data from the three channels of the KL3403. by SBLx: Status byte of the three channels of the KL3403. Reports which value can be read via the input (w Data Lx). TF8000 Version: 1.3.0 401
## Page 402

Programming di Curr Trans Factor: Transformation factor of the current transformer, used for conversion to the actual string current and the associated values. Since the final measured value is always dec. 1000 (100.0%) irrespective of the terminal type, the primary end value of the transformer must be specified for the factor. Example with KL3403-0000: A 400/1A transformer produces a di Curr Trans Factor of 400. With an internal resolution of 0.001 A, a measured value of max. 1 A results in an end value of dec. 1000 (100.0%) * di Curr Trans Factor = 400A. Example with KL3403-0010: A 400/5A transformer produces a di Curr Trans Factor of 400. With an internal resolution of 0.005 A, a measured value of max. 5 A results in an end value of dec. 1000 (100.0%) * di Curr Trans Factor = 400A. e Mode Power Measurement: If the value of this parameter lies between 1 and 8, the automatic read-out of all data is interrupted. Only the corresponding selected measured variable is read per cycle (see E_HVACPower Measurement Mode [} 491]). TYPE E_HVACPower Measurement Mode : ( e HVACPower Measurement Mode_Auto All Values := 0, e HVACPower Measurement Mode_Current := 1, e HVACPower Measurement Mode_Voltage := 2, e HVACPower Measurement Mode_Effective Power := 3, e HVACPower Measurement Mode_Power Factor := 4, e HVACPower Measurement Mode_Energy Consumption := 5, e HVACPower Measurement Mode_Peak Current Valu := 6, 1) e HVACPower Measurement Mode_Peak Voltage Value := 7, 1) e HVACPower Measurement Mode_Peak Power Value := 81) ); END_TYPE b Del Energy Consumption: A positive edge at this input deletes the energy consumption in the EEPROM. The energy consumption is counted in RAM and saved every 15 minutes in the EEPROM. It is retained there even if the KL3403 is switched off. 1) The minimum and peak values are deleted when the KL3403 is switched off. VAR_OUTPUT b Del Energy Measured Values Busy : BOOL; b Error : BOOL; i Err ID : UDINT; by CBL1, by CBL2, by CBL3 : BYTE; i Data Out L1, i Data Out L2, i Data Out L3 : INT; st Q_Power Measurement : ST_HVACPower Measurement; b Del Energy Measured Values Busy: Since the measured energy values have to be deleted from the internal EEPROM, no value is refreshed during this time and the variable b Del Energy Measured Values Busy indicates TRUE. b Error: If TRUE, an error has occurred in the register communication. i Err ID: Error ID in the register communication 0x100 Timeout error. The time permitted for execution has been exceeded. 0x200 Parameter error (e.g. an invalid register number). 0x300 The read value differs from the written value (write access to this register may not be enabled or have failed) by CBLx: This output serves the selection of the desired input value and register communication in order to delete the energy consumption. i Data Out Lx: This output serves the register communication in order to delete the energy consumption. st Q_Power Measurement: The results of the power measurement as an output data structure (see ST_HVACPower Measurement [} 496]). 402 Version: 1.3.0 TF8000
## Page 403

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.20 FB_HVACPower Measurement KL3403Ex This function block serves to control a 3-phase power measurement terminal (KL/KS3403). The terminal data is read out and all variables that depend on it are derived. The Bus Terminal KL3403 enables the measurement of all relevant electrical data of the supply network. The voltage is measured via the direct connection of L1, L2, L3 and N. The current of the three phases L1, L2 and L3 is fed via simple current transformers. All measured currents and voltages are available as RMS values. In the KL3403 version, the active power and the energy consumption for each phase are calculated. Through the relationship of the RMS values of voltage U * current I and the active power P, all other information such as apparent power or phase shift angle cos φ can be derived. For each fieldbus, KL3403 provides a comprehensive network analysis and an energy management option. The data is read out in 8 groups one after the other. Dependent values are calculated cyclically. The energy measurement is read out from the terminal as a 32-bit value with the overflow from register 1. The input b Del Energy Consumption can be used to delete this value. The results of the power measurement are available in the output structure ST_HVACPower Measurement Ex. The difference compared with the previous function block FB_HVACPower Measurement KL3403 lies in the output format for the results. The results are available in the structure ST_HVACPower Measurement Ex in LREAL format. The output was extended by the frequencies of the three phases. The input and output variables w Data L1, w Data L2, w Data L3, by SBL1, by SBL2, by SBL3, by CBL1, by CBL2, by CBL3, i Data Out L1, i Data Out L2 and i Data Out L3 must be linked with the KL3403 Bus Terminal. They are needed in order to obtain all the data from the terminal. TYPE ST_HVACPower Measurement Ex STRUCT f IL1, f IL2, f IL3 : LREAL; A Ieff Strom (Effektivwert) f Ig : LREAL; A Gesamt Strom (Effektivwert) f UL1, f UL2, f UL3 : LREAL; V Ueff Spannung (Effektivwert) f PL1, f PL2, f PL3 : LREAL; k W P Wirkleistung Phase f Pg : LREAL; k W Pges Wirkleistung f Cos Phi L1, f Cos Phi L2, f Cos Phi L3 : LREAL; cos Phi Leistungsfaktor pro Phase f Cos Phi : LREAL; cos Phiges Leistungsfaktor f WL1, f WL2, f WL3 : LREAL; k Wh Energieverbrauch f Wg : LREAL; k Wh Energieverbrauch f Imax L1, f Imax L2, f Imax L3 : LREAL; A Imax Spitzenwert des Stroms f Umax L1, f Umax L2, f Umax L3 : LREAL; V Umax Spitzenwert der Spannung f Pmax L1, f Pmax L2, f Pmax L3 : LREAL; k W Pmax Spitzenwert der Wirkleistung f Sg : LREAL; k VA Sges Scheinleistung f Qg : LREAL; kvar Qges Blindleistung f Frequency L1, f Frequency L2, f Frequency L3 : LREAL; Hz Frequenz END_STRUCT TF8000 Version: 1.3.0 403
## Page 404

Programming VAR_INPUT w Data L1, w Data L2, w Data L3 : WORD; by SBL1, by SBL2, by SBL3 : BYTE; di Curr Trans Factor : LREAL; b Del Energy Consumption : BOOL; w Data Lx: Input data from the three channels of the KL3403. by SBLx: Status byte of the three channels of the KL3403. Reports which value can be read via the input (w Data Lx). di Curr Trans Factor: Transformation factor of the current transformer, used for conversion to the actual string current and the associated values. Since the final measured value is always dec. 1000 (100.0%) irrespective of the terminal type, the primary end value of the transformer must be specified for the factor. Example with KL3403-0000: A 400/1A transformer produces a di Curr Trans Factor of 400. With an internal resolution of 0.001 A, a measured value of max. 1 A results in an end value of dec. 1000 (100.0%) * di Curr Trans Factor = 400A. Example with KL3403-0010: A 400/5A transformer produces a di Curr Trans Factor of 400. With an internal resolution of 0.005 A, a measured value of max. 5 A results in an end value of dec. 1000 (100.0%) * di Curr Trans Factor = 400A. b Del Energy Consumption: A positive edge at this input deletes the energy consumption in the EEPROM. The energy consumption is counted in RAM and saved every 15 minutes in the EEPROM. It is retained there even if the KL3403 is switched off. 1) The minimum and peak values are deleted when the KL3403 is switched off. VAR_OUTPUT b Del Energy Measured Values Busy : BOOL; b Error : BOOL; i Err ID : UDINT; by CBL1, by CBL2, by CBL3 : BYTE; i Data Out L1, i Data Out L2, i Data Out L3 : INT; st Q_Power Measurement Ex : ST_HVACPower Measurement Ex; b Del Energy Measured Values Busy: Since the measured energy values are deleted from the internal EEPROM, no value is updated during this time and the flag b Del Energy Measured Values Busy shows TRUE. b Error: If TRUE, an error has occurred in the register communication. i Err ID: Error ID in the register communication 0x100 Timeout error. The time permitted for execution has been exceeded. 0x200 Parameter error (e.g. an invalid register number). 0x300 The read value differs from the written value (write access to this register may not be enabled or have failed) by CBLx: This output serves the selection of the desired input value and register communication in order to delete the energy consumption. i Data Out Lx: This output serves the register communication in order to delete the energy consumption. st Q_Power Measurement Ex: The results of the power measurement as an output data structure (see ST_HVACPower Measurement Ex [} 497]). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 404 Version: 1.3.0 TF8000
## Page 405

Programming 5.1.7.21 FB_HVACPriority_INT_8 This function block can be used to prioritize events or as a multiplexer. This selection is made with the help of the Enum e Ctrl Mode. The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output i Value Out is controlled via the events occurring at the inputs b Event1-8, i Value1-8 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events have a higher priority in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in Table 1 [} 405] column 1), then i Value Out has the value of i Value7. b Direction = TRUE means that the events have a higher priority in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 405] column 1), then i Value Out has the value of i Value1. The function block can be used as a multiplexer if e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Manual Value refers to one of the VAR_IN_OUT variables i Value1-8, whose value is output via i Value Out. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then i Value Out = i Value2, see Table 3 [} 406]. NOTICE A frequently changing variable may not be applied to the VAR_IN_OUT variables i Value1-8 if e Data Security Type = e HVACData Security Type_Persistent. This would lead to premature wear of the storage medium of the controller. If the VAR_IN_OUT variables i Value1-8 change frequently and are not to be stored persistently, then e Data Security Type must be e Data Security Type_Idle. Table 1: Prioritization of events in ascending form from 1 to 8 It can be seen in Table 1 that b Direction = FALSE. This means that the events determine the output value i Value Out in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in column 1), then i Value Out = i Value7. TF8000 Version: 1.3.0 405
## Page 406

Programming Table 2: Prioritization of events in descending form from 8 to 1 It can be seen in Table 2 that b Direction = TRUE . This means that the events determine the output value i Value Out in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 406] column 1), then i Value Out = i Value1. Table 3: Multiplexer If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then i Value Out = 2. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; b Event1 - b Event8 : BOOL; e Ctrl Mode : E_HVACCtrl Mode; i Manual Value : INT; 0..8 b Direction : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. 406 Version: 1.3.0 TF8000
## Page 407

Programming A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then i Value Out is set constantly to 0. e Ctrl Mode: This enum specifies the operation mode of the function block (see E_HVACCtrl Mode [} 489]). If e Ctrl Mode = e HVACCtrl Mode_Auto, then the function block represents a prioritization of events. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto, then the output i Value Out is controlled via the events occurring at the inputs b Event1-8, i Value1-8 and the control direction of the prioritization b Direction, see Table 1 [} 405] and Table 2 [} 406] If e Ctrl Mode = e HVACCtrl Mode_Manual, then the function block represents a multiplexer. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual, then the value of the output i Value Out is controlled via i Manual Value. If i Manual Profile = 5, then i Value Out = i Value5, see Table 3 [} 406] i Manual Profile: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual (Multiplexer) AND b Enable = TRUE AND b Error = FALSE, then the value of the output i Value Out is controlled via i Manual Value. If i Manual Profile = 5, then i Value Out = i Value5, see Table 3 [} 406] b Event1-8: The output i Value Out is controlled via the events occurring at the inputs b Event1-8, i Value1-8 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value i Value Out in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in Table 1 [} 405] column 1), then i Value Out = i Value7. b Direction = TRUE means that the events determine the output value i Value Out in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 405] column 1), then i Value Out = i Value1. The variables b Event1-8 and b Direction are taken into account only if e Ctrl Mode = e HVACCtrl Mode_Auto. b Direction: The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output i Value Out is controlled via the events occurring at the inputs b Event1-8, i Value1-8 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value i Value Out in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in Table 1 [} 405] column 1), then i Value Out = i Value7. b Direction = TRUE means that the events determine the output value i Value Out in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 405] column 1), then i Value Out = i Value1. The variables b Event1-8 and b Direction are taken into account only if e Ctrl Mode = e HVACCtrl Mode_Auto. VAR_OUTPUT i Value Out : INT; b Active : BOOL; b Edge New Event : BOOL; i Value Number : INT; i Value Out: This function block can be used to prioritize events or as a multiplexer. This selection is made with the help of the Enum e Ctrl Mode. The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output i Value Out is controlled via the events occurring at the inputs b Event1-8, i Value1-8 and the control direction of the prioritization b Direction. TF8000 Version: 1.3.0 407
## Page 408

Programming b Direction =FALSE means that the events determine the output value i Value Out in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in Table 1 [} 405] column 1), then i Value Out = i Value7. b Direction = TRUE means that the events determine the output value i Value Out in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 405] column 1), then i Value Out = i Value1. The function block can be used as a multiplexer if e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Manual Value refers to one of the VAR_IN_OUT variables i Value1-8, whose value is output via i Value Out. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then i Value Out = i Value2, see Table 3 [} 406]. b Active: b Active goes TRUE if 1. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto and one of the input variables b Event1-8 is TRUE. 2. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value > 0 b Edge New Event: Is TRUE for one PLC cycle if 1. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto and the decisive event (b Event1-8) for controlling the output i Value Out by means of i Value1-8 has changed. 2. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual and with each change of i Manual Value i Value Number: The variable i Value Number indicates the variable from which the value on i Value Out is output. If i Value Out = i Value7, then i Value Number = 7, see Table 1 [} 405], Table 2 [} 406] and Table 3 [} 406] VAR_IN_OUT i Value1-8 : INT; i Value1-8: The value of the output variable i Value Out is determined by the variables i Value1 to i Value8. i Value Out = i Value X If the function block is used to prioritize events, then each of the variables i Value1-8 is assigned to an event. i Value1 is assigned to the event b Event1, i Value2 to the event b Event2, i Value3 to the event b Event3, ... and i Value8 to the event b Event8 If the function block is used as a multiplexer, then each of the variables i Value1-8 is assigned to the value of i Manual Value. If i Manual Value = 1, then i Value Out = i Value1. If i Manual Value = 2, then i Value Out = i Value2…. if i Manual Value = 8, then i Value Out = i Value8. The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 408 Version: 1.3.0 TF8000
## Page 409

Programming 5.1.7.22 FB_HVACPriority_INT_16 This function block can be used to prioritize events or as a multiplexer. This selection is made with the help of the Enum e Ctrl Mode. The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output i Value Out is controlled via the events occurring at the inputs b Event1-16, i Value1-16 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events have a higher priority in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in Table 1 [} 410] column 1), then i Value Out has the value of i Value15. b Direction = TRUE means that the events have a higher priority in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 410] column 1), then i Value Out has the value of i Value1. TF8000 Version: 1.3.0 409
## Page 410

Programming The function block can be used as a multiplexer if e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Manual Value refers to one of the VAR_IN_OUT variables i Value1-16, whose value is output via i Value Out. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then i Value Out = i Value2, see Table 3 [} 411]. NOTICE A frequently changing variable may not be applied to the VAR_IN_OUT variables i Value1-16 if e Data Security Type = e HVACData Security Type_Persistent. This would lead to premature wear of the storage medium of the controller. If the VAR_IN_OUT variables i Value1-16 change frequently and are not to be stored persistently, then e Data Security Type must be e Data Security Type_Idle. Table 1: Prioritization of events in ascending form from 1 to 16 It can be seen in Table 1 that b Direction = FALSE. This means that the events determine the output value i Value Out in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in column 1), then i Value Out = i Value15. Table 2: Prioritization of events in descending form from 16 to 1 It can be seen in Table 2 that b Direction = TRUE . This means that the events determine the output value i Value Out in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 410] column 1), then i Value Out = i Value1. 410 Version: 1.3.0 TF8000
## Page 411

Programming Table 3: Multiplexer If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then i Value Out = 2. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; b Event1 - b Event8 : BOOL; e Ctrl Mode : E_HVACCtrl Mode; i Manual Value : INT; 0..16 b Direction : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. TF8000 Version: 1.3.0 411
## Page 412

Programming b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then i Value Out is set constantly to 0. e Ctrl Mode: This enum specifies the operation mode of the function block (see E_HVACCtrl Mode [} 489]). If e Ctrl Mode = e HVACCtrl Mode_Auto, then the function block represents a prioritization of events. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto, then the output i Value Out is controlled via the events occurring at the inputs b Event1-16, i Value1-16 and the control direction of the prioritization b Direction, see Table 1 [} 410] and Table 2 [} 410] If e Ctrl Mode = e HVACCtrl Mode_Manual, then the function block represents a multiplexer. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual, then the value of the output i Value Out is controlled via i Manual Value. If i Manual Profile = 5, then i Value Out = i Value5, see Table 3 [} 411] i Manual Profile: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual (Multiplexer) AND b Enable = TRUE AND b Error = FALSE, then the value of the output i Value Out is controlled via i Manual Value. If i Manual Profile = 5, then i Value Out = i Value5, see Table 3 [} 411] b Event1-16: The output i Value Out is controlled via the events occurring at the inputs b Event1-16, i Value1-16 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value i Value Out in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in Table 1 [} 410] column 1), then i Value Out = i Value15. b Direction = TRUE means that the events determine the output value i Value Out in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 410] column 1), then i Value Out = i Value1. The variables b Event1-16 and b Direction are taken into account only if e Ctrl Mode = e HVACCtrl Mode_Auto. b Direction: The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output i Value Out is controlled via the events occurring at the inputs b Event1-16, i Value1-16 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value i Value Out in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in Table 1 [} 410] column 1), then i Value Out = i Value15. b Direction = TRUE means that the events determine the output value i Value Out in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 410] column 1), then i Value Out = i Value1. The variables b Event1-16 and b Direction are taken into account only if e Ctrl Mode = e HVACCtrl Mode_Auto. VAR_OUTPUT i Value Out : INT; b Active : BOOL; b Edge New Event : BOOL; i Value Number : INT; i Value Out: This function block can be used to prioritize events or as a multiplexer. This selection is made with the help of the Enum e Ctrl Mode. The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output i Value Out is controlled via the events occurring at the inputs b Event1-16, i Value1-16 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value i Value Out in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in Table 1 [} 410] column 1), then i Value Out = i Value15. b Direction = TRUE means that the events determine the output value i Value Out in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 410] column 1), then i Value Out = i Value1. The function block can be used as a multiplexer if e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Manual Value refers to one of the VAR_IN_OUT variables i Value1-16, whose value is output via i Value Out. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then i Value Out = i Value2, see Table 3 [} 411]. b Active: b Active goes TRUE if 1. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto and one of the input variables b Event1-16 is TRUE. 412 Version: 1.3.0 TF8000
## Page 413

Programming 2. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value > 0 b Edge New Event: Is TRUE for one PLC cycle if 1. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto and the decisive event (b Event1-16) for controlling the output i Value Out by means of i Value1-16 has changed. 2. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual and with each change of i Manual Value i Value Number: The variable i Value Number indicates the variable from which the value on i Value Out is output. If i Value Out = i Value7, then i Value Number = 7, see Table 1 [} 410], Table 2 [} 410] and Table 3 [} 411] VAR_IN_OUT i Value1-16 : INT; X i Value1-16: The value of the output variable i Value Out is determined by the variables i Value1 to i Value16. i Value Out = i Value X If the function block is used to prioritize events, then each of the variables i Value1-16 is assigned to an event. i Value1 is assigned to the event b Event1, i Value2 to the event b Event2, i Value3 to the event b Event3, ..., i Value16 to the event b Event16 If the function block is used as a multiplexer, then each of the variables i Value1-16 is assigned to the value of i Manual Value. If i Manual Value = 1, then i Value Out = i Value1. If i Manual Value = 2, then i Value Out = i Value2…. if i Manual Value = 16, then i Value Out = i Value16. The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.23 FB_HVACPriority_REAL_8 TF8000 Version: 1.3.0 413
## Page 414

Programming This function block can be used to prioritize events or as a multiplexer. This selection is made with the help of the Enum e Ctrl Mode. The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output r Value Out is controlled via the events occurring at the inputs b Event1-8, r Value1-8 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events have a higher priority in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in Table 1 [} 414] column 1), then r Value Out has the value of r Value7. b Direction = TRUE means that the events have a higher priority in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 414] column 1), then r Value Out has the value of r Value1. The function block can be used as a multiplexer if e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Manual Value refers to one of the VAR_IN_OUT variables r Value1-8, whose value is output via r Value Out. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then r Value Out = r Value2, see Table 3 [} 415]. NOTICE A frequently changing variable may not be applied to the VAR_IN_OUT variables r Value1-8 if e Data Security Type = e HVACData Security Type_Persistent. This would lead to premature wear of the storage medium of the controller. If the VAR_IN_OUT variables r Value1-8 change frequently and are not to be stored persistently, then e Data Security Type must be e Data Security Type_Idle. Table 1: Prioritization of events in ascending form from 1 to 8 It can be seen in Table 1 that b Direction = FALSE. This means that the events determine the output value r Value Out in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in column 1), then r Value Out = r Value7. Table 2: Prioritization of events in descending form from 8 to 1 It can be seen in Table 2 that b Direction = TRUE . This means that the events determine the output value r Value Out in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 414] column 1), then r Value Out = r Value1. 414 Version: 1.3.0 TF8000
## Page 415

Programming Table 3: Multiplexer If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then r Value Out = 2. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; b Event1 - b Event8 : BOOL; e Ctrl Mode : E_HVACCtrl Mode; i Manual Value : INT; 0..8 b Direction : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then r Value Out is set constantly to 0. e Ctrl Mode: This enum specifies the operation mode of the function block (see E_HVACCtrl Mode [} 489]). If e Ctrl Mode = e HVACCtrl Mode_Auto, then the function block represents a prioritization of events. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto, then the output r Value Out is controlled via the events occurring at the inputs b Event1-8, r Value1-8 and the control direction of the prioritization b Direction, see Table 1 [} 414] and Table 2 [} 414] TF8000 Version: 1.3.0 415
## Page 416

Programming If e Ctrl Mode = e HVACCtrl Mode_Manual, then the function block represents a multiplexer. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual, then the value of the output r Value Out is controlled via i Manual Value. If i Manual Profile = 5, then r Value Out = r Value5, see Table 3 [} 415] i Manual Profile: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual (Multiplexer) AND b Enable = TRUE AND b Error = FALSE, then the value of the output r Value Out is controlled via i Manual Value. If i Manual Profile = 5, then r Value Out = r Value5, see Table 3 [} 415] b Event1-8: The output r Value Out is controlled via the events occurring at the inputs b Event1-8, r Value1-8 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value r Value Out in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in Table 1 [} 414] column 1), then r Value Out = r Value7. b Direction = TRUE means that the events determine the output value r Value Out in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 414] column 1), then r Value Out = r Value1. The variables b Event1-8 and b Direction are taken into account only if e Ctrl Mode = e HVACCtrl Mode_Auto. b Direction: The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output r Value Out is controlled via the events occurring at the inputs b Event1-8, r Value1-8 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value r Value Out in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in Table 1 [} 414] column 1), then r Value Out = r Value7. b Direction = TRUE means that the events determine the output value r Value Out in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 414] column 1), then r Value Out = r Value1. The variables b Event1-8 and b Direction are taken into account only if e Ctrl Mode = e HVACCtrl Mode_Auto. VAR_OUTPUT r Value Out : REAL; b Active : BOOL; b Edge New Event : BOOL; i Value Number : INT; r Value Out: This function block can be used to prioritize events or as a multiplexer. This selection is made with the help of the Enum e Ctrl Mode. The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output r Value Out is controlled via the events occurring at the inputs b Event1-8, r Value1-8 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value r Value Out in ascending form from 1 to 8. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event7 = TRUE (highest occurring event in Table 1 [} 414] column 1), then r Value Out = r Value7. b Direction = TRUE means that the events determine the output value r Value Out in descending form from 8 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 414] column 1), then r Value Out = r Value1. The function block can be used as a multiplexer if e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Manual Value refers to one of the VAR_IN_OUT variables r Value1-8, whose value is output via r Value Out. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then r Value Out = r Value2, see Table 3 [} 415]. b Active: b Active goes TRUE if 1. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto and one of the input variables b Event1-8 is TRUE. 2. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value > 0 b Edge New Event: Is TRUE for one PLC cycle if 1. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto and the decisive event (b Event1-8) for controlling the output r Value Out by means of r Value1-8 has changed. 416 Version: 1.3.0 TF8000
## Page 417

Programming 2. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual and with each change of i Manual Value i Value Number: The variable i Value Number indicates the variable from which the value on r Value Out is output. If r Value Out = r Value7, then i Value Number = 7, see Table 1 [} 414], Table 2 [} 414] and Table 3 [} 415] VAR_IN_OUT r Value1-8 : REAL; r Value1-8: The value of the output variable r Value Out is determined by the variables r Value1 to r Value8. r Value Out = r Value X If the function block is used to prioritize events, then each of the variables r Value1-8 is assigned to an event. r Value1 is assigned to the event b Event1, r Value2 to the event b Event2, r Value3 to the event b Event3, ... and r Value8 to the event b Event8 If the function block is used as a multiplexer, then each of the variables r Value1-8 is assigned to the value of i Manual Value. If i Manual Value = 1, then r Value Out = r Value1. If i Manual Value = 2, then r Value Out = r Value2…. If i Manual Value = 8, then r Value Out = r Value8. The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 417
## Page 418

Programming 5.1.7.24 FB_HVACPriority_REAL_16 This function block can be used to prioritize events or as a multiplexer. This selection is made with the help of the Enum e Ctrl Mode. The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output r Value Out is controlled via the events occurring at the inputs b Event1-16, r Value1-16 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events have a higher priority in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in Table 1 [} 419] column 1), then r Value Out has the value of r Value15. b Direction = TRUE means that the events have a higher priority in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 419] column 1), then r Value Out has the value of r Value1. 418 Version: 1.3.0 TF8000
## Page 419

Programming The function block can be used as a multiplexer if e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Manual Value refers to one of the VAR_IN_OUT variables r Value1-16, whose value is output via r Value Out. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then r Value Out = r Value2, see Table 3 [} 420]. NOTICE A frequently changing variable may not be applied to the VAR_IN_OUT variables r Value1-16 if e Data Security Type = e HVACData Security Type_Persistent. This would lead to premature wear of the storage medium of the controller. If the VAR_IN_OUT variables r Value1-16 change frequently and are not to be stored persistently, then e Data Security Type must be e Data Security Type_Idle. Table 1: Prioritization of events in ascending form from 1 to 16 It can be seen in Table 1 that b Direction = FALSE. This means that the events determine the output value r Value Out in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in column 1), then r Value Out = r Value15. Table 2: Prioritization of events in descending form from 16 to 1 It can be seen in Table 2 that b Direction = TRUE . This means that the events determine the output value r Value Out in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 419] column 1), then r Value Out = r Value1. TF8000 Version: 1.3.0 419
## Page 420

Programming Table 3: Multiplexer If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then r Value Out = 2. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Enable : BOOL; b Event1 - b Event8 : BOOL; e Ctrl Mode : E_HVACCtrl Mode; i Manual Value : INT; 0..16 b Direction : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. 420 Version: 1.3.0 TF8000
## Page 421

Programming b Enable: The function block is enabled via TRUE. If b Enable = FALSE, then r Value Out is set constantly to 0. e Ctrl Mode: This enum specifies the operation mode of the function block (see E_HVACCtrl Mode [} 489]). If e Ctrl Mode = e HVACCtrl Mode_Auto, then the function block represents a prioritization of events. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto, then the output r Value Out is controlled via the events occurring at the inputs b Event1-16, r Value1-16 and the control direction of the prioritization b Direction, see Table 1 [} 419] and Table 2 [} 419] If e Ctrl Mode = e HVACCtrl Mode_Manual, then the function block represents a multiplexer. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual, then the value of the output r Value Out is controlled via i Manual Value. If i Manual Profile = 5, then r Value Out = r Value5, see Table 3 [} 420] i Manual Profile: If the operation mode e Ctrl Mode = e HVACCtrl Mode_Manual (Multiplexer) AND b Enable = TRUE AND b Error = FALSE, then the value of the output r Value Out is controlled via i Manual Value. If i Manual Profile = 5, then r Value Out = r Value5, see Table 3 [} 420] b Event1-16: The output r Value Out is controlled via the events occurring at the inputs b Event1-16, r Value1-16 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value r Value Out in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in Table 1 [} 419] column 1), then r Value Out = r Value15. b Direction = TRUE means that the events determine the output value r Value Out in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 419] column 1), then r Value Out = r Value1. The variables b Event1-16 and b Direction are taken into account only if e Ctrl Mode = e HVACCtrl Mode_Auto. b Direction: The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output r Value Out is controlled via the events occurring at the inputs b Event1-16, r Value1-16 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value r Value Out in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in Table 1 [} 419] column 1), then r Value Out = r Value15. b Direction = TRUE means that the events determine the output value r Value Out in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 419] column 1), then r Value Out = r Value1. The variables b Event1-16 and b Direction are taken into account only if e Ctrl Mode = e HVACCtrl Mode_Auto. VAR_OUTPUT r Value Out : REAL; b Active : BOOL; b Edge New Event : BOOL; i Value Out : INT; r Value Out: This function block can be used to prioritize events or as a multiplexer. This selection is made with the help of the Enum e Ctrl Mode. The function block can be used to prioritize events if e Ctrl Mode = e HVACCtrl Mode_Auto. The output r Value Out is controlled via the events occurring at the inputs b Event1-16, r Value1-16 and the control direction of the prioritization b Direction. b Direction =FALSE means that the events determine the output value r Value Out in ascending form from 1 to 16. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = FALSE AND b Event15 = TRUE (highest occurring event in Table 1 [} 419] column 1), then r Value Out = r Value15. b Direction = TRUE means that the events determine the output value r Value Out in descending form from 16 to 1. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto AND b Direction = TRUE AND b Event1 = TRUE (lowest occurring event in Table 2 [} 419] column 1), then r Value Out = r Value1. The function block can be used as a multiplexer if e Ctrl Mode = e HVACCtrl Mode_Manual. The value of i Manual Value refers to one of the VAR_IN_OUT variables r Value1-16, whose value is output via r Value Out. If b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value = 2, then r Value Out = r Value2, see Table 3 [} 420]. b Active: b Active goes TRUE if TF8000 Version: 1.3.0 421
## Page 422

Programming 1. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto and one of the input variables b Event1-16 is TRUE. 2. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual AND i Manual Value > 0 b Edge New Event: Is TRUE for one PLC cycle if 1. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Auto and the decisive event (b Event1-16) for controlling the output r Value Out by means of r Value1-16 has changed. 2. b Enable = TRUE AND e Ctrl Mode = e HVACCtrl Mode_Manual and with each change of i Manual Value i Value Number: The variable i Value Number indicates the variable from which the value on r Value Out is output. If r Value Out = r Value7, then i Value Number = 7, see Table 1 [} 419], Table 2 [} 419] and Table 3 [} 420] VAR_IN_OUT r Value1-16 : REAL; r Value1-16: The value of the output variable r Value Out is determined by the variables r Value1 to r Value16. r Value Out = r Value X If the function block is used to prioritize events, then each of the variables r Value1-16 is assigned to an event. r Value1 is assigned to the event b Event1, r Value2 to the event b Event2, r Value3 to the event b Event3, ... and r Value16 to the event b Event16 If the function block is used as a multiplexer, then each of the variables r Value1-16 is assigned to the value of i Manual Value. If i Manual Value = 1, then r Value Out = r Value1. If i Manual Value = 2, then r Value Out = r Value2…. If i Manual Value = 16, then r Value Out = r Value16. The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.25 FB_HVACOptimized On Function block for the optimized switch-on of boilers and air conditioning systems in conjunction with switching time function blocks. The explanations in this document relate to the heating behavior. The function block is used in the same way in conjunction with cooling devices. 422 Version: 1.3.0 TF8000
## Page 423

Programming Calculation of the pre-start time Company buildings and public facilities are generally unoccupied overnight and at weekends, so the heating boilers there often run only in standby mode. The goal of optimized switch-on is to start the boiler early enough for the building to have been heated sufficiently at a certain point in time. Conversely, this also applies to the cooling of the building during the summer months. This pre-start time is in fact not constant, but always dependent on various factors, such as outside temperature, room temperature difference (actual value to setpoint), and structural conditions, for example the building mass and the thermal insulation. The development of a universal equation valid for all buildings would be a very complex task and would fail just on account of the input of innumerable parameters. A self-learning (adaptive) approximation method is simpler and ultimately absolutely sufficient. The flow temperature of the heating boiler depends on the outside temperature. Thus, different outside temperatures result in different heating curves, which essentially correspond to an exponential function: The flow temperature is always considerably higher than the room temperature to be reached. To determine the pre-start time it is assumed that the area of the functions between the room temperature start value and room temperature setpoint is linear. This results in a characteristic temperature change ΔT/Δt for each outside temperature, which is shown here by the dotted line. With the structure variable st Temp Change Function [} 498], the function block FB_HVACOptimized On is based on a table in which the respectively expected room temperature change is assigned for 10 discrete outside temperatures. During the commissioning or the initial starting of the system, the pre-start function must be coarsely predefined - firstly to define the outside temperature range and secondly to accelerate the adaptation procedure. This entry is done with the function block FB_HVACTemp Change Function Entry [} 442]. The pre-start time can be determined approximately with these values. This temperature change function f(AT) typically adopts the following course: TF8000 Version: 1.3.0 423
## Page 424

Programming Function values within these 10 points are defined by linear equations, while values outside correspond to the function value f(AT ) or f(AT ) respectively: 1 10 • AT < AT : f(AT) = f(AT ) 1 1 • AT > AT : f(AT) = f(AT ) 10 10 The pre-start time is then determined in accordance with the following sequence: The input and output variables of the function block are shown here in red. The internal flag ui Actual Prestart Time, which always contains the current pre-start time, is shown here in violet. The output ui Prestart Time corresponds to this flag, but is "frozen" during the pre-start phase. This is explained in more detail below. Connection of Modules and Prestart Phase Based on these specifications the module will calculate a prestart time and provide it to the time switch module. If the boiler should have warmed up the buildung at monday morning at 06:00 a.m. and the prestop module calculates at 05:00 a.m. a prestart time of 60 minutes, the boiler will be started immediately. The heating-up behaviour is watched in a reference room during the prestart time phase and the function of the temperature change is corrected. 424 Version: 1.3.0 TF8000
## Page 425

Programming The prestart module provides a prestart time to the time switch module. If this switches the output b Output, the prestart module gets informed by its input b Scheduler Active. Then the prestart module starts an internal countdown with the previously output prestart time ui Prestart Time [min]. The countdown either runs to the end or is completed prematurely when the room setpoint temperature is reached and represents the pre-start phase. During the countdown the output b Prestart Active is set. It can be used e. g. for the quickstart of the boiler. The output ui Prestart Time follows continously the above described calculation - but when a countdown has been started it is kept constant, in order to inhibit a fluctuation in the outdoor temperature to specify a lower prestart time and switch off the boiler. If the time-switch-module requests an adaption of the prestart-function (rising edge at b With Adaption, red line) the prestart module will decide after the prestart phase, whether the calculated prestart time has been exact, too short or too long (within a tolerance) and will correct the temperature change. For this the prestart time of the point whose outdoor temperature is nearest to the actual (at start of the countdown) is corrected upward or downward. This process is called "Adaption [} 428]". Note: Temperature changes are only corrected, when the outdoor temperature has been within the function range at the beginning of the prestart-phase, see "Adaption [} 428]". When adaption is requested, the input b With Adaption has to be set at the same time as the input b Scheduler Active. For b With Apation a simple trigger impulse is sufficient. When the input b Scheduler Active drops down, a started countdown is immediately aborted. The adaption can be disabled via the input b Disable Adaption. This option should be selected, when the temperature change function should not be changed any more after a sufficient number of adaptions. The following program flow chart is to illustrate the behaviour, in red you see the input- and output variables of the module: The internal flag "actual prestart time" is the always actual result of the calculation described obove. TF8000 Version: 1.3.0 425
## Page 426

Programming 426 Version: 1.3.0 TF8000
## Page 427

Programming TF8000 Version: 1.3.0 427
## Page 428

Programming The input b Enable (not described here), sets the module out of function if it is FALSE: the prestart time ui Prestart Time is set "0" and the prestart is not started resp. is immediately reset. Adaptation If an adaptation is selected and the pre-start phase has ended (countdown = 0 or room temperature reached), then three cases can occur: 1. The countdown has elapsed and the room temperature difference lies below the tolerance limit value r Adaption Tolerance -> no adaptation takes place. 2. The countdown has not yet elapsed, but the set temperature for the room has been reached -> the pre-start time ui Prestart Time was too long. 3. The countdown has elapsed, but there is still a positive temperature difference -> the pre-start time ui Prestart Time was too short. The value ΔT/Δt can now be re-determined on the basis of the elapsed countdown time and the change in the room temperature difference that has taken place 1. no change. 2. too much time was calculated – new value: "Room temperature difference at the start" / "Time elapsed so far" 3. too little time was calculated – new value: ("Room temperature difference at start" - "Room temperature difference at end") / "Countdown time" The temperature change function is now corrected at the interpolation point whose outside temperature value was nearest to that at the beginning of the pre-stop phase. To this end the point concerned was saved before the start of the countdown, see program flowchart. However, the previously calculated value ΔT/Δt is not necessarily adopted 100% as the new value at the interpolation point. In fact there is an option to mix the new value from a weighting of old and calculated value. This weighting takes place with the aid of the so-called adaptation factor r Adaption Factor: With an adaptation factor of 100% the newly calculated value is adopted fully, while with 0% the old value is retained. 428 Version: 1.3.0 TF8000
## Page 429

Programming Note: Because the pre-start time is always changed at the nearest point, an adaptation can only take place if the outside temperature at the beginning of the pre-start phase lies inside AT to AT . 1 10 VAR_INPUT e Data Security Type : E_HVACData Security Type; e Ctrl Fct : E_BARCtrl Fct; b Enable : BOOL; b Scheduler Active : BOOL; b With Adaption : BOOL; b Disable Adaption : BOOL; r Outside Temperature : REAL; r Room Temperature : REAL; r Room Setpoint Value : REAL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. TF8000 Version: 1.3.0 429
## Page 430

Programming A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. e Ctrl Fct: e Ctrl Fct = e BARCtrl Fct_Heating indicates to the function block that it is to be used in heating mode (see E_BARCtrl Fct [} 498]). Cooling mode is indicated by e Ctrl Fct = e BARCtrl Fct_Cooling. Any other entry at this input is impermissible and leads to an error message. The two possible entries are for the different calculation of the temperature difference between actual room value and set room value. b Enable: A FALSE signal at this input suppresses the optimized switch-on of the connected timers. The output value of the pre-start time is also set directly to "0". No countdown starts, nor is an adaptation carried out – the function block is reset. b Scheduler Active: A rising edge at this input starts the internal countdown of the pre-start time. The output b Prestart Mode is set to TRUE while the countdown of a pre-start time is running down. If the output b Scheduler Active is switched to FALSE again during the countdown, the countdown is interrupted immediately and the output b Prestart Mode is set to FALSE. The countdown is also stopped and b Prestart Mode set to FALSE when the room setpoint is reached. b With Adaption: If this input is set simultaneously with the input b Scheduler Active, an adaptation takes place after the expiry of the countdown. A trigger pulse together with the rising edge of b Scheduler Active is sufficient for this. This input can only be used in conjunction with b Scheduler Active; setting it alone has no effect at all. b Disable Adaption: A TRUE signal at this input merely suppresses the adaptation that follows the countdown. r Outside Temperature: Outside temperature in degrees Celsius. r Room Temperature: Room temperature in degrees Celsius. r Room Setpoint Value: Room temperature setpoint in degrees Celsius. VAR_OUTPUT ui Prestart Time : UINT; b Prestart Active : BOOL; udi Countdown Time : UDINT; b Error : BOOL; udi Error ID : UDINT; ui Prestart Time: Output value of the optimized pre-start time to the timers concerned in minutes. This value is formed continuously from the pre-start function that is dependent on the outside temperature. Conversely, if the input b Disable Optimization is set to TRUE, then this output is set to "0". b Prestart Active: The function block is in pre-start mode as long as the internal countdown is running and has not been ended by the expiry of the pre-start time, by the reaching of the room temperature setpoint or by an interruption (b Scheduler Active = FALSE). This is indicated by a TRUE signal at this output. udi Countdown Time: This output indicates the elapsing of the internal countdown in seconds. This output is set to "0" if the function block is no longer in pre-start mode (see b Prestart Mode). b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. 430 Version: 1.3.0 TF8000
## Page 431

Programming VAR_IN_OUT ui Max Prestart Time : UINT; r Adaption Factor : REAL; r Adaption Tolerance : REAL; st Temp Change Function : ST_HVACTemp Change Function; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Max Prestart Time: Due to the adaptation the pre-start times are shortened and lengthened within the temperature change function. While they are logically automatically limited to 0 minutes in the downward direction, the upward limit in minutes can be defined by this input. r Adaption Factor: In the adaptation step the temperature change ΔT/Δt that has taken place is calculated for the nearest outside temperature interpolation point. However, this is not necessarily adopted 100% as the new value. In fact there is an option to mix the new value from a weighting of old and calculated value. The adaptation factor (in percent) thereby represents the weighting. With an adaptation factor of 100% the newly calculated value is adopted fully, while with 0% the old value is retained. r Adaption Tolerance: If the countdown has expired and the room temperature setpoint has been reached with adaptation activated, no adaptation is carried out because the pre-start time is precisely right. The value r Adaption Tolerance defines a tolerance range: If the actual value lies within the range r Room Setpoint Value .. r Room Setpoint Value + r Adaption Tolerance, then this is regarded as reaching the setpoint. st Temp Change Function: Structure variable of the type ST_HVACTemp Change Function [} 498] that contains the 10 value pairs (outside temperature, inside temperature change). These value pairs, which have to be entered in the field variable in ascending order of the outside temperature, define the 9 pitch lines of the temperature change function. Initial entry through FB_HVACTemp Change Function Entry [} 442]. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 431
## Page 432

Programming 5.1.7.26 FB_HVACOptimized Off Function block for the optimized switch-off (pre-stop) of boilers and air conditioning systems in conjunction with switching time function blocks. The explanations in this document relate to the heating behavior. The function block is used in the same way in conjunction with cooling devices. Calculating the Prestop Time Buildings and parts of buildings which are used at a certain and projectable time, e. g. schools and conference rooms, don´t need to be heated for the whole using-time. Because the buildings save thermal energy, it is possible to shut off the heating earlier. The room temperature declines till the end of usage to a lower niveau which is hardly noticed. This is a desired declining to an objective temperature - the difference of declining is an input of the function block and is called r Requested Temp Deviation. The flow temperature of the boiler refers to the outdoor temperature. Therefore there are different declining processes for different outdoor temperatures which meet basically an exponential function: 432 Version: 1.3.0 TF8000
## Page 433

Programming To determine the prestop time, the area between the functions of room temperature start value and room temperature target value is assumed linear. So for each outdoor temperatue there is a characteristic temperature change ΔT/Δt, which is illustrated here in a dotted line. The function block FB_HVACOptimized Off refers with the variable st Temp Change Function [} 498] to a table, in which there are 10 outdoor temperatures with their corresponding room temperature changes. When commissioning or starting the system for the first time, the pre-start function must be roughly pre-defined, firstly to define the external temperature range and secondly to accelerate the adaptation process. This entry is made with the block FB_HVACTemp Change Function Entry [} 442]. With these values you can approximately determine the prestop temperature. Typically this temperature-change-function f(OT) has the following course: (the change is positive illustrated): TF8000 Version: 1.3.0 433
## Page 434

Programming Function values inside these 10 points are determined via equation of line, values outside correspond to the function value f( OT ) resp. f(OT ): 1 10 • OT < OT : f(OT) = f(OT ) 1 1 • OT > OT : f(OT) = f(OT ) 10 10 Thus the prestop time is calculated: The input and output variables of the module are illustrated in red. The internal flag ui Actual Prestop Time which holds always the actual prestop time is illustrated in violet. The output ui Prestop Time corresponds to this flag, but becomes "freezed" during the prestop phase. This will be explained in detail in the following chapter. Function block linking and pre-stop phase From these parameters the function block will then continuously calculate a pre-stop time, which it specifies to the timer function block. Then if, for example, a heating boiler is to be switched off at 8 pm and the pre- stop function block determines at 7 pm that the temperature level would drop by the desired value r Requested Temp Deviation on switching off the boiler in 60 minutes, the boiler is switched off immediately. The cooling behavior is then observed in a reference room over the pre-stop phase and the temperature change curve is corrected accordingly. The pre-stop function block specifies a pre-stop time for the timer. If the timer switches the output b Output back to FALSE, this is indicated to the pre-stop function block via its input b Scheduler Off . The pre-stop function block then internally starts a countdown with the previously output pre-stop time ui Prestop Time [min]. The countdown either runs to the end or is prematurely ended on reaching the requested or tolerated room temperature. The b Prestop Active output is set during the countdown. 434 Version: 1.3.0 TF8000
## Page 435

Programming The output ui Prestop Time continuously follows the calculation shown above, but is kept constant during a started countdown so that a fluctuation in the outside temperature does not specify a shorter pre-stop time and the boiler is suddenly switched on again. If, in the case of a pre-stop, the timer function block still sends the adaptation order as an edge (red line) to the optimization function block, then the latter will decide following the pre-stop phase whether the previously determined pre-stop time was precisely within a tolerance, or too short or too long, and correct the temperature change function accordingly. In doing so the pre-stop time of the point whose outside temperature was nearest to the actual one at the beginning of the countdown is corrected upwards or downwards respectively. This process is called "adaptation [} 438]". Temperature changes are only corrected if the outside temperature was within the interpolation points, i.e. the function range, at the beginning of the pre-stop; see "Adaptation [} 438]". If adaptation is desired, the inputs b With Adaption and b Scheduler Off must be set simultaneously. A pure trigger pulse is sufficient for b With Adaption. A previously started countdown is interrupted immediately if the input b Scheduler Off releases. The adaptation can be suppressed by the input b Disable Adaption. This option should be selected if the temperature change function is no longer to be changed after a certain number of adaptation procedures. The following program flowchart is intended to better illustrate the behavior; the input and output variables of the function block are shown in red here: The internal flag "Current pre-stop time" is the continuously refreshed result of the calculation in accordance with the diagram shown above. TF8000 Version: 1.3.0 435
## Page 436

Programming 436 Version: 1.3.0 TF8000
## Page 437

Programming The input b Enable, whose mode of operation is not shown here, factually deactivates the function block when FALSE. "0" is output as the pre-stop time ui Prestop Time and the sequence shown above is not started or is immediately reset as the case may be. TF8000 Version: 1.3.0 437
## Page 438

Programming Adaptation The goal of the adaptation is to adapt the temperature change function so precisely that the requested or tolerated temperature decrease r Requested Temp Deviation is reached in the determined pre-stop time (in cooling mode it would be the temperature increase after switching off the cooling devices). If an adaptation is selected and the pre-stop phase has ended (countdown = 0 or room temperature reached), then three cases can occur: 1. The countdown has elapsed and the requested deviation r Requested Deviation is exhausted up to a tolerance r Adaption Tolerance -> no adaptation takes place. 2. The countdown has not yet elapsed, but the requested deviation r Requested Deviation has been exceeded -> the pre-stop time ui Prestop Time was too long. 3. The countdown has elapsed, but the requested deviation r Requested Deviation is not yet fully exhausted -> the pre-stop time ui Prestop Time was too short, i.e. switch-off can take place even earlier. The value ΔT/Δt can now be re-determined on the basis of the elapsed countdown time and the change in the room temperature difference that has taken place 1. no change. 2. too much time was calculated – new value: "requested deviation r Requested Deviation" / "time elapsed so far" 3. too little time was calculated – new value: ("requested deviation r Requested Deviation" - "Deviation at the end") / "Countdown time" The temperature change function is now corrected at the interpolation point whose outside temperature value was nearest to that at the beginning of the pre-stop phase. To this end the point concerned was saved before the start of the countdown, see program flowchart. However, the previously calculated value ΔT/Δt is not necessarily adopted 100% as the new value at the interpolation point. In fact there is an option to mix the new value from a weighting of old and calculated value. This weighting takes place with the aid of the so-called adaptation factor r Adaption Factor: 438 Version: 1.3.0 TF8000
## Page 439

Programming With an adaptation factor of 100% the newly calculated value is adopted fully, while with 0% the old value is retained. Note: Because the pre-stop time is always changed at the nearest point, an adaptation can only take place if the outside temperature at the beginning of the pre-stop phase lies inside AT to AT . 1 10 VAR_INPUT e Data Security Type : E_HVACData Security Type; e Ctrl Fct : E_BARCtrl Fct; b Enable : BOOL; b Scheduler Off : BOOL; b With Adaption : BOOL; b Disable Adaption : BOOL; r Outside Temperature : REAL; r Room Temperature : REAL; r Requested Temp Deviation : REAL; TF8000 Version: 1.3.0 439
## Page 440

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. e Ctrl Fct: e Ctrl Fct = e BARCtrl Fct_Heating indicates to the function block that it is to be used in heating mode (see E_BARCtrl Fct [} 498]). Cooling mode is indicated by e Ctrl Fct = e BARCtrl Fct_Cooling. Any other entry at this input is impermissible and leads to an error message. The two possible entries are for the different evaluation of the deviation r Requested Temp Deviation. b Enable: A FALSE signal at this input suppresses the optimized switch-off of the connected timers. The output value of the pre-stop time is also set directly to "0". No countdown starts, nor is an adaptation carried out – the function block is reset. b Scheduler Off: A rising edge at this input starts the internal countdown of the pre-stop time. The output b Prestop Mode is set to TRUE while the countdown of a pre-stop time is running down. If the output b Scheduler Off is switched to FALSE again during the countdown, the countdown is interrupted immediately and the output b Prestop Mode is set to FALSE. The countdown is also stopped and b Prestop Mode set to FALSE when the room setpoint is reached. b With Adaption: If this input is set simultaneously with the input b Scheduler Off, an adaptation takes place after the countdown has elapsed. A trigger pulse together with the rising edge of b Scheduler Off is sufficient for this. This input can only be used in conjunction with b Scheduler Off; setting it alone has no effect at all. b Disable Adaption: A TRUE signal at this input merely suppresses the adaptation that follows the countdown. r Outside Temperature: Outside temperature in degrees Celsius. r Room Temperature: Room temperature in degrees Celsius. r Requested Temp Deviation: Tolerated downward (heating mode) or upward (cooling mode) temperature deviation after switching off the boiler or the air conditioning system respectively until leaving the room. VAR_OUTPUT ui Prestop Time : UINT; b Prestop Active : BOOL; udi Countdown Time : UDINT; b Error : BOOL; udi Error ID : UDINT; ui Prestop Time: Output value of the optimized pre-stop time to the timers concerned in minutes. This value is formed continuously from the pre-stop function that is dependent on the outside temperature. Conversely, if the input b Disable Optimization is set to TRUE, then this output is set to "0". b Prestop Active: The function block is in pre-stop mode as long as the internal countdown is running and has not been ended by the pre-stop time elapsing, by the room temperature setpoint being reached or by an interruption (b Scheduler Off = FALSE). This is indicated by a TRUE signal at this output. 440 Version: 1.3.0 TF8000
## Page 441

Programming udi Countdown Time: This output indicates the elapsing of the internal countdown in seconds. This output is set to "0" if the function block is no longer in pre-stop mode (see b Prestop Mode). b Error: This output is switched to TRUE if the parameters entered are erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT ui Max Prestop Time : UINT; r Adaption Factor : REAL; r Adaption Tolerance : REAL; st Temp Change Function : ST_HVACTemp Change Function; In order for the registered parameters to be retained beyond a controller failure, it is necessary to declare them as In-Out variables. A reference variable is then assigned to them in the program. Each change of the value of these reference variables is persistently stored in the function block and written back to the reference variable following a controller failure and restart. If the parameters were only to be defined as input variables, they would not be able to write a reference variable. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip. ui Max Prestop Time: Due to the adaptation the pre-stop times are shortened and lengthened within the temperature change function. While they are logically automatically limited to 0 minutes in the downward direction, the upward limit in minutes can be defined by this input. r Adaption Factor: In the adaptation step the temperature change ΔT/Δt that has taken place is calculated for the nearest outside temperature interpolation point. However, this is not necessarily adopted 100% as the new value. In fact there is an option to mix the new value from a weighting of old and calculated value. The adaptation factor (in percent) thereby represents the weighting. With an adaptation factor of 100% the newly calculated value is adopted fully, while with 0% the old value is retained. r Adaption Tolerance: If the countdown has elapsed and the requested deviation r Requested Deviation is exhausted, no adaptation is carried out because the pre-stop time is precisely right. The value r Adaption Tolerance defines an additional tolerance range: TF8000 Version: 1.3.0 441
## Page 442

Programming st Temp Change Function: Structure variable of the type ST_HVACTemp Change Function [} 498] that contains the 10 value pairs (outside temperature, inside temperature change). These value pairs, which have to be entered in the field variable in ascending order of the outside temperature, define the 9 pitch lines of the temperature change function. Initial entry through FB_HVACTemp Change Function Entry [} 442]. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.27 FB_HVACTemp Change Function Function block for the input of the interpolation points of the pre-start function. In order to keep the function blocks FB_HVACOptimized On [} 422] and FB_HVACOptimized Off [} 432] well- arranged, they contain no entry of the individual value pairs for the temperature change function. The function blocks access the structure variable of the temperature change function (ST_HVACTemp Change Function [} 498]) via an IN-OUT variable. The function block FB_HVACTemp Change Function enables the writing of the structure variable in a clear form and also makes sure that the value pairs, as required, are entered in ascending order of the outside temperature and that there are no two points with the same outside temperature. Mathematically speaking, there would be no unambiguous functional correlation in this case. The value pairs are to be entered at the corresponding inputs r Outside Temperature_1 .. r Outside Temperature_10 (outside temperature) and r Room Temp Change_1 .. r Room Temp Change_10 (room temperature change). The function block continuously checks whether the described requirement for ascending order of the outside temperature is fulfilled and whether two value pairs exist with the same outside temperature. Note: The writing of the temperature change functions should take place once in order to give the pre-start/ pre-stop function blocks basic values, which are then continually improved by these function blocks over the course of time. 442 Version: 1.3.0 TF8000
## Page 443

Programming VAR_INPUT b Write : BOOL; r Outside Temp_1 : REAL; r Room Temp Change_1 : REAL; r Outside Temp_2 : REAL; r Room Temp Change_2 : REAL; r Outside Temp_3 : REAL; r Room Temp Change_3 : REAL; r Outside Temp_4 : REAL; r Room Temp Change_4 : REAL; r Outside Temp_5 : REAL; r Room Temp Change_5 : REAL; r Outside Temp_6 : REAL; r Room Temp Change_6 : REAL; r Outside Temp_7 : REAL; r Room Temp Change_7 : REAL; r Outside Temp_8 : REAL; r Room Temp Change_8 : REAL; r Outside Temp_9 : REAL; r Room Temp Change_9 : REAL; r Outside Temp_10 : REAL; r Room Temp Change_10 : REAL; b Write: A rising edge at this input copies the values entered at the inputs to the pre-start function. (r Outside Temp_1 - r Room Temp Change1) ... (r Outside Temp_10 - r Room Temp Change10): Value pairs of the pre-start function: Room temperature change (r Room Temp Change) in degrees Kelvin per minute at outside temperature (r Outside Temp) in degrees Celsius. VAR_OUTPUT b Valid : BOOL; udi Error ID : UDINT; b Valid: This output is switched to TRUE if the parameters entered are not erroneous. udi Error Id: Contains the error code if the values entered should be erroneous. See Error codes [} 317]. VAR_IN_OUT st Temp Change Function : ST_HVACTemp Change Function; st Temp Change Function : structure variable of type ST_HVACTemp Change Function [} 498], which contains the 10 pairs of values (outdoor temperature, room temperature change). These pairs of values, which have to be - sorted by rising outdoor temperature - entered in the field variable, define the 9 fragment lines of the temperature change function. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.28 FB_HVACPWM This function block generates a pulse width modulated signal from the analog input signal r YIn. Furthermore, a minimum switch-on time can be parameterized. TF8000 Version: 1.3.0 443
## Page 444

Programming VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r YIn : REAL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled if b Enable = TRUE. r YIn: Analog input variables of the function block (0%..100%). b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b Out : BOOL; r YOut : REAL; b Invalid Parameter : BOOL; b Out: PWM signal. r YOut: Output of the input variable of the function block (0%..100%). b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT t PWMPeriod : TIME; t MINPower On Time : TIME; t PWMPeriod: Period of the PWM signal. The variable is saved persistently. Preset to 30 min. t MINPower On Time: Minimum switch-on time of the pulsed output b Out. The variable is saved persistently. Preset to 0 s. 444 Version: 1.3.0 TF8000
## Page 445

Programming Figure: Scope2 recording for additional explanation of the mode of operation of the function block. The output (b Out = TRUE) is set on enabling the function block (b Enable = TRUE). See also sections 1 and 5. A change in the input variable during a running period is only taken into account in the next period. See also sections 2, 3 and 4. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 445
## Page 446

Programming 5.1.7.29 FB_HVACStart Air Conditioning The air conditioning system is started up stepwise with the start program FB_HVACStart Air Conditioning. The shut-off dampers, the fans, the controller and the limit value monitoring of the analog inputs are thereby enabled one after the other. In the case of low outside temperatures below the value of r Pre Rinse Outside Temp, the heating coil is initially rinsed with hot water before the outside and exhaust air dampers are opened. In air handling units with a temperature sensor in the return flow from the heating coil, the rinsing procedure continues until the temperature r Return Water Temp has exceeded the value of the input variable r Pre Rinse Limit Temp. The outside and exhaust air dampers are opened when the specified temperature in the return flow from the air heater is reached. If the temperature is not exceeded after the timer t Pre Rinse Max Time has elapsed, the fault is indicated by a TRUE at the output b Error No Hot Water. If there is no temperature sensor in the return flow from the heater, a constant of -100 is applied to the input r Return Water Temp. The function block FB_HVACStart Air Conditioning then knows that the pre-rinse procedure must be executed without return flow monitoring. In this case rinsing continues until the timer t Pre Rinse Max Time elapses. Hence, there is no monitoring of the rinsing procedure! The outside and exhaust air dampers are opened after completion of the pre-rinsing procedure. The output b Dampers Open becomes TRUE as a result. In order to avoid damage to the air ducts and the dampers, the start-up of the fans is delayed until the feedback "Open" from the dampers is present at the input b Dampers Feedb Open. In addition the timer t Delay Supply Vent must have elapsed. The set time must be longer than the stroke time of the damper drive. Since this timer is also active when the system is switched off, the ramp-down times of frequency converters must also be taken into account! The output b Error Dampers becomes TRUE if no feedback is received from the damper drives within the set time. In order to avoid high start-up currents, the switching on of the exhaust air fan is delayed by the timer t Delay Exhaust Vent. 446 Version: 1.3.0 TF8000
## Page 447

Programming In systems with a mixed air chamber it makes sense to enable the controller only after the supply air temperature r Supply Air Temp has reached approximately the value of the exhaust air temperature. The maximum deviation is specified by the parameter r Difference Temp. In systems without a mixed air system a very large value is simply entered here as a constant, e.g. 100. The controller is then enabled without a delay. After the timer t Delay Limit Ctrl has elapsed, the output b Enable Limit Ctrl is enabled and, hence, the limit value monitoring of the analog inputs is activated. If the outside temperature lies below the value of r Pre Rinse Outside Temp, the value of i Current Sequence is applied to the output the same as that of i Start Seq Winter. The number of the pre-heater controller must be entered here (see the chapter on sequence controllers). (See the chapter on sequence controllers). If the outside temperature is higher than r Pre Rinse Outside Temp, start-up can commence with the heat recovery unit or the mixed air chamber. Hence, the number of the sequence controller for the mixed air chamber or for the heat recovery unit is entered at the input i Start Seq Summer. The start-up becomes active in the case of operation requests from the automatic programs, the scheduler activates, summer night cooling, support operation and overheating protection. In order to activate the sequence controllers, the enumeration variable e Mode Seq Ctrl at the output of the function block is set as follows: TYPE E_HVACSequence Ctrl Mode : ( e HVACSequence Ctrl Mode_Stop := 0, e HVACSequence Ctrl Mode_On := 1, e HVACSequence Ctrl Mode_Night Cooling := 2, e HVACSequence Ctrl Mode_Freeze Protection := 3, e HVACSequence Ctrl Mode_Overheating Protection := 4, e HVACSequence Ctrl Mode_Night Cooling And Overheating Protection := 5 ); END_TYPE Requests from all automatic programs are transferred to the system start program via the input variables b Time Scheduler, b Night Cooling, b Freeze Protec and b Over Heating Protec. Requests from retention functions are only applied if there is no request from a timer program at the input variable b Time Scheduler. The programs for summer night cooling (b Night Cooling), cooling protection (b Freeze Protect) and overheating protection (b Over Heating Protec) are only usable if a room temperature sensor is used in place of an exhaust air temperature sensor. The cooling protection program always has priority over the other automatic programs unless the operation request from the timer program is present. Since summer night cooling can take place as forced ventilation with fans or as convection ventilation without fans, the command from the program FB_HVACSummer Night Cooling is transferred with the counter variable E_HVACConvection Mode. This output must be applied to the input variable e Convection. A collection of all air conditioning system error messages that lead to the system switching off is applied to the input b Emergency Stop. When the air conditioning system is switched off, the order of the switch-on steps is reversed. - Deactivate limit monitoring at the analog inputs - Deactivate the controllers (reset i Current Sequence to 0) - Switch off the fans - Close the dampers after the timer t Delay Supply Vent has elapsed. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; i Start Seq Winter : INT; i Start Seq Summer : INT; b Time Scheduler : BOOL; b Night Cooling : BOOL; b Freeze Protec : BOOL; b Over Heating Protec : BOOL; r Outside Temp : REAL; r Return Water Temp : REAL; r Supply Air Temp : REAL; TF8000 Version: 1.3.0 447
## Page 448

Programming r Return Air Temp : REAL; b Dampers Feedb Open : BOOL; b Emergency Stop : BOOL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. i Start Seq Winter: The number of the sequence controller for the pre-heater must be entered here. i Start Seq Summer: The number of the sequence controller for the mixed air chamber or for the heat recovery unit must be entered here. b Time Scheduler: Input for the switch command. b Night Cooling: Input for the night cooling function. b Freeze Protec: Input for the frost protection function. b Over Heating Protec: Input for the overheating protection function. r Outside Temp: Input for the outside temperature. r Return Water Temp: Input for the water temperature from the return flow of the air heater. r Supply Air Temp: Input for the supply air temperature. r Return Air Temp: Input for the room temperature or the exhaust air temperature. b Dampers Feedb Open: Input for the feedback from the dampers. b Emergency Stop: A collection of all VAC system error messages that lead to the system switching off can be applied to this input. b Reset: Input for acknowledging the fault. VAR_OUTPUT e Mode Seq Ctrl : E_HVACSequence Ctrl Mode; b Pre Rinse : BOOL; b Dampers Open : BOOL; b Supply Ventilation : BOOL; b Exhaust Ventilation : BOOL; b Start PIDControllers : BOOL; b Enable Limit Ctrl : BOOL; b Error General : BOOL; b Error No Hot Water : BOOL; b Error Dampers : BOOL; by Error : BYTE; b Invalid Parameter : BOOL; 448 Version: 1.3.0 TF8000
## Page 449

Programming e Mode Seq Ctrl: Enum that notifies the operation request (see E_HVACSequence Ctrl Mode [} 492]). b Pre Rinse: TRUE if the pre-rinsing procedure is active. b Dampers Open: If TRUE, then the outside and exhaust air dampers are open. b Supply Ventilation: Switches on the supply air fan if TRUE. b Exhaust Ventilation: Switches on the exhaust air fan if TRUE. b Start PIDControllers: Enables the controllers. b Enable Limit Ctrl: After the timer t Delay Limit Ctrl has elapsed, the output b Enable Limit Ctrl is enabled and, hence, the limit value monitoring of the analog inputs is activated. b Error General: There is a general error. b Error No Hot Water: Is set to TRUE if the rinsing procedure has ended and the set temperature in the return flow has not been reached. b Error Dampers: There is an error in the dampers. by Error: Output of the error as a byte. by Error.1:= b Invalid Parameter; by Error.2:= b Error General; by Error.3:= b Error No Hot Water; by Error.4:= b Error Dampers; b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT e Convection : E_HVACConvection Mode; t Delay Supply Vent : TIME; t Delay Exhaust Vent : TIME; t Delay Temp Ctrl : TIME; r Difference Temp : REAL; t Delay Limit Ctrl : TIME; r Pre Rinse Outside Temp : REAL; r Pre Rinse Limit Temp : REAL; t Pre Rinse Max Time : TIME; i Current Sequence : INT; e Convection: ENUM via which summer night cooling can take place as forced ventilation with fans or as convection ventilation without fans (see E_HVACConvection Mode [} 490]). The variable is saved persistently. Preset to 1. t Delay Supply Vent: Time delay that delays the start-up of the supply air fans. The variable is saved persistently. Preset to 120 s. t Delay Exhaust Vent: Time delay that delays the start-up of the exhaust air fans. The variable is saved persistently. Preset to 5 s. t Delay Temp Ctrl: Time delay for the controller. The variable is saved persistently. Preset to 10 s. r Difference Temp: The controller is enabled if the difference between the room temperature and the supply air temperature is smaller than r Difference Temp. The variable is saved persistently. Preset to 5 K. t Delay Limit Ctrl: Time delay before limit monitoring of the temperature sensors is enabled. See the variable b Enable Limit Ctrl in FB_HVACTemperature regarding this point. The variable is saved persistently. Preset to 360 s. r Pre Rinse Outside Temp: Outside temperature below which the VAC system should start up with the prerinsing of the heating coil. The variable is saved persistently. Preset to 10 K. r Pre Rinse Limit Temp: Temperature of the return flow from the heating coil that must be reached in order to end the pre-rinsing procedure and continue with the opening of the dampers. The variable is saved persistently. Preset to 30 K. TF8000 Version: 1.3.0 449
## Page 450

Programming t Pre Rinse Max Time: Maximum duration of the pre-rinsing procedure. The variable is saved persistently. Preset to 300 s. i Current Sequence: The starting controller at controller enable is specified here. The value is written by the start program in one cycle only, since afterwards in system operation this parameter must be freely writeable again for the switching on or off of the sequence controllers. The variable is saved persistently. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.30 FB_HVACSummer Night Cooling With this function block, rooms that were heated up on the day before can be cooled down during the night using cool outside air. The summer night cooling function serves to improve the quality of the air and to save electrical energy. Electrical energy for cooling is saved during the first hours of the next summer day. The start conditions for the summer night cooling are defined by parameterizing the FB_HVACSummer Night Cooling function block. The function block can be used to open motor-driven windows or to switch air conditioning systems to summer night cooling mode outside their normal hours of operation. Summer night cooling mode is active if the output variable b On is TRUE. The following conditions must be met for activation of summer night cooling: - b Enable = TRUE - r Outside Temp > (r Minimum Outside Temp + 0.2K) - ((r Room Temp - r Outside Temp) > r Differ Outside Room Temp On) - ((r Room Temp - r Setpoint Room Temp) > r Differ Room Setpoint Temp) - the system time dt Systemtime must be within the timeframe tod Start Time to 12 noon For the deactivation of summer night cooling b On = FALSE it is sufficient if one of the following condition is met: - b Enable = FALSE - (r Outside Temp < (r Minimum Outside Temp - 0.2K)) - ((r Room Temp - r Outside Temp) < r Differ Outside Room Temp Off) - the system time dt Systemtime lies outside the timeframe of tod Start Time to 12 noon - summer night cooling was active for the maximum time t Max Runtime within the timeframe between tod Start Time and 12 noon. Summer night cooling can be switched on several times within this timeframe. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r Outside Temp : REAL; 450 Version: 1.3.0 TF8000
## Page 451

Programming r Room Temp : REAL; r Setpoint Room Temp : REAL; dt System Time : DT; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the PLC program with the input variable b Enable. r Outside Temp: Input for the outside temperature. r Room Temp: Input for the room temperature. r Setpoint Room Temp: Setpoint of the room temperature dt System Time: This variable transfers the computer system time to the function block. b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b On : BOOL; b Invalid Parameter : BOOL; b On: If b On = TRUE summer night cooling is active. The following conditions must be met for activation of summer night cooling: b Enable = TRUE AND r Outside Temp > (r Minimum Outside Temp + 0.2K) AND ((r Room Temp - r Outside Temp) > r Differ Outside Room Temp On) AND ((r Room Temp - r Setpoint Room Temp) > r Differ Room Setpoint Temp) AND the system time dt Systemtime must lie within the timeframe tod Start Time to 12 noon. For the deactivation of summer night cooling b On = FALSE it is sufficient if one of the following condition is met: b Enable = FALSE OR (r Outside Temp < (r Minimum Outside Temp - 0.2K)) OR ((r Room Temp - r Outside Temp) < r Differ Outside Room Temp Off) OR the system time dt Systemtime lies outside the timeframe of tod Start Time to 12 noon OR the summer night cooling had been active for the specified maximum time t Max Runtime within the timeframe of tod Start Time to 12 noon. Summer night cooling can be switched on several times within this timeframe. b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT r Minimum Outside Temp : REAL; r Differ Outside Room Temp On : REAL; r Differ Outside Room Temp Off : REAL; TF8000 Version: 1.3.0 451
## Page 452

Programming r Differ Room Setpoint Temp : REAL; tod Start Time : TOD; t Max Runtime : TIME; r Minimum Outside Temp: If the outside temperature r Outside Temp falls below the limit value (r Minimum Outside Temp - 0.2 K), the summer night cooling function is disabled, i.e. b On = FALSE. If the outside temperature r Outside Temp exceeds the limit value (r Minimum Outside Temp + 0.2K), then one of the conditions for activating the summer night cooling b On = TRUE is satisfied (4..100). The variable is saved persistently. Preset to 10 °C. r Minimum Outside Temp must be within the specified range. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. r Differ Outside Room Temp On: The difference r Room Temp - r Outside Temp must be greater than the value of r Differ Outside Room Temp On so that one of the conditions for activating the summer night cooling b On = TRUE is satisfied (0..100). ((r Room Temp - r Outside Temp) > r Differ Outside Room Temp On) r Differ Outside Room Temp On must be 0.4 K higher than r Differ Outside Room Temp Off. Furthermore r Differ Outside Room Temp On must be within its specified range. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 5 °C. r Differ Outside Room Temp Off: The difference r Room Temp - r Outside Temp must be less than the absolute value of r Differ Outside Room Temp Off for summer night cooling to be disabled (b On = FALSE). ((r Room Temp - r Outside Temp) < r Differ Outside Room Temp Off) r Differ Outside Room Temp Off must be 0.4 K lower than r Differ Outside Room Temp On. In addition, r Differ Outside Room Temp Off must lie within its range (0..100). If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 2 °C. r Differ Room Setpoint Temp: The room temperature must exceed the room temperature setpoint by this value to meet one of the conditions for activation of summer night cooling (b On = TRUE). ((r Room Temp - r Setpoint Room Temp) > r Differ Room Setpoint Temp) r Differ Room Setpoint Temp must lie within its range (0..100). If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 2 °C. tod Start Time: Start time for the timeframe within which the summer night cooling can be activated (0..24). The timeframe for enabling summer night cooling starts with tod Start Time and ends at 12 noon. tod Start Time must be within its specified range. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 2 o'clock. t Max Runtime: Maximum runtime of the summer night cooling function within the timeframe between tod Start Time and 12 noon (>0s). Summer night cooling can be switched on several times within this timeframe, but the total time cannot exceed t Max Runtime. t Max Runtime must be greater than T#0s. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 20 min. 452 Version: 1.3.0 TF8000
## Page 453

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.31 FB_HVACSummer Night Cooling Ex With this function block, rooms that were heated up on the day before can be cooled down during the night using cool outside air. The summer night cooling function serves to improve the quality of the air and to save electrical energy. Electrical energy for cooling is saved during the first hours of the next summer day. The start conditions for the summer night cooling are defined by parameterizing the FB_HVACSummer Night Cooling function block. The function block can be used to open motor-driven windows or to switch air conditioning systems to summer night cooling mode outside their normal hours of operation. Summer night cooling mode is active if the output variable b On is TRUE. The following conditions must be met for activation of summer night cooling: - b Enable = TRUE - r Outside Temp > (r Minimum Outside Temp + 0.2K); the value 0.2K is an internal constant of the function block. - (r Room Temp - r Outside Temp) > r Differ Outside Temp Room Temp On -(r Room Temp - r Setpoint Room Temp) > r Differ Room Temp Setpoint Room Temp On - udi Sec RT_Max Runtime > 0 For the deactivation of summer night cooling b On = FALSE it is sufficient if one of the following condition is met: - b Enable = FALSE - r Outside Temp < (r Minimum Outside Temp - 0.2K); the value 0.2K is an internal constant of the function block. - (r Room Temp - r Outside Temp) < r Differ Outside Temp Room Temp Off -udi Sec RT_Max Runtime = 0 Summer night cooling can be switched on and off several times within the time udi Sec Max Runtime. Once udi Sec RT_Max Runtime has elapsed the summer night cooling function can only be reactivated if b Enable is FALSE for at lease one PLC cycle. The function block and the summer night cooling function can be enabled via a timer. TF8000 Version: 1.3.0 453
## Page 454

Programming Program flowchart VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; r Outside Temp : REAL; r Room Temp : REAL; r Setpoint Room Temp : REAL; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. 454 Version: 1.3.0 TF8000
## Page 455

Programming NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the PLC program with the input variable b Enable. Once the time udi Sec Max Runtime has elapsed the summer night cooling function can only be reactivated if b Enable is FALSE for at lease one PLC cycle. The function block could be enabled via a timer. r Outside Temp: Input for the outside temperature. r Room Temp: Input for the room temperature r Setpoint Room Temp: Setpoint of the room temperature b Reset: Acknowledge input in the event of a fault. VAR_OUTPUT b On : BOOL; b State Differ Outside Temp Min Outside Temp : BOOL; r State Differ Outside Temp Min Outside Temp : REAL; b State Differ Room Temp Outside Temp : BOOL; r State Differ Room Temp Outside Temp : REAL; b State Differ Room Temp Setpoint Room Temp : BOOL; r State Differ Room Temp Setpoint Room Temp : REAL; udi Sec RT_Max Runtime : UDINT; b Invalid Parameter : BOOL; b On: If b On = TRUE summer night cooling is active. The following conditions must be met for activation of summer night cooling: - b Enable = TRUE - r Outside Temp > (r Minimum Outside Temp + 0.2K); the value 0.2K is an internal constant of the function block. - (r Room Temp - r Outside Temp) > r Differ Outside Temp Room Temp On -(r Room Temp - r Setpoint Room Temp) > r Differ Room Temp Setpoint Room Temp On - udi Sec RT_Max Runtime > 0 For the deactivation of summer night cooling b On = FALSE it is sufficient if one of the following condition is met: - b Enable = FALSE - r Outside Temp < (r Minimum Outside Temp - 0.2K); the value 0.2K is an internal constant of the function block. - (r Room Temp - r Outside Temp) < r Differ Outside Temp Room Temp Off -udi Sec RT_Max Runtime = 0 b State Differ Outside Temp Min Outside Temp: Status display. b State Differ Outside Temp Min Outside Temp is TRUE if r Outside Temp > (r Minimum Outside Temp + 0.2). b State Differ Outside Temp Min Outside Temp is FALSE if r Outside Temp < (r Minimum Outside Temp - 0.2). r State Differ Outside Temp Min Outside Temp: Value of the difference r Outside Temp - r Minimum Outside Temp b State Differ Room Temp Outside Temp: Status display. b State Differ Room Temp Outside Temp is TRUE if (r Room Temp - r Outside Temp) > r Differ Outside Temp Room Temp On. b State Differ Room Temp Outside Temp is FALSE if (r Room Temp - r Outside Temp) < r Differ Outside Temp Room Temp Off. r State Differ Room Temp Outside Temp: Value of the difference r Room Temp - r Outside Temp b State Differ Room Temp Setpoint Room Temp: Status display. b State Differ Room Temp Setpoint Room Temp is TRUE if (r Room Temp - r Setpoint Room Temp) > r Differ Room Temp Setpoint Room Temp On. b State Differ Room Temp Setpoint Room Temp is FALSE if (r Room Temp - r Setpoint Room Temp) <= r Differ Room Temp Setpoint Room Temp On. r State Differ Room Temp Setpoint Room Temp: Value of the difference r Room Temp - r Setpoint Room Temp TF8000 Version: 1.3.0 455
## Page 456

Programming udi Sec RT_Max Runtime: Remaining summer night cooling time. If udi Sec RT_Max Runtime = 0 the summer night cooling function can only be reactivated if b Enable is FALSE for at lease one PLC cycle b Invalid Parameter: Indicates that there is an incorrect input parameter. b Invalid Parameter must be acknowledged with b Reset. VAR_IN_OUT r Minimum Outside Temp : REAL; r Differ Outside Temp Room Temp On : REAL; r Differ Outside Temp Room Temp Off : REAL; r Differ Room Temp Setpoint Room Temp On : REAL; udi Sec Max Runtime : UDINT; r Minimum Outside Temp: If the outside temperature r Outside Temp falls below the limit value (r Minimum Outside Temp - 0.2 K), the summer night cooling function is disabled, i.e. b On = FALSE. If the outside temperature r Outside Temp exceeds the limit value (r Minimum Outside Temp + 0.2K), then one of the conditions for activating the summer night cooling b On = TRUE is satisfied (4..100). r Minimum Outside Temp must be within the specified range. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 10 °C. r Differ Outside Temp Room Temp On: The difference r Room Temp - r Outside Temp must be greater than the value of r Differ Outside Room Temp On so that one of the conditions for activating the summer night cooling b On = TRUE is satisfied (0..10). ((r Room Temp - r Outside Temp) > r Differ Outside Room Temp On) r Differ Outside Room Temp On must be 0.4 K higher than r Differ Outside Room Temp Off. Furthermore r Differ Outside Room Temp On must be within its specified range. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 5 °C. r Differ Outside Temp Room Temp Off: The difference r Room Temp - r Outside Temp must be less than the amount of r Differ Outside Temp Room Temp Off for summer night cooling to be disabled (b On = FALSE). ((r Room Temp - r Outside Temp) < r Differ Outside Room Temp Off) r Differ Outside Room Temp Off must be 0.4 K lower than r Differ Outside Room Temp On. In addition, r Differ Outside Room Temp Off must lie within its range (0..10). If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 2 °C. r Differ Room Temp Setpoint Room Temp On: The room temperature must exceed the room temperature setpoint by this value to meet one of the conditions for activation of summer night cooling (b On = TRUE) (0..10). ((r Room Temp - r Setpoint Room Temp) > r Differ Room Setpoint Temp) r Differ Room Setpoint Temp must lie within its range. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 2 °C. udi Sec Max Runtime: Maximum runtime of the summer night cooling function. Summer night cooling can be switched on and off several times within the time. The remaining summer night cooling time is indicated via the variable udi Sec RT_Max Runtime. udi Sec Max Runtime must be greater than 0. If an incorrect variable value is present, then the last valid variable value, if one, will be taken. If there is no valid last value, operation continues with the default value. b Invalid Parameter is set in the case of an incorrect parameter specification. The variable is saved persistently. Preset to 180. 456 Version: 1.3.0 TF8000
## Page 457

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.32 FB_HVACTime Con This function block converts a TIME variable t Time into the three UDINT variables udi Sec, udi Min and udi Hour, which indicate the seconds, minutes and hours. This conversion is reversible, so that a TIME variable can be formed from seconds, minutes and hours. VAR_IN_OUT udi Sec : UDINT; udi Min : UDINT; udi Hour : UDINT; t Time : TIME; udi Sec: Variable that displays the seconds (0..59). udi Min: Variable that displays the minutes (0..59). udi Hour: Variable that displays the hours (0..1191). t Time: Variable of the type Time. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.33 FB_HVACTime Con Sec This function block converts a TIME variable t Time into a UDINT variable udi Sec, which indicates the seconds. This conversion is reversible, so that a TIME variable can be formed from seconds. VAR_IN_OUT udi Sec : UDINT; t Time : TIME; udi Sec: Variable that displays the seconds (0..4294967) t Time: Variable of the type Time. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher TF8000 Version: 1.3.0 457
## Page 458

Programming 5.1.7.34 FB_HVACTime Con Sec Ms This function block converts a TIME variable t Time into two UDINT variables, udi Sec and udi Ms, which indicate the seconds and milliseconds respectively. The conversion is also reversible, so that a TIME variable can be formed from the seconds and milliseconds. VAR_IN_OUT udi Ms : UDINT; udi Sec : UDINT; t Time : TIME; udi Ms: Variable that displays the milliseconds (0..999). udi Sec: Variable that displays the seconds (0..4294966). t Time: Variable of the type Time. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.7.35 FB_HVACWork This function block serves the recording of the operating hours and the switch-on cycles. Furthermore it is possible to report specified operating times being reached. Recording of operating hours As soon as the input b On reports operation, the operating time is recorded with an internal resolution of 1 sec. The output is in the form of a real value in hours to two decimal places (1/100 h). If no system time with second resolution is available, or if this is disrupted, the clock input b Sys Takt1Hz is used instead after 2 sec. Triggering takes place on a rising edge at this input. The variant with the system time is more exact than the variant with the clock generator on account of the possibility of synchronization via the network. Every rising edge at b On is counted as a switch-on cycle and is available at the output as i Count. 458 Version: 1.3.0 TF8000
## Page 459

Programming VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b On : BOOL; b Reset Hours : BOOL; b Reset Count : BOOL; dt Systemtime : DT; b Start Warn Level : BOOL; b Start Alarm Level : BOOL; b Sys Takt1Hz : BOOL; b Reset : BOOL; NOTICE If E_HVACData Security Type := e HVACData Security Type_Persistent has been selected, the procedure deviates from the standard. After a change, the data are not written to the flash memory with a delay equivalent to g_t HVACWrite Backup Data Time (default t#5s), but constantly only once per hour. This serves to protect the flash memory, as otherwise all persistent data would be written to it every 5 sec if the operating hour counter were to be running. e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b On: Operation signal; the operating time is totaled up as long as the signal is present. The rising edge is counted as the switch-on cycle. b Reset Hours: A rising edge sets the operating hour counter to 0. b Reset Count: A rising edge sets the switch-on cycle counter to 0. dt Systemtime: System time with seconds display. b Start Warn Level: A rising edge at the input resets the output b QWarn Level and restarts the time measurement for this. b Start Alarm Level: A rising edge at the input resets the output b QAlarm Level and restarts the time measurement for this. b Sys Takt1Hz: 1 Hz clock signal as a replacement for dt System Time; if dt System Time is not available, or does not change its value for longer than 2 s, then the clock signal is used as a replacement. b Reset: Acknowledge input in the event of a fault. Resets the flag b Invalid Parameter. VAR_OUTPUT b QAlarm Level : BOOL; b QWarn Level : BOOL; b Invalid Parameter : BOOL; TF8000 Version: 1.3.0 459
## Page 460

Programming b QAlarm Level: Operating hour counter has reached the alarm level. b QWarn Level: Operating hour counter has reached the warning level. b Invalid Parameter: An error occurred during the plausibility check. It is deleted again by b Reset. VAR_IN_OUT r Hours : REAL; ui Count : UINT; ui Warn Level : UINT; ui Alarm Level : UINT; b Enable Warn Level : BOOL; b Enable Alarm Level : BOOL; r Hours: Operating hours with a resolution of 1/100 hours (internally with 1 s). The variable is saved persistently. ui Count: Switch-on cycle counter. The variable is saved persistently. ui Warn Level: Number of operating hours after which a warning is output (0..50000). Upon a rising edge at the input b Start Warn Level the current operating hours count is added to the value ui Warn Level and saved as an absolute operating time. As soon as the operating hours counter has reached this value and the signal is enabled via b Enable Warn Level, the output b QWarn Level is set to TRUE. The variable is saved persistently. Preset to 0 h. ui Alarm Level: Number of operating hours after which an alarm is output (0..50000). Upon a rising edge at the input b Start Alarm Level the current operating hours count is added to the value ui Alarm Level and saved as an absolute operating time. As soon as the operating hours counter has reached this value and the signal is enabled via b Enable Alarm Level, the output b QAlarm Level is set to TRUE. The variable is saved persistently. Preset to 0 h. b Enable Warn Level: Enables the output b QWarn Level. The variable is saved persistently. Preset to FALSE. b Enable Alarm Level: Enables the output b QAlarm Level. The variable is saved persistently. Preset to FALSE. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.8 HVAC Time schedule 5.1.8.1 FB_HVACScheduler1ch This function block is a weekly scheduler with one channel. Any desired combination of days of the week can be assigned to the channel. The channel can be defined for one-shot or recurring events. Besides the switching signal, the switch-on and switch-off edges plus the next switch-on or switch-off time as a countdown are available as outputs. The data of the channel are transferred as a reference. The function block is therefore able to check the data for changes and to save it as persistent data. After booting, the data are thus available to the BMS again. The switch-on and switch-off points can be specified to the exact second via the variables ti On_ss and ti Off_ss of the respective time channel. 460 Version: 1.3.0 TF8000
## Page 461

Programming If the input variable b Enable = FALSE, then the output b Output = FALSE. The channel st Time Channel remains active. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; dt System Time : DT; ui Offset Before : UINT; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the variable b Enable. If b Enable = FALSE there is no switching at the output b Output. dt System Time: The variable dt System Time transfers the computer system time to the timer program. ui Offset Before: The switch-on time is brought forward by this number of minutes. This function is useful for the time-optimized switching on of heating circuits. A maximum of 240 min, i.e. 4 hours, may be entered. If the resulting switch-on time is before midnight on the previous day, then midnight will be chosen as the switch-on time. The switch-off time is not affected. b Reset: Acknowledge input in the event of a fault. Resets the flag b Invalid Parameter Example 1: Switch-on period from 1:30 to 5:30; ui Offset Befor has the value 150 min. The switch-on time is brought forward by only 90 minutes to 0:00. Example 2: Switch-on period from 13:30 to 17:30; ui Offset Befor has the value 150 min. The switch-on time is brought forward by 150 minutes to 11:00. TF8000 Version: 1.3.0 461
## Page 462

Programming VAR_OUTPUT b Output : BOOL; b Edge On : BOOL; b Edge Off : BOOL; t Next On : TIME; t Next Off : TIME; b Invalid Parameter: BOOL; b Output: Is TRUE if one of the channels has switched on. b Edge On: Is TRUE for one PLC cycle after b Output switches on. b Edge Off: Is TRUE for one PLC cycle after b Output switches off. t Next On: Time until the next switch-on of the program. Maximum value 10080 minutes (1 week). t Next Off: Time until the next switch-off of the program. Maximum forecast until midnight. b Invalid Parameter: An error occurred during the plausibility check. It is deleted again by b Reset. VAR_IN_OUT st Time Channel : ST_HVACTime Channel; st Time Channel: With the variable st Time Channel it is possible to generate one switch-on time per day of the week (see ST_HVACTime Channel [} 498]). Special notes regarding time input The following applies: • Switch-on time 00:00:00: Switch on begins at 0.00 on the selected day. • Switch-off time 00:00:00: Switch-off takes place at 23:59:59 on the selected day. The following applies: If the switch-on time is later than the switch-off time, the switch-on period is extended through midnight into the next day, regardless of whether the next day is selected. This setting produces: 462 Version: 1.3.0 TF8000
## Page 463

Programming For each instance of the function block FB_HVACScheduler1ch it is necessary to create a structure variable of type ST_HVACTime Channel, which is transferred as a reference (VAR_IN_OUT). Example: VAR_GLOBAL st Time Channel : ST_HVACTime Channel; END_VAR Within the weekly planner each channel is enabled via the variable b Enable (On/Off). If b Enable = FALSE, then the channel is deactivated and the times entered have no effect. If b All Days (Mon-Sun) = TRUE, then the times set in ui On_hh, ui On_mm, ui Off_hh and ui Off_mm apply to all days of the week from Monday to Sunday. If b All Days is FALSE, then the days of the week can be selectively assigned to a channel using the variables b Monday to b Sunday. For one-shot events, the variable b Reset After On (non-recurring) is activated. After the time set in this channel has elapsed, the entries created under ui On_hh, ui On_mm, ui Off_hh, ui Off_mm and the days of the week are retained. However, the variable b Enable (On/Off) is reset to FALSE. In this manner a one-shot event can be defined once and reactivated whenever it is required. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.8.2 FB_HVACScheduler7ch This function block is a weekly scheduler with 7 channels. Any desired combination of days of the week can be assigned to any channel. The channels can be defined for non-recurring or recurring events. Besides the switching signal, the switch-on and switch-off edges plus the next switch-on or switch-off time as a countdown are available as outputs. The data of the channels is transferred as a reference. The function block is therefore able to check the data for changes and to save it as persistent data. After booting, the data are thus available to the BMS again. The switch-on and switch-off points can be specified to the exact second via the variables ti On_ss and ti Off_ss of the respective time channel. If the input variable b Enable = FALSE, then the output b Output = FALSE. The channels arr Time Channel remain active. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; dt System Time : DT; ui Offset Before : UINT; b Reset : BOOL; TF8000 Version: 1.3.0 463
## Page 464

Programming e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the variable b Enable. If b Enable = FALSE there is no switching at the output b Output. dt System Time: The variable dt System Time transfers the computer system time to the timer program. ui Offset Before: The switch-on time is brought forward by this number of minutes. This function is useful for the time-optimized switching on of heating circuits. A maximum of 240 min, i.e. 4 hours, may be entered. If the resulting switch-on time is before midnight on the previous day, then midnight will be chosen as the switch-on time. The switch-off time is not affected. b Reset: Acknowledge input in the event of a fault. Resets the flag b Invalid Parameter. Example 1: Switch-on period from 1:30 to 5:30; ui Offset Before has the value 150 min. The switch-on time is brought forward by only 90 minutes to 0:00. Example 2: Switch-on period from 13:30 to 17:30; ui Offset Before has the value 150 min. The switch-on time is brought forward by 150 minutes to 11:00. 464 Version: 1.3.0 TF8000
## Page 465

Programming VAR_OUTPUT b Output : BOOL; b Edge On : BOOL; b Edge Off : BOOL; t Next On : TIME; t Next Off : TIME; b Invalid Parameter : BOOL; b Output: Is TRUE if one of the channels has switched on. b Edge On: Is TRUE for one PLC cycle after b Output switches on. b Edge Off: Is TRUE for one PLC cycle after b Output switches off. t Next On: Time until the next switch-on of the program. Maximum value 10080 minutes (1 week). t Next Off: Time until the next switch-off of the program. Maximum forecast until midnight (1440 min). b Invalid Parameter: An error occurred during the plausibility check. It is deleted again by b Reset. VAR_IN_OUT arr Time Channel : ARRAY[1..7] OF ST_HVACTime Channel; arr Time Channel: The variable arr Time Channel is an array with 7 declarations of the structure variable ST_HVACTime Channel (see ST_HVACTime Channel [} 498]). It is possible to generate 1 switch-on time per day of the week with the 7 channels. Special notes regarding time input The following applies: • Switch-on time 00:00:00: Switch on begins at 0.00 on the selected day. • Switch-off time 00:00:00: Switch-off takes place at 23:59:59 on the selected day. The following applies: If the switch-on time is later than the switch-off time, the switch-on period is extended through midnight into the next day, regardless of whether the next day is selected. This setting produces: An array of the type ST_HVACTime Channel (see ST_HVACTime Channel [} 498]) must be generated for each instance of the function block FB_HVACScheduler7ch. The size of the array must be 7, since the function block processes a total of 7 weekly switch cycles and expects these as a reference (VAR_IN_OUT). TF8000 Version: 1.3.0 465
## Page 466

Programming Example VAR_GLOBAL arr Time Channel : ARRAY[1..7] OF ST_HVACTime Channel; END_VAR Within the weekly planner each channel is enabled via the variable b Enable (On/Off). If b Enable = FALSE, then the channel is deactivated and the times entered have no effect. If b All Days (Mon-Sun) = TRUE, then the times set in ui On_hh, ui On_mm, ui Off_hh and ui Off_mm apply to all days of the week from Monday to Sunday. If b All Days is FALSE, then the days of the week can be selectively assigned to a channel using the variables b Monday to b Sunday. For one-shot events, the variable b Reset After On (non-recurring) is activated. After the time set in this channel has elapsed, the entries created under ui On_hh, ui On_mm, ui Off_hh, ui Off_mm and the days of the week are retained. However, the variable b Enable (On/Off) is reset to FALSE. In this manner a one-shot event can be defined once and reactivated whenever it is required. Example Monday switched on from 07:20 until 17:30 Tuesday switched on from 16:40 until 00:00 Wednesday switched on from 00:00 until 23:59:59 (around the clock – 24 hours!) Thursday switched on from 15:00 until 03:00 Friday morning, non-recurring! Friday channel not activated, always switched off! Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.8.3 FB_HVACScheduler7TCHandling 466 Version: 1.3.0 TF8000
## Page 467

Programming This function block can be used to select and modify an individual line from the data array of a weekly timer. In this way it is easily possible to edit the data sets with a visualization that only offers a low graphic resolution, without having to show all the data of the array. The data set from arr7Time Channel with index i Curr Channel Number is copied to data structure st Curr Channel. Modifications of the data in structure st Curr Channel take effect immediately and are transferred to array arr7Time Channel . VAR_INPUT b Go Channel Up : BOOL; b Go Channel Down : BOOL; b Go Channel Up: With a positive edge the focus is placed on the next higher index in the data array arr7Time Channel. b Go Channel Down: With a positive edge the focus is placed on the next lower index in the data array arr7Time Channel. VAR_IN_OUT arr7Time Channel : ARRAY[1..7] OF ST_HVACTime Channel; st Curr Channel : ST_HVACTime Channel; i Curr Channel Number : INT; i Num Of Channels To Use: INT; arr7Time Channel: Array of the data sets of the timer FB_HVACScheduler7ch (see ST_HVACTime Channel [} 498]). st Curr Channel: Contains the contents of the data set from the array arr7Time Channel, which is selected via the variable i Curr Channel Number (see ST_HVACTime Channel [} 498]). i Curr Channel Number: Selection index for the array arr7Time Channel. i Num Of Channels To Use: Maximum (7) permissible index for i Curr Channel Number in case not all channels are needed. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.8.4 FB_HVACScheduler28ch This function block is a weekly scheduler with 28 channels. Any desired combination of days of the week can be assigned to any channel. The channels can be defined for non-recurring or recurring events. Besides the switching signal, the switch-on and switch-off edges plus the next switch-on or switch-off time as a countdown are available as outputs. The data of the channels is transferred as a reference. The function block is therefore able to check the data for changes and to save it as persistent data. After booting, the data are thus available to the BMS again. The switch-on and switch-off points can be specified to the exact second via the variables ti On_ss and ti Off_ss of the respective time channel. TF8000 Version: 1.3.0 467
## Page 468

Programming If the input variable b Enable = FALSE, then the output b Output = FALSE. The channels arr Time Channel remain active. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; dt System Time : DT; ui Offset Before : UINT; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the variable b Enable. If b Enable = FALSE there is no switching at the output b Output. dt System Time: The variable dt System Time transfers the computer system time to the timer program. ui Offset Before: The switch-on time is brought forward by this number of minutes. This function is useful for the time-optimized switching on of heating circuits. A maximum of 240 min, i.e. 4 hours, may be entered. If the resulting switch-on time is before midnight on the previous day, then midnight will be chosen as the switch-on time. The switch-off time is not affected. b Reset: Acknowledge input in the event of a fault. Resets the flag b Invalid Parameter. Example 1 Switch-on period from 1:30 to 5:30; ui Offset Befor has the value 150 min. The switch-on time is brought forward by only 90 minutes to 0:00. Example 2 Switch-on period from 13:30 to 17:30; ui Offset Befor has the value 150 min. The switch-on time is brought forward by 150 minutes to 11:00. 468 Version: 1.3.0 TF8000
## Page 469

Programming VAR_OUTPUT b Output : BOOL; b Edge On : BOOL; b Edge Off : BOOL; t Next On : TIME; t Next Off : TIME; b Invalid Parameter : BOOL; b Output: Is TRUE if one of the channels has switched on. b Edge On: Is TRUE for one PLC cycle after b Output switches on. b Edge Off: Is TRUE for one PLC cycle after b Output switches off. t Next On: Time until the next switch-on of the program. Maximum value 10080 minutes (1 week). t Next Off: Time until the next switch-off of the program. Maximum forecast until midnight. Maximum value 1440 minutes. b Invalid Parameter: An error occurred during the plausibility check. It is deleted again by b Reset. VAR_IN_OUT arr Time Channel : ARRAY[1..28] OF ST_HVACTime Channel; arr Time Channel: The variable arr Time Channel is an array with 28 declarations of the structure variable ST_HVACTime Channel (see ST_HVACTime Channel [} 498]). It is possible to generate up to 3 switch-on times per day of the week with the 28 channels. Special notes regarding time input The following applies: • Switch-on time 00:00:00: Switch on begins at 0.00 on the selected day. • Switch-off time 00:00:00: Switch-off takes place at 23:59:59 on the selected day. The following applies: If the switch-on time is later than the switch-off time, the switch-on period is extended through midnight into the next day, regardless of whether the next day is selected. This setting produces: TF8000 Version: 1.3.0 469
## Page 470

Programming For each instance of the function block FB_HVACScheduler28ch it is necessary to create an array of type ST_HVACTime Channel. The size of the array must be 28, since the function block processes a total of 28 weekly cycles and expects these as a reference (VAR_IN_OUT). Example VAR_GLOBAL arr Time Channel : ARRAY[1..28] OF ST_HVACTime Channel; END_VAR Within the weekly planner each time switch channel is enabled via the variable b Enable (On/Off). If b Enable = FALSE, then the time switch channel is deactivated and the times entered have no effect. If b All Days (Mon-Sun) = TRUE, then the times set in ui On_hh, ui On_mm, ui Off_hh and ui Off_mm apply to all days of the week from Monday to Sunday. If b All Days is FALSE, then the days of the week can be selectively assigned to a time switch channel using the variables b Monday to b Sunday. For one-shot events, the variable b Reset After On (non-recurring) is activated. After the time set in this channel has elapsed, the entries created under ui On_hh, ui On_mm, ui Off_hh, ui Off_mm and the days of the week are retained. However, the variable b Enable (On/Off) is reset to FALSE. In this manner a one-shot event can be defined once and reactivated whenever it is required. Example Monday switched on from 07:20 until 17:30 Tuesday switched on from 16:40 until 00:00 Wednesday switched on from 00:00 until 23:59:59 (around the clock – 24 hours!) Thursday switched on from 15:00 until 03:00 Friday morning, non-recurring! Friday Time switch channel not activated, always switched off! Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 470 Version: 1.3.0 TF8000
## Page 471

Programming 5.1.8.5 FB_HVACScheduler28TCHandling This function block can be used to select and modify an individual line from the data array of a weekly timer. In this way it is easily possible to edit the data sets with a visualization that only offers a low graphic resolution, without having to show all the data of the array. The data set from arr7Time Channel with index i Curr Channel Number is copied to data structure st Curr Channel. Modifications of the data in structure st Curr Channel take effect immediately and are transferred to array arr28Time Channel . VAR_INPUT b Go Channel Up : BOOL; b Go Channel Down : BOOL; b Go Channel Up: With a positive edge the focus is placed on the next higher index in the data array arr28Time Channel. b Go Channel Down: With a positive edge the focus is placed on the next lower index in the data array arr28Time Channel. VAR_IN_OUT arr28Time Channel : ARRAY[1..28]OF ST_HVACTime Channel; st Curr Channel : ST_HVACTime Channel; i Curr Channel Number : INT; i Num Of Channels To Use : INT; arr28Time Channel: Array of the data sets (28) of the timer FB_HVACScheduler28CH. st Curr Channel: Contains the contents of the data set from the array arr28Time Channel, which is selected via the variable i Curr Channel Number (see ST_HVACTime Channel [} 498]). i Curr Channel Number: Selection index for the array arr28Time Channel. i Num Of Channels To Use: Maximum permissible index for i Curr Channel Number, if not all channels are used. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.8.6 FB_HVACScheduler Public Holidays This function block is a yearly scheduler in which, e.g., school holidays or factory shutdowns can be entered. The function block is enabled by the input variable b Enable. The input dt System Time is linked to the current system time. The output b Output is set if the switching conditions are satisfied. Besides the switching signal, the switch-on and switch-off edges plus the next switch-on or switch-off time as a countdown are available TF8000 Version: 1.3.0 471
## Page 472

Programming as outputs. The data of the channels is transferred as a reference. The function block is therefore able to check the data for changes and to save it as persistent data. After booting, the data are thus available to the BMS again. As opposed to the FB_HVACScheduler Special Periods [} 473], only daily switching is possible here. If the input variable b Enable = FALSE, then the output b Output = FALSE. The channels arr Holiday remain active. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; dt System Time : DT; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the variable b Enable. If b Enable = FALSE there is no switching at the output b Output. dt System Time: The variable dt System Time transfers the computer system time to the timer program. b Reset: Acknowledge input in the event of a fault. Resets the flag b Invalid Parameter. VAR_OUTPUT b Output : BOOL; b Edge On : BOOL; b Edge Off : BOOL; t Next On : TIME; t Next Off : TIME; b Invalid Parameter : BOOL; b Output: Is TRUE if one of the timer switch channels has switched on. b Edge On: Is TRUE for one PLC cycle after b Output switches on. b Edge Off: Is TRUE for one PLC cycle after b Output switches off. t Next On: Time until the next switch-on of the timer program (max. 50 days). t Next Off: Time until the next switch-off of the timer program (max. 50 days). b Invalid Parameter: An error occurred during the plausibility check. It is deleted again by b Reset. 472 Version: 1.3.0 TF8000
## Page 473

Programming VAR_IN_OUT arr Holiday : ARRAY[1..20] OF ST_HVACHoliday; arr Holiday: The variable arr Holiday is an array with 20 declarations of the structure variable ST_HVACHoliday (see ST_HVACHoliday [} 495]). For each instance of the function block FB_HVACScheduler Public Holidays it is necessary to create an array of type ST_HVACHoliday. The size of the array must be 20, since the function block processes a total of 20 time channels and expects these as a reference (VAR_IN_OUT). Each channel is enabled with the variable b Enable (On/Off). If b Enable = FALSE, then the channel is deactivated and the times entered have no effect. For one-shot events, the variable b Reset After On (non- recurring) is activated. After the time set in this channel has elapsed, the entries created under ui On_Day, ui Off_Day, ui On_Month and ui Off_Month are retained. However, the variable b Enable (On/Off) is reset to FALSE. In this manner a one-shot event can be defined once and reactivated whenever it is required. Example switched on from 24/12 00:00 until 26/12 23:59:59 switched on from 03/10 00:00 until 03/10 23:59:59 switched on from 18/07 00:00 until 19/07 23:59:59 1.1. until 1.1. channel not activated, always switched off! Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.8.7 FB_HVACScheduler Special Periods This function block is a yearly scheduler in which, e.g., school holidays or factory shutdowns can be entered. The function block is enabled by the input variable b Enable. The input dt System Time is linked to the current system time. The output b Output is set if the switching conditions are satisfied. Besides the switching signal, TF8000 Version: 1.3.0 473
## Page 474

Programming the switch-on and switch-off edges plus the next switch-on or switch-off time as a countdown are available as outputs. The data of the channels is transferred as a reference. The function block is therefore able to check the data for changes and to save it as persistent data. After booting, the data are thus available to the BMS again. The switch-on and switch-off times on the respective day can be entered to the exact minute. If the input variable b Enable = FALSE, then the output b Output = FALSE. The channels arr Period remain active. VAR_INPUT e Data Security Type : E_HVACData Security Type; b Set Default : BOOL; b Enable : BOOL; dt System Time : DT; b Reset : BOOL; e Data Security Type: If e Data Security Type [} 490]:= e HVACData Security Type_Persistent, the persistent VAR_IN_OUT variables of the function block are stored in the flash of the computer if a value changes. For this to work, the function block FB_HVACPersistent Data Handling [} 479] must be instanced once in the main program, which is called cyclically. Otherwise the instanced FB is not released internally. A change of value can be initiated by the building management system, a local operating device or via a write access from Twin CAT. When the computer is restarted the saved data are automatically read back from the flash into the RAM. Application example: https://infosys.beckhoff.com/content/1033/TF8000_TC3_HVAC/Resources/ 5090272523.zip If e Data Security Type [} 490]:= e HVACData Security Type_Idle the persistently declared variables are not saved in a fail-safe manner. NOTICE A cyclically changing variable must never be linked with the IN_OUT variable of a function block, if e Data Security Type [} 490]:= e HVACData Security Type_Persistent. It would lead to early wear of the flash memory. b Set Default: If the variable is TRUE, the default values of the VAR_IN_OUT variables are adopted. b Enable: The function block is enabled by the variable b Enable. If b Enable = FALSE there is no switching at the output b Output. dt System Time: The variable dt System Time transfers the computer system time to the timer program. b Reset: Acknowledge input in the event of a fault. Resets the flag b Invalid Parameter. VAR_OUTPUT b Output : BOOL; b Edge On : BOOL; b Edge Off : BOOL; t Next On : TIME; t Next Off : TIME; b Invalid Parameter : BOOL; b Output: Is TRUE if one of the channels has switched on. b Edge On: Is TRUE for one PLC cycle after b Output switches on. b Edge Off: Is TRUE for one PLC cycle after b Output switches off. t Next On: Time until the next switch-on of the timer program (max. 50 days). t Next Off: Time until the next switch-off of the timer program (max. 50 days). b Invalid Parameter: An error occurred during the plausibility check. It is deleted again by b Reset. 474 Version: 1.3.0 TF8000
## Page 475

Programming VAR_IN_OUT arr Period : ARRAY[1..20] OF ST_HVACPeriod; arr Period: The variable arr Period is an array with 20 declarations of the structure variable ST_HVACPeriod (see ST_HVACPeriod [} 496]). For each instance of the function block FB_HVACScheduler Special Periods it is necessary to create an array of type ST_HVACPeriod. The size of the array must be 20, since the function block processes a total of 20 time channels and expects these as a reference (VAR_IN_OUT). Special notes regarding time input The following applies: Switch-on time 00:00:00: Switch on begins at 0.00 on the selected day. Switch-off time 00:00:00: Switch-off takes place at 23:59:59 on the selected day. Each channel is enabled via the variable b Enable (On/Off). If b Enable = FALSE, then the channel is deactivated and the times entered have no effect. For one-shot events, the variable b Reset After On (non- recurring) is activated. After the time set in this channel has elapsed, the entries created under ui On_hh, ui On_mm, ui Off_hh, ui Off_mm, ui On_Day, ui Off_Day, ui On_Month and ui Off_Month are retained. However, the variable b Enable (On/Off) is reset to FALSE. In this manner a one-shot event can be defined once and reactivated whenever it is required. Example: 12/01 switched on from 12:20 until 14/01 at 12:00 switched on from 23/06 00:00 until 25/08 23:59:59 switched on from 03/10 12:00 until 03/10 at 18:00, one-shot! 1.1. until 1.1. channel not activated, always switched off! TF8000 Version: 1.3.0 475
## Page 476

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.9 HVAC System 5.1.9.1 FB_HVACGet System Time With this function block an internal clock (Real Time Clock RTC) can be implemented in the Twin CAT PLC. When the function block is enabled via b Enable, the RTC clock is initialized with the current NT system time. One system cycle of the CPU is used to calculate the current RTC time. The function block must be called once per PLC cycle in order for the current time to be calculated. Internally an instance of the function blocks NT_Get Time and RTC_EX2 is called in the function block from the Utilities library. Due to system characteristics the RTC time deviates from a reference time. The difference depends on the PLC's cycle time, the value of the basic system ticks, and on the hardware being used. The RTC is therefore synchronized internally in the function block with the NT system time depending on the input variables s NETID and t Get System Time. The local NT system time can, in turn, be synchronized with a reference time with the aid of the SNTP protocol. For further information please refer to the Beckhoff Information System under: Beckhoff Information System > Industrial PC > Operating systems > CE > SNTP: Simple Network Time Protocol VAR_INPUT b Enable : BOOL; s NETID : T_Ams Net Id; t Get System Time : TIME; b Get System Time : BOOL; b Enable: Enables the function block. If b Enable = TRUE, then the RTC clock is initialized with the NT system time. s NETID: It is possible here to provide the Ams Net Id of the Twin CAT computer whose NT system time is to be found. If it is to be run on the local computer, an empty string can be entered. t Get System Time: Time specification with which the RTC clock is regularly synchronized with the NT system time. This time specification must be greater than or equal to 5 seconds, otherwise the RTC clock will not be synchronized. Parallel to the time specification t Get System Time, the RTC clock can be synchronized via the input variable b Get System Time. b Get System Time: The RTC clock is synchronized with the NT system time with a rising edge at this input. This takes place in parallel with the time specification t Get System Time. 476 Version: 1.3.0 TF8000
## Page 477

Programming VAR_OUTPUT b Ready Get System Time : BOOL; b Ready RTC : BOOL; st System Time : TIMESTRUCT; dt System Time : DT; ui Year : UINT; ui Month : UINT; ui Day : UINT; ui Day Of Week : UINT; ui Hour : UINT; ui Minute : UINT; ui Second : UINT; ui Milliseconds : UINT; b Error Get System Time : BOOL; udi Error Id Get System Time : UDINT; b Ready Get System Time: The function block was successfully initialized or synchronized with the NT system time. b Ready RTC: This output is set if the function block has been initialized at least once. If this output is set, then the values for date, time and milliseconds at the outputs are valid. st System Time: Structure with the current RTC time. dt System Time: Date and time of day of the RTC time. ui Year: The year: 1970 ~ 2106; ui Month: The month: 1 ~ 12 (January = 1, February = 2 etc.); ui Day: The day of the month: 1 ~ 31; ui Day Of Week: The day of the week: 0 ~ 6 (Sunday = 0, Monday = 1 etc.); ui Hour: Hour: 0 ~ 23; ui Minute: Minute: 0 ~ 59; ui Second: Second: 0 ~ 59; ui Milliseconds: Millisecond: 0 ~ 999; b Error Get System Time: This output is set in the event that an ADS error occurs when transmitting the command. The output indicates with a TRUE that an error has occurred during initialization or synchronization with the NT system time. The function block continues to attempt to initialize or synchronize the RTC clock until the error has been rectified. The RTC clock starts with an incorrect date and time specification and must therefore be synchronized with the NT system time. udi Error Id Get System Time: Returns the ADS error number (see ADS Return Codes) if a b Error Get System Time output is set Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.9.2 FB_HVACNOVRAMData Handling TF8000 Version: 1.3.0 477
## Page 478

Programming PLC variables are written fail-safe to NOVRAM with this function block. Following a power failure or a restart of the controller, the NOVRAM will be read out completely. The behavior of the function block is as follows if everything was correct when starting: udi Status:= 1; i Nov Ram Read Count:= 1; i Nov Ram Write Count:= 0; b Done:= TRUE; In the case of ARM-based runtime systems, please make sure that the memory addresses of the PLC variables are divisible by 4! The globally declared variables g_dw HVACVar Config Start and g_dw HVACVar Config End are located with the start address and end address of the memory area. The user must take care to ensure that there are no memory overlaps. The block size is then determined internally from the two addresses. The entire flag area is written automatically to NOVRAM in the event of changes to the flag variables. VAR_INPUT s NETID : T_Ams Net Id; TMOUT : TIME; udi Dev ID : UDINT; usi Block Size : USINT; s NETID: Ams Net Id of the Twin CAT computer on which the function should be executed. If it is to be run on the local computer, an empty string can be entered. TMOUT: States the length of the timeout that may not be exceeded by execution of the ADS command. udi Dev ID: The Device ID specifies the NOVRAM of the CX90xx or CX10xx to be accessed with the function block for reading or writing. The device IDs are specified by the Twin CAT System Manager during hardware configuration. usi Block Size: The block size to be accessed per read/write cycle is specified in percent; e.g. 20, i.e. 5 read/ write cycles will be required in order to access the entire flag area. VAR_OUTPUT udi Status : UDINT; i Novram Read Count : INT; i Novram Write Count : INT; b Done : BOOL; b Busy : BOOL; b Error : BOOL; udi Error ID : UDINT; udi Status: = 0 , no state = 1, valid data at last reading of NOVRAM = 2, invalid data at last reading of NOVRAM. Data were discarded. 478 Version: 1.3.0 TF8000
## Page 479

Programming i Novram Read Count: Counter that is incremented by 1 when NOVRAM is read from. i Novram Write Count: Counter that is incremented by 1 when NOVRAM is written to. b Done: Will be set to TRUE if the function block is executed. b Busy: When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error: This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in udi Error ID. udi Error ID: Contains the command-specific error code (see ADS Return Codes). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.9.3 FB_HVACPersistent Data Handling With this function block, all PLC variables that are declared as persistent (VAR PERSISTENT) are written fail-safe to a file. The PLC variables declared as persistent within the function blocks from the Tc2_HVAC are written to this file in case of a change. This file is saved in the ..\Twin CAT\3.1\Boot\PLC directory and is named as follows: Port_c.bootdata (x = number of the runtime system). So that the new status is not saved immediately after a change of the persistent variables, a timeframe of 5 sec is built into the standard setting. This timeframe can be changed by the user. He must assign the new time to the globally declared constant parameter g_t HVACWrite Backup Data Time: TIME := t#5s. The new status is only saved after the timeframe has elapsed. In the worst case this can mean that changes made within the last timeframe are not saved if a power failure occurs during that time. Each time the controller is restarted, the status of the persistent data is read from the file. The output variable udi Status indicates whether or not the data is valid. In order to secure the persistent variables inside the function block voltage failure safe, it is necessary to start an instance of the FB_HVACPersistent Data Handling block in the MAIN program. The behavior of the function block is as follows if everything was correct when starting: udi Status:= 1; i Persist Count:= 1; b Done:= FALSE; If the result of the query of usi Status is 1, this means that the persistent variables have been read from the memory. b Done only goes TRUE if the persistent variables have been written successfully. Setting: The following setting must be made in Twin CAT: The option Delete invalid persistent data must be deactivated under PLC Configuration on the PLC Settings tab!! TF8000 Version: 1.3.0 479
## Page 480

Programming VAR_INPUT s NETID : T_Ams Net Id; TMOUT : TIME; e Persistent Mode : E_Persistent Mode; s NETID: Ams Net Id of the Twin CAT computer on which the function should be executed. If it is to be run on the local computer, an empty string can be entered. TMOUT: States the length of the timeout that may not be exceeded by execution of the ADS command. e Persistent Mode: Mode in which the persistent data should be written. Also see E_Persistent Mode (see Tc2_Utilities library). VAR_OUTPUT udi Status : UDINT; i Persist Count : INT; b Done : BOOL; b Busy : BOOL; b Error : BOOL; udi Error ID : UDINT; udi Status: 0 = No status 1 = Persistent data read successfully 2 = Backup from persistent data read 3 = Neither persistent nor backup data read i Persist Count: Counter that is incremented by 1 after successful writing. b Done: Will be set to TRUE if the function block is executed. b Busy: When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error: This output is set to TRUE if an error occurs during the execution of a command. udi Error ID: Contains the command-specific error code (see ADS Return Codes). Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 480 Version: 1.3.0 TF8000
## Page 481

Programming 5.1.9.4 FB_HVACPersistent Data File Copy This function block can be used, for instance, to copy binary files on the local Twin CAT PC or from a remote Twin CAT PC to the local Twin CAT PC. Network drives cannot be accessed. The following steps are executed upon a rising edge at the input b Execute: a) Open the source and destination files; b) Read the source file into a buffer; c) Write the bytes that have been read from the buffer into the destination file; d) Check whether the end of the source file has been reached. If not, then repeat b) and c). If yes, then jump to e); e) Close the source and destination files; The file is copied one segment at a time. In this function block, the size of the buffer has been specified as 100 bytes, but this can be modified. VAR_INPUT src NETID : T_Ams Net Id; src File Name : T_Max String; dest NETID : T_Ams Net Id; dest File Name : T_Max String b Execute : BOOL; t Ads Time Out : TIME; src NETID: Ams Net Id of the Twin CAT computer on which the function should be executed. If it is to be run on the local computer, an empty string can be entered. src File Name: Contains the path and file name for the file to be opened. Note: The path can only point to the local computer’s file system! This means that network paths cannot be used here! dest NETID: Ams Net Id of the Twin CAT computer on which the file should be copied. dest File Name: Contains the path and the file name of the destination file. Note: The path can only point to the local computer’s file system! This means that network paths cannot be used here! b Execute: The steps listed above are executed upon a rising edge at input b Execute. t Ads Time Out: States the length of the timeout that may not be exceeded by execution of the ADS command. VAR_OUTPUT b Done : BOOL; b Busy : BOOL; b Error : BOOL; udi Error ID : UDINT; b Done: Will be switched to TRUE if the function block is executed. b Busy: When the function block is activated the output is set, and it remains active until execution of the command has been completed. b Error: This output is switched to TRUE as soon as an error occurs during the execution of a command. udi Error ID: Contains the command-specific error code (see ADS Return Codes). TF8000 Version: 1.3.0 481
## Page 482

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.9.5 FB_HVACSet Local Time The local NT system time and the date of a Twin CAT system can be set with the function block FB_HVACSet Local Time (the local NT system time is shown in the taskbar). The system time can be specified either via the individual variables ui Year, ui Month, ui Day, ui Hour, ui Minute and ui Second or via the structure st Systemtime, see b Enable Struct. Internally, an instance of the function block NT_Set Local Time from the Tc Utilities library is called in the function block. The local NT system time can also be synchronized with a reference time with the aid of the SNTP protocol. For further information please refer to the Beckhoff Information System under: Beckhoff Information System > Industrial PC > Operating systems > CE > SNTP: Simple Network Time Protocol 482 Version: 1.3.0 TF8000
## Page 483

Programming VAR_INPUT s Net Id : T_Ams Net Id; b Set Local Time : BOOL; ui Year : UINT; ui Month : UINT; ui Day : UINT; ui Hour : UINT; ui Minute : UINT; ui Second : UINT; b Enable Struct : BOOL; st Systemtime : TIMESTRUCT; t Timeout : TIME; s NETID: This parameter can be used to specify the Ams Net ID of the Twin CAT computer, whose local NT system time is to be set. If applicable, an empty string s Net Id := ''; can be specified for the local computer. b Set Local Time: Activation of the function block with a rising edge. ui Year: The year: 1970 ~ 2106; the variable is active if b Enable Struct = FALSE. If specified incorrectly, b Invalid Parameter = TRUE and the new local NT system time was not set. ui Month: The month: 1 ~ 12 (January = 1, February = 2 and so on); the variable is active if b Enable Struct = FALSE. If specified incorrectly, b Invalid Parameter = TRUE and the new local NT system time was not set. ui Day: The day of the month: 1 ~ 31; February with 28 or 29 days and the months with 30 or 31 days are checked. The variable is active if b Enable Struct = FALSE. If specified incorrectly, b Invalid Parameter = TRUE and the new local NT system time was not set. ui Hour: Hour: 0 ~ 23; the variable is active if b Enable Struct = FALSE. If specified incorrectly, b Invalid Parameter = TRUE and the new local NT system time was not set. ui Minute: Minute: 0 ~ 59; the variable is active if b Enable Struct = FALSE. If specified incorrectly, b Invalid Parameter = TRUE and the new local NT system time was not set. ui Second: Second: 0 ~ 59; the variable is active if b Enable Struct = FALSE. If specified incorrectly, b Invalid Parameter = TRUE and the new local NT system time was not set. b Enable Struct: If b Enable Struct = TRUE, the new local NT system time is set via the input variable st Systemtime. If b Enable Struct = FALSE, the new local NT system time is set via the input variables ui Year, ui Month, ui Day, ui Hour, ui Minute and ui Second. st Systemtime: Structure with the new local NT system time. The structure is active if b Enable Struct = TRUE. The same ranges apply to the structure as to the input variables ui Year, ui Month, ui Day, ui Hour, ui Minute and ui Second. If specified incorrectly, b Invalid Parameter = TRUE and the new local NT system time was not set. t Timeout: Indicates the timeout time [s], which must not be exceeded during execution. VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; b Invalid Parameter : BOOL; b Busy: If the function block is activated via a rising edge at b Set Local Time, this output is set and remains set until feedback occurs. b Error: This output is set if an error occurs during the transfer of the NT system time. b Error is reset by the activation of the function block via the input variable b Set Local Time. udi Error Id: Returns the ADS error code if b Error is set (see ADS Return Codes) b Invalid Parameter: b Invalid Parameter is TRUE if the ranges of the variables for the time of day and the date are not adhered to: ui Year, ui Month, ui Day, ui Hour, ui Minute and ui Second. The same ranges apply to the time structure st Systemtime as to the input variables. If b Invalid Parameter = TRUE, then the new local NT system time was not set. b Invalid Parameter is reset by the activation of the function block via the input variable b Set Local Time. TF8000 Version: 1.3.0 483
## Page 484

Programming Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.9.6 FB_HVACSystem Task Info The function block determines system variables of the task with a resolution of 1 ms, in which it is currently called. If the current cycle time is less than 1 ms, the set task cycle time t Task Cycle Time is output on the output variable t Cycle Time. The t Task Cycle Time of the PLC program must not be longer than 100 ms, as otherwise the digital outputs will be released. The reason for this is that the internal K-bus of the bus terminals runs synchronously to the PLC program, the bus will no longer be triggered early enough and the bus terminal watchdog is activated. VAR_OUTPUT b Ready : BOOL; t Task Cycle Time : TIME; t Cycle Time : TIME; usi System Task : USINT; b Ready: The variable is TRUE if the system information has been read out. t Task Cycle Time: Set task cycle time. t Cycle Time: Cycle time required for the last cycle. usi System Task: Task index of the task. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.10 Backup Var The user can use standard data types (see table) and integrate them in his application in order to save defined PLC variables fail-safe. 484 Version: 1.3.0 TF8000
## Page 485

Programming Data type Backup Var NOVRAM function block BOOL FB_HVACNOVRAM_Bool [} 485] BYTE FB_HVACNOVRAM_Byte DINT FB_HVACNOVRAM_Dint DWORD FB_HVACNOVRAM_Dword INT FB_HVACNOVRAM_Int LREAL FB_HVACNOVRAM_Lreal REAL FB_HVACNOVRAM_Real TIME FB_HVACNOVRAM_Time SINT FB_HVACNOVRAM_Sint UDINT FB_HVACNOVRAM_Udint UINT FB_HVACNOVRAM_Uint USINT FB_HVACNOVRAM_Usint WORD FB_HVACNOVRAM_Word 5.1.10.1 FB_HVACNOVRAM_XX The variables of various types (BOOL, BYTE, DINT, DWORD, INT, LREAL, REAL, SINT, TIME, UDINT, UINT, USINT, WORD) are saved fail-safe in the NOVRAM with the aid of the function blocks FB_HVACNOVRAM_XX. By way of example the function block FB_HVACNOVRAM_BOOL is described here. VAR_INPUT b Set Default : BOOL; b Var_Default : BOOL; b Set Default: If the variable is TRUE, the value of the input variable b Var_Default is adopted. b Var_Default: Default value defined by the user. The variable is of the data type BOOL. VAR_IN_OUT b Var : BOOL; b Var: Variable that is programmed fail-safe by the user. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.10.2 FB_HVACPersistent_XX The variables of various types (BOOL, BYTE, DINT, DWORD, INT, LREAL, REAL, SINT, STRING, STRUCT, TIME, UDINT, UINT, USINT, WORD) are saved persistently with the aid of the function blocks FB_HVACPersistent_XX. By way of example the function block FB_HVACPersistent_BYTE is described here. TF8000 Version: 1.3.0 485
## Page 486

Programming VAR_INPUT b Set Default : BOOL; by Var_Default : BYTE; b Set Default: If the variable is TRUE, the value of the input variable by Var_Default is adopted. by Var_Default: Default value defined by the user. The variable is of the data type BYTE. VAR_IN_OUT by Var : BYTE; by Var: Variable that is programmed fail-safe by the user. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.11 Functions 5.1.11.1 F_Round LREAL The function F_Round LREAL rounds the input variable Ir IN of data type LREAL to 1 decimal place. This function can also be used for REAL data types. VAR_INPUT lr IN : LREAL; Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.1.11.2 F_Round LREAL_EX The function F_Round LREAL_EX rounds the input variable lr IN of the data type LREAL to the number of decimal places specified by i Precision. This function can also be used for REAL data types. An instance of the function LTRUNC from the library Tc Math.lib is used internally in the function. VAR_INPUT Name : Type lr IN : LREAL; i Precision : INT; lr IN: Floating point number that is to be formatted. 486 Version: 1.3.0 TF8000
## Page 487

Programming - If lr IN < 0.1 AND lr IN >= 0.05, then the return value of the function is 0.1 i Precision: Precision. The value determines the number of digits after the decimal point. The range of decimal places begins with 0 and ends with 5. Requirements Development environment required library required function Twin CAT 3.1 build 4022.16 or Tc2_HVAC V3.3.1.0 TF8000 | TC3 HVAC V1.0.0.0 higher 5.2 DUTs 5.2.1 E_HVAC2Point Actuator Mode TYPE E_HVAC2Point Actuator Mode: ( e HVAC2Point Actuator Mode_Auto_BMS := 0, e HVAC2Point Actuator Mode_Open_BMS := 1, e HVAC2Point Actuator Mode_Close_BMS := 2, e HVAC2Point Actuator Mode_Auto_OP := 3, e HVAC2Point Actuator Mode_Open_OP := 4, e HVAC2Point Actuator Mode_Close_OP := 5 ); END_TYPE .._BMS: Building Management System; remote control of the actuator from the management level. .. OP:. Operator Panel; local control of the actuator from a local control panel. 5.2.2 E_HVAC2Point Ctrl Mode TYPE E_HVAC2Point Ctrl Mode: ( e HVAC2Point Ctrl Mode_Auto_BMS := 0, e HVAC2Point Ctrl Mode_On_BMS := 1, e HVAC2Point Ctrl Mode_Off_BMS := 2, e HVAC2Point Ctrl Mode_Auto_OP := 3, e HVAC2Point Ctrl Mode_On_OP := 4, e HVAC2Point Ctrl Mode_Off_OP := 5 ); END_TYPE .._BMS: Building Management System; remote control of the actuator from an BMS. .. OP: Operator Panel; local operation of the actuator from an OP. 5.2.3 E_HVAC3Point Actuator Mode TYPE E_HVAC3Point Actuator Mode: ( e HVAC3Point Actuator Mode_Auto_BMS := 0, e HVAC3Point Actuator Mode_Open_BMS := 1, e HVAC3Point Actuator Mode_Close_BMS := 2, e HVAC3Point Actuator Mode_Stop_BMS := 3, e HVAC3Point Actuator Mode_Auto_OP := 4, e HVAC3Point Actuator Mode_Open_OP := 5, e HVAC3Point Actuator Mode_Close_OP := 6, e HVAC3Point Actuator Mode_Stop_OP := 7 ); END_TYPE .._BMS: Building Management System; remote control of the actuator from an BMS. .. OP: Operator Panel; local operation of the actuator from an OP. TF8000 Version: 1.3.0 487
## Page 488

Programming 5.2.4 E_HVACActuator Mode TYPE E_HVACActuator Mode : ( e HVACActuator Mode_Auto_BMS := 0, e HVACActuator Mode_Off_BMS := 1, e HVACActuator Mode_Speed1_BMS := 2, e HVACActuator Mode_Speed2_BMS := 3, e HVACActuator Mode_Speed3_BMS := 4, e HVACActuator Mode_Speed4_BMS := 5, e HVACActuator Mode_Auto_OP := 6, e HVACActuator Mode_Off_OP := 7, e HVACActuator Mode_Speed1_OP := 8, e HVACActuator Mode_Speed2_OP := 9, e HVACActuator Mode_Speed3_OP := 10, e HVACActuator Mode_Speed4_OP := 11 ); END_TYPE .._BMS: Building Management System; remote control of the actuator from an BMS. .. OP: Operator Panel; local operation of the actuator from an OP. 5.2.5 E_HVACAir Conditioning2Speed Mode TYPE E_HVACAir Conditioning2Speed Mode: ( e HVACAir Conditioning2Speed Mode_Off := 0, e HVACAir Conditioning2Speed Mode_Heating := 1, e HVACAir Conditioning2Speed Mode_Cooling := 2, e HVACAir Conditioning2Speed Mode_Heating And Cooling := 3 ); END_TYPE 5.2.6 E_HVACAnalog Output Mode TYPE E_HVACAnalog Output Mode : ( e HVACAnalog Output Mode_Auto_BMS := 0, e HVACAnalog Output Mode_Manual_BMS := 1, e HVACAnalog Output Mode_Auto_OP := 2, e HVACAnalog Output Mode_Manual_OP := 3 ); END_TYPE .._BMS: Building Management System; remote control of the actuator from an BMS. .. OP: Operator Panel; local operation of the actuator from an OP. 5.2.7 E_HVACAnti Blocking Mode TYPE E_HVACAnti Blocking Mode: ( e HVACAnti Blocking Mode_Off := 0, e HVACAnti Blocking Mode_Downtime := 1, e HVACAnti Blocking Mode_Weekly := 2 ); END_TYPE 5.2.8 E_HVACBus Terminal_KL32xx TYPE E_HVACBus Terminal_KL32xx : ( e HVACBus Terminal_None := 0, (*================================================================================*) e HVACBus Terminal_KL3201_0000 := 1,(*Standard PT100*) e HVACBus Terminal_KL3201_0010 := 2,(*PT200*) e HVACBus Terminal_KL3201_0011 := 3,(*not supported, PT200 Siemens format*) e HVACBus Terminal_KL3201_0012 := 4,(*PT500*) e HVACBus Terminal_KL3201_0013 := 5,(*not supported, PT500 Siemens format*) e HVACBus Terminal_KL3201_0014 := 6,(*PT1000*) e HVACBus Terminal_KL3201_0015 := 7,(*not supported, PT1000 Siemens format*) e HVACBus Terminal_KL3201_0016 := 8,(*Ni100*) e HVACBus Terminal_KL3201_0017 := 9,(*not supported, Ni100 Siemens format*) 488 Version: 1.3.0 TF8000
## Page 489

Programming e HVACBus Terminal_KL3201_0018 := 10,(*not supported*) e HVACBus Terminal_KL3201_0020 := 11,(*Ohm10_1200*) e HVACBus Terminal_KL3201_0021 := 12,(*not supported, PT100 Siemens format*) e HVACBus Terminal_KL3201_0023 := 13,(*Ni120*) e HVACBus Terminal_KL3201_0024 := 14,(*not supported, Ni120 Siemens format*) e HVACBus Terminal_KL3201_0025 := 15,(*Ni1000*) e HVACBus Terminal_KL3201_0026 := 16,(*not supported, Ni1000 Siemens format*) e HVACBus Terminal_KL3201_0027 := 17,(*not supported, Ohm10_10000*) e HVACBus Terminal_KL3201_0028 := 18,(*not supported, high resolution 0,01°C*) e HVACBus Terminal_KL3201_0029 := 19,(*Ni1000_LS, Landis&Stefa, TK5000*) e HVACBus Terminal_KL3201_0030 := 20,(*not supported*) e HVACBus Terminal_KL3201_0031 := 21,(*PT1000,2 wire connection*) (*================================================================================*) e HVACBus Terminal_KL3202_0000 := 22,(*Standard PT100*) e HVACBus Terminal_KL3202_0010 := 23,(*PT200*) e HVACBus Terminal_KL3202_0011 := 24,(*not supported, PT200 Siemens format*) e HVACBus Terminal_KL3202_0012 := 25,(*PT500*) e HVACBus Terminal_KL3202_0013 := 26,(*not supported, PT500 Siemens format*) e HVACBus Terminal_KL3202_0014 := 27,(*PT1000*) e HVACBus Terminal_KL3202_0015 := 28,(*not supported, PT1000 Siemens format*) e HVACBus Terminal_KL3202_0016 := 29,(*Ni100*) e HVACBus Terminal_KL3202_0017 := 30,(*not supported, Ni100 Siemens format*) e HVACBus Terminal_KL3202_0018 := 31,(*not supported*) e HVACBus Terminal_KL3202_0020 := 32,(*Ohm10_1200*) e HVACBus Terminal_KL3202_0021 := 33,(*not supported, PT100 Siemens format*) e HVACBus Terminal_KL3202_0023 := 34,(*Ni120*) e HVACBus Terminal_KL3202_0024 := 35,(*not supported, Ni120 Siemens format*) e HVACBus Terminal_KL3202_0025 := 36,(*Ni1000*) e HVACBus Terminal_KL3202_0026 := 37,(*not supported, Ni1000 Siemens format*) e HVACBus Terminal_KL3202_0027 := 38,(*not supported, Ohm10_10000*) e HVACBus Terminal_KL3202_0028 := 39,(*not supported, high resolution 0,01°C*) e HVACBus Terminal_KL3202_0029 := 40,(*Ni1000_LS, Landis&Stefa, TK5000*) e HVACBus Terminal_KL3202_0030 := 41,(*not supported*) e HVACBus Terminal_KL3202_0031 := 42,(*PT1000,2 wire connection*) (*================================================================================*) e HVACBus Terminal_KL3204_0000 := 43,(*Standard PT100*) e HVACBus Terminal_KL3204_0010 := 44,(*PT200*) e HVACBus Terminal_KL3204_0011 := 45,(*not supported, PT200 Siemens format*) e HVACBus Terminal_KL3204_0012 := 46,(*PT500*) e HVACBus Terminal_KL3204_0013 := 47,(*not supported, PT500 Siemens format*) e HVACBus Terminal_KL3204_0014 := 48,(*PT1000*) e HVACBus Terminal_KL3204_0015 := 49,(*not supported, PT1000 Siemens format*) e HVACBus Terminal_KL3204_0016 := 50,(*Ni100*) e HVACBus Terminal_KL3204_0017 := 51,(*not supported, Ni100 Siemens format*) e HVACBus Terminal_KL3204_0018 := 52,(*not supported*) e HVACBus Terminal_KL3204_0020 := 53,(*Ohm10_1200*) e HVACBus Terminal_KL3204_0021 := 54,(*not supported, PT100 Siemens format*) e HVACBus Terminal_KL3204_0023 := 55,(*Ni120*) e HVACBus Terminal_KL3204_0024 := 56,(*not supported, Ni120 Siemens format*) e HVACBus Terminal_KL3204_0025 := 57,(*Ni1000*) e HVACBus Terminal_KL3204_0026 := 58,(*not supported, Ni1000 Siemens format*) e HVACBus Terminal_KL3204_0027 := 59,(*not supported, Ohm10_10000*) e HVACBus Terminal_KL3204_0028 := 60,(*not supported, high resolution 0,01°C*) e HVACBus Terminal_KL3204_0029 := 61,(*Ni1000_LS, Landis&Stefa, TK5000*) e HVACBus Terminal_KL3204_0030 := 62,(*not supported*) (*================================================================================*) e HVACBus Terminal_KL3228_0000 := 63,(*Standard PT1000*) (*================================================================================*) e HVACBus Terminal_Not Supported := 64,(*error, bus terminal not supported*) e HVACBus Terminal_KL3201_Not Supported := 65,(*error, bus terminal not supported*) e HVACBus Terminal_KL3202_Not Supported := 66,(*error, bus terminal not supported*) e HVACBus Terminal_KL3204_Not Supported := 67,(*error, bus terminal not supported*) e HVACBus Terminal_KL3228_Not Supported := 68 (*error, bus terminal not supported*) (*================================================================================*) e HVACBus Terminal_KL3208_0010 := 69,(*Standard PT1000*) e HVACBus Terminal_KL3208_Not Supported := 70(*error, bus terminal not supported*) ); END_TYPE 5.2.9 E_HVACCtrl Mode TYPE E_HVACCtrl Mode : ( e HVACCtrl Mode_Auto := 0, e HVACCtrl Mode_Manual := 1 ); END_TYPE TF8000 Version: 1.3.0 489
## Page 490

Programming 5.2.10 E_HVACConvection Mode TYPE E_HVACConvection Mode : ( e HVACConvection Mode_With Fan := 0, e HVACConvection Mode_Without Fan := 1 ); END_TYPE 5.2.11 E_HVACData Security Type TYPE E_HVACData Security Type: ( e HVACData Security Type_Persistent := 0, e HVACData Security Type_Idle := 1 ); END_TYPE 5.2.12 E_HVACError Codes TYPE E_HVACError Codes : ( e HVACError Codes_No Error := 0, e HVACError Codes_Error_t Task Cycle Time := 1, e HVACError Codes_Error_t Ctrl Cycle Time := 2, e HVACError Codes_Invalid Param_r Dead Range := 3, e HVACError Codes_Invalid Param_r Dead Band := 4, e HVACError Codes_Invalid Param_r Kp Is Less Than Zero := 5, e HVACError Codes_Invalid Param_t Ti := 6, e HVACError Codes_Invalid Param_t Tv := 7, e HVACError Codes_Invalid Param_t Td := 8, e HVACError Codes_Invalid Param_f Base Time := 9, e HVACError Codes_Invalid Param_r YMax Is Less Thanr YMin := 10, e HVACError Codes_Error_MEMCPY := 11, e HVACError Codes_Error_Mode Not Supported := 12, e HVACError Codes_Error_r Err High Limit Overrun := 13, e HVACError Codes_Error_r Err Low Limit Underrun := 14, e HVACError Codes_Error_No Feedback Actuator1 := 15, e HVACError Codes_Error_No Feedback Actuator2 := 16, e HVACError Codes_Error_No Feedback Actuator3 := 17, e HVACError Codes_Error_No Feedback Actuator4 := 18, e HVACError Codes_Error_No Feedback Actuator5 := 19, e HVACError Codes_Error_No Feedback Actuator6 := 20, e HVACError Codes_Error_No Feedback Actuator7 := 21, e HVACError Codes_Error_No Feedback Actuator8 := 22, e HVACError Codes_Invalid Param_t Overlap1Actuator := 23, e HVACError Codes_Invalid Param_i Count Ctrl := 24, e HVACError Codes_i Max On Level := 25, e HVACError Codes_t No Feedb Actuator := 26, e HVACError Codes_Error_i Number Of Sequences := 27, e HVACError Codes_Error_i My Number Of Sequences := 28, e HVACError Codes_Error_i Current Sequences := 29, e HVACError Codes_Error_MEMSET := 30, e HVACError Codes_Invalid Param_i Step := 31, e HVACError Codes_Invalid Param_i Number Of Step In Profile := 32, e HVACError Codes_Invalid Param_i Number Of Aggregates := 33, e HVACError Codes_Invalid Param_i Aggregate Steps := 34, e HVACError Codes_Invalid Param_i Number Of Profiles := 35, e HVACError Codes_Invalid Param_i Profile := 36, e HVACError Codes_Invalid Param_r Y_Max := 37, e HVACError Codes_Invalid Param_r Y_Min := 38, e HVACError Codes_Invalid Param_i Aggregate := 39, e HVACError Codes_Invalid Param_udi Sec Delay Up := 40, e HVACError Codes_Invalid Param_udi Sec Delay Down := 41, e HVACError Codes_Invalid Param_i Number Of Values := 42, e HVACError Codes_Error_LEN_Int := 43, e HVACError Codes_Error_LEN_Enum := 44 ); END_TYPE 5.2.13 E_HVACExternal Mode TYPE E_HVACExternal Mode : ( e HVACExternal Mode_Off := 0, e HVACExternal Mode_On := 1, 490 Version: 1.3.0 TF8000
## Page 491

Programming e HVACExternal Mode_Shift Absolute := 2 ); END_TYPE 5.2.14 E_HVACExternal Request Mode TYPE E_HVACExternal Request Mode: ( e HVACExternal Request Mode_Button On_Off := 0, e HVACExternal Request Mode_Button Off Delay := 1, e HVACExternal Request Mode_Switch On_Off := 2 ); END_TYPE 5.2.15 E_HVACPlant Mode TYPE E_HVACPlant Mode: ( e HVACPlant Mode_Time Scheduling Only := 0, e HVACPlant Mode_External Request Only := 1, e HVACPlant Mode_Time Scheduling_And_External Request := 2, e HVACPlant Mode_Time Scheduling_Or_External Request := 3 ); END_TYPE 5.2.16 E_HVACPower Measurement Mode TYPE E_HVACPower Measurement Mode: ( e HVACPower Measurement Mode_Auto All Values := 0, e HVACPower Measurement Mode_Current := 1, e HVACPower Measurement Mode_Voltage := 2, e HVACPower Measurement Mode_Effective Power := 3, e HVACPower Measurement Mode_Energy Consumption := 4, e HVACPower Measurement Mode_Peak Current Value := 5, e HVACPower Measurement Mode_Peak Voltage Value := 6, e HVACPower Measurement Mode_Peak Power Value := 7 ); END_TYPE 5.2.17 E_HVACReferencing Mode TYPE E_HVACReferencing Mode : ( e HVACReferencing Mode_Emulation := 0, e HVACReferencing Mode_Analog Feedback := 1 ); END_TYPE 5.2.18 E_HVACReg Outside Temp TYPE E_HVACReg Outside Temp: ( e HVACReq Outside Temp_No Request := 0, e HVACReq Outside Temp_OTLower Limit := 1, e HVACReq Outside Temp_OTHigher Limit := 2 ); END_TYPE 5.2.19 E_HVACReq Pump TYPE E_HVACReq Pump: ( e HVACReq Pump_No := 0, e HVACReq Pump_OT_LL := 1, e HVACReq Pump_OT_HL := 2, e HVACReq Pump_VP := 3, e HVACReq Pump_OT_LL_OR_VP := 4, e HVACReq Pump_OT_HL_OR_VP := 5, e HVACReq Pump_OT_LL_AND_VP := 6, e HVACReq Pump_OT_HL_AND_VP := 7 END_TYPE TF8000 Version: 1.3.0 491
## Page 492

Programming e HVACReq Pump_No: There is no request on the part of the Enum to control the pump e HVACReq Pump_OT_LL: The outside temperature (OT = r Outside Temp) must be smaller than r Outside Temp Low Limit (LL = Lower Limit) e HVACReq Pump_OT_HL: The outside temperature (OT = r Outside Temp) must be larger than r Outside Temp High Limit (HL = Higher Limit) e HVACReq Pump_VP: The valve position (VP = r Valve Position) must be larger than r Valve Position Limit On e HVACReq Pump_OT_LL_OR_VP: The outside temperature (OT = r Outside Temp) must be smaller than r Outside Temp Low Limit (LL = Lower Limit) OR the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On e HVACReq Pump_OT_HL_OR_VP: The outside temperature (OT = r Outside Temp) must be larger than r Outside Temp High Limit (HL = Higher Limit) OR the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On e HVACReq Pump_OT_LL_AND_VP: The outside temperature (OT = r Outside Temp) must be smaller than r Outside Temp Low Limit (LL = Lower Limit) AND the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On e HVACReq Pump_OT_HL_AND_VP: The outside temperature (OT = r Outside Temp) must be larger than r Outside Temp High Limit (HL = Higher Limit) AND the valve position (VP = r Valve Position) must be larger than r Valve Position Limit On 5.2.20 E_HVACReg Valve TYPE E_HVACReg Valve: ( e HVACReq Valve_No Request := 0, e HVACReq Valve_Or Valve Pos Higher Limit := 1, e HVACReq Valve_And Valve Pos Higher Limit := 2 ); END_TYPE 5.2.21 E_HVACSensor Type TYPE E_HVACSensor Type : ( e HVACSensor Type_None := 0, e HVACSensor Type_PT100 := 1, e HVACSensor Type_PT200 := 2, e HVACSensor Type_PT500 := 3, e HVACSensor Type_PT1000 := 4, e HVACSensor Type_NI100 := 5, e HVACSensor Type_NI120 := 6, e HVACSensor Type_NI1000 := 7,(*Ni1000,DIN*) e HVACSensor Type_NI1000_LS := 8,(*Ni1000_LS, Landis&Staefa, TK5000*) e HVACSensor Type_Ohm10_1200 := 9, e HVACSensor Type_Ohm10_5000 := 10, e HVACSensor Type_Ohm10_10000 := 11, e HVACSensor Type_Not Supported := 12 ); END_TYPE 5.2.22 E_HVACSequence Ctrl Mode The controller is enabled and controlled within the sequence via this ENUM, depending on the system operating modes. TYPE E_HVACSequence Ctrl Mode : ( e HVACSequence Ctrl Mode_Stop := 0, e HVACSequence Ctrl Mode_On := 1, e HVACSequence Ctrl Mode_Night Cooling := 2, e HVACSequence Ctrl Mode_Freeze Protection := 3, e HVACSequence Ctrl Mode_Overheating Protection := 4, e HVACSequence Ctrl Mode_Night Cooling And Overheating Protection := 5 ); END_TYPE 492 Version: 1.3.0 TF8000
## Page 493

Programming 5.2.23 E_HVACSetpoint Heating Mode TYPE E_HVACSetpoint Heating Mode : ( e HVACSetpoint Heating Mode_Off := 0, e HVACSetpoint Heating Mode_On Outside Temp := 1, e HVACSetpoint Heating Mode_On Date := 2, e HVACSetpoint Heating Mode_On Permanent := 3, e HVACSetpoint Heating Mode_On Freeze Protec := 4, e HVACSetpoint Heating Mode_On Night := 5, e HVACSetpoint Heating Mode_On Day := 6 ); END_TYPE e HVACSetpoint Heating Mode_Off: The heating circuit is completely switched off. The frost protection function is also deactivated in this operating mode! e HVACSetpoint Heating Mode_On Outside Temp: Heating period according to outside temperature. The heating circuit is switched on if the average outside temperature r Outside Temp Damped is smaller than the value of r Heating Limit. The feed temperature setpoint calculated by the heating characteristic curve or the room setpoint module is routed through to the output i Setpoint. The output b Heating goes to TRUE and, hence, the heating circuit pump is switched on. Switching on or off following the heating limits being undershot or exceeded can be delayed by the parameters t Delay Heating On and t Delay Heating Off. e HVACSetpoint Heating Mode_On Date: Heating period according to date. The heating circuit is enabled from the date i On_Day / i On_Month until i Off_Day / i Off_Month. The switching on or off of the heating circuit pump after the switch-on or switch-off limits are reached can be delayed. e HVACSetpoint Heating Mode_On Permanent: The heating circuit is permanently switched on. e HVACSetpoint Heating Mode_On Freeze Protec: The heating circuit is in frost protection mode. e HVACSetpoint Heating Mode_On Night: The heating circuit is in night operating mode. e HVACSetpoint Heating Mode_On Day: The heating circuit is in day operating mode. 5.2.24 E_HVACSetpoint Mode TYPE E_HVACSetpoint Mode : ( e HVACSetpoint Mode_DIN := 0, e HVACSetpoint Mode_DINLimited := 1, e HVACSetpoint Mode_Constant Value Base := 2 ); END_TYPE 5.2.25 E_HVACState TYPE E_HVACState : ( e HVACState_Idle := 0, e HVACState_Active := 1, e HVACState_Error := 2 ); END_TYPE This output indicates the current internal state of the block. e HVACState_Idle: The block has successfully been reset, and is now waiting for selection of the operating mode. e HVACState_Active: The block is in the active state, which is the normal operating state. e HVACState_Error: An error has occurred; the block is not executed when in this state. TF8000 Version: 1.3.0 493
## Page 494

Programming 5.2.26 E_HVACTemperature Curve TYPE E_HVACTemperature Curve : ( e HVACTemperature Curve_None := 0, e HVACTemperature Curve_NTC1k8 := 1, (*NTC 1.8k, negative, Thermokon*) e HVACTemperature Curve_Ni1000Tk5000 := 2, (*Ni1000 Tk5000, positive, Thermokon*) e HVACTemperature Curve_NTC1k_3_A1 := 3, (*NTC1k, 1K3 A1, negative, S+S*) e HVACTemperature Curve_NTC1k8_3_A1 := 4, (*NTC1.8k, 1.8K3 A1, negative, S+S*) e HVACTemperature Curve_NTC2k2_3_A1 := 5, (*NTC2.2k, 2.2K3 A1, negative, S+S*) e HVACTemperature Curve_NTC3k3_3_A1 := 6, (*NTC3.3k, 3.3K3 A1, negative, S+S*) e HVACTemperature Curve_Ni1000Tk5000_TCR := 7, (*Ni1000 Tk5000 TCR, positive, S+S*) e HVACTemperature Curve_Ni1000_DIN := 8, (*Ni1000 DIN, positive, S+S*) e HVACTemperature Curve_Pt1000_DIN := 9 (*Ni1000 DIN, positive, S+S*) ); END_TYPE 5.2.27 E_HVACTemperature Sensor Mode TYPE E_HVACTemperature Sensor Mode : ( e HVACTemperature Sensor Mode_Replacement Value := 0, e HVACTemperature Sensor Mode_Last Value := 1, e HVACTemperature Sensor Mode_Auto Reset Replacement Value := 2, e HVACTemperature Sensor Mode_Auto Reset Last Value := 3 ); END_TYPE 5.2.28 ST_HVAC2Point Ctrl Sequence TYPE ST_HVAC2Point Ctrl Sequence : STRUCT t Remaining Time Increase Sequence : TIME; t Remaining Time Decrease Sequence : TIME; r X : REAL; r W_Max : REAL; r W_Min : REAL; r E : REAL; r Ctrl_I_High Limit : REAL; r Ctrl_I_Low Limit : REAL; r Ctrl_I_Out : REAL; e2Point Ctrl State : E_HVAC2Point Ctrl Mode; i Number Of Sequences : INT; i My Number In Sequence : INT; i Current Sequence : INT; b Enable : BOOL; b Error : BOOL; b Out : BOOL; b Active Ctrl : BOOL; b_r W_Max : BOOL; b_r W_Min : BOOL; END_STRUCT END_TYPE 5.2.29 ST_HVACAggregate TYPE ST_HVACAggregate : STRUCT r Y_Max : REAL; r Y_Min : REAL; i Aggregate Step : INT; b Block : BOOL; END_STRUCT END_TYPE r Y_Max: Parameter specification for constant units. r Y_Min: Parameter specification for constant units. i Aggregate Step: Parameter that specifies the step in which the addressed unit should be fixed or should regulate; see b Block. 494 Version: 1.3.0 TF8000
## Page 495

Programming b Block: If b Block = FALSE, then the addressed unit is fixed in the specified step via i Aggregate Step. If b Block = TRUE, then the control of the addressed unit is released from the off step (0) to the specified step via i Aggregate Step. 5.2.30 ST_HVACCmd Ctrl_8Param TYPE ST_HVACCmd Ctrl_8Param : STRUCT udi Sec Delay On : UDINT; udi Sec Delay Off : UDINT; udi Sec Min On : UDINT; udi Sec Min Off : UDINT; END_STRUCT END_TYPE udi Sec Delay On: switch-on delay in seconds udi Sec Delay Off: switch-off delay in seconds udi Sec Min On: minimum switch-on time in seconds udi Sec Min Off: minimum switch-off time in seconds 5.2.31 ST_HVACCmd Ctrl_8State TYPE ST_HVACCmd Ctrl_8State : STRUCT udi Sec RT_Delay On : UDINT; udi Sec RT_Delay Off : UDINT; udi Step : UDINT; udi Sec RT_Min On : ARRAY[0..g_i Num Of Cmd Ctrl_8] OF UDINT; udi Sec RT_Min Off : ARRAY[0..g_i Num Of Cmd Ctrl_8] OF UDINT; END_STRUCT END_TYPE udi Sec RT_Delay On: The remaining time of the switch-on delay of the current step udi Step is indicated. udi Sec RT_Delay Off: The remaining time of the switch-off delay of the current step udi Step is indicated. udi Step: State indicating which step the function block is in. udi Sec RT_Min On[0.. g_i Num Of Cmd Ctrl_8 ]: The remaining time of the minimum switch-on duration of the outputs is indicated in the one-dimensional field (Table) udi Sec RT_Min On[0..g_i Num Of Cmd Ctrl_8]. udi Sec RT_Min Off[0.. g_i Num Of Cmd Ctrl_8 ]: The remaining time of the minimum switch-off duration of the outputs is indicated in the one-dimensional field (Table) udi Sec RT_Min Off[0..g_i Num Of Cmd Ctrl_8]. 5.2.32 ST_HVACHoliday TYPE ST_HVACHoliday : STRUCT ui On_Day : UINT; ui On_Month : UINT; ui Off_Day : UINT; ui Off_Month : UINT; b Enable : BOOL; b Reset After On : BOOL; b Q : BOOL; END_STRUCT END_TYPE 5.2.33 ST_HVACI_Ctrl TYPE ST_HVACI_Ctrl : STRUCT r Integral High : REAL; r Integral Low : REAL; udi Sec Delay High : UDINT; udi Sec Delay Low : UDINT; END_STRUCT END_TYPE TF8000 Version: 1.3.0 495
## Page 496

Programming r Integral High: Positive value for the upper limit at which the integration of the I-transfer element is stopped r Integral Low: Positive value for the lower limit at which the integration of the I-transfer element is stopped. udi Sec Delay High: Delay time after whose expiry the I-transfer elelment is activated. udi Sec Delay Low: Delay time after whose expiry the I-transfer elelment is activated. 5.2.34 ST_HVACPeriod TYPE ST_HVACPeriod : STRUCT ui On_hh : UINT; ui On_mm : UINT; ui On_Day : UINT; ui On_Month : UINT; ui Off_hh : UINT; ui Off_mm : UINT; ui Off_Day : UINT; ui Off_Month : UINT; b Enable : BOOL; b Reset After On: BOOL; b Q : BOOL; END_STRUCT END_TYPE 5.2.35 ST_HVACParameter Scale_n Point TYPE ST_HVACParameter Scale_n Point : STRUCT r X : ARRAY [1..g_i Max No Of Scale_n Point] OF REAL; r Y : ARRAY [1..g_i Max No Of Scale_n Point] OF REAL; i Number Of Point : INT; END_STRUCT END_TYPE Structure via which the individual points of the XY coordinates are given their valency. r X[1..g_i Max No Of Scale_n Point]: Array containing the valency of the individual points on the X axis. The number of points specified depends on i Number Of Point. The following must be observed: r X[1] must be greater than r X[2], r X[2] must be greater than r X[n] OR r X[1] must be smaller than r X[2], r X[2] must be smaller than r X[n]. r Y[1..g_i Max No Of Scale_n Point]: Array containing the valency of the individual points on the Y axis. The number of points specified depends on i Number Of Point. i Number Of Point: Number of individual points of the XY coordinates. The following must be observed: i Number Of Point must not be smaller than 2 OR larger than g_i Max No Of Scale_n Point(60). 5.2.36 ST_HVACPower Measurement TYPE ST_HVACPower Measurement : STRUCT di IL1, di IL2, di IL3 : DINT; di UL1, di UL2, di UL3 : DINT; di PL1, di PL2, di PL3 : DINT; di Pg : DINT; di Cos Phi L1, di Cos Phi L2, di Cos Phi L3 : DINT; di Cos Phi : DINT; di WL1, di WL2, di WL3 : DINT; di Wg : DINT; di Imax L1, di Imax L2, di Imax L3 : DINT; di Umax L1, di Umax L2, di Umax L3 : DINT; di Pmax L1, di Pmax L2, di Pmax L3 : DINT; di Sg : DINT; di Qg : DINT; 496 Version: 1.3.0 TF8000
## Page 497

Programming dummy : DINT; END_STRUCT END_TYPE 5.2.37 ST_HVACPower Measurement Ex TYPE ST_HVACPower Measurement Ex : STRUCT f IL1, f IL2, f IL3 : LREAL; f Ig : LREAL; f UL1, f UL2, f UL3 : LREAL; f PL1, f PL2, f PL3 : LREAL; f Pg : LREAL; f Cos Phi L1, f Cos Phi L2, f Cos Phi L3 : LREAL; f Cos Phi : LREAL; f WL1, f WL2, f WL3 : LREAL; f Wg : LREAL; f Imax L1, f Imax L2, f Imax L3 : LREAL; f Umax L1, f Umax L2, f Umax L3 : LREAL; f Pmax L1, f Pmax L2, f Pmax L3 : LREAL; f Sg : LREAL; f Qg : LREAL; f Frequency L1, f Frequency L2, f Frequency L3 : LREAL; END_STRUCT END_TYPE 5.2.38 ST_HVACPower Range Table TYPE ST_HVACPower Range Table : STRUCT i Aggregate : INT; i Aggregate Step : INT; r Y_Max : REAL; r Y_Min : REAL; r Integral High : REAL; r Integral Low : REAL; udi Sec Delay High : UDINT; udi Sec Delay Low : UDINT; b Block : BOOL; END_STRUCT END_TYPE i Aggregate: Parameter that specifies to which output structure st Aggregate1-6 of the function block FB_HVACPower Range Table [} 135] the variables r Y_Min, r Y_Max, i Aggregate Step and b Block are written. i Aggregate Step: Parameter that specifies the step in which the addressed unit should be fixed or should regulate, depending on b Block. This variable is output via the structure st Aggregate X. r Y_Max: Parameter specification for continuous units. The variable value must not be smaller than g_r Y_Min and must not exceed g_r Y_Max and r Y_Max must not be smaller than r Y_Min. Otherwise an error is indicated by b Error = TRUE and the execution of the function block FB_HVACPower Range Table [} 135] is stopped. This variable is output via the structure st Aggregate X. r Y_Min: Parameter specification for continuous units. The variable value must not be smaller than g_r Y_Min and must not exceed g_r Y_Max and r Y_Max must not be smaller than r Y_Min. Otherwise an error is indicated by b Error = TRUE and the execution of the function block FB_HVACPower Range Table [} 135] is stopped. This variable is output via the structure st Aggregate X. r Integral High: Positive value for the upper limit at which the integration of the I-transfer element is stopped; see the VAR_IN_OUT-Variable r Integral High in the FB_HVACI_Ctrl Step [} 112]. This variable is output via the structure st I_Ctrl. r Integral Low: Positive value for the lower limit at which the integration of the I-transfer element is stopped; see the VAR_IN_OUT-Variable r Integral High in the FB_HVACI_Ctrl Step [} 112]. This variable is output via the structure st I_Ctrl. udi Sec Delay High: Delay time after whose expiry the I-transfer element is activated; see the VAR_IN_OUT- Variable udi Sec Delay High in the FB_HVACI_Ctrl Step [} 112]. This variable is output via the structure st I_Ctrl. udi Sec Delay Low: Delay time after whose expiry the I-transfer element is activated; see the VAR_IN_OUT- Variable udi Sec Delay High in the FB_HVACI_Ctrl Step [} 112]. This variable is output via the structure st I_Ctrl. TF8000 Version: 1.3.0 497
## Page 498

Programming b Block: If b Block = FALSE, then the addressed unit is fixed in the specified step via i Aggregate Step. If b Block = TRUE, then the control of the addressed unit is released from the off step (0) to the specified step via i Aggregate Step. This variable is output via the structure st Aggregate X. 5.2.39 ST_HVACTime Channel TYPE ST_HVACTime Channel : STRUCT ui On_hh : UINT; ui On_mm : UINT; ui On_ss : UINT; ui Off_hh : UINT; ui Off_mm : UINT; ui Off_ss : UINT; b Enable : BOOL; b All Days : BOOL; b Monday : BOOL; b Tuesday : BOOL; b Wednesday : BOOL; b Thursday : BOOL; b Friday : BOOL; b Saturday : BOOL; b Sunday : BOOL; b Reset After On: BOOL; b Q : BOOL; END_STRUCT END_TYPE 5.2.40 ST_HVACTemp Change Function Stucture of the node points for the temperature change function in the modules FB_HVACOptimized On [} 422] and FB_HVACOptimized Off [} 432]. TYPE ST_HVACPrestart Function : STRUCT r Outside Temp : ARRAY[1..10] OF REAL; (*[deg C]*) r Room Temp Change : ARRAY[1..10] OF REAL; (*[deg K/min]*) END_STRUCT END_TYPE r Outside Temp / r Room Temp Change : The 10 node points (outdoor temperature in degree Celsius to room temperature change in degree Kelvin / minute), which are passed. 5.2.41 HVAC room functions 5.2.41.1 E_BARCtrl Fct TYPE E_BARCtrl Fct: ( e BARCtrl Fct_Off := 0, e BARCtrl Fct_Heating := 1, e BARCtrl Fct_Cooling := 2 ); END_TYPE e BARCtrl Fct_Off: Function selection OFF acitve. e BARCtrl Fct_Heating: Function selection for heating operation active. e BARCtrl Fct_Cooling: Function selection for cooling operation active. 5.2.41.2 E_BAREnergy Level TYPE E_BAREnergy Level: ( e BAREnergy Level_AUTO_I := 0, e BAREnergy Level_Protection := 1, e BAREnergy Level_Economy := 2, e BAREnergy Level_Pre Comfort := 3, e BAREnergy Level_Comfort := 4, 498 Version: 1.3.0 TF8000
## Page 499

Programming e BAREnergy Level_AUTO_II := 5 ); END_TYPE e BAREnergy Level_AUTO_I: Automatic-mode-I means, in this mode a switch to a higher enery level is possible if the upper energy level are already TRUE. In the mode the state of the inputs b Protection, b Economy, b Pre Comfort and b Comfort are evaluated for the selection of the energy level. e BAREnergy Level_Protection: In this mode which is manually operated by the building management system, the room/zone/range held in protection. This mode is only building protection mode. e BAREnergy Level_Economy: In this mode which is manually operated by the building management system, the room/zone/range held in Economy. This mode is set for longer periods of absence or at night. e BAREnergy Level_Pre Comfort: In this mode which is manually operated by the building management system, the room/zone/range held in Pre Comfort. This mode is set for shorter periods of absence e BAREnergy Level_Comfort: In this mode which is manually operated by the building management system, the room/zone/range held in the Comfort. This mode is set for periods of absence. e BAREnergy Level_AUTO_II: Automatic-mode-II means, in case of presence detection, this mode switches from energy level Protection, Economy or Pre Comfort directly to energy level Comfort. See diagram TF8000 Version: 1.3.0 499
## Page 500

Programming 5.2.41.3 E_BARPos Mode Enumerator for the definition of the positioning mode. TYPE E_BARPos Mode : ( e Pos Mode Fixed := 0, e Pos Mode Table, e Pos Mode Max Incidence ); END_TYPE e Pos Mode Fixed: The blind height adopts a fixed value, which is set (in %) via the ui Fixed Shutter Height value on the function block FB_BARSun Protection Ex [} 305]; e Pos Mode Table: the height positioning takes place with the help of a table of 6 interpolation points, 4 of which are parameterisable. A blind position in relation to the position of the sun is then calculated from these points by linear interpolation. See FB_BARBlind Position Entry [} 247] for further description. e Pos Mode Max Incidence: the positioning takes place with specification of the maximum desired incidence of light. 5.2.41.4 E_BARShading Object Type Enumerator for selection of shading object type. TYPE E_BARShading Object Type : ( e Object Type Tetragon := 0, e Object Type Globe := 1 ); END_TYPE e Object Type Tetragon: Object type is a tetragon. e Object Type Globe: Object type is a globe. 500 Version: 1.3.0 TF8000
## Page 501

Programming 5.2.41.5 E_HVACData Security Type Enumeration for defining the saving of entered parameters. TYPE E_HVACData Security Type : ( e Data Security Type_Persistent := 0, e Data Security Type_Idle := 1 ); END_TYPE e Data Security Type_Persistent: the parameters entered are persistently saved after each change. The values are available on the input or output variables following a restart. e Data Security Type_Idle: the values are not saved. Following a restart only default values – if existent – are available. 5.2.41.6 ST_BARBlind Position Table Structure of the interpolation point entries for the height adjustment of the blind. TYPE ST_BARBlind Position Table: STRUCT lr Sun Elevation : ARRAY[0..5] OF LREAL; ui Blind Position : ARRAY[0..5] OF UINT; b Valid : BOOL; END_STRUCT END_TYPE lr Sun Elevation / ui Blind Position: The 6 interpolation points that are transferred, wherein the array elements 0 and 5 represent the automatically generated edge elements mentioned above. b Valid: validity flag for the function block FB_BARSun Protection Ex [} 305]. It is set to TRUE by the function block FB_BARBlind Position Entry [} 247] if the data entered correspond to the validity criteria described. 5.2.41.7 ST_BARCorner Information about window corners TYPE ST_BARCorner : STRUCT lr X : LREAL; lr Y : LREAL; b Shaded : BOOL; END_STRUCT END_TYPE lr X: X-coordinate of the window (on the facade). lr Y: Y-coordinate of the window (on the facade). b Shaded: information as to whether this corner is in the shade: b Shaded=TRUE: corner is in the shade. 5.2.41.8 ST_BARFacade Element List entry for a facade element (window). TYPE ST_BARFacade Element : STRUCT usi Group : USINT; lr Window Width : LREAL; lr Window Height : LREAL; st Corner : ARRAY [1..4] OF ST_BARCorner; b Valid : BOOL; END_STRUCT END_TYPE usi Group: group membership of the element lr Window Width: width of the window. lr Window Height: height of the window. TF8000 Version: 1.3.0 501
## Page 502

Programming st Corner: coordinates of the window corners and information as to whether this corner point is in the shade; see ST_BARCorner [} 501]. b Valid: plausibility of the data entered: b Valid=TRUE: Data are plausible. 5.2.41.9 ST_BARSetpoint Room TYPE ST_BARSetpoint Room : STRUCT st BARSetpoint Room_Comfort Heat : REAL:= 21.0; st BARSetpoint Room_Pre Comfort Heat : REAL:= 19.0; st BARSetpoint Room_Economy Heat : REAL:= 15.0; st BARSetpoint Room_Protection Heat : REAL:= 12.0; st BARSetpoint Room_Comfort Cool : REAL:= 24.0; st BARSetpoint Rooom_Pre Comfort Cool : REAL:= 28.0; st BARSetpoint Room_Economy Cool : REAL:= 35.0; st BARSetpoint Room_Protection Cool : REAL:= 40.0; END_STRUCT END_TYPE The values in the structure are defined with the preset values. 5.2.41.10 ST_BARShading Object List entry for a shading object. TYPE ST_BARShading Object : STRUCT lr P1x : LREAL; lr P1y : LREAL; lr P1z : LREAL; lr P2x : LREAL; lr P2y : LREAL; lr P2z : LREAL; lr P3x : LREAL; lr P3y : LREAL; lr P3z : LREAL; lr P4x : LREAL; lr P4y : LREAL; lr P4z : LREAL; lr Mx : LREAL; lr My : LREAL; lr Mz : LREAL; lr Radius : LREAL; usi Begin Month : USINT; usi End Month : USINT; e Type : E_BARShading Object Type; b Valid : BOOL; END_STRUCT END_TYPE lr P1x .. lr P4z: corner coordinates. Of importance only if the element is a square. lr Mx .. lr Mz: centre coordinates. Of importance only if the element is a ball. lr Radius: radius of the ball. Of importance only if the element is a ball. usi Begin Month: beginning of the shading period (number of month). usi End Month: end of the shading period (number of month). e Type: object type, see E_BARShading Object Type [} 500]. b Valid: plausibility of the data: b Valid=TRUE: Data are plausible. Remark about the shading period: The monthly entries may not be 0 or greater than 12, otherwise all combinations are possible. Examples: Start=1, End=1: shading in January. Start=1, End=5: shading from the beginning of January to the end of May. Start=11, End=5: shading from the beginning of November to the end of May (the following year). 502 Version: 1.3.0 TF8000
## Page 503

Programming 5.2.41.11 ST_BARSunblind Structure of the blind positioning telegram. TYPE ST_BARSunblind: STRUCT ui Position : UINT; i Angle : INT; b Man Up : BOOL; b Man Down : BOOL; b Manual Mode : BOOL; b Active : BOOL; END_STRUCT END_TYPE ui Position: transferred blind height in %. i Angle: transferred louvre position in degrees. b Man Up: manual command: blind up. b Man Down: manual command: blind down. b Manual Mode: TRUE: manual mode is active. FALSE: automatic mode is active. b Active: The sender of the telegram is active. This bit is evaluated only by the priority controller FB_BARSunblind Priority Switch [} 285]. The blind actuators FB_BARSunblind Actuator [} 272] and FB_BARRoller Blind [} 286] ignore it. 5.2.41.12 ST_BARSunblind Scene Table entry for a blind scene. TYPE ST_BARSunblind Scene: STRUCT ui Position : UINT; i Angle : INT; END_STRUCT END_TYPE ui Position: blind height in %. i Angle: louvre position in degrees. 5.3 GVLs 5.3.1 Constants Global constants VAR_GLOBAL g_st HVACCycle Time Interpretation : ST_HVACCTRL_CYCLE_TIME_INTERPRETATION; g_dw HVACVar Config Start AT%M* : DWORD; g_dw HVACVar Config End AT%M* : DWORD; g_b HVACParams Changed : BOOL; g_b HVACBackup Data Read Done : BOOL; g_b HVACNOVRAMData Read Done : BOOL; g_b HVACPers Data Read Done : BOOL; g_b HVACPers Params Changed : BOOL; g_b HVACNOVRAMParams Changed : BOOL; g_b HVACNOVRAMUsed : BOOL; g_b HVACPers Used : BOOL; g_b HVACPers Write Busy : BOOL; END_VAR VAR_GLOBAL CONSTANT g_i Num Of Cmd Ctrl_8 : INT; r Close To Zero : REAL; lr Close To Zero : LREAL; TF8000 Version: 1.3.0 503
## Page 504

Programming ui Max Data File Size : UINT; g_udi Max Sec : UDINT; END_VAR g_b HVACParams Changed: Triggers a backup. g_b HVACBackup Data Read Done: Indicates that backup data have been read. g_b HVACNOVRAMData Read Done: Indicates that the NOVRAM has been read out. g_b HVACPers Data Read Done: Indicates that the persistent data have been read out. g_b HVACPers Params Changed: Persistent data have changed, saving is taking place. g_b HVACNOVRAMParams Changed: Data in the NOVRAM have changed, saving is taking place. g_b HVACNOVRAMUsed: NOVRAM has been written to. g_b HVACPers Used: Persistent data have been created. g_b HVACPers Write Busy: Working counter has been reset. g_i Num Of Cmd Ctrl_8: (*FB_HVACCmd Ctrl_8*) (preset to 8). r Close To Zero: (Preset to 0.00000001). lr Close To Zero: (Preset to 0.00000001). ui Max Data File Size: Limitation of the data size to avoid overflows in FOR loops (preset to 65534). g_udi Max Sec: (*FB_HVACI_Ctrl Step / FB_HVACPower Range Table*) (preset to 4294967). 5.3.2 Parameter Global parameters VAR_GLOBAL CONSTANT i Rows Per Facade : INT; i Columns Per Facade : INT; i Shading Objects : INT; usi Max Sunblind Scenes : USINT; g_t HVACWrite Backup Data Time : TIME; g_udi Max No Of Bytes In Struct : UDINT; g_udi Max Size Of String : UDINT; g_i Max No Of Scale_n Point : INT; g_i Max Number Of Steps : INT; g_i Min Number Of Steps : INT; g_i Max Number Of Profiles : INT; g_i Min Number Of Profiles : INT; g_i Max Number Of Aggregates : INT; g_i Min Number Of Aggregates : INT; g_i Aggregate Min Number Of Steps : INT; g_i Aggregate Max Number Of Steps : INT; g_i Min Number Of Sequences : INT; g_i Max Number Of Sequences : INT; END_VAR i Rows Per Facade: Number of horizontally arranged shading elements on a floor (preset to 10). i Columns Per Facade: Number of vertically arranged shading elements on a facade (preset to 20). i Shading Objects: Upper limit on the shading elements (preset to 20). usi Max Sunblind Scenes: Upper limit on the possible shading scenes (preset to 20). g_t HVACWrite Backup Data Time: Time delay for writing the backup data (preset to 1 h). g_udi Max No Of Bytes In Struct: Maximum number of bytes in a structure (preset to 128). g_udi Max Size Of String: Size in number of letters (i.e. in the declaration of the string) + 1 byte for termination (preset to 256). 504 Version: 1.3.0 TF8000
## Page 505

Programming g_i Max No Of Scale_n Point: Maximum number of XY coordinates of the structure ST_HVACParameter Scale_n Point [} 496] (see FB_HVACScale_n Point [} 87]) (preset to 60). g_i Max Number Of Steps: (*FB_HVACI_Ctrl Step/FB_HVACPower Range Table*) (preset to 32). g_i Min Number Of Steps: (*FB_HVACI_Ctrl Step/FB_HVACPower Range Table*) (preset to 0). g_i Max Number Of Profiles: (*FB_HVACPower Range Table*) (preset to 16). g_i Min Number Of Profiles: (*FB_HVACPower Range Table*) (preset to 1). g_i Max Number Of Aggregates: (*FB_HVACPower Range Table*) (preset to 6). g_i Min Number Of Aggregates: (*FB_HVACPower Range Table*) (preset to 1). g_i Aggregate Min Number Of Steps: (*FB_HVACPower Range Table*) (preset to 0). g_i Aggregate Max Number Of Steps: (*FB_HVACPower Range Table*) (preset to 6). g_i Min Number Of Sequences: (*FB_HVAC2Point Ctrl Sequence*) (preset to 1). g_i Max Number Of Sequences: (*FB_HVAC2Point Ctrl Sequence*) (preset to 16). TF8000 Version: 1.3.0 505
## Page 506

Appendix 6 Appendix 6.1 Calculation of switching time when changing sequence Example of the determination of the switching time from one sequence to the next. 506 Version: 1.3.0 TF8000
## Page 507

Appendix TF8000 Version: 1.3.0 507
## Page 508

Appendix 6.2 Table of sequence controller operating modes Operating modes A further special feature of the sequence controller is its control by the Enum E_HVACSequence Ctrl Mode [} 492] Not only is the controller enabled by the Enum E_HVACSequence Ctrl Mode [} 492], it also transmits the operating mode of the air conditioning system to the controller blocks in the sequence. Depending on the operating modes, each sequence controller hence reacts specially to the Enum E_HVACSequence Ctrl Mode [} 492] as illustrated in the table. Value of: 0 (Stop) 1 (On) 2 (night cool- 3 (support 4 (overheat- 5 (night cool- E_HVACSe- ing) operation) ing protec- ing and over- quence C- tion) heating pro- trl Mode tection) disabled 0 % Enable disabled 0 % Enable Enable Enable FB_HVACMa ster Sequence r Y=Zuluft Max. r Y=Zuluft Min. r Y=Zuluft Min. Ctrl Temp Temp Temp Master controller disabled 0 % Enable disabled 0 % Enable 0 % - disabled 0 % disabled 0 % FB_HVACPID 100 % Pre Heating Pre-heater disabled 0 % Enable disabled 0 % disabled 0 % disabled 0 % disabled 0 % FB_HVACPID Re Heating Re-heater disabled 0 % Enable disabled 0 % disabled 0 % Enable 0 % - Enable 0 % - FB_HVACPID 100 % 100 % Cooling Cooler disabled 0 % Enable disabled 0 % disabled 0 % disabled 0 % disabled 0 % FB_HVACPID Energy Recov ery Heat recovery disabled 0 % Enable max. outside 0 % air 0 % air max. outside FB_HVACPID air rate 100 % circulation circulation air rate 100 % Mixed Air only only Mixed air flaps 6.3 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! 508 Version: 1.3.0 TF8000
## Page 509

Appendix The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF8000 Version: 1.3.0 509
## Page 510

Appendix 6.4 ADS Return Codes Grouping of error codes: Global error codes: ADS Return Codes [} 510]... (0x9811_0000 ...) Router error codes: ADS Return Codes [} 510]... (0x9811_0500 ...) General ADS errors: ADS Return Codes [} 511]... (0x9811_0700 ...) RTime error codes: ADS Return Codes [} 513]... (0x9811_1000 ...) Global error codes Hex Dec HRESULT Name Description 0x0 0 0x98110000 ERR_NOERROR No error. 0x1 1 0x98110001 ERR_INTERNAL Internal error. 0x2 2 0x98110002 ERR_NORTIME No real time. 0x3 3 0x98110003 ERR_ALLOCLOCKEDMEM Allocation locked – memory error. 0x4 4 0x98110004 ERR_INSERTMAILBOX Mailbox full – the ADS message could not be sent. Reducing the number of ADS messages per cycle will help. 0x5 5 0x98110005 ERR_WRONGRECEIVEHMSG Wrong HMSG. 0x6 6 0x98110006 ERR_TARGETPORTNOTFOUND Target port not found – ADS server is not started, not reachable or not installed. 0x7 7 0x98110007 ERR_TARGETMACHINENOTFOUND Target computer not found – AMS route was not found. 0x8 8 0x98110008 ERR_UNKNOWNCMDID Unknown command ID. 0x9 9 0x98110009 ERR_BADTASKID Invalid task ID. 0x A 10 0x9811000A ERR_NOIO No IO. 0x B 11 0x9811000B ERR_UNKNOWNAMSCMD Unknown AMS command. 0x C 12 0x9811000C ERR_WIN32ERROR Win32 error. 0x D 13 0x9811000D ERR_PORTNOTCONNECTED Port not connected. 0x E 14 0x9811000E ERR_INVALIDAMSLENGTH Invalid AMS length. 0x F 15 0x9811000F ERR_INVALIDAMSNETID Invalid AMS Net ID. 0x10 16 0x98110010 ERR_LOWINSTLEVEL Installation level is too low –Twin CAT 2 license error. 0x11 17 0x98110011 ERR_NODEBUGINTAVAILABLE No debugging available. 0x12 18 0x98110012 ERR_PORTDISABLED Port disabled – Twin CAT system service not started. 0x13 19 0x98110013 ERR_PORTALREADYCONNECTED Port already connected. 0x14 20 0x98110014 ERR_AMSSYNC_W32ERROR AMS Sync Win32 error. 0x15 21 0x98110015 ERR_AMSSYNC_TIMEOUT AMS Sync Timeout. 0x16 22 0x98110016 ERR_AMSSYNC_AMSERROR AMS Sync error. 0x17 23 0x98110017 ERR_AMSSYNC_NOINDEXINMAP No index map for AMS Sync available. 0x18 24 0x98110018 ERR_INVALIDAMSPORT Invalid AMS port. 0x19 25 0x98110019 ERR_NOMEMORY No memory. 0x1A 26 0x9811001A ERR_TCPSEND TCP send error. 0x1B 27 0x9811001B ERR_HOSTUNREACHABLE Host unreachable. 0x1C 28 0x9811001C ERR_INVALIDAMSFRAGMENT Invalid AMS fragment. 0x1D 29 0x9811001D ERR_TLSSEND TLS send error – secure ADS connection failed. 0x1E 30 0x9811001E ERR_ACCESSDENIED Access denied – secure ADS access denied. Router error codes 510 Version: 1.3.0 TF8000
## Page 511

Appendix Hex Dec HRESULT Name Description 0x500 1280 0x98110500 ROUTERERR_NOLOCKEDMEMORY Locked memory cannot be allocated. 0x501 1281 0x98110501 ROUTERERR_RESIZEMEMORY The router memory size could not be changed. 0x502 1282 0x98110502 ROUTERERR_MAILBOXFULL The mailbox has reached the maximum number of possible messages. 0x503 1283 0x98110503 ROUTERERR_DEBUGBOXFULL The Debug mailbox has reached the maximum number of possible messages. 0x504 1284 0x98110504 ROUTERERR_UNKNOWNPORTTYPE The port type is unknown. 0x505 1285 0x98110505 ROUTERERR_NOTINITIALIZED The router is not initialized. 0x506 1286 0x98110506 ROUTERERR_PORTALREADYINUSE The port number is already assigned. 0x507 1287 0x98110507 ROUTERERR_NOTREGISTERED The port is not registered. 0x508 1288 0x98110508 ROUTERERR_NOMOREQUEUES The maximum number of ports has been reached. 0x509 1289 0x98110509 ROUTERERR_INVALIDPORT The port is invalid. 0x50A 1290 0x9811050A ROUTERERR_NOTACTIVATED The router is not active. 0x50B 1291 0x9811050B ROUTERERR_FRAGMENTBOXFULL The mailbox has reached the maximum number for fragmented messages. 0x50C 1292 0x9811050C ROUTERERR_FRAGMENTTIMEOUT A fragment timeout has occurred. 0x50D 1293 0x9811050D ROUTERERR_TOBEREMOVED The port is removed. General ADS error codes TF8000 Version: 1.3.0 511
## Page 512

Appendix Hex Dec HRESULT Name Description 0x700 1792 0x98110700 ADSERR_DEVICE_ERROR General device error. 0x701 1793 0x98110701 ADSERR_DEVICE_SRVNOTSUPP Service is not supported by the server. 0x702 1794 0x98110702 ADSERR_DEVICE_INVALIDGRP Invalid index group. 0x703 1795 0x98110703 ADSERR_DEVICE_INVALIDOFFSET Invalid index offset. 0x704 1796 0x98110704 ADSERR_DEVICE_INVALIDACCESS Reading or writing not permitted. Several causes are possible. For example, an incorrect password was entered when creating routes. 0x705 1797 0x98110705 ADSERR_DEVICE_INVALIDSIZE Parameter size not correct. 0x706 1798 0x98110706 ADSERR_DEVICE_INVALIDDATA Invalid data values. 0x707 1799 0x98110707 ADSERR_DEVICE_NOTREADY Device is not ready to operate. 0x708 1800 0x98110708 ADSERR_DEVICE_BUSY Device is busy. 0x709 1801 0x98110709 ADSERR_DEVICE_INVALIDCONTEXT Invalid operating system context. This can result from use of ADS blocks in different tasks. It may be possible to resolve this through multitasking synchronization in the PLC. 0x70A 1802 0x9811070A ADSERR_DEVICE_NOMEMORY Insufficient memory. 0x70B 1803 0x9811070B ADSERR_DEVICE_INVALIDPARM Invalid parameter values. 0x70C 1804 0x9811070C ADSERR_DEVICE_NOTFOUND Not found (files, ...). 0x70D 1805 0x9811070D ADSERR_DEVICE_SYNTAX Syntax error in file or command. 0x70E 1806 0x9811070E ADSERR_DEVICE_INCOMPATIBLE Objects do not match. 0x70F 1807 0x9811070F ADSERR_DEVICE_EXISTS Object already exists. 0x710 1808 0x98110710 ADSERR_DEVICE_SYMBOLNOTFOUND Symbol not found. 0x711 1809 0x98110711 ADSERR_DEVICE_SYMBOLVERSIONINVALID Invalid symbol version. This can occur due to an online change. Create a new handle. 0x712 1810 0x98110712 ADSERR_DEVICE_INVALIDSTATE Device (server) is in invalid state. 0x713 1811 0x98110713 ADSERR_DEVICE_TRANSMODENOTSUPP Ads Trans Mode not supported. 0x714 1812 0x98110714 ADSERR_DEVICE_NOTIFYHNDINVALID Notification handle is invalid. 0x715 1813 0x98110715 ADSERR_DEVICE_CLIENTUNKNOWN Notification client not registered. 0x716 1814 0x98110716 ADSERR_DEVICE_NOMOREHDLS No further handle available. 0x717 1815 0x98110717 ADSERR_DEVICE_INVALIDWATCHSIZE Notification size too large. 0x718 1816 0x98110718 ADSERR_DEVICE_NOTINIT Device not initialized. 0x719 1817 0x98110719 ADSERR_DEVICE_TIMEOUT Device has a timeout. 0x71A 1818 0x9811071A ADSERR_DEVICE_NOINTERFACE Interface query failed. 0x71B 1819 0x9811071B ADSERR_DEVICE_INVALIDINTERFACE Wrong interface requested. 0x71C 1820 0x9811071C ADSERR_DEVICE_INVALIDCLSID Class ID is invalid. 0x71D 1821 0x9811071D ADSERR_DEVICE_INVALIDOBJID Object ID is invalid. 0x71E 1822 0x9811071E ADSERR_DEVICE_PENDING Request pending. 0x71F 1823 0x9811071F ADSERR_DEVICE_ABORTED Request is aborted. 0x720 1824 0x98110720 ADSERR_DEVICE_WARNING Signal warning. 0x721 1825 0x98110721 ADSERR_DEVICE_INVALIDARRAYIDX Invalid array index. 0x722 1826 0x98110722 ADSERR_DEVICE_SYMBOLNOTACTIVE Symbol not active. 0x723 1827 0x98110723 ADSERR_DEVICE_ACCESSDENIED Access denied. Several causes are possible. For example, a unidirectional ADS route is used in the opposite direction. 0x724 1828 0x98110724 ADSERR_DEVICE_LICENSENOTFOUND Missing license. 0x725 1829 0x98110725 ADSERR_DEVICE_LICENSEEXPIRED License expired. 0x726 1830 0x98110726 ADSERR_DEVICE_LICENSEEXCEEDED License exceeded. 0x727 1831 0x98110727 ADSERR_DEVICE_LICENSEINVALID Invalid license. 0x728 1832 0x98110728 ADSERR_DEVICE_LICENSESYSTEMID License problem: System ID is invalid. 0x729 1833 0x98110729 ADSERR_DEVICE_LICENSENOTIMELIMIT License not limited in time. 0x72A 1834 0x9811072A ADSERR_DEVICE_LICENSEFUTUREISSUE Licensing problem: time in the future. 0x72B 1835 0x9811072B ADSERR_DEVICE_LICENSETIMETOLONG License period too long. 0x72C 1836 0x9811072C ADSERR_DEVICE_EXCEPTION Exception at system startup. 0x72D 1837 0x9811072D ADSERR_DEVICE_LICENSEDUPLICATED License file read twice. 0x72E 1838 0x9811072E ADSERR_DEVICE_SIGNATUREINVALID Invalid signature. 0x72F 1839 0x9811072F ADSERR_DEVICE_CERTIFICATEINVALID Invalid certificate. 0x730 1840 0x98110730 ADSERR_DEVICE_LICENSEOEMNOTFOUND Public key not known from OEM. 0x731 1841 0x98110731 ADSERR_DEVICE_LICENSERESTRICTED License not valid for this system ID. 512 Version: 1.3.0 TF8000
## Page 513

Appendix Hex Dec HRESULT Name Description 0x732 1842 0x98110732 ADSERR_DEVICE_LICENSEDEMODENIED Demo license prohibited. 0x733 1843 0x98110733 ADSERR_DEVICE_INVALIDFNCID Invalid function ID. 0x734 1844 0x98110734 ADSERR_DEVICE_OUTOFRANGE Outside the valid range. 0x735 1845 0x98110735 ADSERR_DEVICE_INVALIDALIGNMENT Invalid alignment. 0x736 1846 0x98110736 ADSERR_DEVICE_LICENSEPLATFORM Invalid platform level. 0x737 1847 0x98110737 ADSERR_DEVICE_FORWARD_PL Context – forward to passive level. 0x738 1848 0x98110738 ADSERR_DEVICE_FORWARD_DL Context – forward to dispatch level. 0x739 1849 0x98110739 ADSERR_DEVICE_FORWARD_RT Context – forward to real-time. 0x740 1856 0x98110740 ADSERR_CLIENT_ERROR Client error. 0x741 1857 0x98110741 ADSERR_CLIENT_INVALIDPARM Service contains an invalid parameter. 0x742 1858 0x98110742 ADSERR_CLIENT_LISTEMPTY Polling list is empty. 0x743 1859 0x98110743 ADSERR_CLIENT_VARUSED Var connection already in use. 0x744 1860 0x98110744 ADSERR_CLIENT_DUPLINVOKEID The called ID is already in use. 0x745 1861 0x98110745 ADSERR_CLIENT_SYNCTIMEOUT Timeout has occurred – the remote terminal is not responding in the specified ADS timeout. The route setting of the remote terminal may be configured incorrectly. 0x746 1862 0x98110746 ADSERR_CLIENT_W32ERROR Error in Win32 subsystem. 0x747 1863 0x98110747 ADSERR_CLIENT_TIMEOUTINVALID Invalid client timeout value. 0x748 1864 0x98110748 ADSERR_CLIENT_PORTNOTOPEN Port not open. 0x749 1865 0x98110749 ADSERR_CLIENT_NOAMSADDR No AMS address. 0x750 1872 0x98110750 ADSERR_CLIENT_SYNCINTERNAL Internal error in Ads sync. 0x751 1873 0x98110751 ADSERR_CLIENT_ADDHASH Hash table overflow. 0x752 1874 0x98110752 ADSERR_CLIENT_REMOVEHASH Key not found in the table. 0x753 1875 0x98110753 ADSERR_CLIENT_NOMORESYM No symbols in the cache. 0x754 1876 0x98110754 ADSERR_CLIENT_SYNCRESINVALID Invalid response received. 0x755 1877 0x98110755 ADSERR_CLIENT_SYNCPORTLOCKED Sync Port is locked. 0x756 1878 0x98110756 ADSERR_CLIENT_REQUESTCANCELLED The request was canceled. RTime error codes Hex Dec HRESULT Name Description 0x1000 4096 0x98111000 RTERR_INTERNAL Internal error in the real-time system. 0x1001 4097 0x98111001 RTERR_BADTIMERPERIODS Timer value is not valid. 0x1002 4098 0x98111002 RTERR_INVALIDTASKPTR Task pointer has the invalid value 0 (zero). 0x1003 4099 0x98111003 RTERR_INVALIDSTACKPTR Stack pointer has the invalid value 0 (zero). 0x1004 4100 0x98111004 RTERR_PRIOEXISTS The request task priority is already assigned. 0x1005 4101 0x98111005 RTERR_NOMORETCB No free TCB (Task Control Block) available. The maximum number of TCBs is 64. 0x1006 4102 0x98111006 RTERR_NOMORESEMAS No free semaphores available. The maximum number of semaphores is 64. 0x1007 4103 0x98111007 RTERR_NOMOREQUEUES No free space available in the queue. The maximum number of positions in the queue is 64. 0x100D 4109 0x9811100D RTERR_EXTIRQALREADYDEF An external synchronization interrupt is already applied. 0x100E 4110 0x9811100E RTERR_EXTIRQNOTDEF No external sync interrupt applied. 0x100F 4111 0x9811100F RTERR_EXTIRQINSTALLFAILED Application of the external synchronization interrupt has failed. 0x1010 4112 0x98111010 RTERR_IRQLNOTLESSOREQUAL Call of a service function in the wrong context 0x1017 4119 0x98111017 RTERR_VMXNOTSUPPORTED Intel VT-x extension is not supported. 0x1018 4120 0x98111018 RTERR_VMXDISABLED Intel VT-x extension is not enabled in the BIOS. 0x1019 4121 0x98111019 RTERR_VMXCONTROLSMISSING Missing function in Intel VT-x extension. 0x101A 4122 0x9811101A RTERR_VMXENABLEFAILS Activation of Intel VT-x fails. Specific positive HRESULT Return Codes: TF8000 Version: 1.3.0 513
## Page 514

Appendix HRESULT Name Description 0x0000_0000 S_OK No error. 0x0000_0001 S_FALSE No error. Example: successful processing, but with a negative or incomplete result. 0x0000_0203 S_PENDING No error. Example: successful processing, but no result is available yet. 0x0000_0256 S_WATCHDOG_TIMEOUT No error. Example: successful processing, but a timeout occurred. TCP Winsock error codes Hex Dec Name Description 0x274C 10060 WSAETIMEDOUT A connection timeout has occurred - error while establishing the connection, because the remote terminal did not respond properly after a certain period of time, or the established connection could not be maintained because the connected host did not respond. 0x274D 10061 WSAECONNREFUSED Connection refused - no connection could be established because the target computer has explicitly rejected it. This error usually results from an attempt to connect to a service that is inactive on the external host, that is, a service for which no server application is running. 0x2751 10065 WSAEHOSTUNREACH No route to host - a socket operation referred to an unavailable host. More Winsock error codes: Win32 error codes 514 Version: 1.3.0 TF8000
## Page 515

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Third-party trademark statements AMD is a trademark of Advanced Micro Devices, Inc. Intel, the Intel logo, Intel Core, Xeon, Intel Atom, Celeron and Pentium are trademarks of Intel Corporation or its subsidiaries. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 516

Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
