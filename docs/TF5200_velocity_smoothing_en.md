---
title: "TF5200_velocity_smoothing_en"
product: "TF5200"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.03"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5200_velocity_smoothing_en.pdf"
release_date: "2025-06-10"
---
Functional description | EN TF5200 | Twin CAT 3 CNC Velocity smoothing 6/10/2025 | Version: 1.03
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5200 | Twin CAT 3 CNC Version: 1.03 3 Velocity smoothing
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.03 TF5200 | Twin CAT 3 CNC Velocity smoothing
## Page 5

Contents Contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Description................................................................................................................................................ 9 2.1 Productivity factor............................................................................................................................ 10 3 Programming........................................................................................................................................... 12 4 Parameter................................................................................................................................................. 14 4.1 Overview......................................................................................................................................... 14 4.2 Description of parameters............................................................................................................... 14 4.3 CNC objects.................................................................................................................................... 16 5 Support and Service............................................................................................................................... 17 TF5200 | Twin CAT 3 CNC Version: 5 Velocity smoothing
## Page 6

Contents 6 Version: TF5200 | Twin CAT 3 CNC Velocity smoothing
## Page 7

List of figures List of figures Fig. 1 Effect of different productivity factors in velocity-path representation.......................................... 11 Fig. 2 Resulting velocity curve of the above programming example...................................................... 13 TF5200 | Twin CAT 3 CNC Version: 1.03 7 Velocity smoothing
## Page 8

Overview 1 Overview Task The aim of this functionality is to reduce machine oscillations caused by frequent program-related acceleration and deceleration processes. The functionality smooths the planned path velocity curve while taking a predefined criterion into consideration. Effectiveness Smoothing the path velocity curve or reducing acceleration and deceleration processes is achieved by cross- block adjustment of the planned maximum path velocities. The maximum path velocities are adjusted by reducing them, which can result in a longer machining time. Specifying the smoothing criterion (productivity factor) defines • the degree of smoothing as well as • the maximum machining time that is tolerable. This functionality is available as of CNC Build V3.01.3079.21. Parameterisation In order to use this functionality, it must be enabled by the parameter P-CHAN-00600 [} 14]. Programming The functionality is parameterised by the NC command #LAH[…] [} 12]. Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. 8 Version: 1.03 TF5200 | Twin CAT 3 CNC Velocity smoothing
## Page 9

Description 2 Description Depending on the NC program used, many successive acceleration and deceleration processes are possible during machining. This leads to an unsettled velocity curve, to oscillations and therefore to greater stress on the machine. The aim of the velocity smoothing functionality is to counteract this. The aims in detail: • avoids unnecessary acceleration and deceleration processes • achieves smoother running of the machining • reduces machine oscillations • reduces stress on the machine Requirement The functionality must be enabled by the channel parameter P-CHAN-00600. configuration.path_preparation.function FCT_DEFAULT | FCT_VSM Operation mode of velocity smoothing The velocity smoothing function considers cross-block motion blocks and reduces the maximum path velocities to a local minimum, if necessary, by adjusting them. The function acts exclusively on the maximum permissible path velocity of each block and therefore on the transition velocity of the motion blocks. Velocity smoothing gives preference to blocks where a reduced increase in machining time is achieved by decreasing path velocity instead of reducing blocks with a longer machining time. The smoothing effect of the function is negligible with NC programs that have many block transition velocities close to or equal to 0. Smoothing the path velocity curve also means a longer machining time. Properties of velocity smoothing • Velocity smoothing is a cross-block function. • The maximum reduction in path velocity is dependent on the productivity factor and the minimum actual maximum velocity of a block in the range under review. • The symmetrical operation mode of the smoothed path velocity curve with forward and backward motion is largely identical. • Velocity smoothing has a slowing effect on block supply due to the buffering of block supply. A possible solution to this is to give a higher priority to the SDA task. TF5200 | Twin CAT 3 CNC Version: 1.03 9 Velocity smoothing
## Page 10

Description 2.1 Productivity factor The user can use the productivity factor to control the effect of velocity smoothing. The productivity factor controls two variables: • the degree of smoothing • limiting productivity losses Determining the productivity factor: Reducing the maximum path velocity by smoothing results in a longer machining time. This is due to the following factors: The maximum expected increase in machining time (as a percentage) for the given productivity factor can also be determined as follows: The real productivity factor achieved is always >= the specified productivity factor. Example of calculating the productivity factor Productivity factor = 90(%) means that the smoothed curve has a minimum of 90% of the original productivity. This means that the maximum increase in machining time in % is 1/0.9x100 = 111.11%. The NC program then requires a maximum of 11.11% more machining time than originally programmed. The figures below show the effect on the velocity curve with and without various productivity factors using the example of an HSC program. Blue = Permissible maximum path velocity using the CNC object “Maximum velocity on path [} 16]”. Red = Path velocity using the CNC object “Current velocity on path [} 16]”. 10 Version: 1.03 TF5200 | Twin CAT 3 CNC Velocity smoothing
## Page 11

Description Fig. 1: Effect of different productivity factors in velocity-path representation If a productivity factor of 100 (%) is specified, the curve of the maximum blockwise path velocities will also be always adjusted or changed as well. However, this should have no influence on pro- ductivity as defined by the default of 100%. TF5200 | Twin CAT 3 CNC Version: 1.03 11 Velocity smoothing
## Page 12

Programming 3 Programming Velocity smoothing in the NC program is programmed using the #LAH command. This NC command can be used to enable/disable velocity smoothing and to change the parameters when the NC program is active. Syntax: #LAH [SMOOTH_PATH_VEL =.. PROD_FACT =.. ] non-modal SMOOTH_PATH_VEL Enable/disable velocity smoothing =.. 0: Velocity smoothing not enabled 1: Velocity smoothing enabled PROD_FACT=.. Productivity factor in % Value range: 0 < productivity factor <= 100% NOTICE When you enable velocity smoothing and change the productivity factor, both keywords must always be programmed. If one parameter is missing, the error ID 21104 is output. 12 Version: 1.03 TF5200 | Twin CAT 3 CNC Velocity smoothing
## Page 13

Programming Programming example for velocity smoothing This programming example shows a simple NC program where a linear block sequence is passed through 3 times. • Pass 1 (S1): without velocity smoothing • Pass 2 (S2): with velocity smoothing of 90% enabled • Pass 3 (S3): Velocity smoothing parameters are changed to 50% and then velocity smoothing is disabled. %main ( Pass 1) N020 G00 G90 X0 Y0 Z0 N030 G01 X1 Y1 F30000 N040 G01 X2 Y0 N050 G01 X0 ( Pass 2) N060 #LAH [SMOOTH_PATH_VEL = 1 PROD_FACT = 90] N070 G01 X1 Y1 N080 G01 X2 Y0 N090 G01 X0 ( Pass 3) N100 #LAH [SMOOTH_PATH_VEL = 1 PROD_FACT = 50] N110 G01 X1 Y1 N120 G01 X2 Y0 N130 G01 X0 N140 #LAH [SMOOTH_PATH_VEL = 0] (Deactivation) N150 G260 N160 M30 Blue: maximum permissible path velocity Red: current path velocity Fig. 2: Resulting velocity curve of the above programming example TF5200 | Twin CAT 3 CNC Version: 1.03 13 Velocity smoothing
## Page 14

Parameter 4 Parameter 4.1 Overview ID Parameter Description P-CHAN-00600 configuration.path_pre Enable functionalities for path preparation paration.function Alternatively: P-STUP-00060 ..path_preparation.func Enable functions in path preparation tion (Alternative but not recommended). 4.2 Description of parameters Channel parameters P-CHAN-00600 Defining functionalities for path preparation. Description This parameter defines the individual functionalities for path preparation. The individual functions can be enabled or disabled for testing or for performance reasons. Parameter configuration.path_preparation.function Data type STRING Data range See Description of parameters [} 15] Dimension ---- Default value FCT_DEFAULT Remarks Parameter is available as of the following Builds: V2.11.2040.04 ; V2.11.2810.02 ; V3.1.3079.17 ; V3.1.3107.10 Functions can be defined in P-CHAN-00605 and P-CHAN-00606 depending on the machining mode. Start-up parameters P-STUP-00060 Defining functionalities for path preparation. Description This parameter defines the individual functionalities for path preparation. The individual functions can be enabled or disabled for testing or for performance reasons. Parameter configuration.channel[i].path_preparation.function Data type STRING Data range See Description of parameters [} 15] Dimension ---- Default value FCT_DEFAULT Remarks 14 Version: 1.03 TF5200 | Twin CAT 3 CNC Velocity smoothing
## Page 15

Parameter Path preparation function table Identifier Description FCT_DEFAULT The functions FCT_FFM | FCT_PRESEGMENTATION | FCT_SPLINE | FCT_POLY | FCT_CAX | FCT_CAX_TRACK | FCT_SEGMENTATION are available. FCT_FFM Free-form surface mode, #HSC [OPMODE 1 CONTERR 0.01], #HSC [OPMODE 2] FCT_PRESEGMENTATION Linear pre-segmentation in HSC mode FCT_SPLINE #HSC[], AKIMA, B-Spline, G150/G151 FCT_POLY #CONTOUR MODE[], G61, G261/G260 FCT_CAX C axis processing, i.e. the spindle is embedded in the NC channel. FCT_CAX_TRACK #CAXTRACK, tracking an axis according to the contour angle FCT_SEGMENTATION For dynamic segmentation of the path contour, e.g. if the curvature of a polynomial segment varies significantly. The following functions must also be enabled: FCT_LIFT_UP Automatic lifting/lowering of an axis (path-based coupling). Example: FCT_DEFAULT | FCT_LIFT_UP FCT_EMF Edge machining (sharp angle contours). Example: FCT_DEFAULT | FCT_EMF FCT_EMF_POLY_OFF Edge machining inactive with polynomials. Contrary to the setting with FCT_EMF, edge signal generation is masked when path polynomial generation is active in the channel. Polynomials are generated for smoothing G261 or when B Spline is active. The resulting geometry is then tangential. Example: FCT_DEFAULT | FCT_EMF_POLY_OFF FCT_SYNC Synchronise an axis to a path group. Example: FCT_DEFAULT | FCT_SYNC FCT_PRECON Optimised planning using #HSC[BSPLINE]. Example: FCT_DEFAULT | FCT_PRECON FCT_LIFT_UP_TIME Automatic lifting/lowering of an axis (time-based coupling). Example: FCT_DEFAULT | FCT_LIFT_UP_TIME FCT_PTP Dynamically optimised smoothing of the complete contour. Example: FCT_DEFAULT | FCT_PTP FCT_M_PRE_OUTPUT Pre-output of M/H functions (microjoints). Example: FCT_DEFAULT | FCT_M_PRE_OUTPUT FCT_SURFACE HSC machining with Surface Optimiser Example: FCT_DEFAULT | FCT_SURFACE FCT_SEG_CHECK Block segmentation in combination with path-controlled offset of M functions (dwell time), see P-CHAN-00650 and Description of parameters [} 15] Example: FCT_DEFAULT | FCT_SEG_CHECK FCT_NIBBLING Activate the nibbling function Example: FCT_DEFAULT | FCT_NIBBLING FCT_PUNCHING Activate the punching function Example: FCT_DEFAULT | FCT_PUNCHING FCT_VSM Activate the velocity smoothing function Example: FCT_DEFAULT | FCT_VSM as of V3.1.3079.21 TF5200 | Twin CAT 3 CNC Version: 1.03 15 Velocity smoothing
## Page 16

Parameter 4.3 CNC objects Name Maximum velocity on path Description This object reads the maximum velocity on the path. Task GEO (Port 551) Index group 0x12130<C > Index offset 0x F ID Data type UNS32 Length 4 Attributes read Unit [µm/s] Remarks Name Current velocity on path Description This object reads the current velocity on the path. Task GEO (Port 551) Index group 0x12130<C > Index offset 0x15 ID Data type REAL64 Length 8 Attributes read Unit [µm/s] Remarks Name Maximum velocity on path at block end Description This object reads the maximum velocity on the path at block end. Task GEO (Port 551) Index group 0x12130<C > Index offset 0x10 ID Data type UNS32 Length 4 Attributes read Unit [µm/s] Remarks 16 Version: 1.03 TF5200 | Twin CAT 3 CNC Velocity smoothing
## Page 17

Support and Service 5 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF5200 | Twin CAT 3 CNC Version: 1.03 17 Velocity smoothing
## Page 19

More Information: www.beckhoff.com/TF5200 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
