---
title: "TF5245"
product: "TF5245"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.319"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5245_tc3_cnc_cycles_kinopt_en.pdf"
release_date: "2025-06-05"
---
Manual | EN TF5245 | Twin CAT 3 CNC Kinematic Optimization 6/5/2025 | Version: 1.319
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5245 | Twin CAT 3 CNC Version: 1.319 3 Kinematic Optimization
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 5

Contents Contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Description.............................................................................................................................................. 10 2.1 Preparations.................................................................................................................................... 10 2.1.1 CNC controller.................................................................................................................. 10 2.1.2 Machine controller............................................................................................................ 10 2.2 Measurement and calculation cycle................................................................................................ 11 2.2.1 General parameters......................................................................................................... 11 2.2.2 Setting the measurement poses...................................................................................... 12 2.3 Kinematic-related arrangement of axes.......................................................................................... 15 3 Measuring the machine.......................................................................................................................... 16 3.1 General sequence of measurement run.......................................................................................... 16 3.2 Measuring with measurement subroutines..................................................................................... 17 3.3 External measurement.................................................................................................................... 18 3.3.1 Manual measurement with calibration sphere.................................................................. 18 3.3.2 Measuring the TCP (tool centre point)............................................................................. 19 4 Preparing the calculation cycle............................................................................................................. 20 4.1 Adapting the output file................................................................................................................... 20 4.2 Adapting the output format.............................................................................................................. 20 4.3 Adapting the limit for deviation........................................................................................................ 21 4.4 Initialising the kinematic calculation................................................................................................ 21 4.5 Entering measurement results........................................................................................................ 22 4.5.1 Direct input of measurement data.................................................................................... 22 4.5.2 Sphere centre points already calculated.......................................................................... 23 4.6 Kinematic-specific changes............................................................................................................. 24 4.6.1 KIN_TYP_80.................................................................................................................... 24 4.6.2 KIN_TYP_90.................................................................................................................... 24 5 Executing the calculation cycle............................................................................................................. 25 5.1 Starting the main program............................................................................................................... 25 6 Checking the calibration........................................................................................................................ 26 6.1 Plausibility check of the output........................................................................................................ 26 6.2 Determining missing offsets............................................................................................................ 28 6.2.1 KIN_TYP_80.................................................................................................................... 28 6.3 Machining test part.......................................................................................................................... 28 7 Support and Service............................................................................................................................... 29 TF5245 | Twin CAT 3 CNC Version: 5 Kinematic Optimization
## Page 6

Contents 6 Version: TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 7

List of figures List of figures Fig. 1 Meaning of geometry parameters................................................................................................ 12 Fig. 2 Example of distribution of measurement points on a hemisphere............................................... 18 Fig. 3 Example of a test part – A or B in zero position........................................................................... 28 TF5245 | Twin CAT 3 CNC Version: 1.319 7 Kinematic Optimization
## Page 8

Overview 1 Overview Task The “Kinematic Optimisation” cycle (Kin Opt) allows an increase in machining accuracy on 5-axis machine tools. Geometric inaccuracies in machine kinematics are determined by a measurement run. This is followed by a calculation program to define optimised kinematic parameters which can then be entered in the machine configuration. Effectiveness The kinematic parameters are improved compared to the drawing dimensions and this leads to an enhanced precision of the workpiece. Condition The following is required for the measurement run: • an absolutely accurate XYZ probe or • a calibration sphere or • alternative measuring equipment Cycles are additional options and subject to the purchase of a license. This additional option is available as of CNC Build V3.1.3068.09.. Restrictions The method is restricted to the following kinematics: • KIN_TYP_9: Cartesian CA head • KIN_TYP_57: BC table • KIN_TYP_58: AC table • KIN_TYP_59: Cardanic CA head • KIN_TYP_60: Cardanic CB head • KIN_TYP_80: AB table • KIN_TYP_90: Cartesian AB and CA head, cardanic CA head Other kinematics A number of other kinematics are special cases of the above listed kinematics. For example, the Cartesian CA head only supports the KIN_TYP_9. However, machines which were previously operated as KIN_TYP_10, KIN_TYP_25 or KIN_TYP_28 can also be parameterised as KIN_TYP_9. Links Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. 8 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 9

Overview For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. TF5245 | Twin CAT 3 CNC Version: 1.319 9 Kinematic Optimization
## Page 10

Description 2 Description 2.1 Preparations 2.1.1 CNC controller Configuring the kinematics NOTICE Collision risk The measurement run is operated with a selected kinematic. The kinematic must therefore be configured using the drawing dimensions of the machine (or with sufficiently accurate values). The aim of the Kin Opt cycle is to supply compensation values for the kinematic parameters. Naming the axes The axes must be named as follows in the channel in which the measurement run is operated. • X for the X axis • Y for the Y axis • Z for the Z axis • A for the (optional) rotary axis about X • B for the (optional) rotary axis about Y • C for the (optional) rotary axis about Z Naming the axes For example, the axes can be named using the #SET AX command or by channel parameters. Supplying the cycles First execute the installation program for the CNC cycles. 2.1.2 Machine controller Probe and calibration sphere The operator carries out the following steps: • Install calibration sphere on machine table. • Move rotary axes to 0. • Clamp probe in tool holder; enter probe tool length. • Use manual block or JOG to position the probe approximately centrally and at a clearance of several centimetres above the sphere. Probe and sphere can be swapped. The layout is irrelevant for the cycle. The documentation only describes the case described above. 10 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 11

Description 2.2 Measurement and calculation cycle An example program for parameterising the cycle is available for automatic measurement with "Sys Calib Kinematic Demo.nc". Appropriate changes for the kinematics to be measured and the measuring equipment used must be made in this program. The parameters to be modified are described in detail below. 2.2.1 General parameters General parameters include: • Geometry of the probe and calibration sphere • Safety distances for pre-positioning and measurement run • Velocities for pre-positioning and measurement run • Kinematics used • Path to save the measurement results in "message.txt" on the default path Geometry Unit Meaning V. P. RADIUS_TOO mm Radius of probe tip (clamped in the spindle) L V. P. SAFETY_POS mm Safety distance about the calibration sphere during pre-positioning V. P. SAFETY_DIST mm Safety distance around the calibration sphere during measurement Must be ANCE_MEAS large enough to reach measurement speed. V. P. RADIUS_WOR mm Radius of the calibration sphere (placed on bench as workpiece) KPIECE V. P. MEASURING_ mm/ Velocity for measuring (G100 blocks) FEED min V. P. POSITIONING mm/ Velocity for positioning _FEED min V. P. KIN_TYP - Kinematic of the machine V. P. KIN_TYP_VAR - Variant of the kinematic if, for example, several kinematics can be grouped by IANT one number, as with kinematic 90 #FILE NAME [MSG String Path to save measurement data = "…"] V. L. PRINT - Output of a log in the parameterised file, 0 = no log, 1 = German, 2 = English (optional) V. P. MAX_PRECISI mm Maximum permitted deviation of measurement errors ON (optional) V. P. LIST_FORMA - Output formats: 0 = XML, 1 = Twin CAT 2, 2 = Twin CAT 3 T The radii of the probe tip and calibration sphere only serve to calculate the motion paths and are not used to calculate offsets. It is therefore sufficient to enter approximations for these radii. The meaning of the geometry parameters is described in the figure below. TF5245 | Twin CAT 3 CNC Version: 1.319 11 Kinematic Optimization
## Page 12

Description Fig. 1: Meaning of geometry parameters The first measurement movement is in the negative Z direction. The measurement path is determined by the parameters entered by the operator and is incremental from the starting point: Z = -(V. P. RADIUS_TOOL+V. P. SAFETY_DISTANCE_POS + 2*V. P. RADIUS_WORKPIECE) Probe radius (as tool) V. P. RADIUS_TOOL = 3Positioning safety distance: V. P. SAFETY_DISTANCE_POS = 20Calibration sphere radius (as workpiece): V. P. RADIUS_WORKPIECE = 15 The resulting NC block is: G100 G91 Z-[3+20+2*15] A distance of -53 mm is traversed in Z, then the distance between the sphere and the probe at the start must be smaller than 53mm. The safety distance must be large enough to reach the correct measuring velocity. Otherwise, deviations may occur due to the velocity-dependent switching signal. 2.2.2 Setting the measurement poses The measurement poses are positions of the two rotary axes in which the calibration sphere is measured. There are 2 methods to set the poses: • Measurement positions are generated by rotating an axis with the second axis held fast. • Pose to be measured directly across all axis angles. Enter with 2nd axis held fast In this case, the individual poses are defined as an array. This must be executed for every rotary axis. One axis is always held fast (V. P. POS_2ND_AXIS[i]) and the second axis is measured at a number of positions between the start and end angles as defined by V. P. NUMBER_SPHERE_MEAS[i]. If the difference between the start and end angles is greater than: [360/V. P. NUMBER_SPHERE_MEAS[i]] * [V. P. NUMBER_SPHERE_MEAS[i] - 1] …the calculated angle is used as the end angle. Example: • Start angle = 0 • End angle = 360 • Number of poses = 4 • [360/4] * 3 = 270 12 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 13

Description Therefore, the poses 0, 90, 180 and 270 are measured. Parameter Unit Meaning V. P. NUMBER_MEAS_PROC - Number of measurement processes (arrays) V. P. MEAS_AXIS[i] - Axis to be measured; A=1, B=2, C=3 V. P. NUMBER_SPHERE_MEAS[i] - Number of measurement poses V. P. START_ANGLE_MEAS[i] °, degrees Starting position of the moved axis V. P. END_ANGLE_MEAS[i] °, degrees End position of the moved axis V. P. POS_2ND_AXIS[i] °, degrees Position of the second rotary axis Number of measurements of single rotary axes The programming example below shows the parameters required to set the measurement poses. #VAR V. P. NUMBER_MEAS_PROC #ENDVAR V. P. NUMBER_MEAS_PROC = 2 #VAR V. P. MEAS_AXIS[V. P. NUMBER_MEAS_PROC] V. P. NUMBER_SPHERE_MEAS[V. P. NUMBER_MEAS_PROC] V. P. START_ANGLE_MEAS[V. P. NUMBER_MEAS_PROC] V. P. END_ANGLE_MEAS[V. P. NUMBER_MEAS_PROC] V. P. POS_2ND_AXIS[V. P. NUMBER_MEAS_PROC] #ENDVAR (First measurement, here A axis) (A axis is measured in positions A-45, A0 and A45) (C axis stands at 0) V. P. MEAS_AXIS[0] = 1 (axis: 1: A; 2: B; 3: C - depends) (on kinematic and variant) V. P. NUMBER_SPHERE_MEAS[0] = 3 (number of poses to be measured) V. P. START_ANGLE_MEAS[0] = -45 (starting angle [degrees]) V. P. END_ANGLE_MEAS[0] = 45 (end angle [degrees]) V. P. POS_2ND_AXIS[0] = 0 (position of second axis) (during the measurement) (Second measurement, here C axis) (The C axis is measured in positions C0, C90, C180 and C270) (. The A axis stands at A35) V. P. MEAS_AXIS[1] = 3 V. P. NUMBER_SPHERE_MEAS[1] = 4 V. P. START_ANGLE_MEAS[1] = 0 V. P. END_ANGLE_MEAS[1] = 360 V. P. POS_2ND_AXIS[1] = 35 Direct input of poses If single poses are entered directly, an array V. P. MEAS_POSE[3][Number of measurement poses] must first be defined. It consists of the 3 rotation directions and the number of poses to be measured. The angles of the non-existing rotary axis must be initialised with 0. The rotary axes are positioned in the sequence in which they were parameterised in the array. Defining the array The next programming example describes the parameterisation of 9 poses for a BC kinematic. #VAR V. P. MEAS_POSE[3][9] #ENDVAR (A axis B axis C axis) V. P. MEAS_POSE[0][0] = 0 V. P. MEAS_POSE[1][0] = 0 V. P. MEAS_POSE[0][1] = 0 V. P. MEAS_POSE[1][1] = 0 V. P. MEAS_POSE[0][2] = 0 V. P. MEAS_POSE[1][2] = 0 V. P. MEAS_POSE[0][3] = 0 V. P. MEAS_POSE[1][3] = 0 V. P. MEAS_POSE[0][4] = 0 V. P. MEAS_POSE[1][4] = 90 V. P. MEAS_POSE[0][5] = 0 V. P. MEAS_POSE[1][5] = 180 V. P. MEAS_POSE[0][6] = 0 V. P. MEAS_POSE[1][6] = 270 V. P. MEAS_POSE[0][7] = 0 V. P. MEAS_POSE[1][7] = 45 V. P. MEAS_POSE[0][8] = 0 V. P. MEAS_POSE[1][8] = 84 TF5245 | Twin CAT 3 CNC Version: 1.319 13 Kinematic Optimization
## Page 14

Description V. P. MEAS_POSE[2][0] = -45 V. P. MEAS_POSE[2][1] = 0 V. P. MEAS_POSE[2][2] = 45 V. P. MEAS_POSE[2][3] = 35 V. P. MEAS_POSE[2][4] = 35 V. P. MEAS_POSE[2][5] = 35 V. P. MEAS_POSE[2][6] = 35 V. P. MEAS_POSE[2][7] = 40 V. P. MEAS_POSE[2][8] = 40 Minimum number of poses A minimum number of poses to be approached is required to define the kinematic parameters correctly. This minimum number depends on the kinematic and is specified in the table below: Kinematic and variant Structure Minimum number of poses Kinematic 9 CA head kinematic 4 measurement poses (Cartesian) Kinematic 57 BC table kinematic 5 measurement poses (Cartesian) Kinematic 58 AC table kinematic 5 measurement poses (Cartesian) Kinematic 59 CA head kinematic 5 measurement poses (cardanic) Kinematic 60 CB head kinematic 5 measurement poses (cardanic) Kinematic 80 AB table kinematic A and B must each have at least 2 different values (Cartesian) Kinematic 90, variant 0 AB head kinematic 4 measurement poses (Cartesian) Kinematic 90, variant 2 CA head kinematic 4 measurement poses (Cartesian) Kinematic 90, variant 8 CA head kinematic 5 measurement poses (cardanic) This minimum number must be maintained both for automatic and manual measurements. However, there are also poses which supply no further information about the kinematic. In addition, the effect of measurement errors on the calculation results is reduced if more poses are measured than required. Therefore, we recommend measuring more poses than the specified minimum number., Moreover, the measured poses should be evenly distributed along the entire motion range of the rotary axes. Pose selection In general, possible measurement errors can be averaged out more easily with a large number of poses. This reduces the risk of selecting poses which supply no further information and then lead to a measurement run without a result. Make sure that the measurement poses cover the largest possible swivel range of the rotary axes. 14 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 15

Description 2.3 Kinematic-related arrangement of axes The arrangement and naming of the measurement axes is dependent on the kinematic and may have to be generated by the command #SET AX. In the example below: • #SET AX commands are specified for the supported kinematics • the logical axis number (2nd argument in brackets) must be adapted • a 6th axis exists for kinematic 90 Kinematic-related arrangement of axes (KIN_TYP_9) #SET AX[X,1,0][Y,2,1][Z,3,2][C,5,3][A,4,4] (KIN_TYP_57) #SET AX[X,1,0][Y,2,1][Z,3,2][B,8,3][C,5,4] (KIN_TYP_58) #SET AX[X,1,0][Y,2,1][Z,3,2][A,4,3][C,5,4] (KIN_TYP_59) #SET AX[X,1,0][Y,2,1][Z,3,2][C,5,3][A,4,4] (KIN_TYP_60) #SET AX[X,1,0][Y,2,1][Z,3,2][C,5,3][B,8,4] (KIN_TYP_80) #SET AX[X,1,0][Y,2,1][Z,3,2][A,4,3][B,8,4] (KIN_TYP_90, Variant 0) #SET AX[X,1,0][Y,2,1][Z,3,2][A,4,3][B,8,4][C,5,5] (KIN_TYP_90, Variant 2) #SET AX[X,1,0][Y,2,1][Z,3,2][C,5,3][A,4,4][B,8,5] (KIN_TYP_90, Variant 8) #SET AX[X,1,0][Y,2,1][Z,3,2][C,5,3][A,4,4][B,8,5] TF5245 | Twin CAT 3 CNC Version: 1.319 15 Kinematic Optimization
## Page 16

Measuring the machine 3 Measuring the machine The machine can be measured in various ways: • With the measurement subroutines provided • External measurement: Manual measurement with calibration sphere • External measurement: Measuring the TCP (tool centre point) 3.1 General sequence of measurement run Measuring for pre-positioning • adjust kinematic offsets and tool length (drawing dimensions) • the rotary axes are in zero position • the probe is roughly positioned above the sphere centre point • the sphere is scanned in the X, Y and Z directions and its centre point is determined Measuring the compensation values This step can be executed either by the supplied measurement subroutines or manually. • the configured poses are approached • scan the sphere in each of the poses and measure their centre point Calculating the compensation values • Call the calculation subroutine. Use the centre points of the sphere measured in the previous step or the TCP positions defined by external measuring equipment • The calculation may take several minutes • The results are output in list format Checking by the operator • Operator copies compensation values to the channel parameter list If the measurement is executed automatically using the measurement subroutines provided, no fur- ther settings need be made for the evaluation. If this is the case, you can skip the following sections up to “Checking” and “Evaluation”. 16 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 17

Measuring the machine 3.2 Measuring with measurement subroutines Secure a calibration sphere to the machining table and clamp a probe in the tool holder. It is also possible to secure the calibration sphere in the spindle and the probe to the table. Before starting the calibration program, position the probe roughly above the centre point of the calibration sphere. The rotary axes must be in zero position. If the calibration sphere is at a known position, it can be moved towards it from the measurement program. The kinematic offsets and tool length must be approximately correct (drawing dimensions) since the individual poses are approached using the kinematic transformation. TF5245 | Twin CAT 3 CNC Version: 1.319 17 Kinematic Optimization
## Page 18

Measuring the machine 3.3 External measurement It is also possible to use externally determined measurement values to calculate the offsets. In this case, • either a sphere can be measured or • the TCP can be directly measured if there is a suitable measuring instrument. 3.3.1 Manual measurement with calibration sphere Apart from the calibration sphere, a 3D dial gauge, a probe or another suitable measuring instrument are required. The operator swivels the two rotary axes to specific values. Then carefully approach the calibration sphere with the dial gauge manually or with the probe. In other words, the dual gauge approaches the calibration sphere until the gauge indicates a definite deflection. This deflection should be as small as possible (a few 1/100mm) but it should still be large enough so that it is definitely recognisable as a deflection. NOTICE When approaching the calibration sphere, it is important that only linear axes X, Y and Z are moved, not the rotary axes. In addition, make sure that the kinematic transformation is not active (#TRAFO OFF). If you use a probe, make sure that the scanning movement is perpendicular to the surface to avoid distortions. When the scanning event is recognised, the operator notes down the axis values of X, Y and Z for the related pose. Repeat the scanning procedure for other points on the sphere surface and in the same pose of the rotary axes. Between 6 and 10 points should be scanned per pose. They should be evenly distributed over a large surface area which is greater than (half) the surface of the calibration sphere. One example (top view) for possible scanning points: Fig. 2: Example of distribution of measurement points on a hemisphere In addition, during the scan, make sure that the probe moves as far as possible in the direction of the sphere centre. This is especially possible at points “near the equator” and at the “north pole” since pure X/Y and Z movements are possible in manual mode at those points. When the measurement values are recorded for a pose, a log should be obtained with the following structure (axis values in mm or degree; use a time stamp). 18 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 19

Measuring the machine Measurement values recorded manually X = 103.304 Y = 255.257 Z = 200.000 X = 113.422 Y = 243.257 Z = 200.000 X = 102.089 Y = 233.421 Z = 200.000 X = 87.696 Y = 245.920 Z = 188.835 X = 93.027 Y = 255.847 Z = 188.835 X = 102.861 Y = 258.935 Z = 186.585 Repeat this method for other poses. During the process, do not remove the calibration sphere from the table or reposition it. Select the poses from the following aspects: • The rotary axes must assume several different values. Use the above mentioned minimum number of poses for the supported kinematics. • The test set-up and the machine construction influence the selection poses due to the restricted range of motion (collision risk). • A higher number of poses makes it easier to obtain better averaging of measurement errors. 3.3.2 Measuring the TCP (tool centre point) If there is a measuring instrument for the direct recording of the TCP position, e.g. • a nest in which a sphere can be immersed, or • a high-precision camera system etc. this position can be transferred to the calculation algorithm together with the associated pose. TF5245 | Twin CAT 3 CNC Version: 1.319 19 Kinematic Optimization
## Page 20

Preparing the calculation cycle 4 Preparing the calculation cycle There is a programming example to execute the calculation for every available kinematic without automatic measurement. They are: • Sys Calib Fit009V0Demo.nc • Sys Calib Fit057V0Demo.nc • Sys Calib Fit058V0Demo.nc • Sys Calib Fit059V0Demo.nc • Sys Calib Fit060V0Demo.nc • Sys Calib Fit080V0Demo.nc • Sys Calib Fit090V0Demo.nc • Sys Calib Fit090V2Demo.nc 4.1 Adapting the output file The path and name of the output file can be adapted here. Defining the filename of the output file #FILE NAME [MSG = "calibration_result.txt"] Replace the string "calibration_result.txt" by a filename of your choice. 4.2 Adapting the output format The list format with the output results can be parameterised with the variable V. P. LIST_FORMAT. Setting the output format ; Format of the output: 0 *.xml (default), 1 TC2, 2 TC3 V. P. LIST_FORMAT = 1 ( format of the list containing the results ) 20 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 21

Preparing the calculation cycle 4.3 Adapting the limit for deviation The variable V. P. MAX_PRECISION specifies the maximum permitted deviation of the kinematic measured. Setting the maximum error ; maximum permitted deviation in mm V. P. MAX_PRECISION = 0.06 This value is the upper limit for the permitted deviation of the calculated solution of an ideal kinematic. If this deviation is exceeded during calibration (measurement errors, errors in the linear axes, position- dependent errors of the rotary axes), an error message P-ERR-13346 is output. This value must be determined by trial and error. 4.4 Initialising the kinematic calculation The following parameters must be transferred to the calculation cycle "Sys Calib Fit Init.ecy": • @P1: the kinematic used • @P2: the variant of the kinematic 0 is a kinematic without variant • @P3: the number of poses measured Calling the calculation cycle Number of poses, e.g. number of [A, B] combinations #VAR V. L. KIN_TYP = 80 ( kinematic measured ) V. L. KIN_VARIANT = 0 ( variant of kinematic measured ) V. L. NUMBER_OF_POSES = 8 ( number of measurement poses ) #ENDVAR L CYCLE [NAME = "Sys Calib Fit Init.ecy" \ @P1 = V. L. KIN_TYP \ @P2 = V. L. KIN_VARIANT \ @P3 = V. L. NUMBER_OF_POSES \ ] TF5245 | Twin CAT 3 CNC Version: 1.319 21 Kinematic Optimization
## Page 22

Preparing the calculation cycle 4.5 Entering measurement results After initialisation, the calculation is executed with the data entered. 4.5.1 Direct input of measurement data Enter the measurement results of linear axes X, Y and Z (in mm) for each pose. In addition, specify the related angles of the rotary axes. In the example below, an AB table kinematic was measured in pose A=20 and B=0 degrees. Although there is no C axis in the example, the C position must be transferred with 0. Example of the direct input of measured data ; Defining variables #VAR V. L. N = 6 ( number of points measured ) V. L. X[V. L. N] ( X coordinate of points measured ) V. L. Y[V. L. N] ( Y coordinate of points measured ) V. L. Z[V. L. N] ( Z coordinate of points measured ) V. L. RESULT_V[3] ( array to save calculation results ) V. L. A = 20 ( position of A axis ) V. L. B = 0 ( position of B axis ) V. L. C = 0 ( position of C axis ) #ENDVAR ; List of XYZ coordinates of all points measured in this pose, in mm V. L. X[0] = 101.807 V. L. Y[0] = 273.174 V. L. Z[0] = 130.068 V. L. X[1] = 116.795 V. L. Y[1] = 258.750 V. L. Z[1] = 130.068 V. L. X[2] = 104.246 V. L. Y[2] = 244.524 V. L. Z[2] = 129.024 V. L. X[3] = 89.606 V. L. Y[3] = 257.804 V. L. Z[3] = 132.980 V. L. X[4] = 96.606 V. L. Y[4] = 269.804 V. L. Z[4] = 133.957 V. L. X[5] = 102.780 V. L. Y[5] = 264.366 V. L. Z[5] = 139.522 ; Call cycle to calculate sphere centre point L CYCLE [NAME = "Sys Calc Sphere.ecy"] ; Add new coordinates to calculate kinematic L CYCLE [NAME = "Sys Calib Fit Add Record.ecy" \ @P1 = V. L. RESULT_V[0] \ @P2 = V. L. RESULT_V[1] \ @P3 = V. L. RESULT_V[2] \ @P4 = V. L. A \ @P5 = V. L. B \ @P6 = V. L. C \ ] ; ... Executing input for all poses This step must be executed for every pose measured. The calculation process can then be started from the same NC program as the values entered. Calling the calculation cycle V. P. MAX_PRECISION = 0.06 (precision) V. P. LIST_FORMAT = 1 ( list format for result ) #ENDVAR ; Call calculation cycle L CYCLE [NAME = "Sys Calib Fit.ecy" \ @P1 = V. L. LIST \ @P2 = V. L. MAX_PRECISION \ ] ; Call to end cycle L CYCLE [NAME = "Sys Calib Fit Finalize.ecy"] 22 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 23

Preparing the calculation cycle 4.5.2 Sphere centre points already calculated If the sphere centre points are already known, as shown in the example if a measurement was executed using measuring equipment from third-party providers, they can be used directly for calculation. Entering sphere centre points for various poses Initialisation: Number of poses, e.g. number of A,B combinations #VAR V. L. KIN_TYP = 80 (kinematic measured) V. L. KIN_VARIANT = 0 (variant of kinematic measured) V. L. NUMBER_OF_POSES = 8 (number of measurement poses) #ENDVAR L CYCLE [NAME = "Sys Calib Fit Init.ecy" \ @P1 = V. L. KIN_TYP \ @P2 = V. L. KIN_VARIANT \ @P3 = V. L. NUMBER_OF_POSES \ ] ; Call cycle to add new measurement data L CYCLE [NAME = "Sys Calib Fit Add Record.ecy" \ @P1 = 102.545449 \ (X coordinate of centre point) @P2 = 258.949268 \ (Y coordinate of centre point) @P3 = 125.6186118 \ (Z coordinate of centre point) @P4 = 20 \ (associated A coordinate) @P5 = 0 \ (associated B coordinate) @P6 = 0 \ (associated C coordinate) ] ; ... Executing input for all poses ; Call fitting cycle #VAR V. P. MAX_PRECISION = 0.06 (precision) V. P. LIST_FORMAT = 1 (list format for result) #ENDVAR ; Call fitting cycle L CYCLE [NAME = "Sys Calib Fit.ecy" \ @P1 = V. P. LIST_FORMAT \ @P2 = V. P. MAX_PRECISION \ ] ; Call to end cycle L CYCLE [NAME = "Sys Calib Fit Finalize.ecy"] TF5245 | Twin CAT 3 CNC Version: 1.319 23 Kinematic Optimization
## Page 24

Preparing the calculation cycle 4.6 Kinematic-specific changes The kinematic offsets applied here are described in detail in the documentation for Kinematic Transformation KITRA for each of the kinematics. 4.6.1 KIN_TYP_80 Direction of rotation of A axis Kinematic 80 is used to invert the direction of rotation of the A axis. For these cases, set the kinematic parameter 14 (HD15) to 1. On the other hand, the default value 0 characterises a mathematically positive rotating A axis. Adapting the rotation direction of the A axis ; 0 = positive direction ; 1 = negative direction ; NOTE: in some cases, the previous value of ; V. G. KIN[80]. PARAM[14] may have to be restored later. V. G. KIN[80]. PARAM[14] = 1 This may overwrite a globally known V. G. variable. If required, the operator will have to look after restoring the original value later. Specifying the vertical offset value: The test set-up described may not be capable of detecting a specific geometry value of the kinematic. This refers to the vertical offset value HD12 + HD6 + HD9 which must be determined by a measurement which is carried out beforehand. This value is then entered in the main calculation program as follows: Entering the vertical offset value ; The value of HD12 + HD6 + HD9, in mm V. L. HD12_HD6_HD9 = -3.135 4.6.2 KIN_TYP_90 Set the axis programming mode (kinematik[90].param[13]) internally to the default setting of the kinematic variant selected. 24 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 25

Executing the calculation cycle 5 Executing the calculation cycle 5.1 Starting the main program After completing these preparations, execute the modified main program: • Sys Calib Manual009V0.nc • Sys Calib Manual057V0.nc • Sys Calib Manual058V0.nc • Sys Calib Manual059V0.nc • Sys Calib Manual060V0.nc • Sys Calib Manual080V0.nc • Sys Calib Manual090V0.nc • Sys Calib Manual090V2.nc Since this involves extensive calculations, the runtime may take several minutes. The runtime is dependent on: • the number of poses measured • the cycle time of the SDA task and • system performance The program generates no path motions. After the calculation ends, the results must be checked for plausibility and the spindle flange offset in the tool holder must be determined (normally HD1). TF5245 | Twin CAT 3 CNC Version: 1.319 25 Kinematic Optimization
## Page 26

Checking the calibration 6 Checking the calibration Both the automatic measurement and the calculation output a large amount of information that can be used to check the measurement and calculation results. 6.1 Plausibility check of the output After a successful run, the program outputs a number of information items: • estimates for single poses both with automatic and manual measurements • In addition, the single positions measured for an automatic measurement are output. For example, the block with the calculation results for the 1st pose is: Output of the calculation results of a sphere % Centre of sphere [X, Y, Z] = [102.5305658, 244.3467991, 189.8131021] % Radius R = 14.94823794 % Variance = 9.56062833e-006 % Residual[0] = 0.00154694034 % Residual[1] = -0.004483877805 % Residual[2] = 0.003641747138 % Residual[3] = -0.001544225933 % Residual[4] = -0.002650543572 % Residual[5] = 0.003491883191 "Centre of sphere" is the centre of the calibration sphere in XYZ coordinates for the pose specified. Radius “R” specifies the radius of the calibration sphere (more exactly: the sum of the radii of the calibration sphere and the dial gauge tip or switching point of the probe tip). Criterion (A) – radii of the calibration spheres The calibration sphere radii measured across all poses should be constant except for the measurement precision. If this is not the case, the calibration sphere was not correctly measured in one or several poses. Repeat the measurement for these poses. Criterion (B) – Residuals The residuals (Residual[i]) should be within the range of a few 1/100mm. They indicate the amount by which each of the measurement points deviate from the calibration sphere surface. If a measurement point deviates strongly from the sphere surface, reject the affected pose and repeat this measurement. Calculation output The 2nd part of the output contains the calculated **Correction values for kinematics P-CHAN-00438 and several additional items of information. This block looks like this, for example for kinematic 80: Output of calculated kinematic parameters #timestamp 12.12.2016 12:58:17:000 #kinematic id 80 #kinematic id variant 0 #number of measurement records 8 # #record 0 = [102.5305658,244.3467991,189.8131021, 0,0,0] #record 1 = [102.545449, 258.949268, 125.6186118, 20,0,0] #record 2 = [29.18053549,233.8711714,175.957552, -20,-90.0] #record 3 = [176.2562104,233.7423534,176.3588772, -20.90,0] #record 4 = [29.20839651,244.3560828,116.1031577, 0,-90.0] #record 5 = [176.2877121,244.3573191,116.5414503, 0.90,0] #record 6 = [176.2795252,233.8784364,56.68825135, 20.90,0] #record 7 = [29.21147408,233.7284348,56.33260263, 20,-90.0] # #solution precision 0.04409219769 #probe position PCS, [mm] [-0.2058572907, 0, 73.53215927] 26 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 27

Checking the calibration # kinematik[80].corr[1] E39A4FA5FA49658AFD79AE9E kinematik[80].corr[2] E39A4FA5FA49658AFD79AE9E kinematik[80].corr[3] E39A4FA5FA49658AFD79AE9E kinematik[80].corr[4] E39A4FA5FA49658AFD79AE9E kinematik[80].corr[5] 6E9B4FA534A809BEB3FDC8FB kinematik[80].corr[6] E39A4FA5FA49658AFD79AE9E kinematik[80].corr[7] E9954FA50E96594B756EB4F7A79567C2084AC996 kinematik[80].corr[8] E39A4FA5FA49658AFD79AE9E kinematik[80].corr[9] A18A4FA512510AB45F3259BCA79567C2084AC996 kinematik[80].corr[10] 60914FA56EE1CFF3A6AA2953 kinematik[80].corr[11] AD924FA53196E9D01A53CB3D Besides the time stamp, the kinematic ID and the number of poses, the solution precision is also output, among other items. This value describes in mm the largest deviation between model and measurement values. The deviation is produced by measurement errors or by errors not mapped in the model, e.g. axis misalignments, etc. The correction parameters are output in encrypted form (P-CHAN-00438)and automatically decryp- ted later when they are read. Criterion (C) – solution precision The solution precision should not exceed a certain limit. A limit for this value can be specified in the main program. If this limit is exceeded, an error is output and the measurement equipment, measurement method etc. must be checked. • Measurement equipment: The measurement equipment must measure the shape of the calibration sphere correctly from all directions. The measurement precision obtained must be as small as possible. • Measurement method: The measurement must be taken as perpendicularly to the surface of the calibration sphere as possible to avoid distortion of the contour measured. To ensure that this occurs with the automatic measurement, kinematic parameters which roughly describe the kinematic should be entered previously. • Machine errors: Rotary axis zero positions, the rectangularity of linear axes, the positioning and repeatable precision of all axes and position-dependent errors of the rotary axes Criterion (D) – kinematic parameters calculated If the check is successful, the above mentioned block can be copied to the channel parameter list. After the latest import of the channel parameters, the compensation values are available to the kinematic. NOTICE Then a careful, slow test run should be executed with the kinematic enabled to check whether the compensation values have the correct effectiveness. This also checks that the transfer of compensation values is error-free and that no unintended collisions occur. TF5245 | Twin CAT 3 CNC Version: 1.319 27 Kinematic Optimization
## Page 28

Checking the calibration 6.2 Determining missing offsets The measurement method is not capable of determining the offset of the spindle flange in the tool direction (normally HD1). It can only determine HD1 + tool length of the dial gauge or probe for a head kinematic. However, even this is not possible with a table kinematic. For this reason, HD1 must be determined by an alternative method and entered in the channel parameter list. Due to the lack of kinematic separation, not all offsets can be determined for many kinematics. 6.2.1 KIN_TYP_80 Y offsets are freely movable and are defined by the position of the calibration sphere or probe on the table. All Y offsets are combined in parameter HD8 in the calculation results. 6.3 Machining test part The final check of the calibration can be carried out by machining a suitable test part, for example. • the geometry of the test part should be as simple as possible • the rotary axes should be used to machine the test part • the rotary axes should be used independently of each other as far as possible In the test part, contour parts which were manufactured in various poses with an active transformation should be concatenated without interruption. The figure shows an example of a geometry to check the result of calibration for a head kinematic – CA or CB. 2 pockets are milled: • one in X direction • one in Y direction Each pocket is machined half under C0 and the other half under C180. The offsets between the C0 and C180 milling operations should disappear if the calculation of the offsets is successful (blue). Fig. 3: Example of a test part – A or B in zero position The offsets must disappear between the pockets in X and Y directions. The pockets without calibration are grey and with calibration they are blue. 28 Version: 1.319 TF5245 | Twin CAT 3 CNC Kinematic Optimization
## Page 29

Support and Service 7 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF5245 | Twin CAT 3 CNC Version: 1.319 29 Kinematic Optimization
## Page 31

More Information: www.beckhoff.com/TF5245 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
