---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.4.5"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_Drive_EN.pdf"
release_date: "2025-10-07"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc2_Drive 2025-10-07 | Version: 1.4.5
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Drive reference ST_Drive Ref.................................................................................................................. 11 4 Function blocks....................................................................................................................................... 13 4.1 General So E.................................................................................................................................... 13 4.1.1 FB_So EReset_By Drive Ref.............................................................................................. 13 4.1.2 FB_So EWrite Password_By Drive Ref............................................................................... 14 4.1.3 FB_So EExecute Command_By Drive Ref.......................................................................... 15 4.1.4 Function blocks for commands........................................................................................ 16 4.1.5 Function blocks for diagnostics........................................................................................ 19 4.1.6 Function blocks for determining current values................................................................ 25 4.2 AX5000 So E.................................................................................................................................... 30 4.2.1 Conversion functions........................................................................................................ 30 4.2.2 FB_So EAX5000Read Act Main Voltage_By Drive Ref......................................................... 31 4.2.3 FB_So EAX5000Set Motor Ctrl Word_By Drive Ref.............................................................. 32 4.2.4 FB_So EAX5000Firmware Update_By Drive Ref................................................................ 34 4.2.5 FB_So EAX5000Park Axis_By Drive Ref............................................................................. 37 4.3 Indra Drive Cs.................................................................................................................................. 38 4.3.1 Conversion functions........................................................................................................ 38 4.4 F_Get Version Tc Drive...................................................................................................................... 39 4.5 Simple Plc Motion............................................................................................................................. 39 4.5.1 FB_Co EDrive Enable........................................................................................................ 40 4.5.2 FB_Co EDrive Move Velocity.............................................................................................. 40 4.5.3 FB_So EDrive Enable........................................................................................................ 42 4.5.4 FB_So EDrive Move Velocity.............................................................................................. 43 5 Data types................................................................................................................................................ 45 5.1 General So E.................................................................................................................................... 45 5.1.1 ST_So E_String................................................................................................................ 45 5.1.2 ST_So E_String Ex............................................................................................................ 45 5.1.3 List types.......................................................................................................................... 45 5.2 AX5000 So E.................................................................................................................................... 46 5.2.1 E_Fw Update State............................................................................................................ 46 5.2.2 ST_AX5000_C1D............................................................................................................. 48 5.2.3 ST_AX5000Drive Status................................................................................................... 48 5.2.4 E_AX5000_Drive Op Mode................................................................................................ 48 5.3 Indra Drive Cs.................................................................................................................................. 48 5.3.1 E_Indra Drive Cs_Drive Op Mode........................................................................................ 48 5.3.2 ST_Indra Drive Cs_C1D.................................................................................................... 49 5.3.3 ST_Indra Drive Cs Drive Status........................................................................................... 50 5.4 SERCOS......................................................................................................................................... 50 TE1000 Version: 1.4.5 3
## Page 4

Table of contents 5.4.1 E_So E_Attrib Len.............................................................................................................. 50 5.4.2 E_So E_Cmd Control......................................................................................................... 50 5.4.3 E_So E_Cmd State............................................................................................................ 51 5.4.4 E_So E_Type.................................................................................................................... 51 5.5 Simple Plc Motion............................................................................................................................. 52 5.5.1 E_Co EDrive Enable State.................................................................................................. 52 5.5.2 E_Drive Move Velocity Error............................................................................................... 52 5.5.3 ST_Co EDrive Io Interface.................................................................................................. 52 5.5.4 ST_Drive Move Velocity Options........................................................................................ 52 5.5.5 ST_So EDrive Io Interface.................................................................................................. 52 6 Support and Service............................................................................................................................... 54 4 Version: 1.4.5 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1000 Version: 1.4.5 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.4.5 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.4.5 7
## Page 8

Overview 2 Overview The Tc2_Drive library should no longer be used in newer projects. Please use the Tc2_MC2_Drive library instead (see documentation Twin CAT 3 PLC Lib Tc2_MC2_Drive). The Tc2_Drive library includes functions and function blocks for So E drives that access the drive via a drive reference. Drive libraries The three drive libraries Tc2_Drive, Tc2_Nc Drive and Tc2_MC2_Drive were developed for different functional purposes but are almost identical in their functionality. The function blocks of the libraries Tc2_Nc Drive and Tc_MC2_Drive form wrapper function blocks around the function blocks of the Tc2_Drive library. Drive library Use Access to the drive Remarks Tc2_Drive Use the Tc2_Drive The drive is accessed via a drive If you want to access library if you use reference. Within the library, the parameters in the drive for which See documentation the drive entirely ST_Drive Ref structure is used no special function block has Twin CAT 3 PLC Lib: from the PLC (i.e. for this with the Net ID as a been implemented, use the Tc2_Drive without NC). string. For linking purposes, a function blocks structure called ST_Plc Drive Ref FB_So ERead_By Drive Ref and is also provided with the Net ID FB_So EWrite_By Drive Ref. as a byte array. These function blocks are implemented in the PLC Lib (See Drive reference Tc2_Ether CAT in the ST_Drive Ref) So E Interface folder. Tc2_Nc Drive Use the The drive is accessed via the If you want to access Tc2_Nc Drive library NC axis structure parameters in the drive for which See documentation if you are using the (NC_TO_PLC). The function no special function block has Twin CAT 3 PLC Lib: drive via the NC blocks of the Tc2_Nc Drive been implemented, use the Tc2_Nc Drive with the Tc2_Nc library independently determine function blocks FB_So ERead libraries. the access data to the drive and FB_So EWrite. (Net ID, address and channel number) via the NC axis ID from the NC axis structure. Tc2_MC2_Drive Use the The drive is accessed via the If you want to access Tc2_MC2_Drive MC2 axis reference parameters in the drive for which See: Twin CAT 3 library if you are (AXIS_REF). The function no special function block has PLC Lib using the drive via blocks of the Tc2_MC2_Drive been implemented, use the Tc2_MC2_Drive the NC with the library independently determine function blocks FB_So ERead documentation Tc2_MC2 library. the access data to the drive and FB_So EWrite. (Net ID, address and channel number) via the NC axis ID from the MC2 axis reference. Functions Name Description F_Get Version Tc Drive [} 39] Reads version information from the PLC library. The function will be replaced by the global structure st Lib Version_Tc2_Drive. F_Conv Word To STAX5000C1D [} 30] Converts the C1D word (S-0-0011) of the AX5000 to a structure ST_AX5000_C1D [} 48] F_Conv Word To STAX5000Drive Status [} 30] Converts the Drive status word (S-0-0135) of the AX5000 into the structure ST_AX5000Drive Status [} 48] 8 Version: 1.4.5 TE1000
## Page 9

Overview Name Description F_Conv Word To STIndra Drive Cs C1D [} 38] Converts the C1D word (S-0-0011) of the Indra Drive Cs into the structure ST_Indra Drive Cs_C1D [} 49] F_Conv Word To STIndra Drive Cs Drive Status [} 38] Converts the drive status word (S-0-0135) of the Indra Drive Cs into a structure ST_Indra Drive Cs Drive Status [} 50] Function blocks Name Description FB_So EReset_By Drive Ref [} 13] Resets the drive (S-0-0099). FB_So EWrite Password_By Drive Ref [} 14] Sets the drive password (S-0-0267). FB_So EExecute Command_By Drive Ref [} 15] Executes a command. FB_So ERead Diag Message_By Drive Ref [} 19] Reads the diagnostic message (S-0-0095). FB_So ERead Diag Number_By Drive Ref [} 21] Reads the diagnostic number (S-0-0390). FB_So ERead Diag Number List_By Drive Ref [} 22] Reads the diagnostic number list (up to 30 entries) (S-0-0375). FB_So ERead Class XDiag_By Drive Ref [} 23] Reads Class 1 diagnosis (S-0-0011) ... Class 3 diagnosis (S-0-0013). FB_So EWrite Command Control_By Drive Ref [} 16] Sets the Command Control. FB_So ERead Command State_By Drive Ref [} 18] Checks the command status. FB_So ERead_By Drive Ref Reads a parameter (see PLC Lib Tc2_Ether CAT). FB_So EWrite_By Drive Ref Writes a parameter (see PLC Lib Tc2_Ether CAT). FB_So ERead Amplifier Temperature_By Drive Ref [} 25] Reads the drive temperature (S-0-0384). FB_So ERead Motor Temperature_By Drive Ref [} 26] Reads the motor temperature (S-0-0383). FB_So ERead Dc Bus Current_By Drive Ref [} 29] Reads the DC bus current (S-0-0381). FB_So ERead Dc Bus Voltage_By Drive Ref [} 27] Reads the DC bus voltage (S-0-0380). FB_So EAX5000Read Act Main Voltage_By Drive Ref Reads the mains voltage (P-0-0200). [} 31] FB_So EAX5000Set Motor Ctrl Word_By Drive Ref [} 32] Sets the Motor Control Word (P-0-0096). FB_So EAX5000Firmware Update_By Drive Ref [} 34] Executes an automatic firmware update for the AX5000. FB_Co EDrive Enable [} 40] Enables a Co E drive. FB_Co EDrive Move Velocity [} 40] Generates a simple three-phase velocity profile that can be used to supply a Co E drive directly. FB_So EDrive Enable [} 42] Enables a So E drive. FB_So EDrive Move Velocity [} 43] Generates a simple three-phase velocity profile that can be used to supply a So E drive directly. Requirements Component Version Twin CAT on the development computer 3.1 Build 4016 or higher Twin CAT on the Beckhoff RT Linux®- computer 3.1 Build 4026 or higher TE1000 Version: 1.4.5 9
## Page 10

Overview Component Version Twin CAT on the Twin CAT/BSD-computer 3.1 Build 4026 or higher 10 Version: 1.4.5 TE1000
## Page 11

Drive reference ST_Drive Ref 3 Drive reference ST_Drive Ref The drive is accessed via a drive reference. Within the library, the ST_Drive Ref structure from the Tc2_Ether CAT library is used for this with the Net ID as a string. Since the Net ID usually exists as a byte array at I/O level, a structure ST_Plc Drive Ref, also from the Tc2_Ether CAT library, with the Net ID as a byte array is additionally provided. The two structures must be transferred into each other. Structure ST_Plc Drive Ref TYPE ST_Plc Drive Ref : STRUCT a Net Id : T_Ams Net Id Arr; (* Ams Net Id (array[0..5] of bytes) of the Ether CAT master device.*) n Slave Addr : UINT; (* Address of the slave device.*) n Drive No : BYTE; (* Drive number*) n Drive Type : BYTE; (* Drive type*) END_STRUCT END_TYPE Structure ST_Drive Ref TYPE ST_Drive Ref : STRUCT s Net Id : T_Ams Net Id; (* Ams Net Id (string(23)) of the Ether CAT master device.*) n Slave Addr : UINT; (* Address of the slave device.*) n Drive No : BYTE; (* Drive number*) n Drive Type : BYTE; (* Drive type*) END_STRUCT END_TYPE Mapping the drive reference to the PLC The drive reference can be mapped to the PLC in the System Manager. To do this, allocate an instance of the structure ST_Plc Drive Ref as AT %I*. Subsequently, link a Net ID to net Id, n Slave Addr to port and n Drive No to Chn0 (A) or Chn1 (B). In the case of multiple-channel drives both channels refer to the same net Id and port number, since it is an Ether CAT slave. TE1000 Version: 1.4.5 11
## Page 12

Drive reference ST_Drive Ref Transfer of ST_Plc Drive Ref and ST_Drive Ref The function blocks in the library Tc2_Drive use an instance of the structure ST_Drive Ref. Unlike the structure ST_Plc Drive Ref, Net ID is expected to be T_Ams Net Id (i.e. STRING(23)). To convert the byte array, use the F_Create Ams Net Id() function of the PLC Lib Tc2_System. st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; 12 Version: 1.4.5 TE1000
## Page 13

Function blocks 4 Function blocks 4.1 General So E 4.1.1 FB_So EReset_By Drive Ref FB_So EReset_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id UINT i Sercos Err Id The drive (S-0-0099) can be reset with the function block FB_So EReset_By Drive Ref. In the case of multiple- channel devices if necessary, both channels will have to perform a reset. The timeout time must be 10 s, as the reset can take up to 10 s depending on the error. An NC reset will not be performed. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := T#10s; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time (10 s) allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. Sample fb So EReset : FB_So EReset_By Drive Ref; b So EReset : BOOL; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN TE1000 Version: 1.4.5 13
## Page 14

Function blocks st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b So EReset AND NOT b Init THEN fb So EReset( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT ); IF NOT fb So EReset.b Busy THEN fb So EReset(st Drive Ref := st Drive Ref, b Execute := FALSE); b So EReset := FALSE; END_IF END_IF 4.1.2 FB_So EWrite Password_By Drive Ref FB_So EWrite Password_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id s Password ST_So E_String UINT i Sercos Err Id Using the FB_So EWrite Password_By Drive Ref function block the drive password (S-0-0267) can be set. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; s Password : ST_So E_String; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: Drive reference ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time (10 s) allowed for the execution of the function block. s Passwor ST_So E_String Password as a Sercos string d Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. 14 Version: 1.4.5 TE1000
## Page 15

Function blocks Name Type Description b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. Sample fb Write Password : FB_So EWrite Password_By Drive Ref; b Write Password : BOOL; s Password : ST_So E_String; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Write Password AND NOT b Init THEN fb Write Password( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, s Password := s Password ); IF NOT fb Write Password.b Busy THEN fb Write Password(st Drive Ref := st Drive Ref, b Execute := FALSE); b Write Password := FALSE; END_IF END_IF 4.1.3 FB_So EExecute Command_By Drive Ref FB_So EExecute Command_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy n Idn WORD BOOL b Error b Execute BOOL UINT i Ads Err Id t Timeout TIME UINT i Sercos Err Id With the FB_So EExecute Command_By Drive Ref function block a command can be executed. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; n Idn : WORD; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) n Idn WORD Parameter number to which FB_So EExecute Command_By Drive Ref refers, e.g. "P_0_IDN + 160" for P-0-0160 TE1000 Version: 1.4.5 15
## Page 16

Function blocks Name Type Description b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time (10 s) allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. Sample fb Execute Command : FB_So EExecute Command_By Drive Ref; b Execute Command : BOOL; n Idn : WORD; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Execute Command AND NOT b Init THEN n Idn := P_0_IDN + 160; fb Execute Command( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, n Idn := n Idn ); IF NOT fb Execute Command.b Busy THEN fb Execute Command(st Drive Ref := st Drive Ref, b Execute := FALSE); b Execute Command := FALSE; END_IF END_IF 4.1.4 Function blocks for commands 4.1.4.1 FB_So EWrite Command Control_By Drive Ref FB_So EWrite Command Control_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy n Idn WORD BOOL b Error e Cmd Control E_So E_Cmd Control UINT i Ads Err Id b Execute BOOL UINT i Sercos Err Id t Timeout TIME 16 Version: 1.4.5 TE1000
## Page 17

Function blocks With the FB_So EWrite Command Control_By Drive Ref function block a command can either be prepared, started or aborted. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; n Idn : WORD; e Cmd Control: E_So E_Cmd Control; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) n Idn WORD Parameter number to which FB_So ERead Command State_By Drive Ref refers, e.g. "P_0_IDN + 23" for P-0-0023. e Cmd Con E_So E_Cmd Control Indicates, if a command should be prepared trol (e So E_Cmd Control_Set := 1), executed (e So E_Cmd Control_Set And Enable := 3) or aborted (e So E_Cmd Control_Cancel := 0). b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time (10 s) allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. Sample fb Write Command Control : FB_So EWrite Command Control_By Drive Ref; b Write Command Control : BOOL; n Idn : WORD; e Cmd Control : E_So E_Cmd Control; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; TE1000 Version: 1.4.5 17
## Page 18

Function blocks END_IF END_IF IF b Write Command Control AND NOT b Init THEN n Idn := P_0_IDN + 160; fb Write Command Control( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, n Idn := n Idn, e Cmd Control := e Cmd Control ); IF NOT fb Write Command Control.b Busy THEN fb Write Command Control(st Drive Ref := st Drive Ref, b Execute := FALSE); b Write Command Control := FALSE; END_IF END_IF 4.1.4.2 FB_So ERead Command State_By Drive Ref FB_So ERead Command State_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy n Idn WORD BOOL b Error b Execute BOOL E_So E_Cmd State e Cmd State t Timeout TIME UINT i Ads Err Id UINT i Sercos Err Id With the FB_So ERead Command State_By Drive Ref function block the execution of the command can be checked. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; Idn : WORD; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) n Idn WORD Parameter number to which FB_So ERead Command State_By Drive Ref refers, e.g. "P_0_IDN + 160" for P-0-0160 b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time (10 s) allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; e Cmd State : E_So E_Cmd State; i Ads Err Id : UINT; i Sercos Err Id : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. 18 Version: 1.4.5 TE1000
## Page 19

Function blocks Name Type Description b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. e Cmd Stat e So E_Cmd State Returns the command status [} 51]. e i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. Sample fb Read Command State : FB_So ERead Command State_By Drive Ref; b Read Command State : BOOL; n Idn : WORD; e Cmd State : E_So E_Cmd State; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Read Command State AND NOT b Init THEN n Idn := P_0_IDN + 160; fb Read Command State( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, n Idn := n Idn, e Cmd State => e Cmd State ); IF NOT fb Read Command State.b Busy THEN fb Read Command State(st Drive Ref := st Drive Ref, b Execute := FALSE); b Read Command State := FALSE; END_IF END_IF 4.1.5 Function blocks for diagnostics 4.1.5.1 FB_So ERead Diag Message_By Drive Ref FB_So ERead Diag Message_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id UINT i Sercos Err Id DWORD dw Attribute ST_So E_String s Diag Message With the FB_So ERead Diag Message_By Drive Ref function block the diagnosis message can be read as a Sercos String (S-0-0095). Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TE1000 Version: 1.4.5 19
## Page 20

Function blocks Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; s Diag Message : ST_So E_String; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. dw Attribu DWORD Returns the attributes of the Sercos parameter. te s Diag Mes ST_So E_String Returns the diagnosis message. sage Sample fb Diag Message : FB_So ERead Diag Message_By Drive Ref; b Diag Message : BOOL; s Diag Message : ST_So E_String; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Diag Message AND NOT b Init THEN fb Diag Message( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, s Diag Message => s Diag Message ); IF NOT fb Diag Message.b Busy THEN fb Diag Message( st Drive Ref:= st Drive Ref, b Execute := FALSE ); b Diag Message := FALSE; END_IF END_IF 20 Version: 1.4.5 TE1000
## Page 21

Function blocks 4.1.5.2 FB_So ERead Diag Number_By Drive Ref FB_So ERead Diag Number_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id UINT i Sercos Err Id DWORD dw Attribute UDINT i Diag Number With the FB_So ERead Diag Number_By Drive Ref function block the current diagnostic number can be read as UDINT (S-0-0390). Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; i Diag Number : UDINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. dw Attribu DWORD Returns the attributes of the Sercos parameter. te i Diag Num UDINT Returns the current diagnostic number. ber Sample fb Diag Number : FB_So ERead Diag Number_By Drive Ref; b Diag Number : BOOL; i Diag Number : UDINT; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; TE1000 Version: 1.4.5 21
## Page 22

Function blocks IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Diag Number AND NOT b Init THEN fb Diag Number( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, i Diag Number => i Diag Number ); IF NOT fb Diag Number.b Busy THEN fb Diag Number(st Drive Ref := st Drive Ref, b Execute := FALSE); b Diag Number := FALSE; END_IF END_IF 4.1.5.3 FB_So ERead Diag Number List_By Drive Ref FB_So ERead Diag Number List_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id pi Diag Number Pointer To ST_So E_Diag Num List UINT i Sercos Err Id i Size UDINT DWORD dw Attribute With the FB_So ERead Diag Number List_By Drive Ref function block a history of the diagnosis numbers can be read as list (S-0-0375). Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; pi Diag Number : POINTER TO ST_So E_Diag Num List; i Size : UDINT; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. pi Diag Nu POINTER TO Pointer to the list of the last max. 30 error numbers. The list mber ST_So E_Diag Num List consists of the current and maximum number of bytes in the list as well as the 30 list items. i Size UDINT Size of the list in bytes (as Sizeof()) Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; END_VAR 22 Version: 1.4.5 TE1000
## Page 23

Function blocks Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. dw Attribu DWORD Returns the attributes of the Sercos parameter. te Sample fb Diag Number List : FB_So ERead Diag Number List_By Drive Ref; b Diag Number List : BOOL; st Diag Number List : ST_So E_Diag Num List; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Diag Number List AND NOT b Init THEN fb Diag Number List( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, pi Diag Number:= ADR(st Diag Number List), i Size := SIZEOF(st Diag Number List) ); IF NOT fb Diag Number List.b Busy THEN fb Diag Number List(st Drive Ref := st Drive Ref, b Execute := FALSE); b Diag Number List := FALSE; END_IF END_IF 4.1.5.4 FB_So ERead Class XDiag_By Drive Ref FB_So ERead Class XDiag_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error i Diag Class USINT UINT i Ads Err Id t Timeout TIME UINT i Sercos Err Id DWORD dw Attribute WORD w Class XDiag With the FB_So ERead Class XDiag_By Drive Ref function block the current class 1 diagnosis (S-0-0011) ... class 3 diagnosis (S-0-0013) can be read as WORD. For the evaluation of the class 1 diagnosis as structure ST_AX5000_C1D [} 48] there is a conversion function F_Conv Word To STAX5000C1D [} 30]. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; i Diag Class : USINT:= 1; (* 1: C1D (S-0-0011) is default, 2: C2D (S-0-0012), 3: C3D (S-0-0013) *) t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TE1000 Version: 1.4.5 23
## Page 24

Function blocks Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. i Diag Clas USINT Specifies which diagnosis should be read. The diagnostics s parameters may vary from vendor to vendor. All diagnostics parameters (C1D ... C3D) or all bits are not always implemented in them. 1: Error: Class 1 Diag (S-0-0011) 2: Warnings: Class 2 Diag (S-0-0012) 3: Information: Class 3 Diag (S-0-0013) t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; w Class XDiag : WORD; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. dw Attribu DWORD Returns the attributes of the Sercos parameter. te w Class XD WORD Returns the current Class X diagnosis. iag Sample fb Class XDiag : FB_So ERead Class XDiag_By Drive Ref; b Class XDiag : BOOL; i Diag Class : USINT := 1; w Class1Diag : WORD; st AX5000C1D : ST_AX5000_C1D; w Class2Diag : WORD; b Init : BOOL := TRUE; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Class XDiag AND NOT b Init THEN fb Class XDiag( 24 Version: 1.4.5 TE1000
## Page 25

Function blocks st Drive Ref := st Drive Ref, b Execute := TRUE, i Diag Class := i Diag Class, t Timeout := DEFAULT_ADS_TIMEOUT ); IF NOT fb Class XDiag.b Busy THEN fb Class XDiag(st Drive Ref := st Drive Ref, b Execute := FALSE); b Class XDiag := FALSE; CASE fb Class XDiag.i Diag Class OF 1: w Class1Diag := fb Class XDiag.w Class XDiag; st AX5000C1D := F_Conv Word To STAX5000C1D(w Class1Diag); 2: w Class2Diag := fb Class XDiag.w Class XDiag; END_CASE END_IF END_IF 4.1.6 Function blocks for determining current values 4.1.6.1 FB_So ERead Amplifier Temperature_By Drive Ref FB_So ERead Amplifier Temperature_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id UINT i Sercos Err Id DWORD dw Attribute REAL f Amplifier Temperature With the FB_So ERead Amplifier Temperature_By Drive Ref function block the temperature of the drive (S-0-0384) can be read. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; f Amplifier Temperature : REAL; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. TE1000 Version: 1.4.5 25
## Page 26

Function blocks Name Type Description b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. dw Attribu DWORD Returns the attributes of the Sercos parameter. te f Amplifier REAL Returns the drive temperature (e.g. 26.2 corresponds to 26.2 °C). Temperat ure 4.1.6.2 FB_So ERead Motor Temperature_By Drive Ref FB_So ERead Motor Temperature_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id UINT i Sercos Err Id DWORD dw Attribute REAL f Motor Temperature With the function block FB_So ERead Motor Temperature_By Drive Ref the temperature of the motor (S-0-0383) can be read. If the motor does not contain a temperature sensor, this is 0.0, i.e. 0.0 °C. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; f Motor Temperature : REAL; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. 26 Version: 1.4.5 TE1000
## Page 27

Function blocks Name Type Description i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. dw Attribu DWORD Returns the attributes of the Sercos parameter. te f Motor Te REAL Returns the motor temperature (e.g. 30.5 corresponds to 30.5 °C). mperature If the motor does not contain a temperature sensor, this is 0.0, i.e. 0.0 °C. Sample fb Read Motor Temp : FB_So ERead Motor Temperature_By Drive Ref; b Read Motor Temp : BOOL; f Motor Temperature : REAL; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Read Motor Temp AND NOT b Init THEN fb Read Motor Temp( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, f Motor Temperature=>f Motor Temperature ); IF NOT fb Read Motor Temp.b Busy THEN fb Read Motor Temp(st Drive Ref := st Drive Ref, b Execute := FALSE); b Read Motor Temp := FALSE; END_IF END_IF 4.1.6.3 FB_So ERead Dc Bus Voltage_By Drive Ref FB_So ERead Dc Bus Voltage_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id UINT i Sercos Err Id DWORD dw Attribute REAL f Dc Bus Voltage With the FB_So ERead Dc Bus Voltage_By Drive Ref function block the DC-Bus voltage of the drive (S-0-0380) can be read. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TE1000 Version: 1.4.5 27
## Page 28

Function blocks Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; f Dc Bus Voltage : REAL; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. dw Attribu DWORD Returns the attributes of the Sercos parameter. te f Dc Bus Vo REAL Supplies the DC bus voltage of the drive. ltage Sample VAR b Init : BOOL; fb Read Dc Bus Voltage : FB_So ERead Dc Bus Voltage_By Drive Ref; b Read Dc Bus Voltage : BOOL; f Dc Bus Voltage : REAL; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; END_VAR IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Read Dc Bus Voltage AND NOT b Init THEN fb Read Dc Bus Voltage(st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, f Dc Bus Voltage => f Dc Bus Voltage ); IF NOT fb Read Dc Bus Voltage.b Busy THEN fb Read Dc Bus Voltage(st Drive Ref := st Drive Ref, b Execute := FALSE); b Read Dc Bus Voltage := FALSE; END_IF END_IF 28 Version: 1.4.5 TE1000
## Page 29

Function blocks 4.1.6.4 FB_So ERead Dc Bus Current_By Drive Ref FB_So ERead Dc Bus Current_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id UINT i Sercos Err Id DWORD dw Attribute REAL f Dc Bus Current With the FB_So EAX5000Read Dc Bus Current_By Drive Ref function block the DC-Bus current (S-0-0381) can be read. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; f Dc Bus Current: REAL; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. dw Attribu DWORD Returns the attributes of the Sercos parameter. te f Dc Bus Cu REAL Returns the DC bus current (e.g. 2,040 equals 2,040 A). rrent Sample fb Read Dc Bus Current : FB_So ERead Dc Bus Current_By Drive Ref; b Read Dc Bus Current : BOOL; f Dc Bus Current : REAL; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; TE1000 Version: 1.4.5 29
## Page 30

Function blocks IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Read Dc Bus Current AND NOT b Init THEN fb Read Dc Bus Current( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, f Dc Bus Current=>f Dc Bus Current ); IF NOT fb Read Dc Bus Current.b Busy THEN fb Read Dc Bus Current(st Drive Ref := st Drive Ref, b Execute := FALSE); b Read Dc Bus Current := FALSE; END_IF END_IF 4.2 AX5000 So E 4.2.1 Conversion functions 4.2.1.1 F_Conv Word To STAX5000C1D With this function the Class 1 diagnosis FB_So ERead Class XDiag_By Drive Ref [} 23] (S-0-0011) can be changed to an ST_AX5000_C1D [} 48] structure. Inputs VAR_INPUT w Class1Diag : WORD; END_VAR Name Type Description w Class1D WORD Class 1 diagnosis Word from S-0-0011 (see iag FB_So ERead Class XDiag_By Drive Ref [} 23]) Return value FUNCTION F_Conv Word To STAX5000C1D : ST_AX5000_C1D Name Type Description F_Conv Word To STAX5000C1D ST_AX5000_C1D [} 48] Return value of the function. Class 1 diagnosis as structure. 4.2.1.2 F_Conv Word To STAX5000Drive Status With this function the Drive status word (S-0-0135) can be changed to a structure ST_AX5000Drive Status [} 48]. 30 Version: 1.4.5 TE1000
## Page 31

Function blocks Inputs VAR_INPUT w Drive Status : WORD; END_VAR Name Type Description w Drive Sta WORD Drive status word from S-0-0135 (can be read with tus FB_So E_Read_By Drive Ref, can be mapped if necessary). Return value FUNCTION F_Conv Word To STAX5000Drive Status : ST_AX5000Drive Status Name Type Description F_Conv Word To STAX5000Drive S ST_AX5000Drive Status Return value of the function. Axis tatus state as structure. 4.2.2 FB_So EAX5000Read Act Main Voltage_By Drive Ref FB_So EAX5000Read Act Main Voltage_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id UINT i Sercos Err Id DWORD dw Attribute REAL f Actual Main Voltage With the FB_So EAX5000Read Act Main Voltage_By Drive Ref function block the current peak value of the mains voltage of the AX5000 (P-0-0200) can be read. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; dw Attribute : DWORD; f Actual Main Voltage : REAL; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. TE1000 Version: 1.4.5 31
## Page 32

Function blocks Name Type Description b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. dw Attribu DWORD Returns the attributes of the Sercos parameter. te f Actual Ma REAL Returns the peak value of the current mains voltage of the AX5000 in Voltage (e.g. 303.0 corresponds to 303.0 V). Sample fb Read Act Main Voltage : FB_So EAX5000Read Act Main Voltage_By Drive Ref; b Read Act Main Voltage : BOOL; f Actual Main Voltage : REAL; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND(st Drive Ref.n Slave Addr <> 0)THEN b Init := FALSE; END_IF END_IF IF b Read Act Main Voltage AND NOT b Init THEN fb Read Act Main Voltage( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, f Actual Main Voltage=>f Actual Main Voltage ); IF NOT fb Read Act Main Voltage.b Busy THEN fb Read Act Main Voltage(st Drive Ref := st Drive Ref, b Execute := FALSE); b Read Act Main Voltage := FALSE; END_IF END_IF 4.2.3 FB_So EAX5000Set Motor Ctrl Word_By Drive Ref FB_So EAX5000Set Motor Ctrl Word_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id b Force Lock BOOL UINT i Sercos Err Id b Force Unlock BOOL With the FB_So EAX5000Set Motor Ctrl Word_By Drive Ref function block the Force Lock bit (Bit 0) and the Force Unlock bit in the Motor Control Word (P-0-0096) can be set, in order to activate or release the brake. Normally the brake is automatically controlled via the Enable of the drive. With the Force Lock-Bit, the brake can be activated independently from the Enable, with the Force Unlock bit, the brake can be released independently from the Enable. In the case of simultaneously set Force Lock and Force Unlock, Force Lock (Brake activated) has the higher priority. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; 32 Version: 1.4.5 TE1000
## Page 33

Function blocks t Timeout : TIME := DEFAULT_ADS_TIMEOUT;b Force Lock : BOOL; b Force Unlock : BOOL END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. b Force Lo BOOL Activates the brake independently of the enable. ck b Force Unl BOOL Releases the brake independently of the enable. ock Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. Sample fb Set Motor Ctrl Word : FB_So EAX5000Set Motor Ctrl Word_By Drive Ref; b Set Motor Ctrl Word : BOOL; b Force Lock : BOOL; b Force Unlock : BOOL; st Plc Drive Ref AT %I* : ST_Plc Drive Ref; st Drive Ref : ST_Drive Ref; IF b Init THEN st Drive Ref.s Net Id := F_Create Ams Net Id(st Plc Drive Ref.a Net Id); st Drive Ref.n Slave Addr := st Plc Drive Ref.n Slave Addr; st Drive Ref.n Drive No := st Plc Drive Ref.n Drive No; st Drive Ref.n Drive Type := st Plc Drive Ref.n Drive Type; IF (st Drive Ref.s Net Id <> '') AND (st Drive Ref.n Slave Addr <> 0) THEN b Init := FALSE; END_IF END_IF IF b Set Motor Ctrl Word AND NOT b Init THEN fb Set Motor Ctrl Word( st Drive Ref := st Drive Ref, b Execute := TRUE, t Timeout := DEFAULT_ADS_TIMEOUT, b Force Lock := b Force Lock, b Force Unlock:= b Force Unlock ); IF NOT fb Set Motor Ctrl Word.b Busy THEN fb Set Motor Ctrl Word(st Drive Ref := st Drive Ref, b Execute := FALSE); b Set Motor Ctrl Word := FALSE; END_IF END_IF TE1000 Version: 1.4.5 33
## Page 34

Function blocks 4.2.4 FB_So EAX5000Firmware Update_By Drive Ref FB_So EAX5000Firmware Update_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error t Timeout TIME UINT i Ads Err Id s Firmware Version STRING(20) UINT i Sercos Err Id s Firmware Path T_Max String UDINT i Diag Number s Net Id IPC T_Ams Net ID E_Fw Update State e Fw Update State i Req Ec State UINT INT i Load Progress STRING(255) s Selected Firmware File With the FB_So EAX5000Firmware Update_By Drive Ref function block the Firmware of the AX5000 can be checked and automatically changed to a given version (Revision and Build) or to the current Build of the configured revision. For the update: • the configured slave type is determined, e.g. AX5103-0000-0010. • the current slave with the specified slave address is determined, e.g. AX5103-0000-0009. • the current slave firmware is determined, e.g. v1.05_b0009. • a comparison of the configuration and the found slave regarding number of channels, current, revision and firmware is made. • the name of the required firmware file is determined and a search for the file performed. • the firmware update is executed (if necessary). • the current slave with the specified slave address is determined again. • the slave is switched to the predefined Ether CAT state. A successful update ends with e Fw Update State = e Fw U_Fw Update Done. If the update is not required, this is signaled via e Fw Update State = e Fw U_No Fw Update Required. The firmware is updated via the specified channel (A = 0 or B = 1) from st Drive Ref. In the case of two- channel devices only one of the two channels can be used. The other channel signals e Fw Update State = e Fw U_Update Via Other Channel Active or e Fw Update State = e Fw U_Update Via Other Channel. During the firmware update (e Fw Update State = e Fw U_Fw Update In Progress), i Load Progress signals the progress in percent. NOTICE Faulty update due to interruptions Interruptions during the update may result in it not being executed or executed incorrectly. Afterwards, the drive amplifier may no longer be usable without the appropriate firmware. The rules during the update are: • The PLC and Twin CAT must not be stopped. • The Ether CAT connection must not be interrupted. • The AX5000 must not be switched off. Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; s Firmware Version : STRING(20); (* version string vx_yy_bnnnn, e.g. "v1.05_b0009" for v1.05 Build 0009*) s Firmware Path : T_Max String; (* drive:\path, e.g. "C: \Twin CAT\Io\Tc Drive Manager\Firmware Pool" *) 34 Version: 1.4.5 TE1000
## Page 35

Function blocks s Net Id IPC : T_Ams Net Id; i Req Ec State : UINT := EC_DEVICE_STATE_OP; END_VAR Name Type Description st Drive Re ST_Drive Ref Reference to the drive. The reference to the drive can be linked f directly to the PLC in the System Manager. To do this, an instance of the structure ST_Plc Drive Ref must be allocated and the Net ID must be converted from the byte array into a string. (Type: ST_Drive Ref [} 11]) b Execute BOOL The function block is enabled via a positive edge at this input. t Timeout TIME Maximum time allowed for the execution of the function block. s Firmwar STRING(20) Specifies the desired firmware version in the form of vx.yy_bnnnn, e Version e.g. „v1.05_b0009“ for Version v1.05 Build 0009. Release-Builds: • "v1.05_b0009" for a specific build, e.g. v1.05 Build 0009 • "v1.05_b00??" latest build of a specified version, e.g. v1.05 • "v1.??_b00??" latest build of a specified main version, e.g. v1 • " " latest build of the latest version Customer-specific Firmware-Builds: • "v1.05_b1009" for a specific build, e.g. v1.05 Build 0009 • "v1.05_b10??" latest build of a specified version, e.g. v1.05 • "v1.??_b10??" latest build of a specified main version, e.g. v1 • "v?.??_b10??" latest build of the latest version • "v1.05_b8909" for a specific build, e.g. v1.05 Build 8909 • "v1.05_b89??" latest build of a specified version, e.g. v1.05 • "v1.??_b89??" latest build of a specified main version, e.g. v1 • "v?.??_b89??" latest build of the latest version Debug-Builds: • "v1.05_b9009" for a specific build, e.g. v1.05 Build 9009 • "v1.05_b90??" latest build of a specified version, e.g. v1.05 • "v1.??_b90??" latest build of a specified main version, e.g. v1 • "v?.??_b90??" latest build of the latest version s Firmwar T_Max String Specifies the path for the firmware pool in which the firmware files e Path are located, e.g. C:\Twin CAT\Io\Tc Drive Manager\Firmware Pool. s Net Id IPC T_Ams Net Id AMS-Net ID of the controller (IPC) i Req Ec Sta UINT Desired Ether CAT state after the update, only if an update is te actually being executed. The statuses are defined in PLC Lib Tc2_Ether CAT as global constants. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Ads Err Id : UINT; i Sercos Err Id : UINT; i Diag Number : UDINT; e Fw Update State : E_Fw Update State; i Load Progress : INT; s Selected Firmware File : STRING(MAX_STRING_LENGTH); (* found firmware file, e.g. "AX5yxx_xxxx_0010 _v1_05_b0009.efw" *) END_VAR TE1000 Version: 1.4.5 35
## Page 36

Function blocks Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until a feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT In the case of a set b Error output returns the ADS error code of the last executed command. i Sercos Er UINT In the case of a set b Error output returns the Sercos error of the r Id last executed command. i Diag Num UDINT Returns the drive amplifier error of the last firmware update if the ber b Error output is set. e Fw Updat E_Fw Update State Returns the status of the firmware update (see E_Fw Update State e State [} 46]). i Load Prog INT Returns the progress of the actual firmware update as a ress percentage. s Selected STRING(MAX_STRING_LE Displays the name of the firmware file being searched for. Firmware NGTH) File Sample VAR CONSTANT i Num Of Drives : INT := 2; END_VAR VAR b Init : ARRAY [1..i Num Of Drives] OF BOOL := 2(TRUE); fb Firmware Update : ARRAY[1..i Num Of Drives] OF FB_So EAX5000Firmware Update_By Drive Ref; st Plc Drive Ref AT %I* : ARRAY[1..i Num Of Drives]OF ST_Plc Drive Ref; st Drive Ref : ARRAY [1..i Num Of Drives] OF ST_Drive Ref; s Firmware Version : ARRAY[1..i Num Of Drives] OF STRING(20) := 2('v1.05_b0009'); e Fw Update State : ARRAY[1..i Num Of Drives] OF E_Fw Update State; s Selected Firmware File: ARRAY [1..i Num Of Drives] OF STRING(MAX_STRING_LENGTH); i Update State : INT; b Execute : BOOL; s Net Id IPC : T_Ams Net Id := ''; s Firmware Path : T_Max String := 'C:\Twin CAT\Io\Tc Drive Manager\Firmware Pool'; I : INT; b Any Init : BOOL; b Any Busy : BOOL; b Any Error : BOOL; END_VAR CASE i Update State OF 0: b Any Init := FALSE; FOR I := 1 TO i Num Of Drives DO IF b Init[I] THEN b Any Init := TRUE; st Drive Ref[I].s Net Id := F_Create Ams Net Id(st Plc Drive Ref[I].a Net Id); st Drive Ref[I].n Slave Addr := st Plc Drive Ref[I].n Slave Addr; st Drive Ref[I].n Drive No := st Plc Drive Ref[I].n Drive No; st Drive Ref[I].n Drive Type := st Plc Drive Ref[I].n Drive Type; IF (st Drive Ref[I].s Net Id <> '') AND (st Drive Ref[I].n Slave Addr <> 0) THEN b Init[I] := FALSE; END_IF END_IF END_FOR IF NOT b Any Init AND b Execute THEN i Update State := 1; END_IF 1: FOR I := 1 TO i Num Of Drives DO fb Firmware Update[I]( st Drive Ref := st Drive Ref[I], b Execute := TRUE, t Timeout := T#15s, s Firmware Version := s Firmware Version[I], s Firmware Path := s Firmware Path, s Net Id IPC := s Net Id IPC, i Req Ec State := EC_DEVICE_STATE_OP, e Fw Update State => e Fw Update State[I] 36 Version: 1.4.5 TE1000
## Page 37

Function blocks ); END_FOR i Update State := 2; 2: b Any Busy := FALSE; b Any Error:= FALSE; FOR I := 1 TO i Num Of Drives DO fb Firmware Update[I]( e Fw Update State => e Fw Update State[I], s Selected Firmware File => s Selected Firmware File[I] ); IF NOT fb Firmware Update[I].b Busy THEN fb Firmware Update[I](b Execute := FALSE); IF fb Firmware Update[I].b Error THEN b Any Error := TRUE; END_IF ELSE b Any Busy := TRUE; END_IF END_FOR IF NOT b Any Busy THEN b Execute := FALSE; IF NOT b Any Error THEN i Update State := 0; (* OK *) ELSE i Update State := 0; (* Error *) END_IF END_IF END_CASE 4.2.5 FB_So EAX5000Park Axis_By Drive Ref FB_So EAX5000Park Axis_By Drive Ref st Drive Ref ST_Drive Ref BOOL b Busy b Execute BOOL BOOL b Error b Park BOOL UINT i Ads Err Id t Timeout TIME UINT i Sercos Err Id The parking functionality of an AX5000 is activated with the FB_So EAX5000Park Axis_By Drive Ref function block. A parked channel of an AX5000 is temporarily disabled. In a modular machine concept, certain motors may not be available. The channels can be disabled via this function to ensure that errors do not occur (e.g. feedback errors). Inputs VAR_INPUT st Drive Ref : ST_Drive Ref; b Execute : BOOL; b Park : BOOL; t Timeout : TIME; END_VAR Name Type Description st Drive Ref ST_Drive Ref [} 11] Reference to the drive. The reference to the drive can be linked directly to the PLC in the development environment. To do this, an instance of the ST_Plc Drive Ref structure must be allocated and the Net ID must be converted from the byte array into a string. b Execute BOOL The function block is enabled via a positive edge at this input. b Park BOOL Specifies whether the FB parks (TRUE) or releases (FALSE) the axis. t Timeout TIME Maximum time allowed for the execution of the function block. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; TE1000 Version: 1.4.5 37
## Page 38

Function blocks i Ads Err Id : UINT; i Sercos Err Id : UINT; END_VAR Name Type Description b Busy BOOL This output is set when the function block is activated, and remains set until feedback is received. b Error BOOL This output is set after the b Busy output has been reset when an error occurs in the transmission of the command. i Ads Err Id UINT Returns the ADS error code of the last executed command when the b Error output is set. i Sercos Err Id UINT Returns the Sercos error of the last executed command in the event of a set b Error output. 4.3 Indra Drive Cs 4.3.1 Conversion functions 4.3.1.1 F_Conv Word To STIndra Drive Cs C1D With this function the Class 1 diagnosis FB_So ERead Class XDiag_By Drive Ref [} 23] (S-0-0011) can be changed to an ST_Indra Drive Cs_C1D [} 49] structure. Inputs VAR_INPUT w Class1Diag : WORD; END_VAR Name Type Description w Class1D WORD Class 1 diagnosis Word from S-0-0011 iag (see FB_So ERead Class XDiag_By Drive Ref [} 23]). Return value FUNCTION F_Conv Word To STIndra Drive Cs C1D : ST_Indra Drive Cs_C1D Name Type Description F_Conv Word To STIndra Drive Cs C ST_Indra Drive Cs_C1D [} 49] Return value of the function 1D Class-1-Diagnosis as ST_Indra Drives Cs_C1D structure. 4.3.1.2 F_Conv Word To STIndra Drive Cs Drive Status With this function the Drive status word (S-0-0135) can be changed to a structure ST_Indra Drive Cs Drive Status [} 50] . 38 Version: 1.4.5 TE1000
## Page 39

Function blocks Inputs VAR_INPUT w Class1Diag : WORD; END_VAR Name Type Description w Class1D WORD Drive status word from S-0-0135 iag Can be read with FB_So E_Read_By Drive Ref, can be mapped if necessary. Return value FUNCTION F_Conv Word To STIndra Drive Cs Drive Status : ST_Indra Drive Cs Drive Status Name Type Description F_Conv Word To STIndra Drive Cs D ST_Indra Drive Cs Drive Status [} 50] Return value of the function. Drive rive Status status word as ST_Indra Drive Cs Drive Status structure. 4.4 F_Get Version Tc Drive This function can be used to read PLC library version information. Inputs VAR_INPUT n Version Element : INT; END_VAR Name Type Description n Version E INT n Version Element: version element to be read. lement Possible parameters: • 1 : major number; • 2 : minor number; • 3 : revision number; Return value FUNCTION F_Get Version Tc Drive : UINT Name Type Description F_Get Version Tc Drive UINT Return value of the function. Version element as UINT. 4.5 Simple Plc Motion Simple PLC Motion function blocks enable easy operation of a drive directly from the PLC. TE1000 Version: 1.4.5 39
## Page 40

Function blocks 4.5.1 FB_Co EDrive Enable FB_Co EDrive Enable b Enable BOOL BOOL b Status b Reset BOOL BOOL b Drive Error ↔ st Coe Drive Io Interface Reference To ST_Co EDrive Io Interface The FB_Co EDrive Enable function block enables a Co E drive in order to be able to subsequently supply it with setpoints using the function block FB_Co EDrive Move Velocity [} 40]. Inputs VAR_INPUT b Enable : BOOL; b Reset : BOOL; END_VAR Name Type Description b Enable BOOL Activates the Co E drive. b Reset BOOL Performs a drive reset in the event of a fault. "Bit 7" is set in the drive control word. / Inputs/Outputs VAR_IN_OUT st Coe Drive Io Interface : ST_Coe Drive Io Interface; END_VAR Name Type Description st Coe Drive Io Interface ST_Coe Drive Io Interface Data structure to which the process image of the Co E drive must be linked. Outputs VAR_OUTPUT b Status : BOOL; b Drive Error : BOOL; END_VAR Name Type Description b Status BOOL If b Status=TRUE, the drive is ready for operation and follows the setpoints. b Drive Error BOOL The drive is in the error state. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4024.22 PC or CX (x86 or x64) Tc2_Drive 4.5.2 FB_Co EDrive Move Velocity FB_Co EDrive Move Velocity b Enable BOOL BOOL b In Velocity f Velocity LREAL BOOL b Busy f Acceleration1 LREAL BOOL b Error f Acceleration2 LREAL UDINT i Error ID f Deceleration1 LREAL LREAL f Actual Velocity f Deceleration2 LREAL b Negative Direction BOOL st Options ST_Drive Move Velocity Options ↔ st Co EDrive Io Interface Reference To ST_Co EDrive Io Interface 40 Version: 1.4.5 TE1000
## Page 41

Function blocks The FB_Co EDrive Move Velocity function block generates a simple three-phase velocity profile (without jerk limitation) that can be used to supply a Co E drive directly. Different accelerations or decelerations can be used below and above a parameterizable velocity threshold. The target velocity can be changed during operation. The Co E drive must first be enabled via the function block FB_Co EDrive Enable [} 40]. Inputs VAR_INPUT b Enable : BOOL; f Velocity : LREAL; f Acceleration1 : LREAL; f Accelaration2 : LREAL; f Deceleration1 : LREAL; f Deceleration2 : LREAL; b Negative Direction : BOOL; st Options : ST_Drive Move Velocity Options; END_VAR Name Type Description b Enable BOOL Activates the setpoint generation. f Velocity LREAL Target velocity. f Velocity can be changed during operation. f Acceleration1 LREAL Acceleration 1 is used below the parameterized velocity threshold st Options. f Velocity Threshold. f Acceleration2 LREAL Acceleration 2 is used above the parameterized velocity threshold st Options. f Velocity Threshold. f Deceleration1 LREAL Deceleration 1 is used below the parameterized velocity threshold st Options. f Velocity Threshold. f Deceleration2 LREAL Deceleration 2 is used above the parameterized velocity threshold st Options. f Velocity Threshold. b Negative Direction BOOL b Negative Direction reverses the direction of travel. st Options ST_Drive Move Velocity Options Data structure with additional parameters. / Inputs/Outputs VAR_IN_OUT st Co EDrive Io Interface : ST_Coe Drive Io Interface; END_VAR Name Type Description st Co EDrive Io Interface ST_Coe Drive Io Interface Process image of the Co E drive Outputs VAR_OUTPUT b In Velocity : BOOL; b Busy : BOOL; b Error : BOOL; i Error ID : UDINT; f Actual Velocity : LREAL; END_VAR Name Type Description b In Velocity BOOL Target velocity is reached. b Busy BOOL b Busy is TRUE as long as the function block is active and a setpoint profile is being calculated. TE1000 Version: 1.4.5 41
## Page 42

Function blocks Name Type Description b Error BOOL b Error becomes TRUE if an error occurs. i Error ID UDINT Error number f Actual Velocity LREAL Currently reached velocity of the drive. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4024.22 PC or CX (x86 or x64) Tc2_Drive 4.5.3 FB_So EDrive Enable FB_So EDrive Enable b Enable BOOL BOOL b Status ↔ st Soe Drive Io Interface Reference To ST_So EDrive Io Interface BOOL b Drive Error The FB_So EDrive Enable function block enables a So E drive in order to be able to subsequently supply it with setpoints using the function block FB_So EDrive Move Velocity [} 43]. Inputs VAR_INPUT b Enable : BOOL; END_VAR Name Type Description b Enable BOOL Activates the So E drive. / Inputs/Outputs VAR_IN_OUT st Soe Drive Io Interface : ST_So EDrive Io Interface; END_VAR Name Type Description st Soe Drive Io Interface ST_So EDrive Io Interface Data structure to which the process image of the So E drive must be linked. Outputs VAR_OUTPUT b Status : BOOL; b Drive Error : BOOL; END_VAR Name Type Description b Status BOOL If b Status=TRUE, the drive is ready for operation and follows the setpoints. b Drive Error BOOL The drive is in the error state. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4024.22 PC or CX (x86 or x64) Tc2_Drive 42 Version: 1.4.5 TE1000
## Page 43

Function blocks 4.5.4 FB_So EDrive Move Velocity FB_So EDrive Move Velocity b Enable BOOL BOOL b In Velocity f Velocity LREAL BOOL b Busy f Acceleration1 LREAL BOOL b Error f Acceleration2 LREAL UDINT i Error ID f Deceleration1 LREAL LREAL f Actual Velocity f Deceleration2 LREAL b Negative Direction BOOL st Options ST_Drive Move Velocity Options ↔ st Soe Drive Io Interface Reference To ST_So EDrive Io Interface The FB_So EDrive Move Velocity function block generates a simple three-phase velocity profile (without jerk limitation) that can be used to supply an So E drive directly. Different accelerations or decelerations can be used below and above a parameterizable velocity threshold. The target velocity can be changed during operation. The So E drive must first be enabled via the function block FB_So EDrive Enable [} 42]. Inputs VAR_INPUT b Enable : BOOL; f Velocity : LREAL; f Acceleration1 : LREAL; f Accelaration2 : LREAL; f Deceleration1 : LREAL; f Deceleration2 : LREAL; b Negative Direction : BOOL; st Options : ST_Drive Move Velocity Options; END_VAR Name Type Description b Enable BOOL Activates the setpoint generation. f Velocity LREAL Target velocity. f Velocity can be changed during operation. f Acceleration1 LREAL Acceleration 1 is used below the parameterized velocity threshold st Options. f Velocity Threshold. f Acceleration2 LREAL Acceleration 2 is used above the parameterized velocity threshold st Options. f Velocity Threshold. f Deceleration1 LREAL Deceleration 1 is used below the parameterized velocity threshold st Options. f Velocity Threshold. f Deceleration2 LREAL Deceleration 2 is used above the parameterized velocity threshold st Options. f Velocity Threshold. b Negative Direction BOOL b Negative Direction reverses the direction of travel. st Options ST_Drive Move Velocity Options Data structure with additional parameters. / Inputs/Outputs VAR_IN_OUT st So EDrive Io Interface : ST_Soe Drive Io Interface; END_VAR Name Type Description st So EDrive Io Interface ST_Soe Drive Io Interface Process image of the Co E drive TE1000 Version: 1.4.5 43
## Page 44

Function blocks Outputs VAR_OUTPUT b In Velocity : BOOL; b Busy : BOOL; b Error : BOOL; i Error ID : UDINT; f Actual Velocity : LREAL; END_VAR Name Type Description b In Velocity BOOL Target velocity is reached. b Busy BOOL b Busy is TRUE as long as the function block is active and a setpoint profile is being calculated. b Error BOOL b Error becomes TRUE if an error occurs. i Error ID UDINT Error number f Actual Velocity LREAL Currently reached velocity of the drive. Requirements Development environment Target platform PLC libraries to include Twin CAT 3.1.4024.22 PC or CX (x86 or x64) Tc2_Drive 44 Version: 1.4.5 TE1000
## Page 45

Data types 5 Data types 5.1 General So E 5.1.1 ST_So E_String The ST_So E_String structure describes a string as it can be used in So E accesses. TYPE ST_So E_String : STRUCT i Actual Size : UINT; i Max Size : UINT; str Data : STRING(MAX_STRING_LENGTH); END_STRUCT END_TYPE Name Type Description i Actual Siz UINT Current length of the string (without closing \0) e i Max Size UINT Maximum length of the string (without closing \0) str Data STRING(MAX_STRING_LE String NGTH) 5.1.2 ST_So E_String Ex The structure ST_So E_String Ex describes a string such as can be used with So E accesses, including the preset parameter attribute. TYPE ST_So E_String Ex : STRUCT dw Attribute : DWORD; i Actual Size : UINT; i Max Size : UINT; str Data : STRING(MAX_STRING_LENGTH); END_STRUCT END_TYPE Name Type Description dw Attribu DWORD Parameter attribute te i Actual Siz UINT Current length of the string (without closing \0) e i Max Size UINT Maximum length of the string (without closing \0) str Data STRING(MAX_STRING_LE String NGTH) 5.1.3 List types 5.1.3.1 ST_So E_Diag Num List The ST_So E_Diag Num List structure contains the list length (Minimum, Maximum) in bytes as well as the history of the diagnosis numbers. TYPE ST_So E_Diag Num List : STRUCT i Actual Size : UINT; i Max Size : UINT; arr Diag Numbers : ARRAY [0..29] OF UDINT; END_STRUCT END_TYPE TE1000 Version: 1.4.5 45
## Page 46

Data types Name Type Description i Actual Siz UINT Current length of the string (without closing \0) e i Max Size UINT Maximum length of the string (without closing \0) arr Diag Nu ARRAY [0..29] OF UDINT List of the maximum 30 last error numbers (as UDINT) mbers 5.2 AX5000 So E 5.2.1 E_Fw Update State The enumeration E_Fw Update State describes the state of a firmware update. TYPE E_Fw Update State :( (* update states *) e Fw U_No Error := 0, e Fw U_Check Cfg Identity, e Fw U_Check Slave Count, e Fw U_Check Find Slave Pos, e Fw U_Wait For Scan, e Fw U_Scanning Slaves, e Fw U_Check Scanned Identity, e Fw U_Check Scanned Firmware, e Fw U_Find Firmware File, e Fw U_Wait For Update, e Fw U_Wait For Slave State, e Fw U_Start Fw Update, e Fw U_Fw Update In Progress, e Fw U_Fw Update Done, e Fw U_No Fw Update Required, (* not updating via this channel *) e Fw U_Update Via Other Channel Active, e Fw U_Updated Via Other Channel, (* error states *) e Fw U_Get Slave Identity Error := -1, e Fw U_Get Slave Count Error := -2, e Fw U_Get Slave Addr Error := -3, e Fw U_Start Scan Error := -4, e Fw U_Scan State Error := -5, e Fw U_Scan Identity Error := -6, e Fw U_Get Slave State Error := -7, e Fw U_Scan Firmware Error := -8, e Fw U_Find File Error := -9, e Fw U_Cfg Type In No AX5xxx := -10, e Fw U_Scanned Type In No AX5xxx := -11, e Fw U_Channel Mismatch := -12, e Fw U_Channel Mismatch_1Cfg_2Scanned := -13, e Fw U_Channel Mismatch_2Cfg_1Scanned := -14, e Fw U_Current Mismatch := -15, e Fw U_Fw Update Error := -16, e Fw U_Req Slave State Error := -17, e Fw U_Channel Mismatch_0Cfg_1Scanned := -18, e Fw U_Channel Mismatch_0Cfg_2Scanned := -19, e Fw U_Channel Mismatch_1Cfg_0Scanned := -20, e Fw U_Channel Mismatch_2Cfg_0Scanned := -21, e Fw U_Type Incompatible Cfg To Scanned := -22 ); END_TYPE Update Status e Fw U_No Error Initial state e Fw U_Check Cfg Identity Read the configured slave types (number of channels, current, revision) e Fw U_Check Slave Count Determine the configured number of slaves e Fw U_Check Find Slave Pos Search for the slave address in the master object directory 46 Version: 1.4.5 TE1000
## Page 47

Data types e Fw U_Wait For Scan Wait for online scan e Fw U_Scanning Slaves Online scan of the slaves e Fw U_Check Scanned Identity Read the scanned slave types (number of channels, current, revision) e Fw U_Check Scanned Firmware Read the firmware version e Fw U_Find Firmware File Search for the selected firmware file e Fw U_Wait For Update Wait for status of the update e Fw U_Wait For Slave State Determine the Ether CAT slave status e Fw U_Start Fw Update Start the firmware update e Fw U_Fw Update In Progress Firmware update active e Fw U_Fw Update Done Firmware update successfully completed e Fw U_No Fw Update Required No firmware update required e Fw U_Update Via Other Channel Active Update takes place via the other axis channel e Fw U_Updated Via Other Channel Update took place via the other axis channel Update error e Fw U_Get Slave Identity Error Reading of the configured slave type failed (see i Ads Err Id)- e Fw U_Get Slave Count Error Determination of the configured number of slaves failed (see i Ads Err Id)- e Fw U_Get Slave Addr Error Search for the slave address in the master object directory failed (see i Ads Err Id)- e Fw U_Start Scan Error Start of the online scan failed (see i Ads Err Id)- e Fw U_Scan State Error Online scan failed (see i Ads Err Id)- e Fw U_Scan Identity Error Reading of the scanned slave type (number of channels, current, revision) failed (see i Ads Err Id)- e Fw U_Get Slave State Error Determination of the Ether CAT slave status failed (see i Ads Err Id)- e Fw U_Scan Firmware Error Reading of the firmware version failed (see i Ads Err Id + i Sercos Err Id). e Fw U_Find File Error Search for the selected firmware file failed (see i Ads Err Id). e Fw U_Cfg Type In No AX5xxx The configured slave is not an AX5000. e Fw U_Scanned Type In No AX5xxx The scanned slave is not an AX5000. e Fw U_Channel Mismatch The number of configured and found channels of the AX5000 do not match. e Fw U_Channel Mismatch_1Cfg_2Scanned Single-channel device configured, but two-channel device found. e Fw U_Channel Mismatch_2Cfg_1Scanned Two-channel device configured, but single-channel device found. e Fw U_Current Mismatch AX5000 type does not match in terms of current, e.g. AX5103 (3 A) configured, but AX5106 (6 A) found. e Fw U_Fw Update Error General update error (see i Ads Err Id) e Fw U_Req Slave State Error Switching to the desired Ether CAT status failed. e Fw U_Channel Mismatch_0Cfg_1Scanned e Fw U_Channel Mismatch_0Cfg_2Scanned e Fw U_Channel Mismatch_1Cfg_0Scanned e Fw U_Channel Mismatch_2Cfg_0Scanned e Fw U_Type Incompatible Cfg To Scanned TE1000 Version: 1.4.5 47
## Page 48

Data types 5.2.2 ST_AX5000_C1D The data structure ST_AX5000_C1D is used for the "Class 1 diagnostics". TYPE ST_AX5000_C1D : STRUCT b Overload Shutdown : BOOL; (* C1D Bit 0 *) b Amplifier Over Temp Shutdown : BOOL; (* C1D Bit 1 *) b Motor Over Temp Shutdown : BOOL; (* C1D Bit 2 *) b Cooling Error Shutdown : BOOL; (* C1D Bit 3 *) b Control Voltage Error : BOOL; (* C1D Bit 4 *) b Feedback Error : BOOL; (* C1D Bit 5 *) b Communication Error : BOOL; (* C1D Bit 6 *) b Over Current Error : BOOL; (* C1D Bit 7 *) b Over Voltage Error : BOOL; (* C1D Bit 8 *) b Under Voltage Error : BOOL; (* C1D Bit 9 *) b Power Supply Phase Error : BOOL; (* C1D Bit 10 *) b Excessive Pos Diviation Error : BOOL; (* C1D Bit 11 *) b Communication Error Bit : BOOL; (* C1D Bit 12 *) b Overtravel Limit Exceeeded : BOOL; (* C1D Bit 13 *) b Reserved : BOOL; (* C1D Bit 14 *) b Manufacturer Specific Error : BOOL; (* C1D Bit 15 *) END_STRUCT END_TYPE 5.2.3 ST_AX5000Drive Status TYPE ST_AX5000Drive Status : STRUCT b Status Cmd Val Processing : BOOL; b Real Time Status Bit1 : BOOL; b Real Time Status Bit2 : BOOL; b Drv Shutdown Bit C1D : BOOL; b Change Bit C2D : BOOL; b Change Bit C3D : BOOL; b Not Ready To Power Up : BOOL; b Ready For Power : BOOL; b Ready For Enable : BOOL; b Enabled : BOOL; i Act Op Mode Par Num : UINT; e Act Op Mode : E_AX5000_Drive Op Mode; i Reserved : UINT; END_STRUCT END_TYPE 5.2.4 E_AX5000_Drive Op Mode TYPE E_AX5000_Drive Op Mode : ( e OPM_No Mode Of Operation := 0, e OPM_Torque Ctrl := 1, e OPM_Velo Ctrl := 2, e OPM_Pos Ctrl Fbk1 := 3, e OPM_Pos Ctrl Fbk2 := 4, e OPM_Pos Ctrl Fbk1Lag Less := 11, e OPM_Pos Ctrl Fbk2Lag Less := 12 ); END_TYPE 5.3 Indra Drive Cs 5.3.1 E_Indra Drive Cs_Drive Op Mode TYPE E_Indra Drive Cs_Drive Op Mode : ( e IDC_No Mode Of Operation := 0, e IDC_Torque Ctrl := 1, e IDC_Velo Ctrl := 2, e IDC_Pos Ctrl Fbk1 := 3, e IDC_Pos Ctrl Fbk2 := 4, e IDC_Pos Ctrl Fbk1Lag Less := 11, e IDC_Pos Ctrl Fbk2Lag Less := 12, e IDC_Drv Intern Interpol Fbk1 := 19, 48 Version: 1.4.5 TE1000
## Page 49

Data types e IDC_Drv Intern Interpol Fbk2 := 20, e IDC_Drv Intern Interpol Fbk1Lag Less := 27, e IDC_Drv Intern Interpol Fbk2Lag Less := 28, e IDC_Pos Block Mode Fbk1 := 51, e IDC_Pos Block Mode Fbk2 := 52, e IDC_Pos Block Mode Fbk1Lag Less := 59, e IDC_Pos Block Mode Fbk2Lag Less := 60, e IDC_Pos Ctrl Drv Ctrld Fbk1 := 259, e IDC_Pos Ctrl Drv Ctrld Fbk2 := 260, e IDC_Pos Ctrl Drv Ctrld Fbk1Lag Less := 267, e IDC_Pos Ctrl Drv Ctrld Fbk2Lag Less := 268, e IDC_Drv Ctrld Positioning Fbk1 := 531, e IDC_Drv Ctrld Positioning Fbk2 := 532, e IDC_Drv Ctrld Positioning Fbk1Lag Less := 539, e IDC_Drv Ctrld Positioning Fbk2Lag Less := 540, e IDC_Cam Fbk1Virt Master := -30717, e IDC_Cam Fbk2Virt Master := -30716, e IDC_Cam Fbk1Virt Master Lag Less := -30709, e IDC_Cam Fbk2Virt Master Lag Less := -30708, e IDC_Cam Fbk1Real Master := -30701, e IDC_Cam Fbk2Real Master := -30700, e IDC_Cam Fbk1Real Master Lag Less := -30693, e IDC_Cam Fbk2Real Master Lag Less := -30692, e IDC_Phase Sync Fbk1Virt Master := -28669, e IDC_Phase Sync Fbk2Virt Master := -28668, e IDC_Phase Sync Fbk1Virt Master Lag Less := -28661, e IDC_Phase Sync Fbk2Virt Master Lag Less := -28660, e IDC_Phase Sync Fbk1Real Master := -28653, e IDC_Phase Sync Fbk2Real Master := -28652, e IDC_Phase Sync Fbk1Real Master Lag Less := -28645, e IDC_Phase Sync Fbk2Real Master Lag Less := -28644, e IDC_Velo Sync Virt Master := -24574, e IDC_Velo Sync Real Master := -24558, e IDC_Motion Profile Fbk1Virt Master := -26621, e IDC_Motion Profile Fbk2Virt Master := -26620, e IDC_Motion Profile Lag Less Fbk1Virt Master := -26613, e IDC_Motion Profile Lag Less Fbk2Virt Master := -26612, e IDC_Motion Profile Fbk1Real Master := -26605, e IDC_Motion Profile Fbk2Real Master := -26604, e IDC_Motion Profile Lag Less Fbk1Real Master := -26597, e IDC_Motion Profile Lag Less Fbk2Real Master := -26596, e IDC_Pos Ctrl Drv Ctrld := 773, e IDC_Drv Ctrld Positioning := 533, e IDC_Pos Block Mode := 565, e IDC_Velo Synchronization := 66, e IDC_Pos Synchronization := 581 ); END_TYPE 5.3.2 ST_Indra Drive Cs_C1D The data structure ST_Indra Drive Cs_C1D is used for the “Class 1 diagnostics". TYPE ST_Indra Drive Cs_C1D : STRUCT b Overload Shutdown : BOOL; (* C1D Bit 0 *) b Amplifier Over Temp Shutdown : BOOL; (* C1D Bit 1 *) b Motor Over Temp Shutdown : BOOL; (* C1D Bit 2 *) b Reserved_3 : BOOL; (* C1D Bit 3 *) b Control Voltage Error : BOOL; (* C1D Bit 4 *) b Feedback Error : BOOL; (* C1D Bit 5 *) b Reserved_6 : BOOL; (* C1D Bit 6 *) b Over Current Error : BOOL; (* C1D Bit 7 *) b Over Voltage Error : BOOL; (* C1D Bit 8 *) TE1000 Version: 1.4.5 49
## Page 50

Data types b Under Voltage Error : BOOL; (* C1D Bit 9 *) b Reserved_10 : BOOL; (* C1D Bit 10 *) b Excessive Pos Diviation Error : BOOL; (* C1D Bit 11 *) b Communication Error Bit : BOOL; (* C1D Bit 12 *) b Overtravel Limit Exceeeded : BOOL; (* C1D Bit 13 *) b Reserved_14 : BOOL; (* C1D Bit 14 *) b Manufacturer Specific Error : BOOL; (* C1D Bit 15 *) END_STRUCT END_TYPE 5.3.3 ST_Indra Drive Cs Drive Status TYPE ST_Indra Drive Cs Drive Status : STRUCT b Status Cmd Val Processing : BOOL; b Real Time Status Bit1 : BOOL; b Real Time Status Bit2 : BOOL; b Drv Shutdown Bit C1D : BOOL; b Change Bit C2D : BOOL; b Change Bit C3D : BOOL; b Not Ready To Power Up : BOOL; b Ready For Power : BOOL; b Ready For Enable : BOOL; b Enabled : BOOL; i Act Op Mode Par Num : UINT; e Act Op Mode : E_Indra Drive Cs_Drive Op Mode; i Reserved : UINT; END_STRUCT END_TYPE 5.4 SERCOS 5.4.1 E_So E_Attrib Len The enumeration E_So E_Attrib Len in the attribute of a parameter specifies whether the value of the parameter is a 2, 4, or 8-byte data type (single value), or whether it is a list consisting of 1, 2, 4, or 8-byte data types. List types (with e So E_LEN_V...) first have the current list length in bytes (in a 16 bit value), then the maximum list length in bytes (in a 16 bit value) and the actual list in the specified data type. Sample: see ST_So E_String [} 45] of the e So E_LEN_V1BYTE type. TYPE E_So E_Attrib Len : ( e So E_LEN_2BYTE := 1, e So E_LEN_4BYTE := 2, e So E_LEN_8BYTE := 3, e So E_LEN_V1BYTE := 4, e So E_LEN_V2BYTE := 5, e So E_LEN_V4BYTE := 6, e So E_LEN_V8BYTE := 7 ); END_TYPE Name Description e So E_LEN_2BYTE 2-byte data type (e.g. UINT, INT, WORD, IDN) e So E_LEN_4BYTE 4-byte data type (e.g. UDINT, DINT, DWORD, REAL) e So E_LEN_8BYTE 8-byte data type (e.g. ULINT, LINT, LREAL) e So E_LEN_V1BYTE List of 1-byte data types (e.g. string) e So E_LEN_V2BYTE List of 2-byte data types (e.g. IDN list) e So E_LEN_V4BYTE List of 4-Byte data types e So E_LEN_V8BYTE List of 8-Byte data types 5.4.2 E_So E_Cmd Control The enumeration E_So ECmd Control determines whether the command is to be canceled, set or started. 50 Version: 1.4.5 TE1000
## Page 51

Data types TYPE E_So E_Cmd Control :( e So E_Cmd Control_Cancel := 0, e So E_Cmd Control_Set := 1, e So E_Cmd Control_Set And Enable := 3 ); END_TYPE Name Description e So E_Cmd Control_Cancel Cancel command. e So E_Cmd Control_Set Set command. e So E_Cmd Control_Set And Enable Set command and execute. 5.4.3 E_So E_Cmd State The enumeration E_So E_Cmd State describes the state of an So E command. TYPE E_So E_Cmd State :( e So E_Cmd State_Not Set := 0, e So E_Cmd State_Set := 1, e So E_Cmd State_Executed := 2, e So E_Cmd State_Set Enabled Executed := 3, e So E_Cmd State_Set And Interrupted := 5, e So E_Cmd State_Set Enabled Not Executed := 7, e So E_Cmd State_Error := 15 ); END_TYPE Name Description e So E_Cmd State_Not Set = 0 No command active e So E_Cmd State_Set = 1 Command set (prepared) but not (yet) executed e So E_Cmd State_Executed = 2 Command has been executed. e So E_Cmd State_Set Enabled Executed = 3 Command set (prepared) and executed. e So E_Cmd State_Set And Interrupted = 5 Command has been set but interrupted. e So E_Cmd State_Set Enabled Not Executed = 7 Command execution is still active. e So E_Cmd State_Error = 15 Error during command execution. The system has switched to the error state has been changed. 5.4.4 E_So E_Type The enumeration E_So E_Type describes the representation of the parameter value in the attribute of the parameter. TYPE E_So E_Type : ( e So E_Type_BIN := 0, e So E_Type_UNSIGNED := 1, e So E_Type_SIGNED := 2, e So E_Type_HEX := 3, e So E_Type_TEXT := 4, e So E_Type_IDN := 5, e So E_Type_FLOAT := 6 ); END_TYPE The enumeration E_So E_Type is used to determine how the data can be interpreted: Name Description e So E_Type_BIN Binary e So E_Type_UNSIGNED Integer without sign e So E_Type_SIGNED Integer with sign e So E_Type_HEX Hexadecimal number e So E_Type_TEXT Text e So E_Type_IDN Parameter number e So E_Type_FLOAT Floating point number TE1000 Version: 1.4.5 51
## Page 52

Data types 5.5 Simple Plc Motion 5.5.1 E_Co EDrive Enable State TYPE E_Co EDrive Enable State : ( e Co EDrive Enable State_Ready To Switch On := 0, e Co EDrive Enable State_Switched On := 1, e Co EDrive Enable State_Operation Enabled := 2, e Co EDrive Enable State_Fault := 3, e Co EDrive Enable State_Fault Reaction Active := 4, e Co EDrive Enable State_Not Ready Switched On := 5, e Co EDrive Enable State_Switched On Disabled := 6, e Co EDrive Enable State_Drive Follows := 7 ); END_TYPE 5.5.2 E_Drive Move Velocity Error TYPE E_Co EDrive Enable State : ( DRIVEPLCERROR_DRIVENOTREADY := 16#4BF0, DRIVEPLCERROR_INVALIDDYNAMICSPARAMETER, DRIVEPLCERROR_INVALIDVELOCITYSCALING, DRIVEPLCERROR_FUNCTIONBLOCKSUDDENLYDISABLED ); END_TYPE 5.5.3 ST_Co EDrive Io Interface Data structure for mapping the process image of a Co E drive to use the function blocks FB_Co EDrive Enable [} 40] and FB_Co EDrive Move Velocity [} 40]. TYPE ST_Co EDrive Io Interface : STRUCT i Control : UINT; i Status : UINT; i Cmd Velo : DINT; i Act Velo : DINT; st Ads Addr : ST_Ams Addr; i Channel : BYTE; e State Machine : E_Co EDrive Enable State; END_STRUCT END_TYPE 5.5.4 ST_Drive Move Velocity Options The structure ST_Drive Move Velocity Options describes additional parameters of the function blocks FB_Co EDrive Move Velocity [} 40] and FB_So EDrive Move Velocity [} 43]. TYPE ST_Drive Move Velocity Options : STRUCT b Velocity Unit RPM : BOOL; f Velocity Threshold : LREAL; f Velocity Scaling Factor : LREAL; f Filter Time Actual Velocity : LREAL; b Invert Direction : BOOL; END_STRUCT END_TYPE 5.5.5 ST_So EDrive Io Interface Data structure for mapping the process image of a So E drive to use the function blocks FB_So EDrive Enable [} 42] and FB_So EDrive Move Velocity [} 43]. TYPE ST_So EDrive Io Interface : STRUCT i Master Control Word : WORD; i Velocity Command Value : DINT; i Drive Status Word : WORD; i Velocity Feedback Value : DINT; i State : UINT; 52 Version: 1.4.5 TE1000
## Page 53

Data types st Ads Addr : ST_Ams Addr; i Channel : BYTE; END_STRUCT END_TYPE TE1000 Version: 1.4.5 53
## Page 54

Support and Service 6 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 54 Version: 1.4.5 TE1000
## Page 55

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements The registered trademark Linux® is used pursuant to a sublicense from the Linux Foundation, the exclusive licensee of Linus Torvalds, owner of the mark on a worldwide basis.
## Page 56

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
