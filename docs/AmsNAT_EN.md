---
title: "Twin CAT 3 Ams NAT 2021-08-24"
product: "AmsNAT"
category: "Communication"
tags: ["AMS", "CAT", "NAT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.1"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/AmsNAT_EN.pdf"
release_date: "2021-08-24"
---
Manual | EN Twin CAT 3 Ams NAT 2021-08-24 | Version: 1.1

## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation.............................................................................................................. 5 1.2 Safety instructions............................................................................................................................. 6 2 Introduction................................................................................................................................................ 7 3 General description................................................................................................................................... 9 4 Motivation................................................................................................................................................. 10 5 Functioning.............................................................................................................................................. 11 6 Configuration........................................................................................................................................... 13 Twin CAT 3 Version: 1.1 3

## Page 4

Table of contents 4 Version: 1.1 Twin CAT 3

## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilization of this document as well as the communication of its contents to others without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. Twin CAT 3 Version: 1.1 5

## Page 6

Foreword 1.2 Safety instructions Safety regulations Please note the following safety instructions and explanations! Product-specific safety instructions can be found on following pages or in the areas mounting, wiring, commissioning etc. Exclusion of liability All the components are supplied in particular hardware and software configurations appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation and drive engineering who are familiar with the applicable national standards. Description of symbols In this documentation the following symbols are used with an accompanying safety instruction or note. The safety instructions must be read carefully and followed without fail! DANGER Serious risk of injury! Failure to follow the safety instructions associated with this symbol directly endangers the life and health of persons. WARNING Risk of injury! Failure to follow the safety instructions associated with this symbol endangers the life and health of per- sons. CAUTION Personal injuries! Failure to follow the safety instructions associated with this symbol can lead to injuries to persons. NOTE Damage to the environment or devices Failure to follow the instructions associated with this symbol can lead to damage to the environment or equipment. Tip or pointer This symbol indicates information that contributes to better understanding. 6 Version: 1.1 Twin CAT 3

## Page 7

Introduction 2 Introduction For a better understanding of the Ams NAT function it is important to know the difference between ADS and AMS and to know what an ADS route is. ADS (Automation Device Specification) is the Twin CAT communication protocol that specifies the interaction between two ADS devices. For example, it defines what operations can be executed on another ADS device, what parameters are necessary for that and what return value is sent after execution. AMS (Automation Message Specification) specifies the exchange of the ADS data. A major component of the communication protocol is the Ams Net Id. This is specified in the AMS/ADS package for the source and target device. An ADS device can be explicitly addressed using the Ams Net Id. A route between two devices must be setup in Twin CAT so that they can communicate. This route is configured on both sides and typically contains the route name, the Ams Net Id and the address of the communication partner as well as the type of connection. The configuration of new routes and an overview of existing routes in a Twin CAT system are shown in the following figure. If the hardware should be scanned on the target, relative Net IDs have to be used: Twin CAT 3 Version: 1.1 7

## Page 8

Introduction 8 Version: 1.1 Twin CAT 3

## Page 9

General description 3 General description The Ams NAT function enables XAE systems to establish routes to two or more controllers having the same Ams Net Id (Figure 2). Beyond that, Ams NAT offers a solution with which different ADS devices with the same Ams Net Id can communicate with one another via ADS. Virtual Ams Net Ids are used with Ams NAT. A virtual Ams Net Id is a unique address for a connected ADS device that is replaced by the real Ams Net Id of the target system during communication. This means that the Ams NAT function ensures, in all communication that takes place via ADS, that the Ams Net Id of the target system is replaced. Fig. 1: Communication with/between Twin CAT systems with the same Net Id Twin CAT 3 Version: 1.1 9

## Page 10

Motivation 4 Motivation A frequently occurring application in series mechanical engineering is the cloning (i.e. the making of a 1:1 copy) of a controller. When using Twin CAT, the result of this is that all cloned instances possess the same Ams Net Id. This is not a problem at first. However, if the cloned instances are to be connected in parallel with the same engineering system or are to communicate with one another by ADS, this is initially impossible because the Ams Net Id is not unique. The Ams NAT function removes precisely this restriction by virtue of the fact that the systems work with virtual Ams Net Ids. These can be configured with very little effort. The Ams NAT function can be used for any route to an ADS device. This provides a high degree of flexibility and the Ams Net Ids no longer have to be adapted to the machine computers, which leads to a significant reduction in time and effort for configuration. 10 Version: 1.1 Twin CAT 3

## Page 11

Functioning 5 Functioning The way Ams NAT functions will now be explained on the bases of a typical application. In the application case, a Twin CAT engineering system and two Twin CAT runtimes exist with the same Amd Net Id and IP address. The configuration is illustrated in Figure 3. The engineering system is to send an Ads Read command to PLC 1, from which a corresponding response is expected. Since both runtimes possess an identical IP address, two IP NATs are additionally used. Their task is to implement unambiguous addressing. In order to do so, the first three positions of the local IP address are replaced by the first three positions of the global IP address or vice versa, depending on the direction of communication. In the first step of the application example, the engineering system sends an Ads Read command to PLC 1. Since this Amd Net Id is a virtual one, the Twin CAT system service replaces it by the remote Ams Net Id 5.19.8.122.1.1 with the help of its routing table. This is the real Ams Net Id existing on the system. It is entered in the field "Ams Net Id Target" of the AMS packet. Fig. 2: Sequence for sending an Ads Read command using Ams NAT The Twin CAT system service of PLC 1 relays the AMS packet unchanged. PLC 1 executes the Ads Read command and then sends the corresponding response to the engineering system. Figure 4 shows the communication sequence for the response. Twin CAT 3 Version: 1.1 11

## Page 12

Functioning Fig. 3: Sequence for sending the response to an Ads Read command For the response, the Twin CAT system service of PLC 1 initially relays the AMS packet unchanged. It subsequently reaches the Twin CAT system service of the engineering system. Since the real Ams Net Id of PLC 1 is entered in the field "Ams Net Id Source" of the AMS packet, it must be replaced by the virtual Ams Net Id on the basis of the routing table. The engineering system can then clearly assign and process the response. When using the Ams NAT function the transmitted data are not changed, only the AMS header. Therefore it should be noted that if configuration data contain the Ams Net Id this can lead to the virtual Ams Net Id being used. One possibility for the engineering of I/O devices is the use of relative Amd Net Ids. In this case the last two characters of the Amd Net Id are taken into account and the first four characters are ignored. 12 Version: 1.1 Twin CAT 3

## Page 13

Configuration 6 Configuration To configure Ams NAT, open the file Static Routes.xml, which is located in the Twin CAT installation directory under the path Twin CAT\3.1\Target. In this file, define the attribute "Remote Net Id" for each route as shown subsequent. <?xml version="1.0" encoding="UTF-8"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:no Namespace Schema Location="http://www.beckhoff.com/schemas/2015/12/Tc Config"> <Remote Connections> <Route> <Name>CX-111111</Name> <Address>10.0.10.8</Address> <Net Id Remote Net Id="5.19.8.122.1.1">10.0.10.8.1.1</Net Id> <Type>TCP_IP</Type> </Route> <Route> <Name>CX-222222</Name> <Address>10.0.20.8</Address> <Net Id Remote Net Id="5.19.8.122.1.1">10.0.20.8.1.1</Net Id> <Type>TCP_IP</Type> </Route> </Remote Connections> </Tc Config> The actual Ams Net Id assigned to the remote ADS device is specified with the attribute "Remote Net Id". It does not have to be unique. Only the Ams Net Id of the target system defined in the field <Net Id> is known in the Twin CAT system with configured Ams NAT function. Restart the Twin CAT system service in order to activate the preset configuration of the Ams NAT function. To do this, switch the Twin CAT system from Run mode to Config mode. If Twin CAT is already in Config mode, reopen this in order to load the settings made. Twin CAT 3 Version: 1.1 13

## Page 15

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
