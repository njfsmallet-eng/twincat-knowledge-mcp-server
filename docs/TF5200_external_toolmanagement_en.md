---
title: "TF5200_external_toolmanagement_en"
product: "TF5200"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.05"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5200_external_toolmanagement_en.pdf"
release_date: "2025-06-10"
---
Functional description | EN TF5200 | Twin CAT 3 CNC External tool management 6/10/2025 | Version: 1.05
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5200 | Twin CAT 3 CNC Version: 1.05 3 External tool management
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 5

Table of contents Table of contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Programming and tool data...................................................................................................................... 9 2.1 Saving tool data.............................................................................................................................. 11 2.2 Access to tool data in the NC program (V. G. WZ..)......................................................................... 13 2.3 Saving tool life parameters.............................................................................................................. 17 2.3.1 Access to tool life parameters.......................................................................................... 19 3 Communication with ext. tool management system (PLC)................................................................. 21 3.1 Tool data (D or #TOOL DATA)........................................................................................................ 21 3.2 Tool change (T or #TOOL PREP)................................................................................................... 24 3.2.1 Initialisation...................................................................................................................... 24 3.2.2 Information to PLC........................................................................................................... 25 3.3 Tool life data.................................................................................................................................... 27 4 Parameter................................................................................................................................................. 29 4.1 Overview......................................................................................................................................... 29 4.2 Description of channel parameters................................................................................................. 30 5 Support and Service............................................................................................................................... 33 Index......................................................................................................................................................... 34 TF5200 | Twin CAT 3 CNC Version: 5 External tool management
## Page 6

Table of contents 6 Version: TF5200 | Twin CAT 3 CNC External tool management
## Page 7

List of figures List of figures Fig. 1 ISG Object Browser – tool life...................................................................................................... 19 Fig. 2 Requesting tool data from the PLC.............................................................................................. 22 Fig. 3 Advance information about tool change to the PLC..................................................................... 25 Fig. 4 Transferring tool life parameters to the PLC................................................................................ 27 TF5200 | Twin CAT 3 CNC Version: 1.05 7 External tool management
## Page 8

Overview 1 Overview Task The external tool management system (WZV) is a database that contains the relevant information about geometry, dynamic data, tool life etc. for each tool in a specific data record. Before a mechanical tool change, this data record is supplied by the tool management system at the request of the CNC. Characteristics External means that the database is integrated outside of the CNC kernel, e.g. in the PLC. The user can manage tool data records via a graphical user interface. Data transfer takes place between the CNC and the PLC if tool data is required in the CNC or if tool life data or changes to tool parameters need to be supplied. Communication between the CNC and the PLC takes place in the CNC asynchronous task. In particular, complete tool data including additional tool parameters are transferred to the CNC (PLC- >CNC). Conversely, every time new tool data is requested, the additional tool parameters and other information about the last active tool are returned to the PLC. These additional tool parameters can be used to transfer data from the NC program to the external tool management system and save them there (CNC->PLC). Parameterisation The presence and use of an external tool management system must be communicated to the CNC via channel parameter P-CHAN-00016. Other properties related to communication with the tool management system can be set by additional parameters (see Section Parameters [} 29]). Programming By default, tool data is requested in the NC program using NC commands T or D (T word, D word). Other NC commands are also provided e.g. #TOOL PREP or #TOOL DATA to permit extended communication with the tool management system. Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. 8 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 9

Programming and tool data 2 Programming and tool data Standard programming By default, tools are identified in the NC program by means of one-part numbers. In conformity with DIN 66025, this numeric ID is programmed with the D command for calculation of new data (calculatory tool change). In conjunction with the T command, the ID defines the next tool that is to be physically changed in. Tool change The T number primarily serves as technological information, i.e. it reaches the interface to the PLC through the NC channel. The T command itself does not initiate a tool change. In conformity with DIN 66025, physical insertion of the new tool in the work spindle is triggered with the machine function M06. Separate specification of the two commands "T with tool number" and M06 can be used to take preparatory measures after the T command, e.g. in the tool magazine (P-CHAN-00087), before the tool is actually physically inserted in the work spindle with M06. External tool administration To calculate new tool data, data must be requested over an additional interface from an (external) user- supplied tool management system (e.g. in the PLC) and must contain the D command. The tool management system has special manufacturer-specific algorithms to define the tool to be changed based on the tool ID. T with D If the corresponding channel-specific parameter is defined (P-CHAN-00014), execution of the D command is also implicitly triggered with the T command. Influence on the NC program run During communication with the tool management system, previous motion blocks may be processed with a delay due to waiting times caused by execution of the T command. This can be avoided by setting the channel parameter P-CHAN-00106. Tool identification (TOOL-ID) In the NC program, every tool is identified by means of a unique number. In the tool management system, tool data is identified by a three-part number referred to below as the tool ID. This is specified in the PLC by the following structure CNC_TOOL_ID: TF5200 | Twin CAT 3 CNC Version: 1.05 9 External tool management
## Page 10

Programming and tool data NC_TOOL_ID structure in the PLC basic DINT; sister : DINT; variant : DINT; sister_valid : BOOL; variant_valid : BOOL; The basic tool number (basic) describes the tool type and the sister tool number (sister) defines an example of this tool type. The variant number (variant) is purely for data processing purposes. Therefore, diverse records can be used for a tool. Tool ID = basic tool no. + sister tool no. + variant number T command and D command The mathematical expressions when specifying T and D commands must always be interpreted as the basic tool number (basic). Therefore, the tool management system still has the same degree of freedom as before when it comes to selecting a tool record. T<basic> or D<basic> #TOOL PREP #TOOL DATA It must be considered that only the tool type is defined in the tool ID sent and that several tools of the same type (sister tools) may be ready for use in the tool magazine. In other words, the T or D command in the NC program may not be able to identify individual tools correctly. This is why, as an alternative, the tool ID can be programmed by means of plaintext commands. The preparatory technology command for a physical tool change in #TOOL PREP corresponds to the T command and the request for new tool data in #TOOL DATA corresponds to the D command. Announcing a tool change (T) #TOOL PREP [<basic> [, <sister> [, <variant> ] ] ] Requesting new tool data (D) #TOOL DATA [<basic> [, <sister> [, <variant> ] ] ] What is essential is to specify the basic tool number (basic). In addition, you can optionally program sister for the sister tool number and variant for the variant. Zero is inserted if sister or variant is not programmed (comma follows comma or close parentheses follows comma). 10 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 11

Programming and tool data Tool description A tool is described for the CNC by the data structure CNC_TOOL_DESC: Excerpt from the structure CNC_TOOL_DESC in PLC (* Variable name Variable type Reference *) tool_id : CNC_TOOL_ID; laenge : DINT; (* P-TOOL-00003 *) radius : DINT; (* P-TOOL-00004 *) ax_versatz : ARRAY [1..32] OF DINT; (* P-TOOL-00006 *) kopf_versatz : ARRAY [1..28] OF DINT; (* P-TOOL-00009 *) mass_einheit : UINT; (* P-TOOL-00008 *) typ : UINT; (* P-TOOL-00001 *) srk_lage : UINT; (* P-TOOL-00002 *) kin_id : UINT; (* P-TOOL-00011 *) log_ax_nr_spdl : UINT; (* P-TOOL-00012 *) tool_fixed : BOOL; (* P-TOOL-00010 *) valid : BOOL; (* P-TOOL-00005 *) res : ARRAY [1..4] OF BYTE; param : ARRAY [1..60] OF LREAL; vb_min : LREAL; (* P-TOOL-00013 *) vb_max : LREAL; (* P-TOOL-00014 *) a_max : LREAL; (* P-TOOL-00015 *) The meanings of individual data items are described in greater detail in [TOOL]. A tool can be described by way of further data which, however, is not needed to request the tool geometry from the CNC and is additionally stored only in the ? PLC. 2.1 Saving tool data Saving tool data In the NC program it is possible to permanently modify certain information for the current tool, i.e. save it after the tool is deselected. This is done using what is known as additional tool parameters (V. G. WZ_AKT. P[i]). For example, these parameters can save wear data or measured values of the currently active tool during program runtime. The data is then written back to the external tool management system and saved there when a new tool record (Dxx) is selected or when a tool is deselected (D0). If an active tool is not deselected by program end and if the channel-specific parameter (P-CHAN-00103) is set accordingly, the data of the last tool used is transferred back implicitly to the external tool management system and written there at the next program start. TF5200 | Twin CAT 3 CNC Version: 1.05 11 External tool management
## Page 12

Programming and tool data T/D number In addition, when a tool record is selected, the T and D numbers of the tool last used are transferred back to the external tool management system. NC program with tool requesting In the example below, various tool data items (life parameters and tool parameters) are written by the CNC and returned to the external tool management system. %ext_wzv.nc N10 X0 Y0 G91 G01 F1000 ;enter wear for T1/D1 V. G. WZ_AKT. P[0] = 123 V. G. WZ_AKT. P[1] = 234 N40 T22 D22 N31 T2 ;-> T2 info N32 D2 ;-> then D2 request N33 D3 T3 ;-> first D3 request and then T3 info N35 X11 N40 #TOOL DATA [4, 1] ;request D in extended syntax N50 #TOOL PREP [4] ;request T in extended syntax N55 X22 ;use application-specific tool parameters G90 XV. G. WZ[3]. P[0] G91 N130 X100 N140 X200 N150 T22 N160 D33 N170 X-100 N180 D0 ;deselect tool geometry M30 12 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 13

Programming and tool data 2.2 Access to tool data in the NC program (V. G. WZ..) V. G. WZ[j]... The “WZ[j]” variables permit read access to the data of any tool. They are both available with an external tool management system (transparent access) and for use of an internal tool table (<j> then corresponds to the index of the tool (or the tool number) in the tool list [5]). Write access is only permitted if an internal tool table is used. WZ[j]. R Radius of the tool Real [mm, inch R/W* ] WZ[j]. L Length of the tool Real [mm, inch R/W* ] WZ[j]. P[i] Tool parameter where <i>: 0 … 59 Real - R/W* WZ[j]. V[i] or WZ[j]. V. X Offset in axis <i> or "X" of the tool where < i>: 0 … Real [mm, inch R/W* 31 ] WZ[j]. ME Measuring unit of radius, length and axis offsets, Boolean 0 , 1 L always supplies 0 (for [mm]) when a tool list is used, otherwise the variable has no significance WZ[j]. OK Validity flag of the tool; Boolean 0 , 1 R/W* if valid, then 1 WZ[j]. SPDL_AX_NR Logical axis number of the assigned spindle Integer - R/W* WZ[j]. KIN_PARAM[i] Kinematic parameters of the tool in internal unit Real [0.1 µm, R/W* where < i>: 0 … 69 10-4°] WZ[j]. KIN_ID Kinematics ID of the tool Integer - R/W* WZ[j]. TYPE Tool type (0: Milling tool 1: Turning tool 2: Grinding Integer - L tool) WZ[j]. SUB_TYPE Tool subcategory assigned by the user. Integer - L [as of V3.01.3081.06 or V3.1.3113.0] WZ[j]. TOOL_FIXED Tool is alignable or fixed Boolean 0 , 1 R/W* WZ[j]. SRK_ID Cutter orientation of a turning tool Integer - R/W* WZ[j]. S_MIN_SPEED Minimum rotational speed (tool dynamic data) Real [rpm] R/W* WZ[j]. S_MAX_SPEED Maximum rotational speed (tool dynamic data) Real [rpm] R/W* WZ[j]. S_MAX_ACC Maximum acceleration (tool dynamic data) Real [°/s2] R/W* WZ[j]. SISTER_VALID Validity flag of sister tool (TOOL ID) Boolean 0 , 1 R/W* WZ[j]. SISTER Number of valid sister tool Integer - R/W* WZ[j]. VARIANT_VALID Validity flag of variant tool (TOOL ID) Boolean 0 , 1 R/W* WZ[j]. VARIANT Number of valid variant tool Integer - R/W* WZ[j]. GOBJECT[i].* Access to the subelements of a specific graphical - - … object [as of Build V3.01.3018.00] where <i>: 0 … 4 WZ[j]. LINKPOINT.* Access to the subelements of associated linkpoints - - ... [as of Build V3.01.3018.00] S*: Write access to data of the internal tool management system as of CNC Build V3.1.3079.08 V. G. WZ_AKT... The variables “WZ_AKT”, “T_AKT” and “D_AKT” permit access to the data of the currently selected tool. These variables are available both for an external tool management system and for the use of an internal tool table. T_AKT Number of the selected tool Integer - L D_AKT Number of the selected tool compensation record Integer - L TF5200 | Twin CAT 3 CNC Version: 1.05 13 External tool management
## Page 14

Programming and tool data A write access always causes the temporary change of tool data as long as this function is selected. When a new tool is selected (Dxx) or deselected (D0), the changed data are lost. Exception: When an external tool management system is used, the so-called additional tool data (V. G. WZ_AKT. P[i]) is adopted and saved when a new tool is selected or a tool is deselected (P- CHAN-00103). WZ_AKT. R Radius of the selected tool Real [mm, inch R/W ] WZ_AKT. L Length of the selected tool Real [mm, inch R/W ] WZ_AKT. P[i] Free parameters of the selected tool where <i>: 0 Real - R/W … 59 WZ_AKT. V[i] or Offset in axis <i> or "X" of the selected tool where < Real [mm, inch R/W WZ_AKT. V. X i>: 0 … 31 ] WZ_AKT. ME Measuring unit of radius, length and axis offsets of Boolean 0 , 1 L the selected tool, always supplies 0 (for [mm]) when a tool list is used, otherwise the variable has no significance WZ_AKT. OK Validity flag of the selected tool; Boolean 0 , 1 R/W* is always 1 since only data of valid tools are adopted. An error message is output if invalid tools are requested WZ_AKT. SPDL_AX_N Logical axis number of the assigned spindle Integer - R/W* R WZ_AKT. KIN_PARAM[ CAUTION: Note on write access: Value must be Real [0.1 µm, R/W i] programmed in internal units. 10-4°] Kinematic parameters of the selected tool where < i>: 0 … 69 WZ_AKT. KIN_ID Kinematic ID of the selected tool Integer - R/W* WZ_AKT. TYPE Tool type of the selected tool Integer - L (0: Milling tool 1: Turning tool 2: Grinding tool) WZ_AKT. SUB_TYPE Tool subcategory assigned by the user. [as of Integer - L V3.01.3081.06 or V3.1.3113.0] WZ_AKT. TOOL_FIXE Tool is alignable or fixed Boolean 0 , 1 R/W D 14 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 15

Programming and tool data WZ_AKT. SRK_ID Cutter orientation of the selected turning tool Integer - R/W* WZ_AKT. S_MIN_SPE Minimum rotational speed (tool dynamic data) Real [rpm] R/W* ED WZ_AKT. S_MAX_SPE Maximum rotational speed (tool dynamic data) Real [rpm] R/W* ED WZ_AKT. S_MAX_ACC Maximum acceleration (tool dynamic data) Real [°/s2] R/W* WZ_AKT. SISTER_VAL Validity flag of sister tool (TOOL ID) Boolean 0 , 1 R/W* ID WZ_AKT. SISTER Number of valid sister tool Integer - R/W* WZ_AKT. VARIANT_V Validity flag of variant tool (TOOL ID) Boolean 0 , 1 R/W* ALID WZ_AKT. VARIANT Number of valid variant tool Integer - R/W* WZ_AKT. WEAR_RADI Total radius wear with radius compensation (OTC) Real [mm, inch L US (sum of discrete + continuous wear) ] WZ_AKT. WEAR_RADI Continuous radius wear with radius compensation Real [mm, inch L US_CONT (OTC) ] WZ_AKT. WEAR[i] or Wear in axis <i> or "X" with length compensation Real [mm, inch L WZ_AKT. WEAR. X (OTC) where < i>: 0 … 31 ] WZ_AKT. WEAR_CON Wear constant (OTC) Real [0.1 µm/ R/W ST m] WZ_AKT. GOBJECT[i]. Access to the subelements of a specific graphic - - - * object (see FCT-C15) [as of V3.01.3018.00] where < i>: 0 … 4 WZ_AKT. LINKPOINT.* Access to the subelements of associated link points - - - (see FCT-C15) [as of V3.01.3018.00] S*: Write access to these current tool data as of CNC Build V3.1.3079.08 As an alternative to V. G. WZ_AKT. P[i], the following variables can also be used to access additional tool parameters. It is only available for an external tool management system: V. G. WZ_INFO[i] Parameters of the selected tool L TF5200 | Twin CAT 3 CNC Version: 1.05 15 External tool management
## Page 16

Programming and tool data NC program with tool requesting In the example below, the CNC replaces various tools and the data is requested by the external tool man- agement system. The request always contains the free tool parameters of the last active tool for return trans- fer of updated values to the PLC. %ext_wzv.nc N10 X0 Y0 G91 G01 F1000 N20 T0 D0;report back free parameters by T<?>D<?> ;with request D0 N30 T1 D1;report back free parameters by T0&D0 ;with request D1 N32 V. G. WZ_AKT. P[0] = 123 N40 T2 N50 T3 N60 T4 N70 D2;report back free parameters by T1&D1 ;with request D2 N080 V. G. WZ_AKT. P[0] = 1 N090 V. G. WZ_AKT. P[1] = 2 N100 V. G. WZ_AKT. P[2] = 3 M30 16 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 17

Programming and tool data 2.3 Saving tool life parameters Service life/service distance When service life values are captured, the contact time (service life) and the distance covered by the tool during contact (service distance) must be calculated. By default, only travel by motion blocks is considered. Positioning by rapid traverse has no effect on service life parameters. The parameter P-CHAN-00255 is used to adapt service life data capture to a specific application, This then includes all motions and rapid traverse motions in service life data capture. At the same time, service life data capture can be suppressed by using the channel-specific bahn_mc_control.tool_life_suppress_capture control unit on the HLI to meet specific user requirements. This permits the complete adaptation of service life data capture to user requirements. After the tool is exchanged, the interpolator displays the data: tool ID, contact time and contact distance. Service life is captured in [s]; service distance is captured in [mm]. Time of storage The complete tool ID, service life and service distance are sent automatically by the CNC to the WZV (tool management system) every time a tool change is announced by the T command and if P-CHAN-00076 is set, By default, service life data is sent to the tool management system even if service distance/service life are set to the value 0. The parameter P-CHAN-00243 suppresses the transfer of service life data when it has the value 0. After service life data is transferred, all parameters are set to 0 in the interpolator. This is followed by service life data capture for the tool that was just replaced. Weighting The NC program can change the weighting of service life values. The changeable factor is used to adapt service life data capture to tool use. Weighting factors The following 2 decoder variables are used to program the weighting factors for service life and service distance (access is not synchronous with real time): TF5200 | Twin CAT 3 CNC Version: 1.05 17 External tool management
## Page 18

Programming and tool data Weighting of service life: V. TLM. TIME_FACT Weighting of service distance: V. TLM. DIST_FACT The variables are readable and writable. Both factors are 100% at program start. Both variables may be written in an NC block. Saving service life parameters A tool that is always in contact should be weighted with a factor of 100%. However, if material is only removed on half the motion path, a weighting factor of 0.5 may be included in the calculation. The default value of the weighting factors for service time and service distance is 1.0. Capture conditions: If the parameter P-CHAN-00255 is not set, all motion types are included in service life data calculation except for rapid traverses. For example, G01, G02, G03, spline interpolation and G63 are included in the service life data calculation. If the parameter P-CHAN-00255 is set, all motion types are included in service life data calculation. Service life data capture is stopped if the feed rate is 0. The weighting factors are included in the calculation. A distinction is not made between main and tracking axes for axes participating in the motion. The path feed rate is always used to add up the distance. If tracking axes are programmed on their own in the block, the path covered by the tracking axis is added to the service distance. If this is not desired, the programmer can correct it by specifying the weighting factors V. TLM. TIME_FACT/DIST_FACT = 0. Active master/slave arrangements are not taken into account. If a reset or program abort occurs, the last current values are also saved to the database of the tool management system. If a tool is exchanged for the first time, i.e. the work spindle was previously empty and the current T number is equal to 0, no data is sent. 18 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 19

Programming and tool data 2.3.1 Access to tool life parameters Tool life time/tool life distance In addition to the possibility of sending tool life data by an NC command to the tool management system (#TOOL LIFE READ), tool life data also can be evaluated online by CNC objects. The factors for tool life weighting (cf V. TLM. TIME_FACT, V. TLM. DIST_FACT) can also be changed. Display of tool life parameters in the ISG Object Browser Fig. 1: ISG Object Browser – tool life CNC objects for tool life data detection Name tool life : distance Description This CNC object specifies the tool life of the currently active tool. Task GEO (Port 551) Index group 0x12130<C > Index offset 0x1E ID Data type REAL64 Length/byte 8 Attributes read Unit [mm] Remarks Name tool life : distance factor Description This CNC object defines and reads the life distance weighting. Task GEO (Port 551) Index group 0x12130<C > Index offset 0x20 ID Data type REAL64 Length/byte 8 Attributes read/ write Unit [s] Remarks Name tool life : time Description This CNC object specifies the tool life time of the currently active tool. Task GEO (Port 551) Index group 0x12130<C > Index offset 0x1D ID Data type REAL64 Length/byte 8 Attributes read Unit [s] Remarks Name tool life : time factor Description This CNC object defines and reads the tool life time weighting. TF5200 | Twin CAT 3 CNC Version: 1.05 19 External tool management
## Page 20

Programming and tool data Task GEO (Port 551) Index group 0x12130<C > Index offset 0x1F ID Data type REAL64 Length/byte 8 Attributes read/ write Unit [-] Remarks Range [0;1] Name tool life : tool id Description This CNC object reads the index of the current tool for tool life time detection. Task GEO (Port 551) Index group 0x12130<C > Index offset 0x1C ID Data type UNS32 Length/byte 4 Attributes read Unit [-] Remarks 20 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 21

Communication with ext. tool management system (PLC) 3 Communication with ext. tool management system (PLC) CNC channel identification Every request contains a unique job number. On a multichannel CNC machine, the channel number [1; max ] of the CNC channel which initiated the request is encoded. The response must always contain the job number. This unique job number is also referred to as “invoke id” (ADSRDWRTIND. INVOKEID, 32 bits). 3.1 Tool data (D or #TOOL DATA) Tool geometry With every D<i> or #TOOL DATA the CNC requests tool data during NC program decoding. When the new tool is requested, the D number, T number and the freely usable P parameter of the currently replaced tool are also included. This permits the PLC to detect which tool is to be replaced. Wear can be entered in the NC program by the P parameter, for example, and can be returned to the PLC in the tool change. The following data (CNC_TOOL_REQUEST_IN) is transferred in the request from the CNC to the PLC: id: CNC_TOOL_ID; (tool id of requested tool) act_t_nr : DINT; (actual t number in nc kernel) act_d_nr : CNC_TOOL_ID; (actual tool id in nc kernel) param : ARRAY[1..60] OF LREAL; log_ax_nr_tool_length: UINT; (spindle axis for tool length compensation) The PLC returns the complete tool record (CNC_TOOL_DESC). TF5200 | Twin CAT 3 CNC Version: 1.05 21 External tool management
## Page 22

Communication with ext. tool management system (PLC) CNC PLC CNC_TOOL_REQUEST_IN lookup tool CNC_TOOL_DESC Fig. 2: Requesting tool data from the PLC Tool manager in the PLC program Tool data RInd: ADSRDWRTIND; RRes : ADSRDWRTRES; Rind; IF RInd. VALID THEN (* initialise response *) RRes. NETID := ''; RRes. PORT := RInd. PORT; RRes. INVOKEID := RInd. INVOKEID; (* sender channel no. is coded in the invoke id *) cnc_channel_nr := RInd. INVOKEID; cnc_channel_nr := cnc_channel_nr AND 16#00FFFFFF; (* CNC requests tool geometry data due to D<i> *) IF RInd. IDXGRP = ADS_IGRP_TOOL_DESC_READ THEN (* Tool data request from CNC *) p Tool Req := RInd. DATAADDR; Basic Tool Id := p Tool Req^.id.basic; Spindle ID:= p Tool Req^.log_ax_nr_tool_length; IF Basic Tool Id <= MAX_TOOLS THEN (* transmit tool data in the response *) RRes. LEN := SIZEOF(tool[1].cnc.tool_desc); RRes. DATAADDR := ADR(tool[Basic Tool Id].cnc.tool_desc); RRes. RESULT := ADS_RDWRT_IND_NO_ERROR; ELSE (* Tool not present *) RRes. LEN := 0; RRes. DATAADDR := 0; RRes. RESULT := WZV_TOOL_ID_BASIC_INVALID; END_IF 22 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 23

Communication with ext. tool management system (PLC) Tool request %main N10 X1200 N11 S2[D1] (request tool D1 for spindle S2 N20 S2[D2 REV=1 M4] (request tool D2 for spindle S2 N30 D3 S100 M3 (request tool D3 for spindle S N40 X0 N50 M30 TF5200 | Twin CAT 3 CNC Version: 1.05 23 External tool management
## Page 24

Communication with ext. tool management system (PLC) 3.2 Tool change (T or #TOOL PREP) 3.2.1 Initialisation Data format There is often a real tool in the spindle when the control unit is restarted. The PLC has the option of directly communicating this tool to the CNC. The number of this tool can be read in the NC program by the variable V. G. T_AKT and can then be used in the NC channel for the correct selection of the real tool. PLC view b Write: BOOL := FALSE; Tool Write : ADSWRITE; Tool No: DINT := 4711; IF b Write = TRUE THEN b Write := FALSE; Tool Write(Write := FALSE); Tool Write. NETID := ''; Tool Write. PORT := ADS_PORT_TASK_SDA; Tool Write. IDXGRP := ADS_IGRP_DECODER_OF_CHANNEL + 1; Tool Write. IDXOFFS := ADS_IOFFS_ACTUAL_T_NUMBER; Tool Write. Src Addr := ADR(Tool Nr); Tool Write. LEN := SIZEOF(Tool Nr); Tool Write(Write := TRUE); END_IF Tool Write(); 24 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 25

Communication with ext. tool management system (PLC) 3.2.2 Information to PLC Tool change With every programmed T<i> or #TOOL PREP, the CNC communicates the tool number to the PLC during NC program decoding, provided this function is activated in the channel parameter list (P-CHAN-00087). This advance information can be used by the external tool management system to prepare a tool change (cleaning the tool, turning the disk changer, etc.) to save time. The following data (CNC_TOOL_ID) is transferred in the request from the CNC to the PLC; the T number is entered in the basic element: basic : DINT; sister : DINT; variant : DINT; sister_valid : BOOL; variant_valid : BOOL; The PLC must acknowledge receipt by returning the identical message. CNC PLC CNC_TOOL_ID prepare tool exchange acknowledge (CNC_TOOL_ID) Fig. 3: Advance information about tool change to the PLC TF5200 | Twin CAT 3 CNC Version: 1.05 25 External tool management
## Page 26

Communication with ext. tool management system (PLC) Tool manager in the PLC program Tool information ... (* CNC communicates tool change T<i> (during program decoding) *) ELSIF RInd. IDXGRP = ADS_IGRP_TOOL_INFO_WRITE THEN (* CNC writes tool life data *) p Tid := RInd. DATAADDR; Basic Tool Id := p Tid^.basic; IF Basic Tool Id <= MAX_TOOLS THEN (* save actual requested tool T<nr> *) (* Tool id in valid range *) RRes. LEN := SIZEOF(p Tid^); RRes. DATAADDR := p Tid; RRes. RESULT := ADS_RDWRT_IND_NO_ERROR; ELSE (* no data transmitted in the response *) RRes. LEN := 0; RRes. DATAADDR := 0; RRes. RESULT := WZV_TOOL_ID_BASIC_INVALID; END_IF ELSE 26 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 27

Communication with ext. tool management system (PLC) 3.3 Tool life data Tool life time, tool life distance With every programmed T<i> or #TOOL PREP and if P-CHAN-00076 is set, the complete tool ID, tool life time and tool life distance are sent automatically by the CNC to the PLC. The transferred data can be saved and further processed in the PLC. The PLC must acknowledge receipt by returning a blank message. The following data is transferred by the CNC to the PLC: CNC_TOOL_DATA_IN (Tool life data sent from CNC) tool_id : CNC_TOOL_ID; (Tool id from CNC) time_used : LREAL; (Usage time of tool in seconds) dist_used : LREAL; (Usage distance in mm) CNC PLC (external tool management) CNC_TOOL_DATA_IN save new tool life data acknowledge, <empty> Fig. 4: Transferring tool life parameters to the PLC TF5200 | Twin CAT 3 CNC Version: 1.05 27 External tool management
## Page 28

Communication with ext. tool management system (PLC) Tool manager in the PLC program ... (* CNC updates tool life data after selecting a different tool T<i> *) ELSIF RInd. IDXGRP = ADS_IGRP_TOOL_LIFE_DATA_WRITE THEN (* CNC writes tool life data *) p Tool Life := RInd. DATAADDR; Basic Tool Id := p Tool Life^.tool_id.basic; (* no data transmitted in the response *) RRes. LEN := 0; RRes. DATAADDR := 0; IF Basic Tool Id <= MAX_TOOLS THEN (* update tool life data *) tool[Basic Tool Id].cnc.tool_life.dist_used := tool[Basic Tool Id].cnc.tool_life.dist_used + p Tool Life^.dist_used; tool[Basic Tool Id].cnc.tool_life.time_used := tool[Basic Tool Id].cnc.tool_life.time_used + p Tool Life^.time_used; (* Check validity of response*) RRes. RESULT := ADS_RDWRT_IND_NO_ERROR; ELSE RRes. RESULT := WZV_TOOL_ID_BASIC_INVALID; END_IF 28 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 29

Parameter 4 Parameter Parameterisation The user can configure communication between the CNC and the external tool management system by making settings in the channel parameter list CHAN]. NOTICE The parameters are set for specific channels. The settings can be made in the default list if they affect all channels. 4.1 Overview ID Parameter Description P-CHAN-00014 einrechnen_mit_t Implicit execution of the D command in the event of T programming P-CHAN-00016 ext_wzv_vorhanden External tool administration available in the system P-CHAN-00076 tool_life_to_wzv Send tool life quantities of a tool to the tool administration P-CHAN-00087 t_info_to_wzv Prepare a tool change in the magazine P-CHAN-00103 d_clear_to_wzv Save tool data on program start P-CHAN-00106 t_with_implicit_flush Release motion blocks when T is selected. P-CHAN-00255 tool_life_capture_all_m Record all movements for tool life recording. ovements P-CHAN-00243 tool_life_to_wzv_suppr Suppress output of tool life data parameters 0. ess_zero ID Parameter Description P-CHAN-00014 einrechnen_mit_t Implicit execution of the D command in the event of T programming P-CHAN-00016 ext_wzv_vorhanden External tool administration available in the system P-CHAN-00087 t_info_to_wzv Prepare a tool change in the magazine P-CHAN-00106 t_with_implicit_flush Release motion blocks when T is selected. TF5200 | Twin CAT 3 CNC Version: 1.05 29 External tool management
## Page 30

Parameter 4.2 Description of channel parameters P-CHAN-00014 Implicit execution of D word with T Description If a T command is programmed, the D command is implicitly executed with the same number as the T command. This mechanism can be selected both for a list-based internal and for an external tool management. This parameter has no effect on the programming of #TOOL PREP (corresponds to the T command). Afterwards, a #TOOL DATA must always be programmed. Parameter einrechnen_mit_t Data type BOOLEAN Data range 0/1 Dimension ---- Default value 0 Remarks Parameterisation example: The parameter 'einrechnen_mit_t' is assigned the value 1. The programming of 'T80' then corresponds to the programming command 'T80 D80'. einrechnen_mit_t 1 P-CHAN-00016 Tool data is requested from an external tool management Description If the system works with external tool management (e.g. integrated in PLC), this parameter is set to 1. Parameter ext_wzv_vorhanden Data type BOOLEAN Data range 0/1 Dimension ---- Default value 0 Remarks Parameterisation example: The system works with an external tool management. ext_wzv_vorhanden 1 P-CHAN-00076 Send tool life data to external tool management Description If an external tool management system is used, only tool data are requested from it by default. This parameter must also be set to send the tool life data of a tool determined in the NC kernel to the external tool management. Parameter tool_life_to_wzv Data type BOOLEAN Data range 0/1 Dimension ---- Default value 0 Remarks P-CHAN-00087 Information of the external tool management in case of a T function Description Programming a T function generates a message which is sent to the external tool management to prepare the magazine for a tool change. Assignment is only executed if an external tool management is used ((P-CHAN-00016). Parameter t_info_to_wzv Data type BOOLEAN Data range 0/1 Dimension ---- Default value 0 Remarks Parameterisation example: If a T function is programmed, the external tool management prepares a tool change. 30 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 31

Parameter t_info_to_wzv 1 P-CHAN-00103 Save and delete tool data in an external tool management Description Tool data of the current tool (e.g. wear parameters) can be modified via variable access (V. G. WZ_AKT...) in the NC program. For saving, this data is written back to external tool management each time a new tool is selected. If a tool was programmed in the previous NC program, D0 (tool deselection) is implicitly requested at Program restart. With this request the data of the tool last used is transmitted back at the same time to external tool management. This ensures that no modified tool data is lost. This saving by implicitly initiating a D0 at program start can be achieved by setting the parameter to 1. The assignment only makes sense if an external tool management function is used (P-CHAN-00016). Parameter d_clear_to_wzv Data type BOOLEAN Data range 0/1 Dimension ---- Default value 0 Remarks On reset, no implicit D0 is initiated. This means that the data of the tool last used is only saved on the next program start. P-CHAN-00106 Enabling motion blocks during T selection Description By setting the parameter to 1, all motion blocks up to the T word are executed. This is an implicit '#FLUSH CONTINUE’ initiated by the T word[PROG// Flushing NC channel]. Assignment only makes sense if an external tool management is used (P-CHAN-00016). Parameter t_with_implicit_flush Data type BOOLEAN Data range 0/1 Dimension ---- Default value 0 Remarks P-CHAN-00255 Tool life data recording for rapid traverse motions Description With tool life data recording, no rapid traverse motions G00 are recorded by default. This parameter achieves that rapid traverse motions are also considered for tool life data recording. Parameter tool_life_capture_all_movements Data type BOOLEAN Data range 0: Rapid traverse motions G00 are not included in tool life data recording (default). 1: Rapid traverse motions G00 are also included in tool life data recording. Dimension ---- Default value 0 Remarks P-CHAN-00243 Suppress output of tool life parameters 0 Description When parameter P-CHAN-00076 is set, the tool life data is sent to the external tool management on every tool change, even if this is zero. This parameter can be set if no tool life data is sent in the event that service distance and service life = zero . Parameter tool_life_to_wzv_suppress_zero Data type BOOLEAN Data range 0/1 TF5200 | Twin CAT 3 CNC Version: 1.05 31 External tool management
## Page 32

Parameter Dimension ---- Default value 0 Remarks This parameter is available as of CNC Build V2.11.2802.00 and higher. 32 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 33

Support and Service 5 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF5200 | Twin CAT 3 CNC Version: 1.05 33 External tool management
## Page 34

Index Index P P-CHAN-00014 30 P-CHAN-00016 30 P-CHAN-00076 30 P-CHAN-00087 30 P-CHAN-00103 31 P-CHAN-00106 31 P-CHAN-00243 31 P-CHAN-00255 31 34 Version: 1.05 TF5200 | Twin CAT 3 CNC External tool management
## Page 36

More Information: www.beckhoff.com/TF5200 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
