---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.7.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_EnOcean_EN.pdf"
release_date: "2025-05-15"
---
Manual | EN TE1000 Twin CAT 3 | PLC Libary: Tc2_En Ocean 2025-05-15 | Version: 1.7.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 En Ocean®................................................................................................................................................... 9 3.1 Range planning................................................................................................................................. 9 3.2 Approval of En Ocean® radio technology......................................................................................... 10 4 Programming........................................................................................................................................... 11 4.1 POUs............................................................................................................................................... 12 4.1.1 KL6021-0023.................................................................................................................... 13 4.1.2 KL6581............................................................................................................................. 23 4.2 DUTs............................................................................................................................................... 37 4.2.1 KL6021-0023.................................................................................................................... 38 4.2.2 KL6581............................................................................................................................. 40 4.3 Integration into Twin CAT................................................................................................................. 46 4.3.1 KL6581 with CX5120....................................................................................................... 46 5 Appendix.................................................................................................................................................. 49 5.1 Support and Service........................................................................................................................ 49 TE1000 Version: 1.7.0 3
## Page 4

Table of contents 4 Version: 1.7.0 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1000 Version: 1.7.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.7.0 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.7.0 7
## Page 8

Introduction 2 Introduction The Tc2_En Ocean library is a Twin CAT PLC library for data exchange with En Ocean® devices. The library should only be used in conjunction with a KL6021-0023 or KL6581. The user of this library requires basic knowledge of the following: • Twin CAT XAE • PC and network knowledge • structure and properties of the Beckhoff Embedded PC and its Bus Terminal system • technology of En Ocean® devices • relevant safety regulations for technical building equipment This software library is intended for building automation system partners of Beckhoff Automation Gmb H & Co. KG. The system partners operate in the field of building automation and are concerned with the installation, commissioning, expansion, maintenance and servicing of measurement, control, and regulating systems for the technical equipment of buildings. The Tc2_En Ocean library is usable on all hardware platforms that support Twin CAT 3.1 or higher. Hardware documentation for KL6021-0023 and KL6581 in the Beckhoff Information System. 8 Version: 1.7.0 TE1000
## Page 9

En Ocean® 3 En Ocean® The En Ocean® radio technology makes a far-reaching signal with low quantities of ambient energy possible. With 50 µWs, a standard En Ocean® radio module can easily transmit a signal over a distance of 300 m (in the free field). The signal period for an En Ocean® telegram is approx. 1 thousandth of second. • License-free 868 MHz frequency band with 1% duty cycle • Multiple telegram transmission with checksum • Short telegrams (approx. 1 ms) lead to a small probability of collision • Long range: 30 m indoors or 300 m outdoors • Repeater available for extensions • Unidirectional and bidirectional communication • High data transmission rates of 125 kbit/s • Low "data overhead" • ASK modulation • Radio protocol is defined and integrated in modules • Sensor profiles specified and adhered to by users • Unique transmission ID (32-bit) • No interference with DECT, WLAN, PMR systems etc. • System design verified in industrial environment Protocol structure Protocol Description Length ORG Telegram type 1 byte DB_3 Data byte 3 1 byte DB_2 Data byte 2 1 byte DB_1 Data byte 1 1 byte DB_0 Data byte 0 1 byte ID_3 Transmitter ID byte 3 1 byte ID_2 Transmitter ID byte 2 1 byte ID_1 Transmitter ID byte 1 1 byte ID_0 Transmitter ID byte 0 1 byte STATUS Information status 1 byte 3.1 Range planning Please follow the recommendations of the En Ocean® Alliance (see www.enocean.org) when placing the En Ocean® devices. Adherence to the recommendations supports optimum range and immunity to interference. Attenuation of different materials Material Attenuation Wood, plaster, uncoated glass (without metal) 0...10 % Brick, chipboard 5...35 % Concrete with iron reinforcement 10...90 % Metal, aluminum cladding 90..100 % TE1000 Version: 1.7.0 9
## Page 10

En Ocean® Range Material Range Line of sight Typically 30 m in corridors, up to 100 m in halls Plasterboard walls/wood Typically 30 m, through max. 5 walls Brick walls/aerated concrete Typically 20 m, through max. 3 walls Reinforced concrete walls/ceilings Typically 10 m, through max. 1 wall/ceiling Placement of the KL6583 module The KL6583 module contains transmitter, receiver and antenna. Distances The distance to a reinforced concrete ceiling should be at least 50 cm and to a wall 10 cm. Do not attach or screw the KL6583 module to a metal plate! Environmental conditions Furthermore, the environmental conditions are to be adhered to: • Maximum air humidity 95% without condensation • Ambient temperature 0 - 55°C 3.2 Approval of En Ocean® radio technology Check that operation is permitted in your country The En Ocean® transceivers KL6583 can be operated free of registration and fees in the following countries: KL6583-0000: European Union and Switzerland KL6583-0100: USA and Canada Permission for use in other countries must be clarified explicitly! KL6583-0100 for USA and Canada Contains IC: 5731A-TCM320C Contains FCC ID: SZV-TCM320C This device complies with Part 15 of the FCC Rules. Operation is subject to the following conditions: • this device must not cause adverse interference, and • this device must absorb all received interference, including interference that would impair the operation. 10 Version: 1.7.0 TE1000
## Page 11

Programming 4 Programming POUs/KL6021-0023 POUs Description FB_En Ocean Receive [} 14] Communication with KL6021-0023 POUs/KL6021-0023/Read POUs Description FB_En Ocean PTM100 [} 15] Receives the signals of a PTM100 module FB_En Ocean PTM200 [} 17] Receives the signals of a PTM200 module FB_En Ocean STM100 [} 18] Receives the signals of a STM100 module (obsolete) FB_En Ocean STM100Generic [} 20] Receives the signals of a STM100 module FB_En Ocean STM250 [} 22] Receives the signals of a STM250 module POUs/KL6581 Function blocks Description FB_KL6581 [} 23] Communication with a KL6581 POUs/KL6581/Read Function blocks Description FB_Rec_Generic [} 25] Receives all types of En Ocean® telegrams FB_Rec_1BS [} 26] Receives data with ORG telegram 6. Typical En Ocean® device: window contact FB_Rec_RPS_Switch [} 27] Receives data with ORG telegram 5. Typical En Ocean® device: switch FB_Rec_RPS_Window_Handle [} 27] Receives data with ORG telegram 5. Typical En Ocean® device: window handle POUs/KL6581/Send Function blocks Description FB_Send_Generic [} 28] Sends any En Ocean® telegrams- FB_Send_4BS [} 29] Sends En Ocean® telegrams in 4BS format- FB_Send_RPS_Switch [} 30] Sends En Ocean® telegrams in the format of a switch. FB_Send_RPS_Switch Auto [} 31] Sends En Ocean® telegrams in the format of a switch. POUs/KL6581/Other Function blocks Description FB_En Ocean_Search [} 32] This function block recognizes all En Ocean® devices within its range and displays them. FB_Rec_Teach_In [} 33] This function block indicates if the LRN bit in an En Ocean® telegram is set, independent of its En Ocean® ID. FB_Rec_Teach_In_Ex [} 34] This function block indicates when the Learn button is pressed on an En Ocean® device. TE1000 Version: 1.7.0 11
## Page 12

Programming POUs/KL6581/Function Function blocks Description F_Byte_To_Temp [} 35] This function converts a byte raw value into a REAL variable. F_Byte_To_Turn Switch [} 36] This function converts a raw byte value to a Boolean array. DUTs/KL6021-0023/Hardware Types Data types Description ST_En Ocean In Data [} 39] Process image of the KL6021-0023 inputs ST_En Ocean Out Data [} 40] Process image of the KL6021-0023 outputs DUTs/KL6021-0023 Data types Description E_En Ocean Rotary Switch [} 38] State of the rotary-switch on the transmitting-module E_En Ocean Sensor Type [} 38] Sensor type ST_En Ocean Received Data [} 39] Internal structure DUTs/KL6581/hardware types Data types Description KL6581_Input [} 41] Process image of the KL6581 inputs KL6581_Output [} 42] Process image of the KL6581 outputs DUTs/KL6581 Data types Description AR_En Ocean Window [} 43] State of the window E_ENOCEAN_Org [} 40] Type of En Ocean® telegram E_KL6581_Err [} 41] Error messages STR_En Ocean Switch [} 43] State of the switches STR_KL6581 [} 44] Internal structure STR_Teach_In [} 45] Data structure manufacturer ID, type and profile STREn Ocean Turn Switch [} 45] Position of the rotary switch at the room control unit 4.1 POUs KL6021-0023 POUs Description FB_En Ocean Receive [} 14] Communication with KL6021-0023 KL6021-0023/Read POUs Description FB_En Ocean PTM100 [} 15] Receives the signals of a PTM100 module FB_En Ocean PTM200 [} 17] Receives the signals of a PTM200 module FB_En Ocean STM100 [} 18] Receives the signals of a STM100 module (obsolete) FB_En Ocean STM100Generic [} 20] Receives the signals of a STM100 module 12 Version: 1.7.0 TE1000
## Page 13

Programming POUs Description FB_En Ocean STM250 [} 22] Receives the signals of a STM250 module KL6581 POUs Description FB_KL6581 [} 23] Main block for the communication with the KL6581 and the connected KL6583 modules KL6581/Read Function blocks Description FB_Rec_Generic [} 25] Receives all types of En Ocean® telegrams. FB_Rec_1BS [} 26] Receives data with ORG telegram 6. Typical En Ocean® device: window contact FB_Rec_RPS_Switch [} 27] Receives data with ORG telegram 5. Typical En Ocean® device: switch FB_Rec_RPS_Window_Handle [} 27] Receives data with ORG telegram 5. Typical En Ocean® device: window handle KL6581/Send Function blocks Description FB_Send_Generic [} 28] Sends any En Ocean® telegrams. FB_Send_4BS [} 29] Sends En Ocean® telegrams in 4BS format. FB_Send_RPS_Switch [} 30] Sends En Ocean® telegrams in the format of a switch. FB_Send_RPS_Switch Auto [} 31] Sends En Ocean® telegrams in the format of a switch. KL6581/Other Function blocks Description FB_En Ocean_Search [} 32] This function block recognizes all En Ocean® devices within its range and displays them. FB_Rec_Teach_In [} 33] This function block indicates if the LRN bit in an En Ocean® telegram is set, independent of its En Ocean® ID. FB_Rec_Teach_In_Ex [} 34] This function block indicates when the Learn button is pressed on an En Ocean® device. KL6581/Function Function blocks Description F_Byte_To_Temp [} 35] This function converts a byte raw value into a REAL variable. F_Byte_To_Turn Switch [} 36] This function converts a raw byte value to a Boolean array. 4.1.1 KL6021-0023 Function blocks Description FB_En Ocean Receive [} 14] Communication with a KL6021-0023 TE1000 Version: 1.7.0 13
## Page 14

Programming Read Function blocks Description FB_En Ocean PTM100 [} 15] Receives the signals of a PTM100 module FB_En Ocean PTM200 [} 17] Receives the signals of a PTM200 module FB_En Ocean STM100 [} 18] Receives the signals of a STM100 module (outdated) FB_En Ocean STM100Generic [} 20] Receives the signals of a STM100 module FB_En Ocean STM250 [} 22] Receives the signals of a STM250 module 4.1.1.1 FB_En Ocean Receive The function block FB_En Ocean Receive() is a receive block, which makes the telegrams sent by the En Ocean® modules available in the structure st En Ocean Received Data. This structure can then be analyzed with further function blocks. The documentation for this function blocks also includes sample programs, which illustrate the operating principle. Inputs VAR_INPUT b Enable : BOOL := FALSE; END_VAR Name Type Description b Enable BOOL A positive signal at this input activates the function block. A negative signal at the input disables the function block functionality. Inputs/outputs VAR_IN_OUT st En Ocean In Data : ST_En Ocean In Data; st En Ocean Out Data : ST_En Ocean Out Data; END_VAR Name Type Description st En Ocean In Data ST_En Ocean In Data [} 39] Is linked to the input addresses of the KL6021-0023 in the System Manager. st En Ocean Out Data ST_En Ocean Out Data Is linked to the output addresses of the KL6021-0023 in the System Manager. [} 40] Outputs VAR_OUTPUT b Error : BOOL := FALSE; n Error Id : UDINT := 0; st En Ocean Received Data : ST_En Ocean Received Data; END_VAR Name Type Description b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the variable n Error ID. n Error Id UDINT Describes the type of error [} 23]. st En Ocean Received ST_En Ocean Received Data The received data is stored in this structure. Data [} 39] 14 Version: 1.7.0 TE1000
## Page 15

Programming Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.1.2 Read Function blocks Description FB_En Ocean PTM100 [} 15] Receives the signals of a PTM100 module FB_En Ocean PTM200 [} 17] Receives the signals of a PTM200 module FB_En Ocean STM100 [} 18] Receives the signals of a STM100 module (outdated) FB_En Ocean STM100Generic [} 20] Receives the signals of a STM100 module FB_En Ocean STM250 [} 22] Receives the signals of a STM250 module 4.1.1.2.1 FB_En Ocean PTM100 The function block FB_En Ocean PTM100() provides a user-friendly evaluation of the state of an En Ocean® PTM100 module. The function block FB_En Ocean Receive() [} 14] is required for this purpose. In contrast to the PTM200 and PTM250 modules, only one switch at a time can be pressed in the PTM100 module. In addition, the PTM100 module supports eight switches, not four. A new instance of this function block must be created for each switch module used. Inputs VAR_INPUT b Enable : BOOL := FALSE; t Watchdog : TIME; n Transmitter Id : UDINT; st En Ocean Received Data : ST_En Ocean Received Data; END_VAR Name Type Description b Enable BOOL A positive signal at this input enables the function block. A negative signal at the input disables the function block functionality, and all outputs are set to 0 or FALSE. t Watchdog TIME Monitoring time. Within this time, new information must reach this function block via the input st En Ocean Received Data described below. If this time is set to t#0s, the watchdog function is inactive. n Transmitter Id UDINT ID of the En Ocean® module, to which the function block should respond. st En Ocean Received ST_En Ocean Received Data Information and required connection to the En Ocean® Data [} 39] receive function block FB_En Ocean Receive() [} 14]. This information is stored in a structure. TE1000 Version: 1.7.0 15
## Page 16

Programming Outputs VAR_OUTPUT b Switches : ARRAY [0..7] OF BOOL; b Error : BOOL := FALSE; n Error Id : UDINT := 0; END_VAR Name Type Description b Switches ARRAY OF BOOL This field of 8 Boolean values describes the states of the 8 push buttons on the push button module. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the variable n Error ID. n Error Id UDINT Describes the type of error [} 23]. The following sample program illustrates the operating principle of this function block: PROGRAM MAIN VAR fb En Ocean Receive : FB_En Ocean Receive; fb En Ocean PTM100_1 : FB_En Ocean PTM100; fb En Ocean PTM100_2 : FB_En Ocean PTM100; b Switches1 : ARRAY [0..7] OF BOOL; b Switches2_1 : BOOL; b Switches2_2 : BOOL; b Switches2_3 : BOOL; b Switches2_4 : BOOL; b Switches2_5 : BOOL; b Switches2_6 : BOOL; b Switches2_7 : BOOL; b Switches2_8 : BOOL; END_VAR fb En Ocean Receive( b Enable := TRUE, st En Ocean In Data := st En Ocean In Data, st En Ocean Out Data := st En Ocean Out Data); fb En Ocean PTM100_1( b Enable := NOT fb En Ocean Receive.b Error AND fb En Ocean Receive.b Enable, n Transmitter Id := 16#000000C4, t Watchdog:=t#0s, st En Ocean Received Data := fb En Ocean Receive.st En Ocean Received Data); b Switches1 := fb En Ocean PTM100_1.b Switches; fb En Ocean PTM100_2( b Enable := NOT fb En Ocean Receive.b Error AND fb En Ocean Receive.b Enable, n Transmitter Id := 16#000000C5, t Watchdog:=t#0s, st En Ocean Received Data := fb En Ocean Receive.st En Ocean Received Data); b Switches2_1 := fb En Ocean PTM100_2.b Switches[0]; b Switches2_3 := fb En Ocean PTM100_2.b Switches[1]; b Switches2_6 := fb En Ocean PTM100_2.b Switches[2]; b Switches2_5 := fb En Ocean PTM100_2.b Switches[3]; b Switches2_8 := fb En Ocean PTM100_2.b Switches[4]; b Switches2_2 := fb En Ocean PTM100_2.b Switches[5]; b Switches2_7 := fb En Ocean PTM100_2.b Switches[6]; b Switches2_4 := fb En Ocean PTM100_2.b Switches[7]; In this sample program two transmitter modules (PTM100) are queried: a transmitter module with the transmitter ID 16#C4 and another module with the transmitter ID 16#C5. A function block FB_En Ocean PTM100 is created for each of the two transmitter modules. Both function blocks obtain their information from the upstream receive function block FB_En Ocean Receive and are only active (input b Enable) if the receive function block is active and not in error. The push buttons of the first transmitter module are assigned to a Boolean array b Switches1 for further analysis, while the push buttons of the second transmitter module are assigned to individual Boolean variables b Switches2_1 to b Switches2_8; both options are conceivable. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 16 Version: 1.7.0 TE1000
## Page 17

Programming 4.1.1.2.2 FB_En Ocean PTM200 The function block FB_En Ocean PTM200() provides a user-friendly evaluation of the state of an En Ocean® PTM200 or PTM250 module. The function block FB_En Ocean Receive() [} 14] is required for this purpose. In contrast to the PTM100 module, the PTM200 and PTM250 modules allow up to two switches to be pressed simultaneously. In addition, the PTM200 and PTM250 modules support four instead of eight switches. A new instance of this function block must be created for each switch module used. Inputs VAR_INPUT b Enable : BOOL := FALSE; t Watchdog : TIME; n Transmitter Id : UDINT; st En Ocean Received Data : ST_En Ocean Received Data; END_VAR Name Type Description b Enable BOOL A positive signal at this input enables the function block. A negative signal at the input disables the function block functionality, and all outputs are set to 0 or FALSE. t Watchdog TIME Monitoring time. Within this time, new information must reach this function block via the input st En Ocean Received Data described below. If this time is set to t#0s, the watchdog function is inactive. n Transmitter Id UDINT ID of the En Ocean® module, to which the function block should respond. st En Ocean Received ST_En Ocean Received Data Information and required connection to the En Ocean® Data [} 39] receive function block FB_En Ocean Receive() [} 14]. This information is stored in a structure. Outputs VAR_OUTPUT b Switches : ARRAY [0..3] OF BOOL; b Error : BOOL := FALSE; n Error Id : UDINT := 0; END_VAR Name Type Description b Switches ARRAY OF BOOL This field of 4 Boolean values describes the states of the 4 push buttons on the push button module. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the variable n Error ID. n Error Id UDINT Describes the type of error [} 23]. The following sample program illustrates the operating principle of this function block: PROGRAM MAIN VAR fb En Ocean Receive : FB_En Ocean Receive; fb En Ocean PTM100_1 : FB_En Ocean PTM200; TE1000 Version: 1.7.0 17
## Page 18

Programming fb En Ocean PTM100_2 : FB_En Ocean PTM200; b Switches1 : ARRAY [0..3] OF BOOL; b Switches2_1 : BOOL; b Switches2_2 : BOOL; b Switches2_3 : BOOL; b Switches2_4 : BOOL; END_VAR fb En Ocean Receive( b Enable := TRUE, st En Ocean In Data := st En Ocean In Data st En Ocean Out Data := st En Ocean Out Data); fb En Ocean PTM200_1( b Enable := NOT fb En Ocean Receive.b Error AND fb En Ocean Receive.b Enable, n Transmitter Id := 16#000000C6, t Watchdog:=t#0s, st En Ocean Received Data := fb En Ocean Receive.st En Ocean Received Data); b Switches1 := fb En Ocean PTM200_1.b Switches; fb En Ocean PTM200_2( b Enable := NOT fb En Ocean Receive.b Error AND fb En Ocean Receive.b Enable, n Transmitter Id := 16#000000C7, t Watchdog:=t#0s, st En Ocean Received Data := fb En Ocean Receive.st En Ocean Received Data); b Switches2_1 := fb En Ocean PTM200_2.b Switches[0]; b Switches2_2 := fb En Ocean PTM200_2.b Switches[1]; b Switches2_3 := fb En Ocean PTM200_2.b Switches[2]; b Switches2_4 := fb En Ocean PTM200_2.b Switches[3]; In this sample program two transmitter modules (PTM200/PTM250) are queried; one with the transmitter ID 16#C6, another one with the transmitter ID 16#C7. A function block FB_En Ocean PTM200 is created for each of the two transmitter modules. Both function blocks obtain their information from the upstream receive function block FB_En Ocean Receive [} 14] and are only active (input b Enable) if the receive function block is active and not in error. The push buttons of the first transmitter module are assigned to a Boolean array b Switches1 for further analysis, while the push buttons of the second transmitter module are assigned to individual Boolean variables b Switches2_1 to b Switches2_4; both options are conceivable. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.1.2.3 FB_En Ocean STM100 Outdated For new projects the function block FB_En Ocean STM100Generic() [} 20] should be used! The function block FB_En Ocean STM100() provides a user-friendly evaluation of the data from an En Ocean® STM100 module. The function block FB_En Ocean Receive() [} 14] is required for this purpose. A new instance of this function block must be created for each STM100 module used. 18 Version: 1.7.0 TE1000
## Page 19

Programming Inputs VAR_INPUT b Enable : BOOL := FALSE; t Watchdog : TIME; n Transmitter Id : UDINT; st En Ocean Received Data : ST_En Ocean Received Data; END_VAR Name Type Description b Enable BOOL A positive signal at this input enables the function block. A negative signal at the input disables the function block functionality, and all outputs are set to 0 or FALSE. t Watchdog TIME Monitoring time. Within this time, new information must reach this function block via the input st En Ocean Received Data described below. If this time is set to t#0s, the watchdog function is inactive. n Transmitter Id UDINT ID of the En Ocean® module, to which the function block should respond. st En Ocean Received ST_En Ocean Received Data Information and required connection to the En Ocean® Data [} 39] receive function block FB_En Ocean Receive() [} 14]. This information is stored in a structure. Outputs VAR_OUTPUT e En Ocean Rotary Switch : E_En Ocean Rotary Switch; n Setpoint : INT; n Temperature : INT; b Present Switch : BOOL; b Learn Switch : BOOL; b Error : BOOL := FALSE; n Error Id : UDINT := 0; END_VAR Name Type Description e En Ocean Rotary Swi E_En Ocean Rotary Switch The output at this output describes the position of the tch rotary switch on the room control unit. [} 38] n Setpoint INT This output variable indicates the setpoint value set on the device. The values can range from -100 to +100. n Temperature INT The measured temperature is output here in 1/10 °C with a measuring range of 0 °C to 40 °C. If the watchdog is triggered, the function block assumes a wire break-like fault and the value is fixed at 850 °C. b Present Switch BOOL If the presence button at the room control unit is activated, this output becomes TRUE. b Learn Switch BOOL If the learn button at the room control unit is activated, this output becomes TRUE. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the variable n Error ID. n Error Id UDINT Describes the type of error [} 23]. The following sample program illustrates the operating principle of this function block: PROGRAM MAIN VAR fb En Ocean Receive : FB_En Ocean Receive; fb En Ocean STM100_1 : FB_En Ocean STM100; fb En Ocean STM100_2 : FB_En Ocean STM100; n Temperature : ARRAY [1..2] OF INT; n Setpoint : ARRAY [1..2] OF INT; n State Rotary Switch : ARRAY [1..2] OF E_En Ocean Rotary Switch; b Present Switch : ARRAY [1..2] OF BOOL; END_VAR TE1000 Version: 1.7.0 19
## Page 20

Programming fb En Ocean Receive( b Enable := TRUE, st En Ocean In Data := st En Ocean In Data, st En Ocean Out Data := st En Ocean Out Data); fb En Ocean STM100_1( b Enable := NOT fb En Ocean Receive.b Error AND fb En Ocean Receve.b Enable, n Transmitter Id := 16#000000C4, t Watchdog:=t#1h, st En Ocean Received Data := fb En Ocean Receive.st En Ocean Received Data n Temperature => Temperature[1], n Setpoint => n Setpoint[1] , e En Ocean Rotary Switch => n State Rotary Switch[1], b Present Switch => b Present Switch[1]); fb En Ocean STM100_2( b Enable := NOT fb En Ocean Receive.b Error AND fb En Ocean Receive.b Enable, n Transmitter Id := 16#000000C5, t Watchdog:=t#0s, st En Ocean Received Data := fb En Ocean Receive.st En Ocean Received Data n Temperature => Temperature[2], n Setpoint => n Setpoint[2] , e En Ocean Rotary Switch => n State Rotary Switch[2], b Present Switch => b Present Switch[2]); In this sample program two room control units are queried; one with the transmitter ID 16#000000C4 and another one with the transmitter ID 16#000000C5. A function block FB_En Ocean STM100 is created for each of the two function blocks. Both function blocks obtain their information from the upstream receive function block FB_En Ocean Receive [} 14] and are only active (input b Enable) if the receive function block is active and not in error. The first device is monitored by the watchdog function, whereby new values must be transmitted to the control unit within 1 hour; the second device is programmed without watchdog monitoring. The values output to the function blocks are assigned to flags for further evaluation. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.1.2.4 FB_En Ocean STM100Generic The function block FB_En Ocean STM100Generic() provides a user-friendly evaluation of the data of an En Ocean® STM100 module. The function block FB_En Ocean Receive() [} 14] is required for this purpose. A new instance of this function block must be created for each STM100 module used. Inputs VAR_INPUT b Enable : BOOL := FALSE; t Watchdog : TIME; n Transmitter Id : UDINT; st En Ocean Received Data : ST_En Ocean Received Data; END_VAR Name Type Description b Enable BOOL A positive signal at this input enables the function block. A negative signal at the input disables the function block functionality, and all outputs are set to 0 or FALSE. 20 Version: 1.7.0 TE1000
## Page 21

Programming Name Type Description t Watchdog TIME Monitoring time. Within this time, new information must reach this function block via the input st En Ocean Received Data described below. If this time is set to t#0s, the watchdog function is inactive. n Transmitter Id UDINT ID of the En Ocean® module, to which the function block should respond. st En Ocean Received ST_En Ocean Received Data Information and required connection to the En Ocean® Data [} 39] receive function block FB_En Ocean Receive() [} 14]. This information is stored in a structure. Outputs VAR_OUTPUT n Data Bytes : ARRAY [0..3] OF BYTE; b Error : BOOL := FALSE; n Error Id : UDINT := 0; END_VAR Name Type Description n Data Bytes ARRAY OF BYTE 4-byte array with the user data sent by the STM100 module. The purpose of the individual bytes is manufacturer-specific. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the variable n Error ID. n Error Id UDINT Describes the type of error [} 23]. The following sample program illustrates the operating principle of this function block: PROGRAM MAIN VAR fb En Ocean Receive : FB_En Ocean Receive; fb En Ocean STM100_1 : FB_En Ocean STM100Generic; fb En Ocean STM100_2 : FB_En Ocean STM100Generic; n Temperature : ARRAY [1..2] OF BYTE; n Setpoint : ARRAY [1..2] OF BYTE; n State Rotary Switch : ARRAY [1..2] OF BYTE; n Present Switch : ARRAY [1..2] OF BYTE; END_VAR fb En Ocean Receive( b Enable := TRUE, st En Ocean In Data := st En Ocean In Data, st En Ocean Out Data := st En Ocean Out Data); fb En Ocean STM100_1( b Enable := NOT fb En Ocean Receive.b Error AND fb En Ocean Receive.b Enable, n Transmitter Id := 16#000000C4, t Watchdog:=t#1h, st En Ocean Received Data := fb En Ocean Receive.st En Ocean Received Data); n Temperature[1] := fb En Ocean STM100_1.n Data Bytes[0]; n Setpoint[1] := fb En Ocean STM100_1.n Data Bytes[1]; n State Rotary Switch[1] := fb En Ocean STM100_1.n Data Bytes[2]; n Present Switch[1] := fb En Ocean STM100_1.n Data Bytes[3]; fb En Ocean STM100_2( b Enable := NOT fb En Ocean Receive.b Error AND fb En Ocean Receive.b Enable, n Transmitter Id := 16#000000C5, t Watchdog:=t#0s, st En Ocean Received Data := fb En Ocean Receive.st En Ocean Received Data); n Temperature[2] := fb En Ocean STM100_2.n Data Bytes[0]; n Setpoint[2] := fb En Ocean STM100_2.n Data Bytes[1]; n State Rotary Switch[2] := fb En Ocean STM100_2.n Data Bytes[2]; n Present Switch[2] := fb En Ocean STM100_2.n Data Bytes[3]; In this sample program, two En Ocean® transmitter modules are queried, one with the transmitter ID 16#000000C4 and another with the transmitter ID 16#000000C5. A function block FB_En Ocean STM100Generic is created for both transmitters. Both function blocks obtain their information from the upstream receive function block FB_En Ocean Receive [} 14] and are only active (input b Enable) if the receive function block is active and not in error. The first device is monitored by the watchdog function, whereby new values must be transmitted to the control unit within 1 hour; the second device is programmed TE1000 Version: 1.7.0 21
## Page 22

Programming without watchdog monitoring. The values output to the function blocks are assigned to variables for further evaluation. Before the values can be used further, they have to be scaled to physical values. Details of the conversion can be found in the data sheet for the sensor. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.1.2.5 FB_En Ocean STM250 The function block FB_En Ocean STM250() provides a user-friendly evaluation of the data from an En Ocean® STM250 module. The function block FB_En Ocean Receive() [} 14] is required for this purpose. A new instance of this function block must be created for each STM250 module used. Inputs VAR_INPUT b Enable : BOOL := FALSE; t Watchdog : TIME; n Transmitter Id : UDINT; st En Ocean Received Data : ST_En Ocean Received Data; END_VAR Name Type Description b Enable BOOL A positive signal at this input enables the function block. A negative signal at the input disables the function block functionality, and all outputs are set to 0 or FALSE. t Watchdog TIME Monitoring time. Within this time, new information must reach this function block via the input st En Ocean Received Data described below. If this time is set to t#0s, the watchdog function is inactive. n Transmitter Id UDINT ID of the En Ocean® module, to which the function block should respond. st En Ocean Received ST_En Ocean Received Data Information and required connection to the En Ocean® Data [} 39] receive function block FB_En Ocean Receive() [} 14]. This information is stored in a structure. Outputs VAR_OUTPUT b State : BOOL; b Learn : BOOL; b Error : BOOL := FALSE; n Error Id : UDINT := 0; END_VAR Name Type Description b State BOOL When the reed contact on the STM250 module is activated, this output becomes TRUE (contact closed). b Learn BOOL This output becomes FALSE if the learn button at the STM250 module is activated. 22 Version: 1.7.0 TE1000
## Page 23

Programming Name Type Description b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the variable n Error ID. n Error Id UDINT Describes the type of error [} 23]. The following sample program illustrates the operating principle of this function block: PROGRAM MAIN VAR fb En Ocean Receive : FB_En Ocean Receive; fb En Ocean STM250 : FB_En Ocean STM250; b State : BOOL; b Learn : BOOL; END_VAR fb En Ocean Receive( b Enable := TRUE, st En Ocean In Data := st En Ocean In Data, st En Ocean Out Data := st En Ocean Out Data); fb En Ocean STM250( b Enable := NOT fb En Ocean Receive.b Error AND fb En Ocean Receive.b Enable, n Transmitter Id := 16#000008CA, t Watchdog:=t#0s, st En Ocean Received Data := fb En Ocean Receive.st En Ocean Received Data b State => b State, b Learn => b Learn); In this sample program an STM250 module with the transmitter ID 16#000008CA is queried. To this end the function block FB_En Ocean STM250 is created. This function blocks obtains its information from the upstream receive function block FB_En Ocean Receive [} 14] and is only active (input b Enable) if the receive function block is active and not in error. The values output to the function block are assigned to variables for further evaluation. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.1.3 Error codes Value (hex) Description 0x0000 No error. 0x0001 Checksum error. 0x0002 Watchdog monitoring. 0x0003 Buffer overflow (in the KL6023) 0x0004 No data received yet from sensor receive. 4.1.2 KL6581 4.1.2.1 FB_KL6581 This function block takes care of communication with the KL6581 En Ocean® Bus Terminal. This function block is used to configure the KL6581 and start data exchange with the En Ocean® network. TE1000 Version: 1.7.0 23
## Page 24

Programming Restrictions • Only one call per instance • Call must be made once per PLC cycle • Instance must be called in the same PLC task as the send and receive blocks assigned to it • Maximum 64 instances per PLC project allowed Inputs VAR_INPUT b Init : BOOL; n Idx : USINT := 1; END_VAR Name Type Description b Init BOOL Activates the function block that configures the KL6301 and then activates the data exchange. n Idx USINT The idx number must be unique for each KL6581 (valid values: 1...64) if more than one bus terminal is used per PLC program. Inputs/outputs VAR_IN_OUT st KL6581_in : KL6581_Input; st KL6581_out : KL6581_Output; END_VAR Name Type Description st KL6581_in KL6581_Input [} 41] Is linked to the input addresses of the KL6581 in the System Manager. st KL6581_out KL6581_Output [} 42] Is linked to the output addresses of the KL6581 in the System Manager. Outputs VAR_OUTPUT b Ready : BOOL; b Busy : BOOL; b Error : BOOL; i Error ID : E_KL6581_Err; str_KL6581 : STR_KL6581; END_VAR Name Type Description b Ready BOOL The function block is ready for sending and receiving data. b Busy BOOL The function block is active. No new data can be sent yet. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the i Error ID variable. i Error ID E_KL6581_Err [} 41] Describes the type of error. str_KL6581 STR_KL6581 [} 44] Connected with the send and receive function blocks. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 24 Version: 1.7.0 TE1000
## Page 25

Programming 4.1.2.2 Read Function blocks Description FB_Rec_Generic [} 25] Receives all types of En Ocean® telegrams. FB_Rec_1BS [} 26] Receives data with ORG telegram 6. Typical En Ocean® device: window contact FB_Rec_RPS_Switch [} 27] Receives data with ORG telegram 5. Typical En Ocean® device: switch FB_Rec_RPS_Window_Handle [} 27] Receives data with ORG telegram 5. Typical En Ocean® device: window handle 4.1.2.2.1 FB_Rec_Generic This function block receives all data that were received via En Ocean®. This function block can be used for all types of En Ocean® telegrams. The user must interpret the data himself. This requires the documentation of the manufacturer of the transmitting En Ocean® device. Inputs VAR_INPUT str_KL6581 : STR_KL6581; by Node : BYTE; dw_ID : DWORD; END_VAR Name Type Description str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. by Node BYTE Filter - if the value is zero, the En Ocean® telegrams from all KL6583s are received. If a value of 1 to 8 is entered, only the data from the corresponding KL6583 are received. dw_ID DWORD En Ocean® ID to be received. Outputs VAR_OUTPUT ar_Value : ARRAY [0..3] OF BYTE; by_Node : BYTE; by_STATE : BYTE; b Receive : BOOL := TRUE; En Ocean Typ : E_En Ocean_Org; END_VAR Name Type Description ar_Value ARRAY OF BYTE En Ocean® data 4 bytes. by_Node BYTE Node number of the KL6583 that has received the En Ocean® telegram. by_STATE BYTE En Ocean® STATE Field. b Receive BOOL On receiving an En Ocean® telegram this value is set to FALSE for one cycle. En Ocean Typ E_En Ocean_Org [} 40] En Ocean® ORG Field. TE1000 Version: 1.7.0 25
## Page 26

Programming Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.2.2 FB_Rec_1BS This function block receives data that were received via En Ocean®. This function block is used for integration of window contacts, for example (ORG FIELD 6). Inputs VAR_INPUT str_KL6581 : STR_KL6581; by Node : BYTE; dw_ID : DWORD; END_VAR Name Type Description str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. by Node BYTE Filter - if the value is zero, the En Ocean® telegrams from all KL6583s are received. If a value of 1 to 8 is entered, only the data from the corresponding KL6583 are received. dw_ID DWORD En Ocean® ID to be received. Outputs VAR_OUTPUT b Open : BOOL; b Close : BOOL; b LRN : BOOL; by_Node : BYTE; b Receive : BOOL := TRUE; END_VAR Name Type Description b Open BOOL Contact open b Close BOOL Contact closed b LRN BOOL LRN button pressed by_Node BYTE Node number of the KL6583 that has received the En Ocean® telegram. b Receive BOOL On receiving an En Ocean® telegram this value is set to FALSE for one cycle. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 26 Version: 1.7.0 TE1000
## Page 27

Programming 4.1.2.2.3 FB_Rec_RPS_Switch This function block receives data from a switch that were received via En Ocean®. The function block outputs the data in a data structure (ORG Field 5). Inputs VAR_INPUT str_KL6581 : STR_KL6581; by Node : BYTE; dw_ID : DWORD; END_VAR Name Type Description str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. by Node BYTE Filter - if the value is zero, the En Ocean® telegrams from all KL6583s are received. If a value of 1 to 8 is entered, only the data from the corresponding KL6583 are received. dw_ID DWORD En Ocean® ID to be received. Outputs VAR_OUTPUT str_En Ocean Switch : STR_En Ocean Switch by_Node : BYTE; b Receive : BOOL := TRUE; END_VAR Name Type Description str_En Ocean Switch STR_En Ocean Switch Switch data [} 43] by_Node BYTE Node number of the KL6583 that has received the En Ocean® telegram. b Receive BOOL On receiving an En Ocean® telegram this value is set to FALSE for one cycle. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.2.4 FB_Rec_RPS_Window_Handle This function block receives data from a window handle that were received via En Ocean®. The function block outputs the data in a data structure (ORG Field 5). TE1000 Version: 1.7.0 27
## Page 28

Programming Inputs VAR_INPUT str_KL6581 : STR_KL6581; by Node : BYTE; dw_ID : DWORD; END_VAR Name Type Description str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. by Node BYTE Filter - if the value is zero, the En Ocean® telegrams from all KL6583s are received. If a value of 1 to 8 is entered, only the data from the corresponding KL6583 are received. dw_ID DWORD En Ocean® ID to be received. Outputs VAR_OUTPUT ar_Data : AR_En Ocean Window; by_Node : BYTE; b Receive : BOOL := TRUE; END_VAR Name Type Description ar_Data AR_En Ocean Window Window handle data [} 43] by_Node BYTE Node number of the KL6583 that has received the En Ocean® telegram. b Receive BOOL On receiving an En Ocean® telegram this value is set to FALSE for one cycle. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.3 Send Function blocks Description FB_Send_Generic [} 28] Sends any En Ocean® telegrams. FB_Send_4BS [} 29] Sends En Ocean® telegrams in 4BS format. FB_Send_RPS_Switch [} 30] Sends En Ocean® telegrams in the format of a switch. FB_Send_RPS_Switch Auto [} 31] Sends En Ocean® telegrams in the format of a switch. 4.1.2.3.1 FB_Send_Generic 28 Version: 1.7.0 TE1000
## Page 29

Programming This function block sends data via En Ocean®. The type and the data contents are arbitrary. All types of En Ocean® data telegrams can be sent with this function block. Inputs VAR_INPUT b Start : BOOL; by_Node : BYTE; by_ORG : E_En Ocean_Org; pt_Send Data : DWORD; by_STATE : BYTE; n En Ocean ID : BYTE; str_KL6581 : STR_KL6581; END_VAR Name Type Description b Start BOOL Positive edge sends the data. by_Node BYTE Address of the KL6583 module to which the telegram is to be sent (valid values: 1...8). by_ORG E_En Ocean_Org [} 40] ORG Field of the En Ocean® telegram pt_Send Data DWORD Pointer to the data to be sent. ADR is used to determine the pointer address. The pointer must point to 4-byte variable. by_STATE BYTE En Ocean®-STATE. Can be changed by the TCM module. n En Ocean ID BYTE Virtual En Ocean® ID. A value of 0...127 is added to the real En Ocean® ID (valid values: 0...127). str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Error ID : E_KL6581_Err; END_VAR Name Type Description b Busy BOOL The function block is active. No new data can be sent yet. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the i Error ID variable. i Error ID E_KL6581_Err [} 41] Describes the type of error. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.3.2 FB_Send_4BS This function block sends data via En Ocean®. The ORG field is set permanently to 7. TE1000 Version: 1.7.0 29
## Page 30

Programming Inputs VAR_INPUT b Start : BOOL; by_Node : BYTE; pt_Send Data : DWORD; n En Ocean ID : BYTE; str_KL6581 : STR_KL6581; END_VAR Name Type Description b Start BOOL Positive edge sends the data. by_Node BYTE Address of the KL6583 module to which the telegram is to be sent (valid values: 1...8). pt_Send Data DWORD Pointer to the data to be sent. ADR is used to determine the pointer address. The pointer must point to 4-byte variable. n En Ocean ID BYTE Virtual En Ocean® ID. A value of 0...127 is added to the real En Ocean® ID (valid values: 0...127). str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Error ID : E_KL6581_Err; END_VAR Name Type Description b Busy BOOL The function block is active. No new data can be sent yet. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the i Error ID variable. i Error ID E_KL6581_Err [} 41] Describes the type of error. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.3.3 FB_Send_RPS_Switch This function block sends En Ocean telegrams in the format of a switch. The value of b Data is sent with a positive edge of b Start. In order to simulate a button press, the function block usually has to be started twice, once with b Data = TRUE, once with b Data = FALSE. For simpler handling the function block FB_Send_RPS_Switch Auto() [} 31] can be used. Inputs VAR_INPUT b Start : BOOL; by_Node : BYTE; 30 Version: 1.7.0 TE1000
## Page 31

Programming b Data : BOOL; n Rocker ID : INT; n En Ocean ID : BYTE; str_KL6581 : STR_KL6581; END_VAR Name Type Description b Start BOOL Positive edge sends the data. by_Node BYTE Address of the KL6583 module to which the telegram is to be sent (valid values: 1...8). b Data BOOL Value to be transmitted. n Rocker ID INT Push button number, valid values 0...3. n En Ocean ID BYTE Virtual En Ocean® ID. A value of 0...127 is added to the real En Ocean® ID (valid values: 0...127). str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Error ID : E_KL6581_Err; END_VAR Name Type Description b Busy BOOL The function block is active. No new data can be sent yet. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the i Error ID variable. i Error ID E_KL6581_Err [} 41] Describes the type of error. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.3.4 FB_Send_RPS_Switch Auto This function block sends En Ocean telegrams in the format of a switch. The value of b Data is sent with a positive edge of b Start. The signal "Release switch" is sent once the time t_Switch Delay has elapsed. Inputs VAR_INPUT b Start : BOOL; b Data : BOOL; by_Node : BYTE; t_Switch Delay : TIME := T#100ms; n Rocker ID : INT; n En Ocean ID : BYTE; str_KL6581 : STR_KL6581; END_VAR TE1000 Version: 1.7.0 31
## Page 32

Programming Name Type Description b Start BOOL Positive edge sends the data. b Data BOOL Value to be transmitted. by_Node BYTE Address of the KL6583 module to which the telegram is to be sent (valid values: 1...8). t_Switch Delay TIME How long the push button has to be pressed. n Rocker ID INT Push button number, valid values 0...3. n En Ocean ID BYTE Virtual En Ocean® ID. A value of 0...127 is added to the real En Ocean® ID (valid values: 0...127). str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; i Error ID : E_KL6581_Err; END_VAR Name Type Description b Busy BOOL The function block is active. No new data can be sent yet. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the i Error ID variable. i Error ID E_KL6581_Err [} 41] Describes the type of error. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.4 Other Function blocks Description FB_En Ocean_Search [} 32] Function block recognizes all En Ocean® devices within its range and displays them. FB_Rec_Teach_In [} 33] This function block indicates if the LRN bit in an En Ocean® telegram is set, independent of its En Ocean® ID. FB_Rec_Teach_In_Ex [} 34] This function block indicates when the Learn button is pressed on an En Ocean® device. 4.1.2.4.1 FB_En Ocean_Search This function block displays all En Ocean® IDs that it has received and enters them in a receive array (ar_ID). Up to 256 En Ocean® devices can be recognized. Alternatively the function block can also be created separately for each KL6583. This can be used to recognize whether an En Ocean® device is being received by several KL6583s. 32 Version: 1.7.0 TE1000
## Page 33

Programming Inputs VAR_INPUT b Start : BOOL; str_KL6581 : STR_KL6581; by Node : BYTE; END_VAR Name Type Description b Start BOOL If TRUE the function block is enabled, if FALSE it is disabled. str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. by Node BYTE Filter - if the value is zero, the En Ocean® telegrams from all KL6583s are received. If a value of 1 to 8 is entered, only the data from the corresponding KL6583 are received. Outputs VAR_OUTPUT b Receive : BOOL := TRUE; i Devices : INT; ar_ID : ARRAY [0..255] OF DWORD; END_VAR Name Type Description b Receive BOOL On receiving an En Ocean® telegram this value is set to FALSE for one cycle. i Devices INT Number of En Ocean® devices found. ar_ID ARRAY OF DWORD En Ocean® IDs that were found. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.4.2 FB_Rec_Teach_In This function block indicates when a Learn button is pressed on an En Ocean® device. If the flag b Learn Type is set, further information about the En Ocean® device can be read. This function must be provided by the En Ocean® device. So far, however, it is only supported by very few En Ocean® devices. Inputs VAR_INPUT b Start : BOOL; by Node : BYTE; str_KL6581 : STR_KL6581; END_VAR Name Type Description b Start BOOL If TRUE the function block is enabled, if FALSE it is disabled. TE1000 Version: 1.7.0 33
## Page 34

Programming Name Type Description by Node BYTE Filter - if the value is zero, the En Ocean® telegrams from all KL6583s are received. If a value of 1 to 8 is entered, only the data from the corresponding KL6583 are received. str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. Outputs VAR_OUTPUT b Learn Type : BOOL; by_Node : BYTE; dw_ID : DWORD; str_Teach_In : STR_Teach_In; b Receive : BOOL := TRUE; END_VAR Name Type Description b Learn Type BOOL If the bit is set you will find further data in the structure str_Teach_In. by_Node BYTE Number of En Ocean® devices found. dw_ID DWORD En Ocean® ID for which the Learn button was pressed. str_Teach_In STR_Teach_In [} 45] Data structure, profile, type and manufacturer ID. b Receive BOOL On receiving an En Ocean® telegram this value is set to FALSE for one cycle. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.4.3 FB_Rec_Teach_In_Ex This function block indicates when a Learn button is pressed on an En Ocean® device. If the flag b Learn Type is set, further information about the En Ocean® device can be read. This function must be provided by the En Ocean® device. So far, however, it is only supported by very few En Ocean® devices. In addition to the FB_Rec_Teach_In() [} 33] function block, the system also checks whether it is an EEP telegram. Inputs VAR_INPUT b Start : BOOL; by Node : BYTE; str_KL6581 : STR_KL6581; END_VAR Name Type Description b Start BOOL If TRUE the function block is enabled, if FALSE it is disabled. 34 Version: 1.7.0 TE1000
## Page 35

Programming Name Type Description by Node BYTE Filter - if the value is zero, the En Ocean® telegrams from all KL6583s are received. If a value of 1 to 8 is entered, only the data from the corresponding KL6583 are received. str_KL6581 STR_KL6581 [} 44] Is connected to the data structure of the function block FB_KL6581() [} 23]. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.32 Tc2_En Ocean from v3.4.6.0 Outputs VAR_OUTPUT b Learn Type : BOOL; by_Node : BYTE; dw_ID : DWORD; str_Teach_In : STR_Teach; b Receive : BOOL := TRUE; END_VAR Name Type Description b Learn Type BOOL If the bit is set you will find further data in the structure str_Teach_In. by_Node BYTE Number of En Ocean® devices found. dw_ID DWORD En Ocean® ID for which the Learn button was pressed. str_Teach_In STR_Teach [} 44] Data structure, profile, type and manufacturer ID. b Receive BOOL On receiving an En Ocean® telegram this value is set to FALSE for one cycle. 4.1.2.5 Function Function blocks Description F_Byte_To_Temp [} 35] This function converts a byte raw value into a REAL variable. F_Byte_To_Turn Switch [} 36] This function converts a raw byte value to a Boolean array. 4.1.2.5.1 F_Byte_to_Temp : REAL This function converts a byte raw value into a REAL variable. Temperature data transmitted with En Ocean® is one byte in size and is sent in a specific format. This data is usually scaled to a specific temperature value. For example, a value is transmitted from a range of values from 0 to 40°C. The minimum and maximum data value and the raw value are transferred to the function. The output of the function then outputs the temperature as REAL variable. TE1000 Version: 1.7.0 35
## Page 36

Programming Inputs VAR_INPUT by Data : BYTE; min Temp : REAL := 0; max Temp : REAL := 40; END_VAR Name Type Description by Data BYTE Raw data min Temp REAL Minimum temperature max Temp REAL Maximum temperature Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.5.2 F_Byte_to_Turn Switch This function converts a raw byte value to a Boolean array in the form of a data structure (see STREn Ocean Turn Switch [} 45]). Inputs VAR_INPUT by Data : BYTE; END_VAR Name Type Description by Data BYTE Raw data Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.1.2.6 Error codes Value (hex) Value (dec) Value (enum) Description 0x0000 0 NO_ERROR No error at the function block. 0x000A 10 KL6581_Wrong Terminal Wrong terminal connected. 0x0010 16 KL6581_Watchdog Error Timeout during initialization of function block FB_KL6581() [} 23]. 0x0011 17 KL6581_No Com With KL6581 This message usually means that there is no connection to the terminal. Terminal linked to the variables in the System Manager? Terminal plugged in incorrectly? Clean all, rebuild all and read again in the System Manager? 0x0012 18 KL6581_idx_number_not_OK The input variable n Idx of function block FB_KL6581() is greater than 64. 36 Version: 1.7.0 TE1000
## Page 37

Programming Value (hex) Value (dec) Value (enum) Description 0x0013 19 KL6581_Switch_to_Stopp The terminal has stopped exchanging data with the KL6583-0000 En Ocean® transmitter and receiver, no En Ocean® data has been sent or received. 0x0014 20 KL6581_not_ready Internal message for the function blocks connected to the FB_KL6581(). 0x0015 21 KL6581_No_KL6853_Found No KL6583 is connected to the En Ocean® master terminal KL6581 or communication is not available! 0x0016 22 KL6581_Transmission Error Data could not be sent, check address of KL6583 or KL6583 not ready for operation. 4.2 DUTs KL6021-0023/Hardware Types Data types Description ST_En Ocean In Data [} 39] Process image of the inputs ST_En Ocean Out Data [} 40] Process image of the outputs KL6021-0023 Data types Description E_En Ocean Rotary Switch [} 38] State of the rotary-switch on the transmitting-module E_En Ocean Sensor Type [} 38] Sensor type ST_En Ocean Received Data [} 39] Internal structure KL6581/Hardware Types Data types Description KL6581_INPUT [} 41] Process image of the inputs KL6581_OUTPUT [} 42] Process image of the outputs KL6581 Data types Description AR_En Ocean Window [} 43] State of the window E_ENOCEAN_Org [} 40] Type of En Ocean® telegram E_KL6581_Err [} 41] Error messages STR_En Ocean Switch [} 43] State of the switches STR_KL6581 [} 44] Internal structure STR_Teach [} 44] Data structure manufacturer ID, type and function STR_Teach_In [} 45] Data structure manufacturer ID, type and profile STREn Ocean Turn Switch [} 45] Position of the rotary switch at the room control unit. TE1000 Version: 1.7.0 37
## Page 38

Programming 4.2.1 KL6021-0023 Hardware types Data types Description ST_En Ocean In Data [} 39] Process image of the KL6021-0023 inputs ST_En Ocean Out Data [} 40] Process image of the KL6021-0023 outputs Data types Description E_En Ocean Rotary Switch [} 38] Position of the rotary switch at the room control unit E_En Ocean Sensor Type [} 38] Sensor type ST_En Ocean Received Data [} 39] Internal structure 4.2.1.1 Enums 4.2.1.1.1 E_En Ocean Sensor Type Sensor type. TYPE E_En Ocean Sensor Type : ( e En Ocean Sensor Type PTM := 5, e En Ocean Sensor Type STM1Byte := 6, e En Ocean Sensor Type STM4Byte := 7, e En Ocean Sensor Type CTM := 8 ) END_TYPE Name Description e En Ocean Sensor Type PTM PTM e En Ocean Sensor Type STM1 STM 1 byte Byte e En Ocean Sensor Type STM4 STM 4 byte Byte e En Ocean Sensor Type CTM CTM Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.1.1.2 E_En Ocean Rotary Switch E_En Ocean Rotary Switch describes the position of the rotary switch at the room control unit. TYPE E_En Ocean Rotary Switch : ( e En Ocean Rotary Switch Step0 := 0, e En Ocean Rotary Switch Step1 := 1, e En Ocean Rotary Switch Step2 := 2, e En Ocean Rotary Switch Step3 := 3, e En Ocean Rotary Switch Auto := 4 ) END_TYPE Name Description e En Ocean Rotary Switch Step Switch in position “0” 0 e En Ocean Rotary Switch Step Switch in position “1” 1 38 Version: 1.7.0 TE1000
## Page 39

Programming Name Description e En Ocean Rotary Switch Step Switch in position “2” 2 e En Ocean Rotary Switch Step Switch in position “3” 3 e En Ocean Rotary Switch Auto Switch in position “Auto” Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.1.2 Structures 4.2.1.2.1 ST_En Ocean Received Data Internal structure. This structure is used to link the FB_En Ocean Receive() [} 14] block with the receive blocks. TYPE ST_En Ocean Received Data : STRUCT b Received : BOOL; n Length : BYTE; e En Ocean Sensor Type : E_En Ocean Sensor Type; n Data : ARRAY[0..3] OF BYTE; n Status : BYTE; n Transmitter Id : UDINT; END_STRUCT END_TYPE Name Type Description b Received BOOL Data received n Length BYTE Length e En Ocean Sensor Ty E_En Ocean Sensor Type Sensor type pe [} 38] n Data ARRAY OF BYTE Data bytes n Status BYTE State n Transmitter Id UDINT Transmitter ID Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.1.2.2 ST_En Ocean In Data Process image of the KL6021-0023 inputs. Linked to the terminals in the System Manager. TYPE ST_En Ocean In Data : STRUCT n Status : BYTE; n Data : ARRAY[0..10] OF BYTE; END_STRUCT END_TYPE Name Type Description n Status BYTE Status byte n Data ARRAY OF BYTE 11 bytes for the input data TE1000 Version: 1.7.0 39
## Page 40

Programming Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.1.2.3 ST_En Ocean Out Data Process image of the KL6021-0023 outputs. Linked to the terminals in the System Manager. TYPE ST_En Ocean Out Data : STRUCT n Ctrl : BYTE; n Data : ARRAY[0..10] OF BYTE; END_STRUCT END_TYPE Name Type Description n Ctrl BOOL Control byte. n Data ARRAY OF BYTE 11 bytes for the output data Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.2 KL6581 Hardware Types Data types Description KL6581_Input [} 41] Process image of the KL6581 inputs KL6581_Output [} 42] Process image of the KL6581 outputs Data types Description AR_En Ocean Window [} 43] State of the window E_ENOCEAN_Org [} 40] Type of En Ocean® telegram E_KL6581_Err [} 41] Error messages STR_En Ocean Switch [} 43] State of the switches STR_KL6581 [} 44] Internal structure STR_Teach [} 44] Data structure manufacturer ID, type and function STR_Teach_In [} 45] Data structure manufacturer ID, type and profile STREn Ocean Turn Switch [} 45] Position of the rotary switch at the room control unit. 4.2.2.1 Enums 4.2.2.1.1 E_ENOCEAN_ORG Type of En Ocean® telegram. TYPE E_ENOCEAN_Org : ( PTM_TELEGRAM := 5, STM_1BYTE_TELEGRAM := 6, STM_4BYTE_TELEGRAM := 7, CTM_TELEGRAM := 8, MODEM_TELEGRAM := 16#A, 40 Version: 1.7.0 TE1000
## Page 41

Programming MODEM_ACK_TELEGRAM := 16#B ) END_TYPE Name Description PTM_TELEGRAM PTM telegram STM_1BYTE_TELEGRAM 1-byte telegram STM_4BYTE_TELEGRAM 4-byte telegram CTM_TELEGRAM CTM telegram MODEM_TELEGRAM Modem telegram MODEM_ACK_TELEGRAM Modem telegram with acknowledgement. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.2.1.2 E_KL6581_Err Error messages. TYPE E_KL6581_Err : ( NO_ERROR := 16#0, KL6581_Wrong Terminal := 16#A, KL6581_Watchdog Error := 16#10, KL6581_No Com With KL6581 := 16#11, KL6581_idx_number_not_OK := 16#12, KL6581_Switch_to_Stopp := 16#13, KL6581_not_ready := 16#14, KL6581_No_KL6853_Found := 16#15, KL6581_Transmission Error := 16#16 ) END_TYPE Name Description NO_ERROR No error at the function block. KL6581_Wrong Terminal Wrong terminal connected. KL6581_Watchdog Error Timeout during initialization of function block "FB_KL6581". KL6581_No Com With KL6581 This message usually means that there is no connection to the terminal. Terminal linked to the variables in the System Manager? Terminal plugged in incorrectly? Clean all, rebuild all and read again in the System Manager? KL6581_idx_number_not_OK The input variable n Idx of function block FB_KL6581() [} 23] is greater than 64. KL6581_Switch_to_Stopp The terminal has left the data exchange with the KL6583. No En Ocean® data was sent or received. KL6581_not_ready: Internal message for the function blocks connected to the FB_KL6581(). KL6581_No_KL6853_Found No KL6583 is connected to the KL6581 or communication is not available! KL6581_Transmission Error Data could not be sent, check address of KL6583 or KL6583 not ready for operation. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.2.2 Structures 4.2.2.2.1 KL6581_INPUT Process image of the KL6581 inputs. TE1000 Version: 1.7.0 41
## Page 42

Programming Linked to the terminal in the System Manager. TYPE KL6581_Input : STRUCT n Status : BYTE; CNODE : BYTE; ORG : BYTE; DB0 : BYTE; DB1 : BYTE; DB2 : BYTE; DB3 : BYTE; ID0 : BYTE; ID1 : BYTE; ID2 : BYTE; ID3 : BYTE; STATUS : BYTE; END_STRUCT END_TYPE Name Description n Status Status byte CNODE Data byte ORG Data byte DB0 Data byte DB1 Data byte DB2 Data byte DB3 Data byte ID0 Data byte ID1 Data byte ID2 Data byte ID3 Data byte STATUS Data byte Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.2.2.2 KL6581_Output Process image of the KL6581 outputs. Linked to the terminal in the System Manager. TYPE KL6581_Output : STRUCT n Control : BYTE; CNODE : BYTE; ORG : BYTE; DB0 : BYTE; DB1 : BYTE; DB2 : BYTE; DB3 : BYTE; ID0 : BYTE; ID1 : BYTE; ID2 : BYTE; ID3 : BYTE; STATUS : BYTE; END_STRUCT END_TYPE Name Description n Control Control byte CNODE Data byte ORG Data byte DB0 Data byte 42 Version: 1.7.0 TE1000
## Page 43

Programming Name Description DB1 Data byte DB2 Data byte DB3 Data byte ID0 Data byte ID1 Data byte ID2 Data byte ID3 Data byte STATUS Data byte Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.2.2.3 ar_En Ocean Window This structure indicates the state of the window. TYPE AR_En Ocean Window : STRUCT b Up : BOOL; b Open : BOOL; b Close : BOOL; END_STRUCT END_TYPE Name Description b Up The window is tilted. b Open The window is open. b Close The window is closed. Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.2.2.4 str_En Ocean Switch State of the push buttons. TYPE STR_En Ocean Switch : STRUCT b T1_ON : BOOL; b T1_OFF : BOOL; b T2_ON : BOOL; b T2_OFF : BOOL; b T3_ON : BOOL; b T3_OFF : BOOL; b T4_ON : BOOL; b T4_OFF : BOOL; END_STRUCT END_TYPE Name Description b T1_ON Push button 1 on b T1_OFF Push button 1 off b T2_ON Push button 2 on b T2_OFF Push button 2 off b T3_ON Push button 3 on b T3_OFF Push button 3 off TE1000 Version: 1.7.0 43
## Page 44

Programming Name Description b T4_ON Push button 4 on b T4_OFF Push button 4 off Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.2.2.5 str_KL6581 Internal structure. This structure is used to link the function block FB_KL6581() with the send/receive blocks. TYPE STR_KL6581 : STRUCT by_Status : BYTE; by_Node : BYTE; by_ORG : BYTE; ar_DB : ARRAY[0..3] OF BYTE; _Dummy : BYTE; dw_ID : DWORD; pt Data : PVOID; i Error Id : E_KL6581_Err; by_STATE : BYTE; b Error : BOOL; idx : USINT; END_STRUCT END_TYPE Name Description by_Status State by_Node Node number of the KL6583 that has received the En Ocean® telegram. by_ORG Type of En Ocean® telegram ar_DB Data bytes _Dummy Placeholder, no other purpose. dw_ID Transmitter ID pt Data Pointer i Error Id Describes the error type (see E_KL6581_Err [} 41]). by_STATE State b Error This output goes TRUE as soon as an error occurs. This error is described via the i Error Id variable. idx Index Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.2.2.6 STR_Teach Data structure manufacturer ID, type and function. STRUCT n Manufacturer ID : WORD; n TYPE : BYTE; n Func : BYTE; END_STRUCT END_TYPE 44 Version: 1.7.0 TE1000
## Page 45

Programming Name Description n Manufacturer ID Manufacturer ID n TYPE Type n Func Function Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.32 Tc2_En Ocean from v3.4.6.0 4.2.2.2.7 str_Teach_In Data structure manufacturer ID, type and profile. TYPE STR_Teach_In : STRUCT n Manufacturer ID : WORD; n TYPE : BYTE; n Profile : BYTE; END_STRUCT END_TYPE Name Description n Manufacturer ID Manufacturer ID n TYPE Type n Profile Profile Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 4.2.2.2.8 STREn Ocean Turn Switch STREn Ocean Turn Switch describes the position of the rotary switch at the room control unit. TYPE STREn Ocean Turn Switch : STRUCT b Stage Auto : BOOL; b Stage_0 : BOOL; b Stage_1 : BOOL; b Stage_2 : BOOL; b Stage_3 : BOOL; END_STRUCT END_TYPE Name Description b Stage Auto Switch in position “Auto” b Stage_0 Switch in position “0” b Stage_1 Switch in position “1” b Stage_2 Switch in position “2” b Stage_3 Switch in position “3” Prerequisites Development environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_En Ocean from v3.3.5.0 TE1000 Version: 1.7.0 45
## Page 46

Programming 4.3 Integration into Twin CAT 4.3.1 KL6581 with CX5120 This sample shows how to write a simple PLC program for En Ocean® in Twin CAT and how to link it with the hardware. The task is to receive four switch signals of an En Ocean® wireless switch module. Sample: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_enocean/Resources/6200373771.zip The Twin CAT project is available for download as *.zip file. This must first be unpacked locally so that the archive (*.tnzip file) is available for import into the Twin CAT project. Hardware Setting up the components The following hardware is required: • 1x CX5120 Embedded PC • 1x KL6581 En Ocean® master terminal • 1x KL6583-0000 En Ocean® transmitter and receiver • 1x KL9010 end terminal Set up the hardware and the En Ocean® components as described in the associated documentation. This example assumes that the ID of the wireless switch module is known. Software Creation of the PLC program Create a new "Twin CAT XAE Project" and create a "Standard PLC Project". Add the Tc2_En Ocean library to the PLC project under "References". Create a global variable list with the name GVL_En Ocean and create the following variables: VAR_GLOBAL st KL6581Input AT %I* : KL6581_Input; st KL6581Output AT %Q* : KL6581_Output; st KL6581 : STR_KL6581; END_VAR Name Type Description st KL6581Input KL6581_INPUT [} 41] Input variable for the En Ocean® terminal. st KL6581Output KL6581_Output [} 42] Output variable for the En Ocean® terminal. st KL6581 str_KL6581 [} 44] Required for the communication with En Ocean®. All En Ocean® function blocks must be called in the same task. Create a MAIN program (CFC) in which the function blocks FB_KL6581 [} 23] and FB_Rec_RPS_Switch [} 27] are called. Ensure that the communication block is linked with the structures st KL6581Input, st KL6581Output and st KL6581. 46 Version: 1.7.0 TE1000
## Page 47

Programming The input dw_ID of the receive block is linked with the local variable dw Id (ID from wireless switch module) and str_KL6581 with the global variable st KL6581. Go to the task configuration and give the task a lower interval time. Further conditions can be found in the description of the function block FB_KL6581 [} 23]. I/O configuration Select the CX as target system and initiate a search for its hardware. In the project instance within the PLC section, you can see that the input and output variables are assigned to the task. Now link the global variables with the inputs and outputs of the bus terminals. The linking of the En Ocean® variables is described in detail below. Right-click the structure st KL6581Input and select “Change link”. TE1000 Version: 1.7.0 47
## Page 48

Programming Under "I/O Configuration" select the terminal, select "All Types" and "Continuous", then select “Status” to “Input Status” with the left mouse button and the >SHIFT< key. Then click "OK". You can now check the link. To do this go onto the KL6581 and open it. All terminal data must now be marked with an arrow. If that is the case, then proceed in exactly the same way with the outputs. Also see about this 2 KL6581_INPUT [} 41] 2 KL6581_Output [} 42] 2 str_KL6581 [} 44] 48 Version: 1.7.0 TE1000
## Page 49

Appendix 5 Appendix 5.1 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TE1000 Version: 1.7.0 49
## Page 50

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H.
## Page 51

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
