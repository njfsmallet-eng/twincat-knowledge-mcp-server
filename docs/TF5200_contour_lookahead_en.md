---
title: "TF5200_contour_lookahead_en"
product: "TF5200"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.04"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5200_contour_lookahead_en.pdf"
release_date: "2024-07-09"
---
Functional description | EN TF5200 | Twin CAT 3 CNC Contour look-ahead 7/9/2024 | Version: 1.04
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5200 | Twin CAT 3 CNC Version: 1.04 3 Contour look-ahead
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 5

Table of contents Table of contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 Overview.................................................................................................................................................... 8 2 Description................................................................................................................................................ 9 2.1 Mode 1 – Request via index............................................................................................................ 11 2.2 Mode 2 - Request via distance from program start......................................................................... 13 2.3 PLC interface.................................................................................................................................. 15 2.3.1 User data.......................................................................................................................... 16 2.4 Examples (graphic)......................................................................................................................... 18 3 Programming........................................................................................................................................... 19 3.1 Contour look-ahead and real-time loops......................................................................................... 19 4 Parameter................................................................................................................................................. 21 4.1 Overview......................................................................................................................................... 21 4.2 Description...................................................................................................................................... 22 4.3 PLC parameters.............................................................................................................................. 24 5 Support and Service............................................................................................................................... 25 Index......................................................................................................................................................... 26 TF5200 | Twin CAT 3 CNC Version: 1.04 5 Contour look-ahead
## Page 6

Table of contents 6 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 7

List of figures List of figures Fig. 1 Example of a programmed contour with tool radius compensation............................................. 9 Fig. 2 Schematic diagram of a PLC request.......................................................................................... 10 Fig. 3 PLC request via index.................................................................................................................. 11 Fig. 4 Example of a logged programmed contour.................................................................................. 12 Fig. 5 Schematic diagram - distance and CLAH start_position.............................................................. 13 Fig. 6 Representation of the reply in PLC to distance request............................................................... 14 Fig. 7 Handshake - contour look-ahead control unit.............................................................................. 15 Fig. 8 Examples (graphic) of PLC requests........................................................................................... 18 TF5200 | Twin CAT 3 CNC Version: 1.04 7 Contour look-ahead
## Page 8

Overview 1 Overview Task The “contour look-ahead” function of the CNC provides the PLC with programmed contour elements on the HLI in advance. Effectiveness / possible applications Process parameters, such as velocity, can be optimised based on the information about the future contour. This function is an additional option requiring a license. Parameterisation The “contour look-ahead” function must be configured with the following parameters: • P-CHAN-00650 (alternatively P-STUP-00070) and • P-CHAN-00658 (alternatively P-STUP-00076). Programming In order to command the CNC to provide future contour elements on the HLI, • program sequences can be marked using the commands #CONTOUR LOOKAHEAD LOG ON/OFF [} 19] or • the PLC can send a request via the control unit [} 15]. Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. 8 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 9

Description 2 Description When optimising processes, it can be and advantage to know future contour elements in advance. The CNC can supply them using the contour look-ahead function. The PLC can use these elements to optimise the process parameters. Data provision is either programmed by NC commands or by request from the PLC. The data provided for future contour elements are: • Type of contour element: Linear block, circular block, polynomial block • Block number • Start position of the contour element • Length of the contour element • Swept angle, programmed and compensated radius • Program line number • Length of the scales geometry for die sinking EDM Fig. 1: Example of a programmed contour with tool radius compensation TF5200 | Twin CAT 3 CNC Version: 1.04 9 Contour look-ahead
## Page 10

Description Sequence of a PLC request The PLC sends a request to the CNC. The request contains either an index that belongs to a motion block ore a distance based on the program start. There are 2 modes for these two different requests: • Mode 1: Request via the index [} 11]. • Mode 2: Request via distance from program start [} 13]. The CNC then sends the reply information to this request for each motion block. The process looks like this: Fig. 2: Schematic diagram of a PLC request 10 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 11

Description 2.1 Mode 1 – Request via index This mode is available as of CNC Build V3.1.3105.01. To use Mode 1, a suitable value must be set for the parameter P-STUP-00033 [} 22]. In this mode, the PLC reads the look-ahead buffer of NC blocks of the CNC previously marked with the command #CONTOUR LOOKAHEAD LOG ON/OFF [} 19]. The information is provided before these blocks are actually executed. The PLC can set synchronisation with any stop conditions (e.g. M functions) to ensure that the PLC has all the necessary data. The command #CONTOUR LOOKAHEAD LOG [PARAM=<val>] is used to provide the PLC with an additional parameter value within a flagged area. Fig. 3: PLC request via index TF5200 | Twin CAT 3 CNC Version: 1.04 11 Contour look-ahead
## Page 12

Description Fig. 4: Example of a logged programmed contour In index mode, the individual elements can be requested multiple times, including backward motion on the path. The elements starting from the specified index are always output to the end. 12 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 13

Description 2.2 Mode 2 - Request via distance from program start This mode can only be used if P-CHAN-00658 [} 23] is parameterised. Every contour element is identifiable by the path distance covered. By default the distance starts at program start and is re-initialised with zero at every program start. The distance can also be reset in the NC program with the NC command #DISTANCE PROGRAM START CLEAR. While an NC program is in process, the distance covered is aggregated and displayed as the current distance. The start position of a contour element (CLAH ) is defined as: start_position If the PLC requests contour elements via distance, the correct distance must be specified for the blocks. The figure below is a schematic diagram of a programmed contour using tool radius compensation (TRC) and the relationship between distance and CLAH . start_position Fig. 5: Schematic diagram - distance and CLAH start_position TF5200 | Twin CAT 3 CNC Version: 1.04 13 Contour look-ahead
## Page 14

Description Properties of the look-ahead function: • The maximum look-ahead distance available in the CNC is supplied by the HLI in each cycle and can be requested by a PLC. This information can be used to detect and request new available contour elements (start distance of the last element + length of the last element < maximum look-ahead distance). • The maximum look-ahead distance depends on the internal buffer size of the interpolator and the block supply of the path preparation. • The maximum look-ahead distance is independent of feedhold, override, synchronised M functions or G04. Fig. 6: Representation of the reply in PLC to distance request 14 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 15

Description 2.3 PLC interface The following data is available on the HLI to use the function: 1. The current distance from program start on the path corrected for tool radius compensation is dis- played on the channel-specific HLI area (see bahn_state.dist_prog_start_high [} 24]). This distance can be used to request future contours in Mode 2. 2. The contour look-ahead control unit is provided to request and read out contour elements. The PLC requests information with increasing semaphore. The CNC supplies the information and deletes the semaphore afterwards. Fig. 7: Handshake - contour look-ahead control unit Contour look-ahead Description The PLC can use this control unit to request and read out information on contour elements from the CNC. The PLC can use this information to plan the look-ahead process. Data type HLI_CONTOUR_LOOKAHEAD ST path gp Ch[channel_idx]^.contour_lookahead Command data ST Element .request Data type HLI_CONTOUR_LOOKAHEAD_REQUEST [} 16] Access PLC writes request Return data ST element .response Data type HLI_CONTOUR_LOOKAHEAD_RESPONSE [} 16] Access PLC reads Flow control of commanded value ST element .semaphor_rw TF5200 | Twin CAT 3 CNC Version: 1.04 15 Contour look-ahead
## Page 16

Description Data type BOOL Value range [TRUE, FALSE] Special features Consumption data item Access TRUE : PLC triggers on new request FALSE : CNC has read new request Status value ST Element .state Data type HLI_CONTOUR_LOOKAHEAD_STATE [} 16] 2.3.1 User data Contour look-ahead request data Description Data to request the contour elements from the CNC ST path gp Ch[channel_idx]^.contour_lookahead.request ST name HLI_CONTOUR_LOOKAHEAD_REQUEST ST element .start_position Data type LREAL Description/ The meaning of the element is dependent on the mode of the contour look-ahead function special features used. Mode 1: Index of the contour element in the marked area Mode 2: Start distance from which the distance of the “length” parameter applies ST element .length Data type LREAL Description/ A distinction is made whether mode 1 or 2 should be used depending on the entry of this special features element. Value = 0 : Request contour element by index, mode 1 Value != 0: Request contour element by distance, mode 2 This mode indicates the distance up to which contour element is to be requested Contour look-ahead status data Description Status data of the contour look-ahead control unit ST Path gp Ch[channel_idx]^.contour_lookahead.state ST name HLI_INSERT_CMD_STATE ST element .max_dist_prog_start Data type LREAL Description Maximum look-ahead distance from program start in [0.1 µm]. ST element .count_logged_blocks Data type UDINT Description Number of available contour elements that can be read out. ST element .f_log_is_active Data type BOOL Description This flag signals whether logging is still active for the marked area and all contour elements were read in. TRUE : not all contour elements were read in Contour look-ahead return data Description Contour information supplied by the CNC ST Path gp Ch[channel_idx]^.contour_lookahead. response 16 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 17

Description ST name HLI_CONTOUR_LOOKAHEAD_RESPONSE ST Element .block[i] Data type HLI_CONTOUR_LOOKAHEAD_BLOCK [} 17] Description Structure HLI_CONTOUR_LOOKAHEAD_BLOCK Description Information on a contour element that was supplied to the PLC by the CNC ST Element .block_type Description Block type 0 – no element exists 1 - linear contour element 2 - circular contour element 3 - #CONTOUR LOOKAHEAD LOG ON 4 - #CONTOUR LOOKAHEAD LOG [PARAM] 5 - #CONTOUR LOOKAHEAD LOG OFF 6 – Polynomial contour element ST Element .block_number Description Programmed NC block number ST Element .block_count_r Description Unique NC block ID number Corresponds to the displayed number of block_count_r in the Status information of a channel. ST Element .start_position Description Start distance of the contour element from program start ST Element .length Description Length of the contour element of the programmed value of the PARAM. ST Element .programmed_radius Description Programmed radius of the circular element ST Element .compensated_radius Description Compensated radius of the circular element ST Element .circle_angle Description Swept angle of the circular element. • Clockwise [-2*pi,0) • Counter-clockwise (0,2*pi]. ST Element .length_min Description With die sinking, the length of the contour element is displayed on the scaled contour (radius = R_MAX_SCALE). ST Element .tangent_variation Description End angle to the previous motion block. (0,pi) TF5200 | Twin CAT 3 CNC Version: 1.04 17 Contour look-ahead
## Page 18

Description 2.4 Examples (graphic) Fig. 8: Examples (graphic) of PLC requests 18 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 19

Programming 3 Programming • Mode 1: Modifications required to the NC program. • Mode 2: Only controlled by the PLC. Syntax: #CONTOUR LOOKAHEAD LOG [ON | OFF | CLEAR] [ [ PARAM=.. ] ] ON Activate logging of contour elements by the NC command. OFF Deactivate logging of contour elements by the NC command. CLEAR The logging buffer is cleared at every program start. Use this NC command if the buffer needs to be cleared while the program is running to log a new area. Every time the buffer is cleared, decoding and execution are synchronised by an implicit #FLUSH&WAIT. Clearing can be executed while logging is active or inactive. PARAM=.. This parameter allows the user to add an user-defined additional parameter (8 byte floating value) in the log entry. If #CONTOUR LOOKAHEAD LOG ON is detected several times while a program is running, only the first marked area is provided. The command #CONTOUR LOOKAHEAD LOG CLEAR can be used to delete the last marked area. The next area is then supplied again with #CONTOUR LOOKAHEAD LOG ON. 3.1 Contour look-ahead and real-time loops There are two programming options to obtain contour elements in a real-time loop (#RT WHILE/ ENDWHILE) in Mode 1: 1. Only one geometry is provided when programming #CONTOUR LOOKAHEAD LOG ON/OFF within a real-time loop. It has the properties of the entry loop, which means the parameter "tangent_variation [} 17]" has the angle to the motion block before the loop. 2. If #CONTOUR LOOKAHEAD LOG ON/OFF is programmed outside the real-time loop, the elements are supplied three times to obtain all the properties of the possible transitions. The transitions are: ◦ start of loop ◦ loop-loop ◦ end of loop NOTICE Do not program the NC command #CONTOUR LOOKAHEAD CLEAR within a real-time loop. If the command is programmed within the real-time loop, error ID 22073 is output. Behaviour of contour look-ahead within a real-time loop In this programming example, the contour look-ahead function is programmed within a real-time loop. The contour of the motion blocks 80 - 120 is logged once. N060 #RT WHILE N070 #CONTOUR LOOKAHEAD LOG ON [PARAM=1] N080 G1 X4 Y4 … N120 G1 X0 Y0 N130 #CONTOUR LOOKAHEAD LOG ON [PARAM=8] N140 #RT ENDWHILE TF5200 | Twin CAT 3 CNC Version: 1.04 19 Contour look-ahead
## Page 20

Programming Behaviour of contour look-ahead outside a real-time loop In this programming example, the contour look-ahead is programmed outside a real-time loop. The contour of the motion blocks 80 to 120 is logged three times. N060 #CONTOUR LOOKAHEAD LOG ON [PARAM=1] N070 #RT WHILE N080 G1 X4 Y4 … N120 G1 X0 Y0 N130 #RT ENDWHILE N140 #CONTOUR LOOKAHEAD LOG ON [PARAM=8] 20 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 21

Parameter 4 Parameter 4.1 Overview ID start-up parameters Description P-STUP-00033 fb_storage_size[i] Memory size for backward motion ID Channel parameters Description P-CHAN-00650 function Activating functions (alternative to P-STUP-00070) P-CHAN-00658 contour_lookahead_log Maximum number of logged contour elements in the look-ahead _max area. (alternative P-STUP-00076) TF5200 | Twin CAT 3 CNC Version: 1.04 21 Contour look-ahead
## Page 22

Parameter 4.2 Description Start-up parameters P-STUP-00033 Memory size for backward motion Description This parameter defines the memory size in bytes used for backward motion on the path. During start-up, the NC checks whether the required minimum size is available. If this is not the case, a warning is output and the memory size is set to the required minimum value. If the size is set to 0, the “forward/ backward motion on the path” function is not available. The maximum size is only limited by the resources available on the PC. Parameter fb_storage_size[i] where i = 0 to 11 (maximum number of channels: 12, application-specific) Data type UNS32 Data range 0 ... MAX(UNS32) Dimension ---- Default value 0 Remarks Channel parameters P-CHAN-00650 Definition of interpolator functionalities Description This parameter defines individual functionalities and the size of the look-ahead buffer in the interpolator, i.e. it defines the number of blocks required to calculate deceleration distance and dynamic planning. Parameter configuration.interpolator.function Data type STRING Data range See Description [} 23] Dimension ---- Default value FCT_IPO_DEFAULT Remarks 22 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 23

Parameter Interpolation function table Identifier Description FCT_IPO_DEFAULT FCT_LOOK_AHEAD_STANDARD FCT_LOOK_AHEAD_LOW 30 blocks FCT_LOOK_AHEAD_STANDARD 120 blocks FCT_LOOK_AHEAD_HIGH 190 blocks FCT_LOOK_AHEAD_CUSTOM Any number of look-ahead blocks in the interval [ 0; 200]. Specification by parameter P-CHAN-00653. FCT_SYNC Synchronisation of an axis on a path group. Example: FCT_IPO_DEFAULT | FCT_SYNC FCT_LOOK_AHEAD_OPT The path velocity curve can be further improved for HSC machining by additional calculations. This generally reduces machining time. The additional calculations place greater demands on the controller hardware. FCT_LIFT_UP_TIME Automatic lifting/lowering of an axis (time-based coupling). Example: FCT_IPO_DEFAULT | FCT_LIFT_UP_TIME FCT_SHIFT_NCBL Path-controlled offset of M functions (dwell time). Example: FCT_IPO_DEFAULT | FCT_SHIFT_NCBL FCT_CALC_STATE_AT_T Calculation of path velocity at a time in the future. Function only available in combination with HSC slope and only as of V3.1.3057.0 Example: FCT_IPO_DEFAULT | FCT_CALC_STATE_AT_T FCT_CALC_TIME Calculation of interpolation time to next feed block (G01,G02,G03). Example: FCT_IPO_DEFAULT | FCT_CALC_TIME FCT_CONTOUR_LAH Contour look-ahead: advance output of motion blocks to the PLC as of V3.1.3104.07 FCT_DYN_POS_LIMIT Dynamic limitation of axis positions FCT_EXTENSION_EQUIDIST Die-sinking EDM Planetary expansion The look-ahead buffer size values specified above apply as of CNC Builds V2.11.2800 and higher; the following settings apply to CNC Build V2.11.20xx: FCT_LOOK_AHEAD_LOW 30 blocks FCT_LOOK_AHEAD_STANDARD 70 blocks FCT_LOOK_AHEAD_HIGH 120 blocks P-CHAN-00658 Maximum number of logged contour elements in the contour look-ahead. Description This parameter can be used to set the maximum number of stored motion blocks that can be supplied to the PLC in advance. The CNC command #CONTOUR LOOKAHEAD LOG [] can be used to activate the save function. FCT_CONTOUR_LAH must be enabled in P-CHAN-00650 [} 22] for this functionality. configuration.interpolator.fct_enable[0] FCT_IPO_DEFAULT|FCT_CONTOUR_LAH Parameter configuration.interpolator.contour_lookahead_log_max Data type UNS32 Data range 0 <= contour_lookahead_log_max < MAX_UNS32 Dimension ---- Default value 128 Remarks Parameter available as of V3.1.3107.10 TF5200 | Twin CAT 3 CNC Version: 1.04 23 Contour look-ahead
## Page 24

Parameter 4.3 PLC parameters Currently covered path in the NC program (PCS) Description Reads the current distance covered in the NC program since program start or since the last # DISTANCE PROG START CLEAR NC command. The calculation is based on the current position in the current NC block. Signal flow CNC → PLC ST path gp Ch[channel_idx]^.bahn_state.dist_prog_start Data type UDINT (* LREAL) Unit 0.1 µm Access PLC is reading Special features * As of CNC Build V3.1.3104.01 the data element is provided in LREAL forma. 24 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 25

Support and Service 5 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TF5200 | Twin CAT 3 CNC Version: 1.04 25 Contour look-ahead
## Page 26

Index Index C Contour look ahead control unit 15 request 16 response 16 state 16 covered path current:NC program 24 K Kontur-Look-Ahead Anforderungsdaten 16 Kontur-Look-Ahead Control Unit 15 N NC program covered path:current 24 P P-CHAN-00650 22 P-CHAN-00658 23 PCS covered path:NC block:to go 24 P-STUP-00033 22 R Rückgabedaten Kontur-Look-Ahead 16 S Statusdaten Kontur-Look-Ahead 16 26 Version: 1.04 TF5200 | Twin CAT 3 CNC Contour look-ahead
## Page 28

More Information: www.beckhoff.com/TF5200 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
