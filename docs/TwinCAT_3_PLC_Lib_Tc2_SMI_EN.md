---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.9.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_SMI_EN.pdf"
release_date: "2025-05-15"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc2_SMI 2025-05-15 | Version: 1.9.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 SMI.............................................................................................................................................................. 9 3.1 Device addressing............................................................................................................................. 9 4 Programming........................................................................................................................................... 11 4.1 POUs............................................................................................................................................... 11 4.1.1 Base................................................................................................................................. 12 4.1.2 Basic commands.............................................................................................................. 19 4.1.3 Addressing commands..................................................................................................... 41 4.1.4 System commands........................................................................................................... 51 4.1.5 Error codes....................................................................................................................... 55 4.2 DUTs............................................................................................................................................... 56 4.2.1 Enums.............................................................................................................................. 56 4.2.2 Structures......................................................................................................................... 59 4.3 Integration into Twin CAT................................................................................................................. 61 4.3.1 KL6831 with CX5120....................................................................................................... 61 5 Appendix.................................................................................................................................................. 65 5.1 Example: Configuration of SMI devices.......................................................................................... 65 5.2 Manufacturer codes........................................................................................................................ 66 5.3 Support and Service........................................................................................................................ 67 TE1000 Version: 1.9.0 3
## Page 4

Table of contents 4 Version: 1.9.0 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1000 Version: 1.9.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.9.0 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.9.0 7
## Page 8

Introduction 2 Introduction The user of this library requires basic knowledge of the following: • Twin CAT XAE • PC and network knowledge • Structure and properties of the Beckhoff Embedded PC and its Bus Terminal system • Technology of SMI devices • Relevant safety regulations for building technical equipment This software library is intended for building automation system partners of Beckhoff Automation Gmb H & Co. KG. The system partners operate in the field of building automation and are concerned with the installation, commissioning, expansion, maintenance and service of measurement, control and regulating systems for the technical equipment of buildings. The Tc2_SMI library is usable on all hardware platforms that support Twin CAT 3.1 or higher. Hardware documentation KL6831_KL6841 in the Beckhoff information system. 8 Version: 1.9.0 TE1000
## Page 9

SMI 3 SMI The automation of roller shutters and sun blinds in building automation is simplified with the SMI-Bus system (Standard Motor Interface). With SMI drives roller shutters can drive to precise positions and blind drives can drive to angular positions with an accuracy of a degree. The SMI drives can transmit actual positions, error messages and service information back to the SMI master terminal. Major European manufacturers have joined forces in the SMI working group and have developed the digital interface. Drives are controlled by means of telegrams via this uniform interface. Using standard commands, functions can be implemented that are not so easy to realize with conventional drives. Examples are the precise movement to positions, the feedback of the current position and diagnosis. For the adjustment of louvers in shading systems, for example, angular resolutions of 2° can be achieved. Adjustment of the louvers in relation to the position of the sun is thus possible for constant light control. Powerful PLC function blocks are available in the Twin CAT HVAC library for room automation according to VDI 3813. Distances of up to 350 meters between the controller and the drive are possible. A normal 5-core power cable can be used for the cabling (with PE, N, L and the SMI-specific I+ and I-); I+ and I- are protected against pole reversal. Up to 16 drives can be connected in parallel and addressed individually. SMI drives are available for mains voltage (230 V AC) and for low voltage (24 V DC). In order to ensure the compatibility of the SMI products with one another, all products that are to be marked with the SMI logo must be certified. A positive certification can be read on the SMI Group’s homepage (https://standard-motor-interface.com). Further information on the SMI-Bus and SMI drives can also be found there. 3.1 Device addressing SMI defines various modes of device addressing. In principle distinction can be made between individual addressing, group addressing and the collective call (broadcast). Most PLC function blocks have the dw Addr input and e Addr Type for this. While the dw Addr input contains the necessary address details, e Addr Type defines the mode of addressing. The individual modes of addressing are described below. Note that not every command supports all addressing modes. Details can be found in the description of the respective PLC function block. by the address of a device (e Addr Type: = e SMIAddr Type Address) Each SMI device can be assigned an address from 0 to 15. The address is stored in the SMI device and must be correctly set again when exchanging the drive. Since each address should only be assigned once, each SMI device can be addressed individually. With this mode of addressing the dw Addr input contains the address in the range 0 to 15. If a value outside the valid range is specified, then the respective function block outputs an error [} 55]. This address is also occasionally called the slave address. The slave address must not be confused with the slave ID (see below). per slave ID (e Addr Type := e SMIAddr Type Slave Id) The individual device manufacturers store a unique 32-bit number in each SMI device. This slave ID, also called the key ID, can also be used for the addressing of a device. With this mode of addressing the dw Addr input contains the 32-bit slave ID and the dw Addr Option input contains the manufacturer code (see below). This ensures that SMI devices can be addressed worldwide without them requiring an address. With some SMI devices the slave ID is printed on the name plate or is made visible by a label on the cable. Most read commands do not support addressing by Slave ID. by the manufacturer code (e Addr Type := e SMIAddr Type Manufacturer) In addition to the slave ID, SMI defines a further unique ID, the so-called manufacturer code [} 66]. The manufacturer code is permanently stored in the SMI device and cannot be changed. The possible range of values is from 0 to 15, wherein the values 0 and 14 have a special meaning. The manufacturer code 0 addresses all devices, irrespective of the manufacturer. This addressing mode can therefore also be used to dispatch broadcast commands. The value 15 is reserved for future expansions and may not be used. The TE1000 Version: 1.9.0 9
## Page 10

SMI English designation manufacturer code or the abbreviation M-ID is frequently found here. All devices from a manufacturer are always addressed by this addressing. With this mode of addressing the dw Addr input contains the manufacturer code in the range from 0 to 14. If a value outside the valid range is specified, then the respective function block outputs an error [} 55]. With some SMI devices the manufacturer code is printed on the name plate or is made visible by a label on the cable. by group addressing (e Addr Type: = e SMIAddr Type Group) Each device that is to be controlled via group addressing must have an address from 0 to 15. Each bit of the dw Addr input corresponds to an address in the case of group addressing. If bit 0 of dw Addr is set, then the device with the address 0 is addressed. If bit 1 is set, then device 1 is addressed and so on. The group addressing thus occupies the bits 0 to 15, which corresponds to a range of values from 0 to 65535. If a value outside the valid range is specified, then the respective function block outputs an error [} 55]. Example: The drives with the addresses 1, 4, 7 and 12 are to be addressed. The value 2#00010000_10010010 or 16#1092 or 4242 must therefore be supplied to dw Addr. by Broadcast (e Addr Type := e SMIAddr Type Broadcast) When addressing by broadcast all devices are always addressed, irrespective of the address set on the device. The dw Addr input is not required with this method of addressing and is not evaluated either. Internally the PLC function blocks use addressing by manufacturer code, wherein the manufacturer code 0 is used. 10 Version: 1.9.0 TE1000
## Page 11

Programming 4 Programming 4.1 POUs Basic commands Name Description FB_KL6831KL6841Communication [} 12] Reads the SMI commands sequentially from the internal buffer of the PLC library and forwards them to the KL6831/KL6841. FB_KL6831KL6841Config [} 15] This function block can be used to configure the KL6831/ KL6841. FB_SMISend SMICommand [} 17] This function block is for the general sending of an SMI command. Basic commands Name Description FB_SMIDiag All [} 19] Diagnostic telegram is sent. FB_SMIDown [} 22] Motor run to the lower end position. FB_SMIDown Step [} 23] Motor runs downwards by a specified angle. FB_SMIPos1 [} 24] Drives to the fixed position Pos1 configured on the motor side. FB_SMIPos1Read [} 26] Reads the fixed position Pos1 configured on the motor side. FB_SMIPos1Write [} 27] Writes the fixed position Pos1 which is configured on the motor side. FB_SMIPos2 [} 28] Drives to the fixed position Pos2 configured on the motor side. FB_SMIPos2Read [} 30] Reads the fixed position Pos2 configured on the motor side. FB_SMIPos2Write [} 31] Writes the fixed position Pos2 which is configured on the motor side. FB_SMIPos Read [} 33] Reads the current position. FB_SMIPos Write [} 34] Drives to a position. FB_SMIStop [} 35] Stops the motor run. FB_SMISyn [} 37] Queries the manufacturer code and drive type. FB_SMIUp [} 38] Motor run to the upper end position. FB_SMIUp Step [} 39] Motor run upwards by a specified angle. Addressing commands Name Description FB_SMIAddressing [} 41] Addresses SMI devices. FB_SMIDiscovery Slave Id [} 42] Searches for SMI devices by manufacturer code. FB_SMISlave Addr Read [} 44] Reads the address (0-15) of a drive. FB_SMISlave Addr Write [} 45] Writes an address (0-15) to one or more drives. FB_SMISlave Id Compare [} 46] Compares a specified slave ID (32-bit key ID) with the slave ID (32-bit key ID) of one or more drives, which is defined on the motor side. FB_SMISlave Id Read [} 49] Reads the slave ID (32-bit Key ID). TE1000 Version: 1.9.0 11
## Page 12

Programming System commands Name Description FB_SMIPar Value Read Byte [} 51] Reads a byte parameter (1 byte) stored on the motor side. FB_SMIPar Value Read Word [} 52] Reads a Word parameter (2 bytes) stored on the motor side. FB_SMIPar Value Read DWord [} 53] Reads a DWord parameter (4 bytes) stored on the motor side. 4.1.1 Base 4.1.1.1 FB_KL6831KL6841Communication The function blocks for the SMI commands do not directly access the process image of the KL6831/KL6841; instead, they place the individual SMI commands into three different buffers. The function block FB_KL6831KL6841Communication() sequentially reads the SMI commands from these three buffers and forwards the SMI commands to the KL6831/KL6841. This prevents multiple function blocks accessing the KL6831/KL6841 process image simultaneously. Each of these three buffers is processed with a different priority (high, medium or low). The parameter e Command Priority, which is available for most function blocks, can be used to influence the priority with which the respective SMI command is processed by the function block FB_KL6831KL6841Communication(). The buffers in which the SMI commands are stored are all contained in a variable of the type ST_SMICommand Buffer. For each KL6831/KL6841 there is an instance of the function block FB_KL6831KL6841Communication() and a variable of the type ST_SMICommand Buffer. If possible, the function block FB_KL6831KL6841Communication() should be called in a separate, faster task. The extent to which the buffers are utilized can be determined from the outputs of the function block. Three arrays are output for this in which each element (0, 1 or 2) represents one of the three buffers (high, middle or low). If you detect regular overflow for one of the three buffers, you should consider the following: • How heavily are the individual PLC tasks utilized? Twin CAT XAE provides suitable analysis tools. • Try reducing the cycle time of the task in which the function block FB_KL6831KL6841Communication() is called. The value should not exceed 6 ms. Ideally it should be 2 ms. • Check the cycle time of the PLC task in which the function blocks for the individual SMI commands are called. This value should be between 10 ms and 60 ms. • If possible avoid polling (regular reading) of values. Only read values when they are actually required. • Distribute the individual drives evenly over several SMI lines. Since several SMI lines are processed simultaneously per PLC cycle, the data throughput as a whole is increased as a result. Inputs VAR_INPUT b Reset Maximum Demand Counter : BOOL; b Reset Overflow Counter : BOOL; b Reset Inactive Process Image : BOOL; 12 Version: 1.9.0 TE1000
## Page 13

Programming b Reset Data Frame Error : BOOL; dw Options : DWORD := 0; END_VAR Name Type Description b Reset Maximum De BOOL A positive edge resets the stored value of the maximum mand Counter command buffer demand (arr Buffer Maximum Demand Meter). b Reset Overflow Cou BOOL A positive edge resets the stored value of the number of nter command buffer overflows (arr Buffer Overflow Counter). b Reset Inactive Proce BOOL A positive edge cancels the blocking of the process image ss Image of the terminal. The outputs b Process Image Inactive, b Digital Input1Active and b Digital Input2Active are again set to FALSE. The blocking is activated as soon as one of the digital inputs Input1 or Input2 on the terminal is actuated. b Reset Data Frame Er BOOL A positive edge resets the message for a telegram error. ror The output b Data Frame Error is set again to FALSE. The blocking is activated as soon as the terminal detects a telegram error. dw Options DWORD Reserved for future extensions Inputs/outputs VAR_IN_OUT st In Data : ST_KL6831KL6841In Data; st Out Data : ST_KL6831KL6841Out Data; st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st In Data ST_KL6831KL6841In Data Reference to the structure for communication with the KL6831/KL6841 [} 59] st Out Data ST_KL6831KL6841Out Data Reference to the structure for communication with the KL6831/KL6841 [} 59] st Command Buffer ST_SMICommand Buffer Reference to the structure for communication with the SMI function blocks [} 59] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; arr Buffer Demand Meter : ARRAY [0..2] OF BYTE; arr Buffer Maximum Demand Meter : ARRAY [0..2] OF BYTE; arr Buffer Overflow Counter : ARRAY [0..2] OF UINT; b Line Is Initialized : BOOL; b24VPower Supply Switched On : BOOL; b Digital Input1Active : BOOL; b Digital Input2Active : BOOL; b Process Image Inactive : BOOL; b Data Frame Error : BOOL; b Checksum Error : BOOL; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. TE1000 Version: 1.9.0 13
## Page 14

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). arr Buffer Demand Me ARRAY OF BYTE Demand of the respective buffer (0 - 100%) ter arr Buffer Maximum D ARRAY OF BYTE Previous maximum demand of the respective buffer (0 - emand Meter 100%) arr Buffer Overflow Co ARRAY OF BYTE Number of buffer overflows to date unter b Line Is Initialized BOOL If the function block is called for the first time (e.g. when starting the controller), initialization is carried out. No SMI commands can be processed during this time. This output is set to TRUE once the initialization has been completed. b24VPower Supply S BOOL The KL6831/KL6841 must be supplied with 24 V DC via witched On two connections. The output is set as soon as 24 V DC is detected. If there is no 24 V DC the output goes FALSE and no SMI commands can be processed by the controller as long as there is no 24 V DC. b Digital Input1Active BOOL The digital input Input1 on the terminal has been or is actuated (see also the terminal documentation). The output b Process Image Inactive is set and no further SMI commands can be processed by the controller. b Digital Input2Active BOOL The digital input Input2 on the terminal has been or is actuated (see also the terminal documentation). The output b Process Image Inactive is set and no further SMI commands can be processed by the controller. b Process Image Inact BOOL One of the digital inputs Input1 or Input2 has been ive actuated on the terminal. No further SMI commands can be processed by the controller. The blockage must be released again via the input b Reset Inactive Process Image. b Data Frame Error BOOL The terminal has detected a telegram error on the SMI bus. The error must be reset via the input b Reset Data Frame Error. b Checksum Error BOOL The terminal has detected a checksum error on the SMI bus. The message is automatically reset as soon as a telegram is transmitted without error once again. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 14 Version: 1.9.0 TE1000
## Page 15

Programming 4.1.1.2 FB_KL6831KL6841Config The function block FB_KL6831KL6841Config is used to configure the KL6831/KL6841. The configuration is executed when the PLC program starts, or it can be triggered by a positive edge at the input b Configurate. The parameters are stored in the respective registers of the KL6831/KL6841 in a fail-safe manner. In addition, some general information, such as the firmware version, is read from the KL6831/KL6841. Example: The function block is called in the same task as the function block FB_KL6831KL6841Communication(). The function block FB_KL6831KL6841Config() is linked to the process image of the KL6831/KL6841. Once the configuration is complete, the function block FB_KL6831KL6841Communication() receives the process values of the KL6831/KL6841. No SMI commands can be sent while the configuration is in progress. Sample See https://infosys.beckhoff.com/content/1033/tcplclib_tc2_smi/Resources/3248663563.zip TE1000 Version: 1.9.0 15
## Page 16

Programming Inputs VAR_INPUT b Configurate : BOOL := FALSE; e Command KBus Watchdog : E_SMIConfiguration Commands := e SMICommand Do Nothing; e Command DI1Rising Edge : E_SMIConfiguration Commands := e SMICommand Up; e Command DI1Falling Edge : E_SMIConfiguration Commands := e SMICommand Stop; e Command DI2Rising Edge : E_SMIConfiguration Commands := e SMICommand Down; e Command DI2Falling Edge : E_SMIConfiguration Commands := e SMICommand Stop; dw Options : DWORD := 0; END_VAR Name Type Description b Configurate BOOL Configuration of the bus terminal is started by a positive edge at this input. e Command KBus Wa E_SMIConfiguration Comm Defines the SMI command that is sent as soon as the bus tchdog terminal is no longer addressed via the K-bus. ands [} 56] Corresponds to register 33 to 35 of the bus terminal. e Command DI1Risin E_SMIConfiguration Comm Defines the SMI command that is sent as soon as a rising g Edge edge is detected at input 1 of the bus terminal. ands [} 56] Corresponds to register 36 to 38 of the bus terminal. e Command DI1Fallin E_SMIConfiguration Comm Defines the SMI command that is sent as soon as a falling g Edge edge is detected at input 1 of the bus terminal. ands [} 56] Corresponds to register 39 to 41 of the bus terminal. e Command DI2Risin E_SMIConfiguration Comm Defines the SMI command that is sent as soon as a rising g Edge edge is detected at input 2 of the bus terminal. ands [} 56] Corresponds to register 42 to 44 of the bus terminal. e Command DI2Fallin E_SMIConfiguration Comm Defines the SMI command that is sent as soon as a falling g Edge edge is detected at input 2 of the bus terminal. ands [} 56] Corresponds to register 45 to 47 of the bus terminal. dw Options DWORD Reserved for future extensions Inputs/outputs VAR_IN_OUT st In Data Terminal : ST_KL6831KL6841In Data; st Out Data Terminal : ST_KL6831KL6841Out Data; st In Data : ST_KL6831KL6841In Data; st Out Data : ST_KL6831KL6841Out Data; END_VAR Name Type Description st In Data Terminal ST_KL6831KL6841In Data Reference to the structure for communication with the KL6831/KL6841 [} 59] st Out Data Terminal ST_KL6831KL6841Out Data Reference to the structure for communication with the KL6831/KL6841 [} 59] st In Data ST_KL6831KL6841In Data Reference to the structure for communication with the [} 59] function block FB_KL6831KL6841Communication() [} 12] st Out Data ST_KL6831KL6841Out Data Reference to the structure for communication with the [} 59] function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; w Terminal Description : WORD; w Firmware Version : WORD; s Description : STRING; END_VAR 16 Version: 1.9.0 TE1000
## Page 17

Programming Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). w Terminal Descriptio WORD Contains the terminal name (e.g. 6831). Corresponds to n register 8 of the bus terminal. w Firmware Version WORD Contains the firmware version. Corresponds to register 9 of the bus terminal. s Description STRING Terminal name and firmware version as string (e.g. 'Terminal KL6831 / Firmware 1D') Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.32 Tc2_SMI from 3.3.6.0 4.1.1.3 FB_SMISend SMICommand The function block FB_SMISend SMICommand is used for the general sending of an SMI command. The precise structure of an SMI command and the functioning of the KL6831/KL6841 must be known for this. The use of this function block is necessary only if an SMI command is to be sent that is not covered by the other PLC function blocks. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; e Command Type : E_SMICommand Type := e SMICommand Type Write; e Response Format : E_SMIResponse Format := e SMIResponse Format Diagnosis; arr Identification Bytes : ARRAY [0..2] OF BYTE; arr Parameters : ARRAY [0..2] OF DWORD; b Suppress Response Buffer : BOOL := FALSE; dw Options : DWORD := 0; END_VAR TE1000 Version: 1.9.0 17
## Page 18

Programming Name Type Description b Start BOOL The function block is activated by a positive edge at this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] e Command Type E_SMICommand Type Command type: Write/Read. This parameter affects bit 5 of the start byte of the SMI telegram. [} 57] e Response Format E_SMIResponse Format Response format: diagnostic special format/standard. This parameter affects bit 6 of the start byte of the SMI [} 59] telegram. arr Identification Byte ARRAY OF BYTE An SMI telegram can consist of up to 3 blocks. Each block s possesses an identification byte. This array defines the three identification bytes. arr Parameters ARRAY OF DWORD An SMI telegram can consist of up to 3 blocks. Each block has up to four value bytes. This array defines the value bytes of each block. b Suppress Response BOOL If this input is set to TRUE, the internal software buffer is Buffer not filled with the responses of the function block FB_KL6831KL6841Communication() [} 12]. dw Options DWORD Reserved for future extensions Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; arr Response Data : ARRAY [0..7] OF BYTE; by Response Data Length : BYTE; by Response Identification Byte : BYTE; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. 18 Version: 1.9.0 TE1000
## Page 19

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). arr Response Data ARRAY OF BYTE The data received from the SMI devices by Response Data Le BYTE The length of the data received in bytes ngth by Response Identific BYTE The received identification byte ation Byte Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2 Basic commands 4.1.2.1 FB_SMIDiag All The function block FB_SMIDiag All can be used to determine in which direction the drives are moving, whether they are stopped or whether there is a motor error. The command can also be sent also to several SMI slaves. The states of all SMI slaves can thus be queried with a single command. The result of the query is forwarded by four outputs. Each of these outputs can assume three states: • The condition applies to at least one drive. • The condition does not apply to any drive. • The condition could not be determined. Some examples of this are explained further below. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. TE1000 Version: 1.9.0 19
## Page 20

Programming Name Type Description dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Specifies whether the input dw Addr is to be evaluated as manufacturer code [} 66], address of a device or for group addressing. Addressing via slave ID (e Addr Type = e SMIAddr Type Slave Id) is not permitted. dw Addr Option DWORD Reserved for future extensions e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; e Res Drives Up : E_SMIDiag Res Drives Up; e Res Drives Down : E_SMIDiag Res Drives Down; e Res Is Stopped : E_SMIDiag Res Is Stopped; e Res With Error : E_SMIDiag Res With Error; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). e Res Drives Up E_SMIDiag Res Drives Up At least one motor is driving up / no motor is driving up / the value is undefined [} 58] e Res Drives Down E_SMIDiag Res Drives Down At least one motor is driving down. / no motor is driving down. / the value is undefined. [} 58] e Res Is Stopped E_SMIDiag Res Is Stopped At least one motor is stopped. / no motor is stopped. / the value is undefined. [} 58] e Res With Error E_SMIDiag Res With Error At least one motor is faulty. / no motor is faulty. / the value is undefined. [} 58] 20 Version: 1.9.0 TE1000
## Page 21

Programming Examples All drives have stopped: Outputs Meaning e Res Drives Up = e SMIDiag Res No Motor Drives Up No drive is driving up e Res Drives Down = No drive is driving down e SMIDiag Res No Motor Drives Down e Res Is Stopped = At least one drive is stopped e SMIDiag Res At Least One Motor Is Stopped e Res With Error = e SMIDiag Res No Motor With Error No drive has a motor error All drives are driving up: Outputs Meaning e Res Drives Up = At least one drive is driving up e SMIDiag Res At Least One Motor Drives Up e Res Drives Down = No drive is driving down e SMIDiag Res No Motor Drives Down e Res Is Stopped = e SMIDiag Res No Motor Is Stopped No drive is stopped e Res With Error = e SMIDiag Res No Motor With Error No drive has a motor error One drive is stopped and one drive is driving up: Outputs Meaning e Res Drives Up = At least one drive is driving up e SMIDiag Res At Least One Motor Drives Up e Res Drives Down = No drive is driving down e SMIDiag Res No Motor Drives Down e Res Is Stopped = At least one drive is stopped e SMIDiag Res At Least One Motor Is Stopped e Res With Error = e SMIDiag Res No Motor With Error No drive has a motor error One drive is stopped, one drive is driving up and one drive is driving down: Outputs Meaning e Res Drives Up = At least one drive is driving up e SMIDiag Res At Least One Motor Drives Up e Res Drives Down = At least one drive is driving down e SMIDiag Res At Least One Motor Drives Down e Res Is Stopped = At least one drive is stopped e SMIDiag Res At Least One Motor Is Stopped e Res With Error = e SMIDiag Res No Motor With Error No drive has a motor error Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 TE1000 Version: 1.9.0 21
## Page 22

Programming 4.1.2.2 FB_SMIDown The function block FB_SMIDown controls the motor run to the lower end position. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. 22 Version: 1.9.0 TE1000
## Page 23

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.3 FB_SMIDown Step The function block FB_SMIDown Step controls the motor run downwards by a specified angle (0-510 degrees). Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; ui Angle : UINT := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] ui Angle UINT The specified angle. The value range is 0...510 degrees. The SMI standard reduces the accuracy to a resolution of 2 degrees. TE1000 Version: 1.9.0 23
## Page 24

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.4 FB_SMIPos1 The function block FB_SMIPos1 realizes the movement to the fixed position Pos1 configured on the motor side. Pos1 can be read and changed using the function blocks FB_SMIPos1Read() [} 26] and FB_SMIPos1Write() [} 27]. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR 24 Version: 1.9.0 TE1000
## Page 25

Programming Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 TE1000 Version: 1.9.0 25
## Page 26

Programming 4.1.2.5 FB_SMIPos1Read The function block FB_SMIPos1Read reads the fixed position Pos1 configured on the motor side. Pos1 can be changed with the function block FB_SMIPos1Write() [} 27]. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Specifies whether the input dw Addr is to be evaluated as manufacturer code [} 66], address of a device or for group addressing. Addressing via slave ID (e Addr Type = e SMIAddr Type Slave Id) is not permitted. dw Addr Option DWORD Reserved for future extensions e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; w Position : WORD; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. 26 Version: 1.9.0 TE1000
## Page 27

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). w Position WORD The read fixed position Pos1. The value 0 corresponds here to the upper end position and the value 65535 (0x FFFF) to the lower end position. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.6 FB_SMIPos1Write The function block FB_SMIPos1Write writes the fixed position Pos1 that can be configured on the motor side. Pos1 can be read with the function block FB_SMIPos1Read() [} 26]. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; w Position : WORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] TE1000 Version: 1.9.0 27
## Page 28

Programming Name Type Description w Position WORD The new fixed position Pos1. The value 0 corresponds here to the upper end position and the value 65535 (0x FFFF) to the lower end position. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.7 FB_SMIPos2 The function block FB_SMIPos2 controls the movement to the fixed position Pos2 configured on the motor side. Pos2 can be read and changed using the function blocks FB_SMIPos2Read() [} 30] and FB_SMIPos2Write() [} 31]. 28 Version: 1.9.0 TE1000
## Page 29

Programming Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). TE1000 Version: 1.9.0 29
## Page 30

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.8 FB_SMIPos2Read The function block FB_SMIPos2Read reads the fixed position Pos2 configured on the motor side. Pos2 can be changed with the function block FB_SMIPos2Write() [} 31]. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Specifies whether the input dw Addr is to be evaluated as manufacturer code [} 66], address of a device or for group addressing. Addressing via slave ID (e Addr Type = e SMIAddr Type Slave Id) is not permitted. dw Addr Option DWORD Reserved for future extensions e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; 30 Version: 1.9.0 TE1000
## Page 31

Programming udi Error Id : UDINT; w Position : WORD; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). w Position WORD The read fixed position Pos1. The value 0 corresponds here to the upper end position and the value 65535 (0x FFFF) to the lower end position. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.9 FB_SMIPos2Write The function block FB_SMIPos2Write writes the fixed position Pos2 that can be configured on the motor side. Pos2 can be read with the function block FB_SMIPos2Read() [} 30]. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; w Position : WORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. TE1000 Version: 1.9.0 31
## Page 32

Programming Name Type Description e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] w Position WORD The new fixed position Pos2. The value 0 corresponds here to the upper end position and the value 65535 (0x FFFF) to the lower end position. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 32 Version: 1.9.0 TE1000
## Page 33

Programming 4.1.2.10 FB_SMIPos Read The function block FB_SMIPos Read reads the current position from the drive. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Specifies whether the input dw Addr is to be evaluated as manufacturer code [} 66], address of a device or for group addressing. Addressing via slave ID (e Addr Type = e SMIAddr Type Slave Id) is not permitted. dw Addr Option DWORD Reserved for future extensions e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; w Position : WORD; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. TE1000 Version: 1.9.0 33
## Page 34

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). w Position WORD The read fixed position Pos1. The value 0 corresponds here to the upper end position and the value 65535 (0x FFFF) to the lower end position. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.11 FB_SMIPos Write The function block FB_SMIPos Write moves the drive to the specified position. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; w Position : WORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] 34 Version: 1.9.0 TE1000
## Page 35

Programming Name Type Description w Position WORD The new position. The value 0 corresponds here to the upper end position and the value 65535 (0x FFFF) to the lower end position. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.12 FB_SMIStop The function block FB_SMIStop stops the motor run. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; TE1000 Version: 1.9.0 35
## Page 36

Programming e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 36 Version: 1.9.0 TE1000
## Page 37

Programming 4.1.2.13 FB_SMISyn The function block FB_SMISyn queries the manufacturer code and the drive type. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Specifies whether the input dw Addr is to be evaluated as manufacturer code [} 66], address of a device or for group addressing. Addressing via slave ID (e Addr Type = e SMIAddr Type Slave Id) is not permitted. dw Addr Option DWORD Reserved for future extensions e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; by Manufactor Code : BYTE; by Drive Type : BYTE; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. TE1000 Version: 1.9.0 37
## Page 38

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). by Manufactor Code BYTE The manufacturer code [} 66] (1-14) by Drive Type BYTE The drive type (0-15). The meaning is manufacturer- specific. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.14 FB_SMIUp The function block FB_SMIUp controls the motor run up to the upper end position. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] 38 Version: 1.9.0 TE1000
## Page 39

Programming Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.2.15 FB_SMIUp Step The function block FB_SMIUp Step controls the motor run upwards by a specified angle (0-510 degrees). Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; ui Angle : UINT := 0; END_VAR TE1000 Version: 1.9.0 39
## Page 40

Programming Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] ui Angle UINT The specified angle. The value range is 0...510 degrees. The SMI standard reduces the accuracy to a resolution of 2 degrees. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 40 Version: 1.9.0 TE1000
## Page 41

Programming 4.1.3 Addressing commands 4.1.3.1 FB_SMIAddressing This function block addresses the connected SMI devices according to the random principle. Which SMI device is assigned to which address is beyond the control of the user. The addresses are assigned in descending order, starting with the address specified by the parameter by Highest Address. Applying a positive edge to the input b Start starts the function block, and the output b Busy goes TRUE. The function block now independently addresses all SMI devices. The output variable arr Addressed Devices provides information which SMI devices have already received an address. Once all SMI devices have been addressed, the output b Busy goes FALSE again. Addressing can be aborted through a positive edge at input b Cancel. Processing this function block can take several minutes, depending on how many SMI devices are connected. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; by Highest Address : BYTE := 15; dw Options : DWORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. b Cancel BOOL The function block is deactivated and the search is aborted on applying a positive edge to this input. by Highest Address BYTE Address from which the SMI devices are addressed in descending order (0-15). dw Options DWORD Reserved for future extensions Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; dw Current Search Slave Id : DWORD; by Current Manufacturer : BYTE; TE1000 Version: 1.9.0 41
## Page 42

Programming by Current Slave Addr : BYTE; arr Addressed Devices : ARRAY [0..15] OF BOOL; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). dw Current Search Sla DWORD Current slave ID used in the search algorithm. ve Id by Current Manufactu BYTE Current manufacturer code [} 66] used in the search rer algorithm. by Current Slave Addr BYTE Current address used in the search algorithm. arr Addressed Device ARRAY OF BOOL If an address is assigned to an SMI device, then the s corresponding element in the array is set to TRUE. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.3.2 FB_SMIDiscovery Slave Id The first drive is sought that corresponds to the specified manufacturer code and has the address 0. This function block is used for addressing SMI devices and is used in the function block FB_SMIAddressing() [} 41]. Inputs VAR_INPUT b Start : BOOL; b Cancel : BOOL; by Manufacturer : BYTE := 0; dw Options : DWORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the search is started by applying a positive edge to this input. 42 Version: 1.9.0 TE1000
## Page 43

Programming Name Type Description b Cancel BOOL The function block is deactivated and the search is aborted on applying a positive edge to this input. by Manufacturer BYTE The manufacturer code [} 66] specified for the search for the SMI device. Some SMI devices do not permit the manufacturer code 0. dw Options DWORD Reserved for future extensions Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; dw Current Search Slave Id : DWORD; e Res Slave Addr ET0And Slave Id LTSerach Id : E_SMIComp Res Slave Addr ET0And Slave Id LTSearch Id; e Res Slave Addr ET0And Slave Id GTSerach Id : E_SMIComp Res Slave Addr ET0And Slave Id GTSearch Id; e Res Slave Addr ET0And Slave Id ETSerach Id : E_SMIComp Res Slave Addr ET0And Slave Id ETSearch Id; e Res Slave Addr NE0 : E_SMIComp Res Slave Addr NE0; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). dw Current Search Sla DWORD As soon as the execution of the function block has ended ve Id (b Busy changes from TRUE to FALSE) this output indicates the slave ID of the SMI device found. e Res Slave Addr ET0 E_SMIComp Res Slave Addr At least one motor / no motor has the address 0 and the And Slave Id LTSerac slave ID is smaller than the slave ID sought (dw Slave-Id) / ET0And Slave Id LTSearch Id h Id the value is undefined. [} 57] e Res Slave Addr ET0 E_SMIComp Res Slave Addr At least one motor / no motor has the address 0 and the And Slave Id GTSerac slave ID is larger than the slave ID sought (dw Slave-Id) / ET0And Slave Id GTSearch Id h Id the value is undefined. [} 57] e Res Slave Addr ET0 E_SMIComp Res Slave Addr At least one motor / no motor has the address 0 and the And Slave Id ETSerac slave ID is also the same as the slave ID sought (dw Slave- ET0And Slave Id ETSearch Id h Id Id) / the value is undefined. [} 57] e Res Slave Addr NE0 E_SMIComp Res Slave Addr At least one motor / no motor has an address unequal 0 / the value is undefined. NE0 [} 57] TE1000 Version: 1.9.0 43
## Page 44

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.3.3 FB_SMISlave Addr Read The function block FB_SMISlave Addr Read reads the address (0-15) of a drive. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; by Slave Addr : BYTE; 44 Version: 1.9.0 TE1000
## Page 45

Programming Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). by Slave Addr BYTE The read slave address (0-15) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.3.4 FB_SMISlave Addr Write The function block FB_SMISlave Addr Write writes the address (0-15) of one or more drives. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; by New Slave Addr : BYTE := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. TE1000 Version: 1.9.0 45
## Page 46

Programming Name Type Description e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] by New Slave Addr BYTE The new slave address (0-15) Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.3.5 FB_SMISlave Id Compare The function block FB_SMISlave Id Compare compares a specified slave ID (32-bit key ID) with the slave ID (32-bit key ID) defined on the motor side for one or more drives. The command can also be sent also to several SMI slaves. The result of the query is forwarded by four outputs. Each of these outputs can assume three states: 46 Version: 1.9.0 TE1000
## Page 47

Programming • The condition applies to at least one drive. • The condition does not apply to any drive. • The condition could not be determined. Some examples of this are explained further below. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; dw Slave Id : DWORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] dw Slave Id DWORD The Slave ID with which the Slave ID on the motor side is compared. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_INPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; e Res Slave Addr ET0And Slave Id LTSerach Id : E_SMIComp Res Slave Addr ET0And Slave Id LTSearch Id; e Res Slave Addr ET0And Slave Id GTSerach Id : E_SMIComp Res Slave Addr ET0And Slave Id GTSearch Id; e Res Slave Addr ET0And Slave Id ETSerach Id : E_SMIComp Res Slave Addr ET0And Slave Id ETSearch Id; e Res Slave Addr NE0 : E_SMIComp Res Slave Addr NE0; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. TE1000 Version: 1.9.0 47
## Page 48

Programming Name Type Description b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). e Res Slave Addr ET0 E_SMIComp Res Slave Addr At least one motor / no motor has the address 0 and the And Slave Id LTSerac slave ID is smaller than the slave ID sought (dw Slave-Id) / ET0And Slave Id LTSearch Id h Id the value is undefined. [} 57] e Res Slave Addr ET0 E_SMIComp Res Slave Addr At least one motor / no motor has the address 0 and the And Slave Id GTSerac slave ID is larger than the slave ID sought (dw Slave-Id) / ET0And Slave Id GTSearch Id h Id the value is undefined. [} 57] e Res Slave Addr ET0 E_SMIComp Res Slave Addr At least one motor / no motor has the address 0 and the And Slave Id ETSerac slave ID is also the same as the slave ID sought (dw Slave- ET0And Slave Id ETSearch Id h Id Id) / the value is undefined. [} 57] e Res Slave Addr NE0 E_SMIComp Res Slave Addr At least one motor / no motor has an address unequal 0 / the value is undefined. NE0 [} 57] Examples The following tables show the results of the function block with different output situations. In all cases two SMI devices are connected to an SMI terminal and both addresses are greater than 0. The slave ID (dw Slave Id) sought lies between the slave IDs of the two drives: Outputs Meaning e Res Slave Addr ET0And Slave Id LTSerach Id = At least one motor has the slave address equal 0 and e SMIDiag Res At Least One Slave Addr ET0And Slave Id L the slave ID is smaller than the slave ID sought. TSearch Id e Res Slave Addr ET0And Slave Id GTSerach Id = At least one motor has the slave address equal 0 and e SMIDiag Res At Least One Slave Addr ET0And Slave Id the slave ID is greater than the slave ID sought. GTSearch Id e Res Slave Addr ET0And Slave Id ETSerach Id = No motor has the slave address equal 0 and the e SMIDiag Res No Slave Addr ET0And Slave Id ETSearch I slave ID is the same as the slave ID sought. d e Res Slave Addr NE0 = No motor has the slave address unequal 0. e SMIDiag Res No Slave Addr NE0 The slave ID (dw Slave Id) sought is greater than the slave IDs of the two drives: Outputs Meaning e Res Slave Addr ET0And Slave Id LTSerach Id = At least one motor has the slave address equal 0 and e SMIDiag Res At Least One Slave Addr ET0And Slave Id L the slave ID is smaller than the slave ID sought. TSearch Id e Res Slave Addr ET0And Slave Id GTSerach Id = No motor has the slave address equal 0 and the e SMIDiag Res No Slave Addr ET0And Slave Id GTSearch slave ID is greater than the slave ID sought. Id e Res Slave Addr ET0And Slave Id ETSerach Id = No motor has the slave address equal 0 and the e SMIDiag Res No Slave Addr ET0And Slave Id LTSearch I slave ID is smaller than the slave ID sought. d e Res Slave Addr NE0 = No motor has the slave address unequal 0. e SMIDiag Res No Slave Addr NE0 The slave ID (dw Slave Id) sought is smaller than the slave IDs of the two drives: 48 Version: 1.9.0 TE1000
## Page 49

Programming Outputs Meaning e Res Slave Addr ET0And Slave Id LTSerach Id = No motor has the slave address equal 0 and the e SMIDiag Res No Slave Addr ET0And Slave Id LTSearch I slave ID is smaller than the slave ID sought. d e Res Slave Addr ET0And Slave Id GTSerach Id = At least one motor has the slave address equal 0 and e SMIDiag Res At Least One Slave Addr ET0And Slave Id the slave ID is greater than the slave ID sought. GTSearch Id e Res Slave Addr ET0And Slave Id ETSerach Id = No motor has the slave address equal 0 and the e SMIDiag Res No Slave Addr ET0And Slave Id ETSearch I slave ID is the same as the slave ID sought. d e Res Slave Addr NE0 = No motor has the slave address unequal 0. e SMIDiag Res No Slave Addr NE0 The slave ID (dw Slave Id) sought is the same as the slave ID of a drive: Outputs Meaning e Res Slave Addr ET0And Slave Id LTSerach Id = No motor has the slave address equal 0 and the e SMIDiag Res No Slave Addr ET0And Slave Id LTSearch I slave ID is smaller than the slave ID sought. d e Res Slave Addr ET0And Slave Id GTSerach Id = At least one motor has the slave address equal 0 and e SMIDiag Res At Least One Slave Addr ET0And Slave Id the slave ID is greater than the slave ID sought. GTSearch Id e Res Slave Addr ET0And Slave Id ETSerach Id = At least one motor has the slave address equal 0 and e SMIDiag Res At Least One Slave Addr ET0And Slave Id E the slave ID is the same as the slave ID sought. TSearch Id e Res Slave Addr NE0 = No motor has the slave address unequal 0. e SMIDiag Res No Slave Addr NE0 Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.3.6 FB_SMISlave Id Read The function block FB_SMISlave Id Read reads the slave ID (32-bit key ID) from a drive. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. TE1000 Version: 1.9.0 49
## Page 50

Programming Name Type Description dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Defines whether the input dw Addr is to be evaluated as a manufacturer code [} 66], the address of a device, for group addressing or as a slave ID. dw Addr Option DWORD If the SMI device is addressed by slave ID (e Addr Type = e SMIAddr Type Slave Id), then the manufacturer code [} 66] must be specified via this input. e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; dw Slave Id : DWORD; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). dw Slave Id DWORD The read slave ID Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 50 Version: 1.9.0 TE1000
## Page 51

Programming 4.1.4 System commands 4.1.4.1 FB_SMIPar Value Read Byte The function block FB_SMIPar Value Read Byte reads a byte parameter (1 byte) stored on the motor side. The meaning of the individual parameters is manufacturer-specific. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; w Par Addr : WORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Specifies whether the input dw Addr is to be evaluated as manufacturer code [} 66], address of a device or for group addressing. Addressing via slave ID (e Addr Type = e SMIAddr Type Slave Id) is not permitted. dw Addr Option DWORD Reserved for future extensions e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] w Par Addr WORD Address of the parameter (0-4095) to be read. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; TE1000 Version: 1.9.0 51
## Page 52

Programming udi Error Id : UDINT; by Par Value : BYTE; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). by Par Value BYTE The read byte parameter Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.4.2 FB_SMIPar Value Read Word The function block FB_SMIPar Value Read Word reads a word parameter (2 bytes) stored on the motor side. The meaning of the individual parameters is manufacturer-specific. Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; w Par Addr : WORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Specifies whether the input dw Addr is to be evaluated as manufacturer code [} 66], address of a device or for group addressing. Addressing via slave ID (e Addr Type = e SMIAddr Type Slave Id) is not permitted. 52 Version: 1.9.0 TE1000
## Page 53

Programming Name Type Description dw Addr Option DWORD Reserved for future extensions e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] w Par Addr WORD Address of the parameter (0-4095) to be read. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; w Par Value : WORD; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). w Par Value WORD The read Word parameter Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.4.3 FB_SMIPar Value Read DWord The function block FB_SMIPar Value Read DWord reads a DWord parameter (4 bytes) stored on the motor side. The meaning of the individual parameters is manufacturer-specific. TE1000 Version: 1.9.0 53
## Page 54

Programming Inputs VAR_INPUT b Start : BOOL; dw Addr : DWORD := 0; e Addr Type : E_SMIAddr Type := e SMIAddr Type Address; dw Addr Option : DWORD := 0; e Command Priority : E_SMICommand Priority := e SMICommand Priority Middle; w Par Addr : WORD := 0; END_VAR Name Type Description b Start BOOL The function block is activated and the command is sent by applying a positive edge to this input. dw Addr DWORD Manufacturer code [} 66] (0-15), address of a device (0-15), bit field (16 bits) for group addressing or slave ID (32-bit key ID). This input has no meaning if a broadcast is sent. e Addr Type E_SMIAddr Type [} 56] Specifies whether the input dw Addr is to be evaluated as manufacturer code [} 66], address of a device or for group addressing. Addressing via slave ID (e Addr Type = e SMIAddr Type Slave Id) is not permitted. dw Addr Option DWORD Reserved for future extensions e Command Priority E_SMICommand Priority Priority (high, medium or low) with which the command is processed by the PLC library. [} 56] w Par Addr WORD Address of the parameter (0-4095) to be read. Inputs/outputs VAR_IN_OUT st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description st Command Buffer ST_SMICommand Buffer Reference to the structure for communication (buffer) with [} 59] the function block FB_KL6831KL6841Communication() [} 12] Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; udi Error Id : UDINT; dw Par Value : DWORD; END_VAR Name Type Description b Busy BOOL This output is set as soon as the function block processes a command and remains active until the command has been processed. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in udi Error Id. The output is reset to FALSE by the reactivation of the function block via the input b Start. udi Error Id UDINT Contains the command-specific error code of the most recently executed command. It is reset to 0 by the reactivation of the function block via the input b Start (see error codes [} 55]). dw Par Value DWORD The read DWord parameter 54 Version: 1.9.0 TE1000
## Page 55

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.1.5 Error codes Value (hex) Value (dec) Description 0x0000 0 No error 0x8001 32769 No response from the SMI drive 0x8002 32770 No terminal feedback for the send data from the SMI terminal. 0x8003 32771 The terminal has detected a telegram error (Status Word.6 = true). This message must be acknowledged by the input b Reset Data Frame Error of FB_KL6831KL6841Communication(). 0x8004 32772 NACK received from the drive 0x8005 32773 Invalid feedback received from the drive 0x8006 32774 Communication buffer overflow 0x8007 32775 No response from the communication block 0x8008 32776 The SMI_COMMAND_BUFFER_ENTRIES constant is outside the valid range (2-250). 0x8009 32777 The ID byte received is incorrect. 0x800A 32778 The data length received is incorrect. 0x800B 32779 No 24 V supply voltage to the KL6831/KL6841 (Status Word.2 = false). 0x800C 32780 Process image was deactivated by the inputs Switch1 or Switch2 of the terminal (Status Word.5 = true). This message must be acknowledged by the b Reset Inactive Process Image input of FB_KL6831KL6841Communication(). 0x800D 32781 The terminal has detected a checksum error (Status Word.8 = true). This message is reset as soon as a telegram is successfully transmitted. 0x800E 32782 The SMI command does not support addressing via slave ID (e Addr Type = e SMIAddr Type Slave Id). 0x800F 32783 Parameter w Addr (bit field for group addressing) is outside the valid range (0-65535). 0x8010 32784 Parameter w Addr (address) is outside the valid range (0-15). 0x8011 32785 Parameter e Command Priority is invalid 0x8012 32786 Parameter e Command Type is invalid 0x8013 32787 Parameter ui Angle is outside the valid range (0-510) 0x8014 32788 Parameter w Par Addr is outside the valid range (0-4095) 0x8015 32789 Parameter e Addr Type is invalid 0x8016 32790 Parameter e Response Format is invalid 0x8017 32791 Parameter w Addr (manufacturer code) is outside the valid range (0-15) 0x8018 32792 The command supports only individual addressing. 0x8019 32793 Parameter w Addr Option (manufacturer code) is outside the valid range (0-15). 0x801A 32794 An internal error has occurred in the function block FB_SMIDiscovery Slave Id. 0x801B 32795 No devices were found. 0x801C 32796 All 16 addresses have already been assigned. There are possibly more than 16 devices connected to the SMI bus. 0x801D 32797 Invalid diagnostic response received (neither NACK nor ACK). TE1000 Version: 1.9.0 55
## Page 56

Programming Value (hex) Value (dec) Description 0x801E 32798 Parameter by Highest Address (highest address) is outside the valid range (0-15). 0x801F 32799 Timeout for internal addressing. The terminal has not sent a response following the start of internal addressing. 0x8020 32800 The internal addressing failed three times. 4.2 DUTs 4.2.1 Enums 4.2.1.1 E_SMIConfiguration Commands TYPE E_SMIConfiguration Commands : ( e SMICommand Do Nothing := 0, e SMICommand Up := 1, e SMICommand Down := 2, e SMICommand Stop := 3, e SMICommand Pos1 := 4, e SMICommand Pos2 := 5 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.32 Tc2_SMI from 3.3.6.0 4.2.1.2 E_SMIAddr Type TYPE E_SMIAddr Type : ( e SMIAddr Type Manufacturer := 0, e SMIAddr Type Address := 1, e SMIAddr Type Group := 2, e SMIAddr Type Slave Id := 3, e SMIAddr Type Broadcast := 4 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.1.3 E_SMICommand Priority TYPE E_SMICommand Priority : ( e SMICommand Priority High := 0, e SMICommand Priority Middle := 1, e SMICommand Priority Low := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 56 Version: 1.9.0 TE1000
## Page 57

Programming 4.2.1.4 E_SMICommand Type TYPE E_SMICommand Type : ( e SMICommand Type Write := 0, e SMICommand Type Read := 1 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.1.5 E_SMIComp Res Slave Addr ET0And Slave Id ETSearch Id TYPE E_SMIComp Res Slave Addr ET0And Slave Id ETSearch Id : ( e SMIDiag Res Slave Addr ET0And Slave Id ETSearch Id Undefined := 0, e SMIDiag Res No Slave Addr ET0And Slave Id ETSearch Id := 1, e SMIDiag Res At Least One Slave Addr ET0And Slave Id ETSearch Id := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.1.6 E_SMIComp Res Slave Addr ET0And Slave Id GTSearch Id TYPE E_SMIComp Res Slave Addr ET0And Slave Id GTSearch Id : ( e SMIDiag Res Slave Addr ET0And Slave Id GTSearch Id Undefined := 0, e SMIDiag Res No Slave Addr ET0And Slave Id GTSearch Id := 1, e SMIDiag Res At Least One Slave Addr ET0And Slave Id GTSearch Id := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.1.7 E_SMIComp Res Slave Addr ET0And Slave Id LTSearch Id TYPE E_SMIComp Res Slave Addr ET0And Slave Id LTSearch Id : ( e SMIDiag Res Slave Addr ET0And Slave Id LTSearch Id Undefined := 0, e SMIDiag Res No Slave Addr ET0And Slave Id LTSearch Id := 1, e SMIDiag Res At Least One Slave Addr ET0And Slave Id LTSearch Id := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.1.8 E_SMIComp Res Slave Addr NE0 TYPE E_SMIComp Res Slave Addr NE0 : ( e SMIDiag Res Slave Addr NE0Undefined := 0, e SMIDiag Res No Slave Addr NE0 := 1, e SMIDiag Res At Least One Slave Addr NE0 := 2 ); END_TYPE TE1000 Version: 1.9.0 57
## Page 58

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.1.9 E_SMIDiag Res Drives Down TYPE E_SMIDiag Res Drives Down : ( e SMIDiag Res Drives Down Undefined := 0, e SMIDiag Res No Motor Drives Down := 1, e SMIDiag Res At Least One Motor Drives Down := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.1.10 E_SMIDiag Res Drives Up TYPE E_SMIDiag Res Drives Up : ( e SMIDiag Res Drives Up Undefined := 0, e SMIDiag Res No Motor Drives Up := 1, e SMIDiag Res At Least One Motor Drives Up := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.1.11 E_SMIDiag Res Is Stopped TYPE E_SMIDiag Res Is Stopped : ( e SMIDiag Res Is Stopped Undefined := 0, e SMIDiag Res No Motor Is Stopped := 1, e SMIDiag Res At Least One Motor Is Stopped := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.1.12 E_SMIDiag Res With Error TYPE E_SMIDiag Res With Error : ( e SMIDiag Res With Error Undefined := 0, e SMIDiag Res No Motor With Error := 1, e SMIDiag Res At Least One Motor With Error := 2 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 58 Version: 1.9.0 TE1000
## Page 59

Programming 4.2.1.13 E_SMIResponse Format TYPE E_SMIResponse Format : ( e SMIResponse Format Diagnosis := 0, e SMIResponse Format Standard := 1 ); END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.2 Structures 4.2.2.1 ST_KL6831KL6841In Data TYPE ST_KL6831KL6841In Data : STRUCT w State Word : WORD; arr Data : ARRAY [0..21] OF BYTE; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.2.2 ST_KL6831KL6841Out Data TYPE ST_KL6831KL6841Out Data : STRUCT w Control Word : WORD; arr Data : ARRAY [0..21] OF BYTE; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.2.3 ST_SMICommand Buffer TYPE ST_SMICommand Buffer : STRUCT arr Message Queue : ARRAY [0..2] OF ST_SMIMessage Queue; st Response Table : ST_SMIResponse Table; udi Message Handle : UDINT; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.2.4 ST_SMIMessage Queue TYPE ST_SMIMessage Queue : STRUCT arr Buffer : ARRAY [1.. SMI_COMMAND_BUFFER_ENTRIES] OF ST_SMIMessage Queue Item; by Buffer Read Pointer : BYTE; by Buffer Write Pointer : BYTE; TE1000 Version: 1.9.0 59
## Page 60

Programming by Buffer Demand Counter : BYTE; by Buffer Maximum Demand Counter : BYTE; ui Buffer Overflow Counter : UINT; b Lock Semaphore : BOOL; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.2.5 ST_SMIMessage Queue Item TYPE ST_SMIMessage Queue Item : STRUCT dw Addr : DWORD; e Addr Type : E_SMIAddr Type; e Command Type : E_SMICommand Type; e Response Format : E_SMIResponse Format; arr Identification Bytes : ARRAY [0..2] OF BYTE; arr Parameters : ARRAY [0..2] OF DWORD; udi Message Handle : UDINT; b Suppress Response Buffer : BOOL; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.2.6 ST_SMIResponse Table TYPE ST_SMIResponse Table : STRUCT arr Response Table : ARRAY [1.. SMI_COMMAND_BUFFER_ENTRIES] OF ST_SMIResponse Table Item; by Response Table Counter : BYTE; by Response Table Max Counter : BYTE; ui Response Table Overflow Counter : UINT; b Lock Semaphore : BOOL; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 4.2.2.7 ST_SMIResponse Table Item TYPE ST_SMIResponse Table Item : STRUCT arr Response Data : ARRAY [0..7] OF BYTE; by Data Length : BYTE; by Identification Byte : BYTE; udi Message Handle : UDINT; udi Error Id : UDINT; END_STRUCT END_TYPE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_SMI from 3.3.5.0 60 Version: 1.9.0 TE1000
## Page 61

Programming 4.3 Integration into Twin CAT 4.3.1 KL6831 with CX5120 This sample describes how to write a simple PLC program for SMI in Twin CAT and how to link it with the hardware. A motor is controlled stepwise with a button. One button sends the Up command, the other the Down command. Sample: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_smi/Resources/6012679435.zip The Twin CAT project is available for download as *.zip file. This must first be unpacked locally so that the archive (*.tnzip file) is available for import into the Twin CAT project. Hardware Setting up the components • 1x CX5120 Embedded PC • 1 x KL1104 digital 4-channel input terminal (for the Up, Down and Reset function) • 1x KL6831 SMI terminal • 1x KL9010 end terminal Set up the hardware and the SMI components as described in the documentation. The sample assumes that a Reset button has been connected to the first input of the KL1104, an Up button to the second input and a Down button to the third input. There is a drive at the SMI device address 1. Software Creation of the PLC program Create a new "Twin CAT XAE Project" and a "Standard PLC Project". Add the library Tc2_SMI in the PLC project under "References". Create the following global variables: VAR_GLOBAL b Reset AT %I* : BOOL; b Up AT %I* : BOOL; b Down AT %I* : BOOL; st KL6831In Data AT %I* : ST_KL6831KL6841In Data; st KL6831Out Data AT %Q* : ST_KL6831KL6841Out Data; st Command Buffer : ST_SMICommand Buffer; END_VAR Name Type Description b Reset BOOL Input variable for the Reset button b Up BOOL Input variable for the Up button b Down BOOL Input variable for the Down button st KL6831In Data ST_KL6831KL6841In Data Input variable for the SMI terminal [} 59] st KL6831Out Data ST_KL6831KL6841Out Data Output variable for the SMI terminal [} 59] st Command Buffer ST_SMICommand Buffer Required for communication with SMI [} 59] TE1000 Version: 1.9.0 61
## Page 62

Programming Create a program (CFC) for the background communication with SMI. The function block FB_KL6831KL6841Communication [} 12] is called in the program. With the communication block, ensure that the structures st KL6381In Data and st KL6831Out Data and st Command Buffer are linked. Create a MAIN program (CFC) in which the function blocks FB_SMIUp Step [} 39] and FB_SMIDown Step [} 23] are called. The input b Start of the function block for sending the Up command is linked to the global variable b Up. The input b Start of the function block for sending the Down command is linked to the global variable b Down. Navigate to the task configuration section and configure the Plc Task. By way of example, the task is assigned priority 16 and a cycle time of 10 ms. 62 Version: 1.9.0 TE1000
## Page 63

Programming Create a further task for the background communication. Assign a higher priority (smaller number) and a lower interval time to this task than the Plc Task. Add the program for the communication to this task. More precise information on the task configuration can be found in the function block description. TE1000 Version: 1.9.0 63
## Page 64

Programming I/O configuration Select the CX as target system and initiate a search for its hardware. In the project instance within the PLC section, you can see that the input and output variables are assigned to the corresponding tasks. Now link the global variables of PLC program with the inputs and outputs of the bus terminals. Create the Solution and enable the configuration. The lamp with the maximum brightness value is switched on by pressing the first push button. The second push button can be used to switch it off again. You can use the Reset button to reset the inputs in arr Buffer Maximum Demand Meter and arr Buffer Overflow Counter. Also see about this 2 ST_KL6831KL6841In Data [} 59] 2 ST_KL6831KL6841Out Data [} 59] 2 ST_SMICommand Buffer [} 59] 64 Version: 1.9.0 TE1000
## Page 65

Appendix 5 Appendix 5.1 Example: Configuration of SMI devices Twin CAT 3 project: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_smi/Resources/688934411.zip With the example it is possible to address SMI devices or to expand an existing installation. Moreover the dialogs for diagnostics and error analysis can be used. A total of 5 dialogs are available. Start Under SMI_Start is the main menu, via which the four submenus can be accessed. Control On pressing the Start Scanning button, a search is made for addressed SMI devices on the SMI line. All SMI devices found are displayed in the list on the left by the manufacturer code [} 66] and the slave ID. An entry is selected by clicking it. The other buttons are always related to the selected entry. This allows all important SMI commands to be sent to every addressed SMI device. If an error is detected with an SMI command, this is indicated in the bottom right-hand corner by the error code [} 55]. Addressing TE1000 Version: 1.9.0 65
## Page 66

Appendix Each SMI device can be assigned an address from 0 to 15. Each SMI device can be addressed via this address. Although there are other methods of addressing SMI devices (see Device Addressing [} 9]), a unique address is necessary for group addressing. Therefore it is advisable to assign an address to each SMI device. The Start Scanning button is used to search for all addressed SMI devices. If an address is to be changed, then the corresponding SMI device must be selected in the list. The desired address can be entered in the input box on the right next to the Change Address button and accepted by actuating the button. If SMI devices do not have an address yet, all SMI devices are assigned an address by pressing the Start Addressing button. The user has no influence over which address is assigned to which SMI device. The addresses are assigned in descending order, starting with the address specified by the Highest Address parameter. The Current Manufacturer Id, Current Address and Current Search Slave-Id fields provide information about the status of the addressing. The addressing can be prematurely cancelled by pressing Cancel Addressing. Library Status Communication between the individual PLC blocks and the Bus Terminal takes place within the PLC library via three central buffers (for each SMI terminal). The extent of utilisation of the buffers and possible overflows can be determined from the illustrated table. Terminal Status The status information from the process image of the terminal is displayed in this dialogue. In addition, messages requiring acknowledgement can be reset in this dialogue. 5.2 Manufacturer codes Value (hex) Value (dec) Description 0x00 0 all manufacturers 0x01 1 Dunkermotoren Gmb H 0x02 2 Becker Antriebe Gmb H 0x03 3 elero Gmb H 0x04 4 Selve Gmb H & Co. KG 0x05 5 Fa. SUN-MASTER Sonnenschutz Gmb H 0x06 6 Vestamatic Gmb H 0x07 7 WAREMA Renkhoff Gmb H 66 Version: 1.9.0 TE1000
## Page 67

Appendix Value (hex) Value (dec) Description 0x08 8 Groeninger Antriebstechnik Gmb H 0x09 9 Gerhard Geiger Gmb H & Co. KG 0x0A 10 Griesser AG 0x0B 11 Unused 0x0C 12 Unused 0x0D 13 Unused 0x0E 14 Unused 0x0F 15 reserved for extensions 5.3 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG TE1000 Version: 1.9.0 67
## Page 68

Appendix Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 68 Version: 1.9.0 TE1000
## Page 69

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H.
## Page 70

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
