---
title: "TF6105 Twin CAT 3"
product: "TF6105"
category: "Communication"
tags: ["CAT", "OPC", "OPC_UA", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.1.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6105_TC3_OPC_UA_Pub_Sub_EN.pdf"
release_date: "2025-05-15"
---
Manual | EN TF6105 Twin CAT 3 | OPC UA Pub/Sub 2025-05-15 | Version: 1.1.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation......................................................................................................................................... 9 3.3 Licensing......................................................................................................................................... 10 4 Technical introduction............................................................................................................................ 13 4.1 Quick Start...................................................................................................................................... 13 4.1.1 UDP.................................................................................................................................. 13 4.1.2 MQTT............................................................................................................................... 17 4.2 Supported features.......................................................................................................................... 21 4.3 Protocol overview............................................................................................................................ 23 4.4 Publisher/Subscriber....................................................................................................................... 25 4.5 Data sets......................................................................................................................................... 27 4.6 Transport protocols......................................................................................................................... 31 4.6.1 UDP.................................................................................................................................. 31 4.6.2 MQTT............................................................................................................................... 32 4.7 Header layouts................................................................................................................................ 34 4.8 Configuration import/export............................................................................................................. 35 4.9 In-depth........................................................................................................................................... 37 4.9.1 Publishing Interval............................................................................................................ 37 4.9.2 Key Frames, Delta Frames, Keep Alive.............................................................................. 38 4.9.3 Message Receive Timeout................................................................................................. 39 5 Samples................................................................................................................................................... 40 5.1 UDP................................................................................................................................................. 40 5.2 MQTT.............................................................................................................................................. 41 5.3 Ether CAT Master............................................................................................................................ 42 6 Tutorials................................................................................................................................................... 49 7 Appendix.................................................................................................................................................. 50 7.1 Diagnostics...................................................................................................................................... 50 7.2 Troubleshooting.............................................................................................................................. 52 TF6105 Version: 1.1.0 3
## Page 4

Table of contents 4 Version: 1.1.0 TF6105
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS®, and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. TF6105 Version: 1.1.0 5
## Page 6

Foreword 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.1.0 TF6105
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF6105 Version: 1.1.0 7
## Page 8

Overview 2 Overview The product TF6105 TC3 OPC UA Pub/Sub includes connectivity via different transport protocols as specified by the Pub/Sub extension to the OPC UA specification (OPC10000-14). A variety of functionalities from the specification has been implemented and is available for usage. This product includes: • a real-time driver to enable OPC UA Pub/Sub communication via UDP unicast or multicast • a real-time driver to enable OPC UA Pub/Sub communication via MQTT • an extension for the Twin CAT System Manager to configure OPC UA Pub/Sub • an extension for the Twin CAT System Manager to scan remote OPC UA server devices • an optional integration into the Twin CAT OPC UA Server (TF6100 TC3 OPC UA) to use the configuration interface based on the standardized OPC UA Pub/Sub information model. 8 Version: 1.1.0 TF6105
## Page 9

Installation 3 Installation 3.1 System requirements Technical data Description Operating system Windows 10, Windows 11 (Twin CAT 3.1 Build >=4026.16) Target platform PC architecture (x86, x64) Minimum Twin CAT version Twin CAT 3.1 Build 4026 Required Twin CAT setup level Twin CAT 3 XAE, XAR Required Twin CAT license TF6105 TC3 OPC UA Pub/Sub Hardware requirements This product provides support for different transport protocols. If you want to use UDP, a network interface card which is compatible with the Twin CAT Realtime-Ethernet Adapter driver is required, see below. If you want to use MQTT, no special network interface card is required. Realtime-Ethernet Adapter For UDP communication, this product is based on the Twin CAT Realtime-Ethernet Adapter driver. To check whether your network interface card is suitable for this driver, please perform the following steps. Please note that the installation of this driver is not required if you only want to use OPC UA Pub/Sub via MQTT. 1. Create an OPC UA RT Device by right clicking on Devices and selecting Add New Item. 2. Expand the category OPC UA and select Real-Time OPC UA Device. 3. Now select the adapter and find the appropriate Ethernet interface by selecting Compatible Devices. 4. Try to install the Twin CAT RT-Ethernet Adapter driver for your network interface card. „For demo use only“ If your network interface card is listed under the “for demo use only” category, the Twin CAT RT- Ethernet Adapter driver has been installed but might not provide realtime capabilities. However, you may still use it for evaluation and testing. 3.2 Installation If you are using Twin CAT 3.1 Build 4026 (and higher) on the Microsoft Windows operating system, you can install this function via the Twin CAT Package Manager, see Installation documentation. Normally you install the function via the corresponding workload. However, you can also install the packages contained in the workload individually. This documentation briefly describes the installation process via the workload. Command line program Tc Pkg You can use the Tc Pkg Command Line Interface (CLI) to display the available workloads on the system: tcpkg list -t workload You can use the following command to install the workload of this function. tcpkg install TF610x. Opc Ua Client Pub Sub. XAE tcpkg install TF610x. Opc Ua Client Pub Sub. XAR Twin CAT Package Manager UI You can use the User Interface (UI) to display all available workloads and install them if required. To do this, follow the corresponding instructions in the interface. Installation of the corresponding package or workload can be either done via Tc Pkg CLI or Tc Pkg UI. TF6105 Version: 1.1.0 9
## Page 10

Installation Unprepared Twin CAT restart can cause data loss The installation of this function may result in a Twin CAT restart. Make sure that no critical Twin CAT applications are running on the system or shut them down in an orderly manner first. 3.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 10 Version: 1.1.0 TF6105
## Page 11

Installation 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. TF6105 Version: 1.1.0 11
## Page 12

Installation 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. 12 Version: 1.1.0 TF6105
## Page 13

Technical introduction 4 Technical introduction 4.1 Quick Start The following chapter guides you through the first time setup of an OPC UA Pub/Sub configuration in Twin CAT. Please make sure that you have followed the installation [} 9] instructions before moving on and that your system meets the system requirements [} 9]. The following quick start tutorials are available: Tutorial Description UDP [} 13] Demonstrates how to set up a PLC project, OPC UA RT device and a publisher that sends a data set containing one variable via UDP. The variable is linked to a variable from the PLC project via the process image. MQTT [} 17] Demonstrates how to set up a PLC project, OPC UA RT device and a publisher that sends a data set containing one variable via MQTT. The variable is linked to a variable from the PLC project via the Twin CAT Target Browser. Offline configuration exchange OPC UA Pub/Sub defines a file format for offline configuration exchange that is based on the UA Binary format (OPC UA specification, chapter 5.2). If you want to set up an OPC UA Pub/Sub configuration between two different devices, we strongly recommend using this common exchange file. The chapter Configuration import/export [} 35] includes more information about this topic. 4.1.1 UDP This quick start tutorial demonstrates how to set up a PLC project, OPC UA RT device and a publisher that sends a data set containing one variable via UDP. The variable is linked to a variable from the PLC project via the process image. Preparing the PLC project Prepare a PLC project that defines one output variable with data type INT, e.g.: PROGRAM MAIN VAR n Counter AT%Q* : INT; END_VAR n Counter := n Counter + 1; Compile the PLC project so that the PLC process image is created. Configuring a publisher Please perform the following configuration steps to set up an OPC UA Publisher device: 1. Make sure that Twin CAT is in config mode. 2. In Solution Explorer, expand the I/O node and select the child item Devices. 3. Right-click Devices and select Add new element... TF6105 Version: 1.1.0 13
## Page 14

Technical introduction 4. Expand the category OPC UA, select the Real-Time OPC UA Device and click on Ok. 5. Double-click the added device and navigate to the tab Adapter. 6. Bind the device to one of your Network Interface Cards. Make sure that you have installed the Twin CAT- Intel PCI Ethernet Adapter driver on that NIC. 7. Right-click the device and select Add new element... 14 Version: 1.1.0 TF6105
## Page 15

Technical introduction 8. Select the entry OPC UA Publisher (Module) and click on Ok. 9. To configure the added Publisher node, simply double click it in the tree view. There are many configuration options on the Publisher, e.g. the transport to use (UDP, MQTT), the data format (binary, JSON), optional header fields and so on. We want to leave these settings on their default values for the time being. Only make sure that the transport UDP/UADP is selected. 10. In the next step you want to configure a so-called Dataset in order to define variables that should be send out by the Publisher. Right-click the Publisher node and select Add new element.... TF6105 Version: 1.1.0 15
## Page 16

Technical introduction 11. Select the entry Published Data Set with Variables (Module) and click on Ok. 12. On the added data set, right-click the Outputs node and select Add new element... 13. Set a name for the process variable, e.g. Counter and select INT as the Datatype. Click on Ok to add the variable to the process image of the Dataset. ð Your configuration should now look as follows: 16 Version: 1.1.0 TF6105
## Page 17

Technical introduction 14. Right-click the added variable and select Change link.... Select the PLC variable that you have created earlier and click on Ok. Activate the project Activate the Twin CAT project by clicking the Activate button on the Twin CAT XAE toolbar. Make sure that you have selected the correct target device (we assume that you are using your local device) and that you are using the correct Real-Time settings so that you can activate the Twin CAT Runtime on your device. Please consult the regular Twin CAT documentation for more information about how to activate a Twin CAT configuration and switch Twin CAT into Run mode. In this quick start tutorial, we have used UDP as the transport protocol. You can now connect either an OPC UA Pub/Sub subscriber to the data or also have a look at the data using Wireshark. If you want to connect a subscriber, we highly recommend to make use of the Configuration import/export [} 35]. 4.1.2 MQTT This quick start tutorial demonstrates how to set up a PLC project, OPC UA RT device and a publisher that sends a data set containing one variable via MQTT. The variable is linked to a variable from the PLC project via the process image. Preparing the PLC project Prepare a PLC project that defines one variable with data type INT, e.g.: PROGRAM MAIN VAR n Counter : INT; END_VAR n Counter := n Counter + 1; Please note that you do not need to set any input/output compiler statement because we will not use the process image to link the variable. Activate this configuration and start the PLC program. Configuring a publisher Please perform the following configuration steps to set up an OPC UA Publisher device: 1. Make sure that Twin CAT is in config mode. 2. In Solution Explorer, expand the I/O node and select the child item Devices. 3. Right-click Devices and select Add new element... TF6105 Version: 1.1.0 17
## Page 18

Technical introduction 4. Expand the category OPC UA, select the Real-Time OPC UA Device and click on Ok. 5. Double-click the added device and navigate to the tab Adapter. 6. Bind the device to one of your Network Interface Cards. Make sure that you have installed the Twin CAT- Intel PCI Ethernet Adapter driver on that NIC. 7. Right-click the device and select Add new element... 18 Version: 1.1.0 TF6105
## Page 19

Technical introduction 8. Select the entry OPC UA Publisher (Module) and click on Ok. 9. To configure the added Publisher node, simply double click it in the tree view. There are many configuration options on the Publisher, e.g. the transport to use (UDP, MQTT), the data format (binary, JSON), optional header fields and so on. We want to leave these settings on their default values for the time being and only change the transport setting to MQTT/JSON. 10. In the next step you want to configure a so-called Dataset in order to define variables that should be send out by the Publisher. Right-click the Publisher node and select Add new element.... TF6105 Version: 1.1.0 19
## Page 20

Technical introduction 11. Select the entry Published Data Set (Module) and click on Ok. 12. Double-click on the data set and open the Data Set fields tab. 13. Open the Twin CAT Target Browser, navigate to the MAIN program of your PLC Project and drag&drop the variable n Counter to the list of data set fields. Activating the project Activate the Twin CAT project by clicking the Activate button on the Twin CAT XAE toolbar. Make sure that you have selected the correct target device (we assume that you are using your local device) and that you are using the correct Real-Time settings so that you can activate the Twin CAT Runtime on your device. Please consult the regular Twin CAT documentation for more information about how to activate a Twin CAT configuration and switch Twin CAT into Run mode. In this quick start tutorial, we have used MQTT as the transport protocol. You can now use any MQTT client that has access to the message broker to subscribe to the published data set. The following screenshot shows the command line tool mosquitto_sub.exe that has been subscribed to the data. This tool is part of the Mosquitto software application. 20 Version: 1.1.0 TF6105
## Page 21

Technical introduction 4.2 Supported features OPC UA Pub/Sub comes with a large set of features. This product may not support all features from the very beginning. Further features will be added over time through product updates. The following table shows a list of all supported functionalities at the moment. Compatibility with the OPC UA Pub/Sub specification The current version of this product is compatible with the OPC UA Pub/Sub specification version 1.05.03. Header layouts Name Supported Flexible Yes UADP Dynamic Yes UADP Periodic Fixed Yes JSON Data Set Message Yes JSON Minimal Yes JSON Network Message Yes TF6105 Version: 1.1.0 21
## Page 22

Technical introduction UDP transport Feature Supported Publisher Yes Subscriber Yes UADP chunking Yes IP fragmentation Yes Data Key-Frames Yes Delta-Frames Yes Keep Alive Yes Message timeout handling Yes UADP raw encoding Yes UADP variant encoding Yes Pub/Sub security message signing Not supported yet Pub/Sub security message encryption Not supported yet Support for primitive data types (INT, REAL, ...) Yes Support for arrays of primitive data types (INT, Yes REAL, ...) Support for data structures Yes Support for arrays of data structures Yes Support for Unions Not supported yet Support for Variants Not supported yet Support for local Data Sets Yes Support for pre-configured (global) Data Sets Yes Support for unicast/multicast Yes Support for configuration of UDP port Yes Support for event messages Not supported yet Support for field-specific data in Data Sets Not supported yet (Delta-Deadband, Deadband-Type, Substitute Values) Support for Ethernet VLAN transport Not supported yet Support for Meta Data services Not supported yet 22 Version: 1.1.0 TF6105
## Page 23

Technical introduction MQTT transport Feature Supported Publisher Yes Subscriber Yes Key-Frames Yes Delta-Frames UADP Yes Delta-Frames JSON Not supported yet Keep Alive Not supported yet Support for MQTT version 3.1.1 Yes Support for MQTT version 5.0 Yes Support for MQTT / TLS versions 1.2 and 1.3 Yes JSON encoding (reversible) Yes JSON encoding (non-reversible) Yes UADP encoding Yes Support for event messages Not supported yet Support for primitive data types (INT, REAL, ...) Yes Support for arrays of primitive data types (INT, Yes REAL, ...) Support for data structures Yes Support for arrays of data structures Yes Support for Unions Not supported yet Support for Variants Not supported yet Support for local Data Sets Yes Support for global Data Sets Yes Support for Meta Data services Not supported yet Supported message brokers Our Twin CAT MQTT protocol driver supports MQTT versions 3.1.1 and 5.0. Therefore, all message brokers are supported that also support these versions. We have successfully tested communication with Mosquitto, Hive MQ and AWS Io T Core. OPC UA Pub/Sub Security Feature Supported Pre-Shared-Key (PSK) Not supported yet Local SKS Not supported yet Remote SKS Not supported yet Configuration handling Feature Supported Offline configuration exchange (UA-Binary) Yes Online configuration exchange (read) Not supported yet Online configuration exchange (read) Not supported yet 4.3 Protocol overview OPC UA Pub/Sub defines different configuration parameters for the various components. They define the behavior of Publisher and Subscriber. Configuration of these parameters can be performed through the OPC UA Information Model for Pub Sub or through vendor-specific mechanisms, which is, in case of the product TF6105 TC3 OPC UA Pub/Sub, the Twin CAT XAE environment. TF6105 Version: 1.1.0 23
## Page 24

Technical introduction The following diagram depicts the different configuration components and their relation to each other. The Writer Group, Data Set Writer and Published Data Set components define the publisher whereas the Reader Group, Data Set Reader and Subscribed Data Set define the subscriber. For more detailed information about the individual components, we recommend to consult the OPC UA specification, part 14 (Pub/Sub). When using the Twin CAT XAE environment to set up the configuration, the engineering workflow can be visualized as follows: Step Description 1 A new device is added to the Twin CAT I/O configuration. 2 From the list of devices, you can then select the “Real-Time OPC UA Device”, which will be the entry point for all OPC UA Pub/Sub settings. 3 Publishers, subscribers, datasets and variables are added as well as their corresponding parameters. The following chapters provide an overview of the different components and link to more detailed documentation articles. Device The OPC UA RT (Realtime) Device is the entry point of the OPC UA Pub/Sub configuration and will be linked to a network interface card based on the Twin CAT Realtime-Ethernet Adapter driver. The device may contain one or more publishers and/or subscribers as well as (global) data sets. 24 Version: 1.1.0 TF6105
## Page 25

Technical introduction Publisher/Subscriber A Publisher or Subscriber node defines whether the connected data sets are either send (published) or received (subscribed). Each Publisher/Subscriber [} 25] node contains address information for the transport protocol [} 31] that should be used. Data set Data sets can be specified in two different scopes. You can either define a data set locally on a Publisher or Subscriber or globally on the device. Global data sets can be shared by multiple Publishers or Subscribers. There are two different types of data sets which define the way how variables are created and handled: • Data set with variables: this data set type can be configured with variables that appear in the process image of the data set. The variables can then be linked to other process image variables. • Data set without variables: this data set type can be configured with variables via the Twin CAT Target Browser. The variables are then linked internally automatically and do not appear on the process image. For more information, please visit our documentation article about data sets [} 27]. Variables Variables are added to the data set as so-called “data set fields”. They can either be linked to other process image variables or are connected directly to other variables via the Twin CAT Target Browser. See our documentation article about data sets [} 27] for more information. 4.4 Publisher/Subscriber OPC UA Pub/Sub is based on the publisher/subscriber communication pattern. TF6105 TC3 OPC UA Pub/ Sub includes different configuration mechanisms to set up a publisher or subscriber including their corresponding data sets [} 27]. We also recommend to consult our protocol overview [} 23] chapter for an overview of the different configuration components. Publisher The publisher can be used to set up communication for sending data. It is added directly to the OPC UA RT Device. The settings page includes different configuration parameters to define the transport protocol [} 31] as well as additional settings that further define the data communication. TF6105 Version: 1.1.0 25
## Page 26

Technical introduction The Data Sets tab contains information about all linked local or global data sets. The Diagnosis tab contains diagnostics information about the data communication. Subscriber The publisher can be used to set up communication for receiving data. It is added directly to the OPC UA RT Device. The settings page includes different configuration parameters to define the transport protocol [} 31] as well as additional settings that further define the data communication. Similarly to the publisher, the Data Sets tab contains information about all linked local or global data sets and the Diagnosis tab contains diagnostics information about the data communication. 26 Version: 1.1.0 TF6105
## Page 27

Technical introduction 4.5 Data sets Data sets can be added to a publisher and subscriber and define a list of name and value pairs that represent a list of variable values. Such variables are then represented by so-called data set fields. Meta data can be added to a data set, which provides additional information about the structure and content of a data set. TF6105 TC3 OPC UA Pub/Sub provides two different types of data sets, which define how variables are configured and handled. • Data set with variables • Data set without variables These data set types are described in more detail below. Scope Data sets can be configured in two different scopes: locally or globally. Local data sets are configured exclusively for a single publisher or subscriber whereas global data sets are added on device level and can be shared by publishers or subscriber, e.g. if you want to publish the same data points on two different publishers. Global data sets can be added to a publisher/subscriber via the Data Sets tab: TF6105 Version: 1.1.0 27
## Page 28

Technical introduction In the example above the publisher has been configured with a local data set called “Ds Pub Vars1” and a global set called “Ds Pub Vars2”. Data set with variables Data sets with variables configure all variables as part of the process image. These data sets can be added either globally or locally, e.g. on a publisher: The variables can then be added directly on the process image of the data set: 28 Version: 1.1.0 TF6105
## Page 29

Technical introduction As an alternative, you can also use Copy&Paste on a variable from the PLC process image to add it to the data set, as shown in the following screenshot. Simply use STRG+C to copy the variable to the clipboard and then paste it to the target data set via the context menu. TF6105 Version: 1.1.0 29
## Page 30

Technical introduction Data set without variables Data sets without variables do not configure the variables as part of the process image. Instead, variables can be added to the data set either via the Twin CAT Target Browser or directly from a PLC process image. The variables are then automatically linked with the corresponding symbol. Changes to the symbol Please note that, if the linked symbol changes, the variables need to be removed from the data set and added again via the Twin CAT Target Browser because the symbolic information is retrieved as part of the Drag&Drop process. To add a variable to this kind of data set, please open the Twin CAT Target Browser and drag a variable to the Data Set Fields tab of the data set, as shown in the following screenshot. The field configuration of the data set now includes the variable and it is published as soon as the configuration is activated. Code generation Subscriber data sets include an automatic code generation to reduce the engineering time required to create and link matching PLC variables. The code generation is accessible via the corresponding button on the subscriber data set. 30 Version: 1.1.0 TF6105
## Page 31

Technical introduction This functionality generates a global variable list that contains all the variables from the subscriber data set with matching data types and the attribute “Tc Link To” that automatically links them to their counterparts. 4.6 Transport protocols The OPC UA Pub/Sub extension defines different transport protocols over which data can be transmitted. Those transport protocols include: • UDP for fast machine-to-machine communication • MQTT for machine-to-cloud communication Each protocol has its own advantages and disadvantages and it depends on the application project which transport is the right one to use. Although MQTT is considered an "Io T" protocol and is often used together with cloud services, it is of course not restricted to cloud-related use cases because MQTT connectivity can also be set up within a private network. The product TF6105 TC3 OPC UA Pub/Sub supports both transport protocols. The following chapters describe the individual configuration parameters for each transport protocol. 4.6.1 UDP To configure a Publisher or Subscriber for UDP transport, simply open the Publisher/Subscriber configuration page and select the UDP transport. UDP supports the (binary) UADP encoding and different header layouts [} 34]. Different address settings are available to configure connection details, e.g. the destination address, UDP port and time-to-live. TF6105 Version: 1.1.0 31
## Page 32

Technical introduction 4.6.2 MQTT To configure a Publisher or Subscriber to use MQTT transport, simply open the Publisher/Subscriber configuration page and select the MQTT transport. MQTT supports the (binary) UADP encoding as well as JSON and may be configured with a specified header layout [} 34]. Encoding There are two encodings available for selection: MQTT/UADP and MQTT/JSON. The first data format uses the binary UADP encoding to encode messages and the last one uses a JSON format. Depending on the selected header layout, the MQTT/JSON encoding may look as follows: { "Message Id": "{0CF7F27A-56FF-1F85-CFC2-12C886365C1D}", "Message Type": "ua-data", "Messages": [ { "Data Set Writer Id": 1, "Payload": { "n Counter": { "Type": 4, "Body": 18 }, "b Toogle": { "Type": 1, "Body": false } } }, { "Data Set Writer Id": 2, "Payload": { "my New Variable": { "Type": 4, "Body": 42 } } 32 Version: 1.1.0 TF6105
## Page 33

Technical introduction } ] } The JSON format is standardized within the OPC UA Pub/Sub specification. For a full description of the JSON scheme and each individual field, please consult the specification. Connection parameters Whenever using MQTT as the transport protocol, you also need to define connection parameters to the MQTT Message Broker. These parameters can be specified, depending on the use case, in two different locations: • you can either configure individual MQTT connections on each Publisher or Subscriber • or you can configure one “global” MQTT connection on the OPC UA RT device settings. In this case, all Publishers and Subscribers share one connection to the MQTT Message Broker. The following screenshot shows the MQTT connection parameters on a Publisher: The following screenshot shows where to set up the global MQTT connection on the OPC UA RT device: In both cases, the dialog that allows to enter the connection parameters is the same and looks as follows: TF6105 Version: 1.1.0 33
## Page 34

Technical introduction Topics Data on the MQTT Message Broker is organized in so-called “topics”. From an OPC UA Pub/Sub point-of- view, you can specify topics on two layers: • The topic on a Publisher is configured on the Publisher settings. • The topic on a Subscriber is configured individually for each Data Set. 4.7 Header layouts Header content and message layouts were designed to be flexible and to support different use cases by enabling or disabling individual fields within the headers. While this flexibility makes it possible to support many different use cases with Pub/Sub, the number of possible header field combinations also increases the effort needed for the implementation and verification. On the other hand, within a given application domain or for different use cases some configurations might be more appropriate than others. Custom header layout configurations (also called the “Flexible” header layout) can be used but they should be limited to applications that do not fall into the use cases for the layouts. The header layout can be configured on a publisher or subscriber, as shown in the following screenshot. The following header layouts are supported. The header layout names are derived from the OPC UA specification, part 14, annex A. 34 Version: 1.1.0 TF6105
## Page 35

Technical introduction Name Supported Flexible Yes UADP Dynamic Yes UADP Periodic Fixed Yes JSON Data Set Message Yes JSON Minimal Yes JSON Network Message Yes 4.8 Configuration import/export Exchanging configurations can be a very important step during the engineering phase of a project, especially if a Pub/Sub configuration needs to be exchanged between different devices and/or vendors. OPC UA Pub/ Sub includes a standardized, file-based format to exchange configurations known as the “UA-Binary import/ export” or simply “Configuration import/export”.. The workflow is usually as follows: • Set up your publishers on device A. • Export the configuration file. • Import the configuration file on the other device(s) to set up a corresponding subscriber. A configuration dialog on the OPC UA RT device in Twin CAT XAE allows to access this import/export functionality. Changes to the configuration Please note that every change to the configuration also requires to create a new configuration file. Export When exporting a configuration file, a dialog is opened that allows to select the destination that the file should be saved to. You can then take the created file and share it with the corresponding party. Import When importing a configuration file, a dialog is opened that allows to select the publishers/subscribers that should be imported from the file. The default behavior is that a publisher is imported as a subscriber and vice versa. TF6105 Version: 1.1.0 35
## Page 36

Technical introduction MQTT connection settings When importing a configuration file that contains MQTT connection settings, the connection details are imported as follows: If the MQTT connection settings are the same for all configuration items, the settings are imported and added on the OPC UA RT Device. If the MQTT connection settings are different on some configuration items, the settings are imported on the publisher/subscriber nodes. Configuration viewer The same settings area also includes a so-called “configuration viewer”, which allows to preview the contents of the binary Pub/Sub configuration file. 36 Version: 1.1.0 TF6105
## Page 37

Technical introduction 4.9 In-depth 4.9.1 Publishing Interval The Publishing Interval is configured as part of a Publisher configuration. It specifies the time intervall in which frames should be published and correlates with the Base Time that has been configured in the Twin CAT Real-Time settings. Example: the following screenshot shows a system which has a Base Time of 1ms configured in its Twin CAT Real-Time settings. TF6105 Version: 1.1.0 37
## Page 38

Technical introduction When configuring a Publisher, the Publishing Interval now correlates to this Base Time. The following screenshot shows a configured Publishing Interval of 100ms (100 ticks * 1ms Base Time). 4.9.2 Key Frames, Delta Frames, Keep Alive This documentation article explains how Key Frames, Delta Frames and Keep Alive correlate with each other when configured on a publisher or publisher data set. Key Frames and Delta Frames Key Frames always contain the full data set whereas Delta Frames only include incremental updates (fields that have changed). When configuring a Publisher data set, the Key Frame Count specifies how often a Key Frame should be published related to the publishing interval. When set to "1", a Key Frame is published in every Publisher cycle. When set to a value greater than "1", a Key Frame is published every n cycles, otherwise a Delta Frame is published. Please note that Delta-Frames are only published if there is a data change, which means that there may be times in which no Frames are published at all. 38 Version: 1.1.0 TF6105
## Page 39

Technical introduction Keep Alive The Keep Alive time, which is configured on a publisher, is used to send out frames if there are no data changes (and therefore delta frames) that are send out for a longer period of time. This ensures that any subscribers still know that the publisher is online. Please note that, when configuring the Keep Alive on a subscriber, that this also correlates with the Message Receive Timeout. 4.9.3 Message Receive Timeout The Message Receive Timeout is configured as part of a Subscriber configuration. It specifies the time after which an incoming message for a subscriber Data Set is to be expected - otherwise a timeout occurs and the Pub Sub State process variable goes into an error. The Message Receive Timeout may be reset by the Keep Alive [} 38]. TF6105 Version: 1.1.0 39
## Page 40

Samples 5 Samples Sample code and configurations for this product can be obtained from the corresponding repository on Git Hub: https://github.com/Beckhoff/TF6105_Samples. There you have the option to clone the repository or download a ZIP file containing the sample. The following samples are currently available: Sample Description UDP [} 40] Demonstrates how to set up a sample publisher and subscriber based on OPC UA Pub/Sub UDP. MQTT [} 41] Demonstrates how to set up a sample publisher and subscriber based on OPC UA Pub/Sub MQTT. Publish data from Explains how to set up an Ether CAT Master ADS Symbol Server and configure an Ether CAT Master OPC UA Publisher to publish its data points. This sample is not available as a download but all required steps will be explained in this documentation article. We also recommend to check out our quick start tutorials [} 13], which provide a guided walkthrough of various configuration use cases. 5.1 UDP This sample demonstrates how to set up a publisher and subscriber based on OPC UA Pub/Sub UDP. The sample solution contains a Twin CAT project that includes the following PLC configuration: • a PLC project that generates random data and links the data with data sets [} 27] on the OPC UA RT Device’s publishers. • a PLC project that stores the data received by subscribers on the OPC UA RT Device. The I/O configuration includes an OPC UA RT Device with two publishers and two subscribers: • a publisher that is configured to include a data set with variables. The variables are linked via the process image to the output variables of the first PLC project. • a publisher that is configured to include a data set without variables. The variables are linked internally via their ADS symbol names to variables in the first PLC project. • a subscriber that is configured to subscribe to the data published by the first publisher. The input variables are linked with variables from the second PLC project. • a subscriber that is configured to subscribe to the data published by the second publisher. The input variables are linked with variables from the second PLC project. Creation of the subscribers The subscribers have been created automatically based on the Configuration import/export [} 35]. We highly recommend using this exchange format wherever possible. How to start the sample Before you activate the sample project, the OPC UA RT device needs to be set up for a network interface card that has the Twin CAT Realtime-Ethernet Adapter driver installed. This can be done via the OPC UA RT device settings dialog. 40 Version: 1.1.0 TF6105
## Page 41

Samples Please also make sure that your system meets the system requirements [} 9]. 5.2 MQTT This sample demonstrates how to set up a publisher and subscriber based on OPC UA Pub/Sub MQTT. The sample solution contains a Twin CAT project that includes the following PLC configuration: • a PLC project that generates random data and links the data with data sets [} 27] on the OPC UA RT Device’s publishers. • a PLC project that stores the data received by subscribers on the OPC UA RT Device. The I/O configuration includes an OPC UA RT Device with two publishers and two subscribers: • a publisher that is configured to include a data set with variables. The variables are linked via the process image to the output variables of the first PLC project. • a publisher that is configured to include a data set without variables. The variables are linked internally via their ADS symbol names to variables in the first PLC project. • a subscriber that is configured to subscribe to the data published by the first publisher. The input variables are linked with variables from the second PLC project. • a subscriber that is configured to subscribe to the data published by the second publisher. The input variables are linked with variables from the second PLC project. Creation of the subscribers The subscribers have been created automatically based on the Configuration import/export [} 35]. We highly recommend using this exchange format wherever possible. How to start the sample Please make sure that your system meets the system requirements [} 9]. Before you activate the Twin CAT project, please make sure that you have an MQTT Message Broker running locally on the same system. The message broker should listen on port 1883/tcp without any encryption or user authentication. Please note that this is only for demonstration purposes! Please adapt this configuration to your environment. The MQTT settings can be found on the OPC UA RT device. TF6105 Version: 1.1.0 41
## Page 42

Samples You can then activate the Twin CAT project and login to the PLC projects to debug the PLC runtime. You should see that the subscriber PLC project receives data (which is published by the other PLC project). 5.3 Ether CAT Master You can easily publish data points from an Ether CAT Master image. An intermediate PLC project is not required but may be added in case you need data conversion or transformation. The following documentation describes all necessary steps to set this use case up. These steps consist of: 1. Activate the ADS Symbol Server on the Ether CAT Master 2. Set up an OPC UA RT Device 3. Configure a publisher with a data set 4. Add data points from the Ether CAT Master to the publisher data set 5. [optional] Set up a Twin CAT subscriber 6. [optional] Set up a generic MQTT client subscriber This sample demonstrates this setup based on a use case in which I/O data points from the Ether CAT Master should be published to a message broker in the Cloud. A 3rd-party application should then connect to the same broker and subscribe to the data. This sample may be adapted to different variations of this use case as required by the application. 42 Version: 1.1.0 TF6105
## Page 43

Samples Activate the ADS Symbol Server on the Ether CAT Master The Twin CAT Ether CAT Master offers the functionalities of an ADS Symbol Server. All terminals and variables on the Ether CAT Master are then made available via ADS. ADS Clients can connect to the ADS Symbol Server in order to browse its namespace and read/write data. You can activate this feature on the ADS settings page of the Ether CAT Master Image. TF6105 Version: 1.1.0 43
## Page 44

Samples Set up an OPC UA RT Device Set up an OPC UA RT Device as described in our Quick Start [} 13] tutorials. In this sample, the OPC UA RT Device will be configured for a secure MQTT connection to a remote message broker that runs in the Cloud but you can also run this sample locally. Please enter the MQTT connection details according to your environment. Configure a publisher with a data set Next, you want to create a publisher that includes a data set containing variables that are linked to the data points of the Ether CAT Master Image. Right-click the OPC UA RT Device and select Add New Item and then OPC UA Publisher. Then right-click the added publisher and select Add New Item and then Published Data Set. Note that the data set does not contain any fields yet, as shown in the following screenshot. You can now add data points from the Ether CAT Master by using the Twin CAT Target Browser. Add data points from the Ether CAT Master to the publisher data set Open the Twin CAT Target Browser and navigate to the ADS Symbol Server of the Ether CAT Master. If this ADS Server is not shown yet, you can add its port via the ADS Port Selection dialog, as shown in the following screenshot. 44 Version: 1.1.0 TF6105
## Page 45

Samples The ADS port of the Ether CAT Master Image can be found on the settings page in step 1. You can now navigate through the namespace of the Ether CAT Master Image and select the data points that you want to publish. When adding data points you have four options: 1. Select every data point individually and use Drag&Drop to add it to the data set. 2. Select the whole process image and use Drag&Drop to add it to the data set. In this case, every terminal on the image will be added as a structured data type to the data set. 3. Select the whole process image and use SHIFT + Drag&Drop to add it to the data set. In this case, only the variables on each terminal will be added to the data set (as simple data types). This option may be required if the OPC UA Pub/Sub subscriber does not support structured types. 4. Select the terminals and use Drag&Drop to add them to the data set. The following screenshot shows the result of a Drag&Drop operation as described in option 1 for two terminals (EL3403 and EL3318). The following screenshot shows the result of a Drag&Drop operation as described in option 4 for two terminals (EL3403 and EL3318). TF6105 Version: 1.1.0 45
## Page 46

Samples [optional] Set up a Twin CAT subscriber You can easily set up a subscriber for the published data points by exporting the configuration [} 35] into a OPC UA Binary exchange file. This file can then be imported on the other side to automatically create a subscriber that fits the publisher configuration. To export the configuration, double-click the OPC UA RT Device and select Settings. Click on the button Export and save the configuration in a file. Import this configuration file on the device that should host the subscriber. If the device is also a system that runs Twin CAT, you can import the file to the corresponding Twin CAT project by using the Import button on the OPC UA RT Device. 46 Version: 1.1.0 TF6105
## Page 47

Samples You can also create a subscriber in the same project that also runs the publisher. The controller will therefore act as a publisher AND subscriber. After importing the configuration file, the subscriber will be automatically configured with a data set that includes the fields from the publisher. You can then create a mapping with variables e.g. from a PLC application or generate PLC code automatically via the Create PLC code button on the data set configuration. TF6105 Version: 1.1.0 47
## Page 48

Samples This operation will create a GVL that contains variables that are linked to the process image variables via the attribute “Tc Link To”, e.g.: [optional] Set up a generic MQTT client subscriber You can subscribe any MQTT client to the data that is published to the MQTT message broker. In this example we have used the MQTT/JSON data format which allows an ASCII-based, easy interpretation of the data. The following section shows how the resulting JSON format may look like. { "Data Set Writer Id": 1, "Publisher Id": "1", "Sequence Number": 5228, "Minor Version": 771501780, "Timestamp": "2024-06-12T10:14:04.734Z", "Status": 0, "Payload": { "Term 3 (EL3318). TC Channel 1": { "Status": { "Underrange": false, "Overrange": false, "Error": false, "Tx PDO State": false, "Tx PDO Toggle": false }, "Value": 233 }, "Term 3 (EL3318). TC Channel 2": { "Status": { "Underrange": true, "Overrange": false, "Error": false, "Tx PDO State": false, "Tx PDO Toggle": false }, "Value": 13720 }, ... ... 48 Version: 1.1.0 TF6105
## Page 49

Tutorials 6 Tutorials You can find video tutorials for this product on our website at https://www.beckhoff.com/tutorials. The video tutorials provide a quick introduction to the product and the individual product facets. TF6105 Version: 1.1.0 49
## Page 50

Appendix 7 Appendix 7.1 Diagnostics There are different configuration levels on which you can find diagnostics information. This information is available in a separate tab page on the corresponding configuration element. Device The OPC UA RT device contains the tab Diagnosis, which includes different metrics to find out if and how many packets are send or received by the underlying IP stack. Publisher/Subscriber Each publisher or subscriber contains a Diagnosis tab that includes different metrics for that particular publisher or subscriber. Twin CAT Error List The Twin CAT OPC UA Pub/Sub driver also sends logging information to the Twin CAT Error List window, which can be accessed from Twin CAT XAE. 50 Version: 1.1.0 TF6105
## Page 51

Appendix Wireshark Wireshark is a good software tool for advanced debugging and diagnostics. You can also use Wireshark to diagnose OPC UA Pub/Sub packets. Example: the following Wireshark trace shows traffic caused by the configured Publisher that sends out packets every 1000ms (timestamp shown in first column) to the UDP Multicast group 224.0.0.1. Each packet contains the configured Data Set and its (in our case "counter") variable of data type INT (which equals Int16). Wireshark plugin/dissector You might require the OPC UA Pub/Sub Wireshark dissector if you want to trace and interpret the Pub/Sub messages in a readable manner. TF6105 Version: 1.1.0 51
## Page 52

Appendix 7.2 Troubleshooting 52 Version: 1.1.0 TF6105
## Page 53

Appendix Behavior Notes I cannot receive any data on my subscriber and the This error usually occurs whenever the source data Twin CAT Error List shows multiple errors that say has changed, e.g. when additional fields have been “Invalid minor version received”. added to a publisher Data Set. In this case, the version information inside of the OPC UA Pub/Sub paket is incremented and it is therefore required to make the new configuration known to the subscriber. The easiest way to do that is to export the updated publisher configuration into a configuration file [} 35] and import it on the subscriber. A connection to the message broker can not be Please make sure that you have used the correct established and the Twin CAT Error List shows hostname or IP address of your MQTT message multiple errors that say “Error connecting MQTT client broker. MQTT_ERR_NOT_FOUND”. A connection to the message broker can not be Please make sure that you have used the correct established and the Twin CAT Error List shows hostname or IP address of your MQTT message multiple errors that say “Error connecting MQTT client broker and that the broker can be reached at that MQTT_ERR_CONN_TIMEDOUT”. address. Also make sure that you have specified the correct TCP/IP port of your message broker, e.g. 1883 or 8883. A connection to the message broker can not be This error message is usually thrown when the Pub/ established and the Twin CAT Error List shows Sub driver does not accept the message broker multiple errors that say “Error connecting MQTT client certificate, which is typically related to using a wrong MQTT_ERR_TLS_VERIFY_FAIL”. CA certificate. Please make sure that you have specified the correct CA certificate. A connection to the message broker can not be This error message is usually thrown when the established and the Twin CAT Error List shows message broker does not accept your client multiple errors that say “Error connecting MQTT client certificate. It may also be thrown if you have specified MQTT_ERR_TLS_HANDSHAKE_FAIL”. no client certificate at all. Please make sure that you have specified the correct client certificate and that it is trusted by the message broker. A connection to the message broker can not be This error message is usually thrown when the client established and the Twin CAT Error List shows key cannot be found. multiple errors that say “Error connecting MQTT client Please make sure that the client key exists under the MQTT_ERR_TLS_KEY_NOTFOUND”. path that you specified in the MQTT connection settings. A connection to the message broker can not be This error message is usually thrown when the client established and the Twin CAT Error List shows key cannot be opened. multiple errors that say “Error connecting MQTT client Please make sure that you have specified a valid MQTT_ERR_TLS_KEY_INVALID”. client key file in the MQTT connection settings and that you haven’t mixed the client key with the client certificate. A connection to the message broker can not be This error message is usually thrown when the client established and the Twin CAT Error List shows certificate cannot be found. multiple errors that say “Error connecting MQTT client Please make sure that the client certificate exists MQTT_ERR_TLS_CERT_NOTFOUND”. under the path that you specified in the MQTT connection settings. A connection to the message broker can not be This error message is usually thrown when the client established and the Twin CAT Error List shows certificate cannot be opened. multiple errors that say “Error connecting MQTT client Please make sure that you have specified a valid MQTT_ERR_TLS_CERT_INVALID”. client certificate file in the MQTT connection settings and that you haven’t mixed the client certificate with the client key. TF6105 Version: 1.1.0 53
## Page 54

Appendix Behavior Notes When I set Twin CAT to Config Mode and then The OPC UA Pub/Sub driver also undergoes a confirm the Load I/O Devices dialog, I get the error context change due to the Twin CAT status change. message "SAFEOP to OP of ... failed. Invalid However, as the PLC stops running due to changing parameter 0x9811070B.“ to Config Mode, this error message is displayed. The same behavior occurs when I click on the Reload Devices button in the Twin CAT XAE toolbar. This behavior is by design. 54 Version: 1.1.0 TF6105
## Page 55

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Third-party trademark statements Intel, the Intel logo, Intel Core, Xeon, Intel Atom, Celeron and Pentium are trademarks of Intel Corporation or its subsidiaries. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies. Wireshark is a registered trademark of Sysdig, Inc.
## Page 56

More Information: www.beckhoff.com/tf6105 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
