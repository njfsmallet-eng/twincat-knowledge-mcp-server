---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.17.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_System_EN.pdf"
release_date: "2025-07-24"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc2_System 2025-07-24 | Version: 1.17.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 7 1.1 Notes on the documentation............................................................................................................. 7 1.2 For your safety.................................................................................................................................. 7 1.3 Notes on information security............................................................................................................ 9 2 Overview.................................................................................................................................................. 10 3 Function blocks....................................................................................................................................... 14 3.1 General function blocks................................................................................................................... 14 3.1.1 DRAND............................................................................................................................ 14 3.1.2 FB_Iec Critical Section....................................................................................................... 14 3.1.3 FB_Read Task Exceed Counter......................................................................................... 16 3.1.4 FB_Reset Task Exceed Counter......................................................................................... 17 3.1.5 FB_Set Led Color_BAPI.................................................................................................... 18 3.1.6 FB_Set Led Color Ex_BAPI................................................................................................ 19 3.1.7 GETCURTASKINDEX...................................................................................................... 20 3.1.8 FB_Create GUID............................................................................................................... 20 3.2 ADS function blocks........................................................................................................................ 21 3.2.1 Control + State................................................................................................................. 21 3.2.2 Indication + Response..................................................................................................... 26 3.2.3 ADSREAD........................................................................................................................ 39 3.2.4 ADSREADEX................................................................................................................... 40 3.2.5 ADSWRITE...................................................................................................................... 41 3.2.6 ADSRDWRT.................................................................................................................... 43 3.2.7 ADSRDWRTEX................................................................................................................ 45 3.3 File function blocks.......................................................................................................................... 47 3.3.1 FB_EOF........................................................................................................................... 47 3.3.2 FB_File Open.................................................................................................................... 48 3.3.3 FB_File Close.................................................................................................................... 51 3.3.4 FB_File Load..................................................................................................................... 53 3.3.5 FB_File Gets..................................................................................................................... 54 3.3.6 FB_File Puts...................................................................................................................... 55 3.3.7 FB_File Read.................................................................................................................... 57 3.3.8 FB_File Write.................................................................................................................... 59 3.3.9 FB_File Seek..................................................................................................................... 61 3.3.10 FB_File Tell....................................................................................................................... 62 3.3.11 FB_File Delete.................................................................................................................. 64 3.3.12 FB_File Rename............................................................................................................... 65 3.3.13 FB_Create Dir................................................................................................................... 66 3.3.14 FB_Remove Dir................................................................................................................. 68 3.4 Event Logger function blocks........................................................................................................... 70 3.4.1 ADSLOGEVENT.............................................................................................................. 70 3.4.2 ADSCLEAREVENTS....................................................................................................... 72 3.4.3 FB_Simple Ads Log Event.................................................................................................. 73 3.5 IEC steps / SFC flags function blocks............................................................................................. 75 3.5.1 Analyze Expression........................................................................................................... 75 TE1000 Version: 1.17.0 3
## Page 4

Table of contents 3.5.2 Analyze Expression Table.................................................................................................. 78 3.5.3 Analyze Expression Combined.......................................................................................... 80 3.5.4 Append Error String........................................................................................................... 80 3.5.5 SFCAction Control............................................................................................................ 81 3.6 Watchdog function blocks............................................................................................................... 81 3.6.1 FB_Pc Watchdog.............................................................................................................. 81 3.6.2 FB_Pc Watch Dog_BAPI................................................................................................... 83 3.7 Time function blocks....................................................................................................................... 84 3.7.1 GETCPUACCOUNT........................................................................................................ 84 3.7.2 GETCPUCOUNTER........................................................................................................ 85 4 Functions................................................................................................................................................. 87 4.1 General functions............................................................................................................................ 87 4.1.1 F_Check Memory Area...................................................................................................... 87 4.1.2 F_Cmp Lib Version............................................................................................................ 88 4.1.3 F_Create IPv4Addr........................................................................................................... 88 4.1.4 F_Scan IPv4Addr Ids......................................................................................................... 89 4.1.5 F_Get Cpu Core Index........................................................................................................ 90 4.1.6 F_Get Cpu Core Info........................................................................................................... 90 4.1.7 F_Get Mapping Partner...................................................................................................... 91 4.1.8 F_Get Mapping Status....................................................................................................... 91 4.1.9 F_Get Struct Member Alignment......................................................................................... 92 4.1.10 F_Get Task Info................................................................................................................. 95 4.1.11 F_Raise Exception............................................................................................................ 96 4.1.12 F_Split Path Name............................................................................................................. 97 4.1.13 SETBIT32......................................................................................................................... 99 4.1.14 CSETBIT32...................................................................................................................... 99 4.1.15 GETBIT32...................................................................................................................... 100 4.1.16 CLEARBIT32.................................................................................................................. 101 4.1.17 GETCURTASKINDEXEX............................................................................................... 101 4.1.18 LPTSIGNAL................................................................................................................... 102 4.1.19 Test And Set.................................................................................................................... 103 4.2 ADS functions............................................................................................................................... 104 4.2.1 ADSLOGDINT................................................................................................................ 104 4.2.2 ADSLOGLREAL............................................................................................................. 106 4.2.3 ADSLOGSTR................................................................................................................. 107 4.2.4 F_Create Ams Net Id........................................................................................................ 109 4.2.5 F_Scan Ams Net Ids......................................................................................................... 109 4.3 Character functions....................................................................................................................... 110 4.3.1 F_To CHR....................................................................................................................... 110 4.3.2 F_To ASC....................................................................................................................... 111 4.4 I/O port access.............................................................................................................................. 111 4.4.1 F_IOPort Read................................................................................................................ 111 4.4.2 F_IOPort Write................................................................................................................ 112 4.5 Memory functions.......................................................................................................................... 114 4.5.1 MEMCMP....................................................................................................................... 114 4.5.2 MEMCPY....................................................................................................................... 115 4 Version: 1.17.0 TE1000
## Page 5

Table of contents 4.5.3 MEMMOVE.................................................................................................................... 116 4.5.4 MEMSET........................................................................................................................ 117 4.6 Time functions............................................................................................................................... 118 4.6.1 F_Get System Time......................................................................................................... 118 4.6.2 F_Get Task Time............................................................................................................. 119 4.6.3 F_Get Task Total Time..................................................................................................... 119 4.7 [Obsolete]...................................................................................................................................... 120 4.7.1 F_Get Version Tc System................................................................................................. 120 4.7.2 GETSYSTEMTIME........................................................................................................ 121 4.7.3 GETTASKTIME.............................................................................................................. 121 5 Data types.............................................................................................................................................. 123 5.1 E_IOAccess Size........................................................................................................................... 123 5.2 E_Open Path.................................................................................................................................. 123 5.3 E_Seek Origin................................................................................................................................ 123 5.4 E_Tc Event Class............................................................................................................................ 124 5.5 E_Tc Event Clear Modes................................................................................................................. 124 5.6 E_Tc Event Priority......................................................................................................................... 124 5.7 E_Tc Event Stream Type................................................................................................................. 124 5.8 E_Tc Memory Area......................................................................................................................... 125 5.9 E_Usr LED_Color........................................................................................................................... 125 5.10 EPlc Mapping Status....................................................................................................................... 125 5.11 ST_Ams Addr................................................................................................................................. 126 5.12 ST_Cpu Core Info........................................................................................................................... 126 5.13 SYSTEMINFOTYPE...................................................................................................................... 126 5.14 SYSTEMTASKINFOTYPE............................................................................................................ 126 5.15 T_Ams Net ID.................................................................................................................................. 127 5.16 T_Ams Net Id Arr............................................................................................................................. 127 5.17 T_Ams Port.................................................................................................................................... 127 5.18 T_IPv4Addr................................................................................................................................... 128 5.19 T_IPv4Addr Arr.............................................................................................................................. 129 5.20 T_Max String.................................................................................................................................. 129 5.21 Tc Event......................................................................................................................................... 129 6 Global constants................................................................................................................................... 131 6.1 Constants...................................................................................................................................... 131 6.2 Library version............................................................................................................................... 136 7 Samples................................................................................................................................................. 137 7.1 Example with Ads Read Ind /Ads Read Res function blocks............................................................ 137 7.2 Example with Ads Write Ind/Ads Write Res function blocks............................................................. 139 7.3 Example with Ads Read function block.......................................................................................... 140 7.4 Example with Ads Write function block.......................................................................................... 141 7.5 Sending/acknowledging Event Logger signals from the PLC........................................................ 142 7.6 File access from the PLC.............................................................................................................. 143 7.7 Testing the CPU reserve of a CX70xx.......................................................................................... 146 8 Appendix................................................................................................................................................ 148 8.1 ADS Return Codes........................................................................................................................ 148 TE1000 Version: 1.17.0 5
## Page 6

Table of contents 8.2 Support and Service...................................................................................................................... 153 6 Version: 1.17.0 TE1000
## Page 7

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1000 Version: 1.17.0 7
## Page 8

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 8 Version: 1.17.0 TE1000
## Page 9

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.17.0 9
## Page 10

Overview 2 Overview Not all those function blocks and functions that are often needed in PLC applications are standardized in IEC61131-3. The Tc2_System library contains such functions and function blocks for the Twin CAT system which do not belong to the standard scope of IEC61131-3, and which are therefore manufacturer-specific. General function blocks Name Description DRAND [} 14] Random number generator FB_Iec Critical Section [} 14] Critical sections should be made mutually exclusive FB_Set Led Color_BAPI [} 18] Switches the user LED to PCs and Émbedded PCs with BIOS API support GETCURTASKINDEX [} 20] Determines the index of the current task ADS function blocks Name Description ADSREAD [} 39] Reading data via ADS ADSREADEX [} 40] Reading data via ADS and returning the number of read data bytes ADSWRITE [} 41] Writing data via ADS ADSRDWRT [} 43] Reading and writing data via ADS ADSRDWRTEX [} 45] Writing data via ADS and returning the number of read data bytes ADSRDSTATE [} 21] Read the state of a device via ADS ADSWRTCTL [} 23] Write control words to a device via ADS ADSRDDEVINFO [} 25] Read device information via ADS Expanded ADS function blocks Name Description ADSREADIND [} 28] ADSREAD Indication ADSWRITEIND [} 30] ADSWRITE Indication ADSRDWRTIND [} 33] ADSRDWRT Indication ADSREADRES [} 36] ADSREAD Response ADSWRITERES [} 37] ADSWRITE Response ADSRDWRTRES [} 38] ADSRDWRT Response Function blocks for data access The function blocks can be used to process files from the PLC locally on the PC. The Twin CAT target system is identified by the AMS network address. This mechanism makes it possible, amongst other things, to store or to edit files on other Twin CAT systems in the network. Access to files consists of three sequential phases: 1. Opening the file. 2. Read or write access to the opened file. 3. Closing the file. Opening the file has the purpose of establishing a temporary connection between the external file, whose name is all that initially is known, and the running program. Closing the file has the purpose of indicating the end of the processing and placing it in a defined output state for processing by other programs. 10 Version: 1.17.0 TE1000
## Page 11

Overview Name Description FB_EOF [} 47] Check the end of file FB_File Open [} 48] Open a file FB_File Close [} 51] Close a file FB_File Gets [} 54] Get string from a file FB_File Puts [} 55] Put string to a file FB_File Read [} 57] Read from a file FB_File Write [} 59] Write to a file FB_File Seek [} 61] Move the file pointer FB_File Tell [} 62] Get the file pointer position FB_File Delete [} 64] Delete a file FB_File Rename [} 65] Rename a file FB_Create Dir [} 66] Create new directory FB_Remove Dir [} 68] Remove directory Event Logger function blocks The Twin CAT Event Logger has the task of managing all messages (events) appearing in the Twin CAT system; to forward them and where necessary to write them into the Twin CAT log file. Name Description ADSLOGEVENT [} 70] Sending and acknowledging Twin CAT Event Logger messages. ADSCLEAREVENTS [} 72] Sending and acknowledging Twin CAT Event Logger messages. FB_Simple Ads Log Event [} 73] Sending and acknowledging Twin CAT Event Logger messages. Twin CAT Event Logger vs. Twin CAT 3 Event Logger The Twin CAT Event Logger was replaced by the successor Twin CAT 3 Event Logger. The older Twin CAT Event Logger is supported by Twin CAT 3 up to version 3.1.4024. Newer Twin CAT versions (>= 3.1.4026.0) only support the newer Twin CAT 3 Event Logger. PLC function blocks for this can be found in the PLC library Tc3_Event Logger. IEC steps / SFC flags function blocks These functions / function blocks are required if IEC steps or SFC flags are used in SFC programs/projects. Name Description Analyze Expression [} 75] Required if SFC flags are used Analyze Espression Table [} 78] Required if SFC flags are used Analyze Expression Combined [} 80] Required if SFC flags are used Append Error String [} 80] Required if SFC flags are used in order to format strings with error description SFCAction Control [} 81] Enables the use of IEC steps TE1000 Version: 1.17.0 11
## Page 12

Overview Watchdog function blocks Name Description FB_Pc Watchdog [} 81] Activates or deactivates the PC watchdog Only available on IPCs with the following mainboards: IP-4GVI63, CB1050, CB2050, CB3050, CB1051, CB2051, CB3051 FB_Pc Watchdog_BAPI [} 83] Activates or deactivates the PC watchdog Only available on IPCs with the following mainboards: CBxx63 with a BIOS version >=0.44 Time function blocks Name Description GETCPUCOUNTER [} 85] Read the CPU cycle counter GETCPUACCOUNT [} 84] Read the PLC task cycle counter General functions Name Description F_Check Memory Area [} 87] Returns information about the memory area in which the requested variable with the specified size is located F_Cmp Lib Version [} 88] Compares an existing library with the required version F_Create IPv4Addr [} 88] Converts individual IPv4 address bytes to a string F_Scan IPv4Addr Ids [} 89] Converts an IPv4 address string to individual address bytes F_Get Mapping Partner [} 91] Returns the object ID of the partner side of the mapping F_Get Mapping Status [} 91] Returns the current mapping status of a PLC variable F_Get Struct Member Alignment [} 92] Reads information about the memory alignment used F_Split Path Name [} 97] Splits the path name into four individual components SETBIT32 [} 99] Sets a bit in a DWORD CSETBIT32 [} 99] Setting/resetting of a bit in a DWORD GETBIT32 [} 100] Reads a bit from a DWORD CLEARBIT32 [} 101] Clears a bit in a DWORD GETCURTASTINDEXEX [} 101] Determining the task index LPTSIGNAL [} 102] Outputs a signal on one of the parallel port pins Test And Set [} 103] Setting and checking a flag without option to interrupt it ADS functions Functions are described below which, with the aid of the ADS interface makes some of the functions of the Windows-NT operating system (such as the output of message boxes) accessible through PLC calls. 12 Version: 1.17.0 TE1000
## Page 13

Overview Name Description ADSLOGDINT [} 104] Log a DINT variable into NT Eventlog and/or Messagebox ADSLOGLREAL [} 106] Log a (L)REAL variable into NT Eventlog and/or Messagebox ADSLOGSTR [} 107] Log a STRING variable into NT Eventlog and/or Messagebox F_Create Ams Net Id [} 109] Creates Ams Net Id string F_Scan Ams Net Ids [} 109] Converts Ams Net Id string to array of address bytes Character functions Name Description F_To ASC [} 111] Converts string character to ASCII number F_To CHR [} 110] Converts ASCII number to string character I/O port access Name Description F_IOPort Read [} 111] Reads from I/O Port F_IOPort Write [} 112] Writes to I/O Port Memory functions Number of functions, which provide direct access to memory areas in the PLC runtime system. NOTICE System crash or access to forbidden memory areas The fact that these functions allow direct access to the physical memory means that special care is called for in applying them! Incorrect parameter values can result in a system crash, or in access to forbidden memory areas. Name Description MEMCMP [} 114] Compares the values of variables in two memory areas MEMCPY [} 115] Copies the values of variables from one memory area to another MEMMOVE [} 116] Copies the values from overlapping memory areas MEMSET [} 117] Sets the variables in a memory area to a particular value Time functions Name Description F_Get System Time [} 118] Read the operating system time stamp F_Get Task Time [} 119] Read the target start time of the task TE1000 Version: 1.17.0 13
## Page 14

Function blocks 3 Function blocks 3.1 General function blocks 3.1.1 DRAND The function block permits generation of a (pseudo-) random number of type LREAL. Inputs VAR_INPUT Seed : INT; END_VAR Name Type Description Seed INT Initial value for specification of the random number series. Outputs VAR_OUTPUT Num : LREAL; END_VAR Name Type Description Num LREAL This output returns a pseudo-random number in the range 0.0 ... 1.0 with double accuracy. The generator here creates a number series with 1075 stochastic values per period. Example of the function block in FBD: In the example the LREAL value 0.643412 is generated and returned. The input parameter Seed affects the initial value of the series. If, for instance, a deterministically reproducible random number series is desired in different sessions, and identical Seed value must be used. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.1.2 FB_Iec Critical Section The function block is used to make critical sections mutually exclusive. Critical sections are characterized by modifications affecting one or usually several variables, which have an inconsistent state during modifications. It is therefore imperative that such modifications are only carried out by one task at a time. The function block provides the methods Enter() and Leave() for this purpose. A successful call of Enter() makes the critical section accessible; the section is then regarded as occupied. Once the modifications are complete, the critical section must be exited through Leave(). 14 Version: 1.17.0 TE1000
## Page 15

Function blocks Cycle timeout due to stopped task If another task tries to access an occupied critical area through an Enter() call, it is blocked by the Twin CAT scheduler. The task is blocked until the section is enabled again! Once enabled, processing of the program code continues, and the critical section is entered. • Ensure that the critical sections are kept short, in order to avoid cycle overruns in the waiting task. If several tasks are waiting to enter the critical section, access is granted based on their priority. If a task is blocked by the Twin CAT scheduler because it attempted to enter an occupied critical area, this is done without "busy waiting". Low-priority tasks can therefore utilize the CPU capacity during this time. Windows CE The functionality is supported under Windows CE operating systems from Twin CAT v3.1.4022.29 onwards. (In older Twin CAT versions the methods return FALSE.) Alternative Critical sections can also be realized with the function Test And Set() [} 103]. The function can be used to select and check the content of a critical section. However, the function does not have a blocking effect, and it is possible that the section cannot be processed in a cycle. As a rule, the number and length of the critical sections should be kept as small as possible. Enter() method The method marks the start of a critical section. Possible return values: TRUE: • The critical section may be entered. FALSE: • The critical section may not be entered. • The function block is not yet supported by the runtime. • The critical section is occupied by another PLC task. This task is on stop in a break point. The return value FALSE avoids permanent blocking of the task and ensures updating of the I/O. Leave() method The method marks the end of a critical section. It must always be called when a critical section is completed. Possible return values: TRUE: • The section was exited successfully. FALSE: • The function block is not supported by the runtime. • The critical section was not occupied with Enter. TE1000 Version: 1.17.0 15
## Page 16

Function blocks Application sample for the function block: The function block FB_Iec Critical Section enables access to shared files to be secured. The instance of the function block and the data to be secured are created globally. VAR_GLOBAL fb Crititcal Section : FB_Iec Critical Section; END_VAR IF fb Crititcal Section. Enter() THEN (* start of critical section *) (* end of critical section *) fb Crititcal Section. Leave(); END_IF Requirements Development environment Target platform PLC libraries to be integrated (cate- gory group) Twin CAT v3.1.4020 PC or CX (x86, x64) Tc2_System (system) WES, WES7, Win7, Win10 Twin CAT v3.1.4022.29 PC or CX (x86, ARM) Tc2_System (system) Win CE 3.1.3 FB_Read Task Exceed Counter The function block reads the Exceed Counter. The Exceed Counter is incremented by the system whenever the selected task exceeds the set task time. This means that maintaining real-time in the cycle was not possible. There can be many reasons for exceeding real-time, but it is usually due to the PLC runtime and the application within this runtime. An example of this is programming loops such as FOR, WHILE, REPEAT, since these are always processed in one cycle. Inputs VAR_INPUT b Execute : BOOL; n Task Ads Port : UINT; END_VAR Name Type Description b Execute BOOL A positive edge activates the function block. n Task Ads Port UINT ADS Port of the selected task Example of a possible assignment: Twin CAT_System Info Var List._Task Info[GETCURTASKINDEXEX()]. Ads Port Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error ID : UDINT; n Exceed Counter : UDINT; END_VAR 16 Version: 1.17.0 TE1000
## Page 17

Function blocks Name Type Description b Busy BOOL The function block is active and working. b Error BOOL An error has been detected in the function block. n Error ID UDINT ADS error code. n Exceed Count UDINT Read value of the Exceed Counter. er Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.22 PC or CX (x86, x64, ARM) Tc2_System (system) >= 3.4.25.0 3.1.4 FB_Reset Task Exceed Counter The function block can reset the Exceed Counter. The Exceed Counter is incremented whenever the selected task exceeds the set task time. This means that maintaining real-time in the cycle was not possible. There can be many reasons for exceeding real-time, but it is usually due to the PLC runtime and the application within this runtime. An example of this is programming loops such as FOR, WHILE, REPEAT, since these are always processed in one cycle. Inputs VAR_INPUT b Execute : BOOL; n Task Ads Port : UINT; END_VAR Name Type Description b Execute BOOL A positive edge activates the function block. n Task Ads Port UINT ADS Port of the selected task Example of a possible assignment: Twin CAT_System Info Var List._Task Info[GETCURTASKINDEXEX()]. Ads Port Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error ID : UDINT; END_VAR Name Type Description b Busy BOOL The function block is active and working. b Error BOOL An error has been detected in the function block. n Error ID UDINT ADS error code. Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.22 PC or CX (x86, x64, ARM) Tc2_System (system) >= 3.4.25.0 TE1000 Version: 1.17.0 17
## Page 18

Function blocks 3.1.5 FB_Set Led Color_BAPI This functionality is only available on IPCs and Embedded PCs with a Usr-LED and with a BIOS version which supports the BIOS-API. The function block FB_Set Led Color_BAPI can be used to switch the user LED to PCs and embedded PCs with BIOS API support. The LED color is switched via a positive edge at b Execute and the e New Color parameter. The LED can be switched off (e New Color = e Usr LED_Off) or set to red (e New Color = e Usr LED_Red), blue (e New Color = e Usr LED_Blue) or green (e New Color = e Usr LED_Green). Inputs VAR_INPUT s Net ID : T_Ams Net ID; e New Color : E_Usr LED_Color; b Execute : BOOL; t Timeout : TIME; END_VAR Name Type Description s Net ID T_Ams Net ID AMS network ID of the device (empty string or local network ID) (type T_Ams Net ID [} 127]) e New Color E_Usr LED_Color New LED color (type E_Usr LED_Color [} 125]) b Execute BOOL The command is executed with a rising edge. The input must be reset as soon as the function block is no longer active (b Busy=FALSE). t Timeout TIME Time until the internal ADS communication is aborted. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; END_VAR Name Type Description b Busy BOOL TRUE, as long as the function block is active. b Error BOOL TRUE if an error occurs during command execution. n Err ID UDINT Contains the ADS error code or the command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_System (System) v3.4.14 18 Version: 1.17.0 TE1000
## Page 19

Function blocks 3.1.6 FB_Set Led Color Ex_BAPI This functionality is only available on IPCs and Embedded PCs with a Usr-LED and with a BIOS version which supports the BIOS-API. The function block FB_Set Led Color Ex_BAPI can be used to switch the user LEDs (USR, U1 or U2) on PCs and embedded PCs with BIOS API support. The LED color is switched via a rising edge at b Execute and the e New Color parameter. The LED can be switched off (e New Color = e Usr LED_Off) or set to red (e New Color = e Usr LED_Red), blue (e New Color = e Usr LED_Blue) or green (e New Color = e Usr LED_Green). Inputs VAR_INPUT s Net ID : T_Ams Net ID; n Led ID : USINT e New Color : E_Usr LED_Color; b Execute : BOOL; t Timeout : TIME; END_VAR Name Type Description s Net ID T_Ams Net ID AMS network ID of the device (empty string or local network ID) (type T_Ams Net ID [} 127]) n Led ID USINT ID for the selection of the user LED: For devices with only one USR LED, the USR LED is selected via n Led ID = 0 (default value is 0). For devices with several user LEDs, the U1 LED is selected via n Led ID = 1 or the U2 LED via n Led ID = 2. e New Color E_Usr LED_Color New LED color (type E_Usr LED_Color [} 125]) b Execute BOOL The command is executed with a rising edge. The input must be reset as soon as the function block is no longer active (b Busy=FALSE). t Timeout TIME Time until the internal ADS communication is aborted. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; END_VAR Name Type Description b Busy BOOL TRUE, as long as the function block is active. b Error BOOL TRUE if an error occurs during command execution. n Err ID UDINT Contains the ADS error code or the command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_System (system) v3.6.1 TE1000 Version: 1.17.0 19
## Page 20

Function blocks 3.1.7 GETCURTASKINDEX Outdated function block This function block is outdated. Use the function GETCURTASKINDEXEX() [} 101] instead. The function block GETCURTASKINDEX determines the task index of the task in which it is currently called. To differentiate whether the current call occurs in the real-time context or from a cyclic PLC task, see the documentation for the function GETCURTASKINDEXEX [} 101]. For example, the automatic call of FB_init methods during initialization does not occur from a cyclic PLC task. Inputs VAR_INPUT (*none*) END_VAR Outputs VAR_OUTPUT index : BYTE; END_VAR Name Type Description index BYTE Returns the current task index of the calling task (1..4 ). Example of calling the block in FBD: Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.1.8 FB_Create GUID The function block generates a new GUID. It is possible to get a list of different new GUIDs with one call if an array of type GUID is specified as buffer at the input. Inputs VAR_INPUT b Execute : BOOL; s Net Id : T_Ams Net Id; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; 20 Version: 1.17.0 TE1000
## Page 21

Function blocks p Guid Buffer : POINTER TO GUID; n Guid Buffer Size : UDINT; END_VAR Name Type Description b Execute BOOL The function block is activated by a rising edge at this input. s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. p Guid Buffer POINTER TO GUID Indicates the address to the buffer for generated GUIDs. It is possible to specify the address on an ARRAY OF GUID. n Guid Buffer Size UDINT Indicates the size in bytes of the specified buffer. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Error Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Error Id UDINT In the event of a set b Error output returns the ADS error code [} 148]. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.4022 PC or CX (x86, x64, ARM) Tc2_System (system) >= 3.4.18.0 3.2 ADS function blocks 3.2.1 Control + State 3.2.1.1 ADSRDSTATE The function block requests the state of an ADS device. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; TE1000 Version: 1.17.0 21
## Page 22

Function blocks RDSTATE : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description NETID T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). PORT T_Ams Port Port number of the ADS device (type: T_Ams Port [} 127]). RDSTATE BOOL The ADS command is triggered by a rising edge at this input. TMOUT TIME Indicates the time before the function is canceled. Outputs VAR_OUTPUT BUSY : BOOL; ERR : BOOL; ERRID : UDINT; ADSSTATE : UINT; DEVSTATE : UINT; END_VAR Name Type Description BUSY BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the Timeout input. While BUSY = TRUE, no new command will be accepted at the inputs. Note that it is not the execution of the service but its acceptance whose time is monitored. ERR BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in ERRID. If the function block has a timeout error, ERR is TRUE and ERRID is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. ERRID UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. ADSSTATE UDINT Contains the state identification code of the ADS target device. DEVSTATE UDINT Contains the specific state identification code of the ADS target device. The codes returned here are supplementary information specific to the ADS device. State identification code of the ADS target device The codes returned here are specified for all ADS servers: • ADSSTATE_INVALID = 0; • ADSSTATE_IDLE = 1; • ADSSTATE_RESET = 2; • ADSSTATE_INIT = 3; • ADSSTATE_START = 4; • ADSSTATE_RUN = 5; • ADSSTATE_STOP = 6; • ADSSTATE_SAVECFG = 7; • ADSSTATE_LOADCFG = 8; • ADSSTATE_POWERFAILURE = 9; • ADSSTATE_POWERGOOD = 10; • ADSSTATE_ERROR = 11; • ADSSTATE_SHUTDOWN = 12; • ADSSTATE_SUSPEND = 13; 22 Version: 1.17.0 TE1000
## Page 23

Function blocks • ADSSTATE_RESUME = 14; • ADSSTATE_CONFIG = 15; • ADSSTATE_RECONFIG = 16; • ADSSTATE_STOPPING = 17; • ADSSTATE_INCOMPATIBLE = 18; • ADSSTATE_EXCEPTION = 19; Sample of calling the function block in FBD: In this sample the PLC runtime system 1 (port no. 801) on the computer with network address 1.1.1.2.7.1 is asked about its state. The answer is ads State = 1 (IDLE) without supplementary code dev State=0. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.1.2 ADSWRTCTL This function block permits the execution of an ADS control command to affect the state of an ADS device, e.g. to start, stop or reset a device. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; ADSSTATE : UINT; DEVSTATE : UINT; LEN : UDINT; SRCADDR : PVOID; WRITE : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TE1000 Version: 1.17.0 23
## Page 24

Function blocks Name Type Description NETID T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). PORT T_Ams Port Port number of the ADS device (type: T_Ams Port [} 127]). ADSSTATE UINT State identification code of the ADS target device. DEVSTATE UINT Contains the specific state identification code of the ADS target device. The codes given here are supplementary information which is specific to the ADS device. LEN UDINT Number of data to be written in bytes. SRCADDR PVOID Address of the buffer from which the data to be written is to be fetched. The programmer is himself responsible for dimensioning the buffer to such a size that 'LEN' bytes can be taken from it. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. WRITE BOOL The ADS command is triggered by a rising edge at this input. TMOUT TIME Indicates the time before the function is canceled. State identification code of the ADS target device The codes shown here are specified for all ADS servers: • ADSSTATE_IDLE = 1; • ADSSTATE_RESET = 2; • ADSSTATE_INIT = 3; • ADSSTATE_START = 4; • ADSSTATE_RUN= 5; • ADSSTATE_STOP = 6; • ADSSTATE_SAVECFG = 7; • ADSSTATE_LOADCFG = 8; Outputs VAR_OUTPUT BUSY : BOOL; ERR : BOOL; ERRID : UDINT; END_VAR Name Type Description BUSY BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the Timeout input. No new commands are accepted at the inputs as long as BUSY = TRUE. Note that it is not the execution of the service but its acceptance whose time is monitored. ERR BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in ERRID. If the function block has a timeout error, ERR is TRUE and ERRID is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. ERRID UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Example of calling the block in FBD: 24 Version: 1.17.0 TE1000
## Page 25

Function blocks In the example a reset command (ADSSTATE=2) is sent to the I/O server (Port300), along with supplementary data hex. AFFE. As a result the I/O server executes a bus reset. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.1.3 ADSRDDEVINFO The function block reads the general device information. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; RDINFO : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description NETID T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). PORT T_Ams Port Port number of the ADS device (type: T_Ams Port [} 127]). RDINFO BOOL The ADS command is triggered by a rising edge at this input. TMOUT TIME Indicates the time before the function is canceled. Outputs VAR_OUTPUT BUSY : BOOL; ERR : BOOL; ERRID : UDINT; DEVNAME : STRING(19); DEVVER : UDINT; END_VAR TE1000 Version: 1.17.0 25
## Page 26

Function blocks Name Type Description BUSY BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the Timeout input. While BUSY = TRUE, no new command will be accepted at the inputs. Note that it is not the execution of the service but its acceptance whose time is monitored. ERR BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in ERRID. If the function block has a timeout error, ERR is TRUE and ERRID is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. ERRID UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. DEV STRING Name of the ADS device NAME DEVVER UDINT Version number of the ADS device Example of calling the block in FBD: In the example, the device information of the first PLC run-time system (port 801) on computer 1.1.1.2.7.1 is read. As a result the name “PLC Server” and the version number 02.00.7 are received. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.2 Indication + Response 3.2.2.1 Overview The expanded ADS function blocks make it possible to create a client-server communication between an ADS device and a PLC task. The ADS device can be, for example, a Windows application (uses the Ads DLL/Ads Ocx) or another PLC runtime system. Communication between the ADS device and the PLC task is processed using the following service primitives: • Request • Indication • Response • Confirmation The communication between an ADS device and a PLC task has the following sequence: an ADS device sends a request to the target device (PLC task). This request is registered in the target device by an indication. The target device (PLC task) then carries out a corresponding service. The service to be carried out is encrypted via the index-group/offset parameter. Next the PLC task sends a response to the ADS device. The response is registered as confirmation by the ADS source device. The ADS devices are addressed via a port address and a network address (NETID). (Port address of the PLC task = _Task Info. Ads Port) In order for a request to be routed to the PLC task, the most significant bit (e.g. 0x80000001) must be entered in the index group parameter when the request is made. 26 Version: 1.17.0 TE1000
## Page 27

Function blocks Communication via Index Group 0x80000000 - 0x80FFFFFF Only one instance of the indication and response function block can be used per PLC task (one instance of ADSREADIND, ADSREADRES, ADSWRITEIND, ADSWRITERES, ADSRDWRTIND and ADSRDWRTRES). Corresponding with the available ADS services: READ, WRITE and READ & WRITE there is an appropriate indication or response function block for each service. Service Name Description READ ADSREADIND [} 28] ADSREAD Indication ADSREADRES [} 36] ADSREAD Response WRITE ADSWRITEIND [} 30] ADSWRITE Indication ADSWRITERES [} 37] ADSWRITE Response READ & WRITE ADSRDWRTIND [} 33] ADS-READ & WRITE Indication ADSRDWRTRES [} 38] ADS-READ & WRITE Response Fi Fos Each PLC task has 3 FIFOS in which the incoming requests (indications) are first stored. This means that there is an ADSREADIND FIFO, an ADSWRITEIND FIFO and an ADSRDWRTIND FIFO. In each FIFO a maximum of 10 indications can be stored, until these were processed (until Response was sent). If, for example, 12 ADSREAD requests are sent to a PLC task simultaneously, 10 requests are stored in the FIFO as indications and two are acknowledged (discarded) with ADS error message 1814 (0x716). In this case, the error code should be analyzed and the two failed ADSREAD requests repeated if necessary. The indications are retrieved individually from the associated FIFO by calling the ADSxxxxxx IND instance. Only then can new indications be stored successfully in the FIFO. Communication via Index Group 0x8n000000 - 0x8n FFFFFF To realize more than one client-server communication per PLC task, the following Indication function blocks are required. These are extended by the possibility to specify a desired range of the Index Group. This way, requests are filtered and only desired areas are responded to. There are 16 freely selectable ranges available: 0x80000000 - 0x80FFFFFF 0x81000000 - 0x81FFFFFF … 0x8E000000 – 0x8EFFFFFF 0x8F000000 – 0x8FFFFFFF To specify such a range of the index group at an Indication function block, the index group value with which the selected range begins is specified at input MINIDXGRP. Example: With MINIDXGRP:=16#85000000 all requests are filtered and requests with an index group in the range 0x85000000 - 0x85FFFFFF are registered as Indication. Service Name Description READ ADSREADINDEX [} 29] ADSREAD Indication with indication of the index group ADSREADRES [} 36] ADSREAD Response WRITE ADSWRITEINDEX [} 31] ADSWRITE Indication with indication of the index group ADSWRITERES [} 37] ADSWRITE Response READ & WRITE ADSRDWRTINDEX [} 34] ADS-READ & WRITE Indication with indication of the index group ADSRDWRTRES [} 38] ADS-READ & WRITE Response TE1000 Version: 1.17.0 27
## Page 28

Function blocks 3.2.2.2 ADSREADIND The function block registers ADSREAD Requests at a PLC task as Indications and allows them to be processed. The queuing of an Indication is reported at the VALID output port by means of a rising edge. The Indication is reported as processed via a positive edge at the CLEAR input. A negative edge at the CLEAR input releases the function block for processing further Indications. After an Indication has been processed a response must be sent to the source device via the ADSREADRES [} 36] function block. The PORT and NETID parameters can be used to address the source device for this purpose. The INVOKEID parameter is used by the source device to assign the responses to the requests and is also sent back to the source device as a parameter. Inputs VAR_INPUT CLEAR : BOOL; END_VAR Name Type Description CLEAR BOOL With a rising edge at this input an Indication is reported as processed and the outputs of the ADSREADIND function block are reset. A falling edge releases the function block for the processing of further indications. Outputs VAR_OUTPUT VALID : BOOL; NETID : T_Ams Net Id; PORT : T_Ams Port; INVOKEID : UDINT; IDXGRP : UDINT; IDXOFFS : UDINT; LENGTH : UDINT; END_VAR Name Type Description VALID BOOL The output is set if an Indication was registered from the function block and remains set until the latter was reported as processed by a positive edge at the CLEAR input. NETID T_Ams Net Id String containing the AMS network ID of the source device, from which the ADS command was sent (type: T_Ams Net Id [} 127]). PORT T_Ams Port Contains the port number of the ADS source device, from which the ADS command was sent (type: T_Ams Port [} 127]). INVOKEID UDINT Handle of the command, which was sent. The Invoke ID is specified from the source device and serves to identify the commands. IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. LENGTH UDINT Number of data to be read in bytes. 28 Version: 1.17.0 TE1000
## Page 29

Function blocks Example of calling the block in ST: • Example with Ads Read Ind /Ads Read Res function blocks [} 137] Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.2.3 ADSREADINDEX The function block registers ADSREAD Requests at a PLC task as Indications and allows them to be processed. The queuing of an Indication is reported at the VALID output port by means of a rising edge. The Indication is reported as processed via a positive edge at the CLEAR input. A negative edge at the CLEAR input releases the function block for processing further Indications. After an Indication has been processed a response must be sent to the source device via the ADSREADRES [} 36] function block. The PORT and NETID parameters can be used to address the source device for this purpose. The INVOKEID parameter is used by the source device to assign the responses to the requests and is also sent back to the source device as a parameter. Compared to the function block ADSREADIND [} 28] there is the possibility to specify a desired range of the Index Group via an additional input. This way, requests are filtered and only desired areas are responded to. There are 16 freely selectable ranges available: 0x80000000 - 0x80FFFFFF 0x81000000 - 0x81FFFFFF … 0x8E000000 – 0x8EFFFFFF 0x8F000000 – 0x8FFFFFFF To specify such a range of the index group at an Indication function block, the index group value with which the selected range begins is specified at input MINIDXGRP. Example: With MINIDXGRP:=16#85000000 all requests are filtered and requests with an index group in the range 0x85000000 - 0x85FFFFFF are registered as Indication. Inputs VAR_INPUT CLEAR : BOOL; MINIDXGRP : UDINT; END_VAR Name Type Description CLEAR BOOL With a rising edge at this input an Indication is reported as processed and the outputs of the ADSREADIND function block are reset. A falling edge releases the function block for the processing of further indications. MINIDXGRP UDINT This input allows filtering the requests by Index Group ranges. Specification of the Index Group value with which the selected range begins. Outputs VAR_OUTPUT VALID : BOOL; NETID : T_Ams Net Id; PORT : T_Ams Port; INVOKEID : UDINT; IDXGRP : UDINT; IDXOFFS : UDINT; LENGTH : UDINT; END_VAR TE1000 Version: 1.17.0 29
## Page 30

Function blocks Name Type Description VALID BOOL The output is set if an Indication was registered from the function block and remains set until the latter was reported as processed by a positive edge at the CLEAR input. NETID T_Ams Net Id String containing the AMS network ID of the source device, from which the ADS command was sent (type: T_Ams Net Id [} 127]). PORT T_Ams Port Contains the port number of the ADS source device, from which the ADS command was sent (type: T_Ams Port [} 127]). INVOKEID UDINT Handle of the command, which was sent. The Invoke ID is specified from the source device and serves to identify the commands. IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. LENGTH UDINT Number of data to be read in bytes. Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.35 PC or CX (x86, x64, ARM) Tc2_System (system) >= 3.4.26.0 3.2.2.4 ADSWRITEIND The function block registers ADSWRITE Requests to a PLC task as Indications and allows them to be processed. The queuing of an Indication is reported at the VALID output port by means of a rising edge. The Indication is reported as processed via a positive edge at the CLEAR input. A falling edge releases the function block for the processing of further indications. After an Indication has been processed a response must be sent to the source device via the ADSWRITERES [} 37] function block. The PORT and NETID parameters can be used to address the source device for this purpose. The INVOKEID parameter is used by the source device to assign the responses to the requests and is also sent back to the source device as a parameter. Inputs VAR_INPUT CLEAR : BOOL; END_VAR Name Typ Beschreibung CLEAR BOOL With a rising edge at this input an indication is reported as processed and the outputs of the ADSWRITEIND function block are reset ( DATAADDR = 0, LENGTH = 0 !). A falling edge releases the function block for the processing of further indications. 30 Version: 1.17.0 TE1000
## Page 31

Function blocks Outputs VAR_OUTPUT VALID : BOOL; NETID : T_Ams Net Id; PORT : T_Ams Port; INVOKEID : UDINT; IDXGRP : UDINT; IDXOFFS : UDINT; LENGTH : UDINT; DATAADDR : PVOID; END_VAR Name Type Description VALID BOOL The output is set if an Indication was registered from the function block and remains set until the latter was reported as processed by a positive edge at the CLEAR input. NETID T_Ams Net Id String containing the AMS network ID of the source device, from which the ADS command was sent (type: T_Ams Net Id [} 127]). PORT T_Ams Port Contains the port number of the ADS source device, from which the ADS command was sent (type: T_Ams Port [} 127]). INVOKEID UDINT Handle of the command, which was sent. The Invoke ID is specified from the source device and serves to identify the commands. IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. LENGTH UDINT Length of the written data in bytes. DATAADDR PVOID Address of the data buffer in which the written data is located. Example of calling the block in ST: • Example with Ads Write Ind/Ads Write Res function blocks [} 139] Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.2.5 ADSWRITEINDEX The function block registers ADSWRITE Requests to a PLC task as Indications and allows them to be processed. The queuing of an Indication is reported at the VALID output port by means of a rising edge. The Indication is reported as processed via a positive edge at the CLEAR input. A falling edge releases the function block for the processing of further indications. After an Indication has been processed a response must be sent to the source device via the ADSWRITERES [} 37] function block. The PORT and NETID TE1000 Version: 1.17.0 31
## Page 32

Function blocks parameters can be used to address the source device for this purpose. The INVOKEID parameter is used by the source device to assign the responses to the requests and is also sent back to the source device as a parameter. Compared to the ADSWRITEIND [} 30] function block there is the possibility to specify a desired range of the Index Group via an additional input. This way, requests are filtered and only desired areas are responded to. There are 16 freely selectable ranges available: 0x80000000 - 0x80FFFFFF 0x81000000 - 0x81FFFFFF … 0x8E000000 – 0x8EFFFFFF 0x8F000000 – 0x8FFFFFFF To specify such a range of the index group at an Indication function block, the index group value with which the selected range begins is specified at input MINIDXGRP. Example: With MINIDXGRP:=16#85000000 all requests are filtered and requests with an index group in the range 0x85000000 - 0x85FFFFFF are registered as Indication. Inputs VAR_INPUT CLEAR : BOOL; MINIDXGRP : UDINT; END_VAR Name Type Description CLEAR BOOL With a rising edge at this input an Indication is reported as processed and the outputs of the ADSWRITEIND function block are reset ( DATAADDR = 0, LENGTH = 0 !). A falling edge releases the function block for the processing of further indications. MINIDXGRP UDINT This input allows filtering the requests by Index Group ranges. Specification of the Index Group value with which the selected range begins. Outputs VAR_OUTPUT VALID : BOOL; NETID : T_Ams Net Id; PORT : T_Ams Port; INVOKEID : UDINT; IDXGRP : UDINT; IDXOFFS : UDINT; LENGTH : UDINT; DATAADDR : PVOID; END_VAR 32 Version: 1.17.0 TE1000
## Page 33

Function blocks Name Type Description VALID BOOL The output is set if an Indication was registered from the function block and remains set until the latter was reported as processed by a positive edge at the CLEAR input. NETID T_Ams Net Id String containing the AMS network ID of the source device, from which the ADS command was sent (type: T_Ams Net Id [} 127]). PORT T_Ams Port Contains the port number of the ADS source device, from which the ADS command was sent (type: T_Ams Port [} 127]). INVOKEID UDINT Handle of the command, which was sent. The Invoke ID is specified from the source device and serves to identify the commands. IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. LENGTH UDINT Length of the written data in bytes. DATAADDR PVOID Address of the data buffer in which the written data is located. Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.35 PC or CX (x86, x64, ARM) Tc2_System (system) >= 3.4.26.0 3.2.2.6 ADSRDWRTIND The function block registers ADSRDWRT Requests to a PLC task as Indications and allows them to be processed. The queuing of an Indication is reported at the VALID output port by means of a rising edge. The Indication is reported as processed via a positive edge at the CLEAR input. A falling edge releases the function block for the processing of further indications. After an Indication has been processed a response must be sent to the source device via the ADSRDWRTRES [} 38] function block. The PORT and NETID parameters can be used to address the source device for this purpose. The INVOKEID parameter is used by the source device to assign the responses to the requests and is also sent back to the source device as a parameter. Inputs VAR_INPUT CLEAR : BOOL; END_VAR Name Type Description CLEAR BOOL With a rising edge at this input an indication is reported as processed and the outputs of the ADSRDWRTIND function block are reset. A falling edge releases the function block for the processing of further indications. TE1000 Version: 1.17.0 33
## Page 34

Function blocks Outputs VAR_OUTPUT VALID : BOOL; NETID : T_Ams Net Id; PORT : T_Ams Port; INVOKEID : UDINT; IDXGRP : UDINT; IDXOFFS : UDINT; RDLENGTH : UDINT; WRTLENGTH : UDINT; DATAADDR : PVOID; END_VAR Name Type Description VALID BOOL The output is set if an Indication was registered from the function block and remains set until the latter was reported as processed by a positive edge at the CLEAR input. NETID T_Ams Net Id String containing the AMS network ID of the source device, from which the ADS command was sent (type: T_Ams Net Id [} 127]). PORT T_Ams Port Contains the port number of the ADS source device, from which the ADS command was sent (type: T_Ams Port [} 127]). INVOKEID UDINT Handle of the command, which was sent. The Invoke Id is specified from the source device and serves to identify the commands. IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. RDLENGTH UDINT Length of the data to be read in bytes. WRTLENGTH UDINT Length of the written data in bytes. DATAADDR PVOID Address of the data buffer in which the written data is located. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.2.7 ADSRDWRTINDEX The function block registers ADSRDWRT Requests to a PLC task as Indications and allows them to be processed. The queuing of an Indication is reported at the VALID output port by means of a rising edge. The Indication is reported as processed via a positive edge at the CLEAR input. A falling edge releases the function block for the processing of further indications. After an Indication has been processed a response must be sent to the source device via the ADSRDWRTRES [} 38] function block. The PORT and NETID parameters can be used to address the source device for this purpose. The INVOKEID parameter is used by the source device to assign the responses to the requests and is also sent back to the source device as a parameter. Compared to the ADSRDWRTIND [} 33] function block there is the possibility to specify a desired range of the Index Group via an additional input. 34 Version: 1.17.0 TE1000
## Page 35

Function blocks This way, requests are filtered and only desired areas are responded to. There are 16 freely selectable ranges available: 0x80000000 - 0x80FFFFFF 0x81000000 - 0x81FFFFFF … 0x8E000000 – 0x8EFFFFFF 0x8F000000 – 0x8FFFFFFF To specify such a range of the index group at an Indication function block, the index group value with which the selected range begins is specified at input MINIDXGRP. Example: With MINIDXGRP:=16#85000000 all requests are filtered and requests with an index group in the range 0x85000000 - 0x85FFFFFF are registered as Indication. Inputs VAR_INPUT CLEAR : BOOL; MINIDXGRP : UDINT; END_VAR Name Type Description CLEAR BOOL With a rising edge at this input an indication is reported as processed and the outputs of the ADSRDWRTIND function block are reset. A falling edge releases the function block for the processing of further indications. MINIDXGRP UDINT This input allows filtering the requests by Index Group ranges. Specification of the Index Group value with which the selected range starts. Outputs VAR_OUTPUT VALID : BOOL; NETID : T_Ams Net Id; PORT : T_Ams Port; INVOKEID : UDINT; IDXGRP : UDINT; IDXOFFS : UDINT; RDLENGTH : UDINT; WRTLENGTH : UDINT; DATAADDR : PVOID; END_VAR Name Type Description VALID BOOL The output is set if an Indication was registered from the function block and remains set until the latter was reported as processed by a positive edge at the CLEAR input. NETID T_Ams Net Id String containing the AMS network ID of the source device, from which the ADS command was sent (type: T_Ams Net Id [} 127]). PORT T_Ams Port Contains the port number of the ADS source device, from which the ADS command was sent (type: T_Ams Port [} 127]). INVOKEID UDINT Handle of the command, which was sent. The Invoke Id is specified from the source device and serves to identify the commands. IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. RDLENGTH UDINT Length of the data to be read in bytes. WRTLENGTH UDINT Length of the written data in bytes. DATAADDR PVOID Address of the data buffer in which the written data is located. TE1000 Version: 1.17.0 35
## Page 36

Function blocks Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.35 PC or CX (x86, x64, ARM) Tc2_System (system) >= 3.4.26.0 3.2.2.8 ADSREADRES The ADSREADRES function block acknowledges Indications of a PLC task. A response is sent to the ADS source device via a positive edge on the RESPOND input. The source device is addressed via the PORT and NETID parameters. The INVOKEID parameter is used by the source device to assign the responses to the requests and is adopted by the output of the ADSREADIND [} 28] function block. An error code can be returned to the ADS source device via the RESULT parameter. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; INVOKEID : UDINT; RESULT : UDINT; LEN : UDINT; DATAADDR : PVOID; RESPOND : BOOL; END_VAR Name Type Description NETID T_Ams Net Id String containing the AMS network ID of the source device, to which the ADS command is to be sent (type: T_Ams Net Id [} 127]). PORT T_Ams Port Port number of the ADS source device to which the response should be sent (type: T_Ams Port [} 127]). INVOKEID UDINT Handle of the command, which was sent. The Invoke ID is specified from the source device and serves to identify the commands. RESULT UDINT ADS error code [} 148] or command-specific error code to be sent to the source device. LEN UDINT Number of data to be read in bytes. DATAADDR PVOID Address of the data buffer, which should be read. RESPOND BOOL The function block is activated by a positive edge at this input. Outputs VAR_OUTPUT (*none*) END_VAR Example of calling the block in ST: • Example with Ads Read Ind /Ads Read Res function blocks [} 137] Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 36 Version: 1.17.0 TE1000
## Page 37

Function blocks 3.2.2.9 ADSWRITERES The ADSWRITERES function block is used to acknowledge indications of a PLC task. A response is sent to the ADS source device via a rising edge on the RESPOND input. The source device is addressed via the PORT and NETID parameters. The INVOKEID parameter sorts the responses to the requests for the source device and is adopted by the output of the ADSWRITEIND [} 28] function block. An error code can be returned to the ADS source device via the RESULT parameter. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; INVOKEID : UDINT; RESULT : UDINT; RESPOND : BOOL; END_VAR Name Type Description NETID T_Ams Net Id String containing the AMS network ID of the source device, to which the ADS command is to be sent (type: T_Ams Net Id [} 127]). PORT T_Ams Port Port number of the ADS source device to which the ADS command is to be sent (type: T_Ams Port [} 127]). INVOKEID UDINT Handle of the command, which was sent. The Invoke Id is specified from the source device and serves to identify the commands. RESULT UDINT ADS error code [} 148] or command-specific error code to be sent to the source device. RESPOND BOOL The function block is activated by a positive edge at this input. Outputs VAR_OUTPUT (*none*) END_VAR Example of calling the block in ST: • Example with Ads Write Ind/Ads Write Res function blocks [} 139] Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) TE1000 Version: 1.17.0 37
## Page 38

Function blocks 3.2.2.10 ADSRDWRTRES The ADSRDWRTRES function block is used to acknowledge indications of a PLC task. A response is sent to the ADS source device via a rising edge on the RESPOND input. The source device is addressed via the PORT and NETID parameters. The INVOKEID parameter sorts the responses to the requests for the source device and is adopted by the output of the ADSRDWRTIND [} 33] function block. An error code can be returned to the ADS source device via the RESULT parameter. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; INVOKEID : UDINT; RESULT : UDINT; LEN : UDINT; DATAADDR : PVOID; RESPOND : BOOL; END_VAR Name Type Description NETID T_Ams Net Id String containing the AMS network ID of the source device, to which the ADS command is to be sent (type: T_Ams Net Id [} 127]). PORT T_Ams Port Port number of the ADS source device to which the ADS command is to be sent (type: T_Ams Port [} 127]). INVOKEID UDINT Handle of the command, which was sent. The Invoke ID is specified from the source device and serves to identify the commands. RESULT UDINT ADS error code [} 148] or command-specific error code to be sent to the source device. LEN UDINT Length, in bytes, of the read data. DATAADDR PVOID Address of the data buffer, in which the read data is located. RESPOND BOOL The function block is activated by a positive edge at this input. Outputs VAR_OUTPUT (*none*) END_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 38 Version: 1.17.0 TE1000
## Page 39

Function blocks 3.2.3 ADSREAD The function block executes an ADS read command to request data from an ADS device. Outdated response data After a disconnection, the old response data is output when the connection is reconnected. To prevent this, be careful not to use the same ADS-Read instance for multiple targets. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; IDXGRP : UDINT; IDXOFFS : UDINT; LEN : UDINT; DESTADDR : PVOID; READ : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description NETID T_Ams String containing the AMS network ID of the target device to which the ADS Net Id command is addressed (type: T_Ams Net Id [} 127]). PORT T_Ams Port number of the ADS device (type: T_Ams Port [} 127]) Port IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. LEN UDINT Number of data to be read in bytes DESTADD PVOID Address of the buffer that is to receive the read data. The programmer is responsible R for dimensioning the buffer such that it can accommodate LEN bytes. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. READ BOOL The ADS command is triggered by a rising edge at this input. TMOUT TIME Indicates the time before the function is canceled. Outputs VAR_OUTPUT BUSY : BOOL; ERR : BOOL; ERRID : UDINT; END_VAR TE1000 Version: 1.17.0 39
## Page 40

Function blocks Name Type Description BUSY BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the Timeout input. No new commands are accepted at the inputs as long as BUSY = TRUE. Note that it is not the execution of the service but its acceptance whose time is monitored. ERR BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in ERRID. If the function block has a timeout error, ERR is TRUE and ERRID is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. ERRID UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Example of calling the block in ST: • Example with Ads Read function block [} 140] Example of calling the block in FBD: Here the error status of axis no. 6, as an element with a size of 4 bytes, is interrogated and written into the data Arr buffer. The IDXGRP 00004006 (hex) and the IDXOFFS 00000001 (hex) can be found in the NC- ADS documentation. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.4 ADSREADEX The function block executes an ADS read command to request data from an ADS device. The function block has the same functionality as the ADSREAD function block; in addition it returns the number of actually read data bytes as parameter. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; IDXGRP : UDINT; IDXOFFS : UDINT; LEN : UDINT; DESTADDR : PVOID; 40 Version: 1.17.0 TE1000
## Page 41

Function blocks READ : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description NETID T_Ams N String containing the AMS network ID of the target device to which the ADS et Id command is addressed (type: T_Ams Net Id [} 127]). PORT T_Ams Po Port number of the ADS device (type: T_Ams Port [} 127]) rt IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. LEN UDINT Number of data to be read in bytes DESTADD PVOID Address of the buffer that is to receive the read data. The programmer is responsible R for dimensioning the buffer such that it can accommodate LEN bytes. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. READ BOOL The ADS command is triggered by a rising edge at this input. TMOUT TIME Indicates the time before the function is canceled. Outputs VAR_OUTPUT BUSY : BOOL; ERR : BOOL; ERRID : UDINT; COUNT_R : UDINT; END_VAR Name Type Description BUSY BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the Timeout input. While BUSY = TRUE, no new command will be accepted at the inputs. Note that it is not the execution of the service but its acceptance whose time is monitored. ERR BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in ERRID. If the function block has a timeout error, ERR is TRUE and ERRID is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. ERRID UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. COUNT_R UDINT Number of successfully read data bytes Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.5 ADSWRITE TE1000 Version: 1.17.0 41
## Page 42

Function blocks Block for executing an ADS write command for transferring data to an ADS device. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; IDXGRP : UDINT; IDXOFFS : UDINT; LEN : UDINT; SRCADDR : PVOID; WRITE : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description NETID T_Ams N String containing the AMS network ID of the target device to which the ADS et Id command is addressed (type: T_Ams Net Id [} 127]). PORT T_Ams Po Port number of the ADS device (type: T_Ams Port [} 127]) rt IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. LEN UDINT Number of data to be read in bytes SRCADDR PVOID Address of the buffer from which the data to be written is to be fetched. The programmer is responsible for dimensioning the buffer such that LEN bytes can be taken from it. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. WRITE BOOL The ADS command is triggered by a rising edge at this input. TMOUT TIME Indicates the time before the function is canceled. Outputs VAR_OUTPUT BUSY : BOOL; ERR : BOOL; ERRID : UDINT; END_VAR Name Type Description BUSY BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the Timeout input. No new commands are accepted at the inputs as long as BUSY = TRUE. Note that it is not the execution of the service but its acceptance whose time is monitored. ERR BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in ERRID. If the function block has a timeout error, ERR is TRUE and ERRID is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. ERRID UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Example of calling the block in ST: • Example with Ads Write function block [} 141] Example of calling the block in FBD 42 Version: 1.17.0 TE1000
## Page 43

Function blocks NC axis no. 1 is here deactivated through a write instruction with IDXGRP 00004201 (hex) and the IDXOFFS 00000050 (hex). To activate the axis another write instruction with the IDXOFFS 00000051 (hex) must be given. Since this write instruction does not require any parameters, the inputs LEN and SRCADDR have no significance, but must nevertheless be set to zero. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.6 ADSRDWRT The function block executes a combined ADS read-write command. Data is transmitted to an ADS device (write) and its response data read with one call. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; IDXGRP : UDINT; IDXOFFS : UDINT; WRITELEN : UDINT; READLEN : UDINT; SRCADDR : PVOID; DESTADDR : PVOID; WRTRD : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR TE1000 Version: 1.17.0 43
## Page 44

Function blocks Name Type Description NETID T_Ams N String containing the AMS network ID of the target device to which the ADS et Id command is addressed (type: T_Ams Net Id [} 127]). PORT T_Ams Po Port number of the ADS device (type: T_Ams Port [} 127]) rt IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. WRITELE UDINT Number of data to be written in bytes N READLEN UDINT Number of data to be read in bytes SRCADDR PVOID Address of the buffer from which the data to be written is to be fetched. The programmer is responsible for dimensioning the buffer such that WRITELEN bytes can be taken from it. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. DESTADD PVOID Address of the buffer that is to receive the read data. The programmer is responsible R for dimensioning the buffer such that it can accommodate READLEN bytes. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. WRTRD BOOL The ADS command is triggered by a rising edge at this input. TMOUT TIME Indicates the time before the function is canceled. Outputs VAR_OUTPUT BUSY : BOOL; ERR : BOOL; ERRID : UDINT; END_VAR Name Type Description BUSY BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the Timeout input. No new commands are accepted at the inputs as long as BUSY = TRUE. Note that it is not the execution of the service but its acceptance whose time is monitored. ERR BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in ERRID. If the function block has a timeout error, ERR is TRUE and ERRID is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. ERRID UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Example of calling the block in FBD: 44 Version: 1.17.0 TE1000
## Page 45

Function blocks The value of the variable with the name “a LReal Var” is here read from the PLC which is running on the computer with the Net-Id 1.1.1.2.7.1. For this purpose, the computer address mentioned, the port number of the PLC’s first run-time system, the index group, and the index offset for reading the variable by name (F004 hex, 0) are given. The name of the variable is to be supplied to the PLC server; it is placed for this purpose in a buffer. Since the variable is global, it has a leading dot. This makes the length of the data to be written 10 characters (1 dot and 9 letters). Since the variable to be read is of type LREAL, the number of bytes to be read is 8. The address of the name buffer is given as the address for the data to be written, while for the receive data the address of an LREAL variable (result Var) is given. The diagram shows the state of the block in flow control after execution of the Write Read instruction: the value 1234.567, which was previously contained in a LReal Var is now also contained in result Var. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.2.7 ADSRDWRTEX This block allows execution of a combined ADS write/read instruction. Data is transmitted to an ADS device (write) and its response data read with one call. Contrary to the ADSRDWRT function block ADSRDWRTEX supplies the number of actually read data bytes as parameter. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; IDXGRP : UDINT; IDXOFFS : UDINT; WRITELEN : UDINT; READLEN : UDINT; SRCADDR : PVOID; DESTADDR : PVOID; TE1000 Version: 1.17.0 45
## Page 46

Function blocks WRTRD : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description NETID T_Ams N String containing the AMS network ID of the target device to which the ADS et Id command is addressed (type: T_Ams Net Id [} 127]). PORT T_Ams Po Port number of the ADS device (type: T_Ams Port [} 127]) rt IDXGRP UDINT Index group number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. IDXOFFS UDINT Index offset number (32-bit, unsigned) of the requested ADS service. This value is to be found in the ADS table of the addressed device. WRITELE UDINT Number of data to be written in bytes N READLEN UDINT Number of data to be read in bytes SRCADDR PVOID Address of the buffer from which the data to be written is to be fetched. The programmer is responsible for dimensioning the buffer such that WRITELEN bytes can be taken from it. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. DESTADD PVOID Address of the buffer that is to receive the read data. The programmer is responsible R for dimensioning the buffer such that it can accommodate READLEN bytes. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. WRTRD BOOL The ADS command is triggered by a rising edge at this input. TMOUT TIME Indicates the time before the function is canceled. Outputs VAR_OUTPUT BUSY : BOOL; ERR : BOOL; ERRID : UDINT; COUNT_R : UDINT; END_VAR Name Type Description BUSY BOOL This output remains TRUE until the function block has executed a command, but at the longest for the duration supplied to the Timeout input. While BUSY = TRUE, no new command will be accepted at the inputs. Note that it is not the execution of the service but its acceptance whose time is monitored. ERR BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in ERRID. If the function block has a timeout error, ERR is TRUE and ERRID is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. ERRID UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. COUNT_R UDINT Number of successfully read data bytes Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 46 Version: 1.17.0 TE1000
## Page 47

Function blocks 3.3 File function blocks These function blocks are only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. 3.3.1 FB_EOF The function block FB_EOF can check whether the end of the file was reached. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; h File : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). h File UINT File handle, which was generated when the function block FB_File Open was created. b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; b EOF : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. b EOF BOOL This output is set when the end of the file is reached. TE1000 Version: 1.17.0 47
## Page 48

Function blocks Command-specific error code Possible cause 0x703 Invalid or unknown file handle. 0x70E File was opened with wrong method (e.g. with obsolete FILEOPEN function block). Example of calling the function block in FBD: PROGRAM Test VAR fb EOF : FB_EOF; h File : UINT; b File EOF : BOOL; b EOFBusy : BOOL; b EOFError : BOOL; n EOFError Id : UDINT; b Is EOF : BOOL; END_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.3.2 FB_File Open The function block FB_File Open creates a new file or opens an existing file for editing. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; s Path Name : T_Max String; n Mode : DWORD; e Path : E_Open Path := PATH_GENERIC; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR 48 Version: 1.17.0 TE1000
## Page 49

Function blocks Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). s Path Name T_Max String Storage path and file name of the file to be opened. The path can only point to the local file system of the computer. Network paths cannot be specified here (type: T_Max String [} 129]). n Mode DWORD Mode for opening the file. e Path E_Open Path This input can be used to select a Twin CAT system path on the target device for opening the file (type: E_Open Path [} 123]). b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Predefined opening modes for n Mode Mode for opening the file. The codes listed below are the various opening modes which are already pre- defined as constants in the library and which can accordingly be passed symbolically to the function block. The opening modes can be ORed. The opening modes can be combined, similar to the opening modes of the fopen function in C or C++. Modes Description FOPEN_MODEREAD r: Opens a file for reading. An error is returned if the file cannot be found or does not exist. FOPEN_MODEWRITE w: Opens an empty file for writing. If the file already exists, it is overwritten. FOPEN_MODEAPPEND a: Opens a file for writing at the end of the file (append). If the file does not exist, a new file is created. FOPEN_MODEREAD OR r+: Opens a file for reading and writing. The file must exist. FOPEN_MODEPLUS FOPEN_MODEWRITE OR w+: Opens an empty file for reading and writing. If the file already FOPEN_MODEPLUS exists, it is overwritten. FOPEN_MODEAPPEND OR a+: opens a file for reading and writing at the end of the file FOPEN_MODEPLUS (append). If the file does not exist, a new file is created. For this, the memory path must be known, otherwise error 1804 appears. All write operations are always performed at end of a file, if the file was opened in the modes a or a+. The file pointer can be moved with FB_File Seek, although for writing it is moved to the end of the file by default, i.e. existing data cannot be overwritten. FOPEN_MODEBINARY b: Opens the file in binary mode FOPEN_MODETEXT t: Opens the file in text mode Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; h File : UINT;(* file handle *) END_VAR TE1000 Version: 1.17.0 49
## Page 50

Function blocks Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. h File UINT Contains the file handle created for the file when opening has been successful. This handle is then transferred to the other file function blocks as ID for the file to be edited. Error codes for h File Command-specific error code Possible cause 0x703 Unknown or invalid n Mode or e Path parameter. 0x70C File not found. Invalid file name or path. 0x716 No further free file handles. Information: In the opening mode, a maximum of 3 parameters may be ORed: Mode = [ Parameter1 ] OR [ Parameter2 ] OR [ Paramerter3 ] Parameter1 may have only a subordinate value: • FOPEN_MODEREAD • FOPEN_MODEWRITE • FOPEN_MODEAPPEND Parameter2 may have only one subordinate value: • FOPEN_MODEPLUS Parameter3 may have only one subordinate value: • FOPEN_MODEBINARY • FOPEN_MODETEXT If no binary or text mode is specified, the file opens in a mode defined by an operating system variable. In most cases, the file will then open in text mode. However, it is not possible to make a clear statement. It is useful to always specify the text or binary mode. This system variable cannot be changed in the PLC! This results in the following permissible combinations: 50 Version: 1.17.0 TE1000
## Page 51

Function blocks Text file opening modes Binary file opening modes FOPEN_MODEREAD OR FOPEN_MODEREAD OR FOPEN_MODETEXT FOPEN_MODEBINARY FOPEN_MODEWRITE OR FOPEN_MODEWRITE OR FOPEN_MODETEXT FOPEN_MODEBINARY FOPEN_MODEAPPEND OR FOPEN_MODEAPPEND OR FOPEN_MODETEXT FOPEN_MODEBINARY FOPEN_MODEREAD OR FOPEN_MODEREAD OR FOPEN_MODEPLUS OR FOPEN_MODEPLUS OR FOPEN_MODETEXT FOPEN_MODEBINARY FOPEN_MODEWRITE OR FOPEN_MODEWRITE OR FOPEN_MODEPLUS OR FOPEN_MODEPLUS OR FOPEN_MODETEXT FOPEN_MODEBINARY FOPEN_MODEAPPEND OR FOPEN_MODEAPPEND OR FOPEN_MODEPLUS OR FOPEN_MODEPLUS OR FOPEN_MODETEXT FOPEN_MODEBINARY All other combinations are wrong. Examples of invalid opening modes: FOPEN_MODEBINARY OR FOPEN_MODETEXT FOPEN_MODEWRITE OR FOPEN_MODEAPPEND Example of calling the block in ST: • File access from the PLC [} 143] Example of calling the block in FBD: PROGRAM Test VAR fb File Open : FB_File Open; b File Open : BOOL; b File Open Busy : BOOL; b File Open Error : BOOL; n File Open Err Id : UDINT; h File : UINT; END_VAR This should create (or overwrite) the file Test File2.txt in the root directory of drive C: in the text mode. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.3.3 FB_File Close The function block FB_File Close closes the file, thereby putting it in a defined state for further processing by other programs. TE1000 Version: 1.17.0 51
## Page 52

Function blocks This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; h File : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). h File UINT Handle of the file to be closed. b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. Command specific error code for n Err Id Returns the ADS error code [} 148] or the command-specific error code when the b Error output is set. Command-specific error code Possible cause 0x703 Invalid or unknown file handle. 0x70E File was opened with wrong method (e.g. with obsolete FILEOPEN function block). Example of calling the block in ST: • File access from the PLC [} 143] Example of calling the block in FBD: PROGRAM Test VAR fb File Close : FB_File Close; h File : UINT; b File Close : BOOL; b File Close Busy : BOOL; b File Close Error : BOOL; n File Close Error Id : UDINT; END_VAR 52 Version: 1.17.0 TE1000
## Page 53

Function blocks Here the file associated with the file handle (which was itself generated by FB_File Open) is closed again. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.3.4 FB_File Load The contents of a file can be read out with the function block FB_File Load. The file is opened implicitly in binary mode, the contents are read out and the file is then closed again. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; s Path Name : T_Max String; p Read Buff : PVOID; cb Read Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). s Path Name T_Max String Storage path and file name of the file to be opened. The path can only point to the local file system of the computer. Network paths cannot be specified here (type: T_Max String [} 129]) p Read Buff PVOID Address of the buffer into which the data are to be read. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. cb Read Len UDINT Number of bytes to be read. b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the internal ADS command. TE1000 Version: 1.17.0 53
## Page 54

Function blocks Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Read : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. cb Read UDINT Number of currently read bytes Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.4022.0 PC or CX (x86, x64, ARM) Tc2_System (System) >= v3.4.22.0 3.3.5 FB_File Gets The function block FB_File Gest reads strings from a file. The string is read up to and including the line feed character, or up to the end of the file or the maximum permitted length of s Line. The null termination is appended automatically. The file must have been opened in text mode. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; h File : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). h File UINT File handle, which was generated when the function block FB_File Open was created. b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. 54 Version: 1.17.0 TE1000
## Page 55

Function blocks Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; s Line : T_Max String; b EOF : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. s Line T_Max String String that was read (type: T_Max String [} 129]). b EOF BOOL This output is set if the end of the file was reached and no further data bytes could be read (cb Read=0). This output is not set if further data bytes could be read (cb Read>0). Command-specific error code Possible cause 0x703 Invalid or unknown file handle. 0x70A No memory for read buffer. 0x70E File was opened with wrong method (e.g. with obsolete FILEOPEN function block). Example of calling the function block in FBD: PROGRAM Test VAR fb File Gets : FB_File Gets; h File : UINT; b File Gets : BOOL; b File Gets Busy : BOOL; b File Gets Error : BOOL; n File Gets Error Id : UDINT; str Buffer : STRING; b File Gets EOF : BOOL; END_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.3.6 FB_File Puts TE1000 Version: 1.17.0 55
## Page 56

Function blocks The function block FB_File Puts writes strings into a file. The string is written to the file up to the null termination, but without the null character. The file must have been opened in text mode. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; h File : UINT; s Line : T_Max String;(* string to write *) b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). h File UINT File handle, which was generated when the function block FB_File Open was created. s Line T_Max String String to be written into the file (type: T_Max String [} 129]). b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. Command-specific error code Possible cause 0x703 Invalid or unknown file handle. 0x70E File was opened with wrong method (e.g. with obsolete FILEOPEN function block). Example of calling the function block in FBD: PROGRAM Test VAR fb File Puts : FB_File Puts; h File : UINT; b File Puts : BOOL; b File Puts Busy : BOOL; b File Puts Error : BOOL; n File Puts Error Id : UDINT; END_VAR 56 Version: 1.17.0 TE1000
## Page 57

Function blocks Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.3.7 FB_File Read With the function block FB_File Read the contents of an already opened file can be read. Before a read access, the file must have been opened in the corresponding mode. In addition to the FOPEN_MODEREAD, the appropriate format (FOPEN_MODEBINARY or FOPEN_MODETEXT) is also important to achieve the desired result. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; h File : UINT; p Read Buff : PVOID; cb Read Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). h File UINT File handle, which was generated when the function block FB_File Open was created. p Read Buff PVOID Address of the buffer into which the data are to be read. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. cb Read Len UDINT Number of bytes to be read b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. TE1000 Version: 1.17.0 57
## Page 58

Function blocks Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Read : UDINT; b EOF : BOOL; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. cb Read UDINT Number of currently read bytes b EOF BOOL This output is set if the end of the file was reached and no further data bytes could be read (cb Read=0). This output is not set if further data bytes could be read (cb Read>0). Command-specific error code Possible cause 0x703 Invalid or unknown file handle. 0x70A No memory for read buffer. 0x70E File was opened with wrong method (e.g. with obsolete FILEOPEN function block). Example of calling the block in ST: • File access from the PLC [} 143] Example of calling the function block in FBD: PROGRAM Test VAR fb File Read : FB_File Read; h File : UINT; b File Read : BOOL; b File Read Busy : BOOL; b File Read Error : BOOL; n File Read Error Id : UDINT; n File Read Count : UDINT; b File Read EOF : BOOL; file Data : ARRAY[0..9] OF BYTE; END_VAR After a rising edge at b Execute and successful execution of the read instruction the currently read bytes from the file are found in FILEDATA. The parameter cb Read can be used to determine how many bytes were actually read during the last read operation. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 58 Version: 1.17.0 TE1000
## Page 59

Function blocks 3.3.8 FB_File Write The function block FB_File Write writes data into a file. For write access the file must have been opened in the corresponding mode, and it must be closed again for further processing by external programs. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; h File : UINT; p Write Buff : PVOID; cb Write Len : UDINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). h File UINT File handle, which was generated when the function block FB_File Open was created. p Write Buff PVOID Address of the buffer containing the data to be written. The buffer can be a single variable, an array or a structure, whose address can be found with the ADR operator. cb Write Len UDINT Number of bytes to be written b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; cb Write : UDINT; END_VAR TE1000 Version: 1.17.0 59
## Page 60

Function blocks Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. cb Write UDINT Contains the number of the last successfully written data bytes. A write error indicates that the number of successfully written data bytes is less than the requested length (cb Write Len) or zero. A write error can occur if the data carrier is full, for example. If a write error occurs, the b Error and n Err ID outputs are not set. Since the PLC application knows the number of data bytes to be written, it can compare the actual written length with the requested length and detect write errors. When a write error occurs, the internal file pointer has an undefined position. Command-specific error code Possible cause 0x703 Invalid or unknown file handle. 0x70E File was opened with wrong method (e.g. with obsolete FILEOPEN function block). Example of calling the block in ST: • File access from the PLC [} 143] Example of calling the block in FBD: PROGRAM Test VAR fb File Write : FB_File Write; h File : UINT; b File Write : BOOL; b File Write Busy : BOOL; b File Write Error : BOOL; n File Write Error Id: UDINT; n File Write Count : UDINT; file Data : ARRAY[0..9] OF BYTE; END_VAR In the example, after a rising edge at b File Write, 10 bytes of the array FILEDATA are written to the file. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 60 Version: 1.17.0 TE1000
## Page 61

Function blocks 3.3.9 FB_File Seek The function block FB_File Seek sets the file pointer of an open file to a definable position. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; h File : UINT; n Seek Pos : DINT;(* new seek pointer position *) e Origin : E_Seek Origin:= SEEK_SET; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). h File UINT File handle, which was generated when the function block FB_File Open was created. n Seek Pos DINT New position of the file pointer e Origin E_Seek Origin Relative position, to which the file pointer is to be moved (type: E_Seek Origin [} 123]). b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. Command-specific error code Possible cause 0x703 Invalid or unknown file handle. 0x70E File was opened with wrong method (e.g. with obsolete FILEOPEN function block). TE1000 Version: 1.17.0 61
## Page 62

Function blocks Example of calling the function block in FBD: PROGRAM Test VAR fb File Seek : FB_File Seek; h File : UINT; n Seek Pos : DINT; b File Seek : BOOL; b File Seek Busy : BOOL; b File Seek Error : BOOL; n File Seek Error Id : UDINT; END_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.3.10 FB_File Tell The function block FB_File Tell determines the current position of the file pointer. The position indicates the relative offset from the start of the file. Note that for files opened in "Append at end of file" mode, the current position is determined by the last I/O operation, not by the position of the next write access. After a read operation, for example, the file pointer is at the position where the next read access will take place, not at the position where the next write access will take place. In append mode, the file pointer is always moved to the end before the write operation. If no previous I/O operation was performed and the file was opened in append mode, the file pointer is at the start of the file. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; h File : UINT; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR 62 Version: 1.17.0 TE1000
## Page 63

Function blocks Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). h File UINT File handle, which was generated when the function block FB_File Open was created. b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; n Seek Pos : DINT;(* On error, n SEEKPOS returns -1 *) END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. n Seek Pos DINT Returns the current position of the file pointer. Command-specific error code Possible cause 0x703 Invalid or unknown file handle. 0x70E File was opened with wrong method (e.g. with obsolete FILEOPEN function block). Example of calling the function block in FBD: PROGRAM Test VAR fb File Tell : FB_File Tell; h File : UINT; b File Tell : BOOL; b File Tell Busy : BOOL; b File Tell Error : BOOL; n File Tell Error Id : UDINT; n File Tell Seek Pos : DINT; END_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) TE1000 Version: 1.17.0 63
## Page 64

Function blocks 3.3.11 FB_File Delete The function block FB_File Delete deletes a file from the data storage device. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; s Path Name : T_Max String;(* file path and name *) e Path : E_Open Path := PATH_GENERIC; b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). s Path Name T_Max String File name, including the full path (type: T_Max String [} 129]). e Path E_Open Path This input can be used to select a Twin CAT system path on the target device for opening the file (type: E_Open Path [} 123]). b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. Command-specific error code Possible cause 0x70C File not found. Invalid s Path Name or e Path parameter. Example of calling the function block in FBD: 64 Version: 1.17.0 TE1000
## Page 65

Function blocks PROGRAM Test VAR fb File Delete : FB_File Delete; b File Delete : BOOL; b File Delete Busy : BOOL; b File Delete Error : BOOL; n File Delete Err Id : UDINT; END_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.3.12 FB_File Rename The function block FB_File Rename can be used to rename a file. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; s Old Name : T_Max String; s New Name : T_Max String; e Path : E_Open Path := PATH_GENERIC; (* Default: generic file path*) b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). s Old Name T_Max String Old file name (type: T_Max String [} 129]) s New Name T_Max String New file name (type: T_Max String [} 129]) e Path E_Open Path This input can be used to select a Twin CAT system path on the target device for opening the file (type: E_Open Path [} 123]). b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. TE1000 Version: 1.17.0 65
## Page 66

Function blocks Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. Command-specific error code Possible cause 0x70C File not found. Invalid s Old Name, s New Name or e Path parameter. Example of calling the function block in FBD: PROGRAM Test VAR fb File Rename : FB_File Rename; b File Rename : BOOL; b File Rename Busy : BOOL; b File Rename Error : BOOL; n File Rename Err Id : UDINT; END_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.3.13 FB_Create Dir The function block FB_Create Dir can be used to create new directories on the data storage device. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. 66 Version: 1.17.0 TE1000
## Page 67

Function blocks Inputs VAR_INPUT s Net Id : T_Ams Net Id; s Path Name : T_Max String; e Path : E_Open Path := PATH_GENERIC; (* Default: generic file path*) b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). s Path Name T_Max String Name of the new directory. When the function block is called, the only option is to create a new directory (type: T_Max String [} 129]). e Path E_Open Path This input can be used to select a Twin CAT system path for the new directory on the target device (type: E_Open Path [} 123]). b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. Command-specific error code Possible cause 0x723 Folder is already existing or invalid s Path Name or e Path parameter. Example in ST: By a rising edge at b Create a new directory in the main directory C:\ named “PRJDATA” is created. By a rising edge at b Remove a directory with the same name can be deleted. At b Boot Folder = TRUE a directory in the ..\Twin CAT\Boot directory can be created or deleted. PROGRAM MAIN VAR s Folder Name : STRING := 'PRJDATA'; (* folder name *) b Boot Folder : BOOL; e Path : E_Open Path; (* folders root path *) s Path Name : STRING; fb Create Dir : FB_Create Dir; b Create : BOOL; b Create_Busy : BOOL; b Create_Error : BOOL; n Create_Err ID : UDINT; TE1000 Version: 1.17.0 67
## Page 68

Function blocks fb Remove Dir : FB_Remove Dir; b Remove : BOOL; b Remove_Busy : BOOL; b Remove_Error : BOOL; n Remove_Err ID : UDINT; END_VAR e Path := SEL( b Boot Folder, PATH_GENERIC, PATH_BOOTPATH ); s Path Name := SEL( b Boot Folder, CONCAT('C:\', s Folder Name), s Folder Name ); IF b Create THEN b Create := FALSE; fb Create Dir( b Execute := FALSE ); fb Create Dir(s Net Id:= '', s Path Name:= s Path Name, e Path:= e Path, b Execute:= TRUE, t Timeout:= DEFAULT_ADS_TIMEOUT, b Busy=>b Create_Busy, b Error=>b Create_Error, n Err Id=>n Create_Err ID ); ELSE fb Create Dir( b Execute := FALSE, b Busy=>b Create_Busy, b Error=>b Create_Error, n Err Id=>n Create_Err I D ); END_IF IF b Remove THEN b Remove := FALSE; fb Remove Dir( b Execute := FALSE ); fb Remove Dir(s Net Id:= '', s Path Name:= s Path Name, e Path:= e Path, b Execute:= TRUE, t Timeout:= DEFAULT_ADS_TIMEOUT, b Busy=>b Remove_Busy, b Error=>b Remove_Error, n Err Id=>n Remove_Err ID ); ELSE fb Remove Dir( b Execute := FALSE, b Busy=>b Remove_Busy, b Error=>b Remove_Error, n Err Id=>n Remove_Err I D ); END_IF Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.3.14 FB_Remove Dir The function block FB_Remove Dir can be used to delete a directory from the data storage device. A directory containing files cannot be deleted. This function block is only suitable for logging in real-time to a limited extent. For good performance, we recommend using the TF3500 Twin CAT Analytics Logger product, which is subject to a charge. Inputs VAR_INPUT s Net Id : T_Ams Net Id; s Path Name : T_Max String; e Path : E_Open Path := PATH_GENERIC; (* Default: generic file path*) b Execute : BOOL; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR 68 Version: 1.17.0 TE1000
## Page 69

Function blocks Name Type Description s Net Id T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). s Path Name T_Max String Directory name to be deleted. When the function block is called, only one directory can be deleted. The last component of s Path Name must contain the directory name to be deleted (type: T_Max String [} 129]). e Path E_Open Path This input can be used to select a Twin CAT system path for deleting the directory on the target device (type: E_Open Path [} 123]). b Execute BOOL The function block is activated by a rising edge at this input. t Timeout TIME States the length of the timeout that may not be exceeded by execution of the ADS command. Outputs VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be created. b Error BOOL If an error occurs during command execution, this output is set, once the b Busy output has been reset. n Err Id UDINT Returns the ADS error code [} 148] or the command- specific error code when the b Error output is set. Command-specific error code Possible cause 0x70C Folder not found or invalid s Path Name or e Path parameter. Example in ST: See description of FB_Create Dir [} 66]. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) TE1000 Version: 1.17.0 69
## Page 70

Function blocks 3.4 Event Logger function blocks 3.4.1 ADSLOGEVENT This function block allows the sending and acknowledgment of messages to the Twin CAT Event Logger. Twin CAT Event Logger vs. Twin CAT 3 Event Logger The Twin CAT Event Logger was replaced by the successor Twin CAT 3 Event Logger. The older Twin CAT Event Logger is supported by Twin CAT 3 up to version 3.1.4024. Newer Twin CAT versions (>= 3.1.4026.0) only support the newer Twin CAT 3 Event Logger. PLC function blocks for this can be found in the PLC library Tc3_Event Logger. Inputs VAR_INPUT NETID : T_Ams Net Id; PORT : T_Ams Port; Event : BOOL; Event Quit : BOOL; Event Config Data : Tc Event; Event Data Address : PVOID; Event Data Length : UDINT; Fb Cleanup : BOOL; TMOUT : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description NETID T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). PORT T_Ams Port Port number of the ADS device. The Twin CAT Event Logger has the port number 110 (type: T_Ams Port [} 127]). Event BOOL The "coming" of the event is signaled with the rising edge, the "going" of the event with the falling edge. Event Quit BOOL The event is acknowledged with the rising edge. Event Config Tc Event Data structure with the event parameters (type: Tc Event [} 129]). Data Event Data PVOID Address with the data to be sent with the event. Address Event Data UDINT Length of the data to be sent with the event. Length Fb Cleanup BOOL If TRUE, the function block is completely initialized. TMOUT TIME Indicates the time before the function is canceled. Outputs VAR_OUTPUT Event State : UDINT; Err : BOOL; Err Id : UDINT; Quit : BOOL; END_VAR 70 Version: 1.17.0 TE1000
## Page 71

Function blocks Name Type Description Event State UDINT State of the event. Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in Err Id. If the function block has a timeout error, Err is TRUE and Err Id is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. Err Id UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Quit BOOL Acknowledges the event. Acknowledge messages The upper figure represents the general sequence. In the case of messages not requiring acknowledgment, the event is announced with the rising edge at the event input of the function block and is thus active in the Event Logger. The falling edge at the event input initiates the reset. This signal deletes the event in the Event Logger again. In the case of messages requiring acknowledgment, the event is activated again with the rising edge at the event input. The event is deactivated either • by the falling edge at the event input (if an acknowledgment signal had previously come from the PLC with the Quit input or from the visualization) or • by the rising edge at the Quit input (if a reset had previously been initiated by a falling edge at the event input). TE1000 Version: 1.17.0 71
## Page 72

Function blocks If there is a reset of the event between event activation and the arrival of the acknowledgement, the next arrival of the event input is called "signal". A request is thus announced in case of already active events. Example for the use of the ADSLOGEVENT function block in ST: • Sending/acknowledging event logger signals from the PLC [} 142] Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_System (system) up to Twin CAT v3.1.4024 3.4.2 ADSCLEAREVENTS The function block sends and acknowledges messages to the Twin CAT Event Logger. Twin CAT Event Logger vs. Twin CAT 3 Event Logger The Twin CAT Event Logger was replaced by the successor Twin CAT 3 Event Logger. The older Twin CAT Event Logger is supported by Twin CAT 3 up to version 3.1.4024. Newer Twin CAT versions (>= 3.1.4026.0) only support the newer Twin CAT 3 Event Logger. PLC function blocks for this can be found in the PLC library Tc3_Event Logger. Inputs VAR_INPUT NETID : T_Ams Net Id; b Clear : BOOL; i Mode : UDINT; t Timeout : TIME := DEFAULT_ADS_TIMEOUT; END_VAR Name Type Description NETID T_Ams Net Id String containing the AMS network ID of the target device to which the ADS command is addressed (type: T_Ams Net Id [} 127]). b Clear BOOL With the rising edge the events are deleted. i Mode UDINT Mode for deleting the events. Defined in the enum E_Tc Event Clear Modes [} 124]. t Timeout TIME Indicates the time before the function is canceled. Outputs VAR_OUTPUT b Busy : BOOL; b Err : BOOL; i Err Id : UDINT; END_VAR 72 Version: 1.17.0 TE1000
## Page 73

Function blocks Name Type Description b Busy BOOL When the function block is activated, this output is set to TRUE and remains set until feedback is received. As long as b Busy is TRUE, no new command can be executed. b Err BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in i Err Id. If the function block has a timeout error, b Err is TRUE and i Err Id is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. i Err Id UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_System (system) up to Twin CAT v3.1.4024 3.4.3 FB_Simple Ads Log Event This function block allows the sending and acknowledgment of messages to the Twin CAT Event Logger. As opposed to the ADSLOGEVENT block, events cannot be parameterized from the PLC with the FB_Simple Ads Log Event block; however, events can be set, reset and acknowledged in a simple manner. Twin CAT Event Logger vs. Twin CAT 3 Event Logger The Twin CAT Event Logger was replaced by the successor Twin CAT 3 Event Logger. The older Twin CAT Event Logger is supported by Twin CAT 3 up to version 3.1.4024. Newer Twin CAT versions (>= 3.1.4026.0) only support the newer Twin CAT 3 Event Logger. PLC function blocks for this can be found in the PLC library Tc3_Event Logger. Inputs VAR_INPUT Source Id : INT; Event Id : INT; b Set Event : BOOL; b Quit : BOOL; END_VAR Name Type Description Source Id INT ID of the source. Used to clearly identify the source in the Event Logger. Event Id INT ID of the event. Used to clearly identify the event in the Event Logger. b Set Event BOOL The "coming" of the event is signaled with the rising edge, the "going" of the event with the falling edge. b Quit BOOL The event is acknowledged with the rising edge. TE1000 Version: 1.17.0 73
## Page 74

Function blocks Outputs VAR_OUTPUT Err Id : UDINT; Error : BOOL; END_VAR Name Type Description Err Id UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command-specific error code is contained in Err Id. If the function block has a timeout error, Error is TRUE and Err Id is 1861 (hexadecimal 0x745). Is reset to FALSE by the execution of a command at the inputs. Acknowledge messages The upper figure represents the general sequence. In the case of messages not requiring acknowledgment, the event is announced with the rising edge at the event input of the function block and is thus active in the Event Logger. The falling edge at the event input initiates the reset. This signal deletes the event in the Event Logger again. In the case of messages requiring acknowledgment, the event is activated again with the rising edge at the event input. The event is deactivated either • by the falling edge at the event input (if an acknowledgment signal had previously come from the PLC with the Quit input or from the visualization) or 74 Version: 1.17.0 TE1000
## Page 75

Function blocks • by the rising edge at the Quit input (if a reset had previously been initiated by a falling edge at the event input). If there is a reset of the event between event activation and arrival of the acknowledgement, the next arrival of the event input is called "signal". A request is thus announced in case of already active events. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_System (system) up to Twin CAT v3.1.4024 3.5 IEC steps / SFC flags function blocks 3.5.1 Analyze Expression The function block can be used in PLC projects that use the SFC flags. No instances are generated. The corresponding PLC library must be integrated in the project. Further configuration requirements can be found in the following explanatory notes. The Analyze Expression and Analyze Expression Table function blocks can be used to analyze transitions and step-enabling conditions. If a transition is not triggered after a set time, the transition can be analyzed using these function blocks. The function blocks can only be used to analyze expressions or transitions that are implemented in the ST programming language. • Analyze Expression: ◦ The function block outputs the result of the analysis, i.e. the reason why no switch has occurred (that is, which partial condition(s) is/are not fulfilled), bundled in a STRING. The variables that form the partial conditions are linked to one another by operators (e.g. b Var1 AND (b Var2 OR b Var3)). ◦ The SFC flag "SFCError Analyzation" is used for the output. • Analyze Expression Table: ◦ The function block outputs all non-switching variables individually. The individual variables are recorded or output as array elements. The information listed for each array element includes the name, address, comment and current value of the variable. ◦ The SFC flag "SFCError Analyzation Table" is used for the output. Configuration requirements The following settings are required to enable Analyze Expression or Analyze Expression Table for SFC: • Include the PLC library Tc2_System. • Declare the following variable in the SFC-POU: SFCEnable Limit: BOOL := TRUE; • In the Properties window, configure a maximum active time for the step(s) of the SFC diagram whose subsequent transition/switchover condition is to be analyzed (see also SFC element properties). • Configure the SFC settings in the PLC project properties or in the POU properties (see also SFC flags and Command Properties (PLC project) > Category SFC): TE1000 Version: 1.17.0 75
## Page 76

Function blocks ◦ Flags tab: Check the Active and Declare check boxes for the following SFC flags: SFCError, SFCEnable Limit, SFCError Analyzation, SFCError Analyzation Table ◦ Build tab: Enable the option Calculate active transitions only. Sample The configurations mentioned above have been implemented in the following sample. For "Step1", the maximum active time was set to 1 s. If the associated outgoing transition "Trans_ST" has not triggered after 1 s, this transition is analyzed by the function blocks Analyze Expression and Analyze Expression Table. The variable SFCError is set to TRUE and the variable SFCError Step is given the value 'Step 1'. The analysis results "SFCError Analyzation" or "SFCError Analyzation Table" indicate which (partial) expression has not yet been triggered, so that "Step1" can be exited. The transition "Trans_ST" consists of the expression b1 AND (b2 OR b3); • Situation 1: None of the three variables b1, b2, b3 is TRUE. ◦ "SFCError Analyzation" shows the analysis result 'b1 AND (b2 OR b3)'. ◦ "SFCError Analyzation Table" lists all three variables b1, b2, b3 with detailed variable information. ◦ See also Figure 1. • Situation 2: Variable b1 is set to TRUE. The analysis results change accordingly. ◦ "SFCError Analyzation" shows the analysis result '(b2 OR b3)'. ◦ "SFCError Analyzation Table" only lists the two variables b2 and b3 with the corresponding variable information. ◦ See also Figure 2. Figure 1: 76 Version: 1.17.0 TE1000
## Page 77

Function blocks Figure 2: TE1000 Version: 1.17.0 77
## Page 78

Function blocks Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.5.2 Analyze Expression Table The function block can be used in PLC projects that use the SFC flags. No instances are generated. The corresponding PLC library must be integrated in the project. Further configuration requirements can be found in the following explanatory notes. The Analyze Expression and Analyze Expression Table function blocks can be used to analyze transitions and step-enabling conditions. If a transition is not triggered after a set time, the transition can be analyzed using these function blocks. The function blocks can only be used to analyze expressions or transitions that are implemented in the ST programming language. • Analyze Expression: ◦ The function block outputs the result of the analysis, i.e. the reason why no switch has occurred (that is, which partial condition(s) is/are not fulfilled), bundled in a STRING. The variables that form the partial conditions are linked to one another by operators (e.g. b Var1 AND (b Var2 OR b Var3)). ◦ The SFC flag "SFCError Analyzation" is used for the output. • Analyze Expression Table: ◦ The function block outputs all non-switching variables individually. The individual variables are recorded or output as array elements. The information listed for each array element includes the name, address, comment and current value of the variable. ◦ The SFC flag "SFCError Analyzation Table" is used for the output. Configuration requirements The following settings are required to enable Analyze Expression or Analyze Expression Table for SFC: • Include the PLC library Tc2_System. • Declare the following variable in the SFC-POU: SFCEnable Limit: BOOL := TRUE; • In the Properties window, configure a maximum active time for the step(s) of the SFC diagram whose subsequent transition/switchover condition is to be analyzed (see also SFC element properties). • Configure the SFC settings in the PLC project properties or in the POU properties (see also SFC flags and Command Properties (PLC project) > Category SFC): ◦ Flags tab: Check the Active and Declare check boxes for the following SFC flags: SFCError, SFCEnable Limit, SFCError Analyzation, SFCError Analyzation Table ◦ Build tab: Enable the option Calculate active transitions only. Sample The configurations mentioned above have been implemented in the following sample. For "Step1", the maximum active time was set to 1 s. If the associated outgoing transition "Trans_ST" has not triggered after 1 s, this transition is analyzed by the function blocks Analyze Expression and Analyze Expression Table. The variable SFCError is set to TRUE and the variable SFCError Step is given the value 'Step 1'. 78 Version: 1.17.0 TE1000
## Page 79

Function blocks The analysis results "SFCError Analyzation" or "SFCError Analyzation Table" indicate which (partial) expression has not yet been triggered, so that "Step1" can be exited. The transition "Trans_ST" consists of the expression b1 AND (b2 OR b3); • Situation 1: None of the three variables b1, b2, b3 is TRUE. ◦ "SFCError Analyzation" shows the analysis result 'b1 AND (b2 OR b3)'. ◦ "SFCError Analyzation Table" lists all three variables b1, b2, b3 with detailed variable information. ◦ See also Figure 1. • Situation 2: Variable b1 is set to TRUE. The analysis results change accordingly. ◦ "SFCError Analyzation" shows the analysis result '(b2 OR b3)'. ◦ "SFCError Analyzation Table" only lists the two variables b2 and b3 with the corresponding variable information. ◦ See also Figure 2. Figure 1: Figure 2: TE1000 Version: 1.17.0 79
## Page 80

Function blocks Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.5.3 Analyze Expression Combined The function block is needed in PLC projects that uses sfc flags. No instances are created. The corresponding PC library has to be included in the project. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.5.4 Append Error String 80 Version: 1.17.0 TE1000
## Page 81

Function blocks This function is required in PLC projects, which use the SFC flags. The function must not be called in the project. Only the corresponding PLC library must be included to the project. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.5.5 SFCAction Control This function is required to use IEC steps in SFC programs / projects. Only the library with the FB must be included to the project, but no instances are required. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 3.6 Watchdog function blocks 3.6.1 FB_Pc Watchdog This functionality is only available on IPCs with the following mainboards: IP-4GVI63, CB1050, CB2050, CB3050, CB1051, CB2051, CB3051. The function block FB_Pc Watchdog activates a hardware watchdog on the PC. The watchdog is activated via b Enable = TRUE and the timeout time. The timeout time can range between 1 and 255 seconds. The watchdog is activated via b Enable = TRUE and t Time Out >= 1 s. Once the watchdog has been activated, the function block must be called cyclically at shorter intervals than t Time Out, since the PC restarts automatically when t Time Out has elapsed. The watchdog can therefore be used to automatically reboot systems, which have entered an infinite loop or where the PLC has become stuck. The watchdog can be deactivated via b Enable = FALSE or t Time Out = 0. TE1000 Version: 1.17.0 81
## Page 82

Function blocks NOTICE PC reboot The watchdog must be deactivated before breakpoints are used, before a PLC reset or an overall reset, before a Twin CAT stop, before switching to Config mode or before the configuration is activated, because otherwise the PC would reboot immediately once the timeout has elapsed. Inputs VAR_INPUT t Time Out : TIME; b Enable : BOOL; END_VAR Name Type Description t Time Out TIME Watchdog time, after which a restart is performed. b Enable BOOL Enabling/disabling the watchdog. Outputs VAR_OUTPUT b Enabled : BOOL; b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR Name Type Description b Enabled BOOL TRUE = watchdog activated, FALSE = watchdog deactivated b Busy BOOL This output remains TRUE until the function block has executed a command. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Err Id. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Example of calling the function block in ST: PROGRAM MAIN VAR fb Pc Watch Dog : FB_Pc Watchdog; t WDTime : TIME := T#10s; b Enable WD : BOOL; b WDActive : BOOL; END_VAR IF b Enable WD OR b WDActive THEN fb Pc Watch Dog(t Time Out := t WDTime, b Enable := b Enable WD); b WDActive := fb Pc Watch Dog.b Enabled; END_IF Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 IPCs with the following PLC Lib Tc2_System mainboards: IP‑4GVI63, CB1050, CB2050, CB3050, CB1051, CB2051, CB3051 82 Version: 1.17.0 TE1000
## Page 83

Function blocks 3.6.2 FB_Pc Watch Dog_BAPI This functionality is only available on IPCs and Embedded PCs with a BIOS version which supports the BIOS-API. The function block FB_Pc Watchdog_BAPI activates a hardware watchdog on the PC. The watchdog is activated via b Execute = TRUE and the watchdog time. The watchdog time can range between 1 and 15300 seconds (255 minutes). The watchdog is activated via b Enable = TRUE and n Watchdog Time S >=1 s. Once the watchdog has been activated, the function block must be called cyclically at shorter intervals than n Watchdog Time S, since the PC restarts automatically when n Watchdog Time S has elapsed. The watchdog can therefore be used to automatically reboot systems, which have entered an infinite loop or where the PLC has become stuck. NOTICE PC reboot The watchdog must be deactivated before breakpoints are used, before a PLC reset or an overall reset, before a Twin CAT stop, before switching to Config mode or before the configuration is activated, because otherwise the PC would reboot immediately once n Watchdog Time S has elapsed. Inputs VAR_INPUT s Net ID : T_Ams Net ID; n Watchdog Time S : UDINT; b Execute : BOOL; t Timeout : TIME; END_VAR Name Type Description s Net ID T_Ams Net ID AMS network ID of the device (empty string or local network ID) n Watchdog Time S UDINT Watchdog time in seconds, 0 = deactivated, >0 (max. 15300) = activated. b Execute BOOL The command is executed with a rising edge. The input must be reset as soon as the function block is no longer active (b Busy=FALSE). t Timeout TIME Indicates the time until the internal ADS communication is terminated. Outputs VAR_OUTPUT b Enabled : BOOL; b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR TE1000 Version: 1.17.0 83
## Page 84

Function blocks Name Type Description b Enabled BOOL TRUE = watchdog activated, FALSE = watchdog deactivated b Busy BOOL This output remains TRUE until the function block has executed a command. b Error BOOL This output is switched to TRUE as soon as an error occurs during the execution of a command. The command- specific error code is contained in n Err Id. Is reset to FALSE by the execution of a command at the inputs. n Err Id UDINT ADS error code [} 148] or command-specific error code of the last executed command. Is reset to 0 by the execution of a command at the inputs. Sample of calling the function block in ST: PROGRAM MAIN VAR fb Watchdog : FB_Pc Watchdog_BAPI; n Watchdog Time S : UDINT := 10; (* 10s *) b Enabled : BOOL; (* TRUE: watchdog is activated *) b Error : BOOL; n Err ID : UDINT; fb Timer : TON := (IN := TRUE, PT := T#0S); END_VAR fb Timer(); (* 1st enable, then refresh watchdog every 1s *) IF fb Timer. Q THEN fb Watchdog( s Net ID := '', n Watchdog Time S := n Watchdog Time S, b Execute := TRUE, t Timeout := T#5S, ); IF NOT fb Watchdog.b Busy THEN b Enabled := fb Watchdog.b Enabled; b Error := fb Watchdog.b Error; n Err ID := fb Watchdog.n Err ID; fb Watchdog(b Execute := FALSE); (* restart timer*) fb Timer(IN := FALSE); fb Timer(IN := TRUE, PT := T#1S); (* refresh watchdog every s *) END_IF END_IF Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 IPCs and Embedded PCs with a PLC Lib Tc2_System-Version BIOS version which supports the >=3.4.14.0 BIOS-API. 3.7 Time function blocks 3.7.1 GETCPUACCOUNT This functionality is not available on PLC runtime system under Windows CE. 84 Version: 1.17.0 TE1000
## Page 85

Function blocks The PLC task cycle ticker can be read with this function block. The PLC task cycle ticker is only incremented while the task is being executed. The numerical value is a 32 bit integer, which, independently of the CPU's internal clock rate, is output in a form converted into 100 ns ticks. The number is refreshed to a precision of 100 ns every time the PLC task is called, and can be used, for instance, for timing purposes. One unit is equivalent to 100 ns. Inputs VAR_INPUT (*none*) END_VAR Outputs VAR_OUTPUT cpu Account DW : UDINT; END_VAR Name Type Description cpu Account DW UDINT Current value of the PLC task ticker Requirements Development environment Target system type PLC libraries to include Twin CAT v3.1.0 PC or CX (x86, x64) Tc2_System (System) 3.7.2 GETCPUCOUNTER The CPU cycle counter can be read with this function block. The numerical value is a relative 64 bit integer, which, independently of the CPUs internal clock rate, is output in a form converted into 100 ns ticks. The number is refreshed to a precision of 100 ns with every call by the PLC system, and can be used, for instance, for timing tasks. One unit is equivalent to 100 ns. The reason for which this service is implemented as a block and not as a function is simply in the fact that two values must be returned, which, by definition, cannot be done by a function. Inputs VAR_INPUT (*none*) END_VAR Outputs VAR_OUTPUT cpu Cnt Lo DW : UDINT; cpu Cnt Hi DW : UDINT; END_VAR Name Type Description cpu Cnt Lo DW UDINT Least significant 4 bytes of the count value cpu Cnt Hi DW UDINT Most significant 4 bytes of the count value TE1000 Version: 1.17.0 85
## Page 86

Function blocks Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 86 Version: 1.17.0 TE1000
## Page 87

Functions 4 Functions 4.1 General functions 4.1.1 F_Check Memory Area The function returns information about the memory area in which the requested variable with the specified size is located. A return value of type E_Tc Memory Area [} 125] is used for this purpose. FUNCTION F_Check Memory Area: E_Tc Memory Area Inputs VAR_INPUT p Data : PVOID; n Size : UDINT; END_VAR Name Type Description p Data PVOID Memory address of the variable n Size UDINT Size of the variable in bytes Example PROGRAM MAIN VAR n Counter : USINT; e Mem Area Static : E_Tc Memory Area; p Dynamic Variable : POINTER TO LREAL; e Mem Area Dynamic : E_Tc Memory Area; p Null : PVOID := 0; e Mem Area Unknown : E_Tc Memory Area; END_VAR ------------------------------------------------------------------- n Counter := n Counter + 1; e Mem Area Static := F_Check Memory Area( p Data:=ADR(n Counter), n Size:=SIZEOF(n Counter) ); IF n Counter = 100 THEN p Dynamic Variable := __NEW(LREAL); IF p Dynamic Variable <> 0 THEN p Dynamic Variable^ := 7 * 4.5; e Mem Area Dynamic := F_Check Memory Area( p Data:=p Dynamic Variable, n Size:=SIZEOF(LREAL) ); __DELETE(p Dynamic Variable); END_IF END_IF e Mem Area Unknown := F_Check Memory Area( p Data:=p Null, n Size:=1 ); Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.4022 PC or CX (x86, x64, Arm®) Tc2_System (system) TE1000 Version: 1.17.0 87
## Page 88

Functions 4.1.2 F_Cmp Lib Version The function F_Cmp Lib Version compares the version of the existing library with the required version. Each library has its own version information as a constant of type: ST_Lib Version. The name of the constant has the format: st Lib Version_libraryname. FUNCTION F_Cmp Lib Version: DINT Inputs VAR_INPUT st Version : ST_Lib Version; i Major : UINT; i Minor : UINT; i Build : UINT; i Revision : UINT; END_VAR Name Type Description st Version ST_Lib Version Version of the existing library (type: ST_Lib Version) i Major UINT Required major number i Minor UINT Required minor number i Build UINT Required build number i Revision UINT Required revision number Return parameter Version relationship -1 Your version is lower than the required version. 0 Your version is the required version. +1 Your version is higher than then required version. Example in ST: IF F_Cmp Lib Version( st Lib Version_Tc2_System, 3, 3, 8, 0) >= 0 THEN (* newer lib ...*) ELSE (* older lib... *) END_IF Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.3 F_Create IPv4Addr The function generates a formatted (IPv4) Internet protocol network address and returns it as a return parameter of type string (e.g. 172.16.7.199). 88 Version: 1.17.0 TE1000
## Page 89

Functions FUNCTION F_Create IPv4Addr : T_IPv4Addr Inputs VAR_INPUT n Ids : T_IPv4Addr Arr; END_VAR Name Type Description n Ids T_IPv4Addr Arr Byte array: Each byte corresponds to one address byte of the (IPv4) Internet Protocol network address. The address bytes have the network byte order (type: T_IPv4Addr Arr [} 129]). Example in structured text: PROGRAM MAIN VAR ids : T_IPv4Addr Arr := 172, 16, 7, 199; s IPv4 : T_IPv4Addr := ''; END_VAR s IPv4 := F_Create IPv4Addr( ids );(* Result: '172.16.7.199' *) Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.4 F_Scan IPv4Addr Ids The function F_Scan IPv4Addr Ids converts a string with the (IPv4) Internet Protocol network address into single address bytes. The single address bytes are converted from left to right. They are returned as an array of bytes. The address bytes are represented in network byte order. FUNCTION F_Scan IPv4Addr Ids: T_IPv4Addr Arr Inputs VAR_INPUT s IPv4 : T_IPv4Addr; END_VAR Name Type Description s IPv4 T_IPv4Addr Arr Internet Protocol network address as a string (type: T_IPv4Addr [} 128]). E.g. 172.16.7.199. Input parameters Return parameter Description s IPv4 ≠ '' (empty string) All bytes are null Error during the conversion, check and s IPv4 ≠ '0.0.0.0' the formatting of the s IPv4 string. Example in structured text: Internet Protocol (IPv4) network address string: '172.16.7.199' is converted to an array of address bytes. PROGRAM MAIN VAR ids : T_IPv4Addr Arr; s IPv4 : T_IPv4Addr := '172.16.7.199'; TE1000 Version: 1.17.0 89
## Page 90

Functions END_VAR ids := F_Scan IPv4Addr Ids( s IPv4 ); (* Result: ids[0]:=172, ids[1]:=16, ids[2]:=7, ids[3]:=199 *) Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.5 F_Get Cpu Core Index For a task index the function F_Get Cpu Core Index returns the index of the CPU core on which the task runs. If 0 is passed as task index, the CPU core index of the task in which the function is called is determined. If an invalid task index is passed, the function returns the CPU core index -1. The function returns the determined CPU core index as a return parameter. It corresponds to the value of the Core column that is displayed in the Real-time sub-node below the SYSTEM node. FUNCTION F_Get Cpu Core Index: DINT Inputs VAR_INPUT n Task Index : DINT; END_VAR Name Type Description n Task Index DINT Index of the task whose associated CPU index is to be determined. If 0 is passed as task index, the CPU core index of the task in which the function is called is determined. See also: • GETCURTASKINDEX [} 20] Development Environment Target platform PLC libraries to include Twin CAT v3.1.4024.11 PC or CX (x86, x64, Arm®) Tc2_System (system) >= 3.4.24.0 4.1.6 F_Get Cpu Core Info The function F_Get Cpu Core Info returns information about the CPU core whose index is passed to the function. The information that is read out includes the base time and the core limit for the specified CPU core. The CPU core index to be passed can be determined with the function F_Get Cpu Core Index [} 90]. The CPU core index corresponds to the value of the Core column that is displayed in the Real-time sub- node below the SYSTEM node. The information that can be read via the CPU core via the function F_Get Cpu Core Info is also displayed in this view. 90 Version: 1.17.0 TE1000
## Page 91

Functions The function returns an error code as HRESULT (see also ADS Return Codes [} 148]). It indicates whether the function call was successful. If an invalid CPU core index is passed, the function returns an error (0x9811070B = invalid parameter values). FUNCTION F_Get Cpu Core Info: HRESULT Inputs VAR_INPUT n Cpu Core Index : DINT; p Info : POINTER TO ST_Cpu Core Info; END_VAR Name Type Description n Cpu Core Index DINT Index of the CPU core whose information is to be read. p Info POINTER TO ST_Cpu Core Inf Address of the variable that is to receive the read data. o The address must point to an instance of type ST_Cpu Core Info [} 126]. Development Environment Target platform PLC libraries to include Twin CAT v3.1.4024.11 PC or CX (x86, x64, Arm®) Tc2_System (system) >= 3.4.24.0 4.1.7 F_Get Mapping Partner The function F_Get Mapping Partner returns the object ID (data type: OTCID) of the partner side of the mapping. FUNCTION F_Get Mapping Partner: OTCID Inputs VAR_INPUT p : PVOID; n : UDINT; END_VAR Name Type Description P PVOID Memory address of the variable n UDINT Size of the variable in bytes Development Environment Target platform PLC libraries to include Twin CAT v3.1.4020 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.8 F_Get Mapping Status The function F_Get Mapping Status returns the current mapping status of a PLC variable. The function returns an ENUM value (data type: EPlc Mapping Status [} 125]) with the values MS_Unmapped, MS_Mapped or MS_Partial. TE1000 Version: 1.17.0 91
## Page 92

Functions FUNCTION F_Get Mapping Status: EPlc Mapping Status Inputs VAR_INPUT p : PVOID; n : UDINT; END_VAR Name Type Description P PVOID Memory address of the variable n UDINT Size of the variable in bytes Development Environment Target platform PLC libraries to include Twin CAT v3.1.4020 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.9 F_Get Struct Member Alignment The function returns information about used data struct member alignment setting. The alignment is affecting the way data structure elements are arranged in computer memory. FUNCTION F_Get Struct Member Alignment : BYTE Inputs VAR_INPUT (* keine Eingangsparameter *) END_VAR Return parameter Description 1 1 byte alignment (e.g. Twin CAT v2.11, x86 target platform) 2 2 byte alignment 4 4 byte alignment (e.g. Twin CAT v2.11, Arm® target platform) 8 8 byte alignment The following samples show the arrangement of the data structure elements in the memory, depending on the memory alignment employed. ?? := padding byte Example 1 TYPE ST_TEST1 STRUCT ui8 : BYTE := 16#FF;(* FF *) f64 : LREAL := 1234.5678;(* AD FA 5C 6D 45 4A 93 40 *) END_STRUCT END_TYPE test1 : ST_TEST1; 92 Version: 1.17.0 TE1000
## Page 93

Functions Alignment SIZEOF(test1) Memory contents 1 byte 9 FF AD FA 5C 6D 45 4A 93 40 2 byte 10 FF ?? AD FA 5C 6D 45 4A 93 40 4 byte 12 FF ?? ?? ?? AD FA 5C 6D 45 4A 93 40 8 byte 16 FF ?? ?? ?? ?? ?? ?? ?? AD FA 5C 6D 45 4A 93 40 Example 2 Converting the order of the structure elements changes the arrangement of the padding bytes. These are now added at the end. TYPE ST_TEST2 STRUCT f64 : LREAL := 1234.5678;(* AD FA 5C 6D 45 4A 93 40 *) ui8 : BYTE := 16#FF;(* FF *) END_STRUCT END_TYPE test2 : ST_TEST2; Alignment SIZEOF(test2) Memory contents 1 byte 9 AD FA 5C 6D 45 4A 93 40 FF 2 byte 10 AD FA 5C 6D 45 4A 93 40 FF ?? 4 byte 12 AD FA 5C 6D 45 4A 93 40 FF ?? ?? ?? 8 byte 16 AD FA 5C 6D 45 4A 93 40 FF ?? ?? ?? ?? ?? ?? ?? ?? Example 3 In the case of 2, 4 and 8 byte alignment, the elements ui32 and f64 are already suitably aligned, so that no padding bytes need to be added. TYPE ST_TEST3 STRUCT ui8 : BYTE := 16#FF;(* FF *) ui16 : WORD := 16#1234;(* 34 12 *) ui32 : DWORD := 16#AABBCCDD;(* DD CC BB AA *) f64 : LREAL := 1234.5678;(* AD FA 5C 6D 45 4A 93 40 *) END_STRUCT END_TYPE test3 : ST_TEST3; Alignment SIZEOF(test3) Memory contents 1 byte 15 FF 34 12 DD CC BB AA AD FA 5C 6D 45 4A 93 40 2 byte 16 FF ?? 34 12 DD CC BB AA AD FA 5C 6D 45 4A 93 40 4 byte 16 FF ?? 34 12 DD CC BB AA AD FA 5C 6D 45 4A 93 40 8 byte 16 FF ?? 34 12 DD CC BB AA AD FA 5C 6D 45 4A 93 40 Example 4 TYPE ST_A1 STRUCT ui8 : BYTE := 16#FF;(* FF *) ui32 : DWORD := 16#AABBCCDD;(* DD CC BB AA *) rsv : BYTE := 16#EE;(* EE *) END_STRUCT END_TYPE TYPE ST_A2 STRUCT TE1000 Version: 1.17.0 93
## Page 94

Functions ui16 : WORD := 16#1234;(* 34 12 *) ui8 : BYTE := 16#55;(* 55 *) END_STRUCT END_TYPE TYPE ST_TEST4 STRUCT a1 : ST_A1; a2 : ST_A2; END_STRUCT END_TYPE test4 : ST_TEST4; Alignment SIZEOF(test4) SIZEOF(test4.a1 a1/a2 padding SIZEOF(test4.a2 Memory con- ) bytes ) tents 1 byte 9 6 - 3 FF DD CC BB AA EE 34 12 55 2 byte 12 8 - 4 FF ?? DD CC BB AA EE ?? 34 12 55 ?? 4 byte 16 12 - 4 FF ?? ?? ?? DD CC BB AA EE ?? ?? ?? 34 12 55 ?? 8 byte 16 12 - 4 FF ?? ?? ?? DD CC BB AA EE ?? ?? ?? 34 12 55 ?? Example 5 TYPE ST_D1 STRUCT ui16 : WORD := 16#1234;(* 34 12 *) ui8 : BYTE := 16#55;(* 55 *) END_STRUCT END_TYPE TYPE ST_D2 STRUCT ui8 : BYTE := 16#FF;(* FF *) f64 : LREAL := 1234.5678;(* AD FA 5C 6D 45 4A 93 40 *) rsv : BYTE := 16#EE;(* EE *) END_STRUCT END_TYPE TYPE ST_TEST5 STRUCT d1 : ST_D1; d2 : ST_D2; END_STRUCT END_TYPE test5 : ST_TEST5; 94 Version: 1.17.0 TE1000
## Page 95

Functions Alignment SIZEOF(test5) SIZEOF(test5.d1) d1/d2 padding SIZEOF(test5.d Memory con- bytes 2) tents 1 byte 13 3 - 10 34 12 55 FF AD FA 5C 6D 45 4A 93 40 EE 2 byte 16 4 - 12 34 12 55 ?? FF ?? AD FA 5C 6D 45 4A 93 40 EE ?? 4 byte 20 4 - 16 34 12 55 ?? FF ?? ?? ?? AD FA 5C 6D 45 4A 93 40 EE ?? ?? ?? 8 byte 32 4 4 24 34 12 55 ?? ?? ?? ?? ? ? FF ?? ?? ?? ?? ? ? ?? ?? AD FA 5C 6D 45 4A 93 40 EE ?? ?? ?? ?? ?? ?? ?? Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.10 F_Get Task Info The function determines the Task System Info of the task in which it is called. FUNCTION F_Get Task Info : Plc Task System Info Inputs VAR_INPUT (*keine*) END_VAR Return parameter Description Plc Task System Info Task System Info of the task in which the function is called. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.4026 PC or CX (x86, x64, Arm®) Tc2_System (system) >= 3.9.1.0 Also see about this 2 GETCURTASKINDEX [} 20] TE1000 Version: 1.17.0 95
## Page 96

Functions 4.1.11 F_Raise Exception Calling the function makes it possible to throw a runtime exception with a specific exception code. If you use the F_Raise Exception() function outside a __TRY block, the exception is caught by Twin CAT Exception Handling and the execution of the control is stopped. Basic information on __TRY, __CATCH, __FINALLY, __ENDTRY See the documentation on __TRY, __CATCH, __FINALLY, __ENDTRY to gain a basic understanding of exception handling. FUNCTION F_Raise Exception Inputs VAR_INPUT Exception Code : UDINT; END_VAR Name Type Description Exception Code UDINT Specification of the Exception Code. See __SYSTEM. Exception Code Example PROGRAM MAIN VAR n Counter1 : INT; n Counter2 : INT; n Counter_TRY1 : INT; n Counter_TRY2 : INT; n Counter_CATCH : INT; a Data : ARRAY[1..c Max] OF INT; n Index : UINT; exc : __SYSTEM. Exception Code; last Exc : __SYSTEM. Exception Code; END_VAR VAR CONSTANT c Max : UINT := 10; END_VAR // Counter 1 n Counter1 := n Counter1 + 1; n Index := n Index + 1; // TRY-CATCH block __TRY n Counter_TRY1 := n Counter_TRY1 + 1; IF n Index > c Max THEN F_Raise Exception(__SYSTEM. Exception Code. RTSEXCPT_ARRAYBOUNDS); END_IF n Counter_TRY2 := n Counter_TRY2 + 1; __CATCH(exc) n Counter_CATCH := n Counter_CATCH + 1; // Exception logging last Exc := exc; // Correct the faulty variable values IF (exc = __SYSTEM. Exception Code. RTSEXCPT_ARRAYBOUNDS) AND (n Index > c Max) THEN n Index := c Max; END_IF __ENDTRY a Data[n Index] := 123; 96 Version: 1.17.0 TE1000
## Page 97

Functions // Counter 2 n Counter2 := n Counter2 + 1; Example with user-specific Exception Code User-specific Exception Codes should be OR-ed with RTSEXCPT_VENDOR_EXCEPTION_BASE before use. PROGRAM MAIN VAR n Counter1 : INT; n Counter2 : INT; n Counter_TRY1 : INT; n Counter_TRY2 : INT; n Counter_CATCH : INT; a Data : ARRAY[1..c Max] OF INT; n Index : UINT; exc : __SYSTEM. Exception Code; last Exc : __SYSTEM. Exception Code; END_VAR VAR CONSTANT c My Own Exception Code : UDINT := 123; c Max : UINT := 10; END_VAR // Counter 1 n Counter1 := n Counter1 + 1; n Index := n Index + 1; // TRY-CATCH block __TRY n Counter_TRY1 := n Counter_TRY1 + 1; IF n Index > c Max THEN F_Raise Exception(__SYSTEM. Exception Code. RTSEXCPT_VENDOR_EXCEPTION_BASE OR c My Own Exception Code); END_IF n Counter_TRY2 := n Counter_TRY2 + 1; __CATCH(exc) n Counter_CATCH := n Counter_CATCH + 1; // Exception logging last Exc := exc; // Correct the faulty variable values IF (exc = __SYSTEM. Exception Code. RTSEXCPT_VENDOR_EXCEPTION_BASE OR c My Own Exception Code) AND (n Index > c Max) THEN n Index := c Max; END_IF __ENDTRY a Data[n Index] := 123; // Counter 2 n Counter2 := n Counter2 + 1; Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.4026.15 PC or CX (x86, x64, Arm®) Tc2_System (system) >= 3.8.1.0 4.1.12 F_Split Path Name TE1000 Version: 1.17.0 97
## Page 98

Functions This function splits a complete path name into its four components. These are stored in the strings named s Drive, s Dir, s File Name and s Ext. FUNCTION F_Split Path Name : BOOL Inputs VAR_INPUT s Path Name : T_Max String; END_VAR Name Type Description s Path Name T_Max String Complete file name as string (type: T_Max String [} 129]) in the form: 'X:\DIR\SUBDIR\FILENAME. EXT'. Inputs/outputs VAR_IN_OUT s Drive : STRING(3); s Dir : T_Max String; s File Name : T_Max String; s Ext : T_Max String; END_VAR Name Type Description s Drive STRING Drive ID (type: T_Max String [} 129]) with a colon ('C:', 'A:' etc.) s Dir T_Max String Directory name (type: T_Max String [} 129]) including the leading and trailing backslash ('\BC \INCLUDE\', '\SOURCE\' etc.) s File Name T_Max String File name (type: T_Max String [} 129]) s Ext T_Max String Contains the dot and the file extension (type: T_Max String [} 129]) (example: '. C', '. EXE' etc.). Return parameter Description TRUE No error FALSE Error. Check the function parameters. Sample of a call in ST: The pathname: C:\Twin CAT\Plc\Project01\Data.txt is split into the following individual components: s Drive: = 'C:' s Dir: '\Twin CAT\Plc\Project01\' s File Name: 'Data' s Ext: '.txt' PROGRAM MAIN VAR b Split : BOOL; s Path Name : T_Max String := 'C:\Twin CAT\Plc\Project01\Data.txt'; s Drive : STRING(3); s Dir : T_Max String; s File Name : T_Max String; s Ext : T_Max String; b Success : BOOL; END_VAR IF b Split THEN b Split := FALSE; b Success := F_Split Path Name( s Path Name := s Path Name, s Drive := s Drive, s Dir := s Dir, s File Name := s File Name, s Ext := s Ext ); END_IF 98 Version: 1.17.0 TE1000
## Page 99

Functions Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.13 SETBIT32 The function sets the bit specified by a bit number in the 32 bit value that is passed to it and returns the resulting value. FUNCTION SETBIT32 : DWORD Inputs VAR_INPUT in Val32 : DWORD; bit No : SINT; END_VAR Name Type Description in Val32 DWORD 32-bit value to be changed. bit No SINT Number of the bit that is to be set (0-31). This number is internally converted to a modulo 32 value prior to execution. Sample of calling the function in FBD: Here bit 31 is set in the input value 0. The result is the (hex) value "80000000". Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.14 CSETBIT32 The function sets/resets the bit specified by a bit number in the 32 bit value that is passed to it and returns the resulting value. TE1000 Version: 1.17.0 99
## Page 100

Functions FUNCTION CSETBIT32 : DWORD Inputs VAR_INPUT in Val32 : DWORD; bit No : SINT; bit Val : BOOL; END_VAR Name Type Description in Val32 DWORD 32-bit value bit No SINT Number of the bit to be set or reset (0-31). This number is internally converted to a modulo 32 value prior to execution. bit Val BOOL Value to which the bit is to be set or reset (TRUE = 1, FALSE = 0). Sample of calling the function in FBD: Here bit 15 in the input value "16#80000000" is set to 1. The result (16#80008000) is assigned to the variable CSet Bit Result Val. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.15 GETBIT32 The function returns the status of the bit specified by a bit number in the 32 bit value that is passed to it as a boolean resulting value. The input value is not altered. FUNCTION GETBIT32 : BOOL Inputs VAR_INPUT in Val32 : DWORD; bit No : SINT; END_VAR Name Type Description in Val32 DWORD 32-bit value bit No SINT Number of the bit to be read (0-31). This number is internally converted to a modulo 32 value prior to execution. Sample of calling the function in FBD: 100 Version: 1.17.0 TE1000
## Page 101

Functions Here bit 2 in the input value "16#04" is queried and assigned to the boolean variable a Get Bit Result Var. The query returns TRUE in this example. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.16 CLEARBIT32 The function resets the bit specified by a bit number in the 32 bit value that is passed to it to zero and returns the resulting value. FUNCTION CLEARBIT32 : DWORD Inputs VAR_INPUT in Val32 : DWORD; bit No : SINT; END_VAR Name Type Description in Val32 DWORD 32-bit value to be changed. bit No SINT Number of the bit that is to be set (0-31). This number is internally converted to a modulo 32 value prior to execution. Sample of calling the function in FBD: Here bit 31 in the input value "C0000000" is reset. The result is the (hex) value "40000000". Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.17 GETCURTASKINDEXEX The function determines the task index of the task in which it is called. In contrast to the function block GETCURTASKINDEX [} 20], a distinction can be made as to whether the function is called in a cyclic real-time context or not. TE1000 Version: 1.17.0 101
## Page 102

Functions FUNCTION GETCURTASKINDEXEX : DINT Inputs VAR_INPUT (*keine*) END_VAR Return parameter Description -1 The function is called from the Windows context. 0 The function is called from the real-time context, but not from a cyclic PLC task. This is the case, for example, with the automatic call of FB_init methods during initialization. 1 to n The function is called from a cyclic PLC task. The return value is the task index. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.18 LPTSIGNAL This function sets a defined output bit in a Centronics interface to a logical high or low level, and can, for example, be used for run-time measurements with an oscilloscope. FUNCTION LPTSIGNAL: BOOL Inputs VAR_INPUT Port Addr : UINT; Pin No : INT; On Off : BOOL; END_VAR Name Type Description Port Addr UINT Address of the port which is available for the desired LPT interface. Pin No INT Number of the pin (pin 0 .. 7 ) to be written by the PLC. On Off BOOL State to be written to the pin. Sample of calling the function in FBD: In the example, bit 7 of port 378 (hex) is set to 1. 102 Version: 1.17.0 TE1000
## Page 103

Functions Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.1.19 Test And Set You can use this function to check and set a flag. There is no option to interrupt the process. This allows data accesses to be synchronized. The mode of operation of a semaphore can be achieved with Test And Set. If the function call is successful, the function returns TRUE and the desired data can be accessed. If the function call is unsuccessful, the function returns FALSE and the desired data cannot be accessed. In this case, an alternative treatment must be provided for. Inputs/outputs VAR_IN_OUT Flag : BOOL; (* Flag to check if TRUE or FALSE *) END_VAR Name Type Description Flag BOOL Boolean flag to be checked • if it was FALSE, the flag was free and is set (and therefore blocked from now on), and the function returns TRUE • if it was TRUE, the flag was already assigned (and therefore blocked), and the function returns FALSE Sample VAR_GLOBAL b Global Test Flag : BOOL; END_VAR VAR n Local Blocked Counter : DINT; END_VAR IF Test And Set(GVL.b Global Test Flag) THEN (* b Global Test Flag was FALSE, nobody was blocking, NOW b Global Test Flag is set to TRUE and blocking others *) (* ... *) (* remove blocking by resetting the flag *) GVL.b Global Test Flag := FALSE; ELSE (* b Global Test Flag was TRUE, somebody is blocking *) n Local Blocked Counter := n Local Blocked Counter + 1; (* ... *) END_IF NEGATIVE sample Caution is advised with a further encapsulation, e.g. in a function block, as this can destroy the desired atomic operation. Secure synchronization of data accesses can then no longer take place. In the following, a NEGATIVE sample is included that shows how the function may NOT be used. If two contexts were to request access at the same time in this implementation, both might assume that the access is allowed and simultaneous, unsecured accessing of the data would take place. TE1000 Version: 1.17.0 103
## Page 104

Functions FUNCTION_BLOCK FB_My Global Lock VAR_INPUT b Lock : BOOL; // set TRUE to lock & set FALSE to unlock END_VAR VAR_OUTPUT b Locked : BOOL; END_VAR IF b Lock THEN Test And Set(b Locked); ELSE // unlock b Locked := FALSE; END_IF IF NOT GVL.fb Global Lock.b Locked THEN GVL.fb Global Lock(b Lock := TRUE); (* ... *) GVL.fb Global Lock(b Lock := FALSE); END_IF The function block FB_Iec Critical Section [} 14] offers the application of critical sections as an alternative Mutex method. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.2 ADS functions 4.2.1 ADSLOGDINT When called, the function outputs a message box with a predefinable text to the screen and writes an entry to the system's event log. As PLC programs are processed cyclically, it is necessary for items such as message boxes to be output edge-triggered. This is most easily achieved with an R_TRIG or F_TRIG function block placed in series (see also samples below). Using the ADSLOGDINT function, a DINT value (4-byte signed integer) can be inserted in the text to be output at a point specified by the user. For this purpose, the created format string must contain the string %d at the desired position. The return parameter contains the function error code, or 0 if successful. FUNCTION ADSLOGDINT : DINT Inputs VAR_INPUT msg Ctrl Mask : DWORD; msg Fmt Str : T_Max String; dint Arg : DINT; END_VAR 104 Version: 1.17.0 TE1000
## Page 105

Functions Name Type Description msg Ctrl Mask DWORD Control mask which determines the type and effect of the message output (see separate table). msg Fmt Str T_Max String Contains the message to be output. It can contain the formatting character %d for the output of a DINT value at any position. [} 129] Information: The length of the message is limited to 253 bytes (corresponds to 253 characters for strings in standard format). dint Arg DINT Contains the numerical value to be inserted into the message. Constant Description ADSLOG_MSGTYPE_HINT Message type is hint. ADSLOG_MSGTYPE_WARN Message type is warning. ADSLOG_MSGTYPE_ERROR Message type is error. ADSLOG_MSGTYPE_LOG Message is written into the log. ADSLOG_MSGTYPE_MSGBOX Message is output in a message box. Information: This functionality is not available for Windows CE. ADSLOG_MSGTYPE_STRING Message is a directly given string (default). The control masks can be ORed in the desired combination. Example of calling the function in FBD: The resulting message box: The DINT value 4711 is inserted here into a message. The insertion point is marked by the %d characters in the format string. Example of calling the function in ST: PROGRAM MAIN VAR rt Message Output: R_TRIG; (* Declaration *) b Feed Too High: BOOL; udi Ads Log Res: UDINT; END_VAR rt Message Output(CLK := b Feed Too High); IF rt Message Output. Q THEN Udi Ads Log Res := ADSLOGDINT( msg Ctrl Mask := ADSLOG_MSGTYPE_HINT OR ADSLOG_MSGTYPE_MSGBOX, msg Fmt Str := 'PLC Msg: Feed too high! Current feed: %d', dint Arg:= 4711); END_IF TE1000 Version: 1.17.0 105
## Page 106

Functions Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.2.2 ADSLOGLREAL When called, the function outputs a message box with a predefinable text to the screen and writes an entry to the system's event log. An LREAL value (floating-point number) can be incorporated into the text to be output at a position specified by the user. For this purpose, the created format string must contain the string '%f' at the desired position. Please keep in mind that the function must be called edge-triggered (see also note in description ADSLOGDINT [} 104]). The return parameter contains the function error code, or 0 if successful. FUNCTION ADSLOGLREAL : DINT Inputs VAR_INPUT msg Ctrl Mask : DWORD; msg Fmt Str : T_Max String; lreal Arg : LREAL; END_VAR Name Type Description msg Ctrl Mask DWORD Control mask which determines the type and effect of the message output (see separate table). msg Fmt Str T_Max String [} 129] Contains the message to be output. It can contain the formatting code %f for the output of a LREAL value at any position. Information: The length of the message is limited to 253 bytes (corresponds to 253 characters for strings in standard format). lreal Arg LREAL Contains the numerical value to be inserted into the message. Constant Description ADSLOG_MSGTYPE_HINT Message type is hint. ADSLOG_MSGTYPE_WARN Message type is warning. ADSLOG_MSGTYPE_ERROR Message type is error. ADSLOG_MSGTYPE_LOG Message is written into the log. ADSLOG_MSGTYPE_MSGBOX Message is output in a message box. Information: This functionality is not available for Windows CE. ADSLOG_MSGTYPE_STRING Message is a directly given string (default). The control masks can be ORed in the desired combination. Example of calling the function in FBD: The resulting message box: 106 Version: 1.17.0 TE1000
## Page 107

Functions Here the LREAL value 187.203045 is inserted into a message. The insertion point is marked by the %f characters in the format string. The number is truncated after the sixth decimal point during output. Example of calling the function in ST: PROGRAM MAIN VAR rt Message Output: R_TRIG; (* Declaration *) b Temperature Too High: BOOL; udi Ads Log Res: UDINT; END_VAR rt Message Output(CLK := b Temperature Too High); IF rt Message Output. Q THEN udi Ads Log Res := ADSLOGLREAL( msg Ctrl Mask := ADSLOG_MSGTYPE_HINT OR ADSLOG_MSGTYPE_MSGBOX, msg Fmt Str := 'PLC Msg.: Max Temp. reached ! Temperature: %f', lreal Arg := 187.203045); END_IF; Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) Also see about this 2 ADSLOGDINT [} 104] 4.2.3 ADSLOGSTR When called, the function outputs a message box with a predefinable text to the screen and writes an entry to the system's event log. A STRING can be inserted into the text to be output at a position specified by the user. For this purpose, the created format string must contain the string %s at the desired position. Please keep in mind that the function must be called edge-triggered (see also note in description ADSLOGDINT [} 104]). The return parameter contains the function error code, or 0 if successful. FUNCTION ADSLOGSTR : DINT Inputs VAR_INPUT msg Ctrl Mask : DWORD; msg Fmt Str : T_Max String; str Arg : T_Max String; END_VAR TE1000 Version: 1.17.0 107
## Page 108

Functions Name Type Description msg Ctrl Mask DWORD Control mask which determines the type and effect of the message output (see separate table). msg Fmt Str T_Max String [} 129] Contains the message to be output. It can contain the formatting character %s for the output of a text argument at any position. Information: The length of the message is limited to 253 bytes (corresponds to 253 characters for strings in standard format). str Arg T_Max String [} 129] Contains the string which is to be inserted into the message. Constant Description ADSLOG_MSGTYPE_HINT Message type is hint. ADSLOG_MSGTYPE_WARN Message type is warning. ADSLOG_MSGTYPE_ERROR Message type is error. ADSLOG_MSGTYPE_LOG Message is written into the log. ADSLOG_MSGTYPE_MSGBOX Message is output in a message box. Information: This functionality is not available for Windows CE. ADSLOG_MSGTYPE_STRING Message is a directly given string (default). The control masks can be ORed in the desired combination. Example of calling the function in FBD: The resulting message box: With this, the PLC programmer inserts the string stored in the variable str SFCError Step into the message. The insertion point is marked by the %s characters in the format string. Example of calling the function in ST: PROGRAM MAIN VAR str SFCError Step : STRING; (* Declaration*) rt Message Output: R_TRIG; b SFCError: BOOL; END_VAR rt Message Output(CLK := b SFCError); IF rt Message Output. Q THEN 108 Version: 1.17.0 TE1000
## Page 109

Functions udi Ads Log Res := ADSLOGSTR( msg Ctrl Mask := ADSLOG_MSGTYPE_ERROR OR ADSLOG_MSGTYPE_MSGBOX, msg Fmt S tr := 'PLC Msg.: Guarding time executed in SFC step: %s', str Arg := str SFCError Step); END_IF; Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) Also see about this 2 ADSLOGDINT [} 104] 4.2.4 F_Create Ams Net Id The function generates a formatted Net ID string (type: T_Ams Net ID [} 127]) and returns it as return parameter (e.g. '127.16.17.3.1.1'). FUNCTION F_Create Ams Net Id : T_Ams Net Id Inputs VAR_INPUT n Ids : T_Ams Net Id Arr; END_VAR Name Type Description n Ids T_Ams Net Id Arr Byte array (type: T_Ams Net Id Arr [} 127]). Each byte corresponds to a number of the network address. The address bytes have a network byte order. Example of a call in ST: PROGRAM MAIN VAR ids : T_Ams Net Id Arr := 127, 16, 17, 3, 1, 1; s Net ID : T_Ams Net ID := ''; END_VAR s Net ID := F_Create Ams Net Id( ids );(* Result: '127.16.17.3.1.1' *) Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.2.5 F_Scan Ams Net Ids The function F_Scan Ams Net Ids can be used to convert a string containing the Twin CAT network address to individual address bytes. The individual address bytes are converted from left to right and returned as an array of bytes (type: T_Ams Net Id Arr [} 127]). The address bytes have a network byte order. TE1000 Version: 1.17.0 109
## Page 110

Functions FUNCTION F_Scan Ams Net Ids : T_Ams Net Id Arr Inputs VAR_INPUT s Net ID : T_Ams Net ID; END_VAR Name Type Description s Net ID T_Ams Net ID Twin CAT network address as string (type: T_Ams Net Id [} 127]). E.g. '127.16.17.3.1.1' Input parameters Return parameter Description s Net ID ≠ '' (empty string) All bytes are null Error during the conversion, check and s Net ID ≠ '0.0.0.0.0.0' the formatting of the s Net ID string. Example of a call in ST: In the following example, a string with the network address '127.16.17.3.1.1' is converted to an array of address bytes. PROGRAM MAIN VAR ids : T_Ams Net IDArr; s Net ID : T_Ams Net ID := '127.16.17.3.1.1'; END_VAR ids := F_Scan Ams Net Ids( s Net ID ); (* Result: ids[0]:=127, ids[1]:=16, ids[2]:=17, ids[3]:=3, ids[4]:=1, ids[5]:=1 *) Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.3 Character functions 4.3.1 F_To CHR The function converts ASCII Code to STRING. FUNCTION F_To CHR: STRING Inputs VAR_INPUT c : BYTE; END_VAR Name Type Description c BYTE ASCII code to be converted Sample of calling the function in FBD: 110 Version: 1.17.0 TE1000
## Page 111

Functions PROGRAM P_TEST VAR s Character : STRING(1) := ''; c Ascii Code : BYTE := 16#31; END_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.3.2 F_To ASC This function converts STRING to ASCII Code. Only the first sign of the STRING will be converted. An empty STRING delivers a zero. FUNCTION F_To ASC : BYTE Inputs VAR_INPUT str : STRING; END_VAR Name Type Description str STRING String to convert Sample of calling the function in FBD: PROGRAM P_TEST VAR s Character : STRING(1) := '1'; c Ascii Code : BYTE := 0; END_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.4 I/O port access 4.4.1 F_IOPort Read TE1000 Version: 1.17.0 111
## Page 112

Functions A digital I/O port is usually an I/O position with a width of 1 byte, which is mapped either in the memory or as a port. If a value is written at this point, the electrical signal at the output pins is modified according to the written bits. If a value is read from the input position, the current logical level at the input pins is returned as an individual bit value. The function F_IOPort Read can be used to read an I/O position with a width of e Size. The function returns the read value as return parameter. See also description of the F_IOPort Write [} 112] function. FUNCTION F_IOPort Read : DWORD Inputs VAR_INPUT n Addr : UDINT; e Size : E_IOAccess Size; END_VAR Name Type Description n Addr UDINT I/O port address e Size E_IOAccess Size Number of data bytes to be read (type: E_IOAccess Size [} 123]) Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.4.2 F_IOPort Write The function F_IOPort Write can be used to write to an I/O position with a width of e Size. See also description of the F_IOPort Read [} 111] function. NOTICE Hardware damage A direct hardware access is not a problem, as long as data is only read. Write access can result in crashes and/or destroy the hardware or the data on the storage media. This function can damage the hardware to such an extent that it is no longer bootable. FUNCTION F_IOPort Write : BOOL Inputs VAR_INPUT n Addr : UDINT; e Size : E_IOAccess Size; n Value : DWORD; END_VAR Name Type Description n Addr UDINT I/O port address e Size E_IOAccess Size Number of data bytes to be written (type: E_IOAccess Size [} 123]). n Value DWORD Value to be written. 112 Version: 1.17.0 TE1000
## Page 113

Functions Return parameter Description TRUE No error FALSE Error Sample code in ST: In the following example a PLC Function block for direct control of a PC speaker is implemented with the aid of the I/O -Port functions. Interface: FUNCTION_BLOCK FB_Speaker (* Sample code from: "PC INTERN 2.0", ISBN 3-89011-331-1, Data Becker *) VAR_INPUT freq : DWORD := 10000; (* Frequency [Hz] *) t Duration : TIME := T#1s; (* Tone duration *) b Execute : BOOL; (* Rising edge starts function block execution *) END_VAR VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; END_VAR VAR fb Trig : R_TRIG; n State : BYTE; sts61H : DWORD; cnt42H : DWORD; cnt Lo : DWORD; cnt Hi : DWORD; timer : TON; END_VAR Implementation: fb Trig( CLK := b Execute ); CASE n State OF 0: IF fb Trig. Q THEN b Busy := TRUE; b Error := FALSE; n Err ID := 0; timer( IN := FALSE ); IF F_IOPort Write( 16#43, No Of Byte_Byte, 182 ) THEN cnt42H := 1193180 / freq; cnt Lo := cnt42H AND 16#FF; cnt Hi := SHR( cnt42H, 8 ) AND 16#FF; F_IOPort Write( 16#42, No Of Byte_Byte, cnt Lo ); (* Lo Byte *) F_IOPort Write( 16#42, No Of Byte_Byte, cnt Hi ); (* Hi Byte *) timer( IN := TRUE, PT := t Duration ); sts61H := F_IOPort Read( 16#61, No Of Byte_Byte ); sts61H := sts61H OR 2#11; F_IOPort Write( 16#61, No Of Byte_Byte, sts61H ); (* speaker ON *) n State := 1; ELSE n State := 100; END_IF END_IF 1: timer( ); IF timer. Q THEN sts61H := F_IOPort Read( 16#61, No Of Byte_Byte ); sts61H := sts61H AND 2#11111100; F_IOPort Write( 16#61, No Of Byte_Byte, sts61H ); (* speaker off *) b Busy := FALSE; n State := 0; END_IF 100: b Busy := FALSE; TE1000 Version: 1.17.0 113
## Page 114

Functions b Error := TRUE; n Err ID := 16#8000; n State := 0; END_CASE Test application: PROGRAM MAIN VAR fb Speaker : FB_Speaker; b Start : BOOL; END_VAR fb Speaker( freq:= 5000, t Duration:= t#1s, b Execute:= b Start ); Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.5 Memory functions 4.5.1 MEMCMP The function MEMCMP allows the values of PLC variables in two different memory areas to be compared. MEMCMP FUNCTION: DINT Inputs VAR_INPUT p Buf1 : PVOID; p Buf2 : PVOID; n : UDINT; END_VAR Name Type Description p Buf1 PVOID Start address of the first memory area (the first data buffer). p Buf2 PVOID Start address of the second memory area (the second data buffer). n UDINT Number of bytes to be compared. The function compares the first n bytes in the two data buffers and returns a value that corresponds to their ratio. 114 Version: 1.17.0 TE1000
## Page 115

Functions Return parameter Ratio of the first byte that is different in the first and second data buffers -1 p Buf1 lower than p Buf2 0 p Buf1 identical to p Buf2 1 p Buf1 greater than p Buf2 0x FF Incorrect parameter values. p Buff1 = 0 or p Buff2 = 0 or n = 0 Example of a call in FBD: PROGRAM MAIN VAR Buffer1 : ARRAY[0..3] OF BYTE; Buffer2 : ARRAY[0..3] OF BYTE; Cmp Result : DINT; END_VAR In this example, 4 bytes of data in Buffer2 are compared with those in Buffer1. The first differing byte is larger in Buffer1 than it is in Buffer2. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.5.2 MEMCPY The function MEMCPY can be used to copy the values of PLC variables from one memory area to another. NOTICE System crash or access to unauthorized memory areas Since the function directly accesses the physical memory, special care must be taken when using it. Incorrect parameter values can result in a system crash, or in access to forbidden memory areas. The behavior of MEMCPY is undefined if the destination and source memory areas overlap. This is the case, for example, when several values stored in an array are to be moved one position forward or backward. In such a case, use the function MEMMOVE [} 116]. TE1000 Version: 1.17.0 115
## Page 116

Functions FUNCTION MEMCPY : UDINT Inputs VAR_INPUT dest Addr : PVOID; src Addr : PVOID; n : UDINT; END_VAR Name Type Description dest Addr PVOID Start address of the destination memory area. src Addr PVOID Start address of the source memory area. n UDINT Number of bytes to be copied. The function copies n bytes from the memory area with the start address src Addr to the memory area with the start address dest Addr. Return parameter Meaning 0 Incorrect parameter values. dest Addr == 0 or src Addr == 0 or n == 0 > 0 If successful, the number of bytes copied (n). Example of a call in FBD: PROGRAM MAIN VAR Buffer1 : ARRAY[0..3] OF BYTE; Buffer2 : ARRAY[0..3] OF BYTE; Cpy Result : UDINT; END_VAR In the example, 4 bytes are copied from Buffer2 to Buffer1. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.5.3 MEMMOVE Use the MEMMOVE function to copy values from one memory area to another; the memory areas may overlap. 116 Version: 1.17.0 TE1000
## Page 117

Functions NOTICE System crash or access to unauthorized memory areas Since the function directly accesses the physical memory, special care must be taken when using it. Incorrect parameter values can result in a system crash, or in access to forbidden memory areas. FUNCTION MEMMOVE : UDINT Inputs VAR_INPUT dest Addr : PVOID; src Addr : PVOID; n : UDINT; END_VAR Name Type Description dest Addr PVOID Start address of the destination memory area. src Addr PVOID Start address of the source memory area. n UDINT Number of bytes to be copied. The function copies n bytes from the memory area with the start address src Addr to the memory area with the start address dest Addr. Return parameter Meaning 0 Incorrect parameter values. dest Addr == 0 or src Addr == 0 or n == 0 > 0 If successful, the number of bytes copied (n). Example of a call in FBD: PROGRAM MAIN VAR Buffer1 : ARRAY[0..3] OF BYTE; Buffer2 : ARRAY[0..3] OF BYTE; Move Result : UDINT; END_VAR In the example, 4 bytes are moved from Buffer2 to Buffer1. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.5.4 MEMSET TE1000 Version: 1.17.0 117
## Page 118

Functions The function MEMSET allows PLC variables in a particular memory area to be set to a particular value. NOTICE System crash or access to unauthorized memory areas Since the function directly accesses the physical memory, special care must be taken when using it. Incorrect parameter values can result in a system crash, or in access to forbidden memory areas. MEMSET FUNCTION: UDINT Inputs VAR_INPUT dest Addr : PVOID; fill Byte : USINT; n : UDINT; END_VAR Name Type Description dest Addr PVOID Start address of the memory area that is to be set. fill Byte USINT Value of the filler byte. n UDINT Number of bytes to be set. The function fills n bytes with the fill Byte values; starting from the memory area with the start address dest Addr. Return parameter Meaning 0 Incorrect parameter values. dest Addr == 0 or n == 0 > 0 If successful, the number of bytes that have been set (n). Example of a call in FBD: PROGRAM MAIN VAR Buffer1 : ARRAY[0..3] OF BYTE; Set Result : UDINT; END_VAR In the example, 4 bytes in Buffer1 are set to the value 0x AF. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.6 Time functions 4.6.1 F_Get System Time 118 Version: 1.17.0 TE1000
## Page 119

Functions This function can be used to read the operating system timestamp. The timestamp is a 64-bit integer value, with an accuracy of 100 ns, which is updated with every call of the PLC. Among other things, it can be used for timing tasks or time measurements. One unit corresponds to 100 ns. The time represents the number of 100 ns intervals since January 1, 1601 (UTC). Outputs VAR_OUTPUT F_Get System Time : ULINT; END_VAR The return value contains the timestamp. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1 PC or CX (x86, x64, ARM) Tc2_System (system) >= 3.4.17.0 4.6.2 F_Get Task Time This function can be used to read the start time of the task (time at which the task should start). The function always returns the start time of the task in which the function was called. The time stamp is a 64-bit integer value with an accuracy of 100 ns. It can be used for timing tasks or time measurements, among other things. One unit corresponds to 100 ns. The time represents the number of 100 ns intervals since 1 January 1601. Outputs VAR_OUTPUT F_Get Task Time : ULINT; END_VAR The return value contains the timestamp. Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1 PC or CX (x86, x64, ARM) Tc2_System (system) >= 3.4.17.0 4.6.3 F_Get Task Total Time For a task index the function F_Get Task Total Time returns the total execution time of this task from the last cycle. The total execution time is the sum of the computing times of all modules that are registered on to the task. If 0 is passed as task index, the value for the task in which the function is called is determined. If an invalid task index is passed, the function returns 0 as the total execution time. The total execution time that was determined is shown as a multiple of 100 ns and returned by the function as a return parameter. TE1000 Version: 1.17.0 119
## Page 120

Functions FUNCTION F_Get Task Total Time: UDINT Inputs VAR_INPUT n Task Index : DINT; END_VAR Name Type Description n Task Index DINT Index of the task whose total execution time is to be determined. If 0 is passed as task index, the value for the task in which the function is called is determined. See also: • GETCURTASKINDEX [} 20] Development Environment Target platform PLC libraries to include Twin CAT v3.1.4024.11 PC or CX (x86, x64, Arm®) Tc2_System (system) >= 3.4.24.0 4.7 [Obsolete] 4.7.1 F_Get Version Tc System This function is obsolete and should not be used. Use the global constant st Lib Version_Tc2_System [} 136] instead to read version information of the PLC library. This function can be used to read PLC library version information. FUNCTION F_Get Version Tc System : UINT Inputs VAR_INPUT n Version Element : INT; END_VAR Name Type Description n Version Element INT n Version Element : Version element to be read. Possible parameters: • 1 : major number; • 2 : minor number; • 3 : revision number; Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 120 Version: 1.17.0 TE1000
## Page 121

Functions 4.7.2 GETSYSTEMTIME This function block is replaced by the newer function F_Get System Time(), which only needs one return value, not two. With this function block the operating system time stamp can be read. The time stamp is a 64 bit integer value, with a precision of 100ns, which is updated with every call of the PLC. Amongst other uses, it can be utilized for timing tasks or time measurements. One unit corresponds to 100 ns. The time represents the number of 100 ns intervals since 1 January 1601. See: F_Get System Time [} 118] Inputs VAR_INPUT (*none*) END_VAR Outputs VAR_OUTPUT time Lo DW : UDINT; time Hi DW : UDINT; END_VAR Name Type Beschreibung time Lo DW UDINT Contains the low-value 4 bytes of the time stamp. time Hi DW UDINT Contains the high-value 4 bytes of the time stamp. Sample of calling the function block in FBD: The sample illustrates calling the function block via the instance ‘Get System Time1’, and delivers the 64 bit, integer value (hex) 1BCD6EAB05C4E60 as the time stamp. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 4.7.3 GETTASKTIME This function block is replaced by the newer function F_Get Task Time(), which only needs one return value, not two. TE1000 Version: 1.17.0 121
## Page 122

Functions This function block can be used to read the start time of the task (time at which the task should start). The function block always returns the start time of the task in which the function block instance was called. The time stamp is a 64-bit integer value with an accuracy of 100 ns. It can be used for timing tasks or time measurements, among other things. One unit corresponds to 100 ns. The time represents the number of 100 ns intervals since 1 January 1601. See: F_Get Task Time [} 119] Inputs VAR_INPUT (*none*) END_VAR Outputs VAR_OUTPUT time Lo DW : UDINT; time Hi DW : UDINT; END_VAR Name Type Beschreibung time Lo DW UDINT Contains the low-value 4 bytes of the time stamp. time Hi DW UDINT Contains the high-value 4 bytes of the time stamp. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 122 Version: 1.17.0 TE1000
## Page 123

Data types 5 Data types 5.1 E_IOAccess Size Byte size of I/O position (number of bytes to be written or read). TYPE E_IOAccess Size : ( No Of Byte_Byte := 1, No Of Byte_Word := 2, No Of Byte_DWord := 4 ); END_TYPE Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.2 E_Open Path The variable of this type selects generic or one of the Twin CAT system paths on the target device to perform the file open operation. TYPE E_Open Path : ( PATH_GENERIC :=1, (* search/open/create files in selected/generic folder *) PATH_BOOTPRJ, (* search/open/create files in the Twin CAT/ Boot directory (adds the extension .wbp) *) PATH_BOOTDATA, (* reserved for future use*) PATH_BOOTPATH, (* refers to the Twin CAT/Boot directory without adding an extension (.wbp) *) PATH_USERPATH1 :=11, (*reserved for future use*) PATH_USERPATH2, (*reserved for future use*) PATH_USERPATH3, (*reserved for future use*) PATH_USERPATH4, (*reserved for future use*) PATH_USERPATH5, (*reserved for future use*) PATH_USERPATH6, (*reserved for future use*) PATH_USERPATH7, (*reserved for future use*) PATH_USERPATH8, (*reserved for future use*) PATH_USERPATH9 (*reserved for future use*) ); END_TYPE Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.3 E_Seek Origin A variable of this type shows the origin point by moving the pointer. TYPE E_Seek Origin : ( SEEK_SET := 0, (* Seek from beginning of file *) SEEK_CUR, (* Seek from current position of file pointer *) SEEK_END (* Seek from the end of file *) ); END_TYPE Value Description SEEK_SET Seek from beginning of file SEEK_CUR Seek from current position of file pointer SEEK_END Seek from the end of file TE1000 Version: 1.17.0 123
## Page 124

Data types Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.4 E_Tc Event Class TYPE E_Tc Event Class : ( TCEVENTCLASS_NONE :=0, (* No class *) TCEVENTCLASS_MAINTENANCE :=1, (* Maintenance hint *) TCEVENTCLASS_MESSAGE :=2, (* Message *) TCEVENTCLASS_HINT :=3, (* Hint *) TCEVENTCLASS_STATEINFO :=4, (* State information *) TCEVENTCLASS_INSTRUCTION :=5, (* Instruction *) TCEVENTCLASS_WARNING :=6, (* Warning *) TCEVENTCLASS_ALARM :=7, (* Alarm *) TCEVENTCLASS_PARAMERROR :=8 (* Parameter error *) ); END_TYPE Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.5 E_Tc Event Clear Modes TYPE E_Tc Event Clear Modes : ( TCEVENTLOGIOFFS_CLEARACTIVE := 1, TCEVENTLOGIOFFS_CLEARLOGGED , TCEVENTLOGIOFFS_CLEARALL ); END_TYPE Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.6 E_Tc Event Priority TYPE E_Tc Event Priority : ( TCEVENTPRIO_IMPLICIT := 0 ); END_TYPE Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.7 E_Tc Event Stream Type TYPE E_Tc Event Stream Type : ( TCEVENTSTREAM_INVALID := 0, (* no source name, no prog id *) TCEVENTSTREAM_SIMPLE, (* no source name, no prog id *) TCEVENTSTREAM_NORMAL, (* source name AND prog id *) 124 Version: 1.17.0 TE1000
## Page 125

Data types TCEVENTSTREAM_NOSOURCE, (* no source name, but prog id *) TCEVENTSTREAM_CLASSID, (* source name AND class id *) TCEVENTSTREAM_CLSNOSRC, (* no source name but class id *) TCEVENTSTREAM_READCLASSCOUNT, (* *) TCEVENTSTREAM_MAXTYPE (* no source name but class id *) ); END_TYPE Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.8 E_Tc Memory Area The F_Check Memory Area [} 87] function returns information about the memory area in which the requested variable with the specified size is located. A return value of type E_Tc Memory Area is used for this purpose. {attribute 'qualified_only'} {attribute 'strict'} TYPE E_Tc Memory Area : ( Unknown := 0, Static := 1, // static PLC memory Dynamic := 2, // dynamic memory CNC := 3 )UDINT; END_TYPE Name Description Unknown The memory area is unknown. For example, this could be memory in a Windows context. The memory area is also output as unknown if the specified memory size results in two different memory areas being involved. Furthermore, the memory area is output as unknown if it is a stack memory. Static These are static PLC memories. Dynamic These are dynamically allocated memories, which were allocated during the runtime or during the initialization phase of the PLC. CNC These are memories of the CNC driver. Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.4022 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.9 E_Usr LED_Color TYPE E_Usr LED_Color : ( e Usr LED_Off := 0, e Usr LED_Red := 1, e Usr LED_Blue := 2, e Usr LED_Green := 3 ); END_TYPE 5.10 EPlc Mapping Status Type EPlc Mapping Status : ( MS_Unmapped, MS_Mapped, MS_Partial ); End_TYPE This data type is defined in the global type system. TE1000 Version: 1.17.0 125
## Page 126

Data types Development Environment Target platform PLC libraries to include Twin CAT v3.1.4020 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.11 ST_Ams Addr A variable of this type contains the Twin CAT network address. TYPE ST_Ams Addr : STRUCT net Id : T_Ams Net Id Arr; port : T_Ams Port; END_STRUCT END_TYPE Name Type Description net Id T_Ams Net Id Arr AMS network address (type: T_Ams Net Id Arr [} 127]) port T_Ams Port AMS port number (type: T_Ams Port [} 127]) Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.12 ST_Cpu Core Info A variable of this type contains information about a CPU core. The information can be read for a particular CPU core with the aid of the function F_Get Cpu Core Info [} 90] and the corresponding CPU core index. TYPE ST_Cpu Core Info : STRUCT b RTCore : BOOL; b Isolated Core : BOOL; n Base Time : UDINT; n Core Limit : UDINT; END_STRUCT END_TYPE Name Type Description b RTCore BOOL This variable has a value of TRUE if it is a real-time kernel. b Isolated Core BOOL This variable has a value of TRUE if it is an isolated core. n Base Time UDINT Base time of the CPU core, specified as a multiple of 100 ns n Core Limit UDINT Core limit of the CPU core, specified in % Development Environment Target platform PLC libraries to include Twin CAT v3.1.4024.11 PC or CX (x86, x64, Arm®) Tc2_System (system) >= 3.4.24.0 5.13 SYSTEMINFOTYPE This Twin CAT2 data type does not exist in Twin CAT 3 any more. System Info Type is replaced by Plc App System Info which is a Global Data Type. 5.14 SYSTEMTASKINFOTYPE This Twin CAT2 data type does not exist in Twin CAT 3 any more. System Task Info Type is replaced by Plc Task System Info which is a Global Data Type. 126 Version: 1.17.0 TE1000
## Page 127

Data types 5.15 T_Ams Net ID A PLC variable of this type is a string containing the AMS network ID of the target device to which the ADS command is directed. The string consists of six numerical fields, separated by dots. Valid AMS network addresses are, for example, '1.1.1.2.7.1' or '200.5.7.170.1.7'. If an empty string is passed, the AMS network ID of the local device is automatically assumed. Namespace: Tc2_System Library: Tc2_System (Tc2_System.compiled-library) TYPE T_Ams Net ID : STRING(23); END_TYPE 5.16 T_Ams Net Id Arr TYPE T_Ams Net Id Arr : ARRAY[0..5] OF BYTE; END_TYPE The variable of this type is a array of bytes containing the AMS network identifier. The address bytes are represented in network byte order. E.g. '127.16.17.3.1.1' is represented as: byte[0] = 127 byte[1] = 16 byte[2] = 17 byte[3] = 3 byte[4] = 1 byte[5] = 1 Example: F_Scan Ams Net Ids [} 109] Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.17 T_Ams Port A variable of this type contains the ADS port number. ADS devices in the Twin CAT network are identified by an AMS network address and a port number. The following port numbers are invariably specified on every individual Twin CAT system. TYPE T_Ams Port : UINT; END_TYPE Table with specified ADS port numbers: ADS device Port number Cam controller 900 Runtime system 1 Runtime system 1: 851 (in Twin CAT 2: 801) Runtime system 2 Runtime system 2: 852 (in Twin CAT 2: 811) Runtime system 3 Runtime system 3: 853 (in Twin CAT 2: 821) Runtime system 4 Runtime system 4: 854 (in Twin CAT 2: 831) Runtime system 5 Runtime system 5: 855 Runtime system n Runtime system n: 850 + n, and so on NC 500 Reserved 400 I/O 300 Real-time core 200 Event System (logger) 100 TE1000 Version: 1.17.0 127
## Page 128

Data types Up to four independent PLC runtime systems (PLC projects) can run on a Twin CAT 2 system; each PLC project is to be regarded as a stand-alone PLC. The port number and the network address are both required as input parameters when the ADS blocks are called. The ADS ports from 800 to 899 are generally available for the PLC in Twin CAT3. In order to separate Twin CAT 2 and Twin CAT 3 systems, however, we recommend using only the ports from 851 to 899. If you set the ADS port with the help of the dialog, port 851 is displayed as the lowest port that can be set. In order to use the range 800-850, you need to type in the port number. Proceed as follows to enter the port number via the dialog box: 1. Right-click the desired PLC project. 2. Click Change ADS Port. ð The dialog box opens. 3. Select the desired port number using the arrow keys or type in the desired port number. 4. Confirm the entry with OK. ð The port number has been entered in the system. To ensure separation between Twin CAT 2 and Twin CAT 3 systems, we recommend using only the ADS ports from 851 to 899. ADS ports outside the range from 800 bis 899 will not be accepted by the input system. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.18 T_IPv4Addr A variable of this type is a string with the (Ipv4) Internet protocol network address. E.g. '172.16.7.199'. 128 Version: 1.17.0 TE1000
## Page 129

Data types TYPE T_IPv4Addr : STRING(15); END_TYPE Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.19 T_IPv4Addr Arr The variable of this type is a array of bytes containing the (IPv4) Internet Protocol network address. TYPE T_IPv4Addr Arr: ARRAY[0..3] OF BYTE; END_TYPE The address bytes are represented in network byte order. E.g. '172.16.7.199' is represented as: byte[0] := 172 byte[1] := 16 byte[2] := 7 byte[3] := 199 Example: F_Scan IPv4Addr Ids [} 89] Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.20 T_Max String The variable of this type is PLC string with the maximal length. Longer strings are allowed, but the string functions are limited to 255 characters. TYPE T_Max String : STRING(MAX_STRING_LENGTH); END_TYPE VAR_GLOBAL CONSTANT MAX_STRING_LENGTH : UDINT := 255; ENd_VAR Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 5.21 Tc Event Twin CAT Event Logger vs. Twin CAT 3 Event Logger The Twin CAT Event Logger was replaced by the successor Twin CAT 3 Event Logger. The older Twin CAT Event Logger is supported by Twin CAT 3 up to version 3.1.4024. Newer Twin CAT versions (>= 3.1.4026.0) only support the newer Twin CAT 3 Event Logger. PLC function blocks for this can be found in the PLC library Tc3_Event Logger. TYPE Tc Event STRUCT Class : UDINT; Prio : UDINT; Id : UDINT; b Quit Required : BOOL; TE1000 Version: 1.17.0 129
## Page 130

Data types Data Format Str Address : PVOID; User Flags : DWORD; Flags : DWORD; Stream Type : UDINT; Source String : STRING[15]; (* TCEVENT_SRCNAMESIZE *) Source Id : UDINT; Prog Id : STRING[31]; (* TCEVENT_FMTPRGSIZE *) END_STRUCT END_TYPE Name Type Description Class UDINT Event class, get value from enum E_Tc Event Class [} 124]. Prio UDINT Priority of the event within a class, freely selectable number (1.. Max UDINT) Id UDINT Id of the event, used for unique identification in the Event Logger. b Quit Required BOOL Flag for switching the acknowledgement requirement on and off (TRUE → acknowledgement required) Data Format Str Ad PVOID Address of a string, string contains formatting instructions dress (e.g. %d%f formats an integer and a real (float) value). User Flags DWORD 32-bit number for free disposal Flags DWORD 32-bit number identifying the event, the meaning of the individual bits are declared in the global variables [} 131] of the library. Stream Type UDINT Type of the event, get value from the enum E_Tc Event Stream Type [} 124]. Source String STRING String with the source name (max. 15 characters [} 131]) Source Id UDINT Source-ID Prog Id STRING String (Prog-Id) with the name of the formatter (max. 31 characters [} 131]). Default: 'Tc Event Logger. Tc Log Formatter' or 'Tc Event Formatter. Tc Xml Formatter' Requirements Development environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, ARM) Tc2_System (system) up to Twin CAT v3.1.4024 130 Version: 1.17.0 TE1000
## Page 131

Global constants 6 Global constants 6.1 Constants Port numbers Port numbers Value Description AMSPORT_LOGGER 100 Port number of the Standard-Logger. AMSPORT_EVENTLOG 110 Port number of the Twin CAT Eventlogger. AMSPORT_R0_RTIME 200 Port number of the Twin CAT Realtime Server. AMSPORT_R0_IO 300 Port number of the Twin CAT I/O Server. AMSPORT_R0_NC 500 Port number of the Twin CAT NC Server. AMSPORT_R0_NCSAF 501 Port number of the Twin CAT NC Serves (Task SAF). AMSPORT_R0_NCSVB 511 Port number of the Twin CAT NC Server (Task SVB). AMSPORT_R0_ISG 550 internal AMSPORT_R0_CNC 600 Port number of the Twin CAT NC I Server. AMSPORT_R0_LINE 700 internal AMSPORT_R0_PLC 800 Port number of the Twin CAT PLC Servers (only on the Buscontroller). AMSPORT_R0_PLC_RTS1 801 Port number of the Twin CAT 2.xx PLC Server runtime 1 AMSPORT_R0_PLC_RTS2 811 Port number of the Twin CAT 2.xx PLC Server runtime 2 AMSPORT_R0_PLC_RTS3 821 Port number of the Twin CAT 2.xx PLC Server runtime 3 AMSPORT_R0_PLC_RTS4 831 Port number of the Twin CAT 2.xx PLC Server runtime 4 AMSPORT_R0_CAM 900 Port number of the Twin CAT CAM Server. AMSPORT_R0_CAMTOOL 950 Port number of the Twin CAT CAMTOOL Server. AMSPORT_R3_SYSSERV 10000 Port number of the Twin CAT System Service. AMSPORT_R3_SCOPESERVER 14001 Port number of the Twin CAT Scope Server. TE1000 Version: 1.17.0 131
## Page 132

Global constants Ads-States ADS States Value Description ADSSTATE_INVALID 0 ADS Status: invalid ADSSTATE_IDLE 1 ADS Status: idle ADSSTATE_RESET 2 ADS Status: reset. ADSSTATE_INIT 3 ADS Status: init ADSSTATE_START 4 ADS Status: start ADSSTATE_RUN 5 ADS Status: run ADSSTATE_STOP 6 ADS Status: stop ADSSTATE_SAVECFG 7 ADS Status: save configuration ADSSTATE_LOADCFG 8 ADS Status: load configuration ADSSTATE_POWERFAILURE 9 ADS Status: Power failure ADSSTATE_POWERGOOD 10 ADS Status: Power good ADSSTATE_ERROR 11 ADS Status: Error ADSSTATE_SHUTDOWN 12 ADS Status: Shutdown ADSSTATE_SUSPEND 13 ADS Status: Suspend ADSSTATE_RESUME 14 ADS Status: Resume ADSSTATE_CONFIG 15 ADS Status: Configuration (System is in config mode) ADSSTATE_RECONFIG 16 ADS Status: Reconfiguration (System should restart in config mode) ADSSTATE_STOPPING 17 ADSSTATE_INCOMPATIBLE 18 ADSSTATE_EXCEPTION 19 ADSSTATE_MAXSTATES 20 Max. number of available ads states 132 Version: 1.17.0 TE1000
## Page 133

Global constants ADS/System Services Reserved Index Groups Value Description ADSIGRP_SYMTAB 16#F000 ADSIGRP_SYMNAME 16#F001 ADSIGRP_SYMVAL 16#F002 ADSIGRP_SYM_HNDBYNAME 16#F003 ADSIGRP_SYM_VALBYNAME 16#F004 ADSIGRP_SYM_VALBYHND 16#F005 ADSIGRP_SYM_RELEASEHND 16#F006 ADSIGRP_SYM_INFOBYNAME 16#F007 ADSIGRP_SYM_VERSION 16#F008 ADSIGRP_SYM_INFOBYNAMEEX 16#F009 ADSIGRP_SYM_DOWNLOAD 16#F00A ADSIGRP_SYM_UPLOAD 16#F00B ADSIGRP_SYM_UPLOADINFO 16#F00C ADSIGRP_SYMNOTE 16#F010 ADSIGRP_IOIMAGE_RWIB 16#F020 ADSIGRP_IOIMAGE_RWIX 16#F021 ADSIGRP_IOIMAGE_RISIZE 16#F025 ADSIGRP_IOIMAGE_RWOB 16#F030 ADSIGRP_IOIMAGE_RWOX 16#F031 ADSIGRP_IOIMAGE_RWOSIZE 16#F035 ADSIGRP_IOIMAGE_CLEARI 16#F040 ADSIGRP_IOIMAGE_CLEARO 16#F050 ADSIGRP_IOIMAGE_RWIOB 16#F060 ADSIGRP_DEVICE_DATA 16#F100 ADSIOFFS_DEVDATA_ADSSTATE 16#0000 ADSIOFFS_DEVDATA_DEVSTATE 16#0002 TE1000 Version: 1.17.0 133
## Page 134

Global constants System Service File Service System Service Index Groups Value Description SYSTEMSERVICE_OPENCREATE 100 SYSTEMSERVICE_OPENREAD 101 SYSTEMSERVICE_OPENWRITE 102 SYSTEMSERVICE_CREATEFILE 110 SYSTEMSERVICE_CLOSEHANDLE 111 SYSTEMSERVICE_FOPEN 120 SYSTEMSERVICE_FCLOSE 121 SYSTEMSERVICE_FREAD 122 SYSTEMSERVICE_FWRITE 123 SYSTEMSERVICE_FSEEK 124 SYSTEMSERVICE_FTELL 125 SYSTEMSERVICE_FGETS 126 SYSTEMSERVICE_FPUTS 127 SYSTEMSERVICE_FSCANF 128 SYSTEMSERVICE_FPRINTF 129 SYSTEMSERVICE_FEOF 130 SYSTEMSERVICE_FDELETE 131 SYSTEMSERVICE_FRENAME 132 SYSTEMSERVICE_REG_HKEYLOCALMA 200 CHINE SYSTEMSERVICE_SENDEMAIL 300 SYSTEMSERVICE_TIMESERVICES 400 SYSTEMSERVICE_STARTPROCESS 500 SYSTEMSERVICE_CHANGENETID 600 System Servie Timeservices System Service Index Offsets Value Description (Timeservices) TIMESERVICE_DATEANDTIME 1 TIMESERVICE_SYSTEMTIMES 2 TIMESERVICE_RTCTIMEDIFF 3 TIMESERVICE_ADJUSTTIMETORT 4 C ADSLOG message types Masks for log output Value Description ADSLOG_MSGTYPE_HINT 16#01 ADSLOG_MSGTYPE_WARN 16#02 ADSLOG_MSGTYPE_ERROR 16#04 ADSLOG_MSGTYPE_LOG 16#10 ADSLOG_MSGTYPE_MSGBOX 16#20 ADSLOG_MSGTYPE_RESOURCE 16#40 ADSLOG_MSGTYPE_STRING 16#80 134 Version: 1.17.0 TE1000
## Page 135

Global constants BOOTDATA flags Masks for Bootdata flags Value Description BOOTDATAFLAGS_RETAIN_LOADED 16#01 BOOTDATAFLAGS_RETAIN_INVALID 16#02 BOOTDATAFLAGS_RETAIN_REQUESTED 16#04 BOOTDATAFLAGS_PERSISTENT_LOADED 16#10 BOOTDATAFLAGS_PERSISTENT_INVALID 16#20 Masks for BSOD flags Value Description SYSTEMSTATEFLAGS_BSOD 16#01 BSOD: Blue Screen of Death SYSTEMSTATEFLAGS_RTVIOLATION 16#02 Realtime violation latency overrun File output modes Masks for File output Value Description FOPEN_MODEREAD 16#0001 'r': Opens file for reading FOPEN_MODEWRITE 16#0002 'w': Opens file for reading, (possible) existing files were overwritten. FOPEN_MODEAPPEND 16#0004 'a': Opens file for reading, is attached to (possible) existing file. If no file existes, it will be created. FOPEN_MODEPLUS 16#0008 '+': Opens file for reading and writing. FOPEN_MODEBINARY 16#0010 'b': Opens file forbinary reading and writing. FOPEN_MODETEXT 16#0020 't': Opens file for textual reading and writing: Eventlogger constants Masks for Eventlogger Flags Value Description TCEVENTFLAG_PRIOCLASS 16#0010 Class and priority are defined by the formatter TCEVENTFLAG_FMTSELF 16#0020 The formatting information comes with the event TCEVENTFLAG_LOG 16#0040 Logg. TCEVENTFLAG_MSGBOX 16#0080 Show message box. TCEVENTFLAG_SRCID 16#0100 Use Source-Id instead of Source name. Twin CAT Eventlogger Status Value Description messages TCEVENTSTATE_INVALID 16#0000 Not valid, occurs also if the event was not reported. TCEVENTSTATE_SIGNALED 16#0001 Event is reported, but neither signed off or acknowledged.. TCEVENTSTATE_RESET 16#0002 Event is signed off ('gone'). TCEVENTSTATE_CONFIRMED 16#0010 Event is acknowledged. TCEVENTSTATE_RESETCON 16#0012 Event is signed off and acknowledged Twin CAT Eventlogger Status Value Description messages TCEVENT_SRCNAMESIZE 15 Max. Length for the Source name. TCEVENT_FMTPRGSIZE 31 Max. Length for the name of the formatter. Other Value Description PI 3.14159265358979323846264338 Pi number 32795 DEFAULT_ADS_TIMEOUT T#5s Default ADS timeout MAX_STRING_LENGTH 255 The max. string length of T_Max String data type TE1000 Version: 1.17.0 135
## Page 136

Global constants Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 6.2 Library version All libraries have a certain version. The version is indicated in the PLC library repository, for example. A global constant contains the information about the library version: Global_Version VAR_GLOBAL CONSTANT st Lib Version_Tc2_System : ST_Lib Version; END_VAR Name Type Description st Lib Version_Tc2 ST_Lib Version Version number of the Tc2_System library (type: _System ST_Lib Version) To check whether the version you have is the version you need, use the function F_Cmp Lib Version [} 88]. All other options for comparing library versions, which you may know from Twin CAT 2, are outdated. Prerequisites Development Environment Target platform PLC libraries to be integrated (category group) Twin CAT v3.1.0 PC or CX (x86, x64, Arm®) Tc2_System (system) 136 Version: 1.17.0 TE1000
## Page 137

Samples 7 Samples 7.1 Example with Ads Read Ind /Ads Read Res function blocks The example shows the implementation of a simple ADS Server application to the PLC. The server application can process the ADSREAD requests of an ADS Client application. In the example application, ADSREAD requests are used to increment/decrement or reset a PLC counter variable in the PLC task. If successful the value of the counter variable is returned to the ADS Client application The complete sources of the ADS server application can be unpacked here: https://infosys.beckhoff.com/ content/1033/Tc Plc Lib_Tc2_System/Resources/710574987.zip An ADS Client application suitable for the ADS Server can be found here: Example with ADSREAD function block. [} 140] ADS Client application The required service in the PLC task is encoded in the index group parameter: IG:0x80000001 → increment the counter variable; IG:0x80000002 → decrement the counter variable; IG:0x80000003 → set the counter variable = 0; The index offset parameter is zero. So that the requests can be routed to the PLC task, the highest value bit must be set in the index group parameter. PLC program The ADSREAD requests are intercepted as indications in the PLC task by an instance of the ADSREADIND [} 28] function block. Afterwards the index group and index offset parameters and the required data length and validity are checked. In the CASE instruction the desired operation with the PLC variables is carried out. If successful a response is sent back by an instance of the ADSREADRES [} 36] function block to the caller with the current value of the PLC variables. In the case of an error an appropriate error message. In the next cycle the CLEAR and RESPOND flags on the function blocks are reset in order to be able to process further indications. Declaration Part PROGRAM MAIN VAR fb Read Ind : ADSREADIND;(* Indication function block instance *) fb Read Res : ADSREADRES;(* Response function block instance *) s Net Id : T_Ams Net ID; n Port : T_Ams Port; n Invoke Id : UDINT; n Idx Grp : UDINT; n Idx Offs : UDINT; cb Length : UDINT;(* Requested read data/buffer byte size *) cb Read : UDINT;(* Returned read data/buffer byte size *) p Read : PVOID;(* Pointer to returned read data/buffer *) n Err ID : UDINT;(* Read indication result error code *) n Counter : INT;(* Server data *) END_VAR TE1000 Version: 1.17.0 137
## Page 138

Samples Implementation fb Read Res( RESPOND := FALSE );(* Reset response function block *) fb Read Ind( CLEAR := FALSE );(* Trigger indication function block *) IF fb Read Ind. VALID THEN(* Check for new indication *) s Net ID := fb Read Ind. NETID; n Port := fb Read Ind. PORT; n Invoke ID := fb Read Ind. INVOKEID; n Idx Grp := fb Read Ind. IDXGRP; n Idx Offs := fb Read Ind. IDXOFFS; cb Length := fb Read Ind. LENGTH; cb Read := 0; p Read := 0; n Err ID := DEVICE_SRVNOTSUPP; CASE n Idx Grp OF (*------------------------------------------------------------------------------------*) 16#80000001: CASE n Idx Offs OF 0:(* Increment counter value *) IF cb Length >= SIZEOF(n Counter) THEN n Counter := n Counter + 1; cb Read := SIZEOF(n Counter); p Read := ADR(n Counter); n Err ID := NOERR; ELSE (* ADS error (example): Invalid size *) n Err ID := DEVICE_INVALIDSIZE; END_IF ELSE (* ADS error (example): Invalid index offset *) n Err ID := DEVICE_INVALIDOFFSET; END_CASE (*------------------------------------------------------------------------------------*) 16#80000002: CASE n Idx Offs OF 0:(* Decrement counter value *) IF cb Length >= SIZEOF(n Counter) THEN n Counter := n Counter - 1; cb Read := SIZEOF(n Counter); p Read := ADR(n Counter); n Err ID := NOERR; ELSE(* ADS error (example): Invalid size *) n Err ID := DEVICE_INVALIDSIZE; END_IF ELSE (* ADS error (example): Invalid index offset *) n Err ID := DEVICE_INVALIDOFFSET; END_CASE (*------------------------------------------------------------------------------------*) 16#80000003: CASE n Idx Offs OF 0:(* Reset counter value *) IF cb Length >= SIZEOF(n Counter) THEN n Counter := 0; cb Read := SIZEOF(n Counter); p Read := ADR(n Counter); n Err ID := NOERR; ELSE(* ADS error (example): Invalid size *) n Err ID := DEVICE_INVALIDSIZE; END_IF ELSE (* ADS error (example): ervice is not supported by server *) n Err ID := DEVICE_SRVNOTSUPP; END_CASE ELSE (* ADS error (example): Invalid index group *) n Err ID := DEVICE_INVALIDGRP; END_CASE fb Read Res( NETID := s Net ID, PORT := n Port, INVOKEID := n Invoke ID, LEN := cb Read, DATAADDR := p Read, RESULT := n Err ID, RESPOND := TRUE );(* Send read response *) fb Read Ind( CLEAR := TRUE ); (* Clear indication entry *) END_IF 138 Version: 1.17.0 TE1000
## Page 139

Samples 7.2 Example with Ads Write Ind/Ads Write Res function blocks The example shows the implementation of a simple ADS Server application to the PLC. The server application can process the ADSWRITE requests of an ADS Client application. In the example application ADSWRITE requests are used to transfer arrays with integer values to the PLC task. The received data are copied in the PLC into an appropriate array variable. The complete sources of the ADS server application can be unpacked here: https://infosys.beckhoff.com/ content/1033/Tc Plc Lib_Tc2_System/Resources/710582923.zip An ADS Client application suitable for the ADS Server can be found here: Example with ADSWRITE function block. [} 141] ADS Client application The desired service/command from the PLC task is encoded in the index group and index offset parameters. E.g.: IG:0x80000005 and IO:0x00000007→ copy the sent data to the array in the PLC. So that the requests can be routed to the PLC task, the highest value bit must be set in the index group parameter. PLC program The requests are intercepted as indications in the PLC task by an instance of the ADSWRITEIND [} 30] function block. Following this, the index group, index offset and transmitted data length parameters are checked for validity, and the desired operation is carried out on the PLC variable. The next step is for a response to be returned to the caller (including an error code, if appropriate) by an instance of the ADSWRITERES [} 37]-function block. In the next cycle the CLEAR and RESPOND flags are reset in order to be able to process further indications. With the rising edge at the CLEAR input of the ADSWRITEIND function block the address pointer to the most recently sent data becomes invalid ( == ZERO ). For this reason the sent data is first copied into the PLC variable before the CLEAR input is set to TRUE. Declaration Part PROGRAM MAIN VAR fb Write Ind : ADSWRITEIND; fb Write Res : ADSWRITERES; s Net Id : T_Ams Net ID; n Port : T_Ams Port; n Invoke Id : UDINT; n Idx Grp : UDINT; n Idx Offs : UDINT; cb Write : UDINT;(* Byte size of written data *) p Write : PVOID;(* Pointer to written data buffer *) n Result : UDINT;(* Write indication result error code *) arr Int : ARRAY[0..9] OF INT;(* Server data *) END_VAR Implementation fb Write Res( RESPOND := FALSE );(* Reset response function block *) fb Write Ind( CLEAR := FALSE );(* Trigger indication function block *) IF ( fb Write Ind. VALID ) THEN s Net Id := fb Write Ind. NETID; n Port := fb Write Ind. PORT; n Invoke Id := fb Write Ind. INVOKEID; TE1000 Version: 1.17.0 139
## Page 140

Samples n Idx Grp := fb Write Ind. IDXGRP; n Idx Offs := fb Write Ind. IDXOFFS; cb Write := fb Write Ind. LENGTH; p Write := fb Write Ind. DATAADDR; n Result := DEVICE_SRVNOTSUPP; CASE n Idx Grp OF 16#80000005: CASE n Idx Offs OF 16#00000007: IF cb Write <= SIZEOF( arr Int ) THEN MEMCPY( ADR( arr Int ), p Write, MIN( cb Write, SIZEOF(arr Int) ) ); n Result := NOERR; ELSE(* ADS error (example): Invalid size *) n Result := DEVICE_INVALIDSIZE; END_IF ELSE(* ADS error (example): Invalid index offset *) n Result := DEVICE_INVALIDOFFSET; END_CASE ELSE(* ADS error (example): Invalid index group *) n Result := DEVICE_INVALIDGRP; END_CASE fb Write Res( NETID := s Net Id, PORT := n Port, INVOKEID := n Invoke Id, RESULT := n Result, RESPOND := TRUE ); (* Send write response *) fb Write Ind( CLEAR := TRUE ); (* Clear indication entry *) END_IF 7.3 Example with Ads Read function block The example demonstrates the use of the ADSREAD function block in an ADS Client application. The complete sources of the ADS Client application can be unpacked here: https://infosys.beckhoff.com/ content/1033/Tc Plc Lib_Tc2_System/Resources/710578827.zip Declaration Part PROGRAM MAIN VAR fb Read Req : ADSREADEX := ( NETID := '', PORT := 851, TMOUT := DEFAULT_ADS_TIMEOUT ); b Increment : BOOL;(* Rising edge at this variable starts command execution *) b Decrement : BOOL;(* Rising edge at this variable starts command execution *) b Reset : BOOL;(* Rising edge at this variable starts command execution *) b Other : BOOL;(* Rising edge at this variable starts command execution *) n State : BYTE; b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; cb Read : UDINT; n Counter : INT;(* Server data to be read *) END_VAR Implementation CASE n State OF 0: IF b Increment OR b Decrement OR b Reset OR b Other THEN b Busy := TRUE; b Error := FALSE; n Err ID := 0; fb Read Req( READ := FALSE ); IF b Increment THEN(* Incement counter value *) b Increment := FALSE; fb Read Req( IDXGRP := 16#80000001, IDXOFFS := 0, LEN := SIZEOF(n Counter), DESTADDR := ADR(n Counter), READ := TRUE ); ELSIF b Decrement THEN(* Decrement counter value *) b Decrement := FALSE; fb Read Req( IDXGRP := 16#80000002, IDXOFFS := 0, LEN := SIZEOF(n Counter), DESTADDR := 140 Version: 1.17.0 TE1000
## Page 141

Samples ADR(n Counter), READ := TRUE ); ELSIF b Reset THEN(* Reset counter value *) b Reset := FALSE; fb Read Req( IDXGRP := 16#80000003, IDXOFFS := 0, LEN := SIZEOF(n Counter), DESTADDR := ADR(n Counter), READ := TRUE ); ELSIF b Other THEN(* Call unsupported function *) b Other := FALSE; fb Read Req( IDXGRP := 16#80000004, IDXOFFS := 0, LEN := SIZEOF(n Counter), DESTADDR := ADR(n Counter), READ := TRUE ); END_IF n State := 1; END_IF 1: fb Read Req( READ := FALSE, BUSY=>b Busy, ERR=>b Error, ERRID=>n Err ID, COUNT_R=>cb Read ); IF NOT b Busy THEN IF NOT b Error THEN n State := 0;(* Success *) ELSE n State := 100;(* Error *) END_IF END_IF 100:(* TODO::Implement error handler *) n State := 0; END_CASE 7.4 Example with Ads Write function block The example demonstrates the use of the ADSWRITE function block in an ADS Client application. The complete sources of the ADS Client application can be unpacked here: https://infosys.beckhoff.com/ content/1033/Tc Plc Lib_Tc2_System/Resources/710586763.zip Declaration Part PROGRAM MAIN VAR fb Write Req : ADSWRITE := ( NETID := '', PORT := 851, TMOUT := DEFAULT_ADS_TIMEOUT ); b Write : BOOL;(* Rising edge at this variable starts command execution *) n State : BYTE; b Busy : BOOL; b Error : BOOL; n Err ID : UDINT; arr Int : ARRAY[0..9] OF INT;(* Server data to be written *) i : INT; END_VAR Implementation FOR i:=0 TO 9 BY 1 DO (* modify/simulate new data *) arr Int[i] := arr Int[i] + 1; END_FOR CASE n State OF 0: IF b Write THEN b Write := FALSE; b Busy := TRUE; b Error := FALSE; n Err ID := 0; fb Write Req( WRITE := FALSE ); fb Write Req( IDXGRP := 16#80000005, IDXOFFS := 7, LEN := SIZEOF( arr Int ), SRCADDR := ADR( arr Int ), WRITE := TRUE ); n State := 1; END_IF 1: fb Write Req( WRITE := FALSE, BUSY=>b Busy, ERR=>b Error, ERRID=>n Err ID ); IF NOT b Busy THEN IF NOT b Error THEN TE1000 Version: 1.17.0 141
## Page 142

Samples n State := 0;(* Success *) ELSE n State := 100;(* Error *) END_IF END_IF 100:(* TODO::Implement error handler *) n State := 0; END_CASE 7.5 Sending/acknowledging Event Logger signals from the PLC The example demonstrates the use of the ADSLOGEVENT function block. The complete sources for the example application can be unpacked here: https://infosys.beckhoff.com/ content/1033/Tc Plc Lib_Tc2_System/Resources/711421451.zip Step by step sequence Configuration of an event: Parameterisation of Event Config Data [} 129] structure Transfer of parameters: Generate an address of a structure, an array or a single variable with ADR operator at Event Data Address. Determine the length of the structure, array or single variable using the SIZEOF operator and apply it to the Event Data Length input. If, for example, a structure with an INT and an LREAL variable is to be transferred with the event, then a structure must be created with these two components and instanced. The address and the length of this instance must be transferred. Setting an event: Rising edge at the Event input Resetting an event: Falling edge at the Event input To acknowledge an events: Rising edge at the Quit input Complete deletion of the instance: The contents of the instance are completely deleted with a rising edge at the Fb Cleanup input. An existing event from the Event Logger is not directly deleted by this. After an event has been sent to the Event Logger, the status of the event [} 131] changes visibly at the Eventstate output. Calling the ADSLOGEVENT function block PROGRAM MAIN VAR FB_Event1 : ADSLOGEVENT; Cfg Event : Tc Event; Eventdata : Para Struct; Event State : UDINT; b Event : BOOL; b Quit : BOOL; END_VAR VAR CONSTANT TCEvent Data Format String : STRING:='%f%d'; Tc Event Time Out : TIME:=T#1s; END_VAR 142 Version: 1.17.0 TE1000
## Page 143

Samples Declaration Part PROGRAM MAIN VAR Cfg Event : Tc Event; fb Event : ADSLOGEVENT; b Set Event : BOOL;(* Rising edge sets event *) event Data : ST_Event Data; Tc Event Data Format String : STRING := '%f%d'; END_VAR Implementation Cfg Event. Class := TCEVENTCLASS_ALARM; Cfg Event. Prio := 2; Cfg Event. Id := 1; Cfg Event. Source Id := 100; Cfg Event.b Quit Required := TRUE; Cfg Event. Data Format Str Address := ADR(Tc Event Data Format String); Cfg Event. Flags := TCEVENTFLAG_LOG OR TCEVENTFLAG_SRCID OR TCEVENTFLAG_AUTOFMTALL; Cfg Event. Stream Type := TCEVENTSTREAM_SIMPLE; Cfg Event. Prog Id :='Tc Event Formatter. Tc XMLFormatter' ; event Data.r Val := 2.65; event Data.i Val := 3; fb Event( NETID:= '', PORT:= 110, Event:= b Set Event, Event Config Data:= Cfg Event, Event Data Address := ADR(event Data) , Event Data Length := SIZEOF(event Data), TMOUT:= t#3s); 7.6 File access from the PLC The use of the PLC function blocks for data access from the Tc2_system library is introduced in this example. A new function block, FB_File Copy, is implemented with the aid of the existing function blocks. Using the FB_File Copy function block, binary files can be copied in the local Twin CAT system or between a local and a remote Twin CAT system. The complete source code for the example project can be unpacked from here: https://infosys.beckhoff.com/ content/1033/Tc Plc Lib_Tc2_System/Resources/707895179.zip Network drives cannot be accessed using the FB_File Copy function block. A rising edge at the b Execute input of the FB_File Copy block results in execution of the following steps. a) Open the source and destination files b) Read the source file into a buffer c) Write the bytes that have been read from the buffer into the destination file d) Check whether the end of the source file has been reached. If not, then repeat b) and c). If yes, then jump to e) TE1000 Version: 1.17.0 143
## Page 144

Samples e) Close the source and destination files; The file is copied one segment at a time. In this example, the size of the buffer has been specified as 1000 bytes, but this can be modified. PLC program Declaration Part FUNCTION_BLOCK FB_File Copy VAR_INPUT s Src Net Id : T_Ams Net Id; s Src Path Name : T_Max String; s Dest Net Id : T_Ams Net Id; s Dest Path Name : T_Max String; b Execute : BOOL; t Time Out : TIME := DEFAULT_ADS_TIMEOUT; END_VAR VAR_OUTPUT b Busy : BOOL; b Error : BOOL; n Err Id : UDINT; END_VAR VAR fb File Open : FB_File Open; fb File Close : FB_File Close; fb File Read : FB_File Read; fb File Write : FB_File Write; h Src File : UINT := 0;(* File handle of the source file *) h Dest File : UINT := 0;(* File handle of the destination file *) Step : DWORD; Rising Edge : R_TRIG; buff Read : ARRAY[1..1000] OF BYTE;(* Buffer *) cb Read Length : UDINT := 0; END_VAR Implementation Rising Edge(CLK:=b Execute); CASE Step OF 0: (* Idle state *) IF Rising Edge. Q THEN b Busy := TRUE; b Error:= FALSE; n Err Id:=0; Step := 1; cb Read Length:=0; h Src File:=0; 144 Version: 1.17.0 TE1000
## Page 145

Samples h Dest File:=0; END_IF 1: (* Open source file *) fb File Open( b Execute := FALSE ); fb File Open( s Net Id := s Src Net Id, s Path Name := s Src Path Name, n Mode := FOPEN_MODEREAD OR FOPEN_MODEBINARY, e Path := PATH_GENERIC, t Timeout := t Time Out, b Execute := TRUE ); Step := Step + 1; 2: fb File Open( b Execute := FALSE ); IF NOT fb File Open.b Busy THEN IF fb File Open.b Error THEN n Err Id := fb File Open.n Err Id; b Error := TRUE; Step := 50; ELSE h Src File := fb File Open.h File; Step := Step + 1; END_IF END_IF 3: (* Open destination file *) fb File Open( b Execute := FALSE ); fb File Open( s Net Id := s Dest Net Id, s Path Name := s Dest Path Name, n Mode := FOPEN_MODEWRITE OR FOPEN_MODEBINARY, e Path := PATH_GENERIC, t Timeout := t Time Out, b Execute := TRUE ); Step := Step+1; 4: fb File Open( b Execute := FALSE ); IF NOT fb File Open.b Busy THEN IF fb File Open.b Error THEN n Err Id := fb File Open.n Err Id; b Error := TRUE; Step := 50; ELSE h Dest File := fb File Open.h File; Step := Step + 1; END_IF END_IF 5: (* Read data from source file *) cb Read Length := 0; fb File Read( b Execute:= FALSE ); fb File Read( s Net Id:=s Src Net Id, h File:=h Src File, p Read Buff:= ADR(buff Read), cb Read Len:= SIZEOF(buff Read), b Execute:=TRUE, t Timeout:=t Time Out ); Step := Step + 1; 6: fb File Read( b Execute:= FALSE ); IF NOT fb File Read.b Busy THEN IF fb File Read.b Error THEN n Err Id := fb File Read.n Err Id; b Error := TRUE; Step := 50; ELSE cb Read Length := fb File Read.cb Read; Step := Step + 1; END_IF END_IF 7: (* Write data to destination file *) fb File Write( b Execute := FALSE ); fb File Write( s Net Id:=s Dest Net Id, h File:=h Dest File, p Write Buff:= ADR(buff Read), cb Write Len:= cb Read Length, b Execute:=TRUE, t Timeout:=t Time Out ); Step := Step + 1; 8: fb File Write( b Execute := FALSE ); IF NOT fb File Write.b Busy THEN IF fb File Write.b Error THEN n Err Id := fb File Write.n Err Id; b Error := TRUE; Step := 50; ELSE IF fb File Read.b EOF THEN (* Check if the EOF flag ist set *) Step := 50; (* Cleanup: close the destination and source files *) ELSE Step := 5; (* Repeat reading/writing *) END_IF TE1000 Version: 1.17.0 145
## Page 146

Samples END_IF END_IF 30: (* Close the destination file *) fb File Close( b Execute := FALSE ); fb File Close( s Net Id:=s Dest Net Id, h File:=h Dest File, b Execute:=TRUE, t Timeout:=t Time Out ); Step := Step + 1; 31: fb File Close( b Execute := FALSE ); IF NOT fb File Close.b Busy THEN IF fb File Close.b Error THEN n Err Id := fb File Close.n Err Id; b Error := TRUE; END_IF Step := 50; h Dest File := 0; END_IF 40: (* Close source file *) fb File Close( b Execute := FALSE ); fb File Close( s Net Id:=s Src Net Id, h File:=h Src File, b Execute:=TRUE, t Timeout:=t Time Out ); Step := Step + 1; 41: fb File Close( b Execute := FALSE ); IF NOT fb File Close.b Busy THEN IF fb File Close.b Error THEN n Err Id := fb File Close.n Err Id; b Error := TRUE; END_IF Step := 50; h Src File := 0; END_IF 50: (* Error or ready => Cleanup *) IF ( h Dest File <> 0 ) THEN Step := 30; (* Close the destination file*) ELSIF (h Src File <> 0 ) THEN Step := 40; (* Close the source file *) ELSE Step := 0; (* Ready *) b Busy := FALSE; END_IF END_CASE 7.7 Testing the CPU reserve of a CX70xx This example is a test project for testing the CPU reserve of a CX70xx. The included function block FB_Test_CPU_Performance measures the CPU reserve you have with your application. The function block reads the current CPU power and cycle time. The function block then increases the CPU load until the CX7k no longer operates in real time. Then it reduces the load again until a stable real time is reached. The function block then determines the CPU power and the cycle time and offsets them against the time and load taken at the start of the measurement and gives you the delta. Use the function block for test purposes only and not in a real environment. If the CPU reserve is greater than 20%, you can make the task cycle time faster than the one currently in use. The advantages of a faster task are faster reaction to inputs and, depending on the program content, a faster application. A few milliseconds can add up to increase the output of a machine. A reserve power of 20 % is ideal. The sources for the sample project can be unpacked here: https://infosys.beckhoff.com/content/1033/ Tc Plc Lib_Tc2_System/Resources/11298888331.zip Falsified measurement result If the function block is used in a low-priority task, the result is falsified and the real data cannot be determined. Due to the long measurement, the slow tasks are also taken into account. • If possible, always use the function block in the fastest high-priority task. 146 Version: 1.17.0 TE1000
## Page 147

Samples Loops or program sections not run through during the measurement falsify the measurement Loops, multiple tasks and thus strongly fluctuating cycle times cause a strongly fluctuating CPU load. • Set the Time Out of the function block to a larger value, because the function block searches for the highest CPU load and then takes longer than with a constant CPU load. Aborting the measurement The function block can only be used if there are no real-time violations in your configuration. If the function block reads out real-time violations already at start-up, the function block aborts the measurement. Information on the function block FB_Test_CPU_Performance: VAR_INPUT Name Type Description b Execute BOOL A positive edge activates the function block. t Time Out TIME Time to stop the measurement if exceeded. VAR_OUTPUT Name Type Description b Busy BOOL The function block is active and working. b Error BOOL The function block has an error. n Error ID UDINT ADS error code n Cpu Load Reserve UDINT Reserve of CPU in [%] f Cycle Time Reserve LREAL Cycle time reserve in [ms] Development environment Target platform PLC libraries to include Twin CAT v3.1.4024.22 PC or CX (x86, x64, ARM) Tc2_System (system) >= 3.4.25.0 TE1000 Version: 1.17.0 147
## Page 148

Appendix 8 Appendix 8.1 ADS Return Codes Grouping of error codes: Global error codes: 0x0000 [} 148]... (0x9811_0000 ...) Router error codes: 0x500 [} 148]... (0x9811_0500 ...) General ADS errors: 0x700 [} 149]... (0x9811_0700 ...) RTime error codes: 0x1000 [} 151]... (0x9811_1000 ...) Global error codes Hex Dec HRESULT Name Description 0x0 0 0x98110000 ERR_NOERROR No error. 0x1 1 0x98110001 ERR_INTERNAL Internal error. 0x2 2 0x98110002 ERR_NORTIME No real time. 0x3 3 0x98110003 ERR_ALLOCLOCKEDMEM Allocation locked – memory error. 0x4 4 0x98110004 ERR_INSERTMAILBOX Mailbox full – the ADS message could not be sent. Reducing the number of ADS messages per cycle will help. 0x5 5 0x98110005 ERR_WRONGRECEIVEHMSG Wrong HMSG. 0x6 6 0x98110006 ERR_TARGETPORTNOTFOUND Target port not found – ADS server is not started, not reachable or not installed. 0x7 7 0x98110007 ERR_TARGETMACHINENOTFOUND Target computer not found – AMS route was not found. 0x8 8 0x98110008 ERR_UNKNOWNCMDID Unknown command ID. 0x9 9 0x98110009 ERR_BADTASKID Invalid task ID. 0x A 10 0x9811000A ERR_NOIO No IO. 0x B 11 0x9811000B ERR_UNKNOWNAMSCMD Unknown AMS command. 0x C 12 0x9811000C ERR_WIN32ERROR Win32 error. 0x D 13 0x9811000D ERR_PORTNOTCONNECTED Port not connected. 0x E 14 0x9811000E ERR_INVALIDAMSLENGTH Invalid AMS length. 0x F 15 0x9811000F ERR_INVALIDAMSNETID Invalid AMS Net ID. 0x10 16 0x98110010 ERR_LOWINSTLEVEL Installation level is too low –Twin CAT 2 license error. 0x11 17 0x98110011 ERR_NODEBUGINTAVAILABLE No debugging available. 0x12 18 0x98110012 ERR_PORTDISABLED Port disabled – Twin CAT system service not started. 0x13 19 0x98110013 ERR_PORTALREADYCONNECTED Port already connected. 0x14 20 0x98110014 ERR_AMSSYNC_W32ERROR AMS Sync Win32 error. 0x15 21 0x98110015 ERR_AMSSYNC_TIMEOUT AMS Sync Timeout. 0x16 22 0x98110016 ERR_AMSSYNC_AMSERROR AMS Sync error. 0x17 23 0x98110017 ERR_AMSSYNC_NOINDEXINMAP No index map for AMS Sync available. 0x18 24 0x98110018 ERR_INVALIDAMSPORT Invalid AMS port. 0x19 25 0x98110019 ERR_NOMEMORY No memory. 0x1A 26 0x9811001A ERR_TCPSEND TCP send error. 0x1B 27 0x9811001B ERR_HOSTUNREACHABLE Host unreachable. 0x1C 28 0x9811001C ERR_INVALIDAMSFRAGMENT Invalid AMS fragment. 0x1D 29 0x9811001D ERR_TLSSEND TLS send error – secure ADS connection failed. 0x1E 30 0x9811001E ERR_ACCESSDENIED Access denied – secure ADS access denied. Router error codes 148 Version: 1.17.0 TE1000
## Page 149

Appendix Hex Dec HRESULT Name Description 0x500 1280 0x98110500 ROUTERERR_NOLOCKEDMEMORY Locked memory cannot be allocated. 0x501 1281 0x98110501 ROUTERERR_RESIZEMEMORY The router memory size could not be changed. 0x502 1282 0x98110502 ROUTERERR_MAILBOXFULL The mailbox has reached the maximum number of possible messages. 0x503 1283 0x98110503 ROUTERERR_DEBUGBOXFULL The Debug mailbox has reached the maximum number of possible messages. 0x504 1284 0x98110504 ROUTERERR_UNKNOWNPORTTYPE The port type is unknown. 0x505 1285 0x98110505 ROUTERERR_NOTINITIALIZED The router is not initialized. 0x506 1286 0x98110506 ROUTERERR_PORTALREADYINUSE The port number is already assigned. 0x507 1287 0x98110507 ROUTERERR_NOTREGISTERED The port is not registered. 0x508 1288 0x98110508 ROUTERERR_NOMOREQUEUES The maximum number of ports has been reached. 0x509 1289 0x98110509 ROUTERERR_INVALIDPORT The port is invalid. 0x50A 1290 0x9811050A ROUTERERR_NOTACTIVATED The router is not active. 0x50B 1291 0x9811050B ROUTERERR_FRAGMENTBOXFULL The mailbox has reached the maximum number for fragmented messages. 0x50C 1292 0x9811050C ROUTERERR_FRAGMENTTIMEOUT A fragment timeout has occurred. 0x50D 1293 0x9811050D ROUTERERR_TOBEREMOVED The port is removed. General ADS error codes TE1000 Version: 1.17.0 149
## Page 150

Appendix Hex Dec HRESULT Name Description 0x700 1792 0x98110700 ADSERR_DEVICE_ERROR General device error. 0x701 1793 0x98110701 ADSERR_DEVICE_SRVNOTSUPP Service is not supported by the server. 0x702 1794 0x98110702 ADSERR_DEVICE_INVALIDGRP Invalid index group. 0x703 1795 0x98110703 ADSERR_DEVICE_INVALIDOFFSET Invalid index offset. 0x704 1796 0x98110704 ADSERR_DEVICE_INVALIDACCESS Reading or writing not permitted. Several causes are possible. For example, an incorrect password was entered when creating routes. 0x705 1797 0x98110705 ADSERR_DEVICE_INVALIDSIZE Parameter size not correct. 0x706 1798 0x98110706 ADSERR_DEVICE_INVALIDDATA Invalid data values. 0x707 1799 0x98110707 ADSERR_DEVICE_NOTREADY Device is not ready to operate. 0x708 1800 0x98110708 ADSERR_DEVICE_BUSY Device is busy. 0x709 1801 0x98110709 ADSERR_DEVICE_INVALIDCONTEXT Invalid operating system context. This can result from use of ADS blocks in different tasks. It may be possible to resolve this through multitasking synchronization in the PLC. 0x70A 1802 0x9811070A ADSERR_DEVICE_NOMEMORY Insufficient memory. 0x70B 1803 0x9811070B ADSERR_DEVICE_INVALIDPARM Invalid parameter values. 0x70C 1804 0x9811070C ADSERR_DEVICE_NOTFOUND Not found (files, ...). 0x70D 1805 0x9811070D ADSERR_DEVICE_SYNTAX Syntax error in file or command. 0x70E 1806 0x9811070E ADSERR_DEVICE_INCOMPATIBLE Objects do not match. 0x70F 1807 0x9811070F ADSERR_DEVICE_EXISTS Object already exists. 0x710 1808 0x98110710 ADSERR_DEVICE_SYMBOLNOTFOUND Symbol not found. 0x711 1809 0x98110711 ADSERR_DEVICE_SYMBOLVERSIONINVALID Invalid symbol version. This can occur due to an online change. Create a new handle. 0x712 1810 0x98110712 ADSERR_DEVICE_INVALIDSTATE Device (server) is in invalid state. 0x713 1811 0x98110713 ADSERR_DEVICE_TRANSMODENOTSUPP Ads Trans Mode not supported. 0x714 1812 0x98110714 ADSERR_DEVICE_NOTIFYHNDINVALID Notification handle is invalid. 0x715 1813 0x98110715 ADSERR_DEVICE_CLIENTUNKNOWN Notification client not registered. 0x716 1814 0x98110716 ADSERR_DEVICE_NOMOREHDLS No further handle available. 0x717 1815 0x98110717 ADSERR_DEVICE_INVALIDWATCHSIZE Notification size too large. 0x718 1816 0x98110718 ADSERR_DEVICE_NOTINIT Device not initialized. 0x719 1817 0x98110719 ADSERR_DEVICE_TIMEOUT Device has a timeout. 0x71A 1818 0x9811071A ADSERR_DEVICE_NOINTERFACE Interface query failed. 0x71B 1819 0x9811071B ADSERR_DEVICE_INVALIDINTERFACE Wrong interface requested. 0x71C 1820 0x9811071C ADSERR_DEVICE_INVALIDCLSID Class ID is invalid. 0x71D 1821 0x9811071D ADSERR_DEVICE_INVALIDOBJID Object ID is invalid. 0x71E 1822 0x9811071E ADSERR_DEVICE_PENDING Request pending. 0x71F 1823 0x9811071F ADSERR_DEVICE_ABORTED Request is aborted. 0x720 1824 0x98110720 ADSERR_DEVICE_WARNING Signal warning. 0x721 1825 0x98110721 ADSERR_DEVICE_INVALIDARRAYIDX Invalid array index. 0x722 1826 0x98110722 ADSERR_DEVICE_SYMBOLNOTACTIVE Symbol not active. 0x723 1827 0x98110723 ADSERR_DEVICE_ACCESSDENIED Access denied. Several causes are possible. For example, a unidirectional ADS route is used in the opposite direction. 0x724 1828 0x98110724 ADSERR_DEVICE_LICENSENOTFOUND Missing license. 0x725 1829 0x98110725 ADSERR_DEVICE_LICENSEEXPIRED License expired. 0x726 1830 0x98110726 ADSERR_DEVICE_LICENSEEXCEEDED License exceeded. 0x727 1831 0x98110727 ADSERR_DEVICE_LICENSEINVALID Invalid license. 0x728 1832 0x98110728 ADSERR_DEVICE_LICENSESYSTEMID License problem: System ID is invalid. 0x729 1833 0x98110729 ADSERR_DEVICE_LICENSENOTIMELIMIT License not limited in time. 0x72A 1834 0x9811072A ADSERR_DEVICE_LICENSEFUTUREISSUE Licensing problem: time in the future. 0x72B 1835 0x9811072B ADSERR_DEVICE_LICENSETIMETOLONG License period too long. 0x72C 1836 0x9811072C ADSERR_DEVICE_EXCEPTION Exception at system startup. 0x72D 1837 0x9811072D ADSERR_DEVICE_LICENSEDUPLICATED License file read twice. 0x72E 1838 0x9811072E ADSERR_DEVICE_SIGNATUREINVALID Invalid signature. 0x72F 1839 0x9811072F ADSERR_DEVICE_CERTIFICATEINVALID Invalid certificate. 0x730 1840 0x98110730 ADSERR_DEVICE_LICENSEOEMNOTFOUND Public key not known from OEM. 0x731 1841 0x98110731 ADSERR_DEVICE_LICENSERESTRICTED License not valid for this system ID. 150 Version: 1.17.0 TE1000
## Page 151

Appendix Hex Dec HRESULT Name Description 0x732 1842 0x98110732 ADSERR_DEVICE_LICENSEDEMODENIED Demo license prohibited. 0x733 1843 0x98110733 ADSERR_DEVICE_INVALIDFNCID Invalid function ID. 0x734 1844 0x98110734 ADSERR_DEVICE_OUTOFRANGE Outside the valid range. 0x735 1845 0x98110735 ADSERR_DEVICE_INVALIDALIGNMENT Invalid alignment. 0x736 1846 0x98110736 ADSERR_DEVICE_LICENSEPLATFORM Invalid platform level. 0x737 1847 0x98110737 ADSERR_DEVICE_FORWARD_PL Context – forward to passive level. 0x738 1848 0x98110738 ADSERR_DEVICE_FORWARD_DL Context – forward to dispatch level. 0x739 1849 0x98110739 ADSERR_DEVICE_FORWARD_RT Context – forward to real-time. 0x740 1856 0x98110740 ADSERR_CLIENT_ERROR Client error. 0x741 1857 0x98110741 ADSERR_CLIENT_INVALIDPARM Service contains an invalid parameter. 0x742 1858 0x98110742 ADSERR_CLIENT_LISTEMPTY Polling list is empty. 0x743 1859 0x98110743 ADSERR_CLIENT_VARUSED Var connection already in use. 0x744 1860 0x98110744 ADSERR_CLIENT_DUPLINVOKEID The called ID is already in use. 0x745 1861 0x98110745 ADSERR_CLIENT_SYNCTIMEOUT Timeout has occurred – the remote terminal is not responding in the specified ADS timeout. The route setting of the remote terminal may be configured incorrectly. 0x746 1862 0x98110746 ADSERR_CLIENT_W32ERROR Error in Win32 subsystem. 0x747 1863 0x98110747 ADSERR_CLIENT_TIMEOUTINVALID Invalid client timeout value. 0x748 1864 0x98110748 ADSERR_CLIENT_PORTNOTOPEN Port not open. 0x749 1865 0x98110749 ADSERR_CLIENT_NOAMSADDR No AMS address. 0x750 1872 0x98110750 ADSERR_CLIENT_SYNCINTERNAL Internal error in Ads sync. 0x751 1873 0x98110751 ADSERR_CLIENT_ADDHASH Hash table overflow. 0x752 1874 0x98110752 ADSERR_CLIENT_REMOVEHASH Key not found in the table. 0x753 1875 0x98110753 ADSERR_CLIENT_NOMORESYM No symbols in the cache. 0x754 1876 0x98110754 ADSERR_CLIENT_SYNCRESINVALID Invalid response received. 0x755 1877 0x98110755 ADSERR_CLIENT_SYNCPORTLOCKED Sync Port is locked. 0x756 1878 0x98110756 ADSERR_CLIENT_REQUESTCANCELLED The request was canceled. RTime error codes Hex Dec HRESULT Name Description 0x1000 4096 0x98111000 RTERR_INTERNAL Internal error in the real-time system. 0x1001 4097 0x98111001 RTERR_BADTIMERPERIODS Timer value is not valid. 0x1002 4098 0x98111002 RTERR_INVALIDTASKPTR Task pointer has the invalid value 0 (zero). 0x1003 4099 0x98111003 RTERR_INVALIDSTACKPTR Stack pointer has the invalid value 0 (zero). 0x1004 4100 0x98111004 RTERR_PRIOEXISTS The request task priority is already assigned. 0x1005 4101 0x98111005 RTERR_NOMORETCB No free TCB (Task Control Block) available. The maximum number of TCBs is 64. 0x1006 4102 0x98111006 RTERR_NOMORESEMAS No free semaphores available. The maximum number of semaphores is 64. 0x1007 4103 0x98111007 RTERR_NOMOREQUEUES No free space available in the queue. The maximum number of positions in the queue is 64. 0x100D 4109 0x9811100D RTERR_EXTIRQALREADYDEF An external synchronization interrupt is already applied. 0x100E 4110 0x9811100E RTERR_EXTIRQNOTDEF No external sync interrupt applied. 0x100F 4111 0x9811100F RTERR_EXTIRQINSTALLFAILED Application of the external synchronization interrupt has failed. 0x1010 4112 0x98111010 RTERR_IRQLNOTLESSOREQUAL Call of a service function in the wrong context 0x1017 4119 0x98111017 RTERR_VMXNOTSUPPORTED Intel VT-x extension is not supported. 0x1018 4120 0x98111018 RTERR_VMXDISABLED Intel VT-x extension is not enabled in the BIOS. 0x1019 4121 0x98111019 RTERR_VMXCONTROLSMISSING Missing function in Intel VT-x extension. 0x101A 4122 0x9811101A RTERR_VMXENABLEFAILS Activation of Intel VT-x fails. Specific positive HRESULT Return Codes: TE1000 Version: 1.17.0 151
## Page 152

Appendix HRESULT Name Description 0x0000_0000 S_OK No error. 0x0000_0001 S_FALSE No error. Example: successful processing, but with a negative or incomplete result. 0x0000_0203 S_PENDING No error. Example: successful processing, but no result is available yet. 0x0000_0256 S_WATCHDOG_TIMEOUT No error. Example: successful processing, but a timeout occurred. TCP Winsock error codes Hex Dec Name Description 0x274C 10060 WSAETIMEDOUT A connection timeout has occurred - error while establishing the connection, because the remote terminal did not respond properly after a certain period of time, or the established connection could not be maintained because the connected host did not respond. 0x274D 10061 WSAECONNREFUSED Connection refused - no connection could be established because the target computer has explicitly rejected it. This error usually results from an attempt to connect to a service that is inactive on the external host, that is, a service for which no server application is running. 0x2751 10065 WSAEHOSTUNREACH No route to host - a socket operation referred to an unavailable host. More Winsock error codes: Win32 error codes 152 Version: 1.17.0 TE1000
## Page 153

Appendix 8.2 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com TE1000 Version: 1.17.0 153
## Page 154

Trademark statements Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. Third-party trademark statements Arm, Arm9 and Cortex are trademarks or registered trademarks of Arm Limited (or its subsidiaries or affiliates) in the US and/or elsewhere. Intel, the Intel logo, Intel Core, Xeon, Intel Atom, Celeron and Pentium are trademarks of Intel Corporation or its subsidiaries. Microsoft, Microsoft Azure, Microsoft Edge, Power Shell, Visual Studio, Windows and Xbox are trademarks of the Microsoft group of companies.
## Page 155

More Information: www.beckhoff.com/te1000 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
