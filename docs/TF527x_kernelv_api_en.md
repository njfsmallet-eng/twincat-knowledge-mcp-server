---
title: "TF5270/71"
product: "TF527x"
category: "Motion_Control"
tags: ["NC"]
language: "EN"
document_type: "Manual"
version: "1.1.59"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF527x_kernelv_api_en.pdf"
release_date: "2025-06-05"
---
Manual | EN TF5270/71 | Twin CAT 3 CNC Virtual NCK 6/5/2025 | Version: 1.1.59
## Page 3

Notes on the documentation Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with the applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT technology is patent protected, in particular by the following applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilisation of this document as well as the communication of its contents to others without express authorisation are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 3 Virtual NCK
## Page 4

General and safety instructions General and safety instructions Icons used and their meanings This documentation uses the following icons next to the safety instruction and the associated text. Please read the (safety) instructions carefully and comply with them at all times. Icons in explanatory text 1. Indicates an action. ð Indicates an action statement. DANGER Acute danger to life! If you fail to comply with the safety instruction next to this icon, there is immediate danger to human life and health. CAUTION Personal injury and damage to machines! If you fail to comply with the safety instruction next to this icon, it may result in personal injury or damage to machines. NOTICE Restriction or error This icon describes restrictions or warns of errors. Tips and other notes This icon indicates information to assist in general understanding or to provide additional informa- tion. General example Example that clarifies the text. NC programming example Programming example (complete NC program or program sequence) of the described function or NC com- mand. Specific version information Optional or restricted function. The availability of this function depends on the configuration and the scope of the version. 4 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 5

Table of contents Table of contents Notes on the documentation.................................................................................................................... 3 General and safety instructions.............................................................................................................. 4 1 CNC kernel as DLL kernelv V1.0.25 - introduction............................................................................... 12 2 Description.............................................................................................................................................. 13 2.1 DLL version..................................................................................................................................... 13 2.2 Components.................................................................................................................................... 13 2.3 Dependencies................................................................................................................................. 14 2.3.1 kernelv as of V300........................................................................................................... 14 2.4 Multiple instances............................................................................................................................ 14 2.4.1 Diagnostics with multiple instances.................................................................................. 14 2.5 License protection........................................................................................................................... 15 2.5.1 Licensing under Twin CAT 2............................................................................................. 15 2.5.2 Licensing under Twin CAT 3............................................................................................. 15 2.6 General........................................................................................................................................... 17 2.6.1 Identification of axes and channels.................................................................................. 17 2.6.2 Coordinate systems......................................................................................................... 17 2.7 Use of kernelv................................................................................................................................. 18 2.7.1 Start.................................................................................................................................. 18 2.7.2 Cyclic operation................................................................................................................ 18 2.7.3 End/restart........................................................................................................................ 18 2.7.4 Operation modes of kernelv............................................................................................. 19 2.7.5 Acknowledgement of technology functions...................................................................... 20 2.7.6 Search path for NXC programs........................................................................................ 20 2.7.7 kernelv demo application................................................................................................. 20 2.8 Configuration................................................................................................................................... 24 2.8.1 Path of the configuration lists........................................................................................... 24 2.9 Error message texts........................................................................................................................ 24 2.10 Tool management........................................................................................................................... 25 3 kernelv API functions............................................................................................................................. 26 3.1 kernelv_get_api_version()............................................................................................................... 26 3.2 kernelv_get_cnc_version().............................................................................................................. 27 3.3 kernelv_get_cycletime().................................................................................................................. 28 3.4 kernelv_startup()............................................................................................................................. 29 3.5 kernelv_startup_instance().............................................................................................................. 30 3.6 kernelv_do_cycle().......................................................................................................................... 31 3.7 kernelv_ch_program_start()............................................................................................................ 32 3.8 kernelv_ch_reset().......................................................................................................................... 33 3.9 kernelv_ch_suspend()..................................................................................................................... 34 3.10 kernelv_ch_resume()...................................................................................................................... 35 3.11 kernelv_ch_get_override().............................................................................................................. 36 3.12 kernelv_ch_set_override()............................................................................................................... 37 3.13 kernelv_ch_get_blocknumber()....................................................................................................... 38 3.14 kernelv_ch_get_filename().............................................................................................................. 39 TF5270/71 | Twin CAT 3 CNC Version: 5 Virtual NCK
## Page 6

Table of contents 3.15 kernelv_ch_get_programname()..................................................................................................... 40 3.16 kernelv_ch_get_state().................................................................................................................... 41 3.17 kernelv_ch_get_fileoffset().............................................................................................................. 42 3.18 kernelv_ch_get_techno_data()........................................................................................................ 43 3.19 kernelv_ch_get_new_techno_data()............................................................................................... 44 3.20 kernelv_ch_get_techno_data2()...................................................................................................... 45 3.21 kernelv_ch_get_new_techno_data2()............................................................................................. 46 3.22 kernelv_ch_get_finished_nc_lines()................................................................................................ 47 3.23 kernelv_ax_get_techno_data()........................................................................................................ 48 3.24 kernelv_ax_get_new_techno_data()............................................................................................... 49 3.25 kernelv_ax_get_techno_data2()...................................................................................................... 50 3.26 kernelv_ax_get_new_techno_data2()............................................................................................. 51 3.27 kernelv_ax_set_position()............................................................................................................... 52 3.28 kernelv_get_acs_command_positions().......................................................................................... 53 3.29 kernelv_get_acs0_command_positions()........................................................................................ 54 3.30 kernelv_get_acs_actual_positions()................................................................................................ 55 3.31 kernelv_get_acs_target_positions()................................................................................................ 56 3.32 kernelv_get_acs_start_positions().................................................................................................. 57 3.33 kernelv_get_wcs_command_positions()......................................................................................... 58 3.34 kernelv_get_wcs_target_positions()................................................................................................ 59 3.35 kernelv_get_wcs_start_positions().................................................................................................. 60 3.36 kernelv_get_prg_target_positions()................................................................................................. 61 3.37 kernelv_get_axis_channel_number().............................................................................................. 62 3.38 kernelv_ch_get_variable_value().................................................................................................... 63 3.39 kernelv_ch_set_variable_value().................................................................................................... 65 3.40 kernelv_get_channel_count().......................................................................................................... 67 3.41 kernelv_get_axis_count()................................................................................................................ 68 3.42 kernelv_sync_read_request().......................................................................................................... 69 3.43 kernelv_sync_write_request()......................................................................................................... 70 3.44 kernelv_sync_read_write_req()....................................................................................................... 72 3.45 kernelv_get_axis_names().............................................................................................................. 74 3.46 kernelv_control_techno_func_duration()......................................................................................... 76 3.47 kernelv_ch_set_techno_func_duration()......................................................................................... 77 3.48 kernelv_ch_set_techno_func_user_ackn()..................................................................................... 78 3.49 kernelv_ch_ackn_techno_func()..................................................................................................... 79 3.50 kernelv_ax_ackn_techno_func()..................................................................................................... 80 3.51 kernelv_get_license_info().............................................................................................................. 81 3.52 kernelv_set_options()...................................................................................................................... 82 3.53 kernelv_ch_get_decoder_positions().............................................................................................. 83 3.54 kernelv_ch_get_prog_start_mode()................................................................................................ 84 3.55 kernelv_ch_set_cont_visu_grid().................................................................................................... 85 3.56 kernelv_ch_set_cont_visu_rel_curvature_error()............................................................................ 86 3.57 kernelv_ch_set_cont_visu_abs_curvature_error().......................................................................... 87 3.58 kernelv_ch_get_cont_visu_data()................................................................................................... 88 3.59 kernelv_ch_get_active_g_codes().................................................................................................. 89 3.60 kernelv_get_active_g_group()......................................................................................................... 90 6 Version: TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 7

Table of contents 3.61 kernelv_ch_get_command_feed()................................................................................................... 91 3.62 kernelv_ch_get_active_feed()......................................................................................................... 92 3.63 kernelv_set_call_ratio()................................................................................................................... 93 3.64 CNC error messages with kernelv.................................................................................................. 94 3.64.1 Language of error messages........................................................................................... 94 3.64.2 Read out error message in the form of a string kernelv_get_error()................................ 96 3.64.3 General information on error messages........................................................................... 97 3.64.4 Error messages caused by NC programs...................................................................... 106 3.65 Coordinate systems and offsets.................................................................................................... 111 3.65.1 kernelv_ch_get_cs_name()............................................................................................ 112 3.65.2 kernelv_ch_get_cs_rot_matrix()..................................................................................... 113 3.65.3 kernelv_ch_get_cs_shift_vector().................................................................................. 114 3.65.4 kernelv_ch_get_cs_count()............................................................................................ 115 3.65.5 kernelv_ch_get_active_cs_index()................................................................................. 115 3.65.6 kernelv_ch_axis_get_offsets()....................................................................................... 116 3.65.7 kernelv_ch_get_total_cs_rot_matrix()............................................................................ 117 3.65.8 kernelv_ch_get_total_cs_offset...................................................................................... 118 3.65.9 kernelv_ch_get_total_cs_def()....................................................................................... 119 3.65.10 kernelv_ch_get_coord_sys_active()............................................................................... 120 3.66 Kinematic transformations............................................................................................................. 120 3.66.1 kernelv_ch_get_kin_trafo_active()................................................................................. 120 3.66.2 kernelv_ch_get_active_kin_id()...................................................................................... 121 3.67 External measuring hardware....................................................................................................... 121 3.67.1 kernelv_ax_get_ext_latch_command().......................................................................... 123 3.67.2 kernelv_ax_acknowledge_ext_latch_command().......................................................... 124 3.67.3 kernelv_ax_set_ext_latch_event_pos().......................................................................... 124 3.67.4 kernelv_ax_set_ext_latch_event()................................................................................. 125 3.68 kernelv_ch_get_timer()................................................................................................................. 126 3.69 kernelv_get_production_time()...................................................................................................... 126 3.70 kernelv_diagnosis_upload().......................................................................................................... 127 3.71 kernelv_ch_get_status_singularity_avoidance()........................................................................... 127 4 kernelv API types.................................................................................................................................. 129 4.1 Enum KERNELV_RETURN.......................................................................................................... 129 4.2 KERNELV_CHANNEL_STATE..................................................................................................... 131 4.3 Enum E_KERNELV_TECHNO_TYPE.......................................................................................... 133 4.4 Struct KERNELV_TECHNO_DATA.............................................................................................. 133 4.5 KERNELV_CHANNEL_TECHNO_DATA_ARRAY....................................................................... 134 4.6 KERNELV_CHANNEL_TECHNO_DATA_ARRAY2..................................................................... 135 4.7 KERNELV_AXIS_TECHNO_DATA_ARRAY................................................................................ 136 4.8 Struct KERNELV_TECHNO_DATA2............................................................................................ 136 4.9 KERNELV_CHANNEL_TECHNO_DATA_ARRAY2..................................................................... 137 4.10 KERNELV_AXIS_TECHNO_DATA_ARRAY2.............................................................................. 138 4.11 Union U_KERNELV_TECHNO_PARAM...................................................................................... 138 4.12 Union U_KERNELV_TECHNO_PARAM2.................................................................................... 139 4.13 Struct M_H_CODE_DATA............................................................................................................ 139 4.14 Struct M_H_CODE_DATA2.......................................................................................................... 139 TF5270/71 | Twin CAT 3 CNC Version: 7 Virtual NCK
## Page 8

Table of contents 4.15 Enum E_KERNELV_SPINDLE_TYPE.......................................................................................... 139 4.16 Struct S_CODE_DATA................................................................................................................. 140 4.17 Struct T_CODE_DATA.................................................................................................................. 141 4.18 Struct KERNELV_NC_LINE_DATA.............................................................................................. 141 4.19 Enum E_KERNELV_VAR_TYPE.................................................................................................. 142 4.20 Union U_KERNELV_VAR_VALUE............................................................................................... 143 4.21 Struct KERNELV_VARIABLE....................................................................................................... 144 4.22 Struct KERNELV_NC_LINE_DATA.............................................................................................. 144 4.23 Struct KERNELV_LICENSE_INFO............................................................................................... 145 4.24 Struct KERNELV_DECODER_POSITION_HEADER................................................................... 145 4.25 Struct KERNELV_DECODER_POSITION_DATA........................................................................ 146 4.26 Enum E_KERNELV_PROG_START_MODE............................................................................... 146 4.27 Struct ACTIVE_G_CODES........................................................................................................... 146 4.28 Enum E_KERNELV_G_GROUP_TYPE....................................................................................... 147 4.29 Data types of contour visualisation............................................................................................... 149 4.29.1 Struct CONTOUR_VISU................................................................................................ 149 4.29.2 Union CONTOUR_VISU_DATA..................................................................................... 150 4.29.3 Struct CONTOUR_VISU_DATA_V0.............................................................................. 150 4.29.4 Struct CONTOUR_VISU_DATA_V1.............................................................................. 151 4.29.5 Struct CONTOUR_VISU_DATA_V2.............................................................................. 151 4.29.6 Struct CONTOUR_VISU_DATA_V3.............................................................................. 151 4.29.7 Struct CONTOUR_VISU_DATA_V4.............................................................................. 152 4.29.8 Struct CONTOUR_VISU_DATA_V5.............................................................................. 152 4.29.9 Struct CONTOUR_VISU_DATA_V6.............................................................................. 152 4.29.10 Struct CONTOUR_VISU_DATA_V7.............................................................................. 153 4.29.11 Struct CONTOUR_VISU_DATA_V8.............................................................................. 153 4.29.12 Struct CONTOUR_VISU_DATA_V9.............................................................................. 153 4.29.13 Struct CONTOUR_VISU_DATA_V10............................................................................ 154 4.29.14 Struct CONTOUR_VISU_DATA_V11............................................................................ 154 4.29.15 Struct CONTOUR_VISU_CH_DATA............................................................................. 155 4.29.16 Struct CONTOUR_VISU_CH_DATA_V1....................................................................... 156 4.29.17 Struct CONTOUR_VISU_CH_DATA_V2....................................................................... 157 4.29.18 Struct CONTOUR_AXIS_DATA..................................................................................... 157 4.29.19 Struct CONTOUR_AXIS_DATA_V1.............................................................................. 158 4.29.20 Struct CONTOUR_AXIS_DATA_V2.............................................................................. 158 4.29.21 Enum E_CONTOUR_TECHNO_TYPE.......................................................................... 158 4.29.22 Struct CONTOUR_M_H_PROCESS............................................................................. 159 4.29.23 Struct CONTOUR_M_H_PROCESS_V1....................................................................... 159 4.29.24 Enum E_CONTOUR_S_CMD........................................................................................ 159 4.29.25 Struct CONTOUR_S_PROCESS................................................................................... 160 4.29.26 Struct CONTOUR_TOOL_PROCESS........................................................................... 160 4.29.27 Struct CONTOUR_DATA_TECHNO.............................................................................. 160 4.29.28 Struct CONTOUR_DATA_TECHNO_V1....................................................................... 161 4.30 Data types of error output............................................................................................................. 162 4.30.1 Struct KERNELV_ERROR_VALUE............................................................................... 162 4.30.2 KERNELV_ERROR_VALUE_ARRAY........................................................................... 162 8 Version: TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 9

Table of contents 4.30.3 Enum E_KERNELV_ERR_VAL_TYPE.......................................................................... 163 4.30.4 Enum E_KERNELV_ERR_VAL_DIMENSION............................................................... 164 4.30.5 Enum E_KERNELV_ERR_VAL_MEANING.................................................................. 165 4.30.6 Enum E_KERNELV_ERROR_LANGUAGE................................................................... 166 4.31 Enum KERNELV_AXIS_OFFSET_TYPES................................................................................... 167 4.32 External measuring hardware....................................................................................................... 168 4.32.1 Struct KERNELV_EXT_LATCH_COMMAND_DATA..................................................... 168 4.32.2 Enum E_KERNELV_EXT_LATCH_ORDER.................................................................. 168 4.32.3 E_KERNELV_MEAS_ACTIVE_EDGE........................................................................... 168 4.33 Production time calculation........................................................................................................... 169 5 kernelv API constants........................................................................................................................... 170 5.1 KERNELV_VAR_STRING_LEN................................................................................................... 170 5.2 KERNELV_FILE_NAME_LENGTH............................................................................................... 170 5.3 KERNELV_VAR_NAME_LENGTH............................................................................................... 170 5.4 KERNELV_OPTION_LICENSE_CHECK_VERBOSE.................................................................. 170 5.5 CONTOUR_MAX_DATA_V0........................................................................................................ 170 5.6 CONTOUR_MAX_DATA_V1........................................................................................................ 171 5.7 CONTOUR_MAX_DATA_V2........................................................................................................ 171 5.8 CONTOUR_MAX_DATA_V3........................................................................................................ 171 5.9 CONTOUR_MAX_DATA_V4........................................................................................................ 171 5.10 CONTOUR_MAX_DATA_V5........................................................................................................ 171 5.11 CONTOUR_MAX_DATA_V6........................................................................................................ 172 5.12 CONTOUR_MAX_DATA_V7........................................................................................................ 172 5.13 CONTOUR_MAX_DATA_V8........................................................................................................ 172 5.14 CONTOUR_MAX_DATA_V9........................................................................................................ 172 5.15 CONTOUR_MAX_DATA_V10...................................................................................................... 172 5.16 CONTOUR_MAX_DATA_V11...................................................................................................... 173 5.17 CONTOUR_MAX_M_H_DATA..................................................................................................... 173 5.18 CONTOUR_MAX_SPDL_DATA................................................................................................... 173 5.19 CONTOUR_AXIS_PER_CHANNEL............................................................................................. 173 5.20 KERNELV_ERROR_VALUE_COUNT.......................................................................................... 173 5.21 KERNELV_ERR_MSG_ STRING_LENGTH................................................................................ 174 5.22 KERNELV_CHANNEL_TECHNO_DATA_COUNT....................................................................... 174 5.23 KERNELV_AXIS_TECHNO_DATA_COUNT................................................................................ 174 5.24 KERNELV_ERROR_VALUE_COUNT.......................................................................................... 174 5.25 KERNELV_INSTANCE_PREFIX_MAX_LEN............................................................................... 175 6 Support and Service............................................................................................................................. 176 Index....................................................................................................................................................... 177 TF5270/71 | Twin CAT 3 CNC Version: 9 Virtual NCK
## Page 10

Table of contents 10 Version: TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 11

List of figures List of figures Fig. 1 Select a Twin CAT 3 trial license.................................................................................................. 16 Fig. 2 Activate a Twin CAT 3 trial license................................................................................................ 16 Fig. 3 The start screen of the demo application..................................................................................... 22 Fig. 4 Display axis positions in demo application................................................................................... 23 Fig. 5 Schematic sequence of a measurement run................................................................................ 122 Fig. 6 Signal profile of a radio measuring button with measured value detected in the drive................ 123 Fig. 7 State diagram of a CNC channel................................................................................................. 132 TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 11 Virtual NCK
## Page 12

CNC kernel as DLL kernelv V1.0.25 - introduction 1 CNC kernel as DLL kernelv V1.0.25 - introduction The ISG CNC kernel is integrated into a real-time environment for a standard CNC to arrive at real time- enable, deterministic behaviour. However, the real-time environment is not required for many applications in the environment of a CNC controller such as: • production time calculation, • advance collision checking or • a visualisation. The kernelv CNC simulation DLL provides users with an opportunity to use a virtual CNC within their own non-real time application. With regard to existing functionality, the simulation DLL largely offers the same possibilities as the real-time kernel. Known restrictions: • No access to hardware. • The CNC treats axes as simulation axes. • A PLC cannot be used and the API interfaces use the HLI to command the CNC kernel. • No real time necessary or possible. Mandatory note on references to other documents For the sake of clarity, links to other documents and parameters are abbreviated, e.g. [PROG] for the Programming Manual or P-AXIS-00001 for an axis parameter. For technical reasons, these links only function in the Online Help (HTML5, CHM) but not in pdf files since pdfs do not support cross-linking. 12 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 13

Description 2 Description 2.1 DLL version This description refers to the API version of the simulation DLL referred to in the document title. You can query the DLL version string by means of the kernelv_get_api_version() function. 2.2 Components The simulation DLL consists of 3 components: 1. the simulation DLL kernelv_mt.dll 2. the header file kernelv.h 3. the lib file kernelv_mt.lib for implicit linking. A valid license is also required to use the DLL. Diagnosis The “ahmi.exe” program is included for diagnostic purposes. This program calls internal diagnostic data from the kernelv DLL and saves it to a text file. The ahmi.exe program is only intended for diagnostic purposes and should not be used as a user interface for the kernelv DLL. In addition, the internal diagnosis data is also stored in a file linked to the kernelv_diagnosis_upload() [} 127] function. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 13 Virtual NCK
## Page 14

Description 2.3 Dependencies Use of the kernel DLL is linked to dependencies with components produced by other manufacturers. 2.3.1 kernelv as of V300 The following additional DLLs must be available on the application computer in order to use the kernelv DLL. • Tc Ads Dll. DLL The relevant version of this DLL is used depending on the version of the kernelv DLL (32-bit or 64-bit). • VCRUNTIME140. DLL The Tc Ads Dll. DLL file is automatically installed when Twin CAT is installed. If VCRUNTIME140. DLL is missing, it indicates that “Visual C++ Re-distributable for Visual Studio 2015/2017/2019” should be installed. These packets can be downloaded free of charge from Microsoft©. Please check that you install the correct version (32-bit or 64-bit). 2.4 Multiple instances Only one kernelv instance can be started per application. However, it is possible to run several applications on the same PC each with one kernelv instance. If an attempt is made to start 2 instances of kernelv within an application, e.g. by 2 calls of kernelv_startup() or kernelv_startup_instance(), the start of the 2nd instance is prevented and the error code ERR_DOUBLE_INSTANCE is returned. To start several kernelv instances, use the function kernelv_startup_instance(). In this case, the transferred instance identifier must be unique on the computer for every kernelv instance started. If an attempt is made to start 2 kernelv instances with the same instance identifier, the start of the 2nd instance is prevented and the error code ERR_DOUBLE_KERNEL is returned.. 2.4.1 Diagnostics with multiple instances The ahmi.exe program can also be used for diagnostic purposes with several instances of kernelv DLL. When the ahmi.exe program is started, it must be specified which kernelv DLL instance is to be connected. There are 2 options for this: 1. Specify the instance identifier as command line parameter at program start. Here, use kernelv_star- tup_instance() [} 30] to specify the same instance identifier as used at the start of the kernelv in- stance. The kernelv instance is specified by the parameter –instance_prefix. Example: ahmi.exe -instance_prefix 1_ 2. The command line parameter –query_instance_prefix specifies the instance identifier of the kernelv instance at program start. Example: ahmi.exe -query_instance_prefix The function kernelv_diagnosis_upload() [} 127] starts the upload of diagnosis data for the instance containing the function call. 14 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 15

Description 2.5 License protection The DLL and all related functions are only available in Twin CAT systems. A valid license is required to use the DLL. As of CNC Build V3.1.3104.01 at least one basic license is required in order to use the DLL. Use only via an option package is not possible The kernelv_startup() checks for the presence of a license when the simulation kernel is started. If a valid license is not found, the start of the simulation kernel is aborted and the error code ERR_NO_LICENSE is returned. If errors occur on accessing license information, the error code ERR_REGISTRY_ACCESS is returned. This may occur if • VNCK was incorrectly installed under Twin CAT 2 or • no trial license was generated under Twin CAT 3. In addition, license packs are also required to used certain functions, e.g. transformations or when the number of axes is > 8. The presence of these license packs is checked during kernelv runtime and if necessary a CNC error message is output. 2.5.1 Licensing under Twin CAT 2 Under Twin CAT 2 the license information is written to the Windows registry when the VNCK is installed. This information is then requested from there when the kernelv DLL is started. After installation no further action need be taken by the user. 2.5.2 Licensing under Twin CAT 3 Twin CAT 3 trial license As for all other Twin CAT 3 software modules, a 7-day trial license can be generated for the kernelv DLL. However, in this case a Twin CAT installation must be present on the computer. Take the following actions to generate the trial license: 1. Start Twin CAT XAE. 2. Generate a new empty Twin CAT project. 3. Select the System\License node on the left-hand side of the Twin CAT XAE in the tree view. 4. In the tab view then displayed, select the ‘Manage Licenses’ tab and select the options 'TC3 CNC Vir- tual NCK Basis' (TF5270) and eventually 'TC3 CNC Virtual NCK Options' from the options list. 5. Activate the trial license by clicking the '7 Days Trial License' in the 'Order Information (Runtime)' tab and enter the security code required. Twin CAT 3 perpetual license Request a perpetual license using the standard practice in Twin CAT 3. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 15 Virtual NCK
## Page 16

Description Using kernelv DLL with license check When the CNC kernel is started with the kernelv_startup() function, the required license information is requested from the Twin CAT license server. Communication between the CNC kernel and the license server takes place via ADS. It is therefore necessary for the application using kernelv DLL to have access to the Tc Ads Dll.dll library. This library is included in the Twin CAT installation. Fig. 1: Select a Twin CAT 3 trial license Fig. 2: Activate a Twin CAT 3 trial license 16 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 17

Description 2.6 General 2.6.1 Identification of axes and channels Channel identification Channels are identified by their index on the PLC interface. The sequence of channels corresponds to the configuration sequence. The channel first configured is addressed by the index 0 and the last channel configured out of n channels is addressed by the index n – 1. If an invalid channel index is transferred to a function, the return value ERR_INVALID_CHAN (defined in kernelv.h) is returned. If functions supply channel numbers as the return value, the associated channel index can be determined by means of the relationship channel index = channel number - 1 . Axis identification Axes are identified by their index on the PLC interface. The sequence of axes corresponds to the configuration sequence. The axis first configured is addressed by the index 0 and the last axis configured out of n axes is addressed by the index n – 1. If an invalid axis index is transferred to a function, the return value ERR_INVALID_AX (defined in kernelv.h) is returned. 2.6.2 Coordinate systems ACS coordinates ACS coordinates (ACS = axis coordinate system) are regarded as the coordinates of the physical axes. Function names of functions that return ACS coordinates start with the prefix "kernelv_get_acs_" WCS coordinates WCS coordinates (WCS = workpiece coordinate system) are regarded as the programming coordinate system. The programming coordinate system can be shifted and rotated relative to the axis coordinate system, e.g. by reference point offsets and the definition of machining coordinate systems. The names of functions that return WCS coordinates start with the prefix "kernelv_get_wcs_" Dimensions Position values have a resolution of 0.1 µm for translatory axes or 1x10-4-4° for spindles or modulo axes. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 17 Virtual NCK
## Page 18

Description 2.7 Use of kernelv The DLL can be used by a user application by both implicit and explicit (dynamic) linking. Requirements for Twin CAT 3 With kernelv versions produced for a Twin CAT 3 environment (Build number of CNC version >= 3000), the application using the kernelv DLL must have access to the Twin CAT Tc Ads Dll.dll library. This library is installed when the Twin CAT is installed. 2.7.1 Start kernelv_startup() The simulation CNC is started by calling the API function kernelv_startup(). Call parameters are the cycle time in microseconds and the number of axes and channels. The function returns the value RET_FINISHED if the start of the simulation CNC was successful, otherwise an error code is displayed. Only one instance of the simulation CNC can ever run on the same computer at the same time. The error code ERR_DOUBLE_KERNEL is returned whenever the kernelv_startup() function is called while an instance of the simulation CNC is still running. A valid license is also required to use the simulation CNC. If no valid license is found when the simulation CNC is started, the start of the simulation CNC is cancelled and the error code ERR_NO_LICENSE is returned. 2.7.2 Cyclic operation kernelv_do_cycle() When the kernelv_do_cycle() function is called, one cycle of the simulation CNC is computed for all channels. The cycle time transferred when the simulation CNC is started is used as the cycle time. A call in real time is not necessary. 2.7.3 End/restart Currently no API function is available to end the simulation CNC. If the simulation CNC needs to be restarted, the DLL can be cancelled if it is linked dynamically and it can then be reloaded. The simulation CNC can then be restarted. 18 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 19

Description 2.7.4 Operation modes of kernelv An NC program can be started in 2 different channel operation modes. Depending on the operation mode, the kernelv DLL has different functions available. The operation mode can be specified for specific channels and this must be specified at program start. Currently, the following operation modes are available: Name E_KERNELV_PROG_START_MODE Meaning Normal operation mode KERNELV_START_MODE_NORMAL Normal operation mode; axis motions are interpolated at the correct velocity and the movement of the physical axes is simulated. Command contour KERNELV_START_MODE_CONTOU Command contour visualisation visualisation R_VISU operation mode; interpolation vertices are only calculated depending on the visualisation grid set. Normal operation mode In normal operation mode the NC program is interpolated at the cycle time specified at the start of the kernelv DLL. The interpolation data generated corresponds to the data of a controller running in real time. The dynamic limits set for the axes are maintained. Command contour visualisation operation mode Compared to normal operation mode, the command contour visualisation operation mode generates an approximate vertex sequence in order to visualise the programmed contour rapidly. The output grid can be set for straight and curved contour elements with the functions kernelv_ch_set_cont_visu_grid(), kernelv_ch_set_cont_visu_rel_curvature_error() and kernelv_ch_set_cont_visu_abs_curvature_error() . The end points of a motion block are always output, irrespective of the output grid set. The approximate output grid is obtained by calculating the velocity at which the contour element is interpolated in order to obtain the output grid set. For this reason the dynamic axis data is not maintained. In the same way, the interpolated command values are not transferred to the position controller with the result that the ACS coordinates do not change in this operation mode. Select an operation mode The operation mode must be specified when the kernelv_ch_program_start() function is called. kernelv_ch_program_start (0, prog_name, KERNELV_START_MODE_NORMAL); Contour visualisation output data The vertices calculated in the contour visualisation operation mode are written to a FIFO memory and read by the function kernelv_ch_get_cont_visu_data(). To avoid losing visualisation data, the interpolation is stopped when the internal FIFO is full. To execute an NC program as fast as possible, the kernelv_ch_get_cont_visu_data() function must be called a sufficient number of times. Output format of contour visualisation The data output when contour visualisation is active can be set system global by the parameter contour_visu_ifc_version (P-STUP-00039) in the start-up list. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 19 Virtual NCK
## Page 20

Description Depending on the interface version set, the format of the data returned by the function kernelv_ch_get_cont_visu_data() changes. See also the structure definition of CONTOUR_VISU. Interpolated WCS coordinates can be read by the functions kernelv_get_wcs_. 2.7.5 Acknowledgement of technology functions Technology functions (such as M or H functions) are used to exchange information between the NC program and the software components in the environment (such as SPS) during a real CNC control. This includes the actual technology information output by the CNC as well as acknowledgements transferred by the software components in the environment to the CNC to synchronise program sequences within and outside of the CNC. When an NC program is processed, these synchronisations can lead to delays in the processing of the NC program. Default behaviour All technology functions output are immediately automatically acknowledged by the kernel V-DLL. Execution time simulation In order to consider the execution time for the execution of an NC program, the API function kernelv_control_techno_func_duration() [} 76] can be used to activate the execution time simulation for the technology functions. When the execution time simulation is activated, technology functions are automatically acknowledged after an adjustable time period. The execution time can be set by means of the kernelv_ch_set_techno_func_duration() [} 77] function or by means of entries in the channel parameter list (P-CHAN-00040, P-CHAN-00026). User acknowledgement By means of the user acknowledgement, the user himself has full control over the time of acknowledgement of the technology function. For this purpose, the execution time simulation must first be acknowledged by invoking the function kernelv_control_techno_func_duration() [} 76]. Technology functions for which user acknowledgement is to be activated must be marked using the function kernelv_ch_set_techno_func_user_ackn() [} 78]. All other technology functions are acknowledged after the respective execution time is over. The functions kernelv_ch_get_new_techno_data() [} 44] or kernelv_ax_get_new_techno_data() [} 49] have to be invoked to check if the respective technology function has been output. At the time of acknowledgement, the technology function must be acknowledged by invoking the function kernelv_ch_ackn_techno_func() [} 79] or kernelv_ax_ackn_techno_func() [} 80]. 2.7.6 Search path for NXC programs NC programs are sought relative to the application's start directory. Additionally, search paths for programs and global subroutines can be specified in the start-up list (see CNC kernel documentation). 2.7.7 kernelv demo application As an example for use of the kernelv DLL, a demo application including a demo parameter set is available in which the kernelv DLL is explicitly loaded. Users have the option to start NC programs and display axis positions via a simple ASCII user interface. 20 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 21

Description The demo application is delivered in a zip archive. The actual kernelv DLL is supplied in a separate installation and is not included in the zip archive. 2.7.7.1 Project structure The following folder structure is created when the demo application is unpacked: kernelv_demo | ├----\listen └----\prg The kernelv_demo directory contains the following files: kernelv_demo.dsw, Project files, demo application Visual Studio 6 kernelv_demo.dsp kernelv_demo.c C source text of the demo application err_text_version.txt File containing error message texts kernelv_demo.bat Batch file for starting the demo application (debug version). The configuration lists of the CNC kernel are saved in the subdirectory \listen. The subdirectory \prg contains a simple example program. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 21 Virtual NCK
## Page 22

Description 2.7.7.2 Use of the demo application The following steps are required to use the demo application: 1. Unpack the demo. 2. Copy the kernelv DLL and kernelv.h to the kernelv_demo directory that was created when unpacked. 3. Compile and start the project. It can be started either in the Visual Studio debugger or by means of the kernelv_demo.bat file. Start screen After start, the screen below is displayed: Fig. 3: The start screen of the demo application Keyboard commands Input Effect S Starts the program. If no program name is specified, an attempt is made to start the NC program 'test1.nc’. A search for this is made in the './prg' directory. R Executes CNC reset. P Reads out and displays axis positions. Q Quits the application 'Enter' Status display 22 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 23

Description Display axis positions The screen below appears after the supplied test program is executed and the axis positions are displayed: Fig. 4: Display axis positions in demo application 2.7.7.3 Explanations about demo application All steps required to use the kernelv DLL are executed in the demo application source code. Refer to the respective compiler documentation for further information on the operating system functions called. Load DLL: h Dll = Load Library(dll_name); Query function pointers: if ( !(p Cycle = (KERNELV_CYCLE) Get Proc Address(h Dll, "kernelv_do_cycle")) ) { printf("Missing pointer to kernelv_do_cycle()\n"); return -2; } If the requested symbol is not defined in the DLL, a message is output and the application ends. Refer to the section 'kernelv API' in this document for details on how to use individual functions. Main loop for handling user inputs and cyclic call of kernelv_do_cycle(). One CNC cycle is computed: (p Cycle)(); TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 23 Virtual NCK
## Page 24

Description 2.8 Configuration In the current version of the simulation DLL, the CNC kernel is configured by ASCII lists. These ASCII lists can be generated from a Twin CAT configuration file by the “Listenexporteur” (list exporter) program. 2.8.1 Path of the configuration lists Start-up file The start-up file contains the basic configuration of the CNC kernel, e.g.: • number of axes, • number of channels and • the access path to the various axis- or channel-specific configuration files. The path and file name of the start-up file (default: hochlauf.lis) must be transferred to the API function kernelv_startup. You must specify the access paths to other parameter lists in the start-up list: • Relative paths within the start-up list must be specified relative to the start-up list storage location. • Absolute paths are adopted without change. You are advised to generate the parameter lists either by exporting the lists in the Twin CAT system manager or by using the 'Listenexporteur' tool. 2.9 Error message texts Assign error message number to error message text When an error message is output, the CNC kernel only outputs an error message code together with several parameters. An error message text is not assigned until later. Each error message number is assigned to an error message text by the 'err_text_version.txt' file. When English is used, this file is ‘err_text_version_en.txt’. You can change the language using the kernelv_set_error_language () [} 94] function. The file must be located in the work directory of the application that uses the simulation DLL. 24 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 25

Description 2.10 Tool management Internal/external tool management When the CNC kernel is used as simulation DLL, both internal and external tool management can be used (toggle by using P-CHAN-00016). Tool data With internal tool management, tool data is saved to the tool data list channel-specific. When external tool management is used, tool data is always managed globally for the entire CNC: In this case, tool data must be entered in the tool data list of the 1st channel. The access path to the tool data list must be specified in the start-up list. The tool data list format is described in [TOOL]. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 25 Virtual NCK
## Page 26

kernelv API functions 3 kernelv API functions 3.1 kernelv_get_api_version() Prototype KERNELV_RETURN kernelv_get_api_version (char* version String, unsigned long max String Length, unsigned long* return Size); Description Reads the API version string. Parameter Name Type Meaning version String char* Pointer to the version string storage location. The application must provide sufficient memory. max String Length unsigned long Length of the memory provided by the application (in bytes). return Size unsigned long* Length of the version string returned. The value 0 is returned if an error has occurred. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of required bytes including the terminating zero is returned in the return Size parameter. 26 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 27

kernelv API functions 3.2 kernelv_get_cnc_version() Prototype KERNELV_RETUR kernelv_get_cnc_version(char* version String, N unsigned long max String Length, unsigned long* return Size); Description Reads the CNC version string. Parameter Name Type Meaning version String char* Pointer to the version string storage location. The application must provide sufficient memory. max String Length unsigned long Length of the memory provided by the application (in bytes). return Size unsigned long* Length of the version string returned. The value 0 is returned if an error has occurred. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. err_text_version.txt -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of required bytes including the terminating zero is returned in the return Size parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 27 Virtual NCK
## Page 28

kernelv API functions 3.3 kernelv_get_cycletime() Prototype KERNELV_RETUR kernelv_get_cycletime (unsigned long* cycle Time); N Description Reads the CNC cycle time. Parameter Name Type Meaning cycle Time unsigned long* Cycle time us. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 28 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 29

kernelv API functions 3.4 kernelv_startup() Prototype KERNELV_RETUR kernelv_startup( unsigned long cycle Time, N char* startup File); Description Starts the simulation CNC. Parameter Name Type Meaning cycle Time unsigned long Cycle time in µs. startup File char * Path and name of the start-up file. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_DOUBLE_KERNEL -6 An instance of the simulation CNC is already running. ERR_SHM_STARTUP -7 Internally used shared memories could not be created when the CNC kernel was started. ERR_STARTUP -8 An error occurred on starting the simulation CNC. Possible causes are missing parameter lists or incorrect entries in parameter lists. ERR_NO_LICENSE -17 No license was found for the use of the kernelv DLL. ERR_REGISTRY_ACCESS -19 An error occurred when an attempt was made to read values from the Windows registry. ERR_PREFIX_TOO_LONG -23 When the function kernelv_startu_prefix() was called, the transferred instance identifier is too long with the result that the internally generated names for the shared memories used no longer fit in the memory provided. ERR_STARTUP_CHAN_INIT -31 When kernelev Dll was started, it was not possible to execute the initialisation of the configured NC channels. Depending on the number of axes and channels in the configuration used, the start of the CNC ker- nel may take 20 - 30 seconds. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 29 Virtual NCK
## Page 30

kernelv API functions 3.5 kernelv_startup_instance() Prototype KERNELV_RETUR kernelv_startup_instance (unsigned long cycle Time, N char* startup File char* instance Prefix); Description Start the simulation CNC: This function permits several applications to run on one computer. Each application uses a single and therefore a separate instance of the kernelv DLL. Here, a unique instance identifier must be transferred in the call parameter instance Prefix and is valid for the entire computer. The maximum length of the string that may be transferred as an instance identifier is defined by the constant KERNELV_INSTANCE_PREFIX_MAX_LEN. If a longer string is transferred, the start-up is not executed and the function returns the value ERR_PREFIX_TOO_LONG (-23). It is not possible to run several instances of the kernelv DLL in one application. Parameter Name Type Meaning cycle Time unsigned long Cycle time in µs. startup File char * Path and name of the start-up file. instance Prefix char * Unique instance identifier. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_DOUBLE_KERNEL -6 An instance of the simulation CNC is already running. ERR_SHM_STARTUP -7 Internally used shared memories could not be created when the CNC kernel was started. ERR_STARTUP -8 An error occurred on starting the simulation CNC. Possible causes are missing parameter lists or incorrect entries in parameter lists. ERR_NO_LICENSE -17 No license was found for the use of the kernelv DLL. ERR_REGISTRY_ACCESS -19 An error occurred when an attempt was made to read values from the Windows registry. ERR_PREFIX_TOO_LONG -23 When the function kernelv_startu_prefix() was called, the transferred instance identifier is too long with the result that the internally generated names for the shared memories used no longer fit in the memory provided. ERR_STARTUP_CHAN_INIT -31 When kernelev-Dll was started, it was not possible to execute the initialisation of the configured NC channels. Depending on the number of axes and channels in the configuration used, the start of the CNC ker- nel may take 20 - 30 seconds. 30 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 31

kernelv API functions 3.6 kernelv_do_cycle() Prototype KERNELV_RETUR kernelv_do_cycle(); N Description Computes one simulation CNC cycle. The cycle time transferred as a parameter at the start is used for the internal calculations. If an error should occur in the simulation CNC, it can be checked by the kernelv_get_error () function and the error message string can be read out. Parameter None Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_NO_LICENSE -17 No licence was found for the use of the kernelv DLL. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 31 Virtual NCK
## Page 32

kernelv API functions 3.7 kernelv_ch_program_start() Prototype KERNELV_RETURN kernelv_ch_program_start (unsigned long chan Index, char* name, unsigned long mode); Description Starts an NC program in the specified channel. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel in which the program is to be started. name char* Name of the program to be started. mode unsigned long* Execution mode in which the program is started. Possible execution modes, see E_KERNELV_PROG:START_MODE. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. RET_BUSY 1 The function is currently being executed, but has not yet been completed. The API function must continue to be called. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_PROG_NAME_LENGTH -2 The transferred program name is longer than permitted. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_INVALID_START -25 An invalid start mode was transferred when the function _MODE kernelv_ch_program_start() was started. For valid execution mode values, see E_KERNELV_PROG_START_MODE. 32 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 33

kernelv API functions 3.8 kernelv_ch_reset() Prototype KERNELV_RETURN kernelv_ch_reset (unsigned long chan Index); Description Executes a CNC reset in the specified channel. This resets internal CNC errors. Any program running during reset is aborted. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel in which the program is to be started. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. RET_BUSY 1 The function is currently being executed, but has not yet been completed. The API function must continue to be called. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 33 Virtual NCK
## Page 34

kernelv API functions 3.9 kernelv_ch_suspend() Prototype KERNELV_RETURN kernelv_ch_suspend (unsigned long int chan Index); Description The program currently running in the channel is stopped. The channel state changes to SIMU_CNC_STATE_HOLD. It is only possible to stop a program if an NC program is currently being executed in the channel, i.e. when the channel is in the SIMU_CNC_STATE_ACTIVE state. The function returns the value ERR_INVALID_STATE if it is called while the channel is in another state. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel that is to be stopped. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. RET_BUSY 1 The function is currently being executed, but has not yet been completed. The API function must continue to be called. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_INVALID_STATE -5 The CNC channel is in the wrong state to execute a function. 34 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 35

kernelv API functions 3.10 kernelv_ch_resume() Prototype KERNELV_RETURN kernelv_ch_resume (unsigned long int chan Index); Description The program currently running in the channel is continued. The channel state changes to SIMU_CNC_STATE_ACTIVE. A program can only be continued if the channel is in the SIMU_CNC_STATE_HOLD state. The function returns the value ERR_INVALID_STATE if it is called while the channel is in another state. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel that is to be continued. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. RET_BUSY 1 The function is currently being executed, but has not yet been completed. The API function must continue to be called. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_INVALID_STATE -5 The CNC channel or the axis is in the wrong state to execute a function. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 35 Virtual NCK
## Page 36

kernelv API functions 3.11 kernelv_ch_get_override() Prototype KERNELV_RETURN kernelv_ch_get_override (unsigned long int chan Index, unsigned short int *override); Description Reads the current override value for the channel. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel whose override is to be read. override unsigned short* Pointer to the value to which the override is to be written. The current override value is returned in 0.1%. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 36 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 37

kernelv API functions 3.12 kernelv_ch_set_override() Prototype KERNELV_RETUR kernelv_ch_set_override (unsigned long int chan Index, N unsigned short int override); Description Sets the current override value for the channel. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel whose override is to be set. override unsigned short Override value to be set in 0.1%. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 37 Virtual NCK
## Page 38

kernelv API functions 3.13 kernelv_ch_get_blocknumber() Prototype KERNELV_RETURN kernelv_ch_get_blocknumber (unsigned long int chan Index, signed long int *blocknumber); Description Reads the currently executed block number of an NC program. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel whose block number is to be read. blocknumber signed long* Pointer to the value to which the block number is to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 38 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 39

kernelv API functions 3.14 kernelv_ch_get_filename() Prototype KERNELV_RETURN kernelv_ch_get_filename (unsigned long int chan Index, char *filename, unsigned short int name Length, unsigned short int* return Length); Description Reads the file name of the program currently active in the channel. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel whose file name is to be read. filename char* Pointer to the memory location for the file name. name Length unsigned short Length of the memory area for the file name. return Length unsigned short* Pointer to the value to which the actually returned number of bytes is to be written. The number of characters in the file name +1 is returned. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the required memory including the terminating 0 are returned in the return Length parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 39 Virtual NCK
## Page 40

kernelv API functions 3.15 kernelv_ch_get_programname() Prototype KERNELV_RETURN kernelv_ch_get_programname (unsigned long int chan Index, char *programname, unsigned short int name Length, unsigned short int* return Length); Description Reads the file name of the program currently active in the channel. The program name is specified at the start of the NC program (see also the programming instructions). Parameter Name Type Meaning chan Index unsigned long Channel index of the channel whose program name is to be read. programname char* Pointer to the memory location for the program name. name Length unsigned short Length of the memory area for the program name. return Length unsigned short* Pointer to the value to which the actually returned number of bytes is to be written. The number of characters in the file name +1 is returned. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the required memory is returned in the return Length parameter. 40 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 41

kernelv API functions 3.16 kernelv_ch_get_state() Prototype KERNELV_RETURN kernelv_ch_get_state (unsigned long int chan Index, KERNELV_CHANNEL_STATE *state); Description Reads the channel's current state. Parameter Name type Meaning chan Index unsigned long Channel index. state KERNELV_CHANN Pointer to the state to be returned. EL_STATE * Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_INTERNAL_ERROR -11 An internal error has occurred in the DLL. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 41 Virtual NCK
## Page 42

kernelv API functions 3.17 kernelv_ch_get_fileoffset() Prototype KERNELV_RETURN kernelv_ch_get_fileoffset (unsigned long int chan Index, signed long int *fileoffset); Description Returns the current file offset in the program file. Parameter Name Type Meaning chan Index unsigned long Channel index fileoffset signed long int * Pointer to the value to which the file offset is to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 42 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 43

kernelv API functions 3.18 kernelv_ch_get_techno_data() Prototype KERNELV_RETUR kernelv_ch_get_techno_data (unsigned long int chanindex, N KERNELV_TECHNO_DATA * techno Data unsigned long int techno Length unsigned long int * return Length); Description Returns the technology functions (M/H functions) acknowledged for the specified channel during the last call of kernelv_do_cycle(). Parameter Name Type Meaning chan Index unsigned long Channel index techno Data KERNELV_TECHN Pointer to the memory area to which the technology data is to be O_DATA* written. techno Length unsigned long Size of the provided memory area in bytes. return Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Length parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 43 Virtual NCK
## Page 44

kernelv API functions 3.19 kernelv_ch_get_new_techno_data() Prototype KERNELV_RETURN kernelv_ch_get_new_techno_data (unsigned long int chanindex, KERNELV_TECHNO_DATA * techno Data unsigned long int techno Length unsigned long int * return Length); Description Returns the technology functions (M/H functions) recently output during the last call of kernelv_do_cycle() for each specific channel. Parameter Name Type Meaning chan Index unsigned long Channel index techno Data KERNELV_TECHN Pointer to the memory area to which the technology data is to be O_DATA* written. techno Length unsigned long Size of the provided memory area in bytes. return Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Length parameter. 44 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 45

kernelv API functions 3.20 kernelv_ch_get_techno_data2() Prototype KERNELV_RETUR kernelv_ch_get_techno_data2 (unsigned long int chanindex, N KERNELV_TECHNO_DATA2 * techno Data2 unsigned long int techno Length unsigned long int * return Length); Description Returns the technology functions (M/H functions) acknowledged for the specified channel during the last call of kernelv_do_cycle(). Parameter Name Type Meaning chan Index unsigned long Channel index techno Data KERNELV_TECHN Pointer to the memory area to which the technology data is to be O_DATA2* written. techno Length unsigned long Size of the provided memory area in bytes. return Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Length parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 45 Virtual NCK
## Page 46

kernelv API functions 3.21 kernelv_ch_get_new_techno_data2() Prototype KERNELV_RETURN kernelv_ch_get_new_techno_data2 (unsigned long int chanindex, KERNELV_TECHNO_DATA2 * techno Data2 unsigned long int techno Length unsigned long int * return Length); Description Returns the technology functions (M/H functions) recently output during the last call of kernelv_do_cycle() for each specific channel. Parameter Name Type Meaning chan Index unsigned long Channel index techno Data KERNELV_TECHN Pointer to the memory area to which the technology data is to be O_DATA2* written. techno Length unsigned long Size of the provided memory area in bytes. return Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Length parameter. 46 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 47

kernelv API functions 3.22 kernelv_ch_get_finished_nc_lines() Prototype KERNELV_RETURN kernelv_ch_get_finished_nc_lines(unsigned long int chan Index, KERNELV_NC_LINE_DATA *nc Line Data, unsigned long int max Byte Size, unsigned long int* return Length); Description Returns the NC lines executed for the specified channel during the last call of kernelv_do_cycle(). Up to 20 NC blocks can be executed for each call of kernelv_do_cycle(). An array of structures of the type KERNELV_NC_LINE_DATA is returned. The number of entries returned can be calculated by means of return Length/ sizeof(KERNELV_NC_LINE_DATA). The breakdown of the structure is described in the section entitled Struct KERNELV_NC_LINE_DATA. Parameter Name Type Meaning chan Index unsigned long Channel index nc Line Data KERNELV_NC_LIN Pointer to the memory area to which the data of the executed NC E_DATA* lines is to be written. max Byte Size unsigned long Size of the provided memory area in bytes. return Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the number of actually required bytes is returned in return Length TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 47 Virtual NCK
## Page 48

kernelv API functions 3.23 kernelv_ax_get_techno_data() Prototype KERNELV_RETURN kernelv_ax_get_techno_data (unsigned long int axis Index, KERNELV_TECHNO_DATA * techno Data unsigned long int techno Length unsigned long int *return Length); Description Returns the technology functions (M/H functions) acknowledged for the specified axis during the last call of kernelv_do_cycle(). Parameter Name Type Meaning axis Index unsigned long Index of the axis. techno Data KERNELV_TECHN Pointer to the memory area to which the technology data is to be O_DATA* written. techno Length unsigned long Size of the provided memory area in bytes. return Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Length parameter. ERR_INVALID_AX -9 The transferred axis index is higher than the number of configured axes - 1 48 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 49

kernelv API functions 3.24 kernelv_ax_get_new_techno_data() Prototype KERNELV_RETURN kernelv_ax_get_new_techno_data (unsigned long int axis Index, KERNELV_TECHNO_DATA * techno Data unsigned long int techno Length unsigned long int *return Length); Description Returns the technology functions (M/H functions) recently output during the last call of kernelv_do_cycle() for each specific axis. Parameter Name Type Meaning axis Index unsigned long Index of the axis. techno Data KERNELV_TECHN Pointer to the memory area to which the technology data is to be O_DATA* written. techno Length unsigned long Size of the provided memory area in bytes. return Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Length parameter. ERR_INVALID_AX -9 The transferred axis index is higher than the number of configured axes - 1 TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 49 Virtual NCK
## Page 50

kernelv API functions 3.25 kernelv_ax_get_techno_data2() Prototype KERNELV_RETURN kernelv_ax_get_techno_data2 (unsigned long int axis Index, KERNELV_TECHNO_DATA2 * techno Data unsigned long int techno Length unsigned long int *return Length); Description Returns the technology functions (M/H functions) acknowledged for the specified axis during the last call of kernelv_do_cycle(). Parameter Name Type Meaning axis Index unsigned long Index of the axis. techno Data KERNELV_TECHN Pointer to the memory area to which the technology data is to be O_DATA2* written. techno Length unsigned long Size of the provided memory area in bytes. return Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Length parameter. ERR_INVALID_AX -9 The transferred axis index is higher than the number of configured axes - 1 50 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 51

kernelv API functions 3.26 kernelv_ax_get_new_techno_data2() Prototype KERNELV_RETURN kernelv_ax_get_new_techno_data (unsigned long int axis Index, KERNELV_TECHNO_DATA2 * techno Data unsigned long int techno Length unsigned long int *return Length); Description Returns the technology functions (M/H functions) recently output during the last call of kernelv_do_cycle() for each specific axis. Parameter Name Type Meaning axis Index unsigned long Index of the axis. techno Data KERNELV_TECHN Pointer to the memory area to which the technology data is to be O_DATA2* written. techno Length unsigned long Size of the provided memory area in bytes. return Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Length parameter. ERR_INVALID_AX -9 The transferred axis index is higher than the number of configured axes - 1 TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 51 Virtual NCK
## Page 52

kernelv API functions 3.27 kernelv_ax_set_position() Prototype KERNELV_RETURN kernelv_ax_set_position (unsigned long int axis Index, signed long int position); Description Sets the actual position of the axis to the position specified in the position parameter. This function can only be executed if no NC program is active in the channel to which the axis currently belongs. If an attempt is made to set the axis position while the NC program is active, adoption of the position is refused and the return value ERR_INVALID_STATE is returned. Parameter Name Type Meaning axis Index unsigned long Index of the axis. position unsigned long New actual position of the axis in 0.1 µm. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. RET_BUSY 1 The function is currently being executed, but has not yet been completed. The API function must continue to be called. ERR_CNC_NOT_INIT -3 The simulation CNC kernel has not yet been initialised. ERR_INVALID_STATE -5 The CNC channel of the axis is in the wrong state for executing a function. ERR_INVALID_AX -9 The transferred axis index is higher than the number of configured axes –1 or zero. ERR_INVALID_AX -9 The transferred axis index is higher than the number of configured axes - 1 ERR_AXIS_ERROR -10 The CNC axis indicates an error. The CNC additionally issues an error message. 52 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 53

kernelv API functions 3.28 kernelv_get_acs_command_positions() Prototype KERNELV_RETURN kernelv_get_acs_command_positions (unsigned long* positions, unsigned long max Byte Size, unsigned long* return Size); Description The ACS command positions of all axes existing in the CNC are returned in an array. If an axis-specific command value transformation is configured for an axis, this function returns the transformed command value for each specific axis. Position values have a resolution of 0.1 µm for translatory axes or 1*10-4° for spindles or modulo axes. The error code ERR_CNC_RET_MEMORY is returned if the memory provided by the calling application is not sufficient for returning all values. The calling application must provide at least number of axes * sizeof(signed long int) bytes for returning of all position values. The order of the axis positions in the returned array is equal to the configuration order of the axes. Parameter Name Type Meaning positions unsigned long* Pointer to the memory area for the axis positions to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Size parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 53 Virtual NCK
## Page 54

kernelv API functions 3.29 kernelv_get_acs0_command_positions() Prototype KERNELV_RETURN kernelv_get_acs0_command_positions (unsigned long* positions, unsigned long max Byte Size, unsigned long* return Size); Description The ACS command positions of all axes existing in the CNC are returned in an array. If an axis-specific command value transformation is configured for an axis, this function returns the untransformed command value for each specific axis. Position values have a resolution of 0.1 µm for translatory axes or 1*10-4° for spindles or modulo axes. The error code ERR_CNC_RET_MEMORY is returned if the memory provided by the calling application is not sufficient for returning all values. The calling application must provide at least number of axes * sizeof(signed long int) bytes for returning of all position values. The order of the axis positions in the returned array is equal to the configuration order of the axes. Parameter Name Type Meaning positions unsigned long* Pointer to the memory area for the axis positions to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Size parameter. 54 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 55

kernelv API functions 3.30 kernelv_get_acs_actual_positions() Prototype KERNELV_RETURN kernelv_get_acs_actual_positions (unsigned long* positions, unsigned long max Byte Size, unsigned long* return Size); Description The actual ACS positions of all axes existing in the CNC are returned in an array. To calculate actual positions, a position control loop is simulated internally in the CNC and the mechanical behaviour of the axis is simulated by a PT2 element. Position values have a resolution of 0.1 µm for translatory axes or 1*10-4° for spindles or modulo axes. The error code ERR_CNC_RET_MEMORY is returned if the memory provided by the calling application is not sufficient for returning all values. The calling application must provide at least number of axes * sizeof(signed long int) bytes for returning of all position values. The order of the axis positions in the returned array is equal to the configuration order of the axes. Parameter Name Type Meaning positions unsigned long* Pointer to the memory area for the axis positions to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Size parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 55 Virtual NCK
## Page 56

kernelv API functions 3.31 kernelv_get_acs_target_positions() Prototype KERNELV_RETURN kernelv_get_acs_target_positions (unsigned long* positions, unsigned long max Byte Size, unsigned long* return Size); Description The ACS target positions of all axes existing in the CNC are returned in an array. The target position is the axis position at the end of the currently executed motion block. Position values have a resolution of 0.1 µm for translatory axes or 1*10-4° for spindles or modulo axes. The error code ERR_CNC_RET_MEMORY is returned if the memory provided by the calling application is not sufficient for returning all values. The calling application must provide at least number of axes * sizeof(signed long int) bytes for returning of all position values. The order of the axis positions in the returned array is equal to the configuration order of the axes. Parameter Name Type Meaning positions unsigned long* Pointer to the memory area for the axis positions to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the required memory is returned in the return Size parameter. 56 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 57

kernelv API functions 3.32 kernelv_get_acs_start_positions() Prototype KERNELV_RETURN kernelv_get_acs_start_positions (unsigned long* positions, unsigned long max Byte Size, unsigned long* return Size); Description The ACS start positions of all axes existing in the CNC are returned in an array. The start position is the axis position that the axis was in at the start of the currently executed motion block. Position values have a resolution of 0.1 µm for translatory axes or 1*10-4° for spindles or modulo axes. The error code ERR_CNC_RET_MEMORY is returned if the memory provided by the calling application is not sufficient for returning all values. The calling application must provide at least number of axes * sizeof(signed long int) bytes for returning of all position values. The order of the axis positions in the returned array is equal to the configuration order of the axes. Parameter Name Type Meaning positions unsigned long* Pointer to the memory area for the axis positions to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Size parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 57 Virtual NCK
## Page 58

kernelv API functions 3.33 kernelv_get_wcs_command_positions() Prototype KERNELV_RETURN kernelv_get_wcs_command_positions (unsigned long* positions, unsigned long max Byte Size, unsigned long* return Size); Description The WCS command positions of all axes existing in the CNC are returned in an array. Position values have a resolution of 0.1 µm for translatory axes or 1*10-4° for spindles or modulo axes. The error code ERR_CNC_RET_MEMORY is returned if the memory provided by the calling application is not sufficient for returning all values. The calling application must provide at least number of axes * sizeof(signed long int) bytes for returning of all position values. The order of the axis positions in the returned array is equal to the configuration order of the axes. Parameter Name Type Meaning positions unsigned long* Pointer to the memory area for the axis positions to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the required memory is returned in the return Size parameter. 58 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 59

kernelv API functions 3.34 kernelv_get_wcs_target_positions() Prototype KERNELV_RETURN kernelv_get_wcs_target_positions (unsigned long* positions, unsigned long max Byte Size, unsigned long* return Size); Description The WCS target positions of all axes existing in the CNC are returned in an array. The target position is the axis position at the end of the currently executed motion block. Position values have a resolution of 0.1 µm for translatory axes or 1*10-4° for spindles or modulo axes. The error code ERR_CNC_RET_MEMORY is returned if the memory provided by the calling application is not sufficient for returning all values. The calling application must provide at least number of axes * sizeof(signed long int) bytes for returning of all position values. The order of the axis positions in the returned array is equal to the configuration order of the axes. Parameter Name Type Meaning positions unsigned long* Pointer to the memory area for the axis positions to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the required memory is returned in the return Size parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 59 Virtual NCK
## Page 60

kernelv API functions 3.35 kernelv_get_wcs_start_positions() Prototype KERNELV_RETURN kernelv_get_wcs_start_positions (unsigned long* positions, unsigned long max Byte Size, unsigned long* return Size); Description The WCS start positions of all axes existing in the CNC are returned in an array. The start position is the axis position that the axis was in at the start of the currently executed motion block. Position values have a resolution of 0.1 µm for translatory axes or 1*10-4° for spindles or modulo axes. The error code ERR_CNC_RET_MEMORY is returned if the memory provided by the calling application is not sufficient for returning all values. The calling application must provide at least number of axes * sizeof(signed long int) bytes for returning of all position values. The order of the axis positions in the returned array is equal to the configuration order of the axes. Parameter Name Type Meaning positions unsigned long* Pointer to the memory area for the axis positions to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the required memory is returned in the return Size parameter. 60 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 61

kernelv API functions 3.36 kernelv_get_prg_target_positions() Prototype KERNELV_RETURN kernelv_get_prg_target_positions (signed long int *positions, unsigned long int max Byte Size, unsigned long int *return Size); Description The target positions of all axes existing in the CNC that are programmed in the NC program are returned in an array. The returned positions are the positions programmed in the currently executed NC block. If motion blocks are inserted by the CNC or programmed motion blocks are split (e.g. when contouring), the target position of the source block is output for all generated NC blocks. Position values have a resolution of 0.1 µm for translatory axes or 1*10-4° for spindles or rotary axes. The error code ERR_CNC_RET_MEMORY is returned if the memory provided by the calling application is not sufficient for returning all values. The calling application must provide at least number of axes * sizeof(signed long int) bytes for returning of all position values. The order of the axis positions in the returned array is equal to the configuration order of the axes. If an axis is currently not assigned to an NC channel, the value zero is returned for that axis. Parameter Name Type Meaning positions unsigned long* Pointer to the memory area for the axis positions to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the required memory is returned in the return Size parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 61 Virtual NCK
## Page 62

kernelv API functions 3.37 kernelv_get_axis_channel_number() Prototype KERNELV_RETURN kernelv_get_axis_channel_number (unsigned short* chan Numbers, unsigned long max Byte Size, unsigned long* return Size); Description By configuration or by axis replacement commands during an NC program, an axis can be moved by different CNC channels. By means of this function, the number of the channel moving the respective axis can be queried. The following relationship exists between the channel number and the channel index: Channel index = channel number –1 Parameter Name Type Meaning chan Numbers unsigned short* Pointer to the memory area for the channel numbers to be returned. max Byte Size unsigned long Size of the memory area for the axis positions. return Size unsigned long* Number of bytes returned in positions. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the required memory is returned in the return Size parameter. 62 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 63

kernelv API functions 3.38 kernelv_ch_get_variable_value() Prototype KERNELV_RETURN kernelv_ch_get_variable_value (unsigned long int chan Index, char* var Name, KERNELV_VARIABLE *var); Description Reads a variable out of the CNC kernel. Currently, the following variable types can be read. Type Example External variables V. E. VAR_1 Global variables, see (1) V. G. CNC_RELEASE Axis-specific variables V. A.+SWE. X Program global, self-defined variables V. P. VAR_1 Cross-program, self-defined variables V. S. VAR_1 Program non-global, self-defined variables V. L. VAR_1 Currently, it is not possible to read Type V. G. WZ[]. variables. The variable to be read is identified on the basis of its name and the channel index. The complete name (including the V. E. prefix and the array index in the case of array variables) must be specified as the name. Example: "V. E. VAR_FLOAT_ARRAY[3]" The value is returned in the KERNELV_VARIABLE *var structure. An error code is returned if an error occurred while reading the variables. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. var Name char* Pointer to the variable name. var KERNELV_VARIAB Pointer to structure to which the variable value and the type are to LE* be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. ERR_INTERNAL_ERROR -11 An internal error has occurred in the DLL. ERR_UNKNOWN_VARIABLE -12 The variable name is not known in the CNC kernel. ERR_VARIABLE_SYNTAX -13 The variable name is syntactically incorrect, e.g. no closing bracket in the case of an array variable. ERR_VAR_NAME_LENGTH -18 The variable name passed on to the function exceeds the maximum permissible length (KERNELV_VAR_NAME_LENGTH). TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 63 Virtual NCK
## Page 64

kernelv API functions ERR_ARRAY_NOT_SUPPORT -21 With many CNC real-time variants, an array can be read ‘en block’ ED by omitting the array index on access. The kernelv DLL does not currently support this access type. 64 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 65

kernelv API functions 3.39 kernelv_ch_set_variable_value() Prototype KERNELV_RETURN kernelv_ch_set_variable_value (unsigned long int chan Index, char* var Name, KERNELV_VARIABLE *var); Description Writes variables defined for a CNC kernel. Writing a variable is only possible if it is writeable by the NC program. External variables can always be written irrespective of the access type configured. Currently, the following variable types can be written. Type Example External variables V. E. VAR_1 Global variables, see (1) V. G. WZ_AKT. R Axis-specific variables V. A. WCS. X Program global, self-defined variables V. P. VAR_1 Cross-program, self-defined variables V. S. VAR_1 Program non-global, self-defined variables V. L. VAR_1 Currently, it is not possible to read Type V. G. WZ[]. variables. The variable to be written is identified on the basis of its name and the channel index. The complete name (including the V. E. prefix and the array index in the case of array variables) must be specified as the name. Example: "V. E. VAR_FLOAT_ARRAY[3]" The variable value to be written must be transferred in the KERNELV_VARIABLE *var structure. An error code is returned if an error occurred while writing the variables. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. var Name char* Pointer to the variable name. var KERNELV_VARIAB Pointer to structure to which the variable value and the type are to LE* be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. ERR_INTERNAL_ERROR -11 An internal error has occurred in the DLL. ERR_UNKNOWN_VARIABLE -12 The variable name is not known in the CNC kernel. ERR_VARIABLE_SYNTAX -13 The variable name is syntactically incorrect, e.g. no closing bracket in the case of an array variable. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 65 Virtual NCK
## Page 66

kernelv API functions ERR_DATA_TYPE_MISMATC -14 On write access to a variable, the transferred data type does not H match the data type used internally in the CNC. ERR_VAR_NAME_LENGTH -18 The variable name passed on to the function exceeds the maximum permissible length (KERNELV_VAR_NAME_LENGTH). ERR_ARRAY_NOT_SUPPORT -21 With many CNC real-time variants, an array can be read or written ED ‘en block’ by omitting the array index at access. The kernelv DLL does not currently support this access type. ERR_VAR_NOT_WRITEABLE -22 An attempt was made to write a non-writeable variant. For write access to variables, the same access rules apply as within an NC program. The only exception here are V. E. variables. They can always be written irrespective of the access rights configured. 66 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 67

kernelv API functions 3.40 kernelv_get_channel_count() Prototype KERNELV_RETURN kernelv_get_channel_count (unsigned long int* channel Count); Description Reads the number of configured channels of the CNC control. An error code is returned if the function is called while the CNC kernel has not yet started. Parameter Name Type Meaning channel Count unsigned long* Pointer to the memory for the number of channels to be returned. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 67 Virtual NCK
## Page 68

kernelv API functions 3.41 kernelv_get_axis_count() Prototype KERNELV_RETURN kernelv_get_axis_count (unsigned long int* axis Count); Description Reads the number of configured axes of the CNC controller. An error code is returned if the function is called while the CNC kernel has not yet started. Parameter Name Type Meaning axis Count unsigned long* Pointer to the memory for the number of axes to be returned. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 68 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 69

kernelv API functions 3.42 kernelv_sync_read_request() Prototype signed long int kernelv_sync_read_request (unsigned short port, unsigned long int index Group, unsigned long int index Offset, unsigned long int length, void* data); Description Synchronous reading of variables. The variables are identified by Port, index Group and index Offset. At present, the following ports are supported: Port number CNC task 551 GEO task 552 SDA task 553 COM task The meaning of index Group and index Offset depends on the addressed port and can be found in the documentation. An error code is returned if the function is called while the CNC kernel has not yet started. Parameter Name Type Meaning port unsigned short Port from which the data is to be read. index Group unsigned long* Index group of the data item to be read. index Offset unsigned long* Index offset of the data item to be read. length unsigned long* Size of the memory in bytes for the value to be read. data void* Pointer to memory for the value to be read Return values Symbol Value Meaning 0 The function was executed without error. -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. 6 The transferred port number is not known. 0x701 The requested service is not supported. 0x702 Index group is invalid 0x703 Index offset is invalid 0x704 The variable addressed must not be read. 0x705 The memory provided is too small for the value to be returned. 0x706 The job cannot be executed. Possible reasons are: • invalid data on write accesses or • invalid state of kernelv, e.g. list updating while CNC channel is in error. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 69 Virtual NCK
## Page 70

kernelv API functions 3.43 kernelv_sync_write_request() Prototype signed long int kernelv_sync_write_request (unsigned short port, unsigned long int index Group, unsigned long int index Offset, unsigned long int length, void* data); Description Synchronous writing of variables. The variables are identified by Port, index Group and index Offset. At present, the following ports are supported: Port number CNC task 551 GEO task 552 SDA task 553 COM task The meaning of index Group and index Offset depends on the addressed port and can be found in the documentation. An error code is returned if the function is called while the CNC kernel has not yet started. A write operation may last several NC cycles irrespective of the index group and index offset used. In this case the function returns the value 1 (RET_BUSY). If this is the case, the function must be called again every time kernelv_do_cycle() is called until either the return value returned is 0 (RET_FINISHED) or an error message is returned. Parameter Name Type Meaning port unsigned short Port via which data is to be written. index Group unsigned long Index group of data item to be written. index Offset unsigned long Index offset of data item to be written. length unsigned long* Size of the memory in bytes for the value to be written. data void* Pointer to memory for the value to be written Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. RET_BUSY 1 The function is currently being executed, but has not yet been completed. The API function must continue to be called. 6 The transferred port number is not known. 0x701 The requested service is not supported. 0x702 Index group is invalid 0x703 Index offset is invalid 0x704 The variable addressed must not be written. 0x705 The data to be written does not match the addressed variable. 0x706 The job cannot be executed. Possible reasons are: • invalid data on write accesses or 70 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 71

kernelv API functions • invalid state of kernelv, e.g. list updating while CNC channel is in error. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 71 Virtual NCK
## Page 72

kernelv API functions 3.44 kernelv_sync_read_write_req() Prototype signed long int kernelv_sync_write_req (unsigned short port, unsigned long int index Group, unsigned long int index Offset, unsigned long int *read Length, unsigned long int write Length, void* data); Description Synchronous writing and reading of variables. The variables are identified by Port, index Group and index Offset. When called, the data pointer contains the data to be written. Specify in write Length the length of the data area to be written in bytes. Enter the number of bytes to be read in the real Length pointer. The data read is saved to the memory to which the data pointer points and the number of bytes written is written to *read Length. At present, the following ports are supported: Port number CNC task 551 GEO task 552 SDA task The meaning of index Group and index Offset depends on the addressed port and can be found in the documentation. An error code is returned if the function is called while the CNC kernel has not yet started. Parameter Name Type Meaning port unsigned short Port from which the data is to be read. index Group unsigned long Index group of the data item to be read. index Offset unsigned long Index offset of the data item to be read. read Length unsigned long* Pointer to the return value for the number of bytes returned. write Length unsigned long Length of the data area to be written. data void* Pointer to memory for the data to be read or written. Return values Symbol Value Meaning 0 The function was executed without error. -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. 6 The transferred port number is not known. 0x701 The requested service is not supported. 0x702 Index group is invalid 0x703 Index offset is invalid 0x704 The variable addressed must not be written. 0x705 The data to be written does not match the addressed variable. 0x706 The job cannot be executed. Possible reasons are: 72 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 73

kernelv API functions • invalid data on write accesses or • invalid state of kernelv, e.g. list updating while CNC channel is in error. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 73 Virtual NCK
## Page 74

kernelv API functions 3.45 kernelv_get_axis_names() Prototype KERNELV_RETURN kernelv_get_axis_names(char* axis Names, unsigned long int max Byte Size, unsigned long int *return Size, unsigned long int *n Axis); Description Returns the axis names of an axis used in the respective channels. The axis name is the name with which the axis is addressed in an NC program. Only axes that are in a channel have an axis name. An array of strings with a fixed length is returned. The length of one single string (including terminating zeroes) can be determined as follows: Length of name = return Size / number of configured axes The number of configured axes can be determined with the kernelv_get_axis_count() function. The indexes of the returned axis names correspond to the configuration sequence. See also Section 1.2.3.1. If the axis name is shorter than the name length –1 character, the string is filled with the value \0. The indexes of the returned axis names correspond to the configuration sequence. See also Section 1.2.3.1. If the memory provided by the calling application is too small for the values to be returned, the value ERR_CNC_RET_MEMORY is returned and, in this case, the memory in bytes minimally required for returning is entered in the return Size variable. Parameter Name Type Meaning axis Names char* Pointer to the memory area for the axis names to be returned. max Byte Size unsigned long Size of the memory area for the axis names. return Size unsigned long* Number of bytes returned in axis Names. n Axis unsigned long* Number of axis names returned in axis Names. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Size parameter. Four axes are configured, and only the axes with the indexes 0 (axis name 'X2') and 2 (axis name 'C') are assigned to a channel:A call of kernelv_get_axis_names() returns the following values: Parameter Value Comment return Size 80 Configured axes * name length n Axis 2 Number of axes that are currently assigned to a channel axis Names See the table below. The length (name Length) of a single string is thus: namelength = return Size / number of configured axes = 80 / 4 = 20 74 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 75

kernelv API functions axis Names as the following structure: Offset Value 0 ‘X’, ‘2’; \0, \0, \0 …. 20 (1* name Length) \0, \0, \0, ….. 40 (2* name Length) ‘C’; \0, \0, \0 …. 60 (3* name Length) \0, \0, \0, ….. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 75 Virtual NCK
## Page 76

kernelv API functions 3.46 kernelv_control_techno_func_duration() Prototype KERNELV_RETURN kernelv_control_techno_func_duration (unsigned char on Off); Description Activates or deactivates execution time simulation for technology functions. By default, execution time simulation is off, i.e. technology functions are acknowledged immediately. When execution time simulation is active, acknowledgement of the technology functions is delayed to simulate their actual execution time. The execution time can be set by means of the kernelv_ch_set_techno_func_duration() function or by means of entries in the channel parameter list (P-CHAN-00040, P-CHAN-00026). If execution time simulation is deactivated while still unacknowledged technology functions are pending, they are acknowledged immediately regardless of the set execution time. Parameter Name Type Meaning on Off unsigned char In the case of a value of on Off > 0, the execution time is activated and a value of 0 deactivates execution time simulation. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. 76 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 77

kernelv API functions 3.47 kernelv_ch_set_techno_func_duration() Prototype KERNELV_RETURN kernelv_ch_set_techno_func_duration (unsigned long int chan Index, E_KERNELV_TECHNO_TYPE type, unsigned long int number, unsigned long int time_us); Description Sets the execution time for the transferred technology function. The execution time must be specified in microseconds. Parameter Name Type Meaning chan Index unsigned long int Channel index. type E_KERNELV_TECH Type of the technology function whose execution time is to be NO_TYPE written. number unsigned long int Number of the technology function whose execution time is to be written. time_us unsigned long int Execution time in us. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels - 1 ERR_INTERNAL_ERROR -11 An internal error has occurred in the DLL. The value could not be written. ERR_INVALID_TECHNO_ -16 An invalid parameter was transferred when the execution time was PARAM set for a technology function, e.g. transferred number of the M or H function is higher than the maximum permitted number. ERR_UNKNOWN_TECHNO_T -15 An invalid type was specified for a technology function when the YPE execution time was set. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 77 Virtual NCK
## Page 78

kernelv API functions 3.48 kernelv_ch_set_techno_func_user_ackn() Prototype KERNELV_RETURN kernelv_ch_set_techno_func_user_ackn (unsigned long int chan Index, E_KERNELV_TECHNO_TYPE type, unsigned long int number); Description Deactivates automatic acknowledgement when execution time simulation is active after expiry of the execution time set. The user must acknowledge the technology function by calling one of the functions kernelv_ch_ackn_techno_func() or kernelv_ax_ackn_techno_func(). User acknowledgement is only possible if execution time simulation is active. Parameter Name Type Meaning chan Index unsigned long int Channel index. type E_KERNELV_TECH Type of technology function to be acknowledged by the user. NO_TYPE number unsigned long int Number of the technology function. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1 ERR_INTERNAL_ERROR -11 An internal error has occurred in the DLL. The value could not be written. ERR_INVALID_TECHNO_ -16 An invalid parameter was transferred when user PARAM acknowledgement was activated, e.g. transferred number of the M or H function is higher than the maximum permitted number. ERR_UNKNOWN_TECHNO_T -15 An invalid type was specified for a technology function when the YPE user acknowledgement was activated. 78 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 79

kernelv API functions 3.49 kernelv_ch_ackn_techno_func() Prototype KERNELV_RETURN kernelv_ch_ackn_techno_func(unsigned long int chan Index, E_KERNELV_TECHNO_TYPE type, unsigned long int number); Description Acknowledges a technology function for which the user acknowledgement was activated. If the specified technology function is not open (acknowledgement pending), the return value ERR_TECHNO_NOT_FOUND is returned, otherwise RET_FINISHED. Parameter Name Type Meaning chan Index unsigned long int Channel index. type E_KERNELV_TECH Type of technology function to be acknowledged. NO_TYPE number unsigned long int Number of the technology function. Return values Symbol Value Meaning RET_FINISHED 0 The technology function was acknowledged. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_TECHNO_NOT_ -29 The specified technology function was not found. FOUND TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 79 Virtual NCK
## Page 80

kernelv API functions 3.50 kernelv_ax_ackn_techno_func() Prototype KERNELV_RETURN kernelv_ax_ackn_techno_func(unsigned long int ax Index, E_KERNELV_TECHNO_TYPE type, unsigned long int number); Description Acknowledges a technoogy function for which the user acknowledgement was activated. If the specified technology function is not open (acknowledgement pending), the return value ERR_TECHNO_NOT_FOUND is returned, otherwise RET_FINISHED. Parameter Name Type Meaning axdex unsigned long int Axis index. type E_KERNELV_TECH Type of technology function to be acknowledged. NO_TYPE number unsigned long int Number of the technology function. Return values Symbol Value Meaning RET_FINISHED 0 The technology function was acknowledged. ERR_INVALID_CHAN -1 The transferred axis index is higher than the number of configured axes -1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_TECHNO_NOT_ -29 The specified technology function was not found. FOUND 80 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 81

kernelv API functions 3.51 kernelv_get_license_info() Prototype KERNELV_RETURN kernelv_get_license_info (KERNELV_LICENSE_INFO *p License Info); Description Reads the existing license information. The function can only be used after the function kernelv_startup() is called. The function writes the existing license information to the memory referenced by the call parameter p License Info. Parameter Name Type Meaning p License Info KERNELV_LICENS Memory for the license information to be returned. E_INFO* Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 81 Virtual NCK
## Page 82

kernelv API functions 3.52 kernelv_set_options() Prototype KERNELV_RETURN kernelv_set_options (unsigned long int options Mask); Description This function activates internal kernelv functions, e.g. the output of messages during license check. Depending on the function to be activated, this function may have to be called by the kernelv_startup() function. Each function is assigned a bit in the call parameter of this function. The function is activated by setting the appropriate bit. If several functions are to be activated, the resulting bit array is generated from the OR operation of the individual bit masks. If bits are set in the bit array transferred to the function and they are not assigned to any function, the unknown bits are ignored and the value ERR_UNKNOWN_OPTION is returned. In this case, the known bits are evaluated and the assigned functions are activated. Parameter Name Type Meaning options Mask unsigned long Bit array with options. Possible values for the bit array are: Symbol Value Meaning KERNELV_OPTION_ 0x1 During the license check at start-up, progress messages are LICENSE_CHECK_VERBOSE output relating to the license check. Acts as error search to handle licensing problems. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 82 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 83

kernelv API functions 3.53 kernelv_ch_get_decoder_positions() Prototype KERNELV_RETURN kernelv_ch_get_decoder_positions (unsigned long int chan Index, void* ret_buffer, unsigned long int buffer_size, unsigned long int *ret_length)); Description This function requests the decoder for the currently active axis positions in the machine coordinates and in the programming coordinates. The values returned by the function are written to the memory area that points to the buffer. The size of this memory area must be specified in the buffer_size variable. The actual size of the returned data is returned in ret_length. If the returned data does not fit in the memory area provided, the error code ERR_CNC_RET_MEMORY is returned. In this case ret_length contains the memory size required for the return. The returned data has the following structure. The individual data elements of the structures are packed in the memory: Byte index Type Meaning 0 KERNELV_DECODER_POSITION_H For general data about the decoder positions EADER supplied, see 2.2.24 [} 145]. Enter the number of the following structures of type KERNELV_DECODER_POSITION_DATA in the axis_count element. 11 KERNELV_DECODER_POSITION_D Axis positions and axis number of the 1st axis. ATA For structure definition, see 2.2.25 [} 146] 25 KERNELV_DECODER_POSITION_D Axis positions and axis number of the 2nd axis. ATA For structure definition, see 2.2.25 [} 146] 39 … ... Since the maximum possible number of axes in the channel is currently limited to 32, the maximum size of the return value is 459 bytes. Parameter Name Type Meaning chan Index unsigned long Index of the channel ret_buffer void* Pointer to the memory area to which the return data is to be written. buffer_size unsigned long Size of the provided memory area in bytes. ret_Length unsigned long* Pointer to the memory area to which the actually returned bytes are to be written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1 ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 83 Virtual NCK
## Page 84

kernelv API functions 3.54 kernelv_ch_get_prog_start_mode() Prototype KERNELV_RETURN kernelv_ch_get_prog_start_mode (unsigned long int chan Index, E_KERNELV_PROG_START_MODE* mode); Description Reads the execution mode of the current program running. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. mode E_KERNELV_PRO Points to Enum for the returned execution mode. G _START_MODE* Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 84 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 85

kernelv API functions 3.55 kernelv_ch_set_cont_visu_grid() Prototype KERNELV_RETURN kernelv_ch_set_cont_visu_grid (unsigned long int chan Index, unsigned long int grid); Description Sets the output grid for linear blocks for command contour visualisation. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. grid unsigned long Output grid for linear blocks in 0.1 um. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 85 Virtual NCK
## Page 86

kernelv API functions 3.56 kernelv_ch_set_cont_visu_rel_curvature_error() Prototype KERNELV_RETURN kernelv_ch_set_cont_visu_rel_curvature_error (unsigned long int chan Index, unsigned long int rel_error); Description Sets the relative curvature error of the command contour visualisation for curved contours (circle segments and polynomials). The relative curvature error indicates the permitted secant error for tracing the curved contour as a percentage of the curve radius. Example: For a circle, the curve radius is identical to the circle radius; for a circle radius of 100 mm and a relative curvatures error of 1%, the permitted secant error is 100 mm * 1% = 1 mm. The effective secant error to trace a contour element is determined by the minimum value between the absolute and relative secant errors. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. rel_error unsigned long Relative curvature error in 0.1% Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 86 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 87

kernelv API functions 3.57 kernelv_ch_set_cont_visu_abs_curvature_error() Prototype KERNELV_RETURN kernelv_ch_set_cont_visu_abs_curvature_error (unsigned long int chan Index, unsigned long int rel_error); Description Sets the absolute curvature error of the command contour visualisation for curved contours (circle segments and polynomials). The absolute curvature error indicates the permitted secant error for tracing the curved contour. The effective secant error to trace a contour element is determined by the minimum value between the absolute and relative secant errors. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. rel_error unsigned long Relative curvature error in 0.1% Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 87 Virtual NCK
## Page 88

kernelv API functions 3.58 kernelv_ch_get_cont_visu_data() Prototype KERNELV_RETURN kernelv_ch_get_cont_visu_data (unsigned long int chan Index, unsigned char* p Data, unsigned long int max Byte Size, unsigned long int* ret Length); Description Reads the contour visualisation of a channel. The format of the returned data is set by the parameter P- STUP-00039. A structure of type CONTOUR_VISU is returned followed by structures of type COUNTOUR_VISU_DATA_V0 … _V8. If the memory provided by the calling application is not sufficient to return the structure CONTOUR_VISU, ERR_CNC_RET_MEMORY is returned and the minimum size of the required memory area is returned in ret Length. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. p Data unsigned char* Pointer to the memory area for return values. max Byte Size unsigned long Size of the return memory. ret Length unsigned long* Number of bytes returned in p Data. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Size parameter. 88 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 89

kernelv API functions 3.59 kernelv_ch_get_active_g_codes() Prototype KERNELV_RETURN kernelv_ch_get_active_g_codes (unsigned long int chan Index, ACTIVE_G_CODES* p GCodes); Description Reads the G function groups active in the specified channel. A structure of type ACTIVE_G_CODES is returned. This structure contains the active G function groups. If the value -1 is in an entry, it means that the entry is unassigned. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. p GCodes ACTIVE_G_ Pointer to the structure to which the values are returned. CODES* Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel has not yet been initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 89 Virtual NCK
## Page 90

kernelv API functions 3.60 kernelv_get_active_g_group() Prototype signed short kernelv_get_active_g_group (ACTIVE_G_CODES* p GCodes, E_KERNELV_G_GROUP_TYPE Type); Description Receives a structure of type ACTIVE_G_CODES and returns the content of the group specified in E_KERNELV_G_GROUP_TYPE. Utility function to evaluate the structure returned by kernelv_ch_get_active_g_codes(). Parameter Name Type Meaning p GCodes ACTIVE_G_ Pointer to the structure from which a G group is to be read. CODES* Type E_KERNELV_ Type ID of the G group which is to be read. G_GROUP_TYPE Return values short int: Active G function of the requested group or -1 if no valid value is entered in the requested group. 90 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 91

kernelv API functions 3.61 kernelv_ch_get_command_feed() Prototype KERNELV_RETURN kernelv_ch_get_command_feed (unsigned long int chan Index, signed long int* command_feed); Description Returns the programmed feed. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. command_feed signed long int* Pointer to the variable for the return value. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 91 Virtual NCK
## Page 92

kernelv API functions 3.62 kernelv_ch_get_active_feed() Prototype KERNELV_RETURN kernelv_ch_get_active_feed (unsigned long int chan Index, signed long int* command_feed); Description Returns the actually traversed feed in µm/s. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. command_feed signed long int* Pointer to the variable for the return value. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 92 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 93

kernelv API functions 3.63 kernelv_set_call_ratio() Prototype KERNELV_RETURN kernelv_set_call_ratio (unsigned short int dec_calls, unsigned short int interpolator_calls); Description Defines the ratio of decoder calls to interpolator calls. One interpolator call is executed for every kernelv_do_cycle() call. In many real-time environments the cycle time for the path preparation task can be set irrespective of the interpolator cycle time. The function sets a ratio between path preparation cycles and interpolator cycles for the kernelv DLL. The kernelv_set_call_ratio(5, 2) function sets a ratio of 5 path preparation calls to 2 interpolator calls. The parameters dec_calls and interpolator_calls may not both be 0. The ratio between the two parameters must be within the range [0,05 , 20]. Parameter Name Type Meaning dec_calls unsigned short Number of path preparation cycles. interpolator_calls unsigned short Number of interpolator cycles. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_ -30 One of the parameters transferred is invalid. The following PARAMETER conditions apply: dec_calls, interpolator_calls <> 0 0.05 ≤ dec_calls/interpolator_calls ≤ 20. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 93 Virtual NCK
## Page 94

kernelv API functions 3.64 CNC error messages with kernelv The kernelv DLL can read out and display error messages output by the CNC. There are 2 options for this: 1. Read out fully formatted error message as string. The error message is returned in the same format as entered in the error message log and in the form of a string. The kernelv_get_error() function can be used for this. 2. Internal storage of the error message and request for parts of the error message for further processing and display in a user interface. The remaining functions described in this section are used for this pur- pose. 3.64.1 Language of error messages The default language for error message output is German. Use the function kernelv_set_error_language() [} 94] to switch the error message language between German and English. This switches both the language of the error message text and the language of the error mask in which the error message data is entered. When English is used as the output language, the file ‘err_text_version_eng.txt’ must be present, see also section Error message texts [} 24]. 3.64.1.1 kernelv_set_error_language () Prototype KERNELV_RETURN kernelv_set_error_language (E_KERNELV_ERROR_LANGUAGE lang); Description This function sets the language for error message output. Possible values are German (default) and English. Parameter Name Value Meaning lang E_KERNELV_ERROR_LANGUAGE Identifier for the error message output language Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_INVALID_ -30 The transferred identifier for error message output is invalid. 94 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 95

kernelv API functions 3.64.1.2 kernelv_get_error_language () Prototype KERNELV_RETURN kernelv_get_error_language (E_KERNELV_ERROR_LANGUAGE *lang); Description This function requests the language for error message output. Parameter Name Value Meaning Lang E_KERNELV_ERROR_LANGUAGE Pointer to the error message output language Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 95 Virtual NCK
## Page 96

kernelv API functions 3.64.2 Read out error message in the form of a string kernelv_get_error() Prototype KERNELV_RETURN kernelv_get_error (unsigned long* error Id, char* message String, unsigned long max String Length, unsigned long* return Length); Description Reads out error messages of the simulation CNC: Error messages are read out for all channels. As several error messages can occur during one CNC cycle, the function must be called cyclically until it returns the error ID 0. If the memory provided by the calling application is too small for the string to be returned, the return value ERR_CNC_RET_MEMORY is returned In this case, the return Length parameter contains the size in bytes required for returning the string. In any case, a value is assigned to the "error Id” parameter. If this function is used at the same time as kernelv_read_error(), please note that the function also calls kernelv_read_error() internally. The function kernelv_get_error_message_string() should be used to read an error string when the function kernelv_read_error() is used. Parameter Name Type Meaning error Id unsigned long* Pointer to error message ID. message String char* Pointer to string for error message string. The calling application must provide the memory. max String Length unsigned long* Size of memory for the error message string. No string is returned if the error message string generated by the simulation CNC is longer than the memory provided. return Length unsigned long* Size of the memory expected. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the return Size parameter. 96 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 97

kernelv API functions 3.64.3 General information on error messages Proceed as follows to request specific information on an error message displayed: Call the function kernelv_read_error(). This checks whether there is a current error message. If so, it is stored temporarily for further evaluation in the DLL. If there is a current error message, you can request further information about it. 3.64.3.1 kernelv_read_error() Prototype KERNELV_RETURN kernelv_read_error (void); Description Checks whether there is a current error message from the simulation CNC and stores it temporarily. The error messages of all channels are checked. If there is a current error message, further functions can be used to request details about this specific error message. When this function is called again, a new error message may be read out. Then it is no longer possible to request the error message properties of a previously pending error message. As several error messages may occur during one CNC cycle, the function must be called cyclically until it returns RET_FINISHED. Parameter - Return values Name Value Meaning RET_FINISHED 0 No error message was read. RET_BUSY 1 An error message was read. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 97 Virtual NCK
## Page 98

kernelv API functions 3.64.3.2 kernelv_get_error_id() Prototype unsigned long int kernelv_get_error_id(void); Description Returns the error number of an error message previously read by kernelv_read_error(). If kernelv_read_error() was not called or there is no current error message, the value 0 is returned. Parameter - Return values Type: unsigned long int 0 if there is no current error message; otherwise the error number. The individual errors numbers are described in the CNC diagnostics manual ([DIAG]). 98 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 99

kernelv API functions 3.64.3.3 kernelv_get_error_reaction() Prototype signed short int kernelv_get_error_reaction(void); Description Returns the error reaction class of an error message previously read by kernelv_read_error(). If no error message was read or there is no current error message, the value -1 is returned. Parameter - Return values Type: signed short int -1 if there is no current error message; otherwise the error reaction class (see also [DIAG]). Error reaction class Internal error reaction 1 No reaction. Only possible in the event of a warning (error class 1). 2 NC program execution aborted and transition to error state. If an error occurs in the NC block preparation area, the interpolator executes the NC blocks that have already been prepared. In this case, the time between the occurrence of the error and machine standstill depends on the type and number of buffered NC blocks. The BF reporting the error assumes an error state. 3 Job execution aborted and transition to normal state. After an error message, BFs that provide services for other BFs (servers), for example AXIS ADMINISTRATION, FILE ADMINISTRATION, MANUAL MODE, etc., abort job execution and return to normal state. 4 Motion stopped (feedhold) for the entire axis group and transition to error state. 5 Abrupt axis stop for defective axis, feedhold for the other axes in the axis group and transition to an error state. 6 Abrupt axis stop for all axes and transition to an error state. Position control assumes an error state. 7 Closed–loop controlled axis stop for defective axis, feedhold for the other axes in the axis group and transition to an error state. 8 Open–loop controlled axis stop for defective axis, feedhold for the other axes in the axis group and transition to an error state. The position control loop of the defective axis is opened. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 99 Virtual NCK
## Page 100

kernelv API functions 3.64.3.4 kernelv_get_error_severity() Prototype signed short int kernelv_get_error_severity(void); Description Returns the error remedy class of an error message previously read by kernelv_read_error(). If no error message was read or there is no current error message, the value -1 is returned. Parameter - Return values Type: signed short int -1 if there is no current error message; otherwise the error remedy class (see also [DIAG]). Error remedy class Internal error remedy 0 Error message acts as warning; this causes automatically an internal error remedy. 2 Requires complete reset of the NC channel. 5 Requires complete reset of the NC channel. 6 Requires restart of the CNC channel. 7 Requires restart of the entire NC kernel after switch-off. 100 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 101

kernelv API functions 3.64.3.5 kernelv_get_error_channel() Prototype signed short int kernelv_get_error_channel(void); Description Returns the channel number of the channel in which an error message previously read by kernelv_read_error() occurred. If no error message was read or there is no current error message, the value -1 is returned. Parameter - Return values Type: signed short int 0 if there is no current error message; otherwise the channel number. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 101 Virtual NCK
## Page 102

kernelv API functions 3.64.3.6 kernelv_get_error_message_string() Prototype KERNELV_RETURN kernelv_get_error_message_string(char * string, unsigned long int *length); Description Returns the formatted string of an error message previously read by kernelv_read_error() in the form of a string. The returned string is identical to the string returned by the function kernelv_get_error(). When called, the ‘string’ parameter transfers a pointer to the memory for the return string. The size of this memory area is contained in ‘length’. If the memory provided is sufficient to return the string, the length of the returned string is returned in ‘length’. If the memory provided by the calling application is too small for the string to be returned, the return value ERR_CNC_RET_MEMORY is returned In this case, the 'length' parameter contains the size in bytes required to return the string. Parameter Name Type Meaning string char* Pointer to string for error message string. The calling application must provide the memory. length unsigned long* Size of memory for the error message string. No string is returned if the error message string generated by the simulation CNC is longer than the memory provided. Either the length of the returned string is returned or the size of the memory area required for the return. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the 'return Size’ parameter. 102 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 103

kernelv API functions 3.64.3.7 kernelv_get_error_id_text() Prototype KERNELV_RETUR kernelv_get_error_message_string(char * string, N unsigned long int *length); Description Returns the error message text belonging to the current error number of an error message previously read by kernelv_read_error(). When called, the ‘string’ parameter transfers a pointer to the memory for the return string, The size of this memory area is contained in ‘length’. If the memory provided is sufficient to return the string, the length of the returned string is returned in ‘length’. If the memory provided by the calling application is too small for the string to be returned, the return value ERR_CNC_RET_MEMORY is returned In this case, the 'length' parameter contains the size in bytes required to return the string. Parameter Name Type Meaning string char* Pointer to string for error message string. The calling application must provide the memory. length unsigned long* Size of memory for the error message string. No string is returned if the error message string generated by the simulation CNC is longer than the memory provided. Either the length of the returned string is returned or the size of the memory area required for the return. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the 'return Size’ parameter. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 103 Virtual NCK
## Page 104

kernelv API functions 3.64.3.8 kernelv_get_error_message_values() Prototype KERNELV_RETURN kernelv_get_error_message_string (KERNELV_ERROR_VALUE * p_values, unsigned long int *length); Description Returns the values output in an error message. Before using this function, a check must first be made whether there is a current error by calling the function kernelv_read_error(). The values are returned in an array of structures of type KERNELV_ERROR_VALUE. The array size is KERNELV_ERROR_VALUE_COUNT. Specify the size of the memory areas for the error message values in the ‘length’ call parameter. If the return array does not fit in the memory provided, the return value ERR_CNC_RET_MEMORY is output and ‘length’ contains the memory size in bytes required for the return. Parameter Name Type Meaning p_values KERNELV_ERROR_ Pointer to string for error message values. The calling application VALUE* must provide the memory. length unsigned long* Size of memory for the error message values. If the memory provided is not large enough, the required memory size in bytes is returned; otherwise the number of bytes is returned. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the 'length’ parameter. 104 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 105

kernelv API functions 3.64.3.9 kernelv_get_error_cycle_time() Prototype unsigned long long int kernelv_get_error_cycle_time(void); Description Returns the CNC cycle in which an error message previously read by kernelv_read_error() occurred. If no error message was read or there is no current error message, the value 0 is returned. Parameter - Return values Type: unsigned long int 0 if there is no current error message; otherwise the CNC cycle in which the error message occurred. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 105 Virtual NCK
## Page 106

kernelv API functions 3.64.4 Error messages caused by NC programs With error messages caused by an NC program, it is possible to request additional information about the NC program in which the error occurred. This information can then be used to localise the error in the NC program. A check is first made whether the NC program contains specific information by calling the function kernelv_is_program_err(). If this function returns the value 1, the current error message was caused by an NC program and further information about the error in the NC program can be called by calling the functions below. 3.64.4.1 kernelv_error_is_program_error() Prototype unsigned char kernelv_error_is_program_error(void); Description Indicates whether the current error was caused by a CNC program. Parameter - Return values Value Meaning 0 The current error message was not caused by an NC program or there is no error. 1 The current error message was caused by an NC program. 106 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 107

kernelv API functions 3.64.4.2 kernelv_program_error_get_path Prototype KERNELV_RETURN kernelv_program_error_get_path(char *return_string, unsigned long * return_length); Description Returns the program path used to start the active program. If the program was started by the absolute specification of a file name, an empty string is returned; if the current active program is a manual block, “-” is returned (less the inverted commas). A zero terminated string is returned. The number of returned bytes is returned in return_length, i.e. including the terminating zero. If the memory provided by the calling application is too small for the string to be returned, the return value ERR_CNC_RET_MEMORY is returned In this case, the return Length parameter contains the size in bytes required for returning the string. Parameter Name Type Meaning return_string char* Pointer to string for the program path. The calling application must provide the memory. return_length unsigned long* Size of memory for the return value. If the return string is longer than the memory provided, nothing is returned. Either the length of the returned string is returned or the size of the memory area required for the return. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the ‘length’ parameter. ERR_CNC_NO_DATA -28 The requested data is not available. There is no available NC program specific data relating to an CNC error. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 107 Virtual NCK
## Page 108

kernelv API functions 3.64.4.3 kernelv_program_error_get_program_name Prototype KERNELV_RETURN kernelv_program_error_get_program_name (char *return_string, unsigned long * return Length); Description Returns the program name of the active NC program. The program name is specified at the start of the main program by a "%” character; for more information see [PROG]. If no program name was specified for the NC program, an empty string is returned. A zero terminated string is returned. The number of returned bytes is returned in return_length, i.e. the terminating zero is included. If the memory provided by the calling application is too small for the string to be returned, the return value ERR_CNC_RET_MEMORY is returned In this case, the return Length parameter contains the size in bytes required for returning the string. Parameter Name Type Meaning return_string char* Pointer to string for the program name. The calling application must provide the memory. return_length unsigned long* Size of memory for the return value. If the return string is longer than the memory provided, nothing is returned. Either the length of the returned string is returned or the size of the memory area required for the return. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the ‘length’ parameter. ERR_CNC_NO_DATA -28 The requested data is not available. 108 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 109

kernelv API functions 3.64.4.4 kernelv_program_error_get_file_name Prototype KERNELV_RETURN kernelv_program_error_get_file_name(char *return_string, unsigned long * return Length); Description Returns the file name of the active NC program. If the program was started by specifying an absolute program name, the compete program name is returned. If the CNC controller opened the NC program by using a search path, this function returns the file name specified at program start. The search path used can be requested by the function kernelv_program_error_get_path(). The function returns the number of returned bytes in return Length, i.e. including the zero terminating the string. If the memory provided by the calling application is too small for the string to be returned, the return value ERR_CNC_RET_MEMORY is returned In this case, the return Length parameter contains the size in bytes required for returning the string. Parameter Name Type Meaning return_string char* Pointer to string for the program path. The calling application must provide the memory. return_length unsigned long* Size of memory for the return value. If the return string is longer than the memory provided, nothing is returned. Either the length of the returned string is returned or the size of the memory area required for the return. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. The number of bytes required is returned in the ‘length’ parameter. ERR_CNC_NO_DATA -28 The requested data is not available. There is no available NC program specific data relating to an CNC error. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 109 Virtual NCK
## Page 110

kernelv API functions 3.64.4.5 kernelv_program_error_get_fileoffset Prototype KERNELV_RETURN kernelv_program_error_get_fileoffset(unsigned long * fileoffset); Description Returns the file offset of the error in the program file. Parameter Pointer to memory location for the file offset. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NO_DATA -28 The requested data is not available. There is no available NC program specific data relating to an CNC error. 3.64.4.6 kernelv_program_error_get_lineoffset Prototype KERNELV_RETURN kernelv_program_error_get_linenoffset(unsigned short int*); Description Returns the offset of the error in the NC line Parameter Pointer to the memory location for line offset. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NO_DATA -28 The requested data is not available. There is no available NC program specific data relating to an CNC error. 110 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 111

kernelv API functions 3.64.4.7 kernelv_program_error_get_tokenoffet Prototype KERNELV_RETURN kernelv_program_error_get_tokenoffset(unsigned short int*); Description Returns the offset of the error in the parsed NC_token. Parameter Pointer to the memory location for token offset. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NO_DATA -28 The requested data is not available. There is no available NC program specific data relating to an CNC error. 3.64.4.8 kernelv_program_error_get_linenumber Prototype KERNELV_RETURN kernelv_program_error_get_linenumber(signed long * linenumber); Description Returns the programmed BNC line number of the error in the program file. Parameter Pointer to the memory location for line number Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_CNC_NO_DATA -28 The requested data is not available. There is no available NC program specific data relating to an CNC error. 3.65 Coordinate systems and offsets The programming coordinate system in an NC program can be adapted to the given requirements by NC commands, e.g. by rotating or shifting the coordinate system. The NC commands used here include #CS DEF/#CS ON or #ACS DEF/#ACS ON. For details please see the Programming Manual, Section ‘Coordinate systems’. Coordinate systems can also be concatenated by the repeated used of these commands. The resulting coordinate system is then formed by a stack of subordinate coordinate systems. Other coordinate systems can be added to this coordinate system stack by other NC commands (#CS ADD*) without them having any effect, i.e. influencing the resulting coordinate system. The command #CS SELECT* defines the coordinate system to be used. Within each coordinate system, offsets can be defined for each of the axes in the channel, e.g. by the commands G54 … G59 (zero offset) or G92 (reference point offset). TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 111 Virtual NCK
## Page 112

kernelv API functions The following information is read out by the API functions provided: Number of defined coordinate systems Index of the active coordinate system in the coordinate system stack Information about a coordinate system at a specific index in the stack Information about axis-specific offsets within a coordinate system in the stack *This NC command is not available in all versions. 3.65.1 kernelv_ch_get_cs_name() Prototype KERNELV_RETURN kernelv_ch_get_cs_name(unsigned long int chan Index, unsigned short cs Index, char *name, unsigned long int buffer Size, unsigned long int *ret Bytes); Description Returns the name of the coordinate system defined in the NC program. If no coordinate system is defined in the coordinate system stack at the location defined by cs Index, an empty string is returned and the return value of the function is ERR_CNC_NO_DATA. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. cs Index unsigned short Index of the coordinate system in the coordinate system stack. name char* Pointer to the memory location for the coordinate system name. name Length unsigned long Length of the memory area for the coordinate system name. return Length unsigned long* Pointer to the value to which the actually returned number of bytes is to be written. The number of characters is returned in the file name +1. If the transferred memory is too small for the return value, the return value ERR_CNC_RET_MEMORY is returned and this parameter returns the required memory size. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the minimum size required for the return is returned in return Length. ERR_READ_ERR -26 An error occurred on reading data from the kernelv DLL. ERR_CNC_NO_DATA -28 The requested data is not available. No coordinate system is defined in the coordinate system stack at the location specified by the call parameter cs Index. An empty string is returned. ERR_INVALID_PARAMETER -30 An invalid parameter was transferred: 112 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 113

kernelv API functions The coordinate system index transferred in the parameter cs Index is higher than the maximum possible index in the coordinate system stack. 3.65.2 kernelv_ch_get_cs_rot_matrix() Prototype KERNELV_RETURN kernelv_ch_get_cs_rot_matrix(unsigned long int chan Index, unsigned short cs Index, double *matrix, unsigned long int buffer Size, unsigned long int *ret Bytes); Description Returns the rotation matrix of the coordinate system specified by the parameter cs Index. A 3x3 rotation matrix is returned. It can be used to generate the coordinate system from the subordinate coordinate system. The rotation matrix generated by the parameters ϕ1, ϕ2 ϕ3 of the following NC command is returned: #CS DEF [CS1] [ <v1>,<v2>,<v3>,<ϕ1>,<ϕ2>,<ϕ3> ] If no coordinate system is defined at the specific index in the coordinate system stack, a standard matrix is returned and the return value of the function is ERR_CNC_NO_DATA. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. cs Index unsigned short Index of the coordinate system in the coordinate system stack. matrix double* Pointer to the memory location for the rotation matrix. buffer Size unsigned long Length of the memory area for the rotation matrix must be at least 3 x 3 x sizeof(double). return Length unsigned long* Pointer to the value to which the actually returned number of bytes is to be written. If the transferred memory is too small for the return value, the return value ERR_CNC_RET_MEMORY is returned and this parameter returns the required memory size. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the minimum size required for the return is returned in return Length. ERR_READ_ERR -26 An error occurred on reading data from the kernelv DLL. ERR_CNC_NO_DATA -28 The requested data is not available. No coordinate system is defined in the coordinate system stack at the location specified by the call parameter cs Index. The standard matrix is returned. ERR_INVALID_PARAMETER -30 An invalid parameter was transferred: TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 113 Virtual NCK
## Page 114

kernelv API functions The coordinate system index transferred in the parameter cs Index is higher than the maximum possible index in the coordinate system stack. 3.65.3 kernelv_ch_get_cs_shift_vector() Prototype KERNELV_RETURN kernelv_ch_get_cs_shift_vector(unsigned long int chan Index, unsigned short cs Index, double *vector, unsigned long int buffer Size, unsigned long int *ret Bytes); Description Returns the shift of the origin of the coordinate system specified by the parameter cs Index. A vector with three elements is returned, specifying the shift of the coordinate system origin to the origin of the subordinate coordinate system. The shift vector that is generated by the parameters v1, v2, v3 of the following NC command is returned: #CS DEF [CS1] [ <v1>,<v2>,<v3>,<ϕ1>,<ϕ2>,<ϕ3> ] If no coordinate system is defined at the specific index in the coordinate system stack, a zero vector is returned and the return value of the function is ERR_CNC_NO_DATA. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. cs Index unsigned short Index of the coordinate system in the coordinate system stack. vector double* Pointer to the memory location for the shift vector. buffer Size unsigned long Length of the memory area for the rotation matrix must be at least 3 x sizeof(double). return Length unsigned long* Pointer to the value to which the actually returned number of bytes is to be written. If the transferred memory is too small for the return value, the return value ERR_CNC_RET_MEMORY is returned and this parameter returns the required memory size. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the minimum size required for the return is returned in return Length. ERR_READ_ERR -26 An error occurred on reading data from the kernelv DLL. ERR_CNC_NO_DATA -28 The requested data is not available. No coordinate system is defined in the coordinate system stack at the location specified by the call parameter cs Index. A zero vector is returned. ERR_INVALID_PARAMETER -30 An invalid parameter was transferred: 114 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 115

kernelv API functions The coordinate system index transferred in the parameter cs Index is higher than the maximum possible index in the coordinate system stack. 3.65.4 kernelv_ch_get_cs_count() Prototype KERNELV_RETURN kernelv_ch_get_cs_count(unsigned long int chan Index, unsigned short *count); Description Returns the number of defined coordinate systems. Even if no coordinate system is defined in the NC program, there is always a basic coordinate system at coordinate system stack level 0. Its rotation matrix is the standard matrix and its shift vector is the zero vector. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. count unsigned short* Pointer to the memory location for the number of coordinate systems. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_READ_ERR -26 An error occurred on reading data from the kernelv DLL. 3.65.5 kernelv_ch_get_active_cs_index() Prototype KERNELV_RETURN kernelv_ch_get_cs_count(unsigned long int chan Index, unsigned short *cs Index); Description Returns the index of the active coordinate system. Even if no coordinate system is defined in the NC program, there is always a basic coordinate system at coordinate system stack level 0. Its rotation matrix is the standard matrix and its translation vector is the zero vector. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. cs Index unsigned short* Pointer to the memory location for the index of coordinate systems. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 115 Virtual NCK
## Page 116

kernelv API functions Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_READ_ERR -26 An error occurred on reading data from the kernelv DLL. 3.65.6 kernelv_ch_axis_get_offsets() Prototype KERNELV_RETURN kernelv_ch_axis_get_offsets(unsigned long int chan Index, unsigned long int axis Index, unsigned short int cs Index, signed long int *offsets, unsigned long int buffer Size, unsigned long int *ret Bytes); Description Returns the axis-specific offsets in the coordinate system specified by the parameter cs Index. The parameter axis Index identifies the index of the axis in the NC channel specified by Chan Index. A vector with eight elements is returned. It lists the offsets imported by the various NC commands for the axis defined by axis Index. The enumeration KERNELV_AXIS_OFFSET_TYPES specifies the assignment of the index in the vector to the various offset types. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. axis Index unsigned long Index of the axis in the NC channel. cs Index unsigned short Index of the coordinate system in the coordinate system stack. offsets signed long* Pointer to the memory location for the offset vector. name Length unsigned long Length of the memory area for the rotation matrix must be at least 8 x sizeof (signed long int). return Length unsigned long* Pointer to the value to which the actually returned number of bytes is to be written. If the transferred memory is too small for the return value, the return value ERR_CNC_RET_MEMORY is returned and this parameter returns the required memory size. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the minimum size required for the return is returned in return Length. 116 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 117

kernelv API functions ERR_READ_ERR -26 An error occurred on reading data from the kernelv DLL. ERR_CNC_NO_DATA -28 The requested data is not available. No coordinate system is defined in the coordinate system stack at the location specified by the call parameter cs Index. A zero vector is returned. ERR_INVALID_PARAMETER -30 An invalid parameter was transferred: The coordinate system index transferred in the parameter cs Index is higher than the maximum possible index in the coordinate system stack. 3.65.7 kernelv_ch_get_total_cs_rot_matrix() Prototype KERNELV_RETURN kernelv_ch_get_total_cs_rot_matrix(unsigned long int chan Index, double *matrix, unsigned long int buffer Size, unsigned long int *ret Bytes); Description Returns the rotation matrix generated by concatenating all active coordinate systems. The rotation matrix generated by the parameters ϕ1, ϕ2 ϕ3 of the following NC command is returned: #CS DEF [CS1] [ <v1>,<v2>,<v3>,<ϕ1>,<ϕ2>,<ϕ3> ] If no coordinate system is active, the standard matrix is returned. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. matrix double* Pointer to the memory location for the rotation matrix. buffer Size unsigned long Length of the memory area for the rotation matrix must be at least 3 x 3 x sizeof(double). return Length unsigned long* Pointer to the value to which the actually returned number of bytes is to be written. If the transferred memory is too small for the return value, the return value ERR_CNC_RET_MEMORY is returned and this parameter returns the required memory size. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the minimum size required for the return is returned in return Length. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 117 Virtual NCK
## Page 118

kernelv API functions 3.65.8 kernelv_ch_get_total_cs_offset Prototype KERNELV_RETURN kernelv_ch_get_total_cs_offset(unsigned long int chan Index, double *vector, unsigned long int buffer Size, unsigned long int *ret Bytes); Description Returns the shift of the origin of the coordinate system resulting from concatenating all active coordinate systems. A vector with three elements is returned, specifying the shift of the coordinate system origin to the origin of the basic coordinate system. The shift vector that is generated by the parameters v1, v2, v3 of the following NC command is returned: #CS DEF [CS1] [ <v1>,<v2>,<v3>,<ϕ1>,<ϕ2>,<ϕ3> ] If no coordinate system is active, a zero vector is returned. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. vector double* Pointer to the memory location for the translation vector. buffer Size unsigned long Length of the memory area for the rotation matrix must be at least 3 x sizeof(double). return Length unsigned long* Pointer to the value to which the actually returned number of bytes is to be written. If the transferred memory is too small for the return value, the return value ERR_CNC_RET_MEMORY is returned and this parameter returns the required memory size. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the minimum size required for the return is returned in return Length. 118 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 119

kernelv API functions 3.65.9 kernelv_ch_get_total_cs_def() Prototype KERNELV_RETURN kernelv_ch_get_total_cs_def(unsigned long int chan Index, double *vector, unsigned long int buffer Size, unsigned long int *ret Bytes); Description Returns the shift and rotation angle of the coordinate system resulting from concatenating all active coordinate systems. A vector with six elements is returned. The first three elements contain the shift of the coordinate system origin to the origin of the basic coordinate system. The three following vector elements contain the rotation angle in degrees required to generate the coordinate system from the basic coordinate system. Similar to the documentation of the #CS documentation, the sequence to execute the rotations is ϕ3, . ϕ2, ϕ1 in this order. #CS DEF [CS1] [ <v1>,<v2>,<v3>,<ϕ1>,<ϕ2>,<ϕ3> ] Index Meaning in the #CS command 0 <v1> 1 <v2> 2 <v3> 3 <ϕ1> 4 <ϕ2> 5 <ϕ3> If no coordinate system is active, a zero vector is returned. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. vector double* Pointer to the memory location for the translation vector. buffer Size unsigned long Length of the memory area for the rotation matrix must be at least 3 x sizeof(double). return Length unsigned long* Pointer to the value to which the actually returned number of bytes is to be written. If the transferred memory is too small for the return value, the return value ERR_CNC_RET_MEMORY is returned and this parameter returns the required memory size. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. In this case, the minimum size required for the return is returned in return Length. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 119 Virtual NCK
## Page 120

kernelv API functions 3.65.10 kernelv_ch_get_coord_sys_active() Prototype KERNELV_RETURN kernelv_ch_get_coord_sys_active(unsigned long int chan Index, unsigned char *active); Description Returns the number of the current active kinematic transformation. If no kinematic transformation is active, a zero is returned. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. active unsigned short* Pointer to the memory area for return values. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 3.66 Kinematic transformations 3.66.1 kernelv_ch_get_kin_trafo_active() Prototype KERNELV_RETURN kernelv_ch_get_kin_trafo_active(unsigned long int chan Index, unsigned char *active); Description Returns whether a coordinate system is active in the specified channel or not. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. active unsigned char* Pointer to the memory area for return values. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 120 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 121

kernelv API functions 3.66.2 kernelv_ch_get_active_kin_id() Prototype KERNELV_RETURN kernelv_ch_get_active_kin_id(unsigned long int chan Index, unsigned short *kin_id); Description Returns the number of the current active kinematic transformation. If no kinematic transformation is active, a zero is returned. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel. kin_id unsigned short* Pointer to the memory area for return values. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 3.67 External measuring hardware By default, measurement runs are simulated in the kernelv DLL for the measurement simulation configured for each axis. The following measurement methods are available: • “Measuring with external measuring hardware“ (default) • “Measuring with external interface with measured value detected in the drive” (as of V3.1.3080.05) The interface to the external measuring hardware consists of the following parts: • Command interface from the CNC to the PLC or to the DLL user. • Acknowledgement interface from the PLC or from the user to the CNC: The measured value is detected by measurement simulation in the CNC. Measurement method “Measuring with external measuring hardware“ With the measurement variant “Measuring with external measuring hardware”, the interface on the HLI to the external measuring hardware is made accessible to the user via API functions. The user then has the possibility to use measuring methods for real-time control implemented in the PLC with the kernelv DLL. The sequence of a measurement run using the external measuring interface is as follows: TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 121 Virtual NCK
## Page 122

kernelv API functions CNC sets comand CNC sets command "Enable probe" "Disable probe" Ext Latch Control. X_Please PLC acknowledges execution PLC acknowledges execution Ext Latch Control. X_Done PLC signals "Position Measuring event latched" Meausring signal Probing Signal. X_Command PLC provides measured position Measured value Probing Position. X_Command CNC-measuring traverse G100 X... Fig. 5: Schematic sequence of a measurement run When the external measuring interface is used, the internal measurement simulation for the axis must be deactivated by setting the axis parameter P-AXIS-00112 to the value 0. The following functions are required to use this measuring method: • kernelv_ax_get_ext_latch_command [} 123](), • kernelv_ax_acknowledge_ext_latch_command [} 124]() • kernelv_ax_set_ext_latch_event [} 125]() • kernelv_ax_set_ext_latch_event_pos [} 124]() The command interface is queried by the function kernelv_ax_get_ext_latch_command(), the command is acknowledged by kernelv_ax_acknowledge_ext_latch_command(), the latch event is set and if required the latch value is tracked by kernelv_ax_set_ext_latch_event() or by kernelv_ax_set_ext_latch_event_pos(). 122 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 123

kernelv API functions Measuring method “Measuring with external measuring interface with measured value detected in the drive” The procedure for a measurement run using the external measuring interface with measured value detected in the drive is as follows: Fig. 6: Signal profile of a radio measuring button with measured value detected in the drive When the external measuring interface with measured value detected in the drive is used, the internal measurement simulation for the axis must be activated by setting the axis parameter P-AXIS-00112 to the value 1 The following functions are required to use this measuring method: • kernelv_ax_get_ext_latch_command [} 123](), • kernelv_ax_acknowledge_ext_latch_command [} 124](), The command interface is queried by the function kernelv_ax_get_ext_latch_command(). The command is acknowledged by kernelv_ax_acknowledge_ext_latch_command(), 3.67.1 kernelv_ax_get_ext_latch_command() Prototype KERNELV_RETURN kernelv_ch_get_active_kin_id(unsigned long int ax Index, KERNELV_EXT_LATCH_COMMAND_DATA *data); Description Returns the content of the command interface for the external measuring hardware to the structure KERNELV_EXT_LATCH_COMMAND_DATA. Parameter Name Type Meaning TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 123 Virtual NCK
## Page 124

kernelv API functions ax Index unsigned long Index of the axis. data KERNELV_EXT_LA Pointer to the structure of type TCH_COMMAND_D KERNELV_EXT_LATCH_COMMAND_DATA to return the value. ATA * Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. REST_BUSY 1 The function is currently being executed, but has not yet been completed. The API function must continue to be called. ERR_INVALID_AX -9 The transferred axis index is higher than the number of configured channels – 1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 3.67.2 kernelv_ax_acknowledge_ext_latch_command() Prototype KERNELV_RETURN kernelv_ax_acknowledge_ext_latch_command(unsigned long int ax Index); Description Acknowledges any pending measuring command to the external measuring hardware. If a command is active and was acknowledged, the return value is the function RET_FINISHED. Otherwise the return value is ERR_NO_DATA. Parameter Name Type Meaning ax Index unsigned long Index of the axis. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. RET_BUSY 1 The function is currently being executed, but has not yet been completed. The API function must continue to be called. ERR_INVALID_AX -9 The transferred axis index is higher than the number of configured axes –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_NO_DATA -28 The requested data is not available. 3.67.3 kernelv_ax_set_ext_latch_event_pos() Prototype KERNELV_RETURN kernelv_ax_set_ext_latch_event_pos(unsigned long int ax Index, signed long int DATA position); 124 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 125

kernelv API functions Description Indicates the occurrence of the latch event to the CNC and transfers the latched position. The latched position must be transferred in 0.1 um or 1E-4°. Parameter Name Type Meaning ax Index unsigned long int Index of the axis. position signed long int Latch position in 0.1 µm for translatory axes or 1*10-4° for spindles or rotary axes. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_AX -9 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NO_DATA -28 No latch command is active. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 3.67.4 kernelv_ax_set_ext_latch_event() Prototype KERNELV_RETURN kernelv_ax_set_ext_latch_event(unsigned long int ax Index); Description Indicates the occurrence of the latch event to the CNC as a latched value; the current actual position of the axis is transferred. Parameter Name Type Meaning ax Index unsigned long int Index of the axis. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_AX -9 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NO_DATA -28 No latch command is active. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 125 Virtual NCK
## Page 126

kernelv API functions 3.68 kernelv_ch_get_timer() Prototype KERNELV_RETURN kernelv_ch_get_timer (unsigned long int chan Index, unsigned short int timer Id, unsigned long int* time); Description This returns the time in ms and is stored in the specified channel in the variable V. G. TIMER[<counter_number>]. Parameter Name Type Meaning chan Index unsigned long int Channel index timer Id unsigned short int Counter number for the variable V. G. TIMER[] Time unsigned long int* Pointer to the memory area where the time in ms is written. Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_INVALID_PARAMETER -30 The transferred parameter timerld is invalid. Valid range for timer ID: 0<= timer ID <= 127 ER_NULL_PARAMETER -35 The timer pointer is not referenced. 3.69 kernelv_get_production_time() Prototype KERNELV_RETURN kernelv_get_production_time(double* production Time, KERNELV_PT_FILE files); Description Starts an NC program in the corresponding channel for each string that is not empty in the KERNELV_PT_FILES structure. The first element is started in the first channel, the second element in the second channel, etc. If no program is started in a channel, the string must be 0 at the appropriate index. Only configured programs can be started in channels. The total processing time of all started NC programs is returned. Parameter Name Type Meaning production Time double* Pointer to the memory area where the production time is written in s. files KERNELV_PT_FILE Structure where the names of NC programs are stored. S 126 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 127

kernelv API functions Return values Symbol Value Meaning RET_FINISHED 0 The transferred NC programs have all been successfully ended. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_INTERNAL_ERROR -11 An internal error has occurred in the DLL. The value could not be written. ERR_NC_PROGRAM -32 An error has occurred in the NC program. ERR_CH_ERROR_STATE -33 The channel is in error state. 3.70 kernelv_diagnosis_upload() Prototype KERNELV_RETURN kernelv_diagnosis_upload(char* filename); Description Starts uploading the internal diagnosis data of the DLL and writes it to the file with the name filename. If no filename is specified, the data is saved to diag_data.txt. If filename contains no path, the file is written to the current path. Parameter Name Type Meaning Filename char* Name of the file to which data is written. Return values Symbol Value Meaning RET_FINISHED 0 The upload is finished. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 3.71 kernelv_ch_get_status_singularity_avoidance() Prototype KERNELV_RETURN kernelv_ch_get_status_singularity_avoidance (unsigned long int chan Index, unsigned char *active); Description Reads out the current activity status of singularity avoidance in the specified channel. Returns the activity status, i.e. whether the currently interpolated motion block should avoid a kinematic singularity. Parameter Name Type Meaning chan Index unsigned long Channel index of the channel from which the variable is to be read. active unsigned char* Pointer to the activity status (1/TRUE = active, 0/FALSE = inactive) TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 127 Virtual NCK
## Page 128

kernelv API functions Return values Symbol Value Meaning RET_FINISHED 0 The function was executed without error. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels –1 ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. 128 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 129

kernelv API types 4 kernelv API types All listed types are defined in the file kernelv.h . 4.1 Enum KERNELV_RETURN Description Return values and error codes of API functions. Symbol Value Meaning RET_FINISHED 0 The function was executed without error. RET_BUSY 1 The function is currently being executed, but has not yet been completed. The API function must continue to be called. ERR_INVALID_CHAN -1 The transferred channel index is higher than the number of configured channels -1. ERR_PROG_NAME_LENGTH -2 The transferred program name is longer than permitted. ERR_CNC_NOT_INIT -3 The simulation CNC kernel was not yet initialised. ERR_CNC_RET_MEMORY -4 The return value(s) does/do not fit into the memory provided. ERR_INVALID_STATE -5 The CNC channel is in the wrong state for executing a function. ERR_DOUBLE_KERNEL -6 An instance of the simulation CNC is running and uses the same instance prefix. This may occur if 2 instances of kernelv were started with the function call kernelv_startup() or the same instance prefix was used several times when kernelv_startup_instance() was called. ERR_SHM_STARTUP -7 Internally used shared memories could not be created when starting. ERR_STARTUP -8 An error occurred on starting the simulation CNC. Possible causes are missing parameter lists or incorrect entries in parameter lists. ERR_INVALID_AX -9 The transferred axis index is higher than the number of configured axes -1 ERR_AXIS_ERROR -10 The CNC axis indicates an error. The CNC additionally issues an error message. ERR_INTERNAL_ERROR -11 An internal error has occurred in the DLL. ERR_UNKNOWN_VARIABLE -12 The variable name is not known in the CNC kernel. ERR_VARIABLE_SYNTAX -13 The variable name is syntactically incorrect, e.g. no closing bracket in the case of an array variable. ERR_DATA_TYPE_MISMATC -14 On write access to a variable, the transferred data type does not H match the data type used internally in the CNC. Symbol Value Meaning ERR_UNKNOWN_TECHNO_T -15 An invalid type was specified for a technology function when its YPE execution time was set. ERR_INVALID_TECHNO_PAR -16 An invalid parameter was transferred when the execution time was AM set for a technology function, e.g. transferred number of the M or H function is higher than the maximum permitted number. ERR_NO_LICENSE -17 No license was found for the use of the kernelv DLL. ERR_VAR_NAME_LENGTH -18 The variable name passed on to the function exceeds the maximum permissible length (KERNELV_VAR_NAME_LENGTH). ERR_REGISTRY_ACCESS -19 An error occurred when an attempt was made to read values from the Windows registry. ERR_UNKNOWN_OPTION -20 An unknown option was transferred to the function kernelv_set_options(). TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 129 Virtual NCK
## Page 130

kernelv API types ERR_ARRAY_NOT_SUPPORT -21 With many CNC real-time variants, an array can be read or written ED ‘en block’ by omitting the array index at access. The kernelv DLL does not currently support this access type. ERR_VAR_NOT_WRITEABLE -22 An attempt was made to write a non-writeable variant. For write access to variables, the same access rules apply as within an NC program. The only exception here are V. E. variables. They can always be written irrespective of the access rights configured. ERR_PREFIX_TOO_LONG -23 When the function kernelv_startu_prefix() is called, the transferred instance identifier is too long with the result that the internally generated names for the shared memories used no longer fit in the memory provided. . The permitted length is defined in the preprocessor constant KERNELV_INSTANCE_PREFIX_MAX_LEN. ERR_DOUBLE_INSTANCE -24 A kernelv instance was already started from this DLL. It is not possible to start several kernelv instances from an application. ERR_INVALID_START_MODE -25 An invalid start mode was transferred when the function kernelv_ch_program_start() was started. For valid execution mode values, see E_KERNELV_PROG_START_MODE. ERR_READ_ERR -26 An error occurred on reading data from the kernelv DLL. ERR_WRITE_ERR -27 An error occurred when data is written to the kernelv DLL. ERR_CNC_NO_DATA -28 The requested data is not available. ERR_TECHNO_NOT_FOUND -29 The specified technology function was not found. ERR_INVALID_PARAMETER -30 An invalid parameter was transferred. ERR_STARTUP_CHAN_INIT -31 When kernelev-Dll was started, it was not possible to execute the initialisation of the configured NC channels. Symbol Value Meaning ERR_NC_PROGRAM -32 An error has occurred in the NC program. ERR_CH_ERROR_STATE -33 The channel is in error state. ERR_TIME_OUT -34 The function could not be ended within the limit. ERR_NULL_PARAMETER -35 An unreferenced pointer was transferred. 130 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 131

kernelv API types 4.2 KERNELV_CHANNEL_STATE Enumeration CNC_SIMU_CHANNEL_STATE describes the state of a CNC channel. The state of a CNC channel is described by the following state diagram: Symbol Value Meaning KERNELV_STATE 1 Channel state is DESELECTED. _DESELECTED KERNELV_STATE 2 Channel state is SELECTED. _SELECTED KERNELV_STATE_READY 3 Channel state is READY. KERNELV_STATE_ACTIVE 4 Channel state is ACTIVE, and an NC program is currently being executed. KERNELV_STATE_HOLD 5 Channel state is HOLD. An NC program has been started and then stopped. KERNELV_STATE_ERROR 6 Channel state is ERROR. KERNELV_STATE 7 Channel state is SELECTING. _SELECTING KERNELV_STATE 8 Channel state is DESELECTING. _DESELECTING KERNELV_STATE 9 Channel state is PREPARING. _PREPARING KERNELV_STATE 10 Channel state is CLEARING. _CLEARING KERNELV_STATE 11 Channel state is STARTING. An NC program is currently being _STARTING started. KERNELV_STATE 12 Channel state is ABORTING. An NC program is currently being _ABORTING aborted. KERNELV_STATE 13 Channel state is STOPPING. A running NC program is stopped. _STOPPING KERNELV_STATE 14 Channel state is RESUMING. A stopped NC program is resumed. _RESUMING KERNELV_STATE 15 Channel state is RESETTING. A reset is currently taking place. _RESETTING TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 131 Virtual NCK
## Page 132

kernelv API types Fig. 7: State diagram of a CNC channel 132 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 133

kernelv API types 4.3 Enum E_KERNELV_TECHNO_TYPE Description Type of a technology function stored in the KERNELV_TECHNO_DATA structure. Symbol Value Meaning KERNELV_TECHNO_EMPTY 0 The structure does not contain any valid values. KERNELV_TECHNO_M_CODE 1 The structure contains an M function. KERNELV_TECHNO_H_CODE 2 The structure contains an H function. KERNELV_TECHNO_S_CODE 3 The structure contains a spindle techno function, e.g. M3, M19 or S. KERNELV_TECHNO_T_CODE 4 The structure contains a tool techno function. 4.4 Struct KERNELV_TECHNO_DATA Description Structure with technology data acknowledged by the CNC kernel. Memory orientation The individual structure elements are packed in the memory Element Type Meaning type E_KERNELV_TECHNO_TYPE Type of the technology function stored in the param element. param U_KERNELV_TECHNO_PARAM Union with the data of the technology function. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 133 Virtual NCK
## Page 134

kernelv API types 4.5 KERNELV_CHANNEL_TECHNO_DATA_ARRAY Description Defines an array of size KERNELV_CHANNEL_TECHNO_DATA_COUNT for structures of the type KERNELV_TECHNO_DATA. typedef KERNELV_TECHNO_DATA KERNELV_CHANNEL_TECHNO_DATA_ARRAY[KERNELV_CHANNEL_TECHNO_DATA_COUNT]; A variable of this type can be transferred to the functions kernelv_ch_get_techno_data() or kernelv_ch_get_new_techno_data() to read technology information. KERNELV_CHANNEL_TECHNO_DATA_ARRAY ch_techno; unsigned long int techno_len; if ( kernelv_ch_get_techno_data(0, ch_techno, sizeof(ch_techno), &techno_len) == RET_FINISHED) { for (int i = 0; i < KERNELV_CHANNEL_TECHNO_DATA_COUNT,i++) . .printf("Type: %d\n", ch_techno[i].type); } 134 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 135

kernelv API types 4.6 KERNELV_CHANNEL_TECHNO_DATA_ARRAY2 Description Defines an array of size KERNELV_CHANNEL_TECHNO_DATA_COUNT for structures of type KERNELV_TECHNO_DATA2. typedef KERNELV_TECHNO_DATA2 KERNELV_CHANNEL_TECHNO_DATA_ARRAY2[KERNELV_CHANNEL_TECHNO_DATA_COUNT]; A variable of this type can be transferred to the functions kernelv_ch_get_techno_data2() or kernelv_get_new_techno_data2() to read technology information. KERNELV_CHANNEL_TECHNO_DATA_ARRAY2 ch_techno; unsigned long int techno_len; if ( kernelv_ch_get_techno_data2(0, ch_techno, sizeof(ch_techno), &techno_len) == RET_FINISHED) { for (int i =0; i < KERNELV_CHANNEL_TECHNO_DATA_COUNT, i++) . .printf("Type: %d\n", ch_techno[i].type); } TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 135 Virtual NCK
## Page 136

kernelv API types 4.7 KERNELV_AXIS_TECHNO_DATA_ARRAY Description Defines an array of size KERNELV_AXIS_TECHNO_DATA_COUNT for structures of the type KERNELV_TECHNO_DATA. typedef KERNELV_TECHNO_DATA KERNELV_AXIS_TECHNO_DATA_ARRAY[KERNELV_AXIS_TECHNO_DATA_COUNT]; A variable of this type can be transferred to the functions kernelv_ch_get_techno_data() or kernelv_ch_get_new_techno_data() to read technology information. KERNELV_CHANNEL_TECHNO_DATA_ARRAY ax_techno; unsigned long int techno_len; if ( kernelv_ax_get_techno_data(0, ax_techno, sizeof(ch_techno), &techno_len) == RET_FINISHED) { for (int i =0; i < KERNELV_CHANNEL_TECHNO_DATA_COUNT ,i++) . .printf("Type: %d\n", ax_techno[i].type); } 4.8 Struct KERNELV_TECHNO_DATA2 Description Structure with technology data acknowledged by the CNC kernel. Memory orientation The individual structure elements are packed in the memory Element Type Meaning type E_KERNELV_TECHNO_TYPE Type of the technology function stored in the param element. param U_KERNELV_TECHNO_PARAM2 Union with the data of the technology function. 136 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 137

kernelv API types 4.9 KERNELV_CHANNEL_TECHNO_DATA_ARRAY2 Description Defines an array of size KERNELV_CHANNEL_TECHNO_DATA_COUNT for structure of type KERNELV_TECHNO_DATA2. typedef KERNELV_TECHNO_DATA2 KERNELV_CHANNEL_TECHNO_DATA_ARRAY2[KERNELV_CHANNEL_TECHNO_DATA_COUNT]; A variable of this type can be transferred to the functions kernelv_ch_get_techno_data2() or kernelv_ch_get_new_techno_data2() to read technology information. KERNELV_CHANNEL_TECHNO_DATA_ARRAY2 ch_techno; unsigned long int techno_len; if ( kernelv_ch_get_techno_data2(0, ch_techno, sizeof(ch_techno), &techno_len) == RET_FINISHED) { for (int i =0; i < KERNELV_CHANNEL_TECHNO_DATA_COUNT ,i++) . .printf("Type: %d\n", ch_techno[i].type); } TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 137 Virtual NCK
## Page 138

kernelv API types 4.10 KERNELV_AXIS_TECHNO_DATA_ARRAY2 Description Defines an array of size KERNELV_AXIS_TECHNO_DATA_COUNT for structures of type KERNELV_TECHNO_DATA2. typedef KERNELV_TECHNO_DATA2 KERNELV_AXIS_TECHNO_DATA_ARRAY2[KERNELV_AXIS_TECHNO_DATA_COUNT]; A variable of this type can be transferred to the functions kernelv_ax_get_techno_data2() or kernelv_ax_get_new_techno_data2() to read technology information. KERNELV_CHANNEL_TECHNO_DATA_ARRAY2 ax_techno; unsigned long int techno_len; if ( kernelv_ax_get_techno_data2(0, ax_techno, sizeof(ch_techno), &techno_len) == RET_FINISHED) { for (int i =0; i < KERNELV_AXIS_TECHNO_DATA_COUNT ,i++) . .printf("Type: %d\n", ch_techno[i].type); } 4.11 Union U_KERNELV_TECHNO_PARAM Description Union with the data of a technology function. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning m_h M_H_CODE_DATA Data of an M/H technology function spindle S_CODE_DATA Data of a spindle technology function tool T_CODE_DATA Data of a tool function. 138 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 139

kernelv API types 4.12 Union U_KERNELV_TECHNO_PARAM2 Description Union with the data of a technology function. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning m_h M_H_CODE_DATA2 Data of an M/H technology function. spindle S_CODE_DATA Data of a spindle technology function. tool T_CODE_DATA Data of a tool function. 4.13 Struct M_H_CODE_DATA Description Data of an M/H function. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning nr unsigned long int Number of the M/H function. duration unsigned long int Set execution time in us when execution simulation is active. 4.14 Struct M_H_CODE_DATA2 Description Data of an M/H function. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning nr unsigned long int Number of the M/H function. duration unsigned long int Set execution time in us when execution simulation is active. add_value signed long int Value additionally programmed in the NC program (M4711 = 123). fillup unsigned long int Fill bytes for 8-byte alignment. 4.15 Enum E_KERNELV_SPINDLE_TYPE Description Type of a technology function stored in the S_CODE_DATA structure. Symbol Value Meaning KERNELV_TECHNO_S_EMPTY 0 The structure does not contain any valid values. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 139 Virtual NCK
## Page 140

kernelv API types KERNELV_TECHNO_S_M3 1 The structure contains an M3 spindle function. KERNELV_TECHNO_S_M4 2 The structure contains an M4 spindle function. KERNELV_TECHNO_S_M5 3 The structure contains an M5 spindle function. KERNELV_TECHNO_S_M19 4 The structure contains an M19 spindle function. 4.16 Struct S_CODE_DATA Description The structure contains the data belonging to a spindle technology function. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning type E_KERNELV_SPINDLE_TYPE Data type of the spindle technology function. axis_number unsigned short int Axis number of the axis to which the technology function was output. revolutions unsigned long int Spindle speed position signed long int Target position of the spindle when the spindle is positioned. duration unsigned long int Set execution time in µs when execution simulation is active. 140 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 141

kernelv API types 4.17 Struct T_CODE_DATA Description The structure contains the data belonging to a tool technology function. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning basic signed long int Basic number of the tool. sister signed long int Number of the sister tool. variant signed long int Variant number of the tool 4.18 Struct KERNELV_NC_LINE_DATA Description The structure of the data belonging to an executed NC program line. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning fileoffset unsigned long int File offset of the executed line in the currently active NC program file nc Line Number unsigned long int NC line number of the executed NC line, if programmed. If no NC line number was programmed, the last line number programmed is entered. filename char[KERNELV_FILE_NAME_-File name of the file that contains the NC line just LENGTH + 1] executed. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 141 Virtual NCK
## Page 142

kernelv API types 4.19 Enum E_KERNELV_VAR_TYPE Description Data type of a data item stored in the structure U_KERNELV_VAR_VALUE. Symbol Value Meaning KERNELV_VAR_TYPE_UNKNOWN 1 The structure does not contain any valid data type. KERNELV_VAR_TYPE_BOOLEAN 2 Data type is unsigned char. Possible values 0 or 1. KERNELV_VAR_TYPE_UNS08 3 Data type is unsigned char. KERNELV_VAR_TYPE_SGN08 4 Data type is signed char. KERNELV_VAR_TYPE_UNS16 5 Data type is unsigned short int. KERNELV_VAR_TYPE_SGN16 6 Data type is signed short int. KERNELV_VAR_TYPE_UNS32 7 Data type is unsigned long int. KERNELV_VAR_TYPE_SGN32 8 Data type is signed long int. KERNELV_VAR_TYPE_DOUBLE 9 Data type is double. KERNELV_VAR_TYPE_STRING 10 The data type is a string with a maximum of 127 (KERNELV_VAR_ STRING_LEN) characters (total length including terminating 0 KERNELV_VAR_STRING_LEN +1 character). 142 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 143

kernelv API types 4.20 Union U_KERNELV_VAR_VALUE Description Union with the possible values of a CNC variable. Memory orientation The individual structure elements are packed in the memory. Element Type identifier Meaning E_KERNELV_VAR_TYPE boolean KERNELV_VAR_TYPE_BOOLEAN Data type is unsigned char. Possible values 0 or 1. uns08 KERNELV_VAR_TYPE_UNS08 Data type is unsigned char. sgn08 KERNELV_VAR_TYPE_SGN08 Data type is signed char. uns16 KERNELV_VAR_TYPE_UNS16 Data type is unsigned short int. sgn16 KERNELV_VAR_TYPE_SGN16 Data type is signed short int. uns32 KERNELV_VAR_TYPE_UNS32 Data type is unsigned long int. sgn32 KERNELV_VAR_TYPE_SGN32 Data type is signed long int. real64 KERNELV_VAR_TYPE_DOUBLE Data type is double. string KERNELV_VAR_TYPE_STRING The data type is a string with a maximum of 127 (KERNELV_VAR_ STRING_LEN) characters (total length including terminating zero KERNELV_VAR_STRING_LEN +1 character). TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 143 Virtual NCK
## Page 144

kernelv API types 4.21 Struct KERNELV_VARIABLE Description The structure contains the value and type of a CNC variable. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning type E_KERNELV_VAR_TYPE Data type of the data item in the value structure element. value U_KERNELV_VAR_VALUE Union with the data types possible for CNC variables. 4.22 Struct KERNELV_NC_LINE_DATA Description The structure contains information about the NC program lines executed in the current cycle. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning fileoffset unsigned long int File offset of the lines in the NC program nc Line Number unsigned long int NC line number of the line. The line number defined in the NC program (N followed by a numeric value) is returned. If no NC line number was specified in the executed line, the last programmed line number is returned. filename char[KERNELV_FILE_NAME File name of the NC program that is currently executed. _LENGTH + 1] 144 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 145

kernelv API types 4.23 Struct KERNELV_LICENSE_INFO Description The structure contains information about the licensed options. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning Cnc Sys Id OK unsigned long int Valid license exists. Cnc Axes Pack unsigned long int Maximum configurable number of axes. Cnc Channels unsigned long int Maximum configurable number of channels. Cnc Trafo unsigned long int Transformation pack is licensed. Cnc Spline unsigned long int Spline pack is licensed. Cnc Spline unsigned long int The license is an export license (function restrictions due to export regulations). Cnc Dll unsigned long int Use of the kernelv DLL is licensed. 4.24 Struct KERNELV_DECODER_POSITION_HEADER Description the structure contains general data about the axis positions read by the decoder. When the function kernelv_ch_get_decoder_positions() is called, a structure of type KERNELV_DECODER_POSITION_HEADER is first returned. This is followed by a structure of type KERNELV_DECODER_POSITION_DATA for each axis present in the channel. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning data_valid unsigned char Validity identifier for the following data. line_number unsigned long int NC line number. Block_count unsigned long int Block counter. axis_count unsigned short int Number of axes in the channel, number of the following structures of type KERNELV_DECODER_POSITION_DATA. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 145 Virtual NCK
## Page 146

kernelv API types 4.25 Struct KERNELV_DECODER_POSITION_DATA Description The structure contains the decoder axis positions of an axis. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning mcs_pos unsigned long int Axis position in the machine coordinate system. pcs_pos_no_offset unsigned long int Axis position in the programming coordinate system without offsets. pcs_pos_offset unsigned long int Axis position in the programming coordinate system with offsets.. axis_number unsigned short int Axis number of the axis. 4.26 Enum E_KERNELV_PROG_START_MODE Description Indicates the execution mode of the program start. Symbol Value Meaning KERNELV_START_MODE_NORMAL 0 Normal execution KERNELV_START_MODE_CONTOUR_VISU 1 Execution mode of command contour visualisation. 4.27 Struct ACTIVE_G_CODES Description Contains an array with the active G functions of the respective G function group. Element Type Meaning group[KERNELV_G_MAX_G_GRP] short int Array of the G groups. 146 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 147

kernelv API types 4.28 Enum E_KERNELV_G_GROUP_TYPE Description Enumeration with identifiers for the various G function types. Symbol Value Meaning KERNELV_G_PATH_COND 0 Group 0, path condition, possible active G functions: G00, G01, G02, G03, G04, G33, G63, G74, G98, G99, G301, G302, G160 KERNELV_G_PATH_FEED 1 Group 1, possible active G functions: G08, G193 KERNELV_G_DEC 2 Group 2, possible active G functions: G09, G900, G901 KERNELV_G_FEED_ADAPT 3 Group 3, possible active G functions: G09, G900, G901 KERNELV_G_ACITVE_PLANE 4 Group 4, possible active G functions: G17, G18, G19 KERNELV_G_MIRROR 5 Group 5, possible active G functions: G20, G21, G22, G23, G24, G351 KERNELV_G_TRC_TRANSITION 6 Group 6, possible active G functions: G25, G26 KERNELV_G_TOOL_RADIUS_C 7 Group 7, possible active G functions: G40, G41, G42 OMP KERNELV_G_DIAMETER_PROG 8 Group 8, possible active G functions: G40, G41, G42 KERNELV_G_ZERO_POS_SHIFT 9 Group 9, possible active G functions: G53-G59, G159 KERNELV_G_EXACT_STOP 10 Group 10, possible active G functions: G60, G359, G360, G260, G261 KERNELV_G_OVERRRIDE_100 11 Group 11, possible active G functions: G166 KERNELV_G_UNIT 12 Group 12, possible active G functions: G70, G71 KERNELV_G_SUB_CALL 13 Group 13, possible active G functions: G80-G89, G800-G819 KERNELV_G_ABS_REL 14 Group 14, possible active G functions: G90, G91 KERNELV_G_POS_SHIFT 15 Group 15, possible active G functions: G92 KERNELV_G_FEED_PROG 16 Group 16, possible active G functions: G93, G94, G95, G194 KERNELV_G_SPINDEL_FEED 17 Group 17, possible active G functions: G96, G97, G196 KERNELV_G_GEAR_CHANGE 18 Group 18, possible active G functions: G112 KERNELV_G_LOOKAHEAD 19 Group 19, possible active G functions: G115, G116, G117 KERNELV_G_ACC_WEIGHT 20 Group 20, possible active G functions: G130, G131 KERNELV_G_FEEDFORWARD 21 Group 21, possible active G functions: G135, G136, G137 KERNELV_G_TRC_SELCECTIO 22 Group 22, possible active G functions: G05, G138, G139, N G237, G238, G239 KERNELV_G_CIRCE_CENTER 23 Group 23, possible active G functions: G161, G162 KERNELV_G_RADIUS_PROGR 24 Group 24, possible active G functions: G163 KERNELV_G_CIRC_CENTER_C 25 Group 25, possible active G functions: G164, G165 ORR KERNELV_G_MANUAL_MODE 26 Group 26, possible active G functions: G200, G201, G202 KERNELV_G_RAMP_TIME_WEI 27 Group 27, possible active G functions: G132, G133, G134 GHT KERNELV_G_SPLINE 28 Group 28, possible active G functions: G150, G151 KERNELV_G_PROBING 29 Group 29, possible active G functions: G100, G101, G102, G106, G107, G108 KERNELV_G_CORNER_DECEL 30 Group 30, possible active G functions: G12, G13 KERNELV_G_CONTOUR_MASKI 31 Group 31, possible active G functions: G140, G141 NG KERNELV_G_PROBING_INTERR 32 Group 32, possible active G functions: G310 KERNELV_G_SPINDLE_OVERR 33 Group 33, possible active G functions: G167 RIDE KERNELV_G_RAPID_FEED_WEI 34 Group 34, possible active G functions: G129 GHT TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 147 Virtual NCK
## Page 148

kernelv API types KERNELV_G_CONTOUR 35 Group 35, possible active G functions: G301, G302 KERNELV_G_CYCLE_SYNC 36 Group 36, possible active G functions: G66 KERNELV_G_MAX_G_GRP 37 Number of groups, size of array 148 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 149

kernelv API types 4.29 Data types of contour visualisation 4.29.1 Struct CONTOUR_VISU Description Data of contour visualisation, return value of the function kernelv_ch_get_cont_visu_data(). Element Type Meaning count signed long int Number of the entries with visualisation data contained in the element. ifc_version unsigned long int Interface version of the visualisation data; set by the start- up parameter P-STUP-00039. ifc_version Data type in CONTOUR_VISU 0 CONTOUR_VISU_DATA_V0 1 CONTOUR_VISU_DATA_V1 2 CONTOUR_VISU_DATA_V2 3 CONTOUR_VISU_DATA_V3 4 CONTOUR_VISU_DATA_V4 5 CONTOUR_VISU_DATA_V5 6 CONTOUR_VISU_DATA_V6 7 CONTOUR_VISU_DATA_V7 8 CONTOUR_VISU_DATA_V8 data CONTOUR_VISU_DATA Contour visualisation data corresponding to the interface type specified in ifc_version. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 149 Virtual NCK
## Page 150

kernelv API types 4.29.2 Union CONTOUR_VISU_DATA Description Union with possible values of contour visualisation. Element Type Meaning visu_data_v0 CONTOUR_VISU_DATA_V0[] Contour visualisation data for use of interface version 0, array size CONTOUR_MAX_DATA_V0 visu_data_v1 CONTOUR_VISU_DATA_V1[] Contour visualisation data for use of interface version 1, array size CONTOUR_MAX_DATA_V1. visu_data_v2 CONTOUR_VISU_DATA_V2[] Contour visualisation data for use of interface version 2, array size CONTOUR_MAX_DATA_V2. visu_data_v3 CONTOUR_VISU_DATA_V3[] Contour visualisation data for use of interface version 3, array size CONTOUR_MAX_DATA_V3. visu_data_v4 CONTOUR_VISU_DATA_V4[] Contour visualisation data for use of interface version 4, array size CONTOUR_MAX_DATA_V4. visu_data_v5 CONTOUR_VISU_DATA_V5[] Contour visualisation data for use of interface version 5, array size CONTOUR_MAX_DATA_V5. visu_data_v6 CONTOUR_VISU_DATA_V6[] Contour visualisation data for use of interface version 6, array size CONTOUR_MAX_DATA_V6. visu_data_v7 CONTOUR_VISU_DATA_V7[] Contour visualisation data for use of interface version 7, array size CONTOUR_MAX_DATA_V7. visu_data_v8 CONTOUR_VISU_DATA_V8[] Contour visualisation data for use of interface version 8, array size CONTOUR_MAX_DATA_V8. visu_data_v9 CONTOUR_VISU_DATA_V9[] Contour visualisation data for use of interface version 9, array size CONTOUR_MAX_DATA_V9. visu_data_v10 CONTOUR_VISU_DATA_V10 Contour visualisation data for use of interface version 10, [] array size CONTOUR_MAX_DATA_V10. visu_data_v11 CONTOUR_VISU_DATA_V11 Contour visualisation data for use of interface version 11, [] array size CONTOUR_MAX_DATA_V11. 4.29.3 Struct CONTOUR_VISU_DATA_V0 Description Channel-specific data of contour visualisation for use of interface version 0. Element Type Meaning ch_data CONTOUR_VISU_CH_DATA Contour visualisation of a channel. ax_data[] CONTOUR_AXIS_DATA Axis-specific visualisation data. Array size: CONTOUR_AXIS_PER_CHANNEL 150 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 151

kernelv API types 4.29.4 Struct CONTOUR_VISU_DATA_V1 Description Channel-specific data of contour visualisation for use of interface version 1. Element Type Meaning ch_data CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA file_name CONTOUR_VISU_ File name of the active NC program. FILE_NAME Array size: FILE_NAME_LN + 1 ax_data[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA Array size: CONTOUR_AXIS_PER_CHANNEL 4.29.5 Struct CONTOUR_VISU_DATA_V2 Description Channel-specific data of contour visualisation for use of interface version 2. Element Type Meaning ch_data_v1 CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA_V1 file_name CONTOUR_VISU_ File name of the active NC program. FILE_NAME Array size: FILE_NAME_LN + 1 ax_data[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA Array size: CONTOUR_AXIS_PER_CHANNEL 4.29.6 Struct CONTOUR_VISU_DATA_V3 Description Channel-specific data of contour visualisation for use of interface version 3. Element Type Meaning ch_data CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA ax_data_v1[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA_V1 Array size: CONTOUR_AXIS_PER_CHANNEL TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 151 Virtual NCK
## Page 152

kernelv API types 4.29.7 Struct CONTOUR_VISU_DATA_V4 Description Channel-specific data of contour visualisation for use of interface version 4. Element Type Meaning ch_data CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA file_name CONTOUR_VISU_ File name of the active NC program. FILE_NAME Array size: FILE_NAME_LN + 1 ax_data_v1[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA_V1 Array size: CONTOUR_AXIS_PER_CHANNEL 4.29.8 Struct CONTOUR_VISU_DATA_V5 Description Channel-specific data of contour visualisation for use of interface version 5. Element Type Meaning ch_data_v1 CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA_V1 file_name CONTOUR_VISU_ File name of the active NC program. FILE_NAME Array size: FILE_NAME_LN + 1 ax_data_v1[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA_V1 Array size: CONTOUR_AXIS_PER_CHANNEL 4.29.9 Struct CONTOUR_VISU_DATA_V6 Description Channel-specific data of contour visualisation for use of interface version 6. Element Type Meaning ch_data CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA ax_data_v2[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA_V2 Array size: CONTOUR_AXIS_PER_CHANNEL 152 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 153

kernelv API types 4.29.10 Struct CONTOUR_VISU_DATA_V7 Description Channel-specific data of contour visualisation for use of interface version 7. Element Type Meaning ch_data CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA file_name CONTOUR_VISU_ File name of the active NC program. FILE_NAME Array size: FILE_NAME_LN + 1 ax_data_v2[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA_V2 Array size: CONTOUR_AXIS_PER_CHANNEL 4.29.11 Struct CONTOUR_VISU_DATA_V8 Description Channel-specific data of contour visualisation for use of interface version 8. Element Type Meaning ch_data_v1 CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA_V1 file_name CONTOUR_VISU_ File name of the active NC program. FILE_NAME Array size: FILE_NAME_LN + 1 ax_data_v2[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA_V2 Array size: CONTOUR_AXIS_PER_CHANNEL 4.29.12 Struct CONTOUR_VISU_DATA_V9 Description Channel-specific data of contour visualisation for use of interface version 9. Element Type Meaning ch_data_v2 CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA_V2 file_name CONTOUR_VISU_ File name of the active NC program. FILE_NAME Array size: FILE_NAME_LN + 1 ax_data[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA Array size: CONTOUR_AXIS_PER_CHANNEL TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 153 Virtual NCK
## Page 154

kernelv API types 4.29.13 Struct CONTOUR_VISU_DATA_V10 Description Channel-specific data of contour visualisation for use of interface version 10. Element Type Meaning ch_data_v2 CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA_V2 file_name CONTOUR_VISU_ File name of the active NC program. FILE_NAME Array size: FILE_NAME_LN + 1 ax_data_v1[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA_V1 Array size: CONTOUR_AXIS_PER_CHANNEL 4.29.14 Struct CONTOUR_VISU_DATA_V11 Description Channel-specific data of contour visualisation for use of interface version 7. Element Type Meaning ch_data_v2 CONTOUR_VISU_ Contour visualisation of a channel. CH_DATA_V2 file_name CONTOUR_VISU_ File name of the active NC program. FILE_NAME Array size: FILE_NAME_LN + 1 ax_data_v2[] CONTOUR_AXIS_ Axis-specific visualisation data. DATA_V2 Array size: CONTOUR_AXIS_PER_CHANNEL 154 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 155

kernelv API types 4.29.15 Struct CONTOUR_VISU_CH_DATA Description Channel-specific data of contour visualisation for use of interface versions 0, 1, 3, 4, 6, 7. Element Type Meaning nc_block_nr signed long int NC block number fileoffset signed long int File offset in current program file channel_nr unsigned short int Channel number g_function signed short int Interpolation type: 0: Rapid traverse 1: Linear interpolation 2; 3: Circular interpolation 61: Polynomial interpolation -1: Interpolation type not assigned. circle_radius unsigned long int Circle radius for circulation interpolation in 0.1 um circle_center double Circle centre point for circulation interpolation in 0.1 um. _point[2] TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 155 Virtual NCK
## Page 156

kernelv API types 4.29.16 Struct CONTOUR_VISU_CH_DATA_V1 Description Channel-specific data of contour visualisation for use of interface versions 2, 5, 8. Element Type Meaning nc_block_nr signed long int NC block number fileoffset signed long int File offset in current program file channel_nr unsigned short int Channel number g_function signed short int Interpolation type: 0: Rapid traverse 1: Linear interpolation 2; 3 Circular interpolation 61: Polynomial interpolation -1. Interpolation type not assigned. circle_radius unsigned long int Circle radius for circulation interpolation in 0.1 um circle_center double Circle centre point for circulation interpolation in 0.1 um. _point[2] v_prog signed long int Programmed velocity in 1 um/s. techno CONTOUT_VISU_ Technology data. DATA_TECHNO fillup unsigned long int In kernelv versions with Build number > 3000, fill bytes for structure alignment. 156 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 157

kernelv API types 4.29.17 Struct CONTOUR_VISU_CH_DATA_V2 Description Channel-specific data of contour visualisation for use of interface versions 9, 10, 11 Element Type Meaning nc_block_nr signed long int NC block number fileoffset signed long int File offset in current program file channel_nr unsigned short int Channel number g_function signed short int Interpolation type: 0: Rapid traverse 1: Linear interpolation 2; 3: Circular interpolation 61: Polynomial interpolation -1: Interpolation type not assigned. circle_radius unsigned long int Circle radius for circulation interpolation in 0.1 um circle_center double Circle centre point for circulation interpolation in 0.1 um. _point[2] v_prog signed long int Programmed velocity in 1 um/s. techno CONTOUT_VISU_ Technology data. DATA_TECHNO_V1 fillup unsigned long int Alignment bytes to force 8-byte alignment. 4.29.18 Struct CONTOUR_AXIS_DATA Description Axis-specific data of contour visualisation. Element Type Meaning act_cmd_pos signed long int ACS command position of the axis. axis_nbr unsigned short int Axis number. fillup unsigned short int Fill bytes for structure alignment TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 157 Virtual NCK
## Page 158

kernelv API types 4.29.19 Struct CONTOUR_AXIS_DATA_V1 Description Axis-specific data of contour visualisation. Element Type Meaning act_cmd_pos signed long int ACS command position of the axis. act_cmd_pos_ signed long int WCS_0 command position of the axis. wcs0 Only calculated if the channel parameter P-CHAN-00145 has the value 1 and P-CHAN-00032 has a value > 0. axis_nbr unsigned short int Axis number. fillup unsigned short int Fill bytes for structure alignment 4.29.20 Struct CONTOUR_AXIS_DATA_V2 Description Axis-specific data of contour visualisation. Element Type Meaning act_cmd_pos signed long int ACS command position of the axis. act_cmd_pos_ signed long int WCS_0 command position of the axis. (Command position of wcs0 the axis in the Cartesian basic coordinate system of the machine). Only calculated if the channel parameter P-CHAN-00145 has the value 1 and P-CHAN-00032 has a value > 0. act_cmd_pos_ signed long int WCS command position of the axis in the current active wcs coordinate system. Only calculated if the channel parameter P-CHAN-00145 has the value 1 and P-CHAN-00032 has a value > 0. axis_nbr unsigned short int Axis number fillup unsigned short int Fill bytes for structure alignment. 4.29.21 Enum E_CONTOUR_TECHNO_TYPE Description Type of technology function Symbol Value Meaning TECHNO_UNKNOWN_TYPE_ 0 Entry not assigned TECHNO_M_TYPE 1 M function TECHNO_H_TYPE 2 H function 158 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 159

kernelv API types 4.29.22 Struct CONTOUR_M_H_PROCESS Description Data of a specified technology function. Element Type Meaning nr unsigned long int Number of the technology function. sync unsigned long int Synchronisation mode of the technology function. type unsigned long int Type of the technology function according to E_CONTOUR_TECHNO_TYPE 4.29.23 Struct CONTOUR_M_H_PROCESS_V1 Description Data of a specified technology function. Element Type Meaning nr unsigned long int Number of the technology function. sync unsigned long int Synchronisation mode of the technology function. type unsigned long int Type of the technology function according to E_CONTOUR_TECHNO_TYPE add_value signed long int Value additionally programmed in the NC program (M4711 = 123). 4.29.24 Enum E_CONTOUR_S_CMD Description Type of a spindle technology function. Symbol Value Meaning SPDL_CMD_UNKNOWN 0 Entry not assigned. SPDL_CMD_M3 3 M3 function (rotate spindle clockwise). SPDL_CMD_M4 4 M4 function (rotate spindle counter-clockwise). SPDL_CMD_M5 5 M5 function (stop spindle). SPDL_CMD_M19 19 M19 function (position spindle). TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 159 Virtual NCK
## Page 160

kernelv API types 4.29.25 Struct CONTOUR_S_PROCESS Description Data of a specified spindle function. Element Type Meaning axis_nr unsigned short int Number of the spindle axis. cmd unsigned short int Spindle command according to E_CONTOUR_S_CMD. sync unsigned long int Synchronisation mode of the spindle function. position signed long int Target position to position spindle in 0.1*10-3° revolution signed long int Spindle speed in 1*10-3°/s 4.29.26 Struct CONTOUR_TOOL_PROCESS Description Data of a T function output. Element Type Meaning basic signed long int Basic number of the tool. sister signed long int Sister number of the tool. The value -1 means unassigned. variant signed long int Variant number of the tool. The value -1 means unassigned. 4.29.27 Struct CONTOUR_DATA_TECHNO Description Data of the technology function output. Element Type Meaning axis_nr unsigned short int Axis number with axis-specific technology functions output, 0 for channel-specific technology functions output. fillup unsigned short int Fill bytes for structure alignment. m_h_count unsigned long int Number of assigned entries in the m_h_data[] array. m_h_data[ ] CONTOUR_M_H_PROCESS M/H technology data. Array size: CONTOUR_MAX_M_H_DATA s_count signed long int Number of assigned entries in the s_procm_h_data[] array. s_data[CONTO CONTOUR_S_PROCESS Data of the spindle technology functions output. UR_SPDL_COU Array size: CONTOUR_MAX_SPDL_DATA NT] tool CONTOUR_TOOL_PROCESS Technology data of a tool. 160 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 161

kernelv API types 4.29.28 Struct CONTOUR_DATA_TECHNO_V1 Description Data of the technology function output. Element Type Meaning axis_nr unsigned short int Axis number with axis-specific technology functions output, 0 for channel-specific technology functions output. fillup unsigned short int Fill bytes for structure alignment. m_h_count unsigned long int Number of assigned entries in the m_h_data[] array. m_h_data[ ] CONTOUR_M_H_PROCES M/H technology data. S_V1 Array size: CONTOUR_MAX_M_H_DATA s_count signed long int Number of assigned entries in the s_procm_h_data[] array. s_data[CONTO CONTOUR_S_PROCESS Data of the spindle technology functions output. UR_SPDL_CO Array size: CONTOUR_MAX_SPDL_DATA UNT] tool CONTOUR_TOOL_PROCE Technology data of a tool. SS TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 161 Virtual NCK
## Page 162

kernelv API types 4.30 Data types of error output 4.30.1 Struct KERNELV_ERROR_VALUE Description Additional values output in the error message. Element Type Meaning type E_KERNELV_ERR_ Data type of the value contained in the data element. VAL_TYPE dimension E_KERNELV_ERR_ Dimension of the value contained in the data element. VAL_DIMENSION meaning E_KERNELV_ERR_ Meaning of the value contained in the data element. VAL_MEANING fillup unsigned long int Fill bytes for structure alignment. data U_KERNELV_ERR_ Union with actual groove data. VAL_DATA 4.30.2 KERNELV_ERROR_VALUE_ARRAY Description Defines an array of size KERNELV_ERROR_VALUE_COUNT for structures of type KERNELV_KERNELV_ERROR_VALUE. typedef KERNELV_ERROR_VALUE KERNELV_ERROR_VALUE_ARRAY[KERNELV_ERROR_VALUE_COUNT]; A variable of this type can be transferred to the functions kernelv_get_error_message_values() to read error message values. 162 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 163

kernelv API types 4.30.3 Enum E_KERNELV_ERR_VAL_TYPE Description Identifiers for the data type of the value in U_KERNELV_ERR_VAL_DATA. Symbol Value Meaning ERR_VAL_TYPE_NONE -1 Unknown data type. ERR_VAL_TYPE_BOOLEAN 0 Data type is unsigned char 1(8 bits). Possible values 0 or. ERR_VAL_TYPE_UNS08 1 Data type is unsigned char (8 bits). ERR_VAL_TYPE_SGN08 2 Data type is signed char (8 bits). ERR_VAL_TYPE_UNS16 3 Data type is unsigned short int (16 bits). ERR_VAL_TYPE_SGN16 4 Data type is signed short int (16 bits). ERR_VAL_TYPE_UNS32 5 Data type is unsigned long int (32 bits). ERR_VAL_TYPE_SGN32 6 Data type is signed long int (32 bits). ERR_VAL_TYPE_UNS64 7 Data type is unsigned long long int (64 bits). ERR_VAL_TYPE_SGN64 8 Data type is signed long long int (64 bits). ERR_VAL_TYPE_REAL64 9 Data type is a 64-bit floating point number. ERR_VAL_TYPE_REAL32 10 Data type is a 32-bit floating point number. ERR_VAL_TYPE_BOOLEAN 11 Data type is a character ERR_VAL_TYPE_STRING 12 Data type is a string of length KERNELV_ERR_MSG_ STRING_LENGTH (without terminating 0). ERR_VAL_TYPE_ADRESSE 13 Data type is an address. ERR_VAL_TYPE_IGNORE 14 Data type not assigned. ERR_VAL_TYPE_A3_REAL64 15 Data type is an array with 3 64-bit floating point number. ERR_VAL_TYPE_BITARRAY_ 16 Data type is bit array with 32 bits. 32 ERR_VAL_TYPE_BITARRAY_ 17 Data type is bit array with 16 bits. 16 TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 163 Virtual NCK
## Page 164

kernelv API types 4.30.4 Enum E_KERNELV_ERR_VAL_DIMENSION Description Dimension of the value in U_KERNELV_ERR_VAL_DATA. Symbol Value Meaning ERR_VAL_DIM_UNKNOWN -1 Unknown dimension identifier. ERR_VAL_TYPE_IGNORE 0 No dimension specified. ERR_VAL_DIM_POSITION 1 Position in [10^-4 mm or °]. ERR_VAL_DIM_POSITION_HIG_RES 2 Position in [10^-7 mm or °] ERR_VAL_DIM_VELOCITY 3 Velocity in 10^-3 mm/s or 10^-3 °/s. ERR_VAL_DIM_ACCELERATION 4 Acceleration in mm/s^2 or °/s^2. ERR_VAL_DIM_JERK 5 Jerk in mm/s^3 or °/s^3. ERR_VAL_DIM_TIME 6 Time in µs. ERR_VAL_DIM_PERMILL 7 Factorial specification in 1/1000 (per mill). ERR_VAL_DIM_INKREMENTS 8 (Encoder) increments. ERR_VAL_DIM_REV_FEED 9 Revolution feed in 10^-4mm/rev. ERR_VAL_DIM_CUTTING_SPEED 10 Cutting speed 10^-3 mm/s. ERR_VAL_DIM_PATH_RESOLUTION 11 Path resolution in increments / 10^-4 mm. ERR_VAL_DIM_INCR_PER_REV 12 increments/revolution ERR_VAL_DIM_BYTE 13 Byte. ERR_VAL_DIM_PROPORTIONAL_GAIN 14 Proportional gain 0.01/s. ERR_VAL_DIM_FREQUENCY 15 Frequency in Hz. ERR_VAL_DIM_LOAD 16 Load in kg or kg*m^2. ERR_VAL_DIM_TORQUE 17 Motor torque in Nm 164 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 165

kernelv API types 4.30.5 Enum E_KERNELV_ERR_VAL_MEANING Description Meaning of the value in U_KERNELV_ERR_VAL_DATA. Symbol Value Meaning ERR_VAL_MEAN_UNKNOWN -1 Unknown meaning. ERR_VAL_MEAN_LIMIT 0 Limit value ERR_VAL_MEAN_ACT_VAL 1 Current value ERR_VAL_MEAN_ERR_VAL 2 Error value ERR_VAL_MEAN_EXPECT_VAL 3 Expected value ERR_VAL_MEAN_CORR_VAL 4 Corrected value ERR_VAL_MEAN_LOG_AXIS_NR 5 logical axis number ERR_VAL_MEAN_DRIVE_TYPE 6 Drive type ERR_VAL_MEAN_LOG_BED_ELEM_NR 7 logical control element number ERR_VAL_MEAN_STATE 8 State ERR_VAL_MEAN_TRANSITION 9 Transition ERR_VAL_MEAN_SENDER 10 Sender ERR_VAL_MEAN_CLASS 11 Class ERR_VAL_MEAN_INSTANCE 12 Instance ERR_VAL_MEAN_IDENT_NR 13 Identification number ERR_VAL_MEAN_STATUS 14 Status ERR_VAL_MEAN_RING_NR 15 Ring number ERR_VAL_MEAN_SATZ_NR 16 Block number ERR_VAL_MEAN_MIN_LIMIT 17 Lower limit value ERR_VAL_MEAN_MAX_LIMIT 18 Upper limit value ERR_VAL_MEAN_START_VAL 19 Initial value ERR_VAL_MEAN_TARGET_VAL 20 Final value ERR_VAL_MEAN_FILENAME 21 File name ERR_VAL_MEAN_LINE 22 Line (text) in a file ERR_VAL_MEAN_LINE_NUMBER 23 Line number in a file ERR_VAL_MEAN_COLUMN_NUMBER 24 Column number in a file ERR_VAL_MEAN_ARGUMENT 25 Argument ERR_VAL_MEAN_PARAMETER 26 Parameter ERR_VAL_MEAN_AXIS 27 Axis (string) ERR_VAL_MEAN_COMPENSATION 28 Compensation index ERR_VAL_MEAN_IDENTIFIER 29 Identifier ERR_VA_MEAN_CHAIN 30 Chain TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 165 Virtual NCK
## Page 166

kernelv API types 4.30.6 Enum E_KERNELV_ERROR_LANGUAGE Description Language of error messages Symbol Value Meaning E_KERNELV_ERROR_LANG_ 1 The error language is German. GER E_KERNELV_ERROR_LANG_ 2 The error language is English. ENG 166 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 167

kernelv API types 4.31 Enum KERNELV_AXIS_OFFSET_TYPES Description Assign different offset types to the index of the offset vector of the function kernelv_ch_axis_get_offsets (). Symbol Value Meaning KERNELV_AXIS_OFFSET_UN -1 Unknown offset type. KNOWN KERNELV_AXIS_OFFSET_ZE 0 Offset caused by zero offset (G54 … G59). RO KERNELV_AXIS_OFFSET_AD 1 Offset caused by reference point offset (G92). D_ZERO KERNELV_AXIS_OFFSET_PS 2 Offset caused by position preset (# PSET). ET KERNELV_AXIS_OFFSET_CL 3 Offset caused by clamp position offset data. AMP KERNELV_AXIS_OFFSET_TO 4 Offset caused by tool data. OL KERNELV_AXIS_OFFSET_ME 5 Offset caused by G101 (Include measurement offset). ASURE KERNELV_AXIS_OFFSET_MA 6 Offset caused by manual mode. N_OP KERNELV_AXIS_OFFSET_TR 7 Offset caused by #CS TRACK*. ACK_CS_OFFSET KERNELV_AXIS_OFFSET_MA 8 Data type is signed long long int (64 bits). X *Thisthis NC offset is not available in all versions. TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 167 Virtual NCK
## Page 168

kernelv API types 4.32 External measuring hardware 4.32.1 Struct KERNELV_EXT_LATCH_COMMAND_DATA Description The structure contains information about commands output by the CNC to the external measuring hardware. Memory orientation The individual structure elements are packed in the memory. Element Type Meaning order_type E_KERNELV_EXT_LAT Type of command to the external latch hardware. CH_ORDER input unsigned long int Number of the measurement input of the external measuring hardware used for the measurement. edge E_KERNELV_MEAS_A Edge of the probe signal used for the measurement. CTIVE_EDGE 4.32.2 Enum E_KERNELV_EXT_LATCH_ORDER Description Type of the measuring command to be executed. Symbol Value Meaning E_KERNELV_NO_ORDER 0 No command active E_KERNELV_ENABLE_PROBE 1 Enable measuring hardware E_KERNELV_DISABLE_PROBE 2 Disable measuring hardware 4.32.3 E_KERNELV_MEAS_ACTIVE_EDGE Description Edge of the probe signal to be evaluated. Symbol Value Meaning E_KERNELV_MEAS_SIGNAL_ 1 Measure on negative edge. LOW_ACTIVE E_KERNELV_MEAS_SIGNAL_ 2 Measure on positive edge. HIGH_ACTIVE 168 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 169

kernelv API types 4.33 Production time calculation Description The structure contains the filenames of the programs that should be started in the individual channels in production time mode. KERNELV_PT_FILE_NAME is of type CHAR[KERNELV_PT_PRG_NAME_LEN] Memory orientation The individual structure elements are packed in the memory. Element Type Meaning file KERNELV_PT_FILE_NAME The filenames of the programs that should be started in [KERNELV_PT_MAX_CHAN the individual channels in production time mode. ] TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 169 Virtual NCK
## Page 170

kernelv API constants 5 kernelv API constants All listed constants are defined in the file kernelv.h . 5.1 KERNELV_VAR_STRING_LEN Description Maximum number of characters in a string of the union U_KERNELV_VAR_VALUE. The total length of the string (including terminating zeroes) is KERNELV_VAR_STRING_LEN + 1 byte. Value 127 5.2 KERNELV_FILE_NAME_LENGTH Description Maximum number of the characters in a string of the structure KERNELV_NC_LINE_DATA. The total length of the string (including terminating zeroes) is KERNELV_FILE_NAME_LENGTH + 1 byte. Value 83 5.3 KERNELV_VAR_NAME_LENGTH Description Maximum permissible length of the variable name to read and write variables with the kernelv_ch_get_variable_value()/kernelv_ch_get_variable_value() functions. Value 255 5.4 KERNELV_OPTION_LICENSE_CHECK_VERBOSE Description Bit mask to enable additional outputs during the license check. Must be set before calling kernelv_startup(). Value 1 (0x1) 5.5 CONTOUR_MAX_DATA_V0 Description Array size of the union element visu_data_v0[] of the union CONTOUR_VISU_DATA. 170 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 171

kernelv API constants Value 15 5.6 CONTOUR_MAX_DATA_V1 Description Array size of the union element visu_data_v1[] of the union CONTOUR_VISU_DATA. Value 10 5.7 CONTOUR_MAX_DATA_V2 Description Array size of the union element visu_data_v2[] of the union CONTOUR_VISU_DATA. Value 5 5.8 CONTOUR_MAX_DATA_V3 Description Array size of he union element visu_data_v3[] of the union CONTOUR_VISU_DATA. Value 10 5.9 CONTOUR_MAX_DATA_V4 Description Array size of the union element visu_data_v4[] of the union CONTOUR_VISU_DATA. Value 7 5.10 CONTOUR_MAX_DATA_V5 Description Array size of the union element visu_data_v5[] of the union CONTOUR_VISU_DATA. Value 7 TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 171 Virtual NCK
## Page 172

kernelv API constants 5.11 CONTOUR_MAX_DATA_V6 Description Array size of he union element visu_data_v6[] of the union CONTOUR_VISU_DATA. Value 6 5.12 CONTOUR_MAX_DATA_V7 Description Array size of the union element visu_data_v7[] of the union CONTOUR_VISU_DATA. Value 5 5.13 CONTOUR_MAX_DATA_V8 Description Array size of the union element visu_data_v8[] of the union CONTOUR_VISU_DATA. Value 3 5.14 CONTOUR_MAX_DATA_V9 Description Array size of he union element visu_data_v9[] of the union CONTOUR_VISU_DATA. Value 5 5.15 CONTOUR_MAX_DATA_V10 Description Array size of the union element visu_data_v10[] of the union CONTOUR_VISU_DATA. Value 4 172 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 173

kernelv API constants 5.16 CONTOUR_MAX_DATA_V11 Description Array size of the union element visu_data_v8[] of the union CONTOUR_VISU_DATA. Value 3 5.17 CONTOUR_MAX_M_H_DATA Description Array size of the element m_h_data[] of the structure CONTOUR_TECHNO_DATA. Value 20 5.18 CONTOUR_MAX_SPDL_DATA Description Array size of the element s_data[] of the structure CONTOUR_TECHNO_DATA. Value 6 5.19 CONTOUR_AXIS_PER_CHANNEL Description Array size of the element ax_data[] or ax_data_v1[] of the structures CONTOUR_VISU_DATA_V0 … CONTOUR_VISU_DATA_V8. Value 32 5.20 KERNELV_ERROR_VALUE_COUNT Description Array size of the array ERROR_VALUE_ARRAY, number of structures of the KERNELV_ERROR_VALUE type returned by the function kernelv_get_error_values(). Value 5 TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 173 Virtual NCK
## Page 174

kernelv API constants 5.21 KERNELV_ERR_MSG_ STRING_LENGTH Description Length of a string in the union U_KERNELV_ERR_VAL_DATA without terminating zero. Value 23 5.22 KERNELV_CHANNEL_TECHNO_DATA_COUNT Description Number of elements in a KERNELV_CHANNEL_TECHNO_DATA_ARRAY or KERNELV_CHANNEL_TECHNO_DATA_ARRAY2 array. Maximum number of elements which return the functions kernelv_ch_get_(new_)techno_data() or kernelv_ch_get_(new_)techno_data2(). Value 30 5.23 KERNELV_AXIS_TECHNO_DATA_COUNT Description Number of elements in a KERNELV_AXIS_TECHNO_DATA_ARRAY or KERNELV_AXIS_TECHNO_DATA_ARRAY2 array. Maximum number of elements which return the functions kernelv_ax_get_(new_)techno_data() or kernelv_ax_get_(new_)techno_data2(). Value 30 5.24 KERNELV_ERROR_VALUE_COUNT Description Number of elements in a KERNELV_ERROR_VALUE_ARRAY array. Maximum number of elements which return the function kernelv_get_error_message_values() Value 5 174 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 175

kernelv API constants 5.25 KERNELV_INSTANCE_PREFIX_MAX_LEN Description Maximum length of the string which may be transferred as prefix to call the kernelv_startup_instance() function. Value 60 TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 175 Virtual NCK
## Page 176

Support and Service 6 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 176 Version: 1.1.59 TF5270/71 | Twin CAT 3 CNC Virtual NCK
## Page 177

Index Index TF5270/71 | Twin CAT 3 CNC Version: 1.1.59 177 Virtual NCK
## Page 179

More Information: www.beckhoff.com/TF5270/71 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
