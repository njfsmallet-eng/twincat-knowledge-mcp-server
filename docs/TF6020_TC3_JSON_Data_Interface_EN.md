---
title: "TF6020_TC3_JSON_Data_Interface_EN"
product: "TF6020"
category: "Communication"
tags: ["DATA", "INTERFACE", "JSON"]
language: "EN"
document_type: "Manual"
version: "1.2"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6020_TC3_JSON_Data_Interface_EN.pdf"
release_date: "2023-04-12"
---
Manual | EN TF6020 Twin CAT 3 | JSON Data Interface 2023-04-12 | Version: 1.2
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 Safety instructions............................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Installation......................................................................................................................................... 9 3.3 Licensing........................................................................................................................................... 9 4 Technical introduction............................................................................................................................ 12 4.1 API description................................................................................................................................ 12 4.2 Access via ADS............................................................................................................................... 12 4.3 Access via MQTT............................................................................................................................ 13 4.3.1 Topic structure................................................................................................................. 14 5 Examples................................................................................................................................................. 15 6 Appendix.................................................................................................................................................. 16 6.1 Error diagnosis................................................................................................................................ 16 TF6020 Version: 1.2 3
## Page 4

Table of contents 4 Version: 1.2 TF6020
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilization of this document as well as the communication of its contents to others without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TF6020 Version: 1.2 5
## Page 6

Foreword 1.2 Safety instructions Safety regulations Please note the following safety instructions and explanations! Product-specific safety instructions can be found on following pages or in the areas mounting, wiring, commissioning etc. Exclusion of liability All the components are supplied in particular hardware and software configurations appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation and drive engineering who are familiar with the applicable national standards. Description of symbols In this documentation the following symbols are used with an accompanying safety instruction or note. The safety instructions must be read carefully and followed without fail! DANGER Serious risk of injury! Failure to follow the safety instructions associated with this symbol directly endangers the life and health of persons. WARNING Risk of injury! Failure to follow the safety instructions associated with this symbol endangers the life and health of persons. CAUTION Personal injuries! Failure to follow the safety instructions associated with this symbol can lead to injuries to persons. NOTE Damage to the environment or devices Failure to follow the instructions associated with this symbol can lead to damage to the environment or equipment. Tip or pointer This symbol indicates information that contributes to better understanding. 6 Version: 1.2 TF6020
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF6020 Version: 1.2 7
## Page 8

Overview 2 Overview The TC3 JSON Data Interface is a communication interface for the flexibly adaptable exchange of data between Twin CAT systems and user-specific applications. The communication takes place in JSON format. The JSON format and the use of either ADS or MQTT ensures generic access from many different programming environments. Basically, there are two different ways to access the JSON Data Interface. The first way is direct access to the ADS interface (cf. Access via ADS [} 12]). In the second option, the Twin CAT System Service is included in the communication as an MQTT client and handles the requests to the ADS interface. A user application connects as an MQTT client to a message broker, to which the Twin CAT System Service is also connected (cf. Access via MQTT [} 13]). 8 Version: 1.2 TF6020
## Page 9

Installation 3 Installation 3.1 System requirements Technical data Description Operating system Windows 7/10, Windows Embedded Standard 7, Windows CE 7, Twin CAT/BSD Target platform PC architecture (x86, x64 and ARM) Twin CAT version Twin CAT 3.1 build 4024.11 or higher Required Twin CAT setup level Twin CAT 3 XAE, XAR Required Twin CAT license TF6020 TC3 JSON Data Interface 3.2 Installation No separate setup is required for the TF6020 JSON Data Interface function. All the components are supplied directly with the Twin CAT setup. 3.3 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. TF6020 Version: 1.2 9
## Page 10

Installation 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 10 Version: 1.2 TF6020
## Page 11

Installation 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. TF6020 Version: 1.2 11
## Page 12

Technical introduction 4 Technical introduction 4.1 API description The following section describes the options provided by the JSON Data Interface with the help of short example requests and responses. The API is equally valid for access via MQTT or via ADS. Type Request/Response Sample of the JSON payload Reading a variable Request {"symbol":"MAIN.n Counter"} Response {"symbol":"MAIN.n Counter", "value":42} Reading a variable and its data Request {"symbol":"MAIN.n Counter", type "datatype":null} Response {"symbol":"MAIN.n Counter", "value":42, "datatype":INT} Simultaneous reading of several Request [{"symbol": "MAIN.n Counter"}, variables {"symbol":"MAIN.n Sec Counter"}] Response [{"symbol":"MAIN.n Counter","value" :42 }, {"symbol":"MAIN.n Sec Counter, "value":35}] Reading the Twin CAT symbol info Request {"symbols":null} Response Complete symbol info Writing a variable Request {"symbol":"MAIN.n Counter","value": 42} Response {"symbol":"MAIN.n Counter","value": 42} Writing several variables Request [{"symbol":"MAIN.n Counterˮ, "value":42}, {"symbol":"MAIN.n Sec Counter", "value":35}] Response [{"symbol":"MAIN.n Counter","value" :42}, {"symbol":"MAIN.n Sec Counter","val ue":35}] Method calls, optionally with input Request {"symbol": and output parameters "MAIN.fb Tester#M_Add","paramete r":{ "int A":42, "int B":35}} Response {"symbol":"MAIN.fb Tester#M_Add", "value":77} Response with additional outputs {"symbol":"MAIN.fb Tester#M_Add", "value":77,"parameter":{"int C":32, "int D":64}} 4.2 Access via ADS One option for access is via MQTT and a message broker. In addition, access is also possible directly via ADS. In this case, the same interface is addressed that is addressed internally in the MQTT case. The JSON documents corresponding to the API description (cf. API description [} 12]) are passed to the JSON Data Interface via ADS, and the response then also contains a JSON document. This is done by executing an ADS Read Write command with index group 0xf070 and index offset 0x0. The data to be written contains the request document, while the data to be read reserves the memory for the response document. The following code snippet shows how to access the JSON Data Interface using ADS . NET V5. 12 Version: 1.2 TF6020
## Page 13

Technical introduction int ads Port = 851; string response String; Ads Client ads Client = new Ads Client(); ads Client. Connect(ads Port); string json = "{\"symbol\":\"MAIN.n Counter\"}"; byte[] write Data = new byte[json. Length+1]; Memory Stream write Stream = new Memory Stream(write Data); Binary Writer writer = new Binary Writer(write Stream); writer. Write(Encoding. ASCII. Get Bytes(json)); byte[] read Data = new byte[1000]; ads Client. Read Write(0xf070, 0, read Data, write Data); response String = Encoding. ASCII. Get String(read Data); In principle, Ads-Read Write commands are always sent to the combination of Index Group and Index Offset described in the code. The response returned within the command then contains the JSON response of the JSON Data Interface. 4.3 Access via MQTT If the JSON Data Interface is to be accessed via MQTT, the connection must be configured by the Twin CAT System Service with an MQTT broker. The Static Routes.xml must be edited for this. This can be found on a Twin CAT system in the following locations: Windows: C:\Twin CAT\3.1\Target. TC/BSD: /usr/local/etc/Twin CAT/3.1/Target Settings without TLS <?xml version="1.0" encoding="UTF-8"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <Remote Connections> <Json> <Name>Sample Connection</Name> <Address>18.157.241.86</Address> <Topic>topic</Topic> </Json> </Remote Connections> </Tc Config> For settings without TLS, a Remote Connection of the type Json must be added to Static Routes.xml . A name for the connection, the IP address of the MQTT broker and the main topic are then specified within this Remote Connection. Settings with certificates <?xml version="1.0" encoding="UTF-8"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <Remote Connections> <Json> <Name>Sample Connection</Name> <Address>18.157.241.86</Address> <Topic>topic</Topic> <Tls> <Ca>C:\Users\Administrator\Certificate\root CA.pem</Ca> <Cert>C:\Users\Administrator\Certificate\TF6020.pem</Cert> <Key>C:\Users\Administrator\Certificate\TF6020.key</Key> <Crl>C:\Users\Administrator\Certificate\Sample CRL.der</Crl> </Tls> </Json> </Remote Connections> </Tc Config> If TLS is to be used, there is also the option of referencing certificates. The CA certificate, the client certificate and the client's private key can be specified either DER- or PEM-encoded or by means of a file path. A Certificate Revocation List (CRL) can also be specified in the same format. Set user name and password TF6020 Version: 1.2 13
## Page 14

Technical introduction <?xml version="1.0" encoding="UTF-8"?> <Tc Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <Remote Connections> <Json> <Name>Sample Connection</Name> <Address>18.157.241.86</Address> <Topic>topic</Topic> <User>Beckhoff</User> <Pwd>8c3nfd3"!4c</Pwd> <Tls> <Ca>C:\Users\Administrator\Certificate\root CA.pem</Ca> <Cert>C:\Users\Administrator\Certificate\TF6020.pem</Cert> <Key>C:\Users\Administrator\Certificate\TF6020.key</Key> <Crl>C:\Users\Administrator\Certificate\Sample CRL.der</Crl> </Tls> </Json> </Remote Connections> </Tc Config> If access to a broker is used that does not allow anonymous access, the configuration of user name and password becomes necessary. For this purpose, the user name and password are stored in the appropriate places in the configuration file. 4.3.1 Topic structure If MQTT is used for access to the Twin CAT JSON Data Interface, communication takes place via the broker with a defined topic structure. On one side there is a request-topic, on which a requesting client sends its JSON document and on the other side there is the response-topic, on which it receives the response of the JSON Data Interface. • Topic for sending requests: main Topic/req/ads Port/invoke Id • Topic for receiving responses: main Topic/res/ads Port/invoke Id main Topic: The main topic is defined in the configuration file (cf. Access via MQTT [} 13]). req/res: set. ads Port: The ADS port to be queried is entered here. invoke Id: The Invoke ID is arbitrarily chosen by the user and is used to identify different requests to the same JSON Data Interface. The JSON Data Interface mirrors the Invoke ID of a request topic and reuses it in the response topic. The requesting client must be subscribed to this response topic in order to receive the response. 14 Version: 1.2 TF6020
## Page 15

Examples 5 Examples This chapter deals with exemplary use cases for the Twin CAT JSON Data Interface. Example calls for all available commands can be found in the API description [} 12]. Easy access from other operating systems The JSON Data Interface represents a simple way of accessing the symbols of a Twin CAT system from other operating systems. Two communication channels are available for this purpose. On the one hand, as in the application idea below, both the client application and the JSON Data Interface can be connected to the same message broker. It is freely selectable on which of the two systems the message broker runs or whether it even runs on a third system. There is no technical difference here, there just has to be a connection from both sides to the same broker. On the other hand, ADS communication can also be used on other operating systems. An ADS router is always required for ADS communication on a system. On other operating systems, however, this ADS router can also be replaced by a standalone router with reduced functionality, which is provided by Twin CAT ADS . NET V5. Two communication types in one application The JSON Data Interface is also suitable for mapping two types of communication in an application. Another component such as the Twin CAT MQTT Client (TF6701) can be used for cyclic communication. Here, previously selected variables are then cyclically communicated to the user application via MQTT. The user application then decides which scenarios to react to and how. If cyclic communication detects that more information is needed, the read commands of the JSON Data Interface can be used to query variables that are not communicated cyclically to the user application. On the other hand, if it is recognized that certain parameters need to be affected, the write commands of the JSON Data Interface can be used. Simple retrofitting of existing projects The JSON Data Interface is available with Twin CAT version 3.1.4024.11 or higher. The following section only refers to Twin CAT systems with this or newer Twin CAT versions. Direct access to the JSON Data Interface via ADS is recommended if no intervention in the Twin CAT system is possible or if this is not desired. Access via MQTT, on the other hand, offers more communication options, but requires adjustments on the target system. These adjustments are the editing of Static Routes.xml and a Twin CAT context change. TF6020 Version: 1.2 15
## Page 16

Appendix 6 Appendix 6.1 Error diagnosis Behavior Description The communicated JSON string is returned in the Check the sent JSON string for correct formatting. same form by the JSON Data Interface. For example, a common mistake is to use "symbols" instead of "symbol". The JSON Data Interface does not respond to my Verify that both MQTT clients are connected to the requests via MQTT. message broker. Many message brokers offer monitoring functions for this purpose. If an error occurs, check why one of the MQTT clients is not connected. The JSON Data Interface responds to a request with Please activate the license for TF6020 via the known a message about a missing license. Twin CAT license mechanisms. 16 Version: 1.2 TF6020
## Page 18

More Information: www.beckhoff.com/tf6020 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
