---
title: "TF6710 Twin CAT 3"
product: "TF6710"
category: "IoT"
tags: ["CAT", "IoT", "TWIN"]
language: "EN"
document_type: "Manual"
version: "1.1.1"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF6710_TC3_IoT_Functions_EN.pdf"
release_date: "2024-08-19"
---
Manual | EN TF6710 Twin CAT 3 | Io T Functions 2024-08-19 | Version: 1.1.1
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 1.4 Output statuses of the documentation.............................................................................................. 7 2 Overview.................................................................................................................................................... 8 3 Installation................................................................................................................................................. 9 3.1 System requirements........................................................................................................................ 9 3.2 Setup scenarios................................................................................................................................ 9 3.3 Installation......................................................................................................................................... 9 3.4 Installation....................................................................................................................................... 12 3.5 Licensing......................................................................................................................................... 13 4 Technical introduction............................................................................................................................ 16 4.1 Reference Data Agent..................................................................................................................... 17 4.2 Communication patterns................................................................................................................. 17 4.3 Programming workflow.................................................................................................................... 18 4.4 Synchronizing message operations................................................................................................ 19 4.5 Timeout settings.............................................................................................................................. 21 5 Configuration........................................................................................................................................... 23 5.1 Overview......................................................................................................................................... 23 5.2 Configurator.................................................................................................................................... 23 5.2.1 Topology view.................................................................................................................. 25 5.2.2 Tree view.......................................................................................................................... 26 5.2.3 Mappings.......................................................................................................................... 26 5.2.4 Target Browser................................................................................................................. 27 5.2.5 Cascading Editor.............................................................................................................. 27 5.2.6 Parameter Editor.............................................................................................................. 28 5.2.7 Settings............................................................................................................................ 29 5.2.8 Error logging..................................................................................................................... 36 6 PLC API.................................................................................................................................................... 37 6.1 Function blocks............................................................................................................................... 37 6.1.1 FB_Iot Functions_Connector............................................................................................ 37 6.1.2 FB_Iot Functions_Message.............................................................................................. 38 6.1.3 FB_Iot Functions_Request................................................................................................ 41 6.2 Data types....................................................................................................................................... 44 6.2.1 ST_Iot Functions Event...................................................................................................... 44 6.2.2 ST_Iot Functions Message................................................................................................ 44 6.2.3 ST_Iot Functions Request.................................................................................................. 45 6.2.4 ST_Iot Functions Request Container.................................................................................. 46 7 Samples................................................................................................................................................... 47 8 Appendix.................................................................................................................................................. 48 8.1 Support and Service........................................................................................................................ 48 TF6710 Version: 1.1.1 3
## Page 4

Table of contents 4 Version: 1.1.1 TF6710
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. For installation and commissioning of the components, it is absolutely necessary to observe the documentation and the following notes and explanations. The qualified personnel is obliged to always use the currently valid documentation. The responsible staff must ensure that the application or use of the products described satisfies all requirements for safety, including all the relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. No claims to modify products that have already been supplied may be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of designations or trademarks used in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Patents The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 and similar applications and registrations in several other countries. Ether CAT® is registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document as well as the use and communication of its contents without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. TF6710 Version: 1.1.1 5
## Page 6

Foreword Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.1.1 TF6710
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. 1.4 Output statuses of the documentation Version Change 1.1.x Revision TF6710 Version: 1.1.1 7
## Page 8

Overview 2 Overview TC3 Io T Functions is a product for the Twin CAT 3 runtime that enables bi-directional data communication with cloud services from within the machine program. The transport mechanism depends on the cloud service. It can be MQTT, AMQP, ADS or OPC UA. 8 Version: 1.1.1 TF6710
## Page 9

Installation 3 Installation 3.1 System requirements TC3 Io T Functions requires TC3 Io T Data Agent to run in the background. For more information see the technical introduction [} 16], the setup scenarios [} 9] and the TC3 Io T Data Agent system requirements. Technical data Description Operating system Windows 7/10, Windows Embedded Standard 7, Windows Embedded Compact 7 Target platform PC architecture (x86, x64, ARM) . NET Framework not required Twin CAT version 1 Twin CAT 3 Build 4022.20 (or higher) Twin CAT installation level Twin CAT 3 XAE, XAR Required Twin CAT license 2 TF6710 TC3 Io T Functions Required setup TF6720 TC3 Io T Data Agent Driver and PLC library for TC3 Io T Functions are automatically included in base Twin CAT installation. 1 Version of the Twin CAT 3 runtime on which TC3 Io T Functions can be executed 2 Although TC3 Io T Functions (TF6710) has a technical dependency on TC3 Io T Data Agent (TF6720), a license for TF6720 is not required. 3.2 Setup scenarios TC3 Io T Functions and TC3 Io T Data Agent can either be installed on the same computer or separately from each other on different devices. TC3 Io T Functions and TC3 Io T Data Agent on the controller In this scenario, TC3 Io T Functions and TC3 Io T Data Agent are running on the (same) controller. This is the default setup scenario and no further settings have to be made. A TF6710 license is required on the controller to use the TC3 Io T Functions PLC library. TC3 Io T Functions on the controller and TC3 Io T Data Agent on a gateway device In this scenario, TC3 Io T Functions is running on the controller and TC3 Io T Data Agent is installed on a gateway device. The communication between TC3 Io T Functions and TC3 Io T Data Agent is based on ADS. The PLC function blocks of TC3 Io T Functions need to reference the gateway device on which the TC3 Io T Data Agent is installed (see Reference Data Agent [} 17]). The gateway device does not require any additional licenses. A TF6710 license is only required on the devices that use the TC3 Io T Functions PLC library. TC3 Io T Functions and TC3 Io T Data Agent on a gateway device In this scenario, TC3 Io T Functions and TC3 Io T Data Agent are installed and executed on a gateway device, e.g. in an edge scenario. Data ingest to the edge device can be anything, ranging from TCP based protocols like OPC UA to totally other ways of data communication. A TF6710 license is required on the gateway device to use the TC3 Io T Functions PLC library. 3.3 Installation The following section describes how to install the Twin CAT 3 Function for Windows-based operating systems. ü The Twin CAT 3 Function setup file was downloaded from the Beckhoff website. TF6710 Version: 1.1.1 9
## Page 10

Installation 1. Run the setup file as administrator. To do this, select the command Run as administrator in the context menu of the file. ð The installation dialog opens. 2. Accept the end user licensing agreement and click Next. 3. Enter your user data. 10 Version: 1.1.1 TF6710
## Page 11

Installation 4. If you want to install the full version of the Twin CAT 3 Function, select Complete as installation type. If you want to install the Twin CAT 3 Function components separately, select Custom. 5. Select Next, then Install to start the installation. ð A dialog box informs you that the Twin CAT system must be stopped to proceed with the installation. TF6710 Version: 1.1.1 11
## Page 12

Installation 6. Confirm the dialog with Yes. 7. Select Finish to exit the setup. ð The Twin CAT 3 Function has been successfully installed. 3.4 Installation Twin CAT Package Manager If you are using Twin CAT 3.1 Build 4026 (and higher) on the Microsoft Windows operating system, you can install this function via the Twin CAT Package Manager, see installation documentation. Normally you install the function via the corresponding workload; however, you can also install the packages contained in the workload individually. This documentation briefly describes the installation process via the workload. Command line program Tc Pkg You can use the Tc Pkg Command Line Interface (CLI) to display the available workloads on the system: tcpkg list -t workload You can use the following command to install the workload of the TF6770 Io T Websockets function. tcpkg install TF6770. Iot Web Sockets. XAE Twin CAT Package Manager UI 12 Version: 1.1.1 TF6710
## Page 13

Installation You can use the User Interface (UI) to display all available workloads and install them if required. To do this, follow the corresponding instructions in the interface. 3.5 Licensing The Twin CAT 3 function can be activated as a full version or as a 7-day test version. Both license types can be activated via the Twin CAT 3 development environment (XAE). Licensing the full version of a Twin CAT 3 Function A description of the procedure to license a full version can be found in the Beckhoff Information System in the documentation "Twin CAT 3 Licensing". Licensing the 7-day test version of a Twin CAT 3 Function A 7-day test version cannot be enabled for a Twin CAT 3 license dongle. 1. Start the Twin CAT 3 development environment (XAE). 2. Open an existing Twin CAT 3 project or create a new project. 3. If you want to activate the license for a remote device, set the desired target system. To do this, select the target system from the Choose Target System drop-down list in the toolbar. ð The licensing settings always refer to the selected target system. When the project is activated on the target system, the corresponding Twin CAT 3 licenses are automatically copied to this system. 4. In the Solution Explorer, double-click License in the SYSTEM subtree. ð The Twin CAT 3 license manager opens. TF6710 Version: 1.1.1 13
## Page 14

Installation 5. Open the Manage Licenses tab. In the Add License column, check the check box for the license you want to add to your project (e.g. "TF4100 TC3 Controller Toolbox"). 6. Open the Order Information (Runtime) tab. ð In the tabular overview of licenses, the previously selected license is displayed with the status “missing”. 7. Click 7-Day Trial License... to activate the 7-day trial license. ð A dialog box opens, prompting you to enter the security code displayed in the dialog. 8. Enter the code exactly as it is displayed and confirm the entry. 9. Confirm the subsequent dialog, which indicates the successful activation. ð In the tabular overview of licenses, the license status now indicates the expiry date of the license. 14 Version: 1.1.1 TF6710
## Page 15

Installation 10. Restart the Twin CAT system. ð The 7-day trial version is enabled. TF6710 Version: 1.1.1 15
## Page 16

Technical introduction 4 Technical introduction TC3 Io T Functions is a product for the Twin CAT 3 runtime that enables bi-directional data communication with the Cloud. To establish a connectivity channel with a cloud service, the product uses technical functionalities of the TC3 Io T Data Agent (TF6720) in the background. TC3 Io T Functions can therefore be used with every cloud service that is also supported by the TC3 Io T Data Agent. Note that the TC3 Io T Data Agent is only used for providing the connectivity layer to the cloud and no TF6720 license has to be purchased to use TF6710. TC3 Io T Functions and TC3 Io T Data Agent do not have to run on the same system, but can also run separately from each other on different systems (see Setup scenarios). Features TC3 Io T Functions includes the following features: • Read/Write operations for messages that should be send/received to/from a cloud service • Convenient timeout, error and retry handling 16 Version: 1.1.1 TF6710
## Page 17

Technical introduction 4.1 Reference Data Agent If TC3 Io T Functions and TC3 Io T Data Agent are installed separately and the components are placed on different computers, the function blocks need to specify the location of the TC3 Io T Data Agent installation. This can be done via the AMS Net ID of the device that executes the TC3 Io T Data Agent. Simply enter the AMS Net ID of the device that executes TC3 Io T Data Agent in the corresponding input parameter of function block FB_Iot Functions_Connector [} 37]. Note that in this case an ADS route between the devices has to be created. If TC3 Io T Data Agent and TC3 Io T Functions are running on the same device, the local AMS NET ID is used by default. fb Connector : FB_Iot Functions_Connector := (s Ams Net Id := 192.168.2.3.1.1'); 4.2 Communication patterns The upper connectivity layer to a cloud service is usually based on publisher/subscriber patterns but in some cases it can also be based on polling patterns. TC3 Io T Data Agent implements the connectivity with the cloud service and provides this access via an abstracted way of communication to TC3 Io T Functions. The PLC library of TC3 Io T Functions then uses this interface then via a polling read/write pattern. TF6710 Version: 1.1.1 17
## Page 18

Technical introduction Example TC3 Io T Functions should be used to read messages from Azure Io T Hub. Connectivity with this cloud service is based on the publisher/subscriber pattern. This means that TC3 Io T Data Agent is configured with access credentials to the Io T Hub service and will therefore provides connectivity to it. TC3 Io T Functions then polls the TC3 Io T Data Agent for any incoming messages. Message buffer TC3 Io T Data Agent includes a message buffer for incoming messages that should be used by TC3 Io T Functions. This message buffer can be set directly on the corresponding TC3 Io T Functions channel. 4.3 Programming workflow This section describes how to use the function blocks of the TC3 Io T Functions PLC library from a best practice point-of-view. The programming workflow includes the following steps: • Invoking FB_Iot Functions_Connector. Execute() [} 18] • Checking for general errors [} 18] • Checking for read/write errors [} 19] • Reading data [} 19] • Writing data [} 19] The code snippets in this section are based on the following declarations: PROGRAM MAIN VAR fb Connector : FB_Iot Functions_Connector; fb Read : FB_Iot Functions_Message; fb Write : FB_Iot Functions_Message; n Read Error : UINT; n Write Error : UINT; n Read Data : UINT; n In : UINT; n Out : UINT; b Write : BOOL; END_VAR Invoking FB_Iot Functions_Connector. Execute() It is highly recommended to invoke the Execute method on the FB_Iot Functions_Connector function block instance as one of the first instructions. This method is responsible for Online Change handling, timeout handling and the communication with TC3 Io T Data Agent. fb Connector. Execute(); Checking for general errors Once the Execute method has been triggered, check the b Error output of the FB_Iot Functions_Connector function block to figure out if any error has occurred during the communication with TC3 Io T Data Agent. IF fb Connector.b Error THEN ... END_IF 18 Version: 1.1.1 TF6710
## Page 19

Technical introduction Checking for read/write errors If the b Error output of the connector’s function block instance is TRUE, check the individual error message of the request function block for errors to handle them properly. To acknowledge an error and to prevent it from recurring, call the Reset method of the function block. IF fb Connector.b Error THEN IF fb Read.b Error THEN n Read Error := n Read Error + 1; fb Read. Reset(); END_IF IF fb Write.b Error THEN n Write Error := n Write Error + 1; fb Write. Reset(); END_IF END_IF Before starting a new operation like read or write, check all relevant status queries, as these operations will reset all status information in the structures ST_Iot Functions Message and ST_Iot Functions Request. Reading data The Read operation is receiving data from the buffer and stores this data in a symbol. The value of the specified symbol is used to compare new data with previous data. When new data has been received, b Data Available is set to TRUE. If the current value of the symbol is different from the previous value, the data has changed and b Data Changed is set to TRUE. This means, if you want to act on new data that differs from the previously received data, check the b Data Changed output. This output will only be set to TRUE if the receive buffer indicates a change to the previously received packet. IF fb Read.b Data Changed THEN ... END_IF If you are interested in receiving data regardless of the data differing from the previously received payload, check the b Data Available output instead. IF fb Read.b Data Available THEN ... END_IF Writing data The following sample demonstrates how to set up a conditional write operation that will only be executed if the b Write flag is set to TRUE. Before calling the Write method ensure that the function block is not busy. If you write to a busy function block instance, the call will return without starting the write operation. IF b Write THEN IF NOT fb Write.b Busy THEN b Write := FALSE; fb Write. Write(ADR(n Out), SIZEOF(n Out)); END_IF END_IF 4.4 Synchronizing message operations TC3 Io T Functions includes functionalities for synchronizing multiple message operations. This can be very useful in scenarios where data comes in from different data sources/channels. The function block FB_Iot Functions_Request [} 41] provides different mechanisms for synchronizing message operations. Example scenario A cocktail mixer provides different ingredients and every cocktail consists of five ingredients. An ingredient is added to the recipe by pressing a button. The cocktail mixer starts mixing the cocktail after the fifth ingredient has been selected. When an ingredient is selected, an MQTT message is published to a (different) topic. These messages should be received by TC3 Io T Functions. TF6710 Version: 1.1.1 19
## Page 20

Technical introduction Basic setup TC3 Io T Data Agent is configured with an MQTT gate and five different channels for TC3 Io T Functions. Every channel is configured for an “ingredient topic”. To synchronize the read operation for five different ingredients, an instance of FB_Iot Functions_Request is created. Then an instance of FB_Iot Functions_Message is created for each of the five channels. fb Request Ingredients : FB_Iot Functions_Request; fb Read Ingredient : ARRAY[0..4] OF FB_Iot Functions_Message := [(n Channel Id := 1),(n Channel Id := 2), (n Channel Id := 3),(n Channel Id := 4),(n Channel Id := 5)]; n In : ARRAY[0..4] OF STRING; The synchronized request then can be created as follows: IF NOT fb Request Ingredients.b Busy THEN IF fb Request Ingredients.b Error THEN ... ELSE IF fb Request Ingredients.b Timeout Occurred THEN ... ELSE // request was successful ... END_IF END_IF // Prepare next read operation for ingredients fb Request Ingredients. Create(); fb Request Ingredients. Enqueue Read(ADR(fb Read Ingredient [0]),ADR(n In[0]),SIZEOF(n In[0])); fb Request Ingredients. Enqueue Read(ADR(fb Read Ingredient [1]),ADR(n In[1]),SIZEOF(n In[1])); fb Request Ingredients. Enqueue Read(ADR(fb Read Ingredient [2]),ADR(n In[2]),SIZEOF(n In[2])); fb Request Ingredients. Enqueue Read(ADR(fb Read Ingredient [3]),ADR(n In[3]),SIZEOF(n In[3])); fb Request Ingredients. Enqueue Read(ADR(fb Read Ingredient [4]),ADR(n In[4]),SIZEOF(n In[4])); fb Request Ingredients. Execute(); END_IF Sample04 shows the full sample code (see Samples [} 47]). 20 Version: 1.1.1 TF6710
## Page 21

Technical introduction Synchronization conditions The function block instance fb Request contains different synchronization conditions. These can be used to determine whether the read operations within the request were successful, threw an error or resulted in a timeout. Note how the different timeout and retry settings can help in supporting this use case (see Timeout settings [} 21]). Condition Description b Busy TRUE: Request is still in progress and not all operations have been completed successfully FALSE: Request has been finished. To figure out if an error or timeout occurred, further flags need to be evaluated. b Timeout Occurred TRUE: Request Timeout has been triggered for at least one operation. FALSE: No timeout occurred. b Error TRUE: An error occurred for at least one operation. FALSE: No error occurred. Flags of each message operation In addition, the flags (error, success, b Data Available, b Data Changed) of each message operation can be analyzed in order to figure out if a request operation was successful or failed. 4.5 Timeout settings The function blocks of TC3 Io T Functions include several timeout settings that may help the user to handle errors regarding the retry operations. The following section explains the different timeout settings more detailed. Request Timeout The Request Timeout can be either set globally on an instance of FB_Iot Functions_Connector or individually on an instance of FB_Iot Functions_Message. Individual settings always override global settings. The Request Timeout closely works together with the Message Retry Interval setting. The Request Timeout specifies when a message operation (read/write) will time out. For example, if Request Timeout is set to 10000, a read operation will time out after 10 seconds if no data has been received. If data is received within 10 seconds, the operation will finish immediately. Message Retry Interval The Message Retry Interval can be either set globally on an instance of FB_Iot Functions_Connector or individually on an instance of FB_Iot Functions_Message. Individual settings always override global settings. The Message Retry Interval closely works together with the Request Timeout setting. The Message Retry Interval specifies the time interval in [ms] when a message operation will be retried. The upper limit of the interval is always the Request Timeout. For example, if Request Timeout is set to 10000 and Message Retry Interval to 1000, a read operation will be retried ten times before the Request Timeout is triggered and the read operation times out. Cumulative Timeout The Cumulative Timeout can be set on instances of FB_Iot Functions_Request when synchronizing message operations (see Synchronizing message operations [} 19]). The use case is as follows (example): • There are three read operations that should be synchronized. • Every read operation comes from a different channel • Request Timeout is globally set to 10000 ms • Cumulative Timeout is globally set to 3000 ms TF6710 Version: 1.1.1 21
## Page 22

Technical introduction • After 8000 ms the first message comes in via channel 1. • Since only 2000 ms remain until the Request Timeout time is reached, the Cumulative Timeout is added to the remaining Request Timeout time, to prevent a time out of the whole request. The Request Timeout time is then 5000 ms. This gives the request more time to gather data via the other two read operations. If there is no data on the other two operations after 5000 ms, the whole request will time out. 22 Version: 1.1.1 TF6710
## Page 23

Configuration 5 Configuration 5.1 Overview TC3 Io T Functions uses TC3 Io T Data Agent functionalities in order to connect to cloud services. To configure access to a cloud service and provide access credentials, the TC3 Io T Data Agent configurator can be used. Within the configurator, the following configuration steps are required: 1. Create a gate (e.g. Azure Io T Hub) and configure all required connection credentials. 2. Create a server channel on the new gate and note the channel ID. 3. Activate the configuration and start TC3 Io T Data Agent. In order to use this configuration in TC3 Io T Functions, reference the channel ID in the function block FB_Iot Functions_Message. 5.2 Configurator The TC3 Io T Data Agent configurator is an easy-to-use, graphical user interface that abstracts the XML configuration file and provides a modern interface that includes all functionalities to easily configure symbols that should be send to or received from a cloud service. The configurator is also used to configure TC3 Io T Functions. TF6710 Version: 1.1.1 23
## Page 24

Configuration Standard components The TC3 Io T Data Agent configurator consists of the following areas: Menu and toolbar Provides commands for saving and opening files and for starting and stopping the application Hierarchical Tree View Gives a hierarchical overview of the configuration to create and edit a configuration Topology view Gives a graphical overview of the configuration to create and edit a configuration Properties window Shows the properties of an activated component in the topology or tree view. Logging Provides log information from the configurator. Cascading Editor Helps to navigate through large and complex navigations by providing filtering mechanisms for symbols Mapping Links Gives an overview of all links between symbols in the configuration Target Browser Is used to provide symbolic access for ADS and OPC UA target runtimes Installation The configurator is installed automatically by the setup and is available as a shortcut in the Windows start menu. When starting the configurator the first time, it asks for the generation of an OPC UA client certificate. This certificate is used by the configurator in its integrated OPC UA Target Browser to connect to a server and search its namespace. After the certificate has been created, the configurator user interface is displayed. 24 Version: 1.1.1 TF6710
## Page 25

Configuration 5.2.1 Topology view The topology view (or “canvas”) is the central graphical configuration area of the TC3 Io T Data Agent configurator. It shows the following components of a configuration: • The configured gates, channels and symbols • The relationship (mapping) between gates, channels and symbols • The cardinality on each relationship The topology view can be used to create and edit a configuration. Simply right-click the canvas to open the context menu and select from the variety of configuration options, e.g. to create a new gate, attach a new channel to a gate or remove a component from the configuration. You can move any object in the topology view by dragging it to a new position. Each attached subcomponent is moved together with its parent. Optionally, you can also hide a subcomponent by clicking the expand button of its parent. When saving a configuration, the position of each object is saved in the configuration file. In order to make navigational tasks a little easier, the topology view supports the following functionalities: • Scrollbars for vertical and horizontal navigation • Vertical navigation via mouse wheel • Horizontal navigation via mouse wheel and SHIFT key (press and hold) • Zoom In/Zoom Out via mouse wheel and CTRL key (press and hold) Instead of the topology view you can also use the tree view for configuration, but the topology view might give a better graphical overview of the currently configuration (see Tree view [} 26]) TF6710 Version: 1.1.1 25
## Page 26

Configuration 5.2.2 Tree view The tree view provides a hierarchical view of the currently opened configuration. It shows the following components of a configuration: • The configured gates, channels and symbols • The existence of a relationship (mapping) between symbols The tree view can also be used to edit the configuration, but it may be easier to use the topology view instead (see Topology view [} 25]). 5.2.3 Mappings The mappings window gives an overview of all links between symbols in the currently opened configuration. When a link is selected, it is automatically highlighted in the topology view. 26 Version: 1.1.1 TF6710
## Page 27

Configuration 5.2.4 Target Browser The Target Browser is used to provide symbolic access for ADS and OPC UA target runtimes. It can be used to configure symbols for a target runtime by drag-and-drop. Fig. 1: 5.2.5 Cascading Editor The Cascading Editor helps to navigate through large and complex configurations by providing filtering mechanisms for symbols. Starting from left to right you can select gates and channels in order to display the corresponding symbols. In addition, you can also search for symbol names using free text. When a component is selected, it is automatically highlighted in the topology view. TF6710 Version: 1.1.1 27
## Page 28

Configuration 5.2.6 Parameter Editor The Parameter Editor enables the configuration of symbol metadata for symbols in a Publisher channel. As a prerequisite, the Publisher channel must be configured to use the "Twin CAT JSON" data format. New symbol parameters can then be added by right-clicking on a symbol and selecting Add Symbol Parameter. This adds a new symbol parameter entry to the Parameter Editor. The data type, name and value of the new parameter can then be defined. A result of the above configuration can look like this when using the Twin CAT JSON data format. In this configuration, the variable "GVL_nodes_dynamic.dyn_scalar_UI8" was configured with the symbol parameters Min, Max and Unit. These parameters are added to the "Meta Data" section of the Twin CAT JSON-formatted message. { "Timestamp": "2020-09-28T12:32:49.0370000+02:00", "Group Name": "Publisher", "Values": { "GVL_nodes_dynamic.dyn_scalar_UI8": 259096147, "GVL_nodes_dynamic.dyn_scalar_UI1": 83, "GVL_nodes_dynamic.dyn_scalar_UI2": 32339, "GVL_nodes_dynamic.dyn_scalar_UI4": 259096147 }, "Meta Data": { "GVL_nodes_dynamic.dyn_scalar_UI8": { "Timestamp": "2020-09-28T12:32:49.0350000+02:00", "Min": -10, "Max": 100, "Unit": "Celsius" }, "GVL_nodes_dynamic.dyn_scalar_UI1": { "Timestamp": "2020-09-28T12:32:49.0350000+02:00" }, "GVL_nodes_dynamic.dyn_scalar_UI2": { "Timestamp": "2020-09-28T12:32:49.0350000+02:00" }, "GVL_nodes_dynamic.dyn_scalar_UI4": { "Timestamp": "2020-09-28T12:32:49.0350000+02:00" 28 Version: 1.1.1 TF6710
## Page 29

Configuration } } } Parameters can also be added to a channel, adding metadata properties to the root message. Example: As a result, the root message now contains a static metadata property called "Room", which has the value "Living Room": { "Timestamp": "2020-09-30T09:55:58.1160000+02:00", "Group Name": "Publisher", "Room": "Living Room", "Values": { "GVL_nodes_dynamic.dyn_scalar_UI8": 267266470, "GVL_nodes_dynamic.dyn_scalar_UI1": 166, "GVL_nodes_dynamic.dyn_scalar_UI2": 10662, "GVL_nodes_dynamic.dyn_scalar_UI4": 267266470 }, "Meta Data": { "GVL_nodes_dynamic.dyn_scalar_UI8": { "Timestamp": "2020-09-30T09:55:58.1140000+02:00", "Min": -10, "Max": 100, "Unit": "Celsius" }, "GVL_nodes_dynamic.dyn_scalar_UI1": { "Timestamp": "2020-09-30T09:55:58.1140000+02:00" }, "GVL_nodes_dynamic.dyn_scalar_UI2": { "Timestamp": "2020-09-30T09:55:58.1140000+02:00" }, "GVL_nodes_dynamic.dyn_scalar_UI4": { "Timestamp": "2020-09-30T09:55:58.1140000+02:00" } } } 5.2.7 Settings This section provides some detailed information about the different configuration parameters that can be set on gates, channels and symbols. 5.2.7.1 Gates A Gate represents a communication protocol or specific connectivity service, e.g. ADS, OPC UA, MQTT, AWS Io T or Microsoft Azure Io T Hub. Each Gate is configured with parameters that are specific for the corresponding Gate type. ADS A Beckhoff ADS device represents either a Twin CAT 2/3 or a Beckhoff BC device. ADS is the common Beckhoff communication protocol and can be used to access many parts of the Twin CAT system. The most common application scenarios for TC3 Io T Data Agent involve access to a Twin CAT 2/3 PLC, C++, Tc COM modules or the I/O process image, which is done via ADS. When configuring an ADS gate, the following settings are required by the TC3 Io T Data Agent to access the underlying ADS device: TF6710 Version: 1.1.1 29
## Page 30

Configuration Setting Description Ams Net Id Ams Net Id of the target device, e.g. 127.0.0.1.1.1 for the local device. Ads Port Ads Port of the target device, e.g. 801 (Twin CAT 2 PLC) or 851 (Twin CAT 3 PLC) Io Mode Specifies how the TC3 Io T Data Agent should communicate with the ADS device. The following options can be set: • Direct: accesses every symbol with a separate ADS command. Mandatory for BC controllers but increases ADS traffic • Batched: accesses symbols batched into an ADS sum command, which optimizes ADS traffic and can be used for Twin CAT 2 and 3 PLC or C++ runtimes OPC UA OPC UA is a standardized, industrial, client/server communication protocol and adopted by many vendors for different use cases. The TC3 Io T Data Agent can access OPC UA server devices to connect variables (so-called “nodes”) on those devices with Io T services. When configuring an OPC UA gate, the following settings are required by the TC3 Io T Data Agent to access the underlying OPC UA device: Setting Description Server URL The OPC UA Server URL, e.g. opc.tcp://localhost:4840 Security policy The OPC UA security policy that the TC3 Io T Data Agent should use during connection establishment with the OPC UA server Security mode The OPC UA message security mode that the TC3 Io T Data Agent should use during connection establishment with the OPC UA server Authentication mode The OPC UA authentication mode that the TC3 Io T Data Agent should use during connection establishment with the OPC UA server MQTT MQTT can be used for connecting to a generic message broker, e.g. Mosquitto, Hive MQ or similar broker types. Setting Description Broker address The IP address or hostname of the MQTT message broker Port MQTT specifies port 1883 for unencrypted communication and 8883 for encrypted communication Client Id A numeric or string-based value that identifies the client. Depending on the message broker type, this ID should be unique Authentication mode Specifies if the TC3 Io T Data Agent should authenticate to the broker by using a username/password combination TLS mode Specifies if TLS should be used to secure the communication channel to the message broker. Note that the message broker also needs to support TLS in order for this to work. Different options are available for TLS: • CA certificate: Only uses the CA certificate for server authentication • Client certificate: Uses a client certificate for mutual client/server authentication • PSK: Used a common PSK-Identity and PSK-Key that is known to the message broker and the client Microsoft Azure Io T Hub With Azure Io T Hub the Microsoft Azure cloud platform offers a connectivity service in the cloud that provides bi-directional communication, device security and automatic scalability. In the TC3 Io T Data Agent, the Io T Hub can be configured as a special gate type. 30 Version: 1.1.1 TF6710
## Page 31

Configuration Setting Description Host Name URL of the Azure Io T Hub instance Device Id Device Id of the device that has been created on the Io T Hub configuration website Shared Access Key Either the primary or secondary device key that has been generated together with the device on the Io T Hub configuration website CA file CA file that is used for server authentication. At the time writing this article, three certificates are in play during the server authentication, which form part of the certificate chain and are linked together. • Root CA: Baltimore Cyber Trust Root • Intermediate CA: Baltimore Cyber Trust • Wilcard certificate During the initial TLS handshake, only the first two are sent by the server to the client. The client will normally only validate the Root CA of the chain and will determine if it is trusted. In order to acquire the CA file for the Root CA, you can open the Windows certificate store (certmgr.msc), browse to the trusted root authorities and export the Baltimore Cyber Trust Root certificate. AWS Io T With AWS Io T the Amazon Web Services cloud platform offers a message broker service in the cloud that provides bi-directional communication, device security and automatic scalability. In the TC3 Io T Data Agent, AWS Io T is configured as a regular MQTT gate. However, some special MQTT settings have to be configured to successfully connect to an AW Io T instance. Setting Description Broker address The URL of the AWS Io T instance Port Port 8883 for encrypted TLS communication is mandatory Client Id Can be set to anything but needs to be unique. Typically this could be the AWS Io T thing name. Authentication mode Set to “No authentication”. Authentication on AWS Io T is done via the TLS client certificate. TLS mode Automatically set to “Client certificate” by the configurator. Select path to CA file, client certificate file and client key file. These are the files that can be generated and downloaded on the AWS Io T configuration website. 5.2.7.2 Channels Channels are configured on a Gate to send (“publisher”) or receive (“subscriber”) data to/from a Gate. • Source: This Gate is the source of the data, i.e. the TC3 Io T Data Agent connects to the Gate and requests data from it in order to send it somewhere else (to a "Destination Gate"). Technically, this is also referred to as the “Subscriber Channel”. • Destination: This Gate is the destination of the data, i.e. the TC3 Io T Data Agent connects to the Gate and sends it data that it has received from another Gate (from a "Source Gate"). Technically, this is also referred to as the “Publisher Channel”. Each channel has different settings that either describe the data format that should be used for this channel or the sampling settings that the TC3 Io T Data Agent should use for gathering data. These settings may also depend on the Gate type for which the channel is configured. All available settings are listed in the table below. TF6710 Version: 1.1.1 31
## Page 32

Configuration Setting Description Applicable to Gate type Direction Specifies whether the channel should be either a All Gates Publisher (sender) or Subscriber (receiver) Channel. Depending on the selection and Gate type, other settings are required or pre-selected. Setting Description Applicable to Gate type Sampling Mode Selects if the channel should use either cyclic or All Gates event-based sampling mechanisms when gathering data from a source. It should be noted that not all Gates support both types, depending on the direction. An MQTT Gate, for example, uses when receiving data always Sampling Mode “event” (this is always event-based due to the Pub/Sub principle). Cycle Time Only applicable for Sampling Mode “cyclic”. Specifies All Gates the sampling rate in [ms]. Timeout The timeout for a communication with the Gate in [ms]. All Gates Partial Update Enables/disables partial updates on this channel. All Gates When enabled (default), a Publish includes only the updated symbol. When disabled, a Publish includes all symbols of a channel with their last known value. Only applicable to Publisher channels. Buffer Size Specifies the size (number of messages) of the ring MQTT, AWS Io T, Azure Io T buffer in the event of connection loss. Hub Setting Description Applicable to Gate type Formatter Specifies the data format to use for this channel, such MQTT, AWS Io T, Azure Io T as binary or JSON. Note that some Gates require their Hub channels to use a predefined data format, such as ADS or OPC UA Gates, because communication with these devices requires a specific format. In this case the Formatter is predefined and not changeable via the configurator. Formatter Type Specifies the Formatter type on this channel. In most MQTT, AWS Io T, Azure Io T cases, the Formatter type is an In Out type. For more Hub information on this setting, see our documentation article on writing custom plugins using the Formatter interface. Setting Description Applicable to Gate type Topic Specifies the MQTT topic to be used for publishing or MQTT subscribing. Qo S Specifies the Qo S (Quality-of-Service) level to be MQTT, AWS Io T used for publishing or subscribing. Retain Specifies whether a message should be sent as MQTT "Retain". (Only relevant for the Publisher channel) 32 Version: 1.1.1 TF6710
## Page 33

Configuration Setting Description Applicable to Gate type Send State Info When enabled, the TC3 Io T Data Agent publishes its MQTT, AWS Io T Online State to the subtopic /Desc/ and uses this subtopic in its Last Will. When the TC3 Io T Data Agent connects to the message broker, a JSON message is published to this topic containing the following { “Online State” : true } When the TC3 Io T Data Agent properly disconnects from the message broker, the following message is sent to this topic: { “Online State” : false } When the message broker detects, that the TC3 Io T Data Agent has lost the connection, the following message is sent to this topic (Last Will): { “Online State” : false } Sampling Modes The TC3 Io T Data Agent includes different sampling modes that influence the way data is acquired from a source or written to a destination. The sampling mode can be set on a channel. The following sampling modes are currently available: • Cyclic • On Change • Trigger Symbol Cyclic Cyclic sampling means that the TC3 Io T Data Agent is cyclically sampling the gate for data (subscriber channel) or cyclically writing data to a gate (publisher channel). On a subscriber channel, this results in cyclic read commands whereas on a publisher channel this results in cyclic write commands, e.g. on an ADS or OPC UA gate. On gate types that are based on publisher/subscriber concepts, e.g. MQTT, AWS Io T and Azure Io T Hub gates, cyclic requests on a subscriber channel are automatically replaced by subscriptions whereas on a publisher channel this results in cyclic publish commands. On Change On Change sampling means that the TC3 Io T Data Agent only communicates data with a gate if the value of a variable has changed. Trigger symbols Trigger symbols enable “on demand” sampling, e.g. if a certain condition for a specified symbol (the so- called “trigger symbol”) is fullfilled. Different condition types can be set. They are configured as part of a channel and allow to specify the following condition types. Condition type Description EQ Trigger symbol value equals a given value NE Trigger symbol value differs from a given value LE Trigger symbol value is less than or equals a given value GE Trigger symbol value is greater than or equals a given value LT Trigger symbol value is less than given value GT Trigger symbol value is greater than given value If the condition is fullfilled, all symbols in that channel are published to the corresponding gate. In addition you can specify how often the symbol values should be send. TF6710 Version: 1.1.1 33
## Page 34

Configuration Send behavior Description rising Edge Symbols are only send once when the condition is fullfilled continuous Symbols are send as long as the condition is fullfilled Usage of trigger symbols Trigger symbols can only be configured for ADS and OPC UA subscriber symbols. • Add the symbol that should act as trigger symbol to the ADS or OPC UA subscriber channel. • Configure the linked publisher channel with Sampling Mode “On Trigger” to specify the previously added symbol as trigger symbol. 5.2.7.3 Symbols Symbols represent variables from a gate, e.g. a Twin CAT PLC variable. The symbol configuration includes the address information that the Data Agent requires in order to read a symbol’s value or write to it. This address information is therefore depending on the gate type. On gates that support a target browser [} 27], the browser will automatically detect the correct address information for a symbol. For all other gates, this information needs to be entered manually. 34 Version: 1.1.1 TF6710
## Page 35

Configuration Gate type Setting Description ADS URN Symbol name address information of the ADS variable. Might not work with all ADS devices, e.g. BC devices do not support symbol names. ADS Index Group Index Group/Index Offset combination can be used to access data of an ADS device that does not support symbolic Index Offset address information. In case of the Twin CAT PLC, the Index Group/Index Offset combination directly represents a memory address, e.g. from a PLC variable, which may change after a re-compilation of the Twin CAT project. It is therefore common practice to use the Twin CAT PLC symbol server instead, which provides symbolic information for its PLC variables, which means that a variable can be accessed via its symbol name instead, which stays valid even after a re-compilation or online change (if the symbol still exists). However, some ADS services do not include such a symbol server, e.g. small Beckhoff BC devices. In those cases the Index Group/Index Offset combination needs to be used. ADS Data Type Data type of the symbol ADS Conversion Specifies conversion mode for this symbol. OPC UA Name Descriptive name of the OPC UA node. Only used in Configurator, does not represent any online address information. OPC UA Identifier Identifier of OPC UA symbol on the server, e.g.: • s = MAIN.n Counter (if the Identifier Type is “String”) • n = 42 (if the Identifier Type is “Numeric”) OPC UA Ns Name Namespace name in which the symbol is located. This corresponds to the namespace index, which is part of an OPC UA Node Id. The translation can be done via the Namespace Array. OPC UA Attribute Id The Attribute Id defines the OPC UA attribute that should be used by the Data Agent when reading a symbol. In most scenarios, this is the “Value” of a symbol. OPC UA Conversion Specifies conversion mode for this symbol. MQTT URN Name of the MQTT symbol. This represents the name that is being used in the JSON format as a key, also when receiving data from the MQTT Gate. MQTT Data Type Data type of the symbol MQTT Conversion Specifies conversion mode for this symbol. Io T Hub URN Name of the Io T Hub symbol. This represents the name that is being used in the JSON format as a key, also when receiving data from Io T Hub. Io T Hub Data Type Data type of the symbol Io T Hub Conversion Specifies conversion mode for this symbol. When configuring a Channel, symbols can be added via a target browser or manually by providing the correct address information. Note that not all gate types include target browser functionalities. In this case symbols need to be configured manually. Manual symbol configuration If the target device is not online or does not provide any symbolic address information (e.g. the BC9191), symbols may also be added manually by entering the symbol address. The tables at the beginning of this document show which information is required in this case. TF6710 Version: 1.1.1 35
## Page 36

Configuration Type conversion The TC3 Io T Data Agent supports data type conversion before the data is published to a Gate. Type conversion occurs on symbol level, which means that different Symbols can use different conversion modes. The following table shows the different conversion modes available. Conversion mode Description Losless Default setting. “Smaller” types can be converted into “larger” types. For example, a subscriber symbol of data type INT can be published to a symbol of data type Int32 (2 byte to 4 byte). Lossy If required, “larger” symbols can also be converted into “smaller” symbols. For example, a subscriber symbol of data type DINT can be published to a symbol of data type Int16 (4 byte to 2 byte). Depending on the value of the subscriber symbol, this can of course result in cut-off values. Strict If required, symbols can also be configured to use “strict mode”. In this conversion mode, the data type size of a subscriber symbol needs to match exactly the data type of the mapped publisher symbol. For example, a subscriber symbol of data type INT can only be published to a symbol of data type Int16 (2 byte to 2 byte). 5.2.8 Error logging For troubleshooting purposes, the TC3 Io T Data Agent can generate a log file that can be filled based on different logging levels. All necessary settings can be configured via the properties window of the configurator. To do this, simply click on an empty space in the topology view and configure the logging settings in the properties window. Note that all settings are associated with the currently open configuration and must be defined for each configuration. The default directory in which the log file is created is the Twin CAT boot directory. The placeholder [Boot Dir] automatically selects the Twin CAT boot directory. Logging window The Logging window in the configurator displays only logged events related to the configurator. To create a log for the TC3 Io T Data Agent background service, the above settings are required. 36 Version: 1.1.1 TF6710
## Page 37

PLC API 6 PLC API 6.1 Function blocks 6.1.1 FB_Iot Functions_Connector The function block enables communication with a local/remote TC3 Io T Data Agent installation. The Execute method of the function block must be called cyclically in order to ensure the background communication with the TC3 Io T Data Agent to facilitate the reception of messages. All connection parameters and global settings are available as input parameters. Syntax FUNCTION_BLOCK FB_Iot Functions_Connector VAR_INPUT s Ams Net Id : STRING; n Default Request Timeout : UDINT; n Default Message Retry Interval : UDINT; n Default Message Cumulative Timeout : UDINT; END_VAR VAR_OUTPUT hr Initialization Error Code : HRESULT; hr Last Message Error Code : HRESULT; driver OTCID : OTCID; p St Iot Functions Requests : POINTER TO ST_Iot Functions Request Container; END_VAR Inputs Designation Type Description s Ams Net Id STRING Target Data Agent Instance Ams Net Id [127.0.0.1.1.1] n Default Request Timeout UDINT Default timeout value in milliseconds [10000] n Default Message Retry Inter UDINT Default message retry interval in milliseconds (0 disables val retries) [0] n Default Message Cumulati UDINT Default cumulative timeout in milliseconds (if message ve Timeout data is successfully received, the timeout of the relevant request is extended by this value) [0] Outputs Designation Type Description hr Initialization Error Code HRESULT HRESULT of driver instantiation and configuration hr Last Message Error Code HRESULT HRESULT of latest reported error occurred in any message during the Execute call. driver OTCID OTCID OTCID of the instantiated driver (can be passed on to FB input variables for requests and messages in environments with multiple data agents) p St Iot Functions Requests POINTER TO Description of latest error code. ST_Iot Functions Requ est Container [} 46] TF6710 Version: 1.1.1 37
## Page 38

PLC API Methods Designation Description Execute [} 38] Enables background communication with TC3 Io T Data Agent. The method must be called cyclically. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4022.14 IPC or CX (c86, x64, ARM) Tc3_Iot Functions 6.1.1.1 Execute This method allows background communication with the TC3 Io T Data Agent. It must be called cyclically. Syntax METHOD Execute : HRESULT Return value Name Type Description Execute HRESULT Indicates whether the call was successful. 6.1.2 FB_Iot Functions_Message The function block provides read/write operations for messages. All message parameters as well as global settings exist as input parameters. Syntax FUNCTION_BLOCK FB_Iot Functions_Message VAR_INPUT n Channel Id : UINT; n Request Timeout : UDINT; n Message Retry Interval : UDINT; n Message Cumulative Timeout : UDINT; iot Functions Driver OTCID : OTCID; END_VAR VAR_OUTPUT h Result : HRESULT; p St Message Details : POINTER TO ST_Iot Functions Message; p St Request Details : POINTER TO ST_Iot Functions Request; b Initialized : BOOL; fb Tc Result Event : FB_Tc Iot Functions Result Event; END_VAR 38 Version: 1.1.1 TF6710
## Page 39

PLC API Inputs Designation Type Description n Channel Id UINT Channel ID of the corresponding Iot Functions channel in the configuration of the target data agent instance. n Request Timeout UDINT Timeout value in milliseconds. n Message Retry Interval UDINT Message interval in milliseconds (0 disables retries). n Message Cumulative Time UDINT Cumulative timeout (the successful receipt of message out data extends the timeout of the relevant request by this value). iot Functions Driver OTCID OTCID OTCID of the target Iot Functions driver instance (see driver OTCID of FB_Iot Functions_Connector) Outputs Designation Type Description h Result HRESULT Contains the last hresult (is updated when b Busy or b Error are accessed or Read/Write is called) p St Message Details POINTER TO Pointer to structure containing detailed information about ST_Iot Functions Mess the underlying message age [} 44] p St Request Details POINTER TO Pointer to structure containing detailed information about ST_Iot Functions Requ the underlying request in which this message is executed est [} 45] b Initialized BOOL Indicates whether interface search and initialization was successful fb Tc Result Event FB_Tc Iot Functions R Instance of a helper function block that contains detailed esult Event information about the send or receive process. Methods Designation Description Read [} 39] Reads a message from the channel Acknowledge [} 40] Acknowledges the error/success status and releases the associated message objects. Call this method after status acknowledgement if no new read/write process is started in this cycle to prevent multiple evaluation of the last status. Write [} 40] Writes a message to the channel Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4022.14 IPC or CX (c86, x64, ARM) Tc3_Iot Functions 6.1.2.1 Read This method reads a message from the channel. TF6710 Version: 1.1.1 39
## Page 40

PLC API Syntax METHOD Read : HRESULT VAR_INPUT p Payload : PVOID; n Payload : UDINT; END_VAR Return value Name Type Description Read HRESULT Indicates whether the call was successful. Inputs Name Type Description p Payload PVOID Pointer to the target memory. n Payload UDINT Size of the target memory. 6.1.2.2 Acknowledge The method acknowledges the error/success status and releases the associated message objects. Call this method after status acknowledgement if no new read/write process is started in this cycle to prevent multiple evaluation of the last status. Syntax METHOD Acknowledge : BOOL Return value Name Type Description Acknowledge BOOL Indicates whether the call was successful. 6.1.2.3 Write This method writes a message to the channel. Syntax METHOD Write : BOOL VAR_INPUT p Payload : PVOID; n Payload Size : UDINT; END_VAR Return value Name Type Description Write BOOL Indicates whether the call was successful. 40 Version: 1.1.1 TF6710
## Page 41

PLC API Inputs Name Type Description p Payload PVOID Address of the target memory. n Payload Size UDINT Size of the target memory. 6.1.3 FB_Iot Functions_Request The function block enables the synchronization of multiple messages (see Synchronizing message operations [} 19]). Syntax FUNCTION_BLOCK FB_Iot Functions_Request VAR_INPUT iot Functions Driver OTCID : OTCID; n Request Timeout : UDINT; END_VAR VAR_OUTPUT h Result : HRESULT; p St Request Details : POINTER TO ST_Iot Functions Request; b Initialized : BOOL; fb Tc Result Event : FB_Tc Iot Functions Result Event; END_VAR Inputs Designation Type Description iot Functions Driver OTCID OTCID OTCID of the target Iot Functions driver instance [defaults to the first created object of the FB_Iot Functions_Connector] n Request Timeout UDINT Timeout value in milliseconds Outputs Designation Type Description h Result HRESULT Contains the hresult of the last message (is updated when b Busy or b Error is accessed or Create/Execute/ Enqueue Read/Enqueue Write is called) p St Request Details POINTER TO Pointer to structure containing details information about ST_Iot Functions Requ the underlying request est [} 45] b Initialized BOOL Indicates whether interface search and initialization was successful fb Tc Result Event FB_Tc Iot Functions R Instance of a helper function block that contains detailed esult Event information about the send or receive process. TF6710 Version: 1.1.1 41
## Page 42

PLC API Methods Designation Description Create [} 42] Creates a new request Enqueue Read [} 42] Adds an instance of FB_Iot Functions_Message [} 38] for read operation Enqueue Write [} 43] Adds an instance of FB_Iot Functions_Message [} 38] for write operations Execute [} 43] Executes the request Acknowledge [} 40] Acknowledges the error/success status and releases the associated message objects. Call this method after status acknowledgement if no new read/write process is started in this cycle to prevent multiple evaluation of the last status. Requirements Development environment Target platform PLC libraries to include Twin CAT v3.1.4022.14 IPC or CX (c86, x64, ARM) Tc3_Iot Functions 6.1.3.1 Create This method creates a new request. Syntax METHOD Create : BOOL Return value Name Type Description Create BOOL Indicates whether the call was successful. 6.1.3.2 Enqueue Read The method adds an instance of FB_Iot Functions_Message [} 38] for read operations. Syntax METHOD Enqueue Read : BOOL VAR_INPUT p Message FB : POINTER TO FB_Iot Functions_Message; p Payload : POINTER TO PVOID; n Payload Size: UDINT; END_VAR 42 Version: 1.1.1 TF6710
## Page 43

PLC API Return value Name Type Description Enqueue Read BOOL Indicates whether the call was successful. Inputs Name Type Description p Message FB POINTER TO Pointer to an object of type FB_Iot Functions_Message. FB_Iot Functions_Mes sage p Payload POINTER TO PVOID Address of the content. n Payload Size UDINT Size of the content. 6.1.3.3 Enqueue Write Adds an instance of FB_Iot Functions_Message [} 38] for write operations. Syntax METHOD Enqueue Write : BOOL VAR_INPUT p Message FB : POINTER TO FB_Iot Functions_Message; p Payload : POINTER TO PVOID; n Payload Size: UDINT; END_VAR Return value Name Type Description Enqueue Write BOOL Indicates whether the call was successful. Inputs Name Type Description p Message FB POINTER TO Pointer to an object of type FB_Iot Functions_Message. FB_Iot Functions_Mes sage p Payload POINTER TO PVOID Address of the content. n Payload Size UDINT Size of the content. 6.1.3.4 Execute Syntax METHOD Enqueue Write : BOOL TF6710 Version: 1.1.1 43
## Page 44

PLC API Return value Name Type Description Execute BOOL Indicates whether the call was successful. 6.2 Data types 6.2.1 ST_Iot Functions Event The data type contains detailed information about the cause of the last error code result. Syntax (* guid of underlying event class *) uuid Event Class: GUID; (* event id of underlying event *) n Event Id : UDINT; (* severity level of underlying event *) n Severity : UDINT; (* verbose message of underlying event *) s Event Msg : STRING(255); (* verbose event class name of underlying event *) s Event Class : STRING(255); (* verbose origin of underlying event *) s Source Path : STRING(255); (* cycle in which underlying event occurred *) n Cycle : ULINT; Parameter Name Type Description uuid Event Class GUID GUID of the Event Class. n Event Id UDINT ID of the event. n Severity UDINT Severity of the event. s Event Msg STRING Detailed message of the event. s Event Class STRING Detailed class name of the event. s Source Path STRING Detailed source path of the event. n Cycle ULINT Cycle in which the event occurred. 6.2.2 ST_Iot Functions Message Contains detailed information about the underlying message object. Syntax (* request Id of governing request containing this message *) n Request Id : ULINT; (* cycle in which this message was created *) n Cycle Created : ULINT; (* time passed since creation (in milliseconds) *) n Age : ULINT; (* corresponding Io TData Agent channel *) n Channel Id : UDINT; (* hr Result of latest action *) hr Result Code : HRESULT; 44 Version: 1.1.1 TF6710
## Page 45

PLC API (* message Id *) n Message Id : UINT; (* amount of initiated Ads requests during message lifetime *) n Ads Request Count : UINT; (* amount of received Ads confirmations during message lifetime *) n Ads Confirmation Count : UINT; (* current (internal) state of message object. *) e Message State : EIot Functions Message State; (* message direction [read/write] *) e Message Direction : EIot Functions Message Direction; (* indicates if the accepted data differes from the previously contained data (relevant for reading data) *) b Buffer Changed : BOOL; (* name of the corresponding symbol *) s Symbol Name : STRING(255); Parameter Name Type Description n Request Id ULINT ID of the request containing this message. n Cycle Created ULINT Cycle in which this message was created. n Age ULINT Elapsed time since this message was created in milliseconds. n Channel Id UDINT ID of the channel to be used in the Data Agent. hr Result Code HRESULT HRESULT of the last operation performed. n Message Id UINT ID of this message. n Ads Request Count UINT Number of ADS operations during the lifetime of this message (ADS requests). n Ads Confirmation Count UINT Number of ADS operations during the lifetime of this message (ADS confirmations). e Message State EIot Functions Message State Current internal state of this message object. e Message Direction EIot Functions Message Direction Direction of this message (read or write). b Buffer Changed BOOL Indicates whether the content of the message buffer has changed (relevant for read operations). s Symbol Name STRING Name of the symbol used. 6.2.3 ST_Iot Functions Request The data type contains detailed information about the underlying request object. Syntax (* request Id *) n Request Id : ULINT; (* cycle in which this request was created *) n Cycle Created : ULINT; (* time passed since creation (in milliseconds) *) TF6710 Version: 1.1.1 45
## Page 46

PLC API n Age : ULINT; (* time until request expires (timeout) (in milliseconds) *) n Time To Live : ULINT; (* count of currently pending messages in this request *) n Pending Count : UDINT; (* count of currently contained messages in this request *) n Total Count : UINT; (* indicates if the corresponding internal object has been removed *) b Is Removed : BOOL; (* indicates if any contained message has timed out *) b Is Timed Out : BOOL; (* indicates if all contained messages have been processed (regardless of success, error or timeout states) *) b Is Completed : BOOL; Parameter Name Type Description n Request Id ULINT ID of this request. n Cycle Created ULINT Cycle in which this request was created. n Age ULINT Elapsed time since this request was created in milliseconds. n Time To Live ULINT Remaining time until this request expires in milliseconds. n Pending Count UDINT Number of currently pending messages for this request. n Total Count UINT Number of all messages contained in this request. b Is Removed BOOL Indicates whether the internal object of this request has already been removed. b Is Timed Out BOOL Indicates whether any contained message has run into a timeout. b Is Completed BOOL Indicates whether all contained messages have been processed (regardless of the final processing status). 6.2.4 ST_Iot Functions Request Container The data type contains an array of ST_Iot Functions Requests that represents the requests processed by the contained FB_Iot Functions_Connector instance. Syntax (* array of ST_Iot Functions Requests *) ap Iot Requests : ARRAY [0..99] OF POINTER TO ST_Iot Functions Request; Parameter Name Type Description ap Iot Requests ARRAY Array of ST_Iot Functions Requests representing the requests processed by the contained FB_Iot Functions_Connector instance. 46 Version: 1.1.1 TF6710
## Page 47

Samples 7 Samples Samples for TC3 Io T Functions can be downloaded as a single container solution: https:// infosys.beckhoff.com/content/1033/TF6710_TC3_Io T_Functions/Resources/5247017867.zip TF6710 Version: 1.1.1 47
## Page 48

Appendix 8 Appendix 8.1 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 48 Version: 1.1.1 TF6710
## Page 50

More Information: www.beckhoff.com/tf6710.html Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
