---
title: "TE1111_TC3_EtherCAT_Simulation_EN"
product: "TE1111"
category: "Engineering_Tools"
tags: ["CAT", "ETHER", "EtherCAT", "SIMULATION"]
language: "EN"
document_type: "Manual"
version: "1.5.2"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TE1111_TC3_EtherCAT_Simulation_EN.pdf"
release_date: "2023-02-06"
---
Manual | EN TE1111 Twin CAT 3 | Ether CAT Simulation 2023-02-06 | Version: 1.5.2

## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 Safety instructions............................................................................................................................. 6 1.3 Notes on information security............................................................................................................ 7 2 Overview.................................................................................................................................................... 8 3 Installation/ Licensing.............................................................................................................................. 9 4 Basic principles....................................................................................................................................... 10 4.1 Cabling............................................................................................................................................ 10 4.2 Mailbox Auto Response.................................................................................................................. 13 4.3 Co E / So E / Ao E.............................................................................................................................. 14 5 Quickstart................................................................................................................................................ 18 6 Use of CU2508 port multipliers.............................................................................................................. 20 7 Fault simulation....................................................................................................................................... 21 8 Mixed operation of real and virtual slaves............................................................................................ 23 9 Reference, user interface....................................................................................................................... 24 9.1 Settings tab..................................................................................................................................... 24 9.2 Feature Simulation tab.................................................................................................................... 25 9.3 Fault Simulation tab........................................................................................................................ 25 10 PLC API.................................................................................................................................................... 27 10.1 ADS commands.............................................................................................................................. 27 TE1111 Version: 1.5.2 3

## Page 4

Table of contents 4 Version: 1.5.2 TE1111

## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is only intended for the use of trained specialists in control and automation engineering who are familiar with applicable national standards. It is essential that the documentation and the following notes and explanations are followed when installing and commissioning the components. It is the duty of the technical personnel to use the documentation published at the respective time of each installation and commissioning. The responsible staff must ensure that the application or use of the products described satisfy all the requirements for safety, including all the relevant laws, regulations, guidelines and standards. Disclaimer The documentation has been prepared with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without prior announcement. No claims for the modification of products that have already been supplied may be made on the basis of the data, diagrams and descriptions in this documentation. Trademarks Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H. Other designations used in this publication may be trademarks whose use by third parties for their own purposes could violate the rights of the owners. Patent Pending The Ether CAT Technology is covered, including but not limited to the following patent applications and patents: EP1590927, EP1789857, EP1456722, EP2137893, DE102015105702 with corresponding applications or registrations in various other countries. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The reproduction, distribution and utilization of this document as well as the communication of its contents to others without express authorization are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. TE1111 Version: 1.5.2 5

## Page 6

Foreword 1.2 Safety instructions Safety regulations Please note the following safety instructions and explanations! Product-specific safety instructions can be found on following pages or in the areas mounting, wiring, commissioning etc. Exclusion of liability All the components are supplied in particular hardware and software configurations appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. Personnel qualification This description is only intended for trained specialists in control, automation and drive engineering who are familiar with the applicable national standards. Description of symbols In this documentation the following symbols are used with an accompanying safety instruction or note. The safety instructions must be read carefully and followed without fail! DANGER Serious risk of injury! Failure to follow the safety instructions associated with this symbol directly endangers the life and health of persons. WARNING Risk of injury! Failure to follow the safety instructions associated with this symbol endangers the life and health of per- sons. CAUTION Personal injuries! Failure to follow the safety instructions associated with this symbol can lead to injuries to persons. NOTE Damage to the environment or devices Failure to follow the instructions associated with this symbol can lead to damage to the environment or equipment. Tip or pointer This symbol indicates information that contributes to better understanding. 6 Version: 1.5.2 TE1111

## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1111 Version: 1.5.2 7

## Page 8

Overview 2 Overview New machines and plants are becoming ever more complex and must be realized cost-effectively under considerable deadline pressure. Beyond that, the control software portion is continuously increasing, among other things due to the demand for flexibility with regard to the products that can be produced on a plant. A reduction of the engineering expenditure for the generation of the control code as well as the commissioning of this code in the actual plant thus promises a clear economic benefit. One of the methods aimed at achieving this is called “virtual commissioning”. The objective is to test and optimize the generated control code at an early stage of the engineering, even without any real existing hardware, so that the actual commissioning can proceed much faster. The TE1111 Twin CAT Ether CAT Simulation function has been created in order to fulfill these requirements. If, in addition, models of the machine/plant are already available in Matlab Simulink or a simulation tool that offers FMU (code) export, it is possible to perform HIL (Hardware-In-the-Loop) simulations together with the TE1400 Target for Matlab®/Simulink® or TE1420 Target for FMI functions with manageable effort. The TE1111 Twin CAT Ether CAT Simulation function simulates an Ether CAT segment. An already created I/O configuration of the real plant is exported and can be imported into a second system as an ‘Ether CAT Simulation’ device. A mirrored process image is thus available on this system that can be linked with corresponding Twin CAT modules (e.g. written in the IEC 61131-3 languages or generated from Matlab®/ Simulink®). The desired behavior of the machine must be implemented with sufficient accuracy in these modules. If the Twin CAT real-time is now started on both systems, one has an HIL simulation without having to adapt the original project in order to achieve this. Since the project for the control system to be tested should not be changed, the Ether CAT Simula- tion Device operates unsynchronized. This means that the task that drives the Simulation Device has to run twice as fast on account of Shannon’s theorem (sampling theorem). On standard IPC hardware the shortest cycle time of the simulation device is currently 50µs. HIL simulations of the control system to be tested are thus possible with a cycle time of 100µs. Features supported: Basic functionality • Digital slaves are supported along with slaves with Co E parameters • A mirrored process image is created and can be linked • Simple configuration of the Ether CAT Simulation Device directly in the Twin CAT XAE • Support for distributed clocks • Support for Ao E and So E mailbox commands (these are forwarded to the PLC) • Mixed simulation of real and simulated slaves • Hot Connect simulation (from Twin CAT 3.1.4024) • Fault simulation (Lost Frames, Link Lost, Working Counter) (from Twin CAT 3.1.4024) • CU2508 Port multiplier support (from Twin CAT 3.1.4024) 8 Version: 1.5.2 TE1111

## Page 9

Installation/ Licensing 3 Installation/ Licensing The TE1111 | Twin CAT Ether CAT Simulation function is already installed with the Twin CAT 3 installation and is included as a release version since Twin CAT version 3.1 Build 4018.0. It therefore only needs to be licensed. Please refer to chapter Ordering and activating Twin CAT 3 standard licenses. The TE1111 function has an instance-based license, i.e. it is licensed per instantiated Ether CAT Simulation Device. Required licenses: TE1111 Ether CAT Simulation Although this license must be activated on the target system, it is an engineering license. For test purposes, the Ether CAT Simulation can also be used in demo mode without a license. A fully functional 7-day trial license is not available for this product. Restrictions in the demo version If the Ether CAT Simulation is used in demo mode, all simulated I/Os are released after 30 min. TE1111 Version: 1.5.2 9

## Page 10

Basic principles 4 Basic principles The TE1111 Twin CAT Ether CAT Simulation function simulates an Ether CAT segment. An already created I/O configuration of the real plant is exported and can be imported into a second system as an ‘Ether CAT Simulation’ device. A mirrored process image is thus available on this system that can be linked with corresponding Twin CAT modules (e.g. written in the IEC 61131-3 languages or generated from Matlab®/ Simulink®). The desired behavior of the machine must be implemented with sufficient accuracy in these modules. If the Twin CAT real-time is now started on both systems, one has an HIL simulation without having to adapt the original project in order to achieve this. Since the project for the control system to be tested should not be changed, the Ether CAT Simula- tion Device operates unsynchronized. This means that the task that drives the Simulation Device has to run twice as fast on account of Shannon’s theorem (sampling theorem). On standard IPC hardware the shortest cycle time of the simulation device is currently 50µs. HIL simulations of the control system to be tested are thus possible with a cycle time of 100µs. In addition to HIL simulation, Ether CAT simulation can also be used to simulate one or more Ether CAT segments on the same computer, as long as sufficient free network interfaces are available. Depending on the application, various cabling options are available, which are described in the chapter Cabling [} 10]. The Ether CAT simulation is essentially limited to the Ether CAT-relevant aspects of the bus devices. The internal behavior of the bus devices themselves is neglected. For some bus devices, however, it is necessary to simulate at least part of the behavior, as otherwise the Ether CAT master cannot be started correctly (e.g. EL6224). To simulate this, the Ether CAT simulation offers the possibility to activate the Mailbox Auto Response [} 13] option, which automatically answers such requests without having to implement anything. If these parameters are still required, this option can also be deactivated. In this case it is possible to redirect the Co E, So E and Ao E communication into a user PLC module and to react there to these telegrams (see Co E / So E / Ao E [} 14]). Another example in which the pure Ether CAT consideration of the devices is not sufficient are drives. Here it is necessary to implement at least part of the drive state machine so that Twin CAT NC can start correctly. For the drive profiles Co E and So E, these are implemented as function blocks as examples (see ). These function blocks can be instantiated in a PLC module for each drive contained in the configuration and linked to the axes. They are thus switched between the Ether CAT simulation and the process simulation to be implemented. 4.1 Cabling As already described in the chapter Overview [} 8], the Ether CAT simulation was designed to support a virtual commissioning of a plant. The normal cabling for this purpose will look like this: On the left side you can see the control computer, which contains the original control project, which should be used later to control the machine/plant. On the right side you can see a simulation IPC, which contains an Ether CAT simulation device. Both systems are connected by a standard Ether CAT cable. Use of Ether CAT and Ether CAT simulation on the same IPC: 10 Version: 1.5.2 TE1111

## Page 11

Basic principles For testing partial functions of the control program (e.g. Ether CAT diagnosis) at an earlier time (before virtual commissioning), the control computer can also be used to simulate the Ether CAT, as long as the control computer has sufficient free network interfaces. Just like every Ether CAT master, every Ether CAT simulation device also requires its own network interface. Using a CX as controller If a CX is used as controller that is to be coupled with a simulation IPC, there may still be Ether CAT devices available depending on the cabling, which must not be taken into account. The following figure shows, for example, the intelligent power supply unit of the CX and an EK1110 Ether CAT extension. Here in the Settings tab [} 24] a manual device correction can be set, i.e. devices that should not be considered. If this setting is not set, this could result in the Ether CAT master not starting up or the working counter not being calculated correctly. Use of the port multiplier on the original project page: If a CU2508 port multiplier is used in the real-time configuration of the control computer, the outputs of the port multiplier can be connected to normal network ports on a simulation computer. For these network ports, a corresponding number of Ether CAT simulation devices must be created on the simulation computer. TE1111 Version: 1.5.2 11

## Page 12

Basic principles NOTE Use of the port multiplier on the Ether CAT simulation side not supported The use of a CU2508 port multiplier on the Ether CAT simulation side is not supported. If a CU2508 is used on the slave side, it is not contained in the Twin CAT project that exports the configuration file. This CU2508 also only receives the Ether CAT frame after the Ether CAT simulation device. It is thus “invisible” to the Ether CAT simulation. Consequently, neither the Device State nor the Slave Count on the Ether CAT master side display correct values. An Ether CAT diagnosis programmed in the original project would thus display incorrect results. Use of the port multiplier on the Ether CAT simulation side: The use of a CU2508 port multiplier on the Ether CAT simulation side is not supported. If a CU2508 is used on the slave side, it is not contained in the Twin CAT project that exports the configuration file. This CU2508 also only receives the Ether CAT frame after the Ether CAT simulation device. It is thus “invisible” to the Ether CAT simulation. Consequently, neither the Device State nor the Slave Count on the Ether CAT master side display correct values. An Ether CAT diagnosis programmed in the original project would thus display incorrect results. Operation of the Ether CAT simulation in mixed mode If a machine/plant is to be put into operation step by step or only parts of the machine/plant are to be simulated, cabling can be carried out as shown in the following figure. For this it is necessary that the simulation IPC has 2 free network interfaces. The first network interface is used as an Ether CAT simulation device and is connected with the Ether CAT cable to the control IPC. The second network interface is used as Ether CAT master and connected to the real existing bus devices (see also Mixed operation of real and virtual slaves [} 23]). 12 Version: 1.5.2 TE1111

## Page 13

Basic principles 4.2 Mailbox Auto Response For some terminals there are startup commands on the master side, which have to be sent to the terminal during each Ether CAT startup (typically from Pre OP after Save OP). Example EL6224 (IO-Link): These startup commands must be answered by the Ether CAT simulator, to ensure that the Ether CAT master starts up correctly. The Ether CAT simulation device behaves accordingly, i.e. startup parameters are answered automatically between Pre Op and Safe Op, without the need for intervention in the application. In cases where these parameter are required anyhow, the option “Auto Respond Mailbox” can be disabled (see figure below). If this option is disabled, the queries have to be processed in the application program as required, to ensure that the master starts up correctly. TE1111 Version: 1.5.2 13

## Page 14

Basic principles 4.3 Co E / So E / Ao E Using the Ether CAT simulation it is possible to route the protocols Co E (Can over Ether CAT), So E (Sercos over Ether CAT) and Ao E (ADS over Ether CAT) further (e.g. to the PLC). In this way data can be read or written from the PLC via these protocols. Routing of Co E and So E to a PLC The following two steps are required: 1. The Ether CAT simulation device must be notified of the Net Id and the port to which the data are to be relayed. This is done via an ADS-Write to the Net ID of the Simulation Device, Port Nr.: 0x FFFF, Index Group: 0x FF01, Index Offset:1 Example: Registering the mailbox recipient //AMSNet ID of Simulation Device net Id Simu := '5.35.2.224.2.1'; //AMSNet ID of PLC Project on Sim. Dev. arr Net Id[0]:= 5; arr Net Id[1]:= 35; arr Net Id[2]:= 2; arr Net Id[3]:= 224; arr Net Id[4]:= 1; //system ID 1.1 arr Net Id[5]:= 1; arr Net Id[6]:= 16#53; //Port of PLC runtime (1) arr Net Id[7]:= 16#03; //Port of PLC runtime (2) (Port 851 = 16#353) // sent registration to Simulation driver fb Ads Write(WRITE:= FALSE); fb Ads Write(NETID:= net Id Simu, PORT:= 16#FFFF, IDXGRP:= 16#FF01, IDXOFFS:= 1, SRCADDR:= ADR(arr Net Id) , LEN:= 8, WRITE:= TRUE); 14 Version: 1.5.2 TE1111

## Page 15

Basic principles 2. Receiving and responding to the ADS indications. The mailbox service is stored in the Index Group, the Port ID identifies the sending or receiving device, and the data to be accessed is identified through index and subindex. Example: Intercepting and answering indications: //capture all write requests fb Ads Write Ind(); IF fb Ads Write Ind. VALID = TRUE THEN //true if a write command has been sent IF fb Ads Write Ind. IDXGRP = 16#8000F302 THEN //F302 = Co E request, F420 = So E request //fill in your custom Co E Object Dictionary // example reaction IF fb Ads Write Ind. IDXOFFS = 16#80000000 THEN (*error*) fb Ads Write Res( NETID:= fb Ads Write Ind. NETID, PORT:= fb Ads Write Ind. PORT, INVOKEID:= fb Ads Write Ind. INVOKEID, RESULT:= 0, RESPOND:= TRUE); fb Ads Write Res(RESPOND:= FALSE); ELSE fb Ads Write Res( NETID:= fb Ads Write Ind. NETID, PORT:= fb Ads Write Ind. PORT, INVOKEID:= fb Ads Write Ind. INVOKEID, RESULT:= 0, RESPOND:= TRUE); fb Ads Write Res(RESPOND:= FALSE); END_IF END_IF fb Ads Write Ind(CLEAR:= TRUE); fb Ads Write Ind(CLEAR:= FALSE); END_IF //capture all read requests fb Ads Read Ind(); IF fb Ads Read Ind. VALID = TRUE THEN IF fb Ads Read Ind. IDXGRP = 16#8000F302 THEN (*Co E*) // fill in your Co E Object Dictionary // example reaction IF fb Ads Read Ind. IDXOFFS = 16#80000000 THEN (*error*) fb Ads Read Res( NETID:= fb Ads Read Ind. NETID, PORT:= fb Ads Read Ind. PORT, INVOKEID:= fb Ads Read Ind. INVOKEID, LEN:= 0, RESULT:= 16#34567890, RESPOND:= TRUE); ELSE IF fb Ads Read Ind. IDXOFFS = 16#60000000 THEN (*short response*) fb Ads Read Res( NETID:= fb Ads Read Ind. NETID, PORT:= fb Ads Read Ind. PORT, INVOKEID:= fb Ads Read Ind. INVOKEID, DATAADDR:= ADR(arr Net Id), LEN:= 2, RESULT:= 0, RESPOND:= TRUE); ELSE fb Ads Read Res( NETID:= fb Ads Read Ind. NETID, PORT:= fb Ads Read Ind. PORT, INVOKEID:= fb Ads Read Ind. INVOKEID, DATAADDR:= ADR(arr Net Id), LEN:= 6, RESULT:= 0, RESPOND:= TRUE); END_IF END_IF fb Ads Read Res(RESPOND:= FALSE); END_IF fb Ads Read Ind(CLEAR:= TRUE); fb Ads Read Ind(CLEAR:= FALSE); END_IF TE1111 Version: 1.5.2 15

## Page 16

Basic principles As shown in the sample, a check takes place to ascertain whether the indication is valid and if yes, whether it was sent by the simulation device. If both conditions are met, it is a relayed mailbox message that requires a corresponding response. The Index Group indicates the mailbox protocol (16#8000F302 for Co E, 16#8000F420 for So E). The sample described above can be downloaded here: https://infosys.beckhoff.com/content/1033/ TE1111_Ether CAT_Simulation/Resources/3268846987/.zip Sending Co E Emergency Error Messages The sending of Co E Emergency error messages is carried out analogously as shown above via ADS Write to the Net Id of the Ether CAT simulation device, Port Nr.: Port number of the terminal that is to send the emergency, Index Group: 0x00FF41, Index Offset:0. Sending So E Notifications The sending of So E Notifications error messages takes place analogously as shown above via ADS Write to the Net Id of the Ether CAT simulation device, Port Nr.: Port number of the terminal that is to send the notification, Index Group: 0x00FF42, Index Offset: results from the type definition TETHERCAT_SOE_ADS_IOFFS: typedef struct TETHERCAT_SOE_ADS_IOFFS { USHORT IDN; union { struct { BYTE Data State : 1; BYTE Name : 1; BYTE Attribute : 1; BYTE Unit : 1; BYTE Min : 1; BYTE Max : 1; BYTE Value : 1; BYTE Default : 1; }; BYTE Elements; }; BYTE Drive No : 3; BYTE Reserved2 : 4; BYTE Command : 1; } ETHERCAT_SOE_ADS_IOFFS Example: 0x00401234 -> For the So E IDN 1234 the value flag is addressed here. Routing of Ao E to a PLC Registration of the mailbox recipient is identical to the description under Co E and So E. The handling of Ao E in the PLC also takes place in a similar structure, although several queries are involved, due to the functionality of Ao E. A sample is shown below, which can be downloaded here: https://infosys.beckhoff.com/ content/1033/TE1111_Ether CAT_Simulation/Resources/3268845323/.zip fb Ads Read Write Ind(); IF fb Ads Read Write Ind. VALID = TRUE THEN MEMCPY(ADR(arr Tmp), fb Ads Read Write Ind. DATAADDR, fb Ads Read Write Ind. WRTLENGTH); //copy of data in temp variable //evaluate destination of Ae E command (e.g. terminal)-first 6 byte in arr Tmp FOR Idx := 0 TO 5 DO arr Dest[Idx] := arr Tmp[Idx]; END_FOR IF smy Dest Id = F_Create Ams Net Id(arr Dest) THEN //evaluate port (different physical ports or different services of terminal may be possible) IF fb Ads Read Write Ind. PORT = 16#1000 THEN //Io-Link Port 1 // evaluate command type - byte 16 : write = 3, read = 2 IF arr Tmp[16] = 3 THEN // write command //evaluate index group and index offset as shown in Co E and So E //index group: evaluate service (e.g. object register of Io-Link Terminal) IF fb Ads Read Write Ind. IDXGRP = 16#8000F302 THEN IF fb Ads Read Write Ind. IDXOFFS = 16#80000000 THEN //adressing of service MEMCPY(ADR(arr Tmp), fb Ads Read Write Ind. DATAADDR + 8, 8); //change destination net ID and source net ID MEMCPY(ADR(arr Tmp) + 8, fb Ads Read Write Ind. DATAADDR, 8); arr Tmp[18].0:= 1; (*set Respond Bit*) arr Tmp[20]:= 4; (*Length*) 16 Version: 1.5.2 TE1111

## Page 17

Basic principles arr Tmp[21]:= 0; arr Tmp[22]:= 0; arr Tmp[23]:= 0; arr Tmp[32]:= 0; (*Response Code*) arr Tmp[33]:= 0; arr Tmp[34]:= 0; arr Tmp[35]:= 0; fb Ads Read Write Res( NETID:= fb Ads Read Write Ind. NETID, PORT:= fb Ads Read Write Ind. PORT, INVOKEID:= fb Ads Read Write Ind. INVOKEID, DATAADDR:= ADR(arr Tmp), LEN:= 36, RESPOND:= TRUE); END_IF END_IF ELSIF arr Tmp[16] = 2 THEN //read command IF fb Ads Read Write Ind. IDXGRP = 16#8000F302 THEN IF fb Ads Read Write Ind. IDXOFFS = 16#80000000 THEN //adressing of service MEMCPY(ADR(arr Tmp), fb Ads Read Write Ind. DATAADDR + 8, 8); //change destination net ID and source net ID MEMCPY(ADR(arr Tmp) + 8, fb Ads Read Write Ind. DATAADDR, 8); arr Tmp[18].0:= 1; (* set Respond Bit*) arr Tmp[20]:= 14; (*Len*) arr Tmp[21]:= 0; arr Tmp[22]:= 0; arr Tmp[23]:= 0; arr Tmp[32]:= 0; (*Response Code*) arr Tmp[33]:= 0; arr Tmp[34]:= 0; arr Tmp[35]:= 0; arr Tmp[36]:= 6; (*Len*) arr Tmp[37]:= 0; arr Tmp[38]:= 0; arr Tmp[39]:= 0; arr Tmp[40]:= arr Net Id[0]; (*Daten*) arr Tmp[41]:= arr Net Id[1]; arr Tmp[42]:= arr Net Id[2]; arr Tmp[43]:= arr Net Id[3]; arr Tmp[44]:= arr Net Id[4]; arr Tmp[45]:= arr Net Id[5]; fb Ads Read Write Res( NETID:= fb Ads Read Write Ind. NETID, PORT:= fb Ads Read Write Ind. PORT, INVOKEID:= fb Ads Read Write Ind. INVOKEID, DATAADDR:= ADR(arr Tmp), LEN:= 46, RESPOND:= TRUE); END_IF; END_IF; END_IF END_IF END_IF; fb Ads Read Write Res( NETID:= fb Ads Read Write Ind. NETID, PORT:= fb Ads Read Write Ind. PORT, INVOKEID:= fb Ads Read Write Ind. INVOKEID, DATAADDR:= ADR(arr Tmp), LEN:= fb Ads Read Write Ind. WRTLENGTH, RESPOND:= TRUE); fb Ads Read Write Res(RESPOND:= FALSE); fb Ads Read Write Ind(CLEAR:= TRUE); fb Ads Read Write Ind(CLEAR:= FALSE); END_IF TE1111 Version: 1.5.2 17

## Page 18

Quickstart 5 Quickstart Creation of a simulation project with the hardware that is to be used in the control project. 1. To export the hardware configuration of the control project click in the Solution Explorer on the Ether CAT Master Device, then on the tab Ether CAT and finally on the button Export Configuration File... . 2. Then create the simulation project on the simulation IPC 3. click on Add New Item in order to create an Ether CAT simulation device. 4. Open the context menu of the Ether CAT simulation device and click on Import ENI file in order to import the Ether CAT configuration of the Ether CAT master. ð The simulation project is created and filled with the hardware configuration of the control project. 18 Version: 1.5.2 TE1111

## Page 19

Quickstart What else needs to be done? • Creation or instancing of the “simulation” Twin CAT modules • Creation of a task that drives the simulation modules (with half the cycle time on account of the sampling theorem) • Linking of the variables of the process image of the simulation models with those of the mirrored process image of the Ether CAT simulation device TE1111 Version: 1.5.2 19

## Page 20

Use of CU2508 port multipliers 6 Use of CU2508 port multipliers Twin CAT versions < Twin CAT 3.1.4024 The CU2508 may only be used on the Ether CAT Master side (see also Cabling [} 11]). If this is the case, the option Using CU2508 must be activated in the Settings tab. Twin CAT versions > Twin CAT 3.1.4024 The CU2508 may only be used on the Ether CAT Master side (see also Cabling [} 11]). The Ether CAT simulation device automatically detects that a CU2508 was used on the master side. The option “using CU2508” is therefore no longer necessary NOTE Incorrect values in the Ether CAT diagnosis If a CU2508 is used on the slave side, it is not contained in the Twin CAT project that exports the configura- tion file. In addition, this CU2508 only receives the Ether CAT frame after the Ether CAT simulation device. It is thus “invisible” to the Ether CAT simulation device. Consequently, neither the Device State nor the Slave Count on the Ether CAT master side display correct values. An Ether CAT diagnosis programmed in the original project thus displays incorrect results. 20 Version: 1.5.2 TE1111

## Page 21

Fault simulation 7 Fault simulation The following errors can be simulated using the Ether CAT simulation device: • Lost Frames • Link Lost • Working Counter Error Simulation of lost frames: 1. Change to the Fault Simulation tab on the Ether CAT Simulation Device 2. In the count of Frames input field, set the number of frames to be lost (if this is not limited, check infinitely instead). 3. Press the Start button ð The simulation of lost frames starts 4. To stop the simulation press the Stop button Simulation of Link Losts: 5. Change to the Fault Simulation tab on the Ether CAT Simulation Device 6. In the count of Frames input field, set the number of frames for which a link-lost error should be reported (if this is not limited, check infinitely instead). 7. In the Slave selection box, set the Ether CAT device for which the Lost Error link is to be reported 8. Press the Start button ð The simulation of the link-lost error starts 9. To stop the simulation press the Stop button Simulation of working counter errors: 10. Change to the Fault Simulation tab on the Ether CAT Simulation Device 11. In the count of Frames input field, set the number of frames for which a working counter error should be reported (if this is not limited, check infinitely instead). 12. In the Logical Address selection box, select the logical address that is to add an incorrect value to the working counter. 13. In the WC Value field, enter the new (absolute) value to be assigned to the working counter. TE1111 Version: 1.5.2 21

## Page 22

Fault simulation 14. Press the Start button ð The working counter fault simulation starts 15. To stop the simulation press the Stop button See also the chapter Fault Simulation tab [} 25] 22 Version: 1.5.2 TE1111

## Page 23

Mixed operation of real and virtual slaves 8 Mixed operation of real and virtual slaves The Ether CAT simulation enables mixing of real and virtual slaves. This can be used, for example, to gradually put a machine/plant into operation. The following figure illustrates this schematically. For mixed operation, 2 free network interfaces at the simulation IPC are required. The first interface serves as an Ether CAT simulation device and is connected to the control computer via the Ether CAT cable. This is set in the Adapter tab of the Ether CAT simulation device (see also Adapter). For the connection with the real existing slaves the second adapter on the Ether CAT simulation device is used (tab 2nd Adapter). This is selected in the same way as the first adapter. The slaves that actually exist must be deactivated in the imported project of the Ether CAT simulation device and in exactly the same order on the Ether CAT master of the 2nd. adapter must be connected. The figure above is intended to illustrate this. TE1111 Version: 1.5.2 23

## Page 24

Reference, user interface 9 Reference, user interface The following chapter explains the user interface of the Ether CAT Simulation Device. The General and Adapter/ 2nd Adapter tabs are the same as for a standard Ether CAT master. For this reason, we would like to refer to this at this point (see Adapter). The 2nd adapter of the Ether CAT Simulation Device is used to configure a second used interface if the Ether CAT simulation is to be operated in mixed operation of real and virtual slaves (see Mixed operation of real and virtual slaves [} 23]). 9.1 Settings tab The Settings tab contains the manual Device correction setting. This can be used if Ether CAT devices are connected before the actual Ether CAT simulation. These could be, for example, infrastructure devices (e.g. the CU2508) or intelligent power supply units (with CX). From the Twin CAT version Twin CAT 3.1.4024.0 the CU2508 is automatically detected. For this de- vice NO manual device correction is necessary from this version on. 24 Version: 1.5.2 TE1111

## Page 25

Reference, user interface 9.2 Feature Simulation tab In the Simulation tab, Hot Connect groups can be simulated and logged on or off. The group to be logged on or off can be selected from the dropbox. The selected Hot Connect group is then logged on or off using the Connect or Disconnect buttons. 9.3 Fault Simulation tab The Fault Simulation tab is used to simulate Ether CAT errors. The options provided here can be used to test the robustness of the set Ether CAT configuration or the diagnosis of the machine/plant. The following errors can be simulated: • Lost Frames • Link Lost • Working Counter Error See also the chapter Fault simulation [} 21]. The settings in the Fault Simulation tab are explained below. TE1111 Version: 1.5.2 25

## Page 26

Reference, user interface Setting Meaning Lost Frames Count of Frames Number of Ether CAT frames to be lost infinitely Setting the number of Ether CAT frames to infinity Start Start of Lost Frames Simulation Stop Stopping the Lost Frames Simulation Link Lost Count of Frames Number of Ether CAT frames in which a Link Lost should be reported infinitely Setting the number of Ether CAT frames to infinity. Slave Selection of the Ether CAT slave that should report the Lost Error link Start Start of the Link Lost Simulation Stop Stopping the Link Lost Simulation Working Counter Count of Frames Number of Ether CAT frames in which a wrong working counter is to be reported infinitely Setting the number of Ether CAT frames to infinity. Logical Address Logical address at which the working counter is to be calculated incorrectly New WC Value New (absolute) WC value that is to be assigned Start Start of the Working Counter Simulation Stop Stopping the Working Counter Simulation 26 Version: 1.5.2 TE1111

## Page 27

PLC API 10 PLC API 10.1 ADS commands The options provided in the Feature Simulation tab [} 25] or Fault Simulation tab [} 25] regarding the simulation of Hot Connect groups or Ether CAT errors can also be called via ADS (e.g. from the PLC). ADS Write commands to the Net Id of the Ether CAT simulation device must be called as follows: Hot Connect: Defined index groups: Disconnect Device: 0x0010 Connect Device: 0x0011 Index offsets to be used: The high word must be 0. The low word contains the Identification Value (Hot Connect ID) of the device you want to connect or disconnect. Simulation of lost frames: Index-Group: 0x0100 Index offset: 0x0001 Data: 4 byte counter in which it is specified how many frames are to be omitted. 0x FFFFFFFF means infinite Simulation of link lost errors: Index-Group: 0x0100 Index offset: 0x0002 Data: 4 byte counter in which it is specified how many frames are to be omitted. 0x FFFFFFFF means infinite Simulation of working counter errors: Index-Group: 0x0100 Index offset: 0x0003 Data: a total of 10 bytes: • 4 byte counter in which it is specified how many frames are to be omitted. 0x FFFFFFFF means infinite • 4 byte logical address. This addresses the telegram which is to be manipulated • 2 bytes of new working counter. This value is then entered into the telegram TE1111 Version: 1.5.2 27

## Page 29

More Information: www.beckhoff.com/te1111 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
