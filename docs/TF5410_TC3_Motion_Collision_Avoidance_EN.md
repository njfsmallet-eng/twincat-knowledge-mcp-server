---
title: "TF5410_TC3_Motion_Collision_Avoidance_EN"
product: "TF5410"
category: "Motion_Control"
tags: ["AVOIDANCE", "COLLISION", "MOTION", "NC"]
language: "EN"
document_type: "Manual"
version: "2.7.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TF5410_TC3_Motion_Collision_Avoidance_EN.pdf"
release_date: "2025-08-13"
---
Manual | EN TF5410 Twin CAT 3 | Motion Collision Avoidance 2025-08-13 | Version: 2.7.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 Overview of the new functions................................................................................................................ 9 4 Configuring the CA-Group for Collision Avoidance............................................................................ 10 4.1 Geo Compensation......................................................................................................................... 15 5 Differences between MC2 and MC3....................................................................................................... 19 6 CA Group (TF5410 Twin CAT 3 Collision Avoidance)........................................................................... 20 7 State diagrams........................................................................................................................................ 23 7.1 State diagram valid for V3.1.6......................................................................................................... 23 7.2 State diagram valid for V3.1.10....................................................................................................... 24 8 Background Information......................................................................................................................... 26 8.1 Collision Avoidance......................................................................................................................... 26 8.1.1 Basics of Collision Avoidance.......................................................................................... 26 8.1.2 MC_DEFAULT_GAP_CONTROL_MODE....................................................................... 27 8.1.3 MC_GAP_CONTROL_DIRECTION................................................................................. 29 8.1.4 MC_Gear In Pos Default Dynamics After Sync...................................................................... 30 8.2 Geo Compensation......................................................................................................................... 31 8.3 Track management......................................................................................................................... 31 9 PLC Libraries........................................................................................................................................... 33 9.1 Tc3_Mc Collision Avoidance............................................................................................................. 33 9.1.1 Function Blocks................................................................................................................ 33 9.1.2 Datatypes......................................................................................................................... 46 9.2 Tc3_Mc Compensations.................................................................................................................. 52 9.2.1 Function Blocks................................................................................................................ 53 9.3 Tc3_Mc Coordinated Motion............................................................................................................. 56 9.3.1 Function Blocks................................................................................................................ 58 9.3.2 Datatypes......................................................................................................................... 94 9.4 Tc3_Mc3Definitions....................................................................................................................... 104 9.4.1 Datatypes....................................................................................................................... 104 10 Samples................................................................................................................................................. 113 11 Appendix................................................................................................................................................ 114 11.1 Cyclic Group Interface................................................................................................................... 114 11.1.1 Nc To Plc.......................................................................................................................... 114 11.1.2 Plc To Nc.......................................................................................................................... 115 11.2 MC_LREAL/Special Input Values................................................................................................. 115 11.3 Modulo positioning........................................................................................................................ 116 TF5410 Version: 2.7.0 3
## Page 4

Table of contents 4 Version: 2.7.0 TF5410
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TF5410 Version: 2.7.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 2.7.0 TF5410
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TF5410 Version: 2.7.0 7
## Page 8

Introduction 2 Introduction Twin CAT 3 Motion Collision Avoidance is an optional package for collision avoidance when operating multiple axes with Twin CAT 3 NC PTP in linear and/or translational dependency. The underlying algorithm ensures a minimum distance to the predecessor axis. This means that active collision avoidance can be implemented with Twin CAT 3 Motion Collision Avoidance if several motors share a rail, for example. In addition to active collision avoidance, the TF5410 can also be used to accumulate axes in a controlled manner, for example in linear movements such as the XTS (e Xtended Transport System). The programming of the positioning commands from the PLC is done via the library Tc3_Mc Collision Avoidance [} 33], which is based on the library Tc2_MC2 and has been extended by the "Gap" input. With Twin CAT 3 Motion Collision Avoidance, for example, all axes can be started to the same target position. The algorithm then ensures that only the first axis moves to the target position. The remaining axes automatically maintain their minimum distance and line up. In this way, dynamic buffers can be created to accumulate products without further programming. The administrative function blocks are contained in the library Tc3_Mc Coordinated Motion [} 56]. In addition, TF5410 contains a geo-compensation for the XTS, with which the reference point of the path dynamics can be shifted from the XTS motor path to the center of mass of the tool/product on the XTS mover. In curve segments, the two path dynamics differ, so that unexpected forces can act without geo- compensation. The library Tc3_Mc Compensations [} 52] is available in the PLC for this purpose. Installation The TF5410 Twin CAT 3 Motion Collision Avoidance software package is installed together with the TF5400 software package. Target System Windows 10 platform level 40 or higher Additional licensing requirements TF5410 Twin CAT 3 Motion Collision Avoidance requires the TC1250 license. 8 Version: 2.7.0 TF5410
## Page 9

Overview of the new functions 3 Overview of the new functions As of TF5400 V3.3.19 • New: CA group [} 20] parameter Active Gap Establishing with the new default setting that axes are only braked to avoid/minimize gap violations in the future, but do not actively move apart, as is the default behavior up to and including V3.2. • New: The gap control direction "mc Gap Ctrl Direction Both" can be used in connection with the gap control mode mc Gap Ctrl Mode Fast. • Requires Twin CAT V3.1.4024.40 or higher As of TF5400 V3.2.27: • Optimizations to MC_Gear In Pos CA that prevent SAF cycle offset between master and slave axis. • Optimizations to the gap controller when the axis is already in the target position and only the gap changes. If the adjacent mover is commanded, the new gap takes effect. • Requires an x64 platform As of TF5400 V3.1.10.63: • Requires Twin CAT V3.1.4024.24 or higher As of TF5400 V3.1.10.30: • Behavioral change in modulo positioning. Additional turns are now to be commanded via the new parameter ST_Move Absolute CAOptions. Additional Turns. Please refer to the notes on Modulo positioning [} 116]. As of TF5400 V3.1.10.1: • Track management • Revised state diagram • Requires Twin CAT V3.1.4024.7 or higher As of TF5400 V3.1.6.3: • Geo compensation As of TF5400 V3.1.4.4: • New: As of TF5400 3.1.4.4 MC_MAXIMUM is supported as input value. For more detailed information please refer to the documentation for the respective function block. As of TF5400 V3.1.2.47: • New input MC_GAP_CONTROL_MODE [} 51] at each motion function block. • New flag MC_Gear In Pos CAOptions [} 46]. Override Slave Dynamic Restrictions to improve the behavior when coupled to a master with non-constant velocity (e.g. encoder axis). • New CA group parameter Gap Control Mode Direction defines the direction of gap monitoring. TF5410 Version: 2.7.0 9
## Page 10

Configuring the CA-Group for Collision Avoidance 4 Configuring the CA-Group for Collision Avoidance In principle, the configuration described here applies to all motion objects in the Advanced Motion Pack. 1. Add a new NC/PTP NCI configuration in the Motion section. 2. Add all axes to the NC configuration. 10 Version: 2.7.0 TF5410
## Page 11

Configuring the CA-Group for Collision Avoidance 3. Add the corresponding group to the Objects entry in the NC configuration: For coordinated movement, multi-dimensional movements: CA Group (TF5410 Twin CAT 3 Collision Avoidance) [} 20]. TF5410 Version: 2.7.0 11
## Page 12

Configuring the CA-Group for Collision Avoidance 4. Check the execution task in the group. This must always be set to "NC-Task 1 SAF". 12 Version: 2.7.0 TF5410
## Page 13

Configuring the CA-Group for Collision Avoidance 5. Configure the group parameters according to the desired application. For further explanation of the group parameters, see CA Group (TF5410 Twin CAT 3 Collision Avoidance) [} 20]. 6. To address the group from the PLC, a cyclic interface must be declared and linked to the I/Os of the group (see PLC library Tc3_Mc Coordinated Motion [} 56]). To address and enable the axes, the library Overview must be added to the project. ð A new NC/PTP NCI configuration has been created. VAR st Group Ref : AXES_GROUP_REF; END_VAR TF5410 Version: 2.7.0 13
## Page 14

Configuring the CA-Group for Collision Avoidance 14 Version: 2.7.0 TF5410
## Page 15

Configuring the CA-Group for Collision Avoidance 4.1 Geo Compensation Geometrical Information TF5410 Version: 2.7.0 15
## Page 16

Configuring the CA-Group for Collision Avoidance Geometrical information is required for geo-compensation. This geometrical information is configured in the Twin CAT SYSTEM\Tc COM Objects subtree. Table of an XTS standard object Table of a mover template object The XTS Standard Object describes the geometry of a standard XTS motor path. Objects designated as mover templates each define the geometry of a single mover type, including a shift along the y-shift component. A Mover Template is added to the XTS Standard Object to extend the standard geometrical information with the geometrical information of the mover. A Mover Template can be referred to by all axes that use its configuration. 16 Version: 2.7.0 TF5410
## Page 17

Configuring the CA-Group for Collision Avoidance XTS Standard Object The XTS Standard Object defines a motor path that has the starter kit geometry including two curves of 180 degrees. These curves are connected by two straight sections of equal length. The length of these straight sections can be changed during configuration. Thus, the Rail Length parameter of the XTS Standard Object configures the total length: both curves plus both straights. A zero shift (offset) can be configured in the XTS Standard Object for the position information on the XTS motor path x. Rail length: Total length of the XTS rail. Rail offset: Offset value for adjusting the reference position of the rail. See below and the figure Starter kit geometry. Rail Offset: A zero shift Each XTS system includes a segment that sets the zero position in the x-direction. The geo-compensation uses the starter kit geometry. In the geo-compensation, the segment for determining the zero position has a fixed place. It is the curved element in the upper left corner before the first straight element. To set the zero position elsewhere and to start counting the x-coordinate from another position, a zero shift – the Rail Offset – can be defined. The figure shows the Rail Offset between the two dashed lines. The left line shows where the segment for setting the zero position ends. The dashed line on the right and the mover shown illustrate how a position value is interpreted by a mover. The dashed line divides the mover into two halves. The mover is at the zero position. However, the determination of a Rail Offset itself does not require a mover. Note on the availability of the zero shift Currently, the starter kit geometry is the only geometry available for geo-compensation: Two curves of 180 degrees and two straight sections of equal length that connect these curves. TF5410 Version: 2.7.0 17
## Page 18

Configuring the CA-Group for Collision Avoidance Mover Template Object A Mover Template Object initially adopts the geometrical information of the XTS Standard Object. In addition, it describes a mover path geometry, i.e. the y-shift of a particular mover type. A Mover Template can be reused for different movers that have the same path geometry, i.e. the same tool center path. A Mover Template can be activated and deactivated in run mode. The template for a mover can thus be changed in run mode. y-shift of the TCP: Configurable y-shift for controlling the path dynamics. The y-shift must be positive or equal to zero. For each point of an XTS motor path, it describes a point of a mover path that lies perpendicular to the tangent of the motor path that runs through this point of the motor path. In this direction, with orientation of the geometry of the XTS Standard Object to the outside, this point of the mover path is shifted away from the XTS motor path by the value of the y-shift. This shifted point is also known as the tool center point (TCP). Together, the y-points describe a path that is termed the tool center path. On a straight section, the motor coils form a pattern similar to a zebra crossing. If this straight section lies in the middle of this pattern and divides each motor coil into an upper and a lower half, the y-shift has a value of zero on this straight section (see figure). If the y-shift is zero, the path dynamics are controlled collectively in the vertical center of the motor coils. Note on the availability of the zero shift Currently, the starter kit geometry is the only geometry available for geo-compensation: Two curves of 180 degrees and two straight sections of equal length that connect these curves. 18 Version: 2.7.0 TF5410
## Page 19

Differences between MC2 and MC3 5 Differences between MC2 and MC3 This chapter lists differences between MC2 and MC3 (as introduced in TF5400 Advanced Motion Pack). Axes MC2 MC3 Maximum dynamics The velocity defined in axis There are maximum values for parameterization is interpreted as velocity, acceleration, deceleration physical maximum value. and jerk which limit the values that Acceleration, deceleration and Jerk can be set in FBs. Moreover specified in the axis are default default dynamics can be selected values that only have an effect if no by user at respective FB input. dynamics is specified in FBs. PLC Library MC2 MC3 Default values For dynamics parameters of type The constant MC_Default is LREAL "0" is default value. If "0" is introduced (see MC_LREAL/Special set the default parameters from the Input Values [} 115]). axes are used. "0" is not interpreted as default value but as a normal value which in case of dynamics can be invalid. Timing of FB outputs FB returns values that were valid at FB returns values that are valid at the start of PLC cycle. the moment PLC code is executed. This may lead to timing difference between cyclic interface and FB output. Decoupling A special function block can be The slave axis is decoupled by used (e.g. MC_Gear Out/ sending another motion command MC_Cam Out) with Buffermode mc Aborting. TF5410 Version: 2.7.0 19
## Page 20

CA Group (TF5410 Twin CAT 3 Collision Avoidance) 6 CA Group (TF5410 Twin CAT 3 Collision Avoidance) The CA group links axes to add Collision Avoidance to the PTP functionalities. Dynamic values • Velocity Vel: velocity, • Acceleration Acc: positive acceleration, • Deceleration Dec: braking acceleration, negative acceleration, • Jerk: jerk. Setpoints • An axis traverses set dynamic values. During this motion, the maximum dynamic and values set the limits for the dynamic profile. limits CA Group • A CA group provides parameters to set default values for dynamic values. These default values are used for Standby Gap Control. They are not used as default parameters for Motion commands if no parameter has been specified. Axis • The maximum values for the dynamic limits can be set in the axis parameters. • These maximum values can be determined by the physical properties (inertia, mass, maximum current, motor size, ..) of the axis or a workpiece, for example. Gap Neighborhood • A Gap requires two or more adjacent axes (movers). • A Gap is always located between two directly adjacent movers. Counting direction • The Gap is defined in positive counting direction from the current mover to the mover directly ahead. • This positive counting direction corresponds to the counting direction of the setpoint generation. Successor; • Current mover: directly following mover, successor. predecessor • Mover directly ahead: predecessor. Size • Size of a respective Gaps = (set position predecessor) - (set position successor). Lower • The Gap size is set to a lower limit that must not be undershot. limit The parameter "Default Gap" sets a value for this lower limit for the entire CA group as long as no other gap size is set for a current mover. An individual value for this lower limit of the Gap size can be applied as an input value to each of the motion function blocks: "MC_Move Absolute CA", "MC_Move Relative CA", "MC_Halt CA" or "MC_Gear In Pos CA". Gap Control • "Gap Control Mode" mc Gap Ctrl Mode Fast generally controls closer to this lower Mode Gap size limit than "Gap Control Mode" mc Gap Ctrl Mode Standard. Gap Control • "Gap Control Direction" mc Gap Ctrl Direction Positive:: The successor is the only Direction mover that controls the size of the Gaps enclosed by the predecessor and successor. • "Gap Control Direction" mc Gap Ctrl Direction Both: Both adjacent movers control the size of the Gaps they enclose. 20 Version: 2.7.0 TF5410
## Page 21

CA Group (TF5410 Twin CAT 3 Collision Avoidance) Opening the dialog “Parameter (Init)” Root node of a CA group. Parameters for a CA group. The table column "Value" shows the preset parameter value. The table column "Comment" contains brief parameter descriptions. Parameter Description Geometry Rail Length Length of the rail on which the axes (movers) are mounted. Rail Is Ring Indicates whether the rails form a closed circle. In this case (TRUE), Collision Avoidance is enabled between the first mover in the row and the last mover. TF5410 Version: 2.7.0 21
## Page 22

CA Group (TF5410 Twin CAT 3 Collision Avoidance) Parameter Description Gap Control Default Gap Control Different modes are available for gap control (see Mode "MC_DEFAULT_GAP_CONTROL_MODE [} 27]"). Gap Control Various settings are available for the control direction of the Gaps (see section Direction "MC_GAP_CONTROL_DIRECTION [} 29]“). Active Gap From version 3.3, 'Collision Avoidance' does not trigger any active movement and only Establishing intervenes in the motion profile with a delay. The behavior of version 3.2, in which the 'Collision Avoidance' triggered an active movement to establish the parameterized gap, can be restored by setting the 'Active Gap Establishing' parameter in the CA group to 'True'. From version 3.3, this is set to 'False' by default. Standby Gap If TRUE, Collision Avoidance is always active, even if no motion command was issued Control to the axis. Notice The axes move directly after MC_Group Enable when Standby Gap Control is TRUE. If the gap between two axes (mover) is smaller than the Default Gap (see next parameter), the axes will move to reach the demanded gap. This motion is independent of any motion command. This behavior also applies if the axes are too close to each other after a group reset. Default Gap This gap is used for the Standby Gap Control and if no gap was specified at any CA motion command. Default Velocity This velocity is used for Standby Gap Control, i.e. when no motion command is active (e.g. directly after MC_Group Enable [} 62]). It is not used as a default velocity for any motion command if no velocity was specified. Default Acceleration This acceleration is used for Standby Gap Control, i.e. when no motion command is active (e.g. directly after MC_Group Enable [} 62]). It is not used as a default acceleration for any motion command if no acceleration was specified. Default Deceleration This deceleration is used for Standby Gap Control, i.e. when no motion command is active (e.g. directly after MC_Group Enable [} 62]). It is not used as a default deceleration for any motion command if no deceleration was specified. Default Jerk This jerk is used for Standby Gap Control, i.e. when no motion command is active (e.g. directly after MC_Group Enable [} 62]). It is not used as a default jerk for any motion command if no jerk was specified. Gear In Pos Default Dy Specifies the default dynamics used in MC_Gear In Pos CA After Sync Dynamics. In the namics After Sync default state, the value "Job Dynamics" is set. The parameter is not available for older (hidden!) projects (created with versions < 3.1.10), but is set internally to 'Maximum Slave Dynamics'. After reloading the TMC file, "Job Dynamics" is set as the default value (see MC_Gear In Pos Default Dynamics After Sync [} 30]). ü If an NC configuration has already been added, the MOTION subtree contains an SAF task subtree. ü The SAF task subtree contains the "Objects" subtree. ü The "Objects" subtree can contain a CA group. 1. Double-click the root node of the CA group whose parameters you want to view or set. 2. Select the "Parameter (Init)" tab. ð The dialog “Parameter (Init)” is opened. ð It contains a table with parameters for the selected CA group. ð These parameters are divided into the groups "Geometry", "Gap Control" and "Misc.", if applicable. 22 Version: 2.7.0 TF5410
## Page 23

State diagrams 7 State diagrams 7.1 State diagram valid for V3.1.6 The state diagram describes the state of an axis group. The states described here can be read from the PLC using the function block MC_Group Read Status. Note Description 1 Applicable for all non-administrative (movement) function blocks. 2 In the Group Stopping state all function blocks can be called but they are not executed, with the exception of MC_Group Disable and MC_Ungroup All Axes, which cancel the stop and create the transition to Group Disabled. 3 MC_Group Stop. DONE AND NOT MC_Group Stop. EXECUTE 4 Transition is applicable when the last axis is removed from the group. 5 Transition is applicable while the group is not empty. 6 MC_Group Disable and MC_Ungroup All Axes can be output in all states. They change the state to Group Disabled. If they are output in an error state, the state changes to Group Error Disabled. 7 From any state with Enable Requested TRUE. TF5410 Version: 2.7.0 23
## Page 24

State diagrams 8 If "b Is Control Loop Closed" is TRUE for all axes and the group is not empty. "b Positive Direction"/"b Negative Direction" do not have be enabled. 9 MC_Group Enable returns an error if the group is empty. 10 MC_Group Reset has no effect if the state is different from Group Error Stop. 11 In the error states all administrative function blocks are permitted with the exception of MC_Group Enable. However, in the error states you can only create state transitions, e.g. to Group Error Disabled for MC_Group Disable or MC_Ungroup All Axes and MC_Remove Axis From Group, when the last axis is removed. 12 MC_Group Reset must be called to exit the Group Error Stop state. 7.2 State diagram valid for V3.1.10 The state diagram describes the state of an axis group. The states described here can be read from the PLC using the function block MC_Group Read Status. Note Description 1 Applicable for all non-administrative (movement) function blocks. 24 Version: 2.7.0 TF5410
## Page 25

State diagrams 2 In the Group Stopping state all function blocks can be called but they are not executed, with the exception of MC_Group Disable, which cancels the stop and creates the transition to Group Disabled. 3 MC_Group Stop. DONE AND NOT MC_Group Stop. EXECUTE 4 - 5 - 6 MC_Group Disable can be output in all states and changes the state to Group Disabled. If they are output in an error state, the state changes to Group Error Disabled. 7 From any state with Enable Requested TRUE. 8 If "b Is Control Loop Closed" is TRUE for all axes and the group is not empty. "b Positive Direction"/"b Negative Direction" do not have be enabled. 9 "b Is Control Loop Closed" and the two flags "b Positive Direction"/ "b Negative Direction" must be set to TRUE. 10 - 11 In the error states all administrative function blocks are permitted with the exception of MC_Group Enable. However, in the error states you can only create state transitions, e.g. to Group Error Disabled for MC_Group Disable or MC_Ungroup All Axes and MC_Remove Axis From Group, when the last axis is removed. In the Group Moving state stationary axes may be added to and removed from a CA group. If an attempt is made to add a moving axis to a group or remove it from the group, the command is rejected with an error (the group change with a moving axis is also rejected). MC_Group Reset has no effect if the state is different from Group Error Stop. TF5410 Version: 2.7.0 25
## Page 26

Background Information 8 Background Information 8.1 Collision Avoidance 8.1.1 Basics of Collision Avoidance ü All objects (CA Group and all axes) must be created, parameterized and linked (see "Configuration", "CA Group Parameterization [} 20]"). ü This example uses the default values for all gap control parameters and 10 axes in the group. All axes are mounted on a closed rail (XTS) with a length of 3000 mm. The position of the axes (movers) is arbitrary, the default gap which is parameterized in the group is not observed: 1. All axes must be added to the group (see examples in MC_Add Axis To Group [} 58]). ð The order of the axes for the collision avoidance is determined by their actual position on the rail. ð If the positions of the axes are equal (e.g. for simulation axes), the order in that the axes are added to the group is essential. In this case, the axis that was added last is the first axis in the group. ð The "Ident In Group" has no relevance for the order used for collision avoidance. 2. Enable Group (see MC_Group Enable [} 62]). ð The Group State is now mc Group State Standby (see MC_Group Read Status [} 65] or Cyclic Group Interface [} 114]), the Group Axes Count is 10 (see Cyclic Group Interface [} 114]). ð The position of the axes (movers) has not changed, the gap is still not observed. 3. Issue "MC_Move Absolute CA [} 33]" for all axes (movers) to the same position (2500 mm). ð The first mover that is the mover with the largest absolute position, here mover 1, reaches the target position at 2500 mm. The other movers line up, each keeping the gap to its forerunner. The forerunner of the first mover is the last one (since the group parameter Rail Is Ring is set to TRUE). 26 Version: 2.7.0 TF5410
## Page 27

Background Information 8.1.2 MC_DEFAULT_GAP_CONTROL_MODE The Gap Control Mode [} 20] specifies the behavior of the Collision Avoidance. Following modes are available: TYPE MC_DEFAULT_GAP_CONTROL_MODE : ( mc Gap Ctrl Mode Standard := 16#1, mc Gap Ctrl Mode Fast := 16#2 ) END_TYPE Examples Example mc Gap Ctrl Mode Standard: ü Configuration with four axes (mover) in the CA Group. The Rail Length [} 20] is 3000mm and the rail is closed (e.g. XTS-system). ü The first axis in line (blue) is standing at position 0.0mm, the remaining three axes are lined up behind with a respective gap of 100mm. ü The Gap Control Mode is set to mc Gap Ctrl Mode Standard. 1. MC_Move Absolute CA is issued to all axes to the Position 3000mm, the Gap is 100mm. All Axes have the same dynamics (Velocity, Acceleration, Deceleration, Jerk). ð The axes fan out characteristically during the acceleration phase, such that a collision during the motion command is prevented. The first axis (blue) reaches the target position, the remaining axes line up successively with the configured Default Gap [} 20]. TF5410 Version: 2.7.0 27
## Page 28

Background Information Example mc Gap Ctrl Mode Fast: ü Configuration with four axes (mover) in the CA Group. The Rail Length is 3000mm and the rail is closed (XTS-system). ü The first axis in line (blue) is standing at position 0.0mm. The remaining three axes are lined up behind with a respective gap of 100mm. ü The Gap Control Mode is set to mc Gap Ctrl Mode Fast 1. MC_Move Absolute CA is issued to all axes to the Position 3000mm, the Gap is 100mm. All Axes have the same dynamics (Velocity, Acceleration, Deceleration, Jerk). ð All Axes move at the same time and with the full dynamics. The gap between the axes is kept nearly constant. The first axis reached the target position, the rest lines up behind. 28 Version: 2.7.0 TF5410
## Page 29

Background Information 8.1.3 MC_GAP_CONTROL_DIRECTION Gap Control Direction "mc Gap Ctrl Direction Positive" CA Group • The set Gap Control Direction applies to the entire CA group. [} 20] Successor • The size of the Gaps is regulated in each case. • The successor is the only mover that controls the size of the Gaps enclosed by both adjacent movers. Gap Control • Gap Control Mode "mc Gap Ctrl Mode Standard" or Gap Control Mode Mode "mc Gap Ctrl Mode Fast" can be used to calculate the dynamic values of a directly following mover. • The initialization parameter Default Gap Control Mode sets the same Gap Control Mode as the default algorithm for each successor within a CA group. Individual • You can change Gap Control Mode individually for each mover using any of the motion function blocks - MC_Move Absolute CA, MC_Move Relative CA, MC_Halt CA or MC_Gear In Pos CA. Computing power • Gap Control Mode "mc Gap Ctrl Mode Standard" generally requires less computing power than Gap Control Mode "mc Gap Ctrl Mode Fast". Gap Control Direction "mc Gap Ctrl Direction Both" Motion • Allows more general motion profiles, for example reverse motion. profiles TF5410 Version: 2.7.0 29
## Page 30

Background Information CA Group • The set Gap Control Direction applies to the entire CA group [} 20]. Successor • The size of the Gaps is regulated in each case. and • Both adjacent movers, predecessor and successor, control the size of the Gaps predecessor they enclose. Gap Control • Gap Control Mode [} 27] “mc Gap Ctrl Mode Standard” or from v3.3.19 Gap Control Mode Mode “mc Gap Ctrl Mode Fast” can be used to calculate the dynamic values of a directly following mover. • The initialization parameter Default Gap Control Mode sets the same Gap Control Mode as the default algorithm for each successor within a CA group. Correlating control behavior Neighborhood • The size of a Gaps is regulated between two neighboring movers. • Two Gaps are (directly) adjacent if the mover separating them is both successor and predecessor. Chain • (Directly) adjacent Gaps form a (non-trivial) chain. • Within a chain the control of the respective Gaps is correlated. Gap Control Mode • Gap Control Mode [} 27] influences the correlating control type. • The Gap Control Mode [} 27] "mc Gap Ctrl Mode Standard" allows deviations from the target gap value for a single Gap and for the Gaps of a chain for softer control. 8.1.4 MC_Gear In Pos Default Dynamics After Sync TYPE MC_Gear In Pos Default Dynamics After Sync : ( Maximum Slave Dynamics := 16#0, Job Dynamics := 16#1 ); END_TYPE Defines the default dynamics used for the MC_Gear In Pos CA command after the slave axis has become synchronous for the first time (see ST_Gear In Pos CAOptions [} 46]). Maximum Slave Dynamics: The maximum slave axis dynamics (velocity, acceleration, deceleration) is used as the default value for the After Sync Dynamics. The jerk is not limited. Job Dynamics: Job Dynamics (Gear In Pos CAs velocity, acceleration, deceleration and jerk) is used as the default value for After Sync Dynamics. 30 Version: 2.7.0 TF5410
## Page 31

Background Information 8.2 Geo Compensation ‘y’-axis ‘y’-shift = 200 ‘y’-shift = 100 ‘x’-axis zero point offset along the XTS motor path ‘x’ ‘y’-shift = 0: XTS motor path ‘x’ The illustration shows the starter kit geometry. Geo Compensation: Motivation Geo Compensation defines an additional degree-of-freedom: • A one-dimensional spatial transformation of motion dynamics control. • Positional motion control always refers to the XTS motor path. A y-axis perpendicular to the XTS motor path coordinate is introduced as an additional dimension. Motion dynamics can be controlled for a predefined path located on this y-component of displacement. This path may enable opportunities for enhanced mover motion dynamics. • Motion dynamics refer to velocity, acceleration, deceleration and jerk behavior along a path. Generally, dynamical reference can be kept to the XTS motor path, thus leaving the usage of Geo Compensation as an optional opportunity. Motivation Example: Center of Gravity Within many XTS applications heavy tools or products are mounted on the movers. Altogether, a mover and its load form a vehicle. Generally, the vehicle center of gravity does not travel on the XTS motor path. On straight XTS segments XTS motor path velocity and center of gravity path velocity are identical. On curved XTS segments these path velocities differ. This difference leads to an acceleration or deceleration on the center of gravity path while XTS motor path velocity is kept constant. Thus, unintentional forces are at work on the XTS track, especially when curves are entered or left. To avoid some of these forces or to keep their magnitude low the center of gravity could be driven with a nearly constant velocity. This behavior is an example for what Geo Compensation may intend to achieve: As long as a mover and its load are not changed, the center of gravity path can be described and controlled dynamically by adding a radial shift to the XTS motor path. Because this shift points away perpendicularly from the XTS motor path, this shift is called y-shift. 8.3 Track management With the aid of track management an XTS configuration can be divided into individual, spatially separated XTS parts. These can comprise just one or any number of consecutive motor modules. Individual, adjacent XTS parts can be combined to XTS tracks. The XTS parts and XTS tracks can be configured via the XTS Configurator. In the system manager, the XTS parts and XTS tracks are inserted as Tc COM modules, with a unique Object ID, as child nodes below the XTS Processing Unit (see XTS documentation). TF5410 Version: 2.7.0 31
## Page 32

Background Information For each individual axis a track can be activated via the function block MC_Activate Track using the Object ID of the XTS track. When activating an XTS track, the mover must be on an XTS part that is assigned to the track. Object ID 0 can be used to reactivate the absolute reference system for the individual axis. The current target positions on the tracks and parts can be read out using the function block MC_Read Track Positions. 32 Version: 2.7.0 TF5410
## Page 33

PLC Libraries 9 PLC Libraries 9.1 Tc3_Mc Collision Avoidance Overview Function block Description Motion MC_Move Absolute CA [} 33] Moves a single axis to an absolute position with collision avoidance. MC_Move Relative CA [} 36] Moves a single axis over a relative distance with collision avoidance. MC_Halt CA [} 39] Stops a single axis with collision avoidance without locking it for further motion commands. MC_Gear In Pos CA [} 41] Couples a slave axis with a gearing factor and collision avoidance to a master axis. MC_Read Track Positions [} 44] Returns the current XTS track and XTS part target positions with the corresponding object IDs. MC_Activate Track [} 45] Activates a track as a reference system, which can then be used in various motion function blocks for positioning. Structures and enumerations Name Description ST_Gear In Pos CAOptions [} 46] Options for MC_Gear In Pos CA [} 41]. ST_Move Absolute CAOptions [} 49] Options for MC_Move Absolute CA [} 33]. ST_Move Relative CAOptions [} 50] Options for MC_Move Relative CA [} 36]. ST_Halt CAOptions [} 51] Options for MC_Halt CA [} 39]. MC_GAP_CONTROL_MODE [} 51] Defines the gap control mode at function block level. MC_MASTER_SIGNAL_CORRECTION [} 52] Defines the correction of the master's input signal. 9.1.1 Function Blocks 9.1.1.1 Motion 9.1.1.1.1 MC_Move Absolute CA MC_Move Absolute CA Execute BOOL BOOL Done Continuous Update BOOL BOOL Busy Position MC_LREAL BOOL Active Velocity MC_LREAL BOOL Command Aborted Acceleration MC_LREAL BOOL Error Deceleration MC_LREAL UDINT Error Id Jerk MC_LREAL Gap MC_LREAL Buffer Mode MC_BUFFER_MODE Direction MC_DIRECTION Options ST_Move Absolute CAOptions ↔ Axis Reference To AXIS_REF TF5410 Version: 2.7.0 33
## Page 34

PLC Libraries The function block MC_Move Absolute CA instructs a single axis to move to the absolute position defined in the function block, based on Collision Avoidance. Collision Avoidance has higher priority than the motion command. Therefore, the axis may slow down or wait while the motion command is executed to avoid a collision. The function block does not output the signal Done until the axis has reached its target position. Inputs VAR_INPUT Execute : BOOL; Continuous Update : BOOL; Position : MC_LREAL := MC_INVALID; Velocity : MC_LREAL := MC_INVALID; Acceleration : MC_LREAL := MC_DEFAULT; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; Gap : MC_LREAL := MC_DEFAULT; Buffer Mode : MC_BUFFER_MODE := mc Aborting; Direction : Tc3_Mc3Definitions. MC_DIRECTION; Options : ST_Move Absolute CAOptions; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Continuous Update BOOL In this version, continuous updating is only available for the Gap. Position MC_LREAL Specified absolute target position for the command. From TF5400 V3.1.10.30: If positioning is performed using modulo (Direction != mc Direction Non Modulo), the target position must be in the Interval[0, Modulo Faktor]. Additional turns are commanded via the parameter ST_Move Absolute CAOptions. Additional Turn s. If the target position is within the Tolerance Window, then the Direction = mc Direction Positive and Direction = mc Direction Negative for the position will be ignored without additional turns. Up to TF5400 V3.1.10.14 additional turns are commanded by commanding larger target positions than the Modulo Faktor. Further details in the notes to Modulo positioning [} 116]. Velocity MC_LREAL The velocity value must be greater than 0. It is automatically limited by the axis parameter 'Maximum Velocity'. A velocity must always be specified. Special input values: MC_DEFAULT = invalid, as there is no default velocity MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Velocity' Acceleration MC_LREAL The acceleration value must be greater than or equal to 1 and is limited by the axis parameter 'Maximum Acceleration'. The input is preset with MC_DEFAULT. Special input values: 34 Version: 2.7.0 TF5410
## Page 35

PLC Libraries Name Type Description MC_DEFAULT = corresponds to the value of the axis parameter 'Default Acceleration' MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Acceleration' Deceleration MC_LREAL The deceleration value must be greater than or equal to 1 and is limited by the axis parameter 'Maximum Deceleration'. The input is preset with MC_DEFAULT. Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Deceleration' MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Deceleration' Jerk MC_LREAL The jerk must be ≥100. The input is preset with MC_DEFAULT. Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Jerk' MC_MAXIMUM = invalid Gap MC_LREAL This value determines the minimum gap to the predecessor for Collision Avoidance. If no value is entered, the default value of the group is used. Notice When using geo-compensation, special attention must be paid to the gap. The mover gap for Collision Avoidance always relates positionally and dynamically to the offset path geometry. Since the gap refers to the offset path when using geo-compensation, adjacent movers in the curves can collide if it is set too low. Ensure the gap is large enough. Buffer Mode MC_BUFFER_MODE In this version only mc Aborting and mc Buffered are available (see MC_BUFFER_MODE [} 104]). Direction Tc3_Mc3Definitions. MC_ Defines the direction of the movement (default (available from V3.1.10.1) DIRECTION mc Direction Non Modulo), see MC_DIRECTION [} 108]. Options ST_Move Absolute CAOpti For more information about the available options ons (from V3.1.2.47) see the documentation for ST_Move Absolute CAOptions [} 49]. The axis does not reach the target velocity, acceleration or deceleration The values for velocity, acceleration or deceleration may be automatically limited to the maximum axis velocity, acceleration and deceleration. Check the parameters Maximum Dynamics and Default Dynamics of the axis. It is also possible that the values of Maximum Dynamics are smaller than the Default Dynamics. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF Reference to an axis (see AXIS_REF). TF5410 Version: 2.7.0 35
## Page 36

PLC Libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Done, Command Aborted or Error is set. Active BOOL If Active is TRUE, the function block controls the axis. Command Aborted BOOL This output becomes TRUE if the command was interrupted by another command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack V3.1.1.17 Tc2_MC2 9.1.1.1.2 MC_Move Relative CA MC_Move Absolute CA Execute BOOL BOOL Done Continuous Update BOOL BOOL Busy Position MC_LREAL BOOL Active Velocity MC_LREAL BOOL Command Aborted Acceleration MC_LREAL BOOL Error Deceleration MC_LREAL UDINT Error Id Jerk MC_LREAL Gap MC_LREAL Buffer Mode MC_BUFFER_MODE Direction MC_DIRECTION Options ST_Move Absolute CAOptions ↔ Axis Reference To AXIS_REF The function block MC_Move Relative CA instructs a single axis to move over the relative distance defined in the function block, based on Collision Avoidance. Collision Avoidance has higher priority than the motion command. The axis may slow down or wait while the motion command is executed to avoid a collision. The function block does not output the signal Done until the axis has traveled the specified distance. 36 Version: 2.7.0 TF5410
## Page 37

PLC Libraries Inputs VAR_INPUT Execute : BOOL; Continuous Update : BOOL; Distance : MC_LREAL := MC_INVALID; Velocity : MC_LREAL := MC_INVALID; Acceleration : MC_LREAL := MC_DEFAULT; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; Gap : MC_LREAL := MC_DEFAULT; Buffer Mode : MC_BUFFER_MODE := mc Aborting; Options : ST_Move Relative CAOptions; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Continuous Update BOOL In this version, continuous updating is only available for the Gap. Distance MC_LREAL Specified relative distance for the command. Velocity MC_LREAL The velocity value must be greater than 0. It is automatically limited by the axis parameter 'Maximum Velocity'. A velocity must always be specified. Special input values: MC_DEFAULT = invalid, as there is no default velocity MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Velocity' Acceleration MC_LREAL The acceleration value must be greater than or equal to 1 and is limited by the axis parameter 'Maximum Acceleration'. The input is preset with MC_DEFAULT. Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Acceleration' MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Acceleration' Deceleration MC_LREAL The deceleration value must be greater than or equal to 1 and is limited by the axis parameter 'Maximum Deceleration'. The input is preset with MC_DEFAULT. Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Deceleration' MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Deceleration' Jerk MC_LREAL The jerk must be ≥100. The input is preset with MC_DEFAULT. Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Jerk' MC_MAXIMUM = invalid Gap MC_LREAL This value determines the minimum gap to the predecessor for Collision Avoidance. If no value is entered, the default value of the group is used. TF5410 Version: 2.7.0 37
## Page 38

PLC Libraries Name Type Description Notice When using geo-compensation, special attention must be paid to the gap. The mover gap for Collision Avoidance always relates positionally and dynamically to the offset path geometry. Since the gap refers to the offset path when using geo-compensation, adjacent movers in the curves can collide if it is set too low. Ensure the gap is large enough. Buffer Mode MC_BUFFER_MOD In this version only mc Aborting and mc Buffered are E available (see MC_BUFFER_MODE [} 104]). Options ST_Move Relative C For more information about the available options (from AOptions V3.1.2.47) see the documentation for ST_Move Relative CAOptions [} 50]. The axis does not reach the target velocity, acceleration or deceleration The values for velocity, acceleration or deceleration may be automatically limited to the maximum axis velocity, acceleration and deceleration. Check the parameters Maximum Dynamics and Default Dynamics of the axis. It is also possible that the values of Maximum Dynamics are smaller than the Default Dynamics. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF Reference to an axis (see AXIS_REF). Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Done, Command Aborted or Error is set. Active BOOL If Active is TRUE, the function block controls the axis. Command Aborted BOOL This output becomes TRUE if the command was interrupted by another command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). 38 Version: 2.7.0 TF5410
## Page 39

PLC Libraries Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack V3.1.1.17 Tc2_MC2 9.1.1.1.3 MC_Halt CA MC_Halt CA Execute BOOL BOOL Done Deceleration MC_LREAL BOOL Busy Jerk MC_LREAL BOOL Active Gap MC_LREAL BOOL Command Aborted Options ST_Halt CAOptions BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error Id The function block MC_Halt CA commands a single axis to stop with Collision Avoidance. Inputs VAR_INPUT Execute : BOOL; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; Gap : MC_LREAL := MC_DEFAULT; Options : ST_Halt CAOptions; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Deceleration MC_LREAL The deceleration value must be greater than or equal to 1 and is limited by the axis parameter 'Maximum Deceleration'. The input is preset with MC_DEFAULT. Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Deceleration' MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Deceleration' Jerk MC_LREAL The jerk must be ≥100. The input is preset with MC_DEFAULT. Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Jerk' MC_MAXIMUM = invalid Gap MC_LREAL This value determines the minimum gap to the predecessor for Collision Avoidance. If no value is entered, the default value of the group is used. When using geo-compensation, special attention must be paid to the gap. Since the gap refers to the offset path when using geo-compensation, adjacent movers in the curves can collide if it is set too low. Options ST_Halt CA For more information about the available options (from V3.1.2.47) see the Options documentation for ST_Halt CAOptions [} 51]. TF5410 Version: 2.7.0 39
## Page 40

PLC Libraries The axis does not stop fast enough The given deceleration could be automatically limited to the maximum axis deceleration. Check the parameters Maximum Dynamics and Default Dynamics of the axis. It is also possible that the values of Maximum Dynamics are below the Default Dynamics. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF Reference to an axis (see AXIS_REF). Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs, Done, Command Aborted or Error is set. Active BOOL If Active is TRUE, the function block controls the axis. Command Abor BOOL This output becomes TRUE if the command was interrupted by another ted command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack V3.1.1.17 Tc2_MC2 40 Version: 2.7.0 TF5410
## Page 41

PLC Libraries 9.1.1.1.4 MC_Gear In Pos CA MC_Gear In Pos CA Execute BOOL BOOL Start Sync Continuous Update BOOL BOOL In Sync Ratio Numerator MC_LREAL BOOL Busy Ratio Denumerator UINT BOOL Active Master Sync Position MC_LREAL BOOL Command Aborted Slave Sync Position MC_LREAL BOOL Error Sync Strategy MC_SYNC_STRATEGY UDINT Error Id Sync Mode MC_SYNC_MODE Master Start Distance MC_LREAL Velocity MC_LREAL Acceleration MC_LREAL Deceleration MC_LREAL Jerk MC_LREAL Gap MC_LREAL Buffer Mode MC_BUFFER_MODE Options ST_Gear In Pos CAOptions ↔ Master Reference To AXIS_REF ↔ Slave Reference To AXIS_REF The function block MC_Gear In Pos CA couples a slave axis to a master axis. The set values always form the source for the master values. Collision Avoidance has higher priority than axis coupling. The slave axis can be decoupled by sending a motion command using the buffer mode Buffer Mode mc Aborting. Optimizations regarding MC_Gear In Pos CA as of TF5400 v3.2.27 • Optimizations to MC_Gear In Pos CA that prevent SAF cycle offset between master and slave axis. • Optimizations to the gap controller when the axis is already in the target position and only the gap changes. If the adjacent mover is commanded, the new gap takes effect. Inputs VAR_INPUT Execute : BOOL; Continuous Update : BOOL; Ratio Numerator : MC_LREAL := 1; Ratio Denumerator : UINT := 1; Master Sync Position : MC_LREAL := MC_INVALID; Slave Sync Position : MC_LREAL := MC_INVALID; Sync Strategy : MC_SYNC_STRATEGY := mc Sync Strategy Late; Sync Mode : MC_SYNC_MODE; Master Start Distance : MC_LREAL := MC_IGNORE; Velocity : MC_LREAL := MC_INVALID; Acceleration : MC_LREAL := MC_DEFAULT; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; Gap : MC_LREAL := MC_DEFAULT; Buffer Mode : MC_BUFFER_MODE := mc Aborting; Options : ST_Gear In Pos CAOptions; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Continuous Update BOOL In this version, continuous updating is only available for the Gap. Ratio Numerator MC_LREAL A gear ratio can be set by entering integer values at the Ratio Numerator and Ratio Denumerator inputs or by entering a decimal value for the Ratio Numerator and leaving the Ratio Denumerator unchanged (the default value is 1). The gear ratio is entered as a factor, e.g. a value of 0.8 means that the slave velocity is 0.8 * master axis velocity (or 80 % of the master axis velocity). The value for the factor is not limited, it could be greater than 1.0 or negative. TF5410 Version: 2.7.0 41
## Page 42

PLC Libraries Name Type Description Ratio Denumerator UINT Denominator for the gear ratio. Master Sync Position MC_LREAL This input is of type LREAL. Position of the master at which the slave is In Sync and has the correct gear ratio. Slave Sync Position MC_LREAL This input is of type LREAL. Position of the slave at which it is In Sync with the correct gear ratio. Sync Strategy MC_SYNC_STR Defines the strategy that the slave uses for synchronization (see ATEGY MC_SYNC_STRATEGY [} 109]). The default strategy is mc Sync Strategy Late. Sync Mode MC_SYNC_MOD Defines the direction in which the Slave Sync position is to be (available from E interpreted, see MC_SYNC_MODE [} 109]. V3.1.10.1) Master Start Distance MC_LREAL If a positive value is set, the slave axis will not start synchronization until the master position is greater than or equal to the master position (Master Sync Position – Master Start Distance). If a negative value is set, the synchronization will not start until the master position is less than or equal to (Master Sync Position – Master Start Distance). If Master Start Distance is not set, the slave starts synchronization as soon as the function block gives the Active signal. The exact behavior of the slave axis during the synchronization phase depends on the Sync Strategy. Velocity MC_LREAL Maximum velocity of the slave axis during the synchronization phase. The velocity value must be greater than 0. It is automatically limited by the axis parameter 'Maximum Velocity' of the slave axis. A velocity must always be specified. Special input values: MC_DEFAULT = invalid, as there is no default velocity MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Velocity' of the slave axis Acceleration MC_LREAL Maximum acceleration of the slave axis during the synchronization phase. The acceleration value must be greater than or equal to 1 and is limited by the axis parameter 'Maximum Acceleration' of the slave axis. The input is preset with MC_DEFAULT. Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Acceleration' of the slave axis MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Acceleration' of the slave axis Deceleration MC_LREAL Maximum deceleration of the slave axis during the synchronization phase. The deceleration value must be greater than or equal to 1 and is limited by the axis parameter 'Maximum deceleration' of the slave axis. The input is preset with MC_DEFAULT. Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Deceleration' of the slave axis MC_MAXIMUM = corresponds to the value of the axis parameter 'Maximum Deceleration' of the slave axis Jerk MC_LREAL Maximum jerk of the axis during the synchronization phase. The jerk must be ≥100. The input is preset with MC_DEFAULT. 42 Version: 2.7.0 TF5410
## Page 43

PLC Libraries Name Type Description Special input values: MC_DEFAULT = corresponds to the value of the axis parameter 'Default Jerk' of the slave axis MC_MAXIMUM = invalid Gap MC_LREAL This value determines the minimum gap to the predecessor for Collision Avoidance. If no value is entered, the default value of the group is used. Notice When using geo-compensation, special attention must be paid to the gap. The mover gap for Collision Avoidance always relates positionally and dynamically to the offset path geometry. Since the gap refers to the offset path when using geo-compensation, adjacent movers in the curves can collide if it is set too low. Ensure the gap is large enough. Buffer Mode MC_BUFFER_M In this version only mc Aborting and mc Buffered are available ODE (see MC_BUFFER_MODE [} 104]). Options ST_Gear In Pos C The Options can be used to influence the synchronization profile AOptions of the slave, in addition to the Sync Strategy (from V3.1.2.47) (see ST_Gear In Pos CAOptions [} 46]). The axis does not reach the target velocity, acceleration or deceleration The values for velocity, acceleration or deceleration may be automatically limited to the maximum axis velocity, acceleration and deceleration. Check the parameters Maximum Dynamics and Default Dynamics of the axis. It is also possible that the values of Maximum Dynamics are smaller than the Default Dynamics. Inputs/outputs VAR_IN_OUT Master : AXIS_REF; Slave : AXIS_REF; END_VAR Name Type Description Master AXIS_REF Reference to an axis (see AXIS_REF). Slave AXIS_REF Reference to an axis (see AXIS_REF). Outputs VAR_OUTPUT Start Sync : BOOL; In Sync : BOOL; Busy : BOOL; Active : BOOL; Command Aborted: BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Start Sync BOOL This output is set when the slave actively starts synchronization and reset when the slave is In Sync. In Sync BOOL This output becomes TRUE when the slave is synchronized. If the dynamics of the slave axis is too low to follow the movement of the master axis, the output In Sync could be reset to FALSE, after which the slave axis starts synchronizing again. TF5410 Version: 2.7.0 43
## Page 44

PLC Libraries Name Type Description Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Command Aborted or Error is set. Active BOOL If Active is TRUE, the function block controls the axis. Command Aborte BOOL This output becomes TRUE if the command was interrupted by another d command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack V3.1.1.17 Tc2_MC2 9.1.1.1.5 MC_Read Track Positions MC_Read Track Positions Enable BOOL BOOL Valid ↔ Axis Reference To AXIS_REF BOOL Busy MC_LREAL Track Position OTCID Track Id MC_LREAL Part Position OTCID Part Id BOOL Error UDINT Error Id The function block MC_Read Track Positions returns the current XTS track and XTS part target positions with the corresponding object IDs. The axis must be in a CA group for the function block to supply valid values. If no track is activated for the axis, the current absolute setpoints are returned with Track Id/Part Id = 0. Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL The command is executed as long as Enable is active. Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF Reference to an axis (see AXIS_REF). 44 Version: 2.7.0 TF5410
## Page 45

PLC Libraries Outputs VAR_OUTPUT Valid : BOOL; Busy : BOOL; Track Position : LREAL; Track Id : OTCID; Part Position : LREAL; Part Id : OTCID; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Valid BOOL This output indicates that other output values are valid for this function block. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Done, Command Aborted or Error is set. Track Position LREAL Position in the active track reference system. Track Id OTCID Object ID of the active track reference system. Part Position LREAL Position on the current XTS part. Part Id OTCID Object ID of the current XTS part. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 9.1.1.1.6 MC_Activate Track MC_Activate Track Execute BOOL BOOL Done Track Id OTCID BOOL Busy ↔ Axis Reference To AXIS_REF BOOL Error UDINT Error Id The function block MC_Activate Track activates a track as a reference system, which can then be used in various motion function blocks for positioning. The XTS track object must be created under the XTS Processing Unit and is then selected via the object Id. The XTS tracks are configured via the XTS Configurator (see XTS documentation for more information). Object ID 0 can be used to reactivate the absolute reference system. Inputs VAR_INPUT Execute : BOOL; Track Id : OTCID; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Track Id OTCID Object ID of the active track reference system. TF5410 Version: 2.7.0 45
## Page 46

PLC Libraries Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_RE Reference to an axis (see AXIS_REF). F Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Done, Command Aborted or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 9.1.2 Datatypes 9.1.2.1 ST_Gear In Pos CAOptions The options can be set to specialize the synchronization profile of the slave. TYPE ST_Gear In Pos CAOptions : STRUCT After Sync Velocity : MC_LREAL := MC_DEFAULT; After Sync Acceleration : MC_LREAL := MC_DEFAULT; After Sync Deceleration : MC_LREAL := MC_DEFAULT; After Sync Jerk : MC_LREAL := MC_DEFAULT; Master Velocity Undershoot Allowed : BOOL := TRUE; Master Velocity Overshoot Allowed : BOOL := TRUE; Minimal Slave Position : MC_LREAL := MC_IGNORE; Direction Reversal Allowed : BOOL := TRUE; Override Slave Dynamic Restrictions : BOOL := FALSE; Gap Control Mode : MC_GAP_CONTROL_MODE := mc Gap Control Mode Group Default; Slave Sync Position Reference System : OTCID := 0; Dynamics Reference System : OTCID := 0; Master Signal Correction : MC_MASTER_SIGNAL_CORRECTION := mc Master Signal Correction Auto; END_STRUCT END_TYPE 46 Version: 2.7.0 TF5410
## Page 47

PLC Libraries Name Type Description After Sync Velocity MC_LREAL Maximum velocity of the slave axis after it has synchronized for the first time. The velocity value must be greater than 0. It is (From TF5400 V3.1.10.1) automatically limited by the axis parameter 'Maximum Velocity' of the slave axis. The input is preset with MC_DEFAULT. The velocity is set according to the CA-Group parameter 'Gear In Pos After Sync Dynamics'. After Sync Acceleration MC_LREAL Maximum acceleration of the slave axis after it has synchronized for the first time. The acceleration value must be (From TF5400 V3.1.10.1) greater than or equal to 1 and is limited by the axis parameter 'Maximum Acceleration' of the slave axis. The input is preset with MC_DEFAULT. The acceleration is set according to the CA-Group parameter 'Gear In Pos After Sync Dynamics'. After Sync Deceleration MC_LREAL Maximum deceleration of the slave axis after it has synchronized for the first time. The deceleration value must be (From TF5400 V3.1.10.1) greater than or equal to 1 and is limited by the axis parameter 'Maximum deceleration' of the slave axis. The input is preset with MC_DEFAULT. The deceleration is set according to the CA-Group parameter 'Gear In Pos After Sync Dynamics'. After Sync Jerk MC_LREAL Maximum jerk of the slave axis after it has synchronized for the first time. The jerk must be ≥100. The input is preset with (From TF5400 V3.1.10.1) MC_DEFAULT. The deceleration is set according to the CA- Group parameter 'Gear In Pos After Sync Dynamics'. Master Velocity Undershoot All BOOL This option only affects the synchronization profile and has no owed effect once the slave is In Sync. TRUE: No restrictions for the profile FALSE: The slave velocity during the synchronization phase is always greater than or equal to the master velocity. If the slave velocity is lower than the master velocity at the time the command is issued, the slave accelerates with its synchronization dynamics to reach the master velocity as quickly as possible. Master Velocity Undershoot Allowed and Master Velocity Overshoot Allowed cannot both be set to FALSE. Master Velocity Overshoot Allo BOOL This option only affects the synchronization profile and has no wed effect once the slave is In Sync. TRUE: No restrictions for the profile. FALSE: The slave velocity during the synchronization phase is always less than or equal to the master velocity. If the slave velocity is greater than the master velocity at the time the command is issued, the slave decelerates with its synchronization dynamics in order to reach the master velocity. Master Velocity Undershoot Allowed and Master Velocity Overshoot Allowed cannot both be set to FALSE. Minimal Slave Position MC_LREAL Absolute minimum position of the slave during the synchronization phase. This option only affects the synchronization profile and has no effect once the slave is In Sync. Direction Reversal Allowed BOOL This option only affects the synchronization profile and has no effect once the slave is In Sync. TRUE: No restrictions for the profile. TF5410 Version: 2.7.0 47
## Page 48

PLC Libraries Name Type Description FALSE: The direction is determined by the sign of the slave velocity in the Slave Sync Position (gear ratio * master velocity). The slave is not allowed to move in the opposite direction. Override Slave Dynamic Restri BOOL This option only affects the synchronization profile and has no ctions effect once the slave is In Sync. It only has an effect if the strategies mc Sync Strategy Late or mc Sync Strategy Slow are used. FALSE: The synchronization profile is recalculated each time the master velocity changes. An error may occur if no valid synchronization profile can be generated within the dynamic limits specified in the function block MC_Gear In Pos CA [} 41]. In particular, a noisy master signal can lead to such an error (e.g. encoder axis). Furthermore, a high load may result if the master velocity changes frequently, e.g. if the master accelerates or decelerates, or if the master signal is noisy. TRUE: The synchronization profile is not necessarily recalculated when the velocity of the master changes. Instead, the originally calculated profile is stretched or compressed. This avoids the errors described above (see FALSE). However, this could lead to violation of the dynamic limits specified in the function block MC_Gear In Pos CA [} 41] (the Maximum Axis Dynamic Limits are not violated). This option can be used for synchronization to a noisy master axis (e.g. encoder axis) and can also reduce the computing time. Gap Control Mode MC_GAP_C See the description of the data type MC_GAP_CONTROL_MODE ONTROL_M [} 51] for further information. ODE Slave Sync Position Reference OTCID • This input is of type OTCID and can therefore refer to a System mover template. (From TF5400 V3.1.6.03) • For the position reference of a synchronized slave axis to the XTS motor path, the input Slave Sync Position Reference System can be left open or set to the value zero so that compatibility with earlier versions of this function block is maintained. • For the position reference of a synchronized slave axis to the path defined by a Mover Template Object, set Slave Sync Position Reference System to its object ID. Then the position input for the synchronized slave axis is interpreted according to the offset path. Dynamics Reference System OTCID • This input is of type OTCID and can therefore refer to a mover template. (From TF5400 V3.1.6.03) • For the dynamic reference to the XTS motor path, the input Dynamics Reference System can be left open or set to the value zero so that compatibility with earlier versions of this function block is maintained. • For dynamic reference to the path defined by a Mover Template Object, set Dynamics Reference System to its object ID. Then the dynamics of the motion profile will be constrained to the given path. Master Signal Correction MC_MASTE • See the description of the data type (From TF5400 V3.2.60) R_SIGNAL_ MC_MASTER_SIGNAL_CORRECTION [} 52] for further CORRECTI information. ON 48 Version: 2.7.0 TF5410
## Page 49

PLC Libraries Restricting the synchronization profile could make synchronization impossible for the slave. If synchronization is impossible, MC_Gear In Pos CA [} 41] issues an error. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack V3.1.1.17 Tc2_MC2 9.1.2.2 ST_Move Absolute CAOptions TYPE ST_Move Absolute CAOptions : STRUCT Gap Control Mode : MC_GAP_CONTROL_MODE := mc Gap Control Mode Group Default; Position Reference System : OTCID := 0; Dynamics Reference System : OTCID := 0; Additional Turns : UDINT := 0; END_STRUCT END_TYPE Name Type Description Gap Control Mode MC_GAP_CONTROL_ See the description of the data type MODE MC_GAP_CONTROL_MODE [} 51] for further information. Position Reference Sy OTCID • This input is of type OTCID and can therefore refer to a stem mover template. (as of TF5400 • For the position reference to the XTS motor path, the V3.1.6.03) input Position Reference System can be left open or set to the value zero so that compatibility with earlier versions of this function block is maintained. • For the position reference to the path defined by a Mover Template Object, set Position Reference System to its object ID. Then the position input will be interpreted according to the offset path. Dynamics Reference S OTCID • This input is of type OTCID and can therefore refer to a ystem mover template. (as of TF5400 • For the dynamic reference to the XTS motor path, the V3.1.6.03) input Dynamics Reference System can be left open or set to the value zero so that compatibility with earlier versions of this function block is maintained. • For dynamic reference to the path defined by a Mover Template Object, set Dynamics Reference System to its object ID. Then the dynamics of the motion profile will be constrained to the given path. Additional Turns UDINT • This input is used to command additional full turns. (as of TF5400 • Additional Turns may only be used (take a value > 0) V3.1.10.30) if: ◦ Direction = mc Direction Positive or ◦ Direction = mc Direction Negative . • If positioning is performed using modulo, i.e. if Direction assumes one of the three following values {mc Direction Positive, mc Direction Negative, Shortest Way}, the target position must be located in Interval [0, Modulo Faktor] as of V3.1.10.30. This is a departure from previous behavior. Before the introduction of the parameter Additional Turns, TF5410 Version: 2.7.0 49
## Page 50

PLC Libraries Name Type Description additional turns were commanded by commanding larger target positions than the modulo factor. Example: Modulo Factor = 360, Start Position = 5; 2 full turns are to be commanded and moved to position 10: ◦ Up to V3.1.10.14: Target Position = 730 ◦ From V3.1.10.30: Target Position = 10, Additional Turns = 2 • Further details in the notes to Modulo positioning [} 116]. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack V3.1.1.17 Tc2_MC2 9.1.2.3 ST_Move Relative CAOptions TYPE ST_Move Relative CAOptions : STRUCT Gap Control Mode : MC_GAP_CONTROL_MODE := mc Gap Control Mode Group Default; Position Reference System : OTCID := 0; Dynamics Reference System : OTCID := 0; END_STRUCT END_TYPE Name Type Description Gap Control Mode MC_GAP_CONTROL_ See the description of the data type MODE MC_GAP_CONTROL_MODE [} 51] for further information. Position Reference Sy OTCID • This input is of type OTCID and can therefore refer to a stem mover template. (From TF5400 • For the position reference to the XTS motor path, the V3.1.6.03) input Position Reference System can be left open or set to the value zero so that compatibility with earlier versions of this function block is maintained. • For the position reference to the path defined by a Mover Template Object, set Position Reference System to its object ID. Then the position input will be interpreted according to the offset path. Dynamics Reference S OTCID • This input is of type OTCID and can therefore refer to a ystem mover template. (From TF5400 • For the dynamic reference to the XTS motor path, the V3.1.6.03) input Dynamics Reference System can be left open or set to the value zero so that compatibility with earlier versions of this function block is maintained. • For dynamic reference to the path defined by a Mover Template Object, set Dynamics Reference System to its object ID. Then the dynamics of the motion profile will be constrained to the given path. 50 Version: 2.7.0 TF5410
## Page 51

PLC Libraries Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack V3.1.1.17 Tc2_MC2 9.1.2.4 ST_Halt CAOptions TYPE ST_Halt CAOptions : STRUCT Gap Control Mode : MC_GAP_CONTROL_MODE := mc Gap Control Mode Group Default; Dynamics Reference System : OTCID := 0; END_STRUCT END_TYPE Name Type Description Gap Control Mode MC_GAP_CONTROL_ See the description of the data type MODE MC_GAP_CONTROL_MODE [} 51] for further information. Dynamics Reference S OTCID • This input is of type OTCID and can therefore refer to a ystem mover template. (From TF5400 • For the dynamic reference to the XTS motor path, the V3.1.6.03) input Dynamics Reference System can be left open or set to the value zero so that compatibility with earlier versions of this function block is maintained. • For dynamic reference to the path defined by a Mover Template Object, set Dynamics Reference System to its object ID. Then the dynamics of the motion profile will be constrained to the given path. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack V3.1.1.17 Tc2_MC2 9.1.2.5 MC_GAP_CONTROL_MODE The MC_GAP_CONTROL_MODE data type can be used to specify the Gap Control Mode at the function block level. TYPE MC_GAP_CONTROL_MODE : ( mc Gap Control Mode Group Default := 16#0, mc Gap Control Mode Standard := 16#1, mc Gap Control Mode Fast := 16#2 mc Gap Control Mode None := 16#3 ) UDINT; END_TYPE This data type can only be used at the FB input “Gap Control Mode”, which exists at all Motion function blocks in Tc3_Mc Collision Avoidance [} 33]. Name Type Description mc Gap Control Mode Group Defa UDIN This value indicates that the Gap Control Mode which was specified ult T in the group parameters should be used for this motion command. mc Gap Control Mode Standard UDIN See the description for MC_DEFAULT_GAP_CONTROL_MODE [} 27]. T TF5410 Version: 2.7.0 51
## Page 52

PLC Libraries Name Type Description mc Gap Control Mode Fast UDIN See the description for MC_DEFAULT_GAP_CONTROL_MODE [} 27]. T mc Gap Control Mode None UDIN This value indicates that the Gap Control is not active in the T command. After the command, the Standby Gap Control takes effect again with the mode, which is set in the group and the gap size of the last valid command. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack V3.1.1.17 Tc2_MC2 9.1.2.6 MC_MASTER_SIGNAL_CORRECTION The data type MC_MASTER_SIGNAL_CORRECTION is used in the function block MC_Gear In Pos CA [} 41] via the structure ST_Gear In Pos CAOptions [} 46] to define whether and how the input signal of the master is to be corrected. TYPE MC_MASTER_SIGNAL_CORRECTION : ( mc Master Signal Correction Auto := 0, mc Master Signal Correction None := 1 )INT; END_TYPE Name Type Description mc Master Signal Correction Auto INT Automatic correction of the master signal. mc Master Signal Correction None INT No correction of the master signal. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.40 PC or CX (x64) Tc3_Mc Collision Avoidance, TF5400 Advanced Motion Pack Tc3_Mc Coordinated Motion, Tc2_MC2 V3.2.60 9.2 Tc3_Mc Compensations What do setpoints refer to? Setpoints always refer to the XTS motor path, because it is the motor that physically has to be moved. Consequently, a motor movement leads to a target position on the XTS motor path and thus on the path of the tool center point. Even if the setpoints for the path dynamics are applied to the XTS motor path, they can be calculated for the dynamic control of the path of the tool center point. Accordingly, the y offset depends on the desired application and may be different for different applications. For example, the control of the center of gravity dynamics or the improvement of the performance of a tool mounted on a mover could be intended. In particular, a different tool size may require a different mover template. When the path for the tool center point is selected, setpoints are calculated to control it dynamically. Coordinate system of the XTS motor path The origin of the coordinate system of the mover's motor path is located on the mover's motor path at the offset x value defined in the XTS standard object. 52 Version: 2.7.0 TF5410
## Page 53

PLC Libraries Coordinate system of the Tool Center Point The origin of the Tool Center Point coordinate system is at the Tool Center Point. XTS motor path to Tool Center Point: Understanding the coordinate transformation The coordinate transformation from the motor path of the mover to the Tool Center Point is always perpendicular to the motor path of the mover. Ideally and theoretically, the scalar product of the vector describing the translation of the motor path of the mover to the Tool Center Point and the corresponding vector of the tangent of the motor path of the mover has the value zero. 9.2.1 Function Blocks 9.2.1.1 MC_Register Compensation MC_Register Compensation ↔ Axis Reference To AXIS_REF BOOL Done Execute BOOL BOOL Busy Compensation Type MC_COMPENSATION_TYPE BOOL Error Compensation Id OTCID UDINT Error Id Reference to a mover template: An axis refers to a mover template via the function block MC_Register Compensation. • This function block selects the compensation type. • This function block influences axis behavior. Inputs VAR_INPUT Execute : BOOL; Compensation Type : MC_COMPENSATION_TYPE; Compensation Id : OTCID; END_VAR Name Type Description Execute BOOL This function block activates the selected compensation type when a rising edge is triggered at its Execute input. When activated, the geometry information for geo-compensation is taken into account by the Motion function blocks that refer to Axis. Compensation MC_COMPENSATIO Select mc Type Geo Compensation for geo-compensation (see Type N_TYPE MC_COMPENSATION_TYPE [} 107]). Compensation I OTCID This input Compensation Id is of type OTCID and can therefore d refer to a mover template. The reference to the geometry information required for geo-compensation is made via the object ID Compensation Id, which refers to a mover template. TF5410 Version: 2.7.0 53
## Page 54

PLC Libraries Inputs/outputs VAR_IN_OUT Axis : AXIS_REF; END_VAR Name Type Description Axis AXIS_REF The input Axis is of type AXIS_REF and refers to an axis, e.g. to a mover. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Done or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4022.25 PC or CX (x64) Tc3_Mc Collision Avoidance, TF5400 Advanced Motion Pack Tc3_Mc Coordinated Motion, V3.1.6.03 Tc2_MC2 9.2.1.2 MC_Transform Position MC_Transform Position Execute BOOL BOOL Done Origin Oid OTCID BOOL Busy Destination Oid OTCID BOOL Error Origin Position MC_LREAL UDINT Error Id MC_LREAL Destination Position • This function block calculates a coordinate transformation. • A position specified in the origin coordinate system is returned in the target coordinate system. • An origin mover template object refers to the origin coordinate system. • A destination mover template object refers to the target coordinate system. • Object ID 0, Oid = 0, refers to the absolute coordinate system. • The origin mover template object can refer to the absolute coordinate system, and the destination mover template object can refer to the coordinate system of the Tool Center Point: thus, a calculation of the coordinate transformation from the coordinate system of the Tool Center Point to the absolute coordinate system is to be performed. • The origin mover template object can refer to the coordinate system of the Tool Center Point, and the destination mover template object can refer to the absolute coordinate system: thus, a calculation of the coordinate transformation from the coordinate system of the Tool Center Point to the absolute coordinate system is to be performed. • For information purposes only: without effect on the setpoints. 54 Version: 2.7.0 TF5410
## Page 55

PLC Libraries Inputs VAR_INPUT Execute : BOOL; Origin Oid : OTCID; Destination Oid : OTCID; Origin Position : MC_LREAL; END_VAR Name Type Description Execute BOOL This function block outputs the target position when a rising edge is triggered at input Execute. Origin Oid OTCID This input refers to the origin mover template object as a coordinate system reference. Destination Oid OTCID This input refers to the target mover template object as a coordinate system reference. Origin Position MC_LREAL Position value in the frame of the coordinate system to which the origin mover template object refers. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; Destination Position : MC_LREAL; END_VAR Name Type Description Done BOOL This output becomes TRUE if the command was executed and the execution was successful. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Done or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Destination Posit MC_LREAL Position value within the coordinate system to which the destination mover ion template object refers. Sample VAR fb Absolute To Tcp : MC_Transform Position; fb Tcp To Absolute : MC_Transform Position; input Position Absolute : LREAL; input Position Tcp : LREAL; output Position Tcp : LREAL; output Position Absolute : LREAL; oid Mover Template : OTCID; END_VAR fb Absolute To Tcp( Execute := TRUE, Origin Oid := 0, //absolute Destination Oid := oid Mover Template, Origin Position := input Position Absolute, Destination Position => output Position Tcp ); fb Tcp To Absolute( Execute := TRUE, Origin Oid := oid Mover Template, Destination Oid := 0, //absolute Origin Position := input Position Tcp, Destination Position => output Position Absolute ); TF5410 Version: 2.7.0 55
## Page 56

PLC Libraries Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4022.25 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack Tc2_MC2 V3.1.6.07 9.3 Tc3_Mc Coordinated Motion The Tc3_Mc Coordinated Motion library is used for TF5410 Twin CAT 3 Motion Collision Avoidance and also for TF5420 Twin CAT 3 Motion Pick-and-Place. Overview Function block Description TF5410 TF5420 Twin CAT 3 Mo- Twin CAT 3 Motion Pick-and- tion Collision Place Avoidance MC Group with MC Group Co- Pick-and-Place ordinated Mo- tion Administrative MC_Add Axis To Group Adds an axis group. [} 58] ( up to v3.2) MC_Group Disable [} 61] Disables an axis group. ( up to v3.2) MC_Group Enable [} 62] Enables an axis group. ( up to v3.2) MC_Group Read Error Reads the error ID of a group. [} 63] ( up to v3.2) MC_Group Read Status Reads the group status. [} 65] ( up to v3.2) MC_Group Reset [} 66] Resets a group. ( up to v3.2) MC_Group Set Override Sets the override of a group and returns the [} 68] actual override value. ( up to v3.2) MC_Remove Axis From Grou Removes an axis from a group. p [} 69] ( up to v3.2) MC_Set Coordinate Transfo Activates a reference system. rm [} 71] ( up to v3.2) 56 Version: 2.7.0 TF5410
## Page 57

PLC Libraries Function block Description TF5410 TF5420 Twin CAT 3 Mo- Twin CAT 3 Motion Pick-and- tion Collision Place Avoidance MC Group with MC Group Co- Pick-and-Place ordinated Mo- tion MC_Set Coordinate Transfo Adds a change of reference system to the rm Preparation [} 72] list of movement segments. MC_Track Conveyor Belt Assists in synchronizing velocity to an object [} 73] moving along a straight line through space. ( up to v3.2) MC_Ungroup All Axes Disables a group and removes all axes. [} 76] ( up to v3.2) UDINT_TO_IDENTINGROU Converts an integer value to P [} 77] IDENT_IN_GROUP_REF, so axes without special interpretation can be added to a group. Motion MC_Group Halt [} 78] Stops a group without locking it for further motion commands. MC_Group Stop [} 80] Stops a group and locks it for further motion commands. ( up to v3.2) MC_Move Linear Absolute P Adds an absolute linear movement to a list of reparation [} 82] motion segments. ( up to v3.2) MC_Move Circular Absolute Adds an absolute circular movement to a list of Preparation [} 84] motion segments. ( up to v3.2) MC_Move Path [} 88] Executes a list of motion segments. ( up to v3.2) MC_Blocker Preparation Appends a blocking job to the list of segments in the [} 89] structure Path Data. MC_Release Blocker Resolves a blocking job that is blocking further [} 91] execution of the path. MC_Group Read Blocker Sta Reads the current blocker status. tus [} 92] MC_Dwell Time Preparation Appends a standstill job with a defined time to the [} 93] list of segments in the structure Path Data. TF5410 Version: 2.7.0 57
## Page 58

PLC Libraries Structures and enumerations Function block Description TF5410 TF5420 Twin CAT 3 Mo- Twin CAT 3 Motion Pick-and- tion Collision Place Avoidance MC Group with MC Group Co- Pick-and-Place ordinated Mo- tion IDENT_IN_GROUP_REF Defines how an axis is interpreted in a group. [} 94] ( up to v3.2) MC_CIRC_MODE [} 95] The circle mode defines which definition is used to program a circle. ( up to v3.2) MC_CIRC_PATHCHOICE The data type defines the rotation direction of a [} 99] circle. ( up to v3.2) MC_PATH_DATA_REF Represents the path to be executed at [} 100] MC_Move Path [} 88]. ( up to v3.2) Clear Path [} 101] Resets the path represented by MC_PATH_DATA_REF ( up to v3.2) [} 100]. MC_TRANSITION_MODE Characterizes the way a segment transition is [} 101] executed. ( up to v3.2) MC_COORD_REF [} 103] Object ID of a coordinate system. ( up to v3.2) 9.3.1 Function Blocks 9.3.1.1 Administrative 9.3.1.1.1 MC_Add Axis To Group MC_Add Axis To Group Execute BOOL BOOL Done Ident In Group IDENT_IN_GROUP_REF BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Error ↔ Axis Reference To AXIS_REF UDINT Error Id 58 Version: 2.7.0 TF5410
## Page 59

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Add Axis To Group adds an axis to a group. From V3.1.10.1, stationary axes can be added to and removed from a CA group in the Group Moving group state. If a moving axis is added to a group, the command is rejected with an error message (a change of the group state with a moving axis is also rejected). Only axes in Group Disabled or Group Error Disabled state can be added to a MC group. Inputs VAR_INPUT Execute : BOOL; Ident In Group : IDENT_IN_GROUP_REF; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Ident In Group IDENT_IN_GROUP_R Defines the interpretation of the axis to be added to the group. For EF multi-dimensional motions, this can be the Cartesian interpretation. The global variables [} 94] (e.g. MCS_X) must be used. For Collision Avoidance the function UDINT_TO_IDENTINGROUP [} 77] must be used. Notice The use of integer values for the input Ident In Group is NOT supported and may lead to incompatibility with future releases. If integer values are used, it may no longer be possible to build the project. We recommend using global variables (e.g. MCS_X) or the conversion function UDINT_TO_IDENTINGROUP. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; Axis : AXIS_REF; END_VAR Name Type Description Axes Group AXES_GROUP_REF Reference to a group of axes (see Cyclic Group Interface [} 114]). Axis AXIS_REF Reference to an axis (see AXIS_REF). Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. TF5410 Version: 2.7.0 59
## Page 60

PLC Libraries Name Type Description Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Sample for Twin CAT 3 Motion Pick-and-Place Multi-dimensional movements Multi-dimensional movements are only applicable when TF5420 is used. VAR_GLOBAL CONSTANT c Axes Count : UINT := 4; END_VAR VAR st Group Ref : AXES_GROUP_REF; // link to MC Group st Axis : ARRAY[1..c Axes Count] OF AXIS_REF; fb Add Axis : ARRAY[1..c Axes Count] OF MC_Add Axis To Group; i : UINT; END_VAR fb Add Axis[1]. Ident In Group := MCS_X; //X-Axis fb Add Axis[2]. Ident In Group := MCS_Y; //Y-Axis fb Add Axis[3]. Ident In Group := MCS_Z; //Z-Axis fb Add Axis[4]. Ident In Group := MCS_C1;//1st rotation is C-rotation (around Z-Axis) FOR i:=1 TO c Axes Count DO fb Add Axis[i]( Axes Group:=st Group Ref, Axis := st Axis[i], Execute := TRUE); END_FOR Sample for TF5410 Twin CAT 3 Motion Collision Avoidance PTP with Collision Avoidance PTP with Collision Avoidance is only applicable when TF5410 is used. VAR_GLOBAL CONSTANT c Axes Count : UDINT:=10; END_VAR VAR st Group Ref : AXES_GROUP_REF; // link to CA Group st Axis : ARRAY[1..c Axes Count] OF AXIS_REF; fb Add Axis : ARRAY[1..c Axes Count] OF MC_Add Axis To Group; i : UDINT; END_VAR FOR i:=1 TO c Axes Count DO fb Add Axis[i]( Axes Group:=st Group Ref, Axis := st Axis[i], Ident In Group := UDINT_TO_IDENTINGROUP(i), Execute := TRUE); END_FOR 60 Version: 2.7.0 TF5410
## Page 61

PLC Libraries Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.1.2 MC_Group Disable MC_Group Disable Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Group Disable disables the group. After successful execution the group changes into group state Group Disabled (see State diagrams [} 23]). As of TF5400 V3.3.72, PTP commands of the Tc2_MC2 library (e.g. MC_Move Absolute) are permitted on axes of the MC Group Coordinated Motion in the Group Disabled state. NOTICE Disabling a Moving Group results in an instant stop. The sudden stopping of axes is likely to exceed its allowed deceleration limits. Depending on the drive hardware, this could lead to current peaks and runtime errors. Before executing MC_Group Disable, use MC_Group Halt [} 78] or MC_Group Stop [} 80] to avoid this situation. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF TF5410 Version: 2.7.0 61
## Page 62

PLC Libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.1.3 MC_Group Enable MC_Group Enable Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Group Enable enables the group. If it succeeds and all axes are ready, the group is then in group state Group Standby (see State diagrams [} 23]). An MC Group can only be enabled, if all axes were added to the group before. Inputs VAR_INPUT Execute : BOOL; END_VAR 62 Version: 2.7.0 TF5410
## Page 63

PLC Libraries Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Group AXES_GROUP_REF Reference to a group of axes (see Cyclic group interface [} 114]) Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.1.4 MC_Group Read Error MC_Group Read Error Enable BOOL BOOL Valid ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id UDINT Group Error Id The function block MC_Group Read Error returns the error code for the group. It does not return any errors for function blocks (e.g. invalid parameterization). TF5410 Version: 2.7.0 63
## Page 64

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL The command is executed as long as Enable is active. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Valid : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; Group Error Id : UDINT; END_VAR Name Type Description Valid BOOL This output indicates that other output values are valid for this function block. Busy BOOL This output becomes TRUE when the command is started with Enable and remains so as long as the function block executes the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Group Error Id UDINT Returns the error ID of the group (see NC error documentation). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 64 Version: 2.7.0 TF5410
## Page 65

PLC Libraries 9.3.1.1.5 MC_Group Read Status MC_Group Read Status Enable BOOL BOOL Valid ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Group Moving BOOL Group Homing BOOL Group Error Stop BOOL Group Not Ready BOOL Group Standby BOOL Group Stopping BOOL Group Disabled BOOL All Axes Standing BOOL In Position BOOL Error UDINT Error Id The function block MC_Group Read Status reads the status of an axis group (see State diagrams [} 23]). TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL The command is executed as long as Enable is active. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Valid : BOOL; Busy : BOOL; Group Moving : BOOL; Group Homing : BOOL; Group Error Stop : BOOL; Group Not Ready : BOOL; Group Standby : BOOL; Group Stopping : BOOL; Group Disabled : BOOL; All Axes Standing : BOOL; Constant Velocity : BOOL; // hidden Accelerating : BOOL; // hidden Decelerating : BOOL; // hidden In Position : BOOL; TF5410 Version: 2.7.0 65
## Page 66

PLC Libraries Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Valid BOOL This output indicates that other output values are valid for this function block. Busy BOOL This output becomes TRUE when the command is started with Enable and remains so as long as the function block executes the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Group Moving BOOL The group is in the Group Moving state (see State diagrams [} 23]). Group Homing BOOL The group is in the Group Homing state (see State diagrams [} 23]). Group Error Stop BOOL The group is in the Group Error Stop state (see State diagrams [} 23]). Group Not Ready BOOL The group is in the Group Not Ready state (see State diagrams [} 23]). Group Standby BOOL The group is in the Group Standby state (see State diagrams [} 23]). Group Stopping BOOL The group is in the Group Stopping state (see State diagrams [} 23]). Group Disabled BOOL The group is in the Group Disabled state (see State diagrams [} 23]). All Axes Standing BOOL None of the axes in the group move physically (velocity = 0 and acceleration = 0), regardless of whether a Motion Command exists or not. Constant Velocity BOOL Not supported. Not visible as of TF5400 3.2.27. Accelerating BOOL Not supported. Not visible as of TF5400 3.2.27. Decelerating BOOL Not supported. Not visible as of TF5400 3.2.27. In Position BOOL Not supported. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.1.6 MC_Group Reset MC_Group Reset Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) 66 Version: 2.7.0 TF5410
## Page 67

PLC Libraries The function block MC_Group Reset resets all internal errors of a group and all axes which are part of the group. If the group was enabled when the error occurred, the group goes into state Group Standby. If the group was disabled, it goes to state Group Disabled (see State diagrams [} 23]). If this function block is called while there is no error, it has no effect. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 TF5410 Version: 2.7.0 67
## Page 68

PLC Libraries 9.3.1.1.7 MC_Group Set Override MC_Group Set Override Enable BOOL BOOL Enabled Vel Factor MC_LREAL BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Error UDINT Error Id LREAL Actual Vel Factor TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Group Set Override changes the override of a group. A change is made with a certain delay. An override input value is valid between 0 [0%] and 1 [100%]. If the value is set outside this range, it is automatically set to the respective limit value. The behavior for override modifications in relation to the MC group can be defined as an axis group parameter, see Time Override Ramp Time. Inputs VAR_INPUT Enable : BOOL; Vel Factor : MC_LREAL := 1.0; END_VAR Name Type Description Enable BOOL The command is executed as long as Enable is active. Vel Factor MC_LREAL The override is set to this value (value range between 0 [0 %] and 1 [100 %]). Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Enabled : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; Actual Vel Factor : UDINT; END_VAR Name Type Description Enabled BOOL This output signals that the Vel Factor has been set successfully. The Vel Factor shows the type of an override factor. 68 Version: 2.7.0 TF5410
## Page 69

PLC Libraries Name Type Description Busy BOOL This output becomes TRUE when the command is started with Enable and remains so as long as the function block executes the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Actual Vel Factor UDINT Override that is currently active in the group (value range between 0 [0 %] and 1 [100 %]). Sample VAR st Group Ref : AXES_GROUP_REF; fb Set Override : MC_Group Set Override; END_VAR fb Set Override( Axes Group:=st Group Ref , Enable:= TRUE , Vel Factor:=1.0 , (* 1.0 = 100% *) ); Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.1.8 MC_Remove Axis From Group MC_Remove Axis From Group Execute BOOL BOOL Done Ident In Group IDENT_IN_GROUP_REF BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Remove Axis From Group removes an axis from the axis group. From TF5400 V3.1.10.1, stationary axes can be added to and removed from a CA group in the Group Moving group state. If a moving axis is added to a group, the command is rejected with an error message (a change of the group state with a moving axis is also rejected). Axes can only be added to an MC group if Enable Requested is FALSE, e.g. in the Group Disabled state. TF5410 Version: 2.7.0 69
## Page 70

PLC Libraries Success of the function block The function block always returns DONE if the axis no longer belongs to the group. This means that DONE is returned even if the axis was not in the group before the function block was called. Inputs VAR_INPUT Execute : BOOL; Ident In Group : IDENT_IN_GROUP_REF; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Ident In Group IDENT_IN_GROUP_REF Defines the interpretation of the axis to be added to the group. For multidimensional motions, this can be the Cartesian interpretation. The global variables (e.g. MCS_X) must be used. For Collision Avoidance the function UDINT_TO_IDENTINGROUP must be used. Use of integer values for the input Ident In Group The use of integer values for the input Ident In Group is NOT supported and may lead to incompatibility with future releases. If integer values are used, it may no longer be possible to build the project. We recommend using global variables [} 94] (e.g. MCS_X) or the conversion function UDINT_TO_IDENTINGROUP [} 77]. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). 70 Version: 2.7.0 TF5410
## Page 71

PLC Libraries Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.1.9 MC_Set Coordinate Transform MC_Set Coordinate Transform Execute BOOL BOOL Done Coord Transform MC_COORD_REF BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Active BOOL Command Aborted BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Set Coordinate Transform activates a coordinate transformation for successor movements. The successful activation is indicated by Active or Done. Decouples the successor movements from a transport system (see MC_Track Conveyor Belt [} 73]). Successor movements (e.g. MC_Move Path [} 88]) take place relative to the coordinate transformation. Use case for changing the reference system The MC group can be decoupled by using MC_Set Coordinate Transform and changing the reference system. Inputs VAR_INPUT Execute : BOOL; Coord Transform : MC_COORD_REF; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Coord Transform MC_COORD_REF Reference to a coordinate system (see MC_COORD_REF [} 103]). Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Group AXES_GROUP_REF Reference to a group of axes (see Cyclic Group Interface [} 114]). TF5410 Version: 2.7.0 71
## Page 72

PLC Libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Done, Command Aborted or Error is set. Active BOOL Active indicates that the command is being executed. Active indicates that the reference system has been successfully set (MC Coordinated Motion Group only). Active indicates a delay in conveyor tracking (MC Coordinated Motion Group only). Active becomes FALSE if one of the outputs Done, Command Aborted or Error is set to TRUE. Note: According to the PLCopen definition, Active is reset if Done is set to TRUE. In the event of an insignificant or non-existent delay, Active can only be set to TRUE for a short period of time. If the PLC program checks Active, it is therefore advisable to also check Done. Command Aborted BOOL This output becomes TRUE if the command was interrupted by another command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4022.25 PC or CX (x64) Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack Tc2_MC2 V3.1.6.03 9.3.1.1.10 MC_Set Coordinate Transform Preparation MC_Set Coordinate Transform Preparation ↔ Path Data Reference To MC_PATH_DATA_REF BOOL Error Coord Transform MC_COORD_REF UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion 72 Version: 2.7.0 TF5410
## Page 73

PLC Libraries The function block MC_Set Coordinate Transform Preparation inserts a change of reference system into the table containing the segments of a path. Inputs VAR_INPUT Path Data : MC_PATH_DATA_REF; Coord Transform : MC_COORD_REF; END_VAR Name Type Description Path Data MC_PATH_DATA_REF [} 100] Table containing the segments of a path. The table is written by the function block MC_…Preparation and executed by MC_Move Path [} 88]. Coord Transform MC_COORD_REF [} 103] Reference to a coordinate system. Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC library to include Twin CAT V3.1.4024.40 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.3.19 9.3.1.1.11 MC_Track Conveyor Belt MC_Track Conveyor Belt Execute BOOL BOOL In Sync Coord Transform MC_COORD_REF BOOL Busy Initial Object Pos Pointer To MC_LREAL BOOL Active Initial Object Pos Count UDINT BOOL Command Aborted Master Ref Pos MC_LREAL BOOL Error Velocity MC_LREAL UDINT Error Id Acceleration MC_LREAL Deceleration MC_LREAL Jerk MC_LREAL ↔ Axes Group Reference To AXES_GROUP_REF ↔ Conveyor Belt Reference To AXIS_REF TF5410 Version: 2.7.0 73
## Page 74

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block Mc_Track Conveyor Belt enables a reference system that is in motion. It synchronizes the Axes Group with the Conveyor Belt in terms of velocity. Synchronization with a position requires a motion command. The function block thus helps to synchronize with an object that moves in a straight line through space. Example: products moving on a conveyor belt or other transport system. The origin of the conveyor belt is parameterized with a coordinate system (Coord Transform). X is the conveying direction. The detected object position (Initial Object Pos) and the corresponding touch probe position (Master Ref Pos) are entered in the function block. Synchronization dynamics can be entered in the function block. Movements executed after Active = TRUE are synchronized with the conveyor belt. Execution of MC_Track Conveyor Belt with another instance causes direct synchronization with a second conveyor belt. When changing the reference system, a conveyor belt can be decoupled. Use case for changing the reference system The MC group can be decoupled by using MC_Track Conveyor Belt and changing the reference system. The reference system can be changed with MC_Set Coordinate Transform. News and optimizations regarding MC_Track Converyor Belt with TF5400 V3.2.27 for MC Group Coordinated Motion • New: Optionally, the override also affects the synchronization phase for the MC_Track Conveyor Belt. The setting is made in the parameter "Tracking Override Behavior" in the MC Group Coordinated Motion. • Optimizations to the MC_Track Conveyor Belt that prevent SAF cycle misalignment between conveyor (master) and slave axis. • Optimizations of the error reaction for the MC_Track Conveyor Belt. In the event of a runtime error of the conveyor belt (master), an active MC_Move Path is not aborted and an error reaction is to be triggered via the PLC. Inputs VAR_INPUT Execute : BOOL; Coord Transform : MC_COORD_REF; Initial Object Pos : POINTER TO MC_LREAL; Initial Object Pos Count : UDINT; Master Ref Pos : MC_LREAL; Velocity : MC_LREAL := MC_DEFAULT; Acceleration : MC_LREAL := MC_DEFAULT; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Coord Transform MC_COORD_REF Reference to a coordinate system (see MC_COORD_REF [} 103]). 74 Version: 2.7.0 TF5410
## Page 75

PLC Libraries Name Type Description Initial Object Pos POINTER TO MC_LREAL Pointer to array [1.. Initial Object Pos Count]. Initial Object Pos Count UDINT Dimension of the Initial Object Pos vector. Master Ref Pos MC_LREAL Touch probe position. Velocity MC_LREAL Velocity for synchronization. The velocity must exceed the conveyor belt velocity. The velocity is not limited by the maximum axis velocity. Acceleration MC_LREAL Used in the Conveyor Tracking object. The acceleration for synchronization. The acceleration is not limited by the maximum axis acceleration. If no value is entered, then the default acceleration of the Conveyor Tracking object is used. Deceleration MC_LREAL Used in the Conveyor Tracking object. The deceleration for synchronization. The deceleration is not limited by the maximum axis deceleration. If no value is entered, then the default deceleration of the Conveyor Tracking object is used. Jerk MC_LREAL The jerk for synchronization. If no value is entered, then the default jerk of the Conveyor Tracking object is used. The maximum jerk is not limited. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; Conveyor Belt : AXIS_REF; END_VAR Name Type Description Axes Group AXES_GROUP_REF Reference to a group of axes (see Cyclic Group Interface [} 114]). Conveyor Belt AXIS_REF Reference to an axis. Reference to the conveyor axis. Outputs VAR_OUTPUT In Sync : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description In Sync BOOL The output In Sync becomes TRUE for the first time when the slave is synchronized with the velocity. If the slave dynamics is too low to follow the master movement, the output In Sync could be reset to FALSE, after which the slave axis starts synchronizing again. Notice Velocity synchronization: Active and In Sync - the function block MC_Track Conveyor Belt synchronizes the Axes Group with the velocity of the Conveyor Belt axis. The function block uses the given parameters for Acceleration, Deceleration and Jerk. When this synchronization movement begins, Active is set to TRUE. When the velocity of the Conveyor Belt is reached, In Sync is set to TRUE. The synchronization status is continuously monitored and indicated with In Sync. TF5410 Version: 2.7.0 75
## Page 76

PLC Libraries Name Type Description Notice Conveyor movement, default tracking behavior and In Sync - once the output signal In Sync has been set, there are two options to maintain synchronization. mc Tracking Behavior Dyn Limited - this behavior is the default (MC_Default) tracking behavior. The Axes Group maintains velocity synchronization with the Conveyor Belt using the given parameters for Acceleration, Deceleration and Jerk. – mc Tracking Behavior Stay In Sync - the Axes Group maintains the velocity synchronization with the Conveyor Belt with unlimited parameters for Acceleration, Deceleration and Jerk. Notice Position synchronization: Master Ref Pos and Initial Object Pos - the function blocks MC_Track Conveyor Belt and MC_Move Path should be used together for flexible synchronization with a moving target position. After MC_Track Conveyor Belt. Active is set to TRUE, Initial Object Pos and the distance to Master Ref Pos are appended to the next call to MC_Move Path. MC_Track Conveyor Belt. In Sync = TRUE and MC_Move Path. Done = TRUE indicate that the synchronized position has been reached. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If BUSY becomes FALSE again, the function block is ready for a new command. At the same time, one of the outputs Command Aborted or Error is set. Active BOOL If Active is TRUE, the function block controls the group. Command Abor BOOL This output becomes TRUE if the command was interrupted by another ted command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4022.25 PC or CX (x64) Tc3_Mc Coordinated Motion, TF5400 Advanced Motion Pack Tc2_MC2 V3.1.6.03 9.3.1.1.12 MC_Ungroup All Axes MC_Ungroup All Axes Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Ungroup All Axes removes all axes and disables the group. If the function block succeeds, the group is then in group state Group Disabled (see State diagrams [} 23]). 76 Version: 2.7.0 TF5410
## Page 77

PLC Libraries Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.1.13 UDINT_TO_IDENTINGROUP TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion TF5410 Version: 2.7.0 77
## Page 78

PLC Libraries The function UDINT_TO_IDENTINGROUP is a conversion function, which converts an integer value to IDENT_IN_GROUP_REF. It is required to add a PTP axis without spatial interpretation to a CA-Group [} 20]. This conversion function returns a valid input for MC_Add Axis To Group [} 58] and MC_Remove Axis From Group [} 69]. For axes intended for multi-dimensional movement (TF5420) see IDENT_IN_GROUP_REF [} 94]. Use of integer values for the input Ident In Group The use of integer values for the input Ident In Group is NOT supported and may lead to incompatibility with future releases. If integer values are used, it may no longer be possible to build the project. We recommend using global variables [} 94] (e.g. MCS_X) or the conversion function UDINT_TO_IDENTINGROUP [} 77]. Return value Name Type Description UDINT_TO_IDENTINGROUP IDENT_IN_GROUP_REF [} 94] Converts an integer value, so a PTP axis can be added to a motion group. Inputs VAR_INPUT id : UDINT; END_VAR Name Type Description id UDINT The unique identifier an axis shall have in the group. This does not have to be the axis ID from the cyclic axis interface. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.2 Motion 9.3.1.2.1 MC_Group Halt MC_Group Halt Execute BOOL BOOL Done Deceleration MC_LREAL BOOL Busy Jerk MC_LREAL BOOL Active ↔ Axes Group Reference To AXES_GROUP_REFBOOL Command Aborted BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion 78 Version: 2.7.0 TF5410
## Page 79

PLC Libraries The MC_Group Halt function block stops a group with a defined deceleration ramp. Unlike "MC_Group Stop [} 80]", the group is not locked for further motion commands. Therefore, the group can be restarted by another command during the deceleration ramp or after stopping. WARNING Possible delayed axis stop If Standby Gap Control is active with a CA group and the gap is also less than the minimum, the gap is first extended before the axes can be stopped with an MC_Group Halt. • Make sure that you actually need the behavior of Standby Gap Control; if not, consider disabling it (default setting). • Use an MC_Group Stop instead of an MC_Group Halt if the axes need to be stopped without a delay. NOTICE MC_Group Halt not implemented for MC group with pick-and-place The MC_Group Halt function block is only implemented for the MC Group Coordinated Motion and for PTP movements with Collision Avoidance (CA group). When used with another group type, the command is rejected. Applies to the MC_Group: MC_Group Halt cancels the active coordinate transformation and deletes all jobs in the queue. Inputs VAR_INPUT Execute : BOOL; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Deceleratio MC_LREA [mm/s²]. The deceleration can be programmed as a scalar value (≥1), or "Special n L input values [} 115]" can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. Jerk MC_LREA [mm/s³]. The jerk can be programmed as a scalar value (≥100), or "Special input L values [} 115]" can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. MC_IGNORE executes the command with unlimited jerk. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; TF5410 Version: 2.7.0 79
## Page 80

PLC Libraries Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL Becomes TRUE when the group has been stopped and has come to a standstill. Once the group has come to a standstill, the group state becomes Group Standby (see State diagrams [} 23]). Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Active BOOL Active indicates that the command is being executed. If the command was in the queue, it becomes active as soon as an executed command is completed. Command Aborted BOOL This output becomes TRUE if the command was interrupted by another command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.2.2 MC_Group Stop MC_Group Stop Execute BOOL BOOL Done Deceleration MC_LREAL BOOL Busy Jerk MC_LREAL BOOL Active ↔ Axes Group Reference To AXES_GROUP_REFBOOL Command Aborted BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Group Stop stops the group and all associated axes with a defined deceleration ramp and locks the axis for motion commands. While the group is in the Group Stopping state, no other function block can move an axis of the group (see State diagrams [} 23]). The group can only be moved again once the signal Execute has been set to FALSE after the velocity is 0. 80 Version: 2.7.0 TF5410
## Page 81

PLC Libraries MC_Group Stop cancels the active coordinate transformation and deletes all jobs in the queue. Inputs VAR_INPUT Execute : BOOL; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Deceleration MC_LREAL [mm/s²]. The deceleration can be programmed as a scalar value (≥1), or "Special input values [} 115]" can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. Jerk MC_LREAL [mm/s³]. The jerk can be programmed as a scalar value (≥100), or "Special input values [} 115]" can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. MC_IGNORE executes the command with unlimited jerk. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Gro AXES_GROUP_R Reference to a group of axes (see Cyclic Group Interface). up EF Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL Becomes TRUE when the group has been stopped and has come to a standstill. The group remains in the Group Stopping state while Execute is TRUE, at least until the axes have come to a stop. The group is then in the Group Standby state (see State diagrams [} 23]). Busy BOOL Becomes TRUE when the command is started with Execute and remains so as long as the command is executed. If Busy becomes FALSE again, the group is ready for a new command. After the group is stopped, Busy remains TRUE until the group is released with Execute=FALSE. Active BOOL Indicates that the function block controls the group. After the group is stopped, Active remains TRUE until the group is released with Execute=FALSE. Command Aborted BOOL The command is aborted by disabling MC_Power of at least one axis of the group or if the group is disabled during the command. Error BOOL This output becomes TRUE if an error has occurred during command execution. TF5410 Version: 2.7.0 81
## Page 82

PLC Libraries Name Type Description Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.2.3 MC_Move Linear Absolute Preparation MC_Move Linear Absolute Preparation Position Pointer To MC_LREAL BOOL Error Position Count UDINT UDINT Error Id Velocity MC_LREAL Acceleration MC_LREAL Deceleration MC_LREAL Jerk MC_LREAL Buffer Mode MC_BUFFER_MODE Transition Mode MC_TRANSITION_MODE Transition Parameter Pointer To MC_LREAL Transition Parameter Count UDINT Invoke Id UDINT Dynamic Constraints Reference To IPlc Dynamic Constraint ↔ Path Data Reference To MC_PATH_DATA_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Move Linear Absolute Preparation adds an absolute linear movement to the table of segments in the Path Data structure. After creating a table, it can be executed via MC_Move Path [} 88]. The function block MC_Move Linear Absolute Preparation can be called several times per cycle. A maximum of 30 entries are allowed per Path Data table. Inputs VAR_INPUT Position : POINTER TO LREAL; Position Count : UDINT; Velocity : MC_LREAL := MC_INVALID; Acceleration : MC_LREAL := MC_DEFAULT; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; Buffer Mode : MC_BUFFER_MODE := mc Aborting; Transition Mode : MC_TRANSITION_MODE := mc Trans Mode None; Transition Parameter : POINTER TO LREAL; Transition Parameter Count : UDINT; Invoke Id : UDINT; Dynamic Constraints : REFERENCE TO IPlc Dynamic Constraint := 0; END_VAR 82 Version: 2.7.0 TF5410
## Page 83

PLC Libraries Name Type Description Position POINTER TO Pointer to an array [1.. Position Count] of the target position vector. LREAL Position Count UDINT Dimension of the position vector. Must match the number of axes in the axis convention (see MC Group Coordinated Motion or MC Group with Pick-and-Place). Velocity MC_LREAL The maximum velocity for the programmed segment. The velocity does not always have to be reached. The velocity must be set >0. Acceleration MC_LREAL Maximum path acceleration for the programmed segment. Special input values [} 115] can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. The acceleration must be set ≥1. Deceleration MC_LREAL Maximum path deceleration for the programmed segment. Special input values [} 115] can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. The deceleration must be set ≥1. Jerk MC_LREAL Path jerk for the programmed segment. Special input values [} 115] can be used. MC_DEFAULT executes the command with default axis values. The jerk must be set ≥100. From TF5400 V3.2.27: MC_MAXIMUM is supported for MC Group Coordinated Motion. Here MC_MAXIMUM = 100 * MC_DEFAULT. Buffer Mode MC_BUFFER_M Defines how successive motion commands are to be processed (see ODE MC_BUFFER_MODE [} 104]). Transition mode MC_TRANSITIO Defines the blending mode (see MC_TRANSITION_MODE [} 101]). N_MODE Transition Parame POINTER TO Pointer to array [1.. Transition Parameter Count] of blending parameters. ter LREAL Transition parameters define the blending from the last programmed position (see MC_TRANSITION_MODE [} 101]). Transition Parame UDINT Number of blending parameters (see MC_TRANSITION_MODE [} 101]). ter Count Invoke Id UDINT Segment ID for analysis purposes. Dynamic Constrai REFERENCE From TF5400 V3.2.27, MC Group Coordinated Motion: nts TO Optional input to further limit the allowed values for velocity, IPlc Dynamic Cons acceleration, deceleration or jerk during motion. traint Notice Reference assignment: <Instance Of MC_Move Linear Absolute Preparation>. Dynamic Constraints REF= <Instance Of IPlc Dynamic Constraint>; Inputs/outputs VAR_IN_OUT Path Data : MC_PATH_DATA_REF; END_VAR Name Type Description Path Data MC_PATH_DATA_RE Table containing the segments of a path. The table is written by F MC_Move…Preparation and executed by MC_Move Path [} 88] (see MC_PATH_DATA_REF [} 100]). Resetting a table A table is not reset during execution. To reset, the method Clear Path() must be called from MC_PATH_DATA_REF. TF5410 Version: 2.7.0 83
## Page 84

PLC Libraries Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.2.4 MC_Move Circular Absolute Preparation MC_Move Circular Absolute Preparation Circ Mode MC_CIRC_MODE BOOL Error Aux Point Pointer To MC_LREAL UDINT Error Id Aux Point Count UDINT End Point Pointer To MC_LREAL End Point Count UDINT Path Choice MC_CIRC_PATHCHOICE Velocity MC_LREAL Acceleration MC_LREAL Deceleration MC_LREAL Jerk MC_LREAL Buffer Mode MC_BUFFER_MODE Transition Mode MC_TRANSITION_MODE Transition Parameter Pointer To MC_LREAL Transition Parameter Count UDINT Invoke Id UDINT Dynamic Constraints Reference To IPlc Dynamic Constraint ↔ Path Data Reference To MC_PATH_DATA_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The MC_Move Circular Absolute Preparation function block adds an absolute circular motion to the table of segments in the MC_PATH_DATA_REF [} 100] structure. After creating a table, it can be executed via MC_Move Path [} 88]. The function block MC_Move Circular Absolute Preparation can be called several times per cycle. A maximum of 30 entries are permitted per MC_Path_DATA_REF table. 84 Version: 2.7.0 TF5410
## Page 85

PLC Libraries Resetting a table A table is not reset during execution. To reset, the Clear Path [} 101] method must be called from MC_PATH_DATA_REF [} 100]. Inputs VAR_INPUT Circ Mode : MC_CIRC_MODE := mc Circ Mode Invalid; Aux Point : POINTER TO MC_LREAL; Aux Point Count : UDINT; End Point : POINTER TO MC_LREAL; End Point Count : UDINT; Path Choice : MC_CIRC_PATHCHOICE := mc Circ Pathchoice Counter Clockwise; Velocity : MC_LREAL := MC_INVALID; Acceleration : MC_LREAL := MC_DEFAULT; Deceleration : MC_LREAL := MC_DEFAULT; Jerk : MC_LREAL := MC_DEFAULT; Buffer Mode : MC_BUFFER_MODE := mc Aborting; Transition Mode : MC_TRANSITION_MODE := mc Trans Mode None; Transition Parameter : POINTER TO MC_LREAL; Transition Parameter Count : UDINT; Invoke Id : UDINT; Dynamic Constraints : REFERENCE TO IPlc Dynamic Constraint := 0; END_VAR Name Type Description Circ Mode MC_CIRC_MOD Specifies which circle definition is used to program the circle. Specifies E the meaning of the "Aux Point" input signal (see MC_CIRC_MODE [} 95]). Aux Point POINTER TO Pointer to an array [1.. Aux Point Count] of the Aux Point vector. The MC_LREAL interpretation of the Aux Point vector depends on the spatial axes convention (see MC Group Coordinated Motion). Aux Point Count UDINT Dimension of the Aux Point vector. End Point POINTER TO Pointer to an array [1.. End Point Count] of the target position vector. MC_LREAL End Point Count UDINT Dimension of the End Point vector. Must match the number of axes in the axis convention (see MC Group Coordinated Motion or MC Group with Pick-and-Place). Path Choice MC_CIRC_PATH Defines the direction of rotation with respect to the normal vector. The CHOICE input is ignored if the input Circ Mode is set to mc Circ Mode Border (see MC_CIRC_PATHCHOICE [} 99]). Velocity MC_LREAL The maximum velocity for the programmed segment. The velocity does not always have to be reached. The velocity must be set >0. Acceleration MC_LREAL Maximum path acceleration for the programmed segment. Special input values [} 115] can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. The acceleration must be set ≥1. Deceleration MC_LREAL Maximum path deceleration for the programmed segment. Special input values [} 115] can be used. MC_DEFAULT executes the command with default axis values. MC_MAXIMUM executes the command with the maximum axis values. The deceleration must be set ≥1. Jerk MC_LREAL Path jerk for the programmed segment. Special input values [} 115] can be used. MC_DEFAULT executes the command with default axis values. The jerk must be set ≥100. From TF5400 V3.2.27: MC_MAXIMUM is supported for MC Group Coordinated Motion. Here MC_MAXIMUM = 100 * MC_DEFAULT. TF5410 Version: 2.7.0 85
## Page 86

PLC Libraries Name Type Description Buffer Mode MC_BUFFER_M Defines how successive motion commands are to be processed (see ODE MC_BUFFER_MODE [} 104]). Transition mode MC_TRANSITIO Defines the blending mode (see MC_TRANSITION_MODE [} 101]). N_MODE Transition Parame POINTER TO Pointer to array [1.. Transition Parameter Count] of blending parameters. ter MC_LREAL Transition parameters define the blending from the last programmed position (see MC_TRANSITION_MODE [} 101]). Transition Parame UDINT Number of blending parameters. ter Count Invoke Id UDINT Segment ID for analysis purposes. Dynamic Contraint REFERENCE From TF5400 V3.2.27, MC Group Coordinated Motion: s TO Optional input to further limit the allowed values for velocity, IPlc Dynamic Cons acceleration, deceleration or jerk during motion. traint Notice Reference assignment: <Instance Of MC_Move Circular Absolute Preparation>. Dynam ic Constraints REF= <Instance Of IPlc Dynamic Constraint>; Inputs/outputs VAR_IN_OUT Path Data : MC_PATH_DATA_REF; END_VAR Name Type Description Path Data MC_PATH_DAT Table containing the segments of a path. The table is written by A_REF MC_Move…Preparation and executed by MC_Move Path [} 88] (see MC_PATH_DATA_REF [} 100]). Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Sample of center point programming Assuming a path consisting of 4 segments as shown in the figure is to be programmed in mc Circ Mode Center mode: the user defines the center of the circle as an auxiliary point ("Aux Point"). When using mc Circ Mode Center, the input MC_CIRC_PATHCHOICE [} 99] determines the direction of rotation. Since the plane is defined by the cross product, mc Circ Pathchoice Counter Clockwise must be selected for both circle segments N20 and N30. 86 Version: 2.7.0 TF5410
## Page 87

PLC Libraries VAR Buffer : ARRAY[1..4096] OF BYTE; Path : MC_PATH_DATA_REF (ADR(buffer), SIZEOF(buffer)); fb Move Lin Prep : MC_Move Linear Absolute Preparation; fb Move Circ Prep : MC_Move Circular Absolute Preparation; a Target Pos : ARRAY[1..c Axes Count] OF MC_LREAL; a Circ Pos : ARRAY[1..c Axes Count] OF MC_LREAL; a Aux Point : ARRAY[1..3] OF MC_LREAL; a Transition Param : ARRAY[1..2] OF MC_LREAL; END_VAR VAR CONSTANT c Axes Count : UINT:=3; END_VAR fb Move Lin Prep. Position := ADR(a Target Pos); fb Move Lin Prep. Position Count := c Axes Count; fb Move Lin Prep. Transition Parameter := ADR(a Transition Param); fb Move Lin Prep. Transition Parameter Count := 2; fb Move Lin Prep. Buffer Mode := mc Buffered; fb Move Lin Prep. Transition Mode := mc Trans Mode None; fb Move Circ Prep. End Point := ADR(a Target Pos); fb Move Circ Prep. End Point Count := c Axes Count; fb Move Circ Prep. Aux Point := ADR(a Aux Point); fb Move Circ Prep. Aux Point Count := 3; fb Move Circ Prep. Circ Mode := mc Circ Mode Center; fb Move Circ Prep. Transition Parameter := ADR(a Transition Param); fb Move Circ Prep. Transition Parameter Count := 2; fb Move Circ Prep. Buffer Mode := mc Buffered; fb Move Circ Prep. Transition Mode := mc Trans Mode None; a Target Pos[1] := 200; a Target Pos[2] := 0; a Target Pos[3] := 0; a Transition Param[1] := 0; a Transition Param[2] := 0; fb Move Lin Prep(Path Data:= path, Velocity:= 3000, Invoke Id:= 10); a Target Pos[1] := 300; a Target Pos[2] := -100; a Target Pos[3] := 0; a Aux Point[1] := 200; a Aux Point[2] := -100; a Aux Point[3] := 0; a Transition Param[1] := 0; a Transition Param[2] := 0; fb Move Circ Prep(Path Data:= path, Path Choice:= mc Circ Pathchoice Clockwise, Velocity:= 1000, Invoke I d:= 20); a Target Pos[1] := 400; a Target Pos[2] := -200; a Target Pos[3] := 0; a Aux Point[1] := 400; a Aux Point[2] := -100; a Aux Point[3] := 0; a Transition Param[1] := 0; a Transition Param[2] := 0; fb Move Circ Prep(Path Data:= path, Path Choice:= mc Circ Pathchoice Counter Clockwise, Velocity:= 1000, TF5410 Version: 2.7.0 87
## Page 88

PLC Libraries Invoke Id:= 30); a Target Pos[1] := 600; a Target Pos[2] := -200; a Target Pos[3] := 100; a Transition Param[1] := 0; a Transition Param[2] := 0; fb Move Lin Prep(Path Data:= path, Velocity:= 3000, Invoke Id:= 40); Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or Tc3_Mc Coordinated Motion, CX (x64) Tc2_MC2 TF5400 Advanced Motion Pack V3.1.2.47 9.3.1.2.5 MC_Move Path MC_Move Path Execute BOOL BOOL Done ↔ Axes Group Reference To AXES_GROUP_REF BOOL Busy ↔ Path Data Reference To MC_PATH_DATA_REF BOOL Active BOOL Command Aborted BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The function block MC_Move Path executes a movement defined in the Path Data table by MC_Move Linear Absolute Preparation [} 82], MC_Move Circular Absolute Preparation [} 84], MC_Blocker Preparation [} 89] and MC_Set Coordinate Transform Preparation [} 72]. Re-triggering of an FB instance during motion It is possible to execute different motion commands with one instance of this function block. However, the outputs of the function block only indicate the last command executed. The user loses the ability to diagnose for the previously sent motion commands. Re-triggering of a function block is therefore not recommended. Inputs VAR_INPUT Execute : BOOL; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; Path Data : MC_PATH_DATA_REF; END_VAR 88 Version: 2.7.0 TF5410
## Page 89

PLC Libraries Name Type Description Axes Group AXES_GROUP Reference to a group of axes (see Cyclic group interface [} 114]). _REF Path Data MC_PATH_DAT Table containing the segments of a path. The table is written by A_REF [} 100] MC_Move Linear Absolute Preparation [} 82], MC_Move Circular Absolute Preparation [} 84], MC_Blocker Preparation [} 89] and MC_Set Coordinate Transform Preparation [} 72] and executed by MC_Move Path [} 88]. Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Active : BOOL; Command Aborted : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. This means that the last command defined by the reference variable Path Data was executed successfully. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Active BOOL If Active is TRUE, the FB controls the axis. Command A BOOL This output becomes TRUE if the command was interrupted by another borted command. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.1.2.6 MC_Blocker Preparation MC_Blocker Preparation Blocker Id UDINT BOOL Error Buffer Mode MC_BUFFER_MODE UDINT Error Id Invoke Id UDINT ↔ Path Data Reference To MC_PATH_DATA_REF TF5410 Version: 2.7.0 89
## Page 90

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The function block MC_Blocker Preparation appends a blocking job to the list of segments in the Path Data structure. The Path Data table can be executed via MC_Move Path. The function block MC_Blocker Preparation can be called several times per cycle. A maximum of 30 entries are allowed per Path Data table. A blocking job is an entry that suspends execution of the path until it is resolved with MC_Release Blocker [} 91]. As long as the blocker is not resolved, the execution of the path is stopped at this segment. Each blocker has an Id so that the individual blockers can be distinguished in the PLC. When a blocking job is active, the group status is still "moving". If the override is changed while the blocking job is active, it will take effect for the next moving job. If a new job with Buffer Mode mc Aborting is executed while the blocking job is active, the blocking job is aborted. If MC_Group Halt [} 78] or MC_Group Stop [} 80] are executed while the blocking job is active, the path is terminated and the blocking job is automatically released. Inputs VAR_INPUT Blocker Id : UDINT; Buffer Mode : MC_BUFFER_MODE := mc Buffered; Invoke Id : UDINT; END_VAR Name Type Description Blocker Id UDINT Id of the blocker. Can be any UDINT >0. Buffer Mode MC_BUFFER_M Defines how successive motion commands are to be processed (see ODE MC_BUFFER_MODE [} 104]). Only mc Buffered and mc Aborting are allowed here. Invoke Id UDINT Segment ID for analysis purposes. Inputs/outputs VAR_IN_OUT Path Data : MC_PATH_DATA_REF; END_VAR Name Type Description Path Data MC_PATH_DAT Table containing the segments of a path. The table is written by the A_REF Preparation function blocks, like this one, and executed by MC_Move Path (see MC_PATH_DATA_REF). Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. 90 Version: 2.7.0 TF5410
## Page 91

PLC Libraries Name Type Description Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 9.3.1.2.7 MC_Release Blocker MC_Release Blocker Execute BOOL BOOL Done Blocker Id UDINT BOOL Busy ↔ Axes Group Reference To AXES_GROUP_REF BOOL Error UDINT Error Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The function block MC_Release Blocker releases a blocking job that blocks further execution of the path. A blocking job is inserted into the path with MC_Blocker Preparation [} 89]. With the Superpos blending strategy or, from TF5400 3.1.10.63, also with the Geo Blending strategy, the blocker can be resolved before the blocker position is reached. Blending between motion segments surrounding this blocker can be executed if those segments allow it and are still executable at the time the blocking job is released. Inputs VAR_INPUT Execute : BOOL; Blocker Id : UDINT; END_VAR Name Type Description Execute BOOL The command is triggered by a rising edge at this input. Blocker Id UDINT Id of the blocker. Can be any UDINT >0. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR Name Type Description Axes Group AXES_GROUP_ Reference to an axis group (see Cyclic Group Interface [} 114]). REF TF5410 Version: 2.7.0 91
## Page 92

PLC Libraries Outputs VAR_OUTPUT Done : BOOL; Busy : BOOL; Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Done BOOL This output becomes TRUE when the command was successfully executed. Busy BOOL This output becomes TRUE when the command is started with Execute and remains so as long as the function block executes the command. If Busy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs Done, Command Aborted (if available) or Error is set. Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 9.3.1.2.8 MC_Group Read Blocker Status MC_Group Read Blocker Status Enable BOOL BOOL Valid ↔ Axes Group Reference To AXES_GROUP_REF BOOL Blocked UDINT Blocker Id TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The function block MC_Group Read Blocker Status reads the current blocker status. Inputs VAR_INPUT Enable : BOOL; END_VAR Name Type Description Enable BOOL Enables reading of the current blocker status. Inputs/outputs VAR_IN_OUT Axes Group : AXES_GROUP_REF; END_VAR 92 Version: 2.7.0 TF5410
## Page 93

PLC Libraries Name Type Description Axes Gro AXES_GROU Reference to an axis group (see Cyclic Group Interface [} 114]). up P_REF Outputs VAR_OUTPUT Valid : BOOL; Blocked : BOOL; Blocker Id : UDINT; END_VAR Name Type Description Valid BOOL Returns TRUE if a valid group type is used. Only group type MC Group Coordinated Motion is allowed. Blocked BOOL Returns TRUE if a blocking job is active, i.e. execution of the path is stopped. Returns FALSE if no blocking job is active. Blocker I UDINT Id of the blocker. Can be any UDINT >0. d Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 9.3.1.2.9 MC_Dwell Time Preparation MC_Dwell Time Preparation Dwell Time TIME BOOL Error Buffer Mode MC_BUFFER_MODE UDINT Error Id Invoke Id UDINT ↔ Path Data Reference To MC_PATH_DATA_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The function block MC_Dwell Time Preparation appends a standstill job with a defined time to the table of segments in the Path Data structure. The Path Data table can be executed via MC_Move Path. The function block MC_Dwell Time Preparation can be called several times per cycle. Inputs VAR_INPUT Dwell Time : Time; Buffer Mode : MC_BUFFER_MODE := mc Buffered; Invoke Id : UDINT; END_VAR Name Type Description Dwell Time Time Time during which the path is stationary at velocity 0. Any timespan >= 0 is allowed. A Dwell Time of zero leads to an exact stop, even if the surrounding segments would allow a transition with a velocity > 0. TF5410 Version: 2.7.0 93
## Page 94

PLC Libraries Name Type Description Buffer Mode MC_BUFFER_MODE Defines how successive motion commands are to be processed (see MC_BUFFER_MODE [} 104]). Only mc Buffered and mc Aborting are allowed here. Invoke Id UDINT Segment ID for analysis purposes. Inputs/outputs VAR_IN_OUT Path Data : MC_PATH_DATA_REF; END_VAR Name Type Description Path Data MC_PATH_DATA_REF Table containing the segments of a path. The table is written by the Preparation function blocks, like this one, and executed by MC_Move Path (see MC_PATH_DATA_REF). Outputs VAR_OUTPUT Error : BOOL; Error Id : UDINT; END_VAR Name Type Description Error BOOL This output becomes TRUE if an error has occurred during command execution. Error Id UDINT Contains the command-specific error code of the last executed command. Details of the error code can be found in the ADS error documentation or in the NC error documentation (error codes 0x4nnn and 0x8nnn). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or CX (x64) Tc3_Mc Collision Avoidance, Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 9.3.2 Datatypes 9.3.2.1 IDENT_IN_GROUP_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion IDENT_IN_GROUP_REF defines how an axis is interpreted in a group. Global variables can be used for multi-dimensional movements. For PTP collision-avoidance groups, the UDINT_TO_IDENTINGROUP [} 77] function must be called. Use of integer values for the input Ident In Group The use of integer values for the input Ident In Group is NOT supported and may lead to incompatibility with future releases. If integer values are used, it may no longer be possible to build the project. We recommend using global variables [} 94] (e.g. MCS_X) or the conversion function UDINT_TO_IDENTINGROUP [} 77]. 94 Version: 2.7.0 TF5410
## Page 95

PLC Libraries The constants below define axes as Cartesian axes in the machine coordinate system (MCS). A to C define the rotation axis (C: rotation around Z; B: rotation around Y; A: rotation around X). The number determines the rotation order. For example, if one axis is defined as MCS_C1 and another as MCS_B2, the system will first rotate around the Z-axis and second around the Y-axis VAR_GLOBAL MCS_X : IDENT_IN_GROUP_REF; MCS_Y : IDENT_IN_GROUP_REF; MCS_Z : IDENT_IN_GROUP_REF; MCS_A1 : IDENT_IN_GROUP_REF; MCS_A2 : IDENT_IN_GROUP_REF; MCS_A3 : IDENT_IN_GROUP_REF; MCS_B1 : IDENT_IN_GROUP_REF; MCS_B2 : IDENT_IN_GROUP_REF; MCS_B3 : IDENT_IN_GROUP_REF; MCS_C1 : IDENT_IN_GROUP_REF; MCS_C2 : IDENT_IN_GROUP_REF; MCS_C3 : IDENT_IN_GROUP_REF; //new from TF5400 V3.1.10.1, only compatible with MC Group Coordinated Motion ADDAX1 : IDENT_IN_GROUP_REF; ADDAX2 : IDENT_IN_GROUP_REF; ADDAX3 : IDENT_IN_GROUP_REF; ADDAX4 : IDENT_IN_GROUP_REF; // new from TF5400 V3.2.27, only compatible with MC Group ADDAX5 : IDENT_IN_GROUP_REF; ADDAX6 : IDENT_IN_GROUP_REF; ADDAX7 : IDENT_IN_GROUP_REF; ADDAX8 : IDENT_IN_GROUP_REF; END_VAR Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.2.2 MC_CIRC_MODE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The circle mode determines which circle definition is used to program a circle. TYPE MC_CIRC_MODE : ( mc Circ Mode Invalid := 16#0000, mc Circ Mode Border := 16#2000, mc Circ Mode Center := 16#2001, mc Circ Mode Radius := 16#2002 ) END_TYPE mc Circ Mode Invalid Returns errors • This parameter is invalid and will lead to an error where a valid MC_CIRC_MODE argument is required. TF5410 Version: 2.7.0 95
## Page 96

PLC Libraries mc Circ Mode Border Start Point • The movement starts at the starting point “Start Point”. • This point is the endpoint of the preceding move command. End Point • The user configures the endpoint “End Point”. • The circular movement will end at this point. Aux Point • The user configures the auxiliary point "Aux Point". • The circular movement will pass through this point. Path Choice • The input parameter "Path Choice" and the data type "MC_CIRC_PATHCHOICE" are ignored. Applicability • The mode mc Circ Mode Border cannot be used to describe a full circle (i.e. "Start Point" equals "End Point"). This is due to the fact that in this the center point of the circle would be ambiguous. • The mode mc Circ Mode Border cannot be used to describe paths with more than one full rotation of the circle. 96 Version: 2.7.0 TF5410
## Page 97

PLC Libraries mc Circ Mode Center Start Point • The movement starts at the starting point “Start Point”. • This point is the endpoint of the preceding move command. End Point • The user configures the endpoint “End Point”. • The circular movement will end at this point. Aux Point • The user configures the auxiliary point "Aux Point". • For the circular movement this auxiliary point will act as the circle center point. • The center point is required to have the same distance from “Start Point” and “End Point”. If the distances differ only slightly, the center point will be adjusted. If the distances differ significantly, the circle description will not be accepted. Path Choice • There are usually two possible arcs of the circle that can be traversed from starting point "Start Point" to the endpoint "End Point". The “Path Choice” parameter makes the two unique. See MC_CIRC_PATHCHOICE for more information. Applicability • The mode mc Circ Mode Center cannot be used to describe a semicircle (i.e. an arc that traverses an angle of 180° or very close to that) or a full circle (i.e. "Start Point" equals "End Point"). This is due to the fact that in these cases starting point, center point and endpoint would be collinear and thus the plane in which the circle lies would be ambiguous. • The mode mc Circ Mode Center cannot be used to describe paths with more than one full rotation of the circle. TF5410 Version: 2.7.0 97
## Page 98

PLC Libraries mc Circ Mode Radius MC_CIRC_PATHCHOn ICE E Clockwise 1 4 Counterclockwise 3 2 1 2 3 4 Short segment 3 2 Long segment 4 1 S E=End Point S=Start Point Images • Four different arcs are distinguished by the orientation of the normal vector and the parameter “Path Choice”. Start Point • The movement starts at the starting point “Start Point”. • This point is the endpoint of the preceding move command. • The circle to be constructed and its plane contain the starting point. Aux Point • The user configures the parameter "Aux Point", which in this mode acts as the normal vector of the plane of the circle. Its length is taken as the radius of the circle. Normal Vector 98 Version: 2.7.0 TF5410
## Page 99

PLC Libraries End Point • The user configures the endpoint “End Point”. • The movement will end at this point. • MC group with pick-and-place only: If this point is outside the plane defined by “Start Point” and the normal vector, movement will follow a helix instead of a circle. Path Choice and • The right-hand rule is applied for all “Path Choice” values except resulting arc mc Circ Pathchoice Clockwise, which follows the left-hand rule. • mc Circ Pathchoice Counter Clockwise and mc Circ Pathchoice Short Segment describe an arc that covers an angle <= 180°, mc Circ Pathchoice Clockwise and mc Circ Pathchoice Long Segment describe an arc that covers an angle >= 180°. • Which of the 4 possible arcs with a given radius is chosen depends on the “Path Choice” argument and the orientation of the normal vector. See above table for more information. Applicability • The mode mc Circ Mode Radius can only be used to describe arcs that cover an angle < 360°. • The length of the normal vector (i.e. the radius of the circle) must be at least half the distance between starting point and endpoint. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or Tc3_Mc Coordinated Motion, CX (x64) Tc2_MC2 TF5400 Advanced Motion Pack V3.1.2.47 9.3.2.3 MC_CIRC_PATHCHOICE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The MC_CIRC_PATHCHOICE data type defines the direction of rotation of a circle if mc Circ Mode Center or mc Circ Mode Radius is selected from the enumeration MC_CIRC_MODE [} 95]. TYPE MC_CIRC_PATHCHOICE : ( mc Circ Pathchoice Clockwise := 16#3000, mc Circ Pathchoice Counter Clockwise := 16#3001, //new from TF5400 V3.1.10.1 mc Circ Pathchoice Short Segment := 16#3002, mc Circ Pathchoice Long Segment := 16#3003 ); END_TYPE Name Type Description mc Circ Pathchoice Clockwise INT represents the circle segment with an angle >180°. mc Circ Pathchoice Counter Clockwise INT represents the circle segment with an angle <180°. mc Circ Pathchoice Short Segment INT represents the circle segment with the smaller angle. mc Circ Pathchoice Long Segment INT represents the circle segment with the larger angle. TF5410 Version: 2.7.0 99
## Page 100

PLC Libraries 9.3.2.4 MC_PATH_DATA_REF MC_PATH_DATA_REF UDINT Filled Rows UDINT Occupied Buffer TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) MC_PATH_DATA_REF represents the path to be executed by MC_Move Path [} 88], whereby the number of entries is limited to 30. The path to be executed is written by MC_Move Linear Absolute Preparation [} 82], MC_Move Circular Absolute Preparation [} 84] and MC_Blocker Preparation [} 89]. It is initialized with a pointer to a user-defined buffer. Hereby the user can define the size of the path. The initialization has to be done during declaration. The path table is not reset at execution. To reset, the method Clear Path [} 101] must be called. Outputs VAR_OUTPUT Filled Rows : UDINT; Occupied Buffer : UDINT; END_VAR Name Type Description Filled Rows UDIN Number of path entries (e.g. path segments). T Occupied Buffer UDIN Occupied buffer size in byte. By analyzing this output the user can analyze if the T end of the defined buffer will be reached. Sample The sample below shows how to declare a path reference and how to reset an existing path. VAR buffer : ARRAY[1..4096] OF BYTE; Path : MC_PATH_DATA_REF(ADR(buffer), SIZEOF(buffer)); END_VAR //delete all segments of path table Path. Clear Path(); The data type MC_PATH_DATA_REF is part of the Motion Control (MC) library. Use the method Clear Path() to clear path information of type MC_PATH_DATA_REF and thus to reset an existing path. Use only Motion Control functions or Motion Control function blocks on the data type MC_PATH_DATA_REF. In particular, do not use any storage functions such as MEMCMP, MEMCPY, MEMSET or MEMMOVE with data type MC_PATH_DATA_REF. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 100 Version: 2.7.0 TF5410
## Page 101

PLC Libraries 9.3.2.4.1 Clear Path Clear Path TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The method Clear Path resets the path represented by MC_PATH_DATA_REF. The path table is not reset automatically at execution. 9.3.2.5 MC_TRANSITION_MODE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) The transition mode characterizes the way a segment transition is executed. TYPE MC_TRANSITION_MODE : ( mc Trans Mode None := 16#1000, mc Trans Mode Start Velocity := 16#1001, mc Trans Mode Constant Velocity := 16#1002, mc Trans Mode Corner Distance := 16#1003, mc Trans Mode Max Corner Deviation := 16#1004, mc Trans Mode Corner Distance Advanced := 16#100A ); END_TYPE The following table shows an overview of the implemented transition modes and the number of parameters that must be defined in Transition Parameter Count. Name Transition Parameter Count Description mc Trans Mode None No effect No blending mc Trans Mode Corner Distance 1 Transition parameters act as a tolerance sphere in which the path not compatible with MC Group may be left. with Pick-and-Place, available from TF5400 V3.1.10.1 mc Trans Mode Corner Distance Ad 2 Transition parameters act as a vanced tolerance sphere in which the path may be left. mc Trans Mode None No blending is executed. Stop at segment transition. mc Trans Mode Corner Distance Blending is executed between the segments. The transition parameters act as tolerance ball in which the programmed path is not followed. The parameter describes the radius on the previous and second segment at which the blending starts and ends. TF5410 Version: 2.7.0 101
## Page 102

PLC Libraries This mode is only compatible with MC Group Coordinated Motion. mc Trans Mode Corner Distance Advanced Blending is executed between the segments. The transition parameter act as tolerance ball in which the programmed path is not followed. The first parameter describes the radius on the previous segment at which the blending starts (r_in). The second parameter describes the radius on the following segment (r_out) which defines a position for which it is guaranteed that the blending is done. The parameter r_out is a maximum value. The blending can end before r_out is reached. Blending (r_in) with MC Group with Pick-and-Place is limited to 90 % of previous segment. r_out is not limited. r_in (N20) r_in (N30) N20 r_out r_out (N30) (N20) N30 N10 Recommended Transition Parameter Relation for Blending with MC Group with Pick- and-Place The graphics sketch a planar movement within two dimensional space. Let two axes be involved in this movement. Assuming that the involved axes exhibit similar dynamics r_out should measure at least 2 * r_in. Combinations of buffer mode and transition mode Buffer mode and transition mode are combined only when TF5420 is used. The following table shows the possible combinations of transition mode and buffer mode and their effect. 102 Version: 2.7.0 TF5410
## Page 103

PLC Libraries TM/PM mc Aborting mc Buffered mc Blending Previ- Others ous mc Trans Mode None The previous Stop at the end of Not permissible Not permissible command is the previous canceled command. The next immediately. A new command is then movement is started. executed. The velocity in transition is 0. This combination is only permitted for the first segment of a path. mc Trans Mode Corn Blending from the Not permissible Blending from the Not permissible er Distance active segment to last programmed the first segment of command to the new New from TF5400 the new command. command V3.1.10.1, only The intersection of compatible with the segments is MC Group defined by the Coordinated distance needed to Motion stop on the active segment. This combination is only permitted for the first segment of a path. mc Trans Mode Corn Blending from the Not permissible Blending from the Not permissible er Distance Advance active segment to last programmed d the first segment of command to the new the new command. command The intersection of the segments is defined by the distance needed to stop on the active segment. This combination is only permitted for the first segment of a path. Others Not permissible Not permissible Not permissible Not permissible Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.3.2.6 MC_COORD_REF TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion ( up to and including v3.2) Object Id that refers to a node connector. TF5410 Version: 2.7.0 103
## Page 104

PLC Libraries 9.4 Tc3_Mc3Definitions Structures and enumerations Name Description TF5420 Twin CAT 3 Motion Pick- and-Place TF5410 Twin- MC Group MC Group CAT 3 Motion with Pick- Coordi- Collision and-Place nated Mo- Avoidance tion MC_BUFFER_MODE Defines how successive travel commands are to be processed. [} 104] MC_COMPENSATION_T The value defines the compensation type. YPE [} 107] MC_DIRECTION [} 108] The value determines the direction of the movement. MC_SYNC_MODE The value defines the direction in which synchronization is to be [} 109] performed. MC_SYNC_STRATEGY Defines the synchronization profile of the slave axis. [} 109] 9.4.1 Datatypes 9.4.1.1 MC_BUFFER_MODE The data type MC_BUFFER_MODE is used to specify how successive travel commands are to be processed. At least two function blocks are required for buffer mode to have an effect. TYPE MC_BUFFER_MODE : ( mc Aborting := 16#0, mc Buffered := 16#1, mc Blending Low := 16#12, mc Blending Previous := 16#13, mc Blending Next := 16#14, mc Blending High := 16#15 ) UINT; END_TYPE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion Example: In the following example, a move command is used to move a group from position P to P and then to P . 0 1 2 The reference point for the different velocity profiles is always P . The mode specifies the velocity v or v at 1 1 2 this point. 104 Version: 2.7.0 TF5410
## Page 105

PLC Libraries Since the speed of the first command is lower than the second, the modes Blending Low/Blending Previous and Blending High/Blending Next have the same result. If the speed of the second command is lower than the first the modes Blending Low/Blending Next and Blending High/Blending Previous are equivalent. TF5410 Version: 2.7.0 105
## Page 106

PLC Libraries Combinations of buffer mode and transition mode Notice Buffer mode and transition mode are merely combined using TF5420. The following table shows possible combinations of transition mode and buffer mode and its effect. 106 Version: 2.7.0 TF5410
## Page 107

PLC Libraries TM/BM mc Aborting mc Buffered mc Blending Previ- Other ous mc Trans Mode None Previous command Stop at the end of Not allowed Not allowed is aborted previous command. immediately. New Subsequently next movement is started. command is Velocity in transition executed. is 0. This combination is only allowed for the 1st segment of a path. mc Trans Mode Corn Blending from active Not allowed Blending from last Not allowed er Distance segment to first programmed segment of new command to new new from V3.1.10.1, command. The command only compatible intersection point of with MC Group the segments is Coordinated defined by the Motion distance needed to stop on the active segment. This combination is only allowed for the 1st segment of a path. mc Trans Mode Corn Blending from active Not allowed Blending from last Not allowed er Distance Advance segment to first programmed d segment of new command to new command. The command intersection point of the segments is defined by the distance needed to stop on the active segment. This combination is only allowed for the 1st segment of a path. Other Not allowed Not allowed Not allowed Not allowed Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 9.4.1.2 MC_COMPENSATION_TYPE The data type MC_COMPENSATION_TYPE is used to specify which compensation type is to be used. TYPE MC_COMPENSATION_TYPE: ( mc Type Invalid Compensation := 16#0, mc Type Geo Compensation := 16#1 )UINT; END_TYPE TF5410 Version: 2.7.0 107
## Page 108

PLC Libraries TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Compensations TF5400 Advanced Motion Pack V3.1.6.07 9.4.1.3 MC_DIRECTION (* Defines the direction of the movement (e.g. for a modulo axis). *) TYPE MC_DIRECTION : ( mc Direction Non Modulo := 0, (* Position is interpreted as absolute position. *) mc Direction Positive := 1, (* Moves in positive direction. *) mc Direction Shortest Way := 2, (* The direction of movement depends on whether the positive direction of movement or the negative direction of movement is the shortest distance from the target position. *) mc Direction Negative := 3 (* Moves in negative direction. *) ) END_TYPE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion MC_DIRECTION is used to specify the direction of movement during modulo positioning. Modulo positioning is only applicable to periodic systems. For open systems such as open tracks, only the value mc Direction Non Modulo is accepted. mc Direction Non Modulo: The position is always interpreted as an absolute position. mc Direction Positive: Positive direction of movement mc Direction Negative: Negative direction of movement mc Direction Shortest Way: The direction of movement depends on whether the positive direction or the negative direction has the shortest distance to the target position. In combination with the Tc2_MC2 or Tc3_Mc3Definitions library it is possible that the data type cannot be resolved unambiguously (ambiguous use of name 'MC_Direction'). In this case the namespace must be specified when using the data type (Tc3_Mc3Planar Motion. MC_DIRECTION or Tc3_Mc3Definitions. MC_DIRECTION or Tc2_MC2. MC_DIRECTION). Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or Tc3_Mc Collision Avoidance, CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 108 Version: 2.7.0 TF5410
## Page 109

PLC Libraries 9.4.1.4 MC_SYNC_MODE (* Defines the direction of the synchronization position of modulo axes. *) TYPE MC_SYNC_MODE : ( mc Sync Mode Non Modulo := 0, (* Sync Slave Position is interpreted as absolute position. *) mc Sync Mode Positive := 1, (* Synchronizes in positive direction. *) mc Sync Mode Negative := 3 (* Synchronizes in negative direction. *) ) END_TYPE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion The value defines the direction in which synchronization is to be performed. The Sync Mode specification is only effective if a modulo coordinate system has been defined for the axis. This can be a closed XTS track or a closed CA group, for example. The value is ignored if there is only one mathematical solution for reaching the synchronous position. mc Sync Mode Non Modulo: The Slave Sync Position is always interpreted as an absolute position. mc Sync Mode Positive: The slave axis synchronizes itself in positive direction of movement. mc Sync Mode Negative: The slave axis synchronizes itself in negative direction of movement. Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4024.7 PC or Tc3_Mc Collision Avoidance, CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.10.1 9.4.1.5 MC_SYNC_STRATEGY The data type MC_SYNC_STRATEGY defines the synchronization profile of the slave for e.g. a MC_Gear In Pos CA command. TYPE MC_SYNC_STRATEGY : ( mc Sync Strategy Late := 16#1, mc Sync Strategy Slow := 16#2, mc Sync Strategy Early := 16#3 ) END_TYPE TF5410 TF5420 Twin CAT 3 Motion Collision Twin CAT 3 Motion Pick-and-Place Avoidance MC Group with Pick-and-Place MC Group Coordinated Motion Examples: The boundary conditions in the following examples are equal: • The master motion is equal. • The Master Start Distance is equal. • The distances (Master Sync Position – current master position) and (Slave Sync Position – current slave position) are in all three examples equal. • The slave dynamics are equal. • Configuration with one axis in the CA Group, one PTP axis as master. TF5410 Version: 2.7.0 109
## Page 110

PLC Libraries • A motion command is issued to the master. Example 1: mc Sync Strategy Late The slave starts the synchronization as late as possible and with full dynamics (according to the input values velocity, acceleration, deceleration, jerk). It reaches the Slave Sync Position just in time with the correct gear ratio. The user has to take care that the master does not accelerate once the slave signals Start Sync, since the synchronization profile is already planned with the maximal slave dynamics. The slave cannot violate its dynamic restrictions and therefore cannot compensate any master acceleration. This situation will result in an error at the function block. 1. Issue the command MC_Gear In Pos CA to the axis. The command becomes active while the master is still accelerating. ð The slave starts synchronizing as late as possible and with full dynamics, and reached the Slave Sync Position when the master reached the Master Sync Position (black x-Cursor). Example 2: mc Sync Stratey Slow The slave starts its synchronization in motion as soon as the master passes (Master Sync Position - Master Start Distance) in the right direction if a Master Start Dist was set, otherwise as soon as the function block is Active. The dynamics of the slave are reduced so that the slave reaches the Slave Sync Pos with the right gear factor just in time when the master reaches the Master Sync Pos. The slave can compensate for an acceleration of the master if Start Sync is also set, but only until the slave reaches its maximum dynamics. 1. Issue the command MC_Gear In Pos CA to the axis. The command becomes active while the master is still accelerating. ð The slave starts synchronizing as soon as MC_Gear In Pos CA is Active. The dynamics is reduced such that the slave reaches the Slave Sync Position at the same time the master reaches the Master Sync Position (black x-Cursor). A synchronization on a standing master can lead to a high load if mc Sync Strategy Slow is used. It is best to use mc Sync Strategy Early in this case. 110 Version: 2.7.0 TF5410
## Page 111

PLC Libraries Example 3: mc Sync Strategy Early The slave starts synchronization immediately (if a Master Start Distance is set: immediately after it was passed) and with full dynamics. The slave signals earlier In Sync than demanded by the Slave Sync Position, but it is still guaranteed that demanded offset between master and slave (Master Sync Position – Slave Sync Position) is reached with the correct gear ratio. This strategy can synchronize on a standing master and is best suited if the master velocity is not constant. The slave will constantly try to synchronize. If the boundary conditions do not allow the slave to be In Sync at the Slave Sync Position, this will not result in an error but the slave constantly tries to synchronize to the master. 1. Issue the command MC_Gear In Pos CA to the axis. The command becomes active while the master is still accelerating. ð The slave starts the synchronization as soon as MC_Gear In Pos CA is Active and with full dynamics. The slave is In Sync as soon as possible, but still reaches the Slave Sync Position at the same time the master reaches the Master Sync Position (black x-Cursor). TF5410 Version: 2.7.0 111
## Page 112

PLC Libraries Requirements Development environment Target platform PLC libraries to include Twin CAT V3.1.4018.26 PC or CX (x64) Tc3_Mc Coordinated Motion, Tc2_MC2 TF5400 Advanced Motion Pack V3.1.1.17 112 Version: 2.7.0 TF5410
## Page 113

Samples 10 Samples PTP Collision Avoidance XTS Demo 1 Download: https://infosys.beckhoff.com/content/1033/tf5410_tc3_collision_avoidance/Resources/ 1546301963.zip Description: Project for XTS Starterkit (closed rail (3000 mm) with 10 movers) that executes MC_Move Absolute CA [} 33] movements. XTS Demo 2 Download: https://infosys.beckhoff.com/content/1033/tf5410_tc3_collision_avoidance/Resources/ 1546304267.zip Description: Project for XTS Starterkit (closed rail (3000 mm) with 10 movers) that executes MC_Gear In Pos CA [} 41] movements. TF5410 Version: 2.7.0 113
## Page 114

Appendix 11 Appendix 11.1 Cyclic Group Interface The cyclic group interface provides the cyclical data exchange between PLC and a NC group object. The group interface contains the directions Nc To Plc [} 114] and Plc To Nc [} 115]. Both direction are divided in common and group specific data. AXES_GROUP_REF TYPE AXES_GROUP_REF : STRUCT Plc To Nc AT %Q* : CDT_PLCTOMC_GROUP; Nc To Plc AT %I* : CDT_MCTOPLC_GROUP; END_STRUCT END_TYPE Plc To Nc: Plc To Nc [} 115] is a data structure that is cyclically exchanged between PLC and NC. Via this data structure the MC function blocks communicate with the motion group and send control information from the PLC to the NC. This data structure is automatically placed in the output process image of the PLC and must be linked with the input process image of a motion group. Nc To Plc: Nc To Plc [} 114] is a data structure that is cyclically exchanged between PLC and NC. Via this data structure the MC function blocks communicate with the NC and receive status information from the NC. This data structure is automatically placed in the input process image of the PLC and must be linked in Twin CAT System Manager with the output process image of an NC axis. 11.1.1 Nc To Plc Data structure which is cyclically exchanged between NC and PLC. Some data is group-specific. Name Type Description Common Group OID OTCID Tc COM object ID (OID) of this group Group Type MC_GROUP_TYPE Type of group Group Status ST_Group Status Status information about the group State MC_GROUP_STATE State of the group, see Group State Diagram. Flags ST_Group Status Flags Additional status information Is Enable Requested BIT Defines whether enabling or disabling of a group is requested. All Axes Standing BIT Indicates whether all axes are physically stationary, i.e. the velocity and acceleration for all axes is zero, regardless of whether a motion command is active. In Position BIT Indicates whether the group is in position. Group Error Id UDINT Error code in the event of a group error Group Axes Count UDINT Number of axes that are currently part of this group (e.g. added via MC_Add Axis To Group). Act Override Factor LREAL Currently used override factor 114 Version: 2.7.0 TF5410
## Page 115

Appendix Name Type Description Path Velo LREAL Only MC Group Coordinated Motion: Absolute value of cartesian velocity on the path Invoke Id UDINT Only MC Group Coordinated Motion: Segment ID for analysis purposes Is In Blending Segment BIT Only MC Group Coordinated Motion: Indicates if a blending segment is active. Remaining Time Active Job LREAL Only MC Group Coordinated Motion: Remaining time of the current segment Remaining Cartesian Distance Active Job LREAL Only MC Group Coordinated Motion: Remaining distance for the current segment Active Blocker Id UDINT Only MC Group Coordinated Motion: Id of the active blocker. Remaining Time To Sync LREAL Only MC Group Coordinated Motion: Remaining time until the axis group is synchronized with the conveyor belt during conveyor tracking. Remaining Cartesian Time To Sync LREAL Only MC Group Coordinated Motion: Remaining distance until the axis group is synchronized with the conveyor belt during conveyor tracking. 11.1.2 Plc To Nc Data structure which is cyclically exchanged between PLC and NC. Name Type Description Common Override Factor LREAL Desired Override Factor (1.0 = 100%, Default Value is 1.0) 11.2 MC_LREAL/Special Input Values Data type MC_LREAL, is equivalent to data type LREAL. However, there exist a few additional values that have a special signification. Value Signification Example MC_DEFAULT The input is executed with default Acceleration, Deceleration, Jerk for value for this input. all motion commands TF5410 Version: 2.7.0 115
## Page 116

Appendix Value Signification Example MC_MAXIMUM The command is executed with Generally, from software version maximum value for this input. 3.1.4.4 on for specific motion commands the value MC_MAXIMUM can be assigned to the inputs Velocity, Acceleration, Deceleration and Jerk. For more detailed information refer to the particular documentation of the function block the input intended to be supplied with the MC_MAXIMUM value belongs to. MC_IGNORE The input is ignored. MC_Gear In Pos CA. Master Start Dist ance MC_INVALID The input must be set by the user, MC_Move Absolute CA. Position there exists no default or maximum value, nor can the input be ignored. 11.3 Modulo positioning The modulo positioning can be applied to closed linear axes as well as to rotary axes. Twin CAT does not distinguish between these types. A modulo axis has a consecutive absolute position in the range ±∞. The modulo position of the axis is simply a piece of additional information about the absolute axis position. Modulo positioning represents the required target position in a different way. As opposed to absolute positioning, in which the user clearly specifies the target, the absolute target position is formed from the following parameters in modulo positioning: • Modulo target position • Modulo Factor • Tolerance Window • Direction, see MC_DIRECTION [} 108] • (Additional Turns, see ST_Move Absolute CAOptions [} 49]) Modulo Factor The modulo positioning basically refers to an adjustable Modulo Factor, which is set in the Twin CAT Engineering. The axis and its use must be observed here, for example: • If a PTP axis is used, the Modulo Factor of the axis encoder applies; details in the Notes on the modulo positioning of a PTP axis. 116 Version: 2.7.0 TF5410
## Page 117

Appendix • If, for example, a mover is used on an XTS system in a CA group, the Rail Length set in the CA group applies. • If an XPlanar mover is used, its "C-axis" modulo can be positioned. Here, the Modulo Factor is set as "C coordinated modulus" in the Init parameters of the XPlanar mover. Modulo Tolerance Window The Modulo Tolerance Window defines a position window around the current modulo set position of the axis. The window width corresponds to twice the specified value (set position ± tolerance value) and is specified in the Twin CAT Engineering: • In the case of a PTP axis or an axis in a CA group, the Tolerance Window is defined in the axis encoder • In the case of the C-axis of an XPlanar mover, the Tolerance Window is defined in the Init parameters of the XPlanar mover. TF5410 Version: 2.7.0 117
## Page 118

Appendix The positioning of an axis is always referenced to its current actual position. Unintentional revolutions may be performed if the actual position and the target position are very close to each other, for example, if the actual position is minimally greater than the target position and Direction = mc Direction Positive was selected. This can occur in particular if the actual position is determined inaccurately (e.g. on account of incorrect positioning due to the axis stalling, or due to the finite resolution of the encoder). In order to avoid this, a tolerance window for modulo positioning can be set. If the distance between the start and target positions is less than or equal to the Tolerance Window, then the target position is driven to by the shortest route (as with Direction = mc Direction Shortest Way), i.e. also contrary to the direction specified. Examples • Modulo Factor = 100 • Tolerance Window = 1 Parameter Direction Absolute Target posi- Parameter Relative Absolute Modulo end Startposi- tion path end posi- position Additional tion tion Turns mc Direction Positive 110 10 0 0 110 10 mc Direction Positive 110.9 10 0 -0.9 110 10 118 Version: 2.7.0 TF5410
## Page 119

Appendix Parameter Direction Absolute Target posi- Parameter Relative Absolute Modulo end Startposi- tion path end posi- position Additional tion tion Turns mc Direction Positive 112 10 0 98 110 10 mc Direction Positive 95 10 0 15 110 10 mc Direction Positive 110 110 0 ERROR: INVALID TARGET POSITION mc Direction Positive 110 10 3 300 410 10 mc Direction Positive 110.9 10 3 299.1 410 10 mc Direction Positive 112 10 3 398 410 10 mc Direction Positive 95 10 3 315 410 10 mc Direction Positive 110 110 3 ERROR: INVALID TARGET POSITION mc Direction Negative 110 10 0 0 110 10 mc Direction Negative 109.9 10 0 0.1 110 10 mc Direction Negative 108 10 0 -98 10 10 mc Direction Negative 95 10 0 -85 10 10 mc Direction Negative 110 110 0 ERROR: INVALID TARGET POSITION mc Direction Negative 410 10 3 -300 110 10 mc Direction Negative 409.9 10 3 -299.9 110 10 mc Direction Negative 408 10 3 -398 10 10 mc Direction Negative 495 10 3 -385 10 10 mc Direction Negative 410 110 3 ERROR: INVALID TARGET POSITION mc Direction Shortest Way 440 50 0 10 450 50 mc Direction Shortest Way 440 10 0 -30 410 10 mc Direction Shortest Way 440 50 1 ERROR: INVALID ADDITIONAL TURN COUNT Further samples Further examples without the Additional Turns parameter can be found in the Notes on the modulo positioning of a PTP axis. TF5410 Version: 2.7.0 119
## Page 120

Trademark statements Beckhoff®, ATRO®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar® and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H.
## Page 121

More Information: www.beckhoff.com/TF5410 Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
