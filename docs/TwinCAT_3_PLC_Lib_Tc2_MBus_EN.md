---
title: "TE1000 Twin CAT 3"
product: "TwinCAT"
category: "PLC"
tags: ["CAT", "PLC", "TWIN"]
language: "EN"
document_type: "Library"
version: "1.8.0"
source_pdf: "https://download.beckhoff.com/download/Document/automation/twincat3/TwinCAT_3_PLC_Lib_Tc2_MBus_EN.pdf"
release_date: "2025-05-15"
---
Manual | EN TE1000 Twin CAT 3 | PLC Library: Tc2_MBus 2025-05-15 | Version: 1.8.0
## Page 3

Table of contents Table of contents 1 Foreword.................................................................................................................................................... 5 1.1 Notes on the documentation............................................................................................................. 5 1.2 For your safety.................................................................................................................................. 5 1.3 Notes on information security............................................................................................................ 7 2 Introduction............................................................................................................................................... 8 3 M-Bus......................................................................................................................................................... 9 3.1 Topology......................................................................................................................................... 10 3.2 Bulletin............................................................................................................................................ 10 3.2.1 Functionality of the function block.................................................................................... 10 3.2.2 Long set........................................................................................................................... 11 3.2.3 Primary address............................................................................................................... 11 3.2.4 Secondary address.......................................................................................................... 12 4 Programming........................................................................................................................................... 13 4.1 POUs............................................................................................................................................... 16 4.1.1 FB_MBUSKL6781............................................................................................................ 18 4.1.2 ABB overview................................................................................................................... 20 4.1.3 Actaris overview............................................................................................................... 22 4.1.4 Aquametro overview........................................................................................................ 27 4.1.5 Berg overview.................................................................................................................. 38 4.1.6 Brunata overview............................................................................................................. 43 4.1.7 Carlo Gavazzi overview................................................................................................... 46 4.1.8 Cynox............................................................................................................................... 48 4.1.9 Elster overview................................................................................................................. 51 4.1.10 elvaco overview................................................................................................................ 53 4.1.11 EMH overview.................................................................................................................. 56 4.1.12 EMU overview.................................................................................................................. 64 4.1.13 Engelmann overview........................................................................................................ 75 4.1.14 General device blocks...................................................................................................... 78 4.1.15 Gossen Metrawatt overview............................................................................................. 97 4.1.16 GWF overview.................................................................................................................. 99 4.1.17 Hydrometer overview..................................................................................................... 101 4.1.18 ista overview.................................................................................................................. 114 4.1.19 Itron................................................................................................................................ 122 4.1.20 Janitza overview............................................................................................................. 125 4.1.21 Kamstrup overview......................................................................................................... 129 4.1.22 Kundo overview.............................................................................................................. 143 4.1.23 Landis & Gyr overview................................................................................................... 150 4.1.24 Metrima overview........................................................................................................... 152 4.1.25 NZR overview................................................................................................................. 158 4.1.26 OPTEC overview............................................................................................................ 162 4.1.27 Relay overview............................................................................................................... 164 4.1.28 Saia-Burgess overview.................................................................................................. 176 4.1.29 Schlumberger overview.................................................................................................. 182 TE1000 Version: 1.8.0 3
## Page 4

Table of contents 4.1.30 Schneider Electric.......................................................................................................... 186 4.1.31 Sensus overview............................................................................................................ 190 4.1.32 Sontex overview............................................................................................................. 194 4.1.33 TIP.................................................................................................................................. 197 4.1.34 Zenner overview............................................................................................................. 201 4.1.35 Error codes..................................................................................................................... 207 4.2 DUTs............................................................................................................................................. 209 4.2.1 Enums............................................................................................................................ 209 4.2.2 Structures....................................................................................................................... 214 4.3 GVLs............................................................................................................................................. 219 4.3.1 Param............................................................................................................................. 219 4.4 Integration into Twin CAT............................................................................................................... 219 4.4.1 KL6781 with CX5120..................................................................................................... 219 5 Appendix................................................................................................................................................ 224 5.1 Support and Service...................................................................................................................... 224 4 Version: 1.8.0 TE1000
## Page 5

Foreword 1 Foreword 1.1 Notes on the documentation This description is intended exclusively for trained specialists in control and automation technology who are familiar with the applicable national standards. The documentation and the following notes and explanations must be complied with when installing and commissioning the components. The trained specialists must always use the current valid documentation. The trained specialists must ensure that the application and use of the products described is in line with all safety requirements, including all relevant laws, regulations, guidelines, and standards. Disclaimer The documentation has been compiled with care. The products described are, however, constantly under development. We reserve the right to revise and change the documentation at any time and without notice. Claims to modify products that have already been supplied may not be made on the basis of the data, diagrams, and descriptions in this documentation. Trademarks Beckhoff®, ATRO® , Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, MX-System®, Safety over Ether CAT®, TC/BSD®, Twin CAT®, Twin CAT/BSD®, Twin SAFE®, XFC®, XPlanar®, and XTS® are registered and licensed trademarks of Beckhoff Automation Gmb H. If third parties make use of the designations or trademarks contained in this publication for their own purposes, this could infringe upon the rights of the owners of the said designations. Ether CAT® is a registered trademark and patented technology, licensed by Beckhoff Automation Gmb H, Germany. Copyright © Beckhoff Automation Gmb H & Co. KG, Germany. The distribution and reproduction of this document, as well as the use and communication of its contents without express authorization, are prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event that a patent, utility model, or design are registered. Third-party trademarks Trademarks of third parties may be used in this documentation. You can find the trademark notices here: https://www.beckhoff.com/trademarks. 1.2 For your safety Safety regulations Read the following explanations for your safety. Always observe and follow product-specific safety instructions, which you may find at the appropriate places in this document. Exclusion of liability All the components are supplied in particular hardware and software configurations which are appropriate for the application. Modifications to hardware or software configurations other than those described in the documentation are not permitted, and nullify the liability of Beckhoff Automation Gmb H & Co. KG. TE1000 Version: 1.8.0 5
## Page 6

Foreword Personnel qualification This description is only intended for trained specialists in control, automation, and drive technology who are familiar with the applicable national standards. Signal words The signal words used in the documentation are classified below. In order to prevent injury and damage to persons and property, read and follow the safety and warning notices. Personal injury warnings DANGER Hazard with high risk of death or serious injury. WARNING Hazard with medium risk of death or serious injury. CAUTION There is a low-risk hazard that could result in medium or minor injury. Warning of damage to property or environment NOTICE The environment, equipment, or data may be damaged. Information on handling the product This information includes, for example: recommendations for action, assistance or further information on the product. 6 Version: 1.8.0 TE1000
## Page 7

Foreword 1.3 Notes on information security The products of Beckhoff Automation Gmb H & Co. KG (Beckhoff), insofar as they can be accessed online, are equipped with security functions that support the secure operation of plants, systems, machines and networks. Despite the security functions, the creation, implementation and constant updating of a holistic security concept for the operation are necessary to protect the respective plant, system, machine and networks against cyber threats. The products sold by Beckhoff are only part of the overall security concept. The customer is responsible for preventing unauthorized access by third parties to its equipment, systems, machines and networks. The latter should be connected to the corporate network or the Internet only if appropriate protective measures have been set up. In addition, the recommendations from Beckhoff regarding appropriate protective measures should be observed. Further information regarding information security and industrial security can be found in our https://www.beckhoff.com/secguide. Beckhoff products and solutions undergo continuous further development. This also applies to security functions. In light of this continuous further development, Beckhoff expressly recommends that the products are kept up to date at all times and that updates are installed for the products once they have been made available. Using outdated or unsupported product versions can increase the risk of cyber threats. To stay informed about information security for Beckhoff products, subscribe to the RSS feed at https:// www.beckhoff.com/secinfo. TE1000 Version: 1.8.0 7
## Page 8

Introduction 2 Introduction The Tc2_MBus library is a comprehensive Twin CAT PLC library for reading M-Bus devices. The application of this PLC library significantly simplifies the engineering in these areas of building technical equipment. The function blocks are object-oriented and characterized by a self-contained, more or less complex function. The input parameters form the interface to the user. The parameters can be used to adapt the function block to its specific task within the associated system. Thanks to strongly object-oriented encapsulation of complex system functions within the function blocks, comprehensive system programs can be set up with a few function blocks. The blocks are linked to each other via a small number of PLC variables. The status of all objects is indicated through a large number of different output variables at the function blocks. The simplifies the connection of HMI and visualization systems. These features offer the following benefits for system programmers during system setup and for system operators during operation: • Faster creation of system programs. • Faster system parameterization and commissioning. • Guarantee of a very large range of system functions at all times. • Improved readability of programs (prerequisite for long-term maintainability and expandability of the systems) • Improved reusability of templates for systems or system components • Easier familiarization of personnel. • Easier extension of existing systems. • Programs are easier to document. The user of this library requires basic knowledge of the following: • Twin CAT XAE • PC and network knowledge • Structure and properties of the Beckhoff Embedded PC and its Bus Terminal system • Technology of M-Bus devices • Relevant safety regulations for building technical equipment This software library is intended for building automation system partners of Beckhoff Automation Gmb H & Co. KG. The system partners operate in the field of building automation and are concerned with the installation, commissioning, expansion, maintenance and service of measurement, control and regulating systems for the technical equipment of buildings. The Tc2_MBus library is usable on all hardware platforms that support Twin CAT 3.1 or higher. Hardware documentation in the Beckhoff information system: https://infosys.beckhoff.com/content/1033/kl6781/index.html Preferred format: LReal. M-Bus devices may supply very large values (the DWord value range may be exceeded). They are therefore output in string format. Conversions to Real format may lead to inaccuracies/invalid values. Conversions to LReal format are therefore preferable. 8 Version: 1.8.0 TE1000
## Page 9

M-Bus 3 M-Bus M-Bus = metering bus The M-Bus is a fieldbus for the recording consumption data (e.g. energy meters). Further details about M- Bus can be found under www.m-bus.com. The M-Bus is European standard and is described in the EN1434 standard. The data are sent serially from a slave (measuring device) to a master (level converter with PC). Master and slave are connected via a two-wire cable that is protected against polarity reversal. With primary addressing up to 250 slaves can be connected in star, strand or tree topologies. Ring structures are not permitted. Devices from different manufacturers can be operated on the same bus. The master controls the communication on the bus by requesting data from the slaves. The slaves can respond with a fixed or variable data structure. The M-Bus library only evaluates data with variable data structure (low byte first). The slaves do not communicate with each other. The data have to be requested sequentially from the slaves. TE1000 Version: 1.8.0 9
## Page 10

M-Bus 3.1 Topology Star, line and tree topology Ring topology Ring topology not supported Ring topology is possible for M-Bus, but not recommended and therefore also not supported by Beckhoff. 3.2 Bulletin 3.2.1 Functionality of the function block Three methods for reading M-Bus meters are offered: 1. The variable t Min Send Time> t#0s of the meter block is used to read the meter automatically once the time has elapsed. The variable is internally preset to t#2s. 2. A positive edge of the variable b Start of the meter block triggers one reading of the meter. 3. A positive edge of the variables b Start of the block FB_MBUS_KL6781() [} 18] triggers one reading of all meters. If several meter blocks receive a start command at the same time, they are started in the order in which they are called in the PLC. The variable b Ready becomes TRUE for one cycle once the block has received the data. b Error becomes TRUE if an error has occurred. This error is described with e Error [} 210]. To read the meter after a start/ restart of the PLC, set the variable b Read Init to TRUE; otherwise to FALSE. Internally this variable is preset to TRUE. e Baudrate: This variable is internally preset to 2400 baud. To read the meter with this baud rate (2400 baud), this variable does not have to be set explicitly. If the baud rate is changed, the KL6781 is adjusted automatically. This makes it possible to read meters with different baud rates in an M-Bus network. The baud rate of the meters is not changed. They must be able to operate with the baud rate specified here. Some meters operate with automatic baud rate detection. For further information please refer to the user guide of the meter. b SND_NKE: Internally this variable is preset to TRUE. SND_NKE is a special telegram to the slave. This telegram triggers an initialization of the receiver. This telegram is important for meters, which send several telegrams. These meters respond to a SND_NKE with the first telegram. If TRUE, the SND_NK telegram is sent before the actual query. If FALSE, the SND_NKE telegram is not sent. b Disabled =TRUE can be used to interrupt processing of the block. If a meter query is in progress, it is completed. 10 Version: 1.8.0 TE1000
## Page 11

M-Bus 3.2.2 Long set Data is sent to the M-bus device with a long set. The long set is composed of a maximum of 255 bytes and is transferred to the counter with the FB_MBUS_General_Send() [} 90] block. Structure of the protocol: Byte Long set Description Assignment in the "FB_MBUS_Gen- eral_Send" block 1 Start character 68hex Is added in the block 2 L field Length of user data plus 3 Is added in the block 3 L field Length of user data plus 3 Is added in the block 4 Start character 68hex Is added in the block 5 C field Function field Is transferred to the "by C_Field" input variable 6 A field Primary address of the M- Is transferred to the Bus device "usi Address" input variable 7 CI Field Identifier field Is transferred to the "by CI_Field" input variable 8..x User data (0..240) User data Are transferred to the ‘arr Data’ input variable x+1 Checksum Checksum Is added in the block x+2 Stop character 16hex Is added in the block Only the bytes marked in bold letters need to be transferred to the block. The user data in the ‘arr Data’ array must contain ‘16hex’ as the last character. It is important to ensure that the subsequent bytes are empty. Sample: Changing the primary address at address 14, old address is 0 (*Transfer of user data*) fb Send.arr Data[0]:=16#01; (*DIF / Data format 8 -bit integer*) fb Send.arr Data[1]:=16#7A; (*VIF / Change address*) fb Send.arr Data[2]:=14; (*New address = 14*) fb Send.arr Data[3]:=16#16; (*Do not transfer stop character/checksum; they will be calculated in the block*) fb Send.by C_Field:=16#53; (*C field*) fb Send.by CI_Field:=16#51; (*CI field*) fb Send.usi Address:=0; (*Old address*) fb Send(i Com Id:=1, (*Block call*) b Start:=b Start, b Init:=TRUE); Sending is started with the ‘b Start’ variable. 3.2.3 Primary address The counters are addressed via the primary address. This can be set at the device, via manufacturer software, or with the function blocks FB_MBUS_Change Adr() [} 79] and FB_MBUS_General_send() [} 90]. All meters on a level converter/serial interface must have a unique address (0..250). Address 0-250: Addresses of the devices Address 251: not used at present TE1000 Version: 1.8.0 11
## Page 12

M-Bus Address 252: not used at present Address 253: Use of secondary addressing Address 254: Send to all M-bus devices with response (E5 hexadecimal). If several devices are connected, all will answer. This leads to data collisions. Therefore, this address should only be used if only one device is connected. Address 255: Send to all M-Bus devices without response. 3.2.4 Secondary address Like the primary address, the secondary address is used to identify the terminal device. Like the primary address, the secondary address is used to identify the terminal device. The identification number alone can be used to form 100 million different values. In addition, it is not necessary to allocate primary addresses. A secondary address has the following structure, according to the M-Bus standard: Ident no.: 4 bytes / 8-digit BCD device ID data Manufacturer code: 2 bytes / manufacturer code Version: 1 byte / generation number of the manufacturer Medium: 1 byte / medium To use secondary addressing, set the primary address to 253. The secondary address is transferred to the function block via the structure "st Sec Adr" (ST_MBUS_Sec Adr [} 217]). The manufacturer code, version and medium are internally preset to 16#FF, so that these values do not have to be specified explicitly. Sample calls: st Sec Adr1.udi Id Number := 16#12345678; st Sec Adr1.ui Manufacturer := 16#FFFF; st Sec Adr1.usi Medium := 16#FF; st Sec Adr1.usi Version := 16#FF; fbmeter( usi Address := 253, st Sec Adr.udi Id Number := st Sec Adr1, st Com := st Com KL6781_1); or fbmeter.st Sec Adr.udi Id Number := 16#12345678; fbmeter( usi Address := 253, st Com := st Com KL6781_1); 12 Version: 1.8.0 TE1000
## Page 13

Programming 4 Programming The vendor-specific function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General() [} 80], FB_MBUS_General_Ext() [} 84] or FB_MBUS_General_Param() [} 88] from the "General [} 78]" folder should be used. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send() [} 90] can be used. Manufacturer Type Device Block general Communication with FB_MBUSKL6781 [} 18] KL6781 General [} 78] Electricity meter all electricity meters FB_MBUS_General_Electricity [} 82] Heat meter all heat meters FB_MBUS_General_Heat [} 86] Water meter all water meters FB_MBUS_General_Water [} 91] Raw data of the first all FB_MBUS_Raw Data [} 94] telegram max. 40 values from all FB_MBUS_General [} 80] the first telegram all telegrams for all all FB_MBUS_General_Ext [} 84] values values parameterisable all FB_MBUS_General_Param [} 88] universal send blocks all FB_MBUS_General_Send [} 90] scan block all FB_MBUS_Scan [} 96] Change primary all FB_MBUS_Change Adr [} 79] address ABB [} 20] Electricity meter DELTAplus DZ+ FB_MBUS_ABB_DZ [} 20] Actaris [} 22] Heat meter CF-Echo II FB_MBUS_ACW_CF [} 23] Arithmetic unit CF-51 FB_MBUS_ACW_CF [} 23] Arithmetic unit CF-55 FB_MBUS_ACW_CF [} 23] Water meter MB +M FB_MBUS_ACW_Plus M [} 25] Aquametro [} 27] Water meter SAPHIR FB_MBUS_AMT_SAPHIR [} 36] Heat meter CALEC MB FB_MBUS_AMT_CALEC [} 32] Heat meter CALEC ST, version C4 FB_MBUS_AMT_CALEC_STC4 [} 34] Heat meter AMTRON FB_MBUS_AMT_AMTRON [} 30] Pulse collector AMBUS FB_MBUS_AMT_AMBUS [} 28] Heat meter AMTRON SONIC D FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] Berg [} 38] Electricity meter DZ+ FB_MBUS_BEC_DZ [} 41] Electricity meter DCMi FB_MBUS_BEC_DCMi [} 39] Brunata [} 43] Heat meter HGQ / HGS FB_MBUS_BHG_HGx [} 44] Heat meter Optuna H (775) FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] Carlo Gavazzi [} 46] Energy meter EM24 FB_MBUS_GAV_EM24 [} 46] Cynox [} 48] Pulse counter MCount2C FB_MBUS_CYN_MCount2C [} 49] Elster [} 51] Gas meter Encoder Z6 FB_MBUS_ELS_Encoder Z6 [} 51] elvaco [} 53] Temperature and CMa10 & CMa20 FB_MBUS_ELV_CMa10_20 [} 54] humidity sensors TE1000 Version: 1.8.0 13
## Page 14

Programming Manufacturer Type Device Block EMH [} 56] Electricity meter DIZ FB_MBUS_EMH_DIZ [} 56] Electricity meter EIZ-E FB_MBUS_EMH_EIZE [} 58] Electricity meter EIZ-G FB_MBUS_EMH_EIZG [} 60] Electricity meter MIZ FB_MBUS_EMH_MIZ [} 62] EMU [} 64] Electricity meter EMU32x7 FB_MBUS_EMU_32x7 [} 65] Electricity meter EMU32x7 FB_MBUS_EMU_32x7_Option8 [} 68] Electricity meter Allrounder 3/5 FB_MBUS_EMU_3_5_Allrounder [} 71] Electricity meter DHZ 5/63 FB_MBUS_EMU_DHZ_5_63 [} 74] Engelmann [} 75] Heat meter Sensostar 2C FB_MBUS_EFF_Senso Star2C [} 76] Gossen Metrawatt Electricity meter U128x FB_MBUS_GMC_Electricity [} 97] [} 97] Electricity meter U138x FB_MBUS_GMC_Electricity [} 97] GWF [} 99] Water meter FB_MBUS_GWF_Coder [} 100] Gas meter S1 FB_MBUS_GWF_Coder [} 100] Gas meter Z1 FB_MBUS_GWF_Coder [} 100] Hydrometer [} 101] 2 pulse inputs HYDRO-PORT Pulse FB_MBUS_HYD_Port Pulse [} 106] 2 analog inputs 1 HYDRO-PORT Analog FB_MBUS_HYD_Port Analog [} 104] temperature sensor Water meter Flypper FB_MBUS_HYD_Flypper [} 102] Heat meter Sharky 773 FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] Heat meter Sharky 775 FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] ista [} 114] Water meter domaqua® m FB_MBUS_IST_Istameter [} 114] Water meter istameter® m FB_MBUS_IST_Istameter [} 114] Water meter istameter III FB_MBUS_IST_Istameter III [} 116] Pulse counter pulsonic II FB_MBUS_IST_Pulsonic II [} 118] Heat meter sensonic II FB_MBUS_IST_Sensonic II [} 120] Itron [} 122] Energy meter Integral-V-Ultra Lite FB_MBUS_ITR_Integral VUltra Lite [} 123] Janitza [} 125] Electricity meter UMG96S FB_MBUS_JAN_UMG96S [} 126] Kamstrup [} 129] Electricity meter Kamstrup 162 FB_MBUS_KAM_Kamstrup E [} 129] Electricity meter Kamstrup 351 FB_MBUS_KAM_Kamstrup E [} 129] Electricity meter Kamstrup 382 FB_MBUS_KAM_Kamstrup E [} 129] Heat/cold meter Maxical III FB_MBUS_KAM_Maxical_III [} 131] Heat/cold meter Multical 401 FB_MBUS_KAM_Multical [} 133] Heat/cold meter Multical 402 FB_MBUS_KAM_Multical402 [} 136] Water meter Multical 41 FB_MBUS_KAM_Multical41 [} 139] Heat/cold meter Multical 601 FB_MBUS_KAM_Multical601 [} 141] KUNDO [} 143] Heat/cold meter Compact WMZ G20 FB_MBUS_KST_G20 [} 144] Heat/cold meter Compact WMZ G21 FB_MBUS_KST_G20 [} 144] 14 Version: 1.8.0 TE1000
## Page 15

Programming Manufacturer Type Device Block External M-Bus module him1s FB_MBUS_KST_him1 [} 146] External M-Bus module him1plus FB_MBUS_KST_him1 [} 146] Pulse input him1plus FB_MBUS_KST_him1Puls [} 148] Landis & Gyr [} 150] Heat/cold meter ULTRAHEAT 2WR5 FB_MBUS_LUG_Heat [} 150] Heat/cold meter ULTRAHEAT 2WR6 FB_MBUS_LUG_Heat [} 150] Heat/cold meter ULTRAHEAT UH50 FB_MBUS_LUG_Heat [} 150] Metrima [} 152] Heat meter F22 (standard values) FB_MBUS_SVM_F22 [} 153] Heat meter F22 (with additional FB_MBUS_SVM_F22_Ext [} 155] output values) NZR [} 158] Pulse memory module IC-M2 FB_MBUS_NZR_ICM2 [} 158] Pulse memory module IC-M2C FB_MBUS_NZR_ICM2 [} 158] Water meter Modularis 2 FB_MBUS_NZR_Modularis2 [} 160] OPTEC [} 162] Electricity meter ECS Type 2 FB_MBUS_OPT_ECSType2 [} 162] Relay [} 164] 1-4 analog inputs An Di 1-4 FB_MBUS_REL_An Di [} 165] 4 digital inputs Pad In 4 FB_MBUS_REL_Pad In4 [} 167] 1-way pulse adapter Pad Puls M1 FB_MBUS_REL_Pad Puls M1 [} 169] 1-way pulse adapter Pad Puls M1C FB_MBUS_REL_Pad Puls M1 [} 169] 2-way pulse adapter Pad Puls M2 FB_MBUS_REL_Pad Puls M2 [} 171] 2-way pulse adapter Pad Puls M2C FB_MBUS_REL_Pad Puls M2 [} 171] 4-way pulse adapter Pad Puls M4 FB_MBUS_REL_Pad Puls M4 [} 174] 4-way pulse adapter Pad Puls M4L FB_MBUS_REL_Pad Puls M4 [} 174] Saia-Burgess [} 176] Electricity meter ALD1 FB_MBUS_SBC_ALD1 [} 177] Electricity meter ALE3 FB_MBUS_SBC_ALE3 [} 179] Electricity meter AWD3 FB_MBUS_SBC_ALE3 [} 179] Schlumberger [} 182] Heat meter Integral-Mk Ma XX FB_MBUS_SLB_MK_Ma XX [} 184] Heat meter CF Echo I FB_MBUS_SLB_CFEcho I [} 182] Schneider Electric Electricity meter i EM3135 FB_MBUS_SEC_i EM3135 [} 187] [} 186] Sensus [} 190] Heat/cold meter Pollu Stat E FB_MBUS_SEN_Pollu [} 190] Heat/cold meter Pollu Therm FB_MBUS_SEN_Pollu [} 190] Heat/cold meter Pollu Com E FB_MBUS_SEN_Pollu [} 190] Water meter FB_MBUS_SEN_Water [} 192] Sontex [} 194] Heat/cold meter Supercal 531 FB_MBUS_SON_Supercal531 [} 195] TIP [} 197] Electricity meter SINUS 85 M FB_MBUS_TIP_SINUS85M [} 198] Zenner [} 201] Arithmetic unit multidata WR3 FB_MBUS_ZRM_multidata WR3 [} 202] Heat meter zelsius ZR FB_MBUS_ZRM_zelsius ZR [} 205] TE1000 Version: 1.8.0 15
## Page 16

Programming 4.1 POUs The vendor-specific function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General() [} 80], FB_MBUS_General_Ext() [} 84] or FB_MBUS_General_Param() [} 88] from the "General [} 78]" folder should be used. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send() [} 90] can be used. Vendor Type Device Function block General Communication with FB_MBUSKL6781 [} 18] KL6781 General [} 78] Electricity meter all electricity meters FB_MBUS_General_Electricity [} 82] Heat meter all heat meters FB_MBUS_General_Heat [} 86] Water meter all water meters FB_MBUS_General_Water [} 91] Raw data of the first all FB_MBUS_Raw Data [} 94] telegram max. 40 values from all FB_MBUS_General [} 80] the first telegram all telegrams for all all FB_MBUS_General_Ext [} 84] values Values all FB_MBUS_General_Param [} 88] parameterizable Universal send blocks all FB_MBUS_General_Send [} 90] Scan function block all FB_MBUS_Scan [} 96] Change primary all FB_MBUS_Change Adr [} 79] address ABB [} 20] Electricity meter DELTAplus DZ+ FB_MBUS_ABB_DZ [} 20] Actaris [} 22] Heat meter CF-Echo II FB_MBUS_ACW_CF [} 23] Arithmetic unit CF-51 FB_MBUS_ACW_CF [} 23] Arithmetic unit CF-55 FB_MBUS_ACW_CF [} 23] Water meter MB +M FB_MBUS_ACW_Plus M [} 25] Aquametro [} 27] Water meter SAPHIR FB_MBUS_AMT_SAPHIR [} 36] Heat meter CALEC MB FB_MBUS_AMT_CALEC [} 32] Heat meter CALEC ST, version FB_MBUS_AMT_CALEC_STC4 [} 34] C4 Heat meter AMTRON FB_MBUS_AMT_AMTRON [} 30] Pulse collector AMBUS FB_MBUS_AMT_AMBUS [} 28] Heat meter AMTRON SONIC D FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] Berg [} 38] Electricity meter DZ+ FB_MBUS_BEC_DZ [} 41] Electricity meter DCMi FB_MBUS_BEC_DCMi [} 39] Brunata [} 43] Heat meter HGQ / HGS FB_MBUS_BHG_HGx [} 44] Heat meter Optuna H (775) FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] Carlo Gavazzi [} 46] Energy meter EM24 FB_MBUS_GAV_EM24 [} 46] Cynox [} 48] Pulse counter MCount2C FB_MBUS_CYN_MCount2C [} 49] Elster [} 51] Gas meter Encoder Z6 FB_MBUS_ELS_Encoder Z6 [} 51] elvaco [} 53] Temperature and CMa10 & CMa20 FB_MBUS_ELV_CMa10_20 [} 54] humidity sensors EMH [} 56] Electricity meter DIZ FB_MBUS_EMH_DIZ [} 56] 16 Version: 1.8.0 TE1000
## Page 17

Programming Vendor Type Device Function block Electricity meter EIZ-E FB_MBUS_EMH_EIZE [} 58] Electricity meter EIZ-G FB_MBUS_EMH_EIZG [} 60] Electricity meter MIZ FB_MBUS_EMH_MIZ [} 62] EMU [} 64] Electricity meter EMU32x7 FB_MBUS_EMU_32x7 [} 65] Electricity meter EMU32x7 FB_MBUS_EMU_32x7_Option8 [} 68] Electricity meter Allrounder 3/5 FB_MBUS_EMU_3_5_Allrounder [} 71] Electricity meter DHZ 5/63 FB_MBUS_EMU_DHZ_5_63 [} 74] Engelmann [} 75] Heat meter Sensostar 2C FB_MBUS_EFF_Senso Star2C [} 76] Gossen Metrawatt Electricity meter U128x FB_MBUS_GMC_Electricity [} 97] [} 97] Electricity meter U138x FB_MBUS_GMC_Electricity [} 97] GWF [} 99] Water meter FB_MBUS_GWF_Coder [} 100] Gas meter S1 FB_MBUS_GWF_Coder [} 100] Gas meter Z1 FB_MBUS_GWF_Coder [} 100] Hydrometer [} 101] 2 pulse inputs HYDRO-PORT Pulse FB_MBUS_HYD_Port Pulse [} 106] 2 analog inputs 1 HYDRO-PORT FB_MBUS_HYD_Port Analog [} 104] temperature sensor Analog Water meter Flypper FB_MBUS_HYD_Flypper [} 102] Heat meter Sharky 773 FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] Heat meter Sharky 775 FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] ista [} 114] Water meter domaqua® m FB_MBUS_IST_Istameter [} 114] Water meter istameter® m FB_MBUS_IST_Istameter [} 114] Water meter istameter III FB_MBUS_IST_Istameter III [} 116] Pulse counter pulsonic II FB_MBUS_IST_Pulsonic II [} 118] Heat meter sensonic II FB_MBUS_IST_Sensonic II [} 120] Itron [} 122] Energy meter Integral-V Ultra Lite FB_MBUS_ITR_Integral VUltra Lite [} 123] Janitza [} 125] Electricity meter UMG96S FB_MBUS_JAN_UMG96S [} 126] Kamstrup [} 129] Electricity meter Kamstrup 162 FB_MBUS_KAM_Kamstrup E [} 129] Electricity meter Kamstrup 351 FB_MBUS_KAM_Kamstrup E [} 129] Electricity meter Kamstrup 382 FB_MBUS_KAM_Kamstrup E [} 129] Heat/cold meter Maxical III FB_MBUS_KAM_Maxical_III [} 131] Heat/cold meter Multical 401 FB_MBUS_KAM_Multical [} 133] Heat/cold meter Multical 402 FB_MBUS_KAM_Multical402 [} 136] Water meter Multical 41 FB_MBUS_KAM_Multical41 [} 139] Heat/cold meter Multical 601 FB_MBUS_KAM_Multical601 [} 141] KUNDO [} 143] Heat/cold meter Compact WMZ G20 FB_MBUS_KST_G20 [} 144] Heat/cold meter Compact WMZ G21 FB_MBUS_KST_G20 [} 144] External M-Bus him1s FB_MBUS_KST_him1 [} 146] module External M-Bus him1plus FB_MBUS_KST_him1 [} 146] module TE1000 Version: 1.8.0 17
## Page 18

Programming Vendor Type Device Function block Pulse input him1plus FB_MBUS_KST_him1Puls [} 148] Landis & Gyr [} 150] Heat/cold meter ULTRAHEAT 2WR5 FB_MBUS_LUG_Heat [} 150] Heat/cold meter ULTRAHEAT 2WR6 FB_MBUS_LUG_Heat [} 150] Heat/cold meter ULTRAHEAT UH50 FB_MBUS_LUG_Heat [} 150] Metrima [} 152] Heat meter F22 (default values) FB_MBUS_SVM_F22 [} 153] F22 (with additional FB_MBUS_SVM_F22_Ext [} 155] output values) NZR [} 158] Pulse memory module IC-M2 FB_MBUS_NZR_ICM2 [} 158] Pulse memory module IC-M2C FB_MBUS_NZR_ICM2 [} 158] Water meter Modularis 2 FB_MBUS_NZR_Modularis2 [} 160] OPTEC [} 162] Electricity meter ECS Type 2 FB_MBUS_OPT_ECSType2 [} 162] Relay [} 164] 1-4 analog inputs An Di 1-4 FB_MBUS_REL_An Di [} 165] 4 digital inputs Pad In 4 FB_MBUS_REL_Pad In4 [} 167] 1-way pulse adapter Pad Puls M1 FB_MBUS_REL_Pad Puls M1 [} 169] 1-way pulse adapter Pad Puls M1C FB_MBUS_REL_Pad Puls M1 [} 169] 2-way pulse adapter Pad Puls M2 FB_MBUS_REL_Pad Puls M2 [} 171] 2-way pulse adapter Pad Puls M2C FB_MBUS_REL_Pad Puls M2 [} 171] 4-way pulse adapter Pad Puls M4 FB_MBUS_REL_Pad Puls M4 [} 174] 4-way pulse adapter Pad Puls M4L FB_MBUS_REL_Pad Puls M4 [} 174] Saia-Burgess [} 176] Electricity meter ALD1 FB_MBUS_SBC_ALD1 [} 177] Electricity meter ALE3 FB_MBUS_SBC_ALE3 [} 179] Electricity meter AWD3 FB_MBUS_SBC_ALE3 [} 179] Schlumberger [} 182] Heat meter Integral-Mk Ma XX FB_MBUS_SLB_MK_Ma XX [} 184] Heat meter CF Echo I FB_MBUS_SLB_CFEcho I [} 182] Schneider Electric Electricity meter i EM3135 FB_MBUS_SEC_i EM3135 [} 187] [} 186] Sensus [} 190] Heat/cold meter Pollu Stat E FB_MBUS_SEN_Pollu [} 190] Heat/cold meter Pollu Therm FB_MBUS_SEN_Pollu [} 190] Heat/cold meter Pollu Com E FB_MBUS_SEN_Pollu [} 190] Water meter FB_MBUS_SEN_Water [} 192] Sontex [} 194] Heat/cold meter Supercal 531 FB_MBUS_SON_Supercal531 [} 195] TIP [} 197] Electricity meter SINUS 85 M FB_MBUS_TIP_SINUS85M [} 198] Zenner [} 201] Arithmetic unit multidata WR3 FB_MBUS_ZRM_multidata WR3 [} 202] Heat meter zelsius ZR FB_MBUS_ZRM_zelsius ZR [} 205] 4.1.1 FB_MBUSKL6781 The function block FB_MBUSKL6781 is used to read M-Bus devices via the KL6781 Bus Terminal. 18 Version: 1.8.0 TE1000
## Page 19

Programming The function block can only be executed together with at least one meter function block. An instance of this function block required for each KL6781 terminal. The function block requires a task time of maximum 10 ms at 2400 baud. If higher task times are required, this function block must be outsourced to a fast task. Inputs VAR_INPUT usi Retries : USINT; b Start : BOOL; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Retries USINT Number of retries in the event of errors b Start BOOL All meters are read once on the positive edge of this input. b Disabled BOOL TRUE = deselection of the function block. Inputs/outputs VAR_IN_OUT st Com In : ST_KL6781in Data22B; st Com Out : ST_KL6781out Data22B; st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com In ST_KL6781in Data22B Process image of the inputs [} 214] st Com Out ST_KL6781out Data22B Process image of the outputs [} 214] st Com ST_MBUS_Communication This structure is used to link the function block with the meter blocks. [} 215] Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] In the event of an error, the output issues an error code and b Error becomes TRUE at the same time. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 19
## Page 20

Programming 4.1.2 ABB overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block ABB Electricity meter DELTAplus DZ+ FB_MBUS_ABB_DZ [} 20] 4.1.2.1 FB_MBUS_ABB_DZ The function block FB_MBUS_ABB_DZ is used to read electricity meters from ABB: -DELTAplus DZ+ The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR 20 Version: 1.8.0 TE1000
## Page 21

Programming Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Active Energy : ST_MBus_Info; st Reactive Energy: ST_MBus_Info; st Active Power : ST_MBus_Info; st Reactive Power : ST_MBus_Info; st Current L1 : ST_MBus_Info; st Current L2 : ST_MBus_Info; st Current L3 : ST_MBus_Info; st Power Factor : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status TE1000 Version: 1.8.0 21
## Page 22

Programming Name Type Description by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Active Energy ST_MBus_Info [} 216] Meter reading, total active energy st Reactive Energy ST_MBus_Info [} 216] Meter reading, total reactive energy st Active Power ST_MBus_Info [} 216] Current consumption, total active power st Reactive Power ST_MBus_Info [} 216] Current consumption, total reactive power st Current L1 ST_MBus_Info [} 216] Current L1 st Current L2 ST_MBus_Info [} 216] Current L2 st Current L3 ST_MBus_Info [} 216] Current L3 st Power Factor ST_MBus_Info [} 216] Total power factor Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.3 Actaris overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Actaris Heat meter CF-Echo II FB_MBUS_ACW_CF [} 23] Arithmetic unit CF-51 FB_MBUS_ACW_CF [} 23] Arithmetic unit CF-55 FB_MBUS_ACW_CF [} 23] Water meter MB +M FB_MBUS_ACW_Plus M [} 25] 22 Version: 1.8.0 TE1000
## Page 23

Programming 4.1.3.1 FB_MBUS_ACW_CF The function block FB_MBUS_ACW_CF is used to read heat meters from Actaris: -CF-Echo II -CF-51 -CF-55 Up to two additional water meters can be connected to this device (optional). The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud TE1000 Version: 1.8.0 23
## Page 24

Programming Name Type Description b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Volume1 : ST_MBus_Info; st Volume2 : ST_MBus_Info; st Cold Energy : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) 24 Version: 1.8.0 TE1000
## Page 25

Programming Name Type Description e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Volume1 ST_MBus_Info [} 216] Meter reading from additional water meter 1 (option) st Volume2 ST_MBus_Info [} 216] Meter reading from additional water meter 2 (option) st Cold Energy ST_MBus_Info [} 216] Meter reading, cooling energy consumed (option) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.3.2 FB_MBUS_ACW_Plus M The function block FB_MBUS_ACW_Plus M is used to read Actaris water meters: -BM +M The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; TE1000 Version: 1.8.0 25
## Page 26

Programming usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device 26 Version: 1.8.0 TE1000
## Page 27

Programming Name Type Description by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING(3) Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.4 Aquametro overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Aquametro Water meter SAPHIR FB_MBUS_AMT_SAPHIR [} 36] Heat meter CALEC FB_MBUS_AMT_CALEC [} 32] Heat meter CALEC ST, version C4 FB_MBUS_AMT_CALEC_ST C4 [} 34] Heat meter AMTRON FB_MBUS_AMT_AMTRON [} 30] Pulse collector AMBUS FB_MBUS_AMT_AMBUS [} 28] Heat meter AMTRON SONIC D FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] TE1000 Version: 1.8.0 27
## Page 28

Programming 4.1.4.1 FB_MBUS_AMT_AMBUS The function block FB_MBUS_AMT_AMBUS is used to read pulse collectors from Aquametro: -AMBUS IS The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block 28 Version: 1.8.0 TE1000
## Page 29

Programming Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Value : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Value ST_MBus_Info [} 216] Meter reading Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 29
## Page 30

Programming 4.1.4.2 FB_MBUS_AMT_AMTRON The function block FB_MBUS_AMT_AMTRON is used to read out heat meters from Aquametro: -AMTRON The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. 30 Version: 1.8.0 TE1000
## Page 31

Programming Name Type Description usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature TE1000 Version: 1.8.0 31
## Page 32

Programming Name Type Description st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.4.3 FB_MBUS_AMT_CALEC The function block FB_MBUS_AMT_CALEC is used to read heat meters from Aquametro: -CALEC The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. 32 Version: 1.8.0 TE1000
## Page 33

Programming Name Type Description st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave TE1000 Version: 1.8.0 33
## Page 34

Programming Name Type Description usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.4.4 FB_MBUS_AMT_CALEC_STC4 The function block FB_MBUS_AMT_CALEC_STC4 is used to read heat meters from Aquametro: -CALEC ST, version C4 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] 34 Version: 1.8.0 TE1000
## Page 35

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy Pos : ST_MBus_Info; st Volume Pos : ST_MBus_Info; st Energy Neg : ST_MBus_Info; st Volume Neg : ST_MBus_Info; st Power : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Pulsecounter1 : ST_MBus_Info; st Pulsecounter2 : ST_MBus_Info; END_VAR TE1000 Version: 1.8.0 35
## Page 36

Programming Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy Pos ST_MBus_Info [} 216] Meter reading energy consumed (positive) st Volume Pos ST_MBus_Info [} 216] Meter reading water consumption (positive) st Energy Neg ST_MBus_Info [} 216] Meter reading energy consumed (negative) st Volume Neg ST_MBus_Info [} 216] Meter reading water consumption (negative) st Power ST_MBus_Info [} 216] Current energy consumption, power st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Pulsecounter1 ST_MBus_Info [} 216] Pulse counter 1 st Pulsecounter2 ST_MBus_Info [} 216] Pulse counter 2 Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.4.5 FB_MBUS_AMT_SAPHIR 36 Version: 1.8.0 TE1000
## Page 37

Programming The function block FB_MBUS_AMT_SAPHIR is used to read water meters from Aquametro. -Saphir The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; TE1000 Version: 1.8.0 37
## Page 38

Programming s Man : STRING(3); st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.5 Berg overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Berg Electricity meter DZ+ FB_MBUS_BEC_DZ [} 41] Electricity meter DCMi FB_MBUS_BEC_DCMi [} 39] 38 Version: 1.8.0 TE1000
## Page 39

Programming 4.1.5.1 FB_MBUS_BEC_DCMi The function block FB_MBUS_BEC_DCMi is used to read electricity meters from Berg: -DCMi The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block TE1000 Version: 1.8.0 39
## Page 40

Programming Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 40 Version: 1.8.0 TE1000
## Page 41

Programming 4.1.5.2 FB_MBUS_BEC_DZ The function block FB_MBUS_BEC_DZ is used to read electricity meters from Berg: -DZ+ The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. TE1000 Version: 1.8.0 41
## Page 42

Programming Name Type Description t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Active Energy : ST_MBus_Info; st Reactive Energy: ST_MBus_Info; st Active Power : ST_MBus_Info; st Reactive Power : ST_MBus_Info; st Current L1 : ST_MBus_Info; st Current L2 : ST_MBus_Info; st Current L3 : ST_MBus_Info; st Power Factor : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Active Energy ST_MBus_Info [} 216] Meter reading, total active energy st Reactive Energy ST_MBus_Info [} 216] Meter reading, total reactive energy 42 Version: 1.8.0 TE1000
## Page 43

Programming Name Type Description st Active Power ST_MBus_Info [} 216] Current consumption, total active power st Reactive Power ST_MBus_Info [} 216] Current consumption, total reactive power st Current L1 ST_MBus_Info [} 216] Current L1 st Current L2 ST_MBus_Info [} 216] Current L2 st Current L3 ST_MBus_Info [} 216] Current L3 st Power Factor ST_MBus_Info [} 216] Total power factor Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.6 Brunata overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Brunata Heat meter HGQ / HGS FB_MBUS_BHG_HGx [} 44] Heat meter Optuna H (775) FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] TE1000 Version: 1.8.0 43
## Page 44

Programming 4.1.6.1 FB_MBUS_BHG_HGx The function block FB_MBUS_BHG_HGx is used to read heat meters from Brunata: -HGQ -HGS The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). 44 Version: 1.8.0 TE1000
## Page 45

Programming Name Type Description b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Volume : ST_MBus_Info; st Volume2 : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Flow : ST_MBus_Info; st Power : ST_MBus_Info; st Pulsecounter1 : ST_MBus_Info; st Pulsecounter2 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign TE1000 Version: 1.8.0 45
## Page 46

Programming Name Type Description st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Volume2 ST_MBus_Info [} 216] Volume from the flow sensor st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Flow ST_MBus_Info [} 216] Current water consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Pulsecounter1 ST_MBus_Info [} 216] Pulse counter 1 st Pulsecounter2 ST_MBus_Info [} 216] Pulse counter 2 Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.7 Carlo Gavazzi overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Carlo Gavazzi Energy meter EM24 FB_MBUS_GAV_EM24 [} 46] 4.1.7.1 FB_MBUS_GAV_EM24 The function block FB_MBUS_GAV_EM24 is used to read energy meters from Carlo Gavazzi. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. 46 Version: 1.8.0 TE1000
## Page 47

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st KWh_TOT : ST_MBus_Info; st KWh_L1 : ST_MBus_Info; st KWh_L2 : ST_MBus_Info; st KWh_L3 : ST_MBus_Info; st W_Sum : ST_MBus_Info; TE1000 Version: 1.8.0 47
## Page 48

Programming st V_L_N_Sum : ST_MBus_Info; st V_L_L_Sum : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st KWh_TOT ST_MBus_Info [} 216] See manufacturer's specifications st KWh_L1 ST_MBus_Info [} 216] st KWh_L2 ST_MBus_Info [} 216] st KWh_L3 ST_MBus_Info [} 216] st W_Sum ST_MBus_Info [} 216] st V_L_N_Sum ST_MBus_Info [} 216] st V_L_L_Sum ST_MBus_Info [} 216] Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.8 Cynox The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Cynox Pulse counter MCount2C FB_MBUS_CYN_MCount2C [} 49] 48 Version: 1.8.0 TE1000
## Page 49

Programming 4.1.8.1 FB_MBUS_CYN_MCount2C The function block FB_MBUS_CYN_MCount2C is used to read pulse counters from Cynox. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. TE1000 Version: 1.8.0 49
## Page 50

Programming Name Type Description t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Current1 : ST_MBus_Info; st Current2 : ST_MBus_Info; st Current3 : ST_MBus_Info; st Current4 : ST_MBus_Info; st Historical1 : ST_MBus_Info; st Historical2 : ST_MBus_Info; st Historical3 : ST_MBus_Info; st Historical4 : ST_MBus_Info; st Next Deadline : ST_MBus_Info; st Last Deadline : ST_MBus_Info; st Current Time : ST_MBus_Info; st Operating Time : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign 50 Version: 1.8.0 TE1000
## Page 51

Programming Name Type Description st Current1 ST_MBus_Info [} 216] Current value 1. st Current2 ST_MBus_Info [} 216] Current value 2. st Current3 ST_MBus_Info [} 216] Current value 3. st Current4 ST_MBus_Info [} 216] Current value 4. st Historical1 ST_MBus_Info [} 216] Historical value 1. st Historical2 ST_MBus_Info [} 216] Historical value 2. st Historical3 ST_MBus_Info [} 216] Historical value 3. st Historical4 ST_MBus_Info [} 216] Historical value 4. st Next Deadline ST_MBus_Info [} 216] Next deadline. st Last Deadline ST_MBus_Info [} 216] Last deadline. st Current Time ST_MBus_Info [} 216] Current time. st Operating Time ST_MBus_Info [} 216] Operating time. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.32 Tc2_MBus from 3.4.6.0 4.1.9 Elster overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Elster Gas meter Encoder Z6 FB_MBUS_ELS_Encoder Z6 [} 51] 4.1.9.1 FB_MBUS_ELS_Encoder Z6 The function block FB_MBUS_ELS_Encoder Z6 is used to read meters from Elster: - Encoder Z6 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. TE1000 Version: 1.8.0 51
## Page 52

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; END_VAR 52 Version: 1.8.0 TE1000
## Page 53

Programming Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING(3) Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.10 elvaco overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block elvaco Temperature and humidity CMa10 / CMa20 FB_MBUS_ELV_CMa10_20 sensors [} 54] TE1000 Version: 1.8.0 53
## Page 54

Programming 4.1.10.1 FB_MBUS_ELV_CMa10_20 The function block FB_MBUS_ELV_CMa10_20 is used to read temperature and humidity sensors from elvaco. Can be used with the sensors CMa10 and CMa20. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). 54 Version: 1.8.0 TE1000
## Page 55

Programming Name Type Description b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); str Rel Humi : ST_MBus_Info; str Rel Humi Min : ST_MBus_Info; str Rel Humi Max : ST_MBus_Info; str Temp : ST_MBus_Info; str Temp Min : ST_MBus_Info; str Temp Max : ST_MBus_Info; str Temp Avg1h : ST_MBus_Info; str Temp Avg24h : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign str Rel Humi ST_MBus_Info [} 216] Current relative humidity str Rel Humi Min ST_MBus_Info [} 216] Lowest relative humidity since the last min/max reset command str Rel Humi Max ST_MBus_Info [} 216] Highest relative humidity since the last min/max reset command str Temp ST_MBus_Info [} 216] Current temperature str Temp Min ST_MBus_Info [} 216] Lowest temperature since the last min/max reset command TE1000 Version: 1.8.0 55
## Page 56

Programming Name Type Description str Temp Max ST_MBus_Info [} 216] Highest temperature since the last min/max reset command str Temp Avg1h ST_MBus_Info [} 216] 1-hour average value for temperature str Temp Avg24h ST_MBus_Info [} 216] 24 hour average value for temperature Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.11 EMH overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block EMH Electricity meter DIZ FB_MBUS_EMH_DIZ [} 56] Electricity meter EIZ-E FB_MBUS_EMH_EIZE [} 58] Electricity meter EIZ-G FB_MBUS_EMH_EIZG [} 60] Electricity meter MIZ FB_MBUS_EMH_MIZ [} 62] 4.1.11.1 FB_MBUS_EMH_DIZ The function block FB_MBUS_EMH_DIZ is used to read electricity meters from EMH: -DIZ Unidirectional tariff meter only The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. 56 Version: 1.8.0 TE1000
## Page 57

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR TE1000 Version: 1.8.0 57
## Page 58

Programming Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.11.2 FB_MBUS_EMH_EIZE The function block FB_MBUS_EMH_EIZE is used to read electricity meters from EMH: -EIZ-E The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] 58 Version: 1.8.0 TE1000
## Page 59

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. TE1000 Version: 1.8.0 59
## Page 60

Programming Name Type Description b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.11.3 FB_MBUS_EMH_EIZG The function block FB_MBUS_EMH_EIZG is used to read electricity meters from EMH: -EIZ-G The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; 60 Version: 1.8.0 TE1000
## Page 61

Programming b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. TE1000 Version: 1.8.0 61
## Page 62

Programming Name Type Description dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.11.4 FB_MBUS_EMH_MIZ The function block FB_MBUS_EMH_MIZ is used to read electricity meters from EMH: -MIZ The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; 62 Version: 1.8.0 TE1000
## Page 63

Programming e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Voltage : ST_MBus_Info; st Current : ST_MBus_Info; st Frequency : ST_MBus_Info; st Powerfactor : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. TE1000 Version: 1.8.0 63
## Page 64

Programming Name Type Description b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Voltage ST_MBus_Info [} 216] Current voltage st Current ST_MBus_Info [} 216] Instantaneous current st Frequency ST_MBus_Info [} 216] Current frequency st Powerfactor ST_MBus_Info [} 216] Power factor st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.12 EMU overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block EMU Electricity meter EMU32x7 FB_MBUS_EMU_32x7 [} 65] Electricity meter EMU32x7 FB_MBUS_EMU_32x7_Opti on8 [} 68] Electricity meter Allrounder 3/5 FB_MBUS_EMU_3_5_Allrou nder [} 71] Electricity meter DHZ 5/63 FB_MBUS_EMU_DHZ_5_63 [} 74] 64 Version: 1.8.0 TE1000
## Page 65

Programming 4.1.12.1 FB_MBUS_EMU_32x7 The function block FB_MBUS_EMU_32x7 is used to read electricity meters from EMU: -EMU32.x7 Only the standard meter data will be read. The meter transmits this data in the standard EMU parameterization, or if the parameter set is set in the device to 00000 hexadecimal. Please refer to the meter documentation for further information regarding this. In the normal version, the current consumption of the M-Bus interface is equivalent to 3 standard loads. If an M-BUS master interface is used that is designed, for example, for up to 120 standard loads, a maximum of 40 EMU M-BUS meters can be connected. The meter can optionally be supplied with 230 V. The current consumption of the M-Bus interface is then equivalent to one standard load. The transmission of data from the EMU meter to the M-Bus protocol computer only works if the EMU meter is connected to at least two phases of the mains voltage network. The EMU meter transmits current data to the device’s M-Bus interface every 40 seconds, so that the readout data is approx. 40 - 45 seconds old. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR TE1000 Version: 1.8.0 65
## Page 66

Programming Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Operating Hours: ST_MBus_Info; st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Init Counter : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device 66 Version: 1.8.0 TE1000
## Page 67

Programming Name Type Description by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Operating Hours ST_MBus_Info [} 216] Operating hours of the EMU meter st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Init Counter ST_MBus_Info [} 216] Number of power failures at the EMU meter st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 67
## Page 68

Programming 4.1.12.2 FB_MBUS_EMU_32x7_Option8 The function block FB_MBUS_EMU_32x7_Option8 is used to read electricity meters from EMU: -EMU32.x7 The parameter set must be set in the device to 70000 hexadecimal (variant 8) in order to read out this data. Please refer to the meter documentation for further information regarding this. In the normal version, the current consumption of the M-Bus interface is equivalent to 3 standard loads. If an M-BUS master interface is used that is designed, for example, for up to 120 standard loads, a maximum of 40 EMU M-BUS meters can be connected. The meter can optionally be supplied with 230 V. The current consumption of the M-Bus interface is then equivalent to one standard load. The transmission of data from the EMU meter to the M-Bus protocol computer only works if the EMU meter is connected to at least two phases of the mains voltage network. 68 Version: 1.8.0 TE1000
## Page 69

Programming The EMU meter transmits current data to the device’s M-Bus interface every 40 seconds, so that the readout data is approx. 40 - 45 seconds old. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); TE1000 Version: 1.8.0 69
## Page 70

Programming st Operating Hours : ST_MBus_Info; st Active Energy T1 : ST_MBus_Info; st Active Energy T2 : ST_MBus_Info; st Reactive Energy T1 : ST_MBus_Info; st Reactive Energy T2 : ST_MBus_Info; st Tariff : ST_MBus_Info; st Active Power L1 : ST_MBus_Info; st Active Power L2 : ST_MBus_Info; st Active Power L3 : ST_MBus_Info; st Reactive Power L1 : ST_MBus_Info; st Reactive Power L2 : ST_MBus_Info; st Reactive Power L3 : ST_MBus_Info; st Active Power Max T1 : ST_MBus_Info; st Active Power Max T2 : ST_MBus_Info; st Voltage L1 : ST_MBus_Info; st Voltage L2 : ST_MBus_Info; st Voltage L3 : ST_MBus_Info; st Current L1 : ST_MBus_Info; st Current L2 : ST_MBus_Info; st Current L3 : ST_MBus_Info; st Frequency : ST_MBus_Info; st Power Factor L1 : ST_MBus_Info; st Power Factor L2 : ST_MBus_Info; st Power Factor L3 : ST_MBus_Info; st Init Counter : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Operating Hours ST_MBus_Info [} 216] Operating hours of the EMU meter st Active Energy T1 ST_MBus_Info [} 216] Meter reading, active energy tariff 1 st Active Energy T2 ST_MBus_Info [} 216] Meter reading, active energy tariff 2 st Reactive Energy T1 ST_MBus_Info [} 216] Meter reading, reactive energy tariff 1 st Reactive Energy T2 ST_MBus_Info [} 216] Meter reading, reactive energy tariff 2 st Tariff ST_MBus_Info [} 216] Current tariff st Active Power L1 ST_MBus_Info [} 216] Current consumption, active power L1 st Active Power L2 ST_MBus_Info [} 216] Current consumption, active power L2 st Active Power L3 ST_MBus_Info [} 216] Current consumption, active power L3 st Reactive Power L1 ST_MBus_Info [} 216] Current consumption, reactive power L1 st Reactive Power L2 ST_MBus_Info [} 216] Current consumption, reactive power L2 st Reactive Power L3 ST_MBus_Info [} 216] Current consumption, reactive power L3 st Active Power Max T ST_MBus_Info [} 216] Maximum active power tariff 1 1 70 Version: 1.8.0 TE1000
## Page 71

Programming Name Type Description st Active Power Max T ST_MBus_Info [} 216] Maximum active power tariff 2 2 st Voltage L1 ST_MBus_Info [} 216] Current voltage L1 st Voltage L2 ST_MBus_Info [} 216] Current voltage L2 st Voltage L3 ST_MBus_Info [} 216] Current voltage L3 st Current L1 ST_MBus_Info [} 216] Instantaneous current L1 st Current L2 ST_MBus_Info [} 216] Instantaneous current L2 st Current L3 ST_MBus_Info [} 216] Instantaneous current L3 st Frequency ST_MBus_Info [} 216] Current mains frequency st Power Factor L1 ST_MBus_Info [} 216] Current form factor phase L1 (cos Phi) st Power Factor L2 ST_MBus_Info [} 216] Current form factor phase L2 (cos Phi) st Power Factor L3 ST_MBus_Info [} 216] Current form factor phase L3 (cos Phi) st Init Counter ST_MBus_Info [} 216] Number of power failures at the EMU meter st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.12.3 FB_MBUS_EMU_3_5_Allrounder The function block FB_MBUS_EMU_3_5_Allrounder is used to read electricity meters from EMU. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] TE1000 Version: 1.8.0 71
## Page 72

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300…9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Active Energy Tariff1 : ST_MBus_Info; st Active Energy Tariff2 : ST_MBus_Info; st Active Power L1 : ST_MBus_Info; st Active Power L2 : ST_MBus_Info; st Active Power L3 : ST_MBus_Info; st Active Power Total : ST_MBus_Info; st Voltage L1 : ST_MBus_Info; st Voltage L2 : ST_MBus_Info; st Voltage L3 : ST_MBus_Info; st Current L1 : ST_MBus_Info; st Current L2 : ST_MBus_Info; st Current L3 : ST_MBus_Info; 72 Version: 1.8.0 TE1000
## Page 73

Programming st Current Total : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Active Energy Tariff ST_MBus_Info [} 216] Active energy tariff 1 1 st Active Energy Tariff ST_MBus_Info [} 216] Active energy tariff 2 2 st Active Power L1 ST_MBus_Info [} 216] Active power L1 st Active Power L2 ST_MBus_Info [} 216] Active power L2 st Active Power L3 ST_MBus_Info [} 216] Active power L3 st Active Power Total ST_MBus_Info [} 216] Total active power st Voltage L1 ST_MBus_Info [} 216] Current voltage L1 st Voltage L2 ST_MBus_Info [} 216] Current voltage L2 st Voltage L3 ST_MBus_Info [} 216] Current voltage L3 st Current L1 ST_MBus_Info [} 216] Instantaneous current L1 st Current L2 ST_MBus_Info [} 216] Instantaneous current L2 st Current L3 ST_MBus_Info [} 216] Instantaneous current L3 st Current LTotal ST_MBus_Info [} 216] Total current st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 73
## Page 74

Programming 4.1.12.4 FB_MBUS_EMU_DHZ_5_63 The function block FB_MBUS_EMU_DHZ_5_63 is used to read electricity meters from EMU. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300…9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR 74 Version: 1.8.0 TE1000
## Page 75

Programming Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy1 : ST_MBus_Info; st Energy2 : ST_MBus_Info; st Voltage : ST_MBus_Info; st Current : ST_MBus_Info; st Power : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy1 ST_MBus_Info [} 216] Effective energy 1 st Energy2 ST_MBus_Info [} 216] Effective energy 2 (resettable) st Voltage ST_MBus_Info [} 216] Mains voltage st Current ST_MBus_Info [} 216] Instantaneous current st Power ST_MBus_Info [} 216] Instantaneous active power Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.13 Engelmann overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder TE1000 Version: 1.8.0 75
## Page 76

Programming should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Engelmann Heat meter Sensostar 2C FB_MBUS_EFF_Senso Star2 C [} 76] 4.1.13.1 FB_MBUS_EFE_Senso Star2C The function block FB_MBUS_EFE_Senso Star2C is used to read heat meters from Engelmann: -SENSOSTAR 2C The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR 76 Version: 1.8.0 TE1000
## Page 77

Programming Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Cold Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Tariff1 : ST_MBus_Info; st Tariff2 : ST_MBus_Info; st Pulsecounter1 : ST_MBus_Info; st Pulsecounter2 : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. TE1000 Version: 1.8.0 77
## Page 78

Programming Name Type Description e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Cold Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Tariff1 ST_MBus_Info [} 216] Tariff register 1 st Tariff2 ST_MBus_Info [} 216] Tariff register 2 st Pulsecounter1 ST_MBus_Info [} 216] Pulse counter 1 st Pulsecounter2 ST_MBus_Info [} 216] Pulse counter 2 st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.14 General device blocks Vendor Type Device Function block General Electricity meter all electricity meters FB_MBUS_General_Electric ity [} 82] Heat meter all heat meters FB_MBUS_General_Heat [} 86] Water meter all water meters FB_MBUS_General_Water [} 91] Raw data of the first all FB_MBUS_Raw Data telegram [} 94] max. 40 values from the all FB_MBUS_General [} 80] first telegram all telegrams, all values all FB_MBUS_General_Ext [} 84] Values parameterizable all FB_MBUS_General_Param [} 88] Universal send blocks all FB_MBUS_General_Send [} 90] 78 Version: 1.8.0 TE1000
## Page 79

Programming Vendor Type Device Function block Scan function block all FB_MBUS_Scan [} 96] Change address all FB_MBUS_Change Adr [} 79] 4.1.14.1 FB_MBUS_Change Adr The primary address can be changed using the function block FB_MBUS_Change Adr. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Inputs VAR_INPUT usi Adr Old : USINT; usi Adr New : USINT; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b Disabled : BOOL:=FALSE; END_VAR Name Type Description usi Adr Old USINT Old primary address usi Adr New USINT New primary address e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL A positive edge at this input triggers a change of the primary address of the meter. b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. TE1000 Version: 1.8.0 79
## Page 80

Programming Name Type Description b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] In the event of an error, the output issues an error code and b Error becomes TRUE at the same time. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.14.2 FB_MBUS_General The function block FB_MBUS_General is used to read any M-Bus devices. The variable arr Data [} 216] provides a maximum of c MBUS_Max Data [} 219] values of the 1st telegram. String values and vendor- specific information are not shown correctly. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud 80 Version: 1.8.0 TE1000
## Page 81

Programming Name Type Description b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); arr Data : ARRAY [1..c MBUS_Max Data] OF ST_MBus_Data; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign arr Data ARRAY OF Maximum c MBUS_Max Data [} 219] values of the 1st ST_MBus_Data [} 216] telegram. The meaning of the values is explained in the M- Bus protocol for the device. TE1000 Version: 1.8.0 81
## Page 82

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.14.3 FB_MBUS_General_Electricity The function block FB_MBUS_General_Electricity is used to read electricity meters. Not all electricity meters automatically send power data. In this case the corresponding structure remains empty. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. 82 Version: 1.8.0 TE1000
## Page 83

Programming Name Type Description t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 83
## Page 84

Programming 4.1.14.4 FB_MBUS_General_Ext Some M-Bus devices send values distributed over several telegrams. The function block FB_MBUS_General_Ext can be used to read all telegrams from any M-Bus devices. The variable arr Telegram[1..c MBUS_Max Telegrams].arr Data[1..c MBUS_Max Data] supplies a maximum of c MBUS_Max Data [} 219] data from a maximum of c MBUS_Max Telegrams [} 219] telegrams. String values and vendor-specific information are not shown correctly. The number of telegrams to be read can be changed with the constant c MBUS_Max Telegrams [} 219]. The number of data per telegram to be read can be changed with the constant c MBUS_Max Data [} 219]. The function block FB_MBUS_General_Ext can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. 84 Version: 1.8.0 TE1000
## Page 85

Programming Name Type Description t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); arr Telegram : ARRAY [1..c MBUS_Max Telegrams] OF ST_MBus_Data2; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign arr Telegram ARRAY OF Maximum c MBUS_Max Telegrams [} 219] telegrams. The ST_MBus_Data2 [} 216] meaning of the values is explained in the M-Bus protocol for the device. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 85
## Page 86

Programming 4.1.14.5 FB_MBUS_General_Heat The function block FB_MBUS_General_Heat is used to read heat meters. Many heat meters do not send all values. In this case the corresponding structures remain empty. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. 86 Version: 1.8.0 TE1000
## Page 87

Programming Name Type Description t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption TE1000 Version: 1.8.0 87
## Page 88

Programming Name Type Description st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.14.6 FB_MBUS_General_Param The function block FB_MBUS_General_Param is used to read any M-Bus devices. The variable arr Data [} 216] supplies c MBUS_Max Data Param values. These values can be parameterized in the input array arr Config Data. String values and vendor-specific information are not shown correctly. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; arr Config Data: ARRAY [1..c MBUS_Max Data Param] OF WORD; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. 88 Version: 1.8.0 TE1000
## Page 89

Programming Name Type Description e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block arr Config Data ARRAY OF WORD Maximum c MBUS_Max Data Param [} 219] input parameters for specifying which values are to be displayed in the output array arr Data. Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); arr Data : ARRAY [1..c MBUS_Max Data Param] OF ST_MBus_Data; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium TE1000 Version: 1.8.0 89
## Page 90

Programming Name Type Description s Man STRING Manufacturer sign arr Data ARRAY OF Maximum c MBUS_Max Data Param [} 219] values. The ST_MBus_Data [} 216] values can be configured via the input variable arr Config Data. The meaning of the values is explained in the M-Bus protocol for the device. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.14.7 FB_MBUS_General_Send The function block FB_MBUS_General_Send is used to send data to any M-Bus devices (the primary address of the meter can be changed with this function block, for example). The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Disabled : BOOL := FALSE; by C_Field : USINT := 16#53; by CI_Field : USINT := 16#51; arr Data : ARRAY [0..240] OF BYTE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Disabled BOOL TRUE = deselection of the function block 90 Version: 1.8.0 TE1000
## Page 91

Programming Name Type Description by C_Field USINT C-field / function field by CI_Field USINT CI-field / ID field arr Data ARRAY OF BYTE The data to be sent must be written to this variable (see long block [} 11]). Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] In the event of an error, the output issues an error code and b Error becomes TRUE at the same time. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.14.8 FB_MBUS_General_Water The function block FB_MBUS_General_Water is used to read water meters. TE1000 Version: 1.8.0 91
## Page 92

Programming Many heat meters do not send all values. In this case the corresponding structures remain empty. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com In : ST_KL6781in Data22B; st Com Out : ST_KL6781out Data22B; st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com In ST_KL6781in Data22B Process image of the inputs [} 214] st Com Out ST_KL6781out Data22B Process image of the outputs [} 214] st Com ST_MBUS_Communication This structure is used to link the function block with the meter blocks. [} 215] 92 Version: 1.8.0 TE1000
## Page 93

Programming Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 93
## Page 94

Programming 4.1.14.9 FB_MBUS_Raw Data The function block FB_MBUS_Raw Data is used to read any M-Bus devices. The variable arr Data supplies the raw data of the M-Bus device. Only the first telegram is evaluated. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block 94 Version: 1.8.0 TE1000
## Page 95

Programming Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); i Len : INT; arr Data : ARRAY [0..259] OF BYTE; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign i Len STRING Number of transferred bytes arr Data ARRAY OF BYTE Raw data of the first telegram Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 95
## Page 96

Programming 4.1.14.10 FB_MBUS_Scan The function block FB_MBUS_Scan can be used to scan the M-Bus. All primary addresses (0..250) are queried successively. The array arr Device is used to show certain device information. Only the primary address is used for scanning. The primary address [} 11] of all devices must be set. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Inputs VAR_INPUT b Start : BOOL; b Stop : BOOL; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b Disabled : BOOL := FALSE; END_VAR Name Type Description b Start BOOL The search is started with a positive edge at this input. b Stop BOOL The search is stopped with a positive edge at this input. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; usi Address : USINT; usi Count : USINT; arr Device : ARRAY [0..250] OF ST_MBus_Scan; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. 96 Version: 1.8.0 TE1000
## Page 97

Programming Name Type Description b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. usi Address USINT Primary address [} 11] of the meter to be read with this function block. usi Count USINT Number of detected valid devices arr Device ARRAY OF Information about the detected devices ST_MBus_Scan [} 217] Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.15 Gossen Metrawatt overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Gossen Metrawatt Electricity meter U128x FB_MBUS_GMC_Electricity [} 97] Electricity meter U138x FB_MBUS_GMC_Electricity [} 97] 4.1.15.1 FB_MBUS_GMC_Electricity The function block FB_MBUS_GMC_Electricity is used to read electricity meters from Gossen Metrawatt: -U128x -U138x The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. TE1000 Version: 1.8.0 97
## Page 98

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR 98 Version: 1.8.0 TE1000
## Page 99

Programming Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.16 GWF overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block GWF Water meter FB_MBUS_GWF_Coder [} 100] Gas meter S1 FB_MBUS_GWF_Coder [} 100] Gas meter Z1 FB_MBUS_GWF_Coder [} 100] TE1000 Version: 1.8.0 99
## Page 100

Programming 4.1.16.1 FB_MBUS_GWF_Coder The function block FB_MBUS_GWF_Coder is used to read meters from GWF: -Water meter -Gas meter S1 -Gas meter Z1 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block 100 Version: 1.8.0 TE1000
## Page 101

Programming Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING(3) Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.17 Hydrometer overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. TE1000 Version: 1.8.0 101
## Page 102

Programming Vendor Type Device Function block Hydrometer 2 pulse inputs HYDRO-PORT Pulse FB_MBUS_HYD_Port Pulse [} 106] 2 analog inputs+1 HYDRO-PORT Analog FB_MBUS_HYD_Port Analo temperature sensor g [} 104] Water meter Flypper FB_MBUS_HYD_Flypper [} 102] Heat meter Sharky 773 FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] Heat meter Sharky 775 FB_MBUS_HYD_Sharky [} 108], FB_MBUS_HYD_Sharky_00 [} 111] 4.1.17.1 FB_MBUS_HYD_Flypper The function block FB_MBUS_HYD_Flypper is used to read water meters from Hydrometer: -Flypper The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR 102 Version: 1.8.0 TE1000
## Page 103

Programming Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) TE1000 Version: 1.8.0 103
## Page 104

Programming Name Type Description e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.17.2 FB_MBUS_HYD_Port Analog The function block FB_MBUS_HYD_Port Analog is used to read energy meters with an analog output from Hydrometer: -HYDRO-PORT analog (2x0/4-20 m A / 1x PT temperature sensor) The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. 104 Version: 1.8.0 TE1000
## Page 105

Programming Name Type Description e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Value1 : ST_MBus_Info; st Value2 : ST_MBus_Info; st Temperatur : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Value1 ST_MBus_Info [} 216] Meter reading 1 TE1000 Version: 1.8.0 105
## Page 106

Programming Name Type Description st Value2 ST_MBus_Info [} 216] Meter reading 2 st Temperature ST_MBus_Info [} 216] Temperature Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.17.3 FB_MBUS_HYD_Port Pulse The function block FB_MBUS_HYD_Port Pulse is used to read energy meters with pulse output from Hydrometer: -HYDRO-PORT Pulse The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. 106 Version: 1.8.0 TE1000
## Page 107

Programming Name Type Description b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Value1 : ST_MBus_Info; st Value2 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Value1 ST_MBus_Info [} 216] Meter reading 1 st Value2 ST_MBus_Info [} 216] Meter reading 2 TE1000 Version: 1.8.0 107
## Page 108

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.17.4 FB_MBUS_HYD_Sharky The function block FB_MBUS_HYD_Sharky is used to read energy meters of the companies: Hydrometer: -Sharky 773 -Sharky 775 -ENERGY INT 6 Brunata: -Brunata Optuna H (775) Aquametro: -AMNTRONIC SONIC D Only the most common values (see "VAR_OUTPUT") of the telegrams: 00 ( Application Reset-Subcode 00 / All ) 10 ( Application Reset-Subcode 10 / User data) 20 ( Application Reset-Subcode 20 / Simple billing) 30 ( Application Reset-Subcode 30 / Enhanced billing) 40 ( Application Reset-Subcode 40 / Multi tariff billing) or 50 ( Application Reset-Subcode 50 / Instant values) are read. The device is not switched to these telegrams; it must be set to one of these telegrams. The function block FB_MBUS_HYD_Sharky_00() [} 111] can be used if further data are required, or the function block FB_MBUS_General_Send() [} 90] can be used to select the required telegram, and the function block FB_MBUS_General() [} 80] can be used to read all data of the respective telegram. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. 108 Version: 1.8.0 TE1000
## Page 109

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; TE1000 Version: 1.8.0 109
## Page 110

Programming st Return Temp : ST_MBus_Info; st Tariff1 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Tariff1 ST_MBus_Info [} 216] Consumed energy tariff 1 Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 110 Version: 1.8.0 TE1000
## Page 111

Programming 4.1.17.5 FB_MBUS_HYD_Sharky_00 The function block FB_MBUS_HYD_Sharky_00 is used to read energy meters of the companies: Hydrometer: -Sharky 773 -Sharky 775 -ENERGY INT 6 Brunata: -Brunata Optuna H (775) Aquametro: -AMNTRONIC SONIC D All values of telegram 00 ( application reset subcode 00 / All ) are read. The device automatically switches to the corresponding mode. st Pulsecounter1 and st Pulsecounter2 are only output if the pulse module is connected. If further telegrams are required, the desired telegram can be selected with the function block FB_MBUS_General_Send() [} 90] and all data of the respective telegram can be read with the function block FB_MBUS_General() [} 80]. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. TE1000 Version: 1.8.0 111
## Page 112

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Tariff1 : ST_MBus_Info; st Tariff2 : ST_MBus_Info; st Volume : ST_MBus_Info; st Power : ST_MBus_Info; 112 Version: 1.8.0 TE1000
## Page 113

Programming st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Operating Hours: ST_MBus_Info; st Date Time : ST_MBus_Info; st Due Day1 : ST_MBUS_Due Day HYD1; st Due Day2 : ST_MBUS_Due Day HYD1; st Pulsecounter1 : ST_MBus_Info; st Pulsecounter2 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Tariff1 ST_MBus_Info [} 216] Meter reading tariff 1 st Tariff2 ST_MBus_Info [} 216] Meter reading tariff 2 st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Operating Hours ST_MBus_Info [} 216] Current operating hours st Date Time ST_MBus_Info [} 216] Current date, time st Due Day1 ST_MBus_Info [} 216] Values due day 1 st Due Day2 ST_MBus_Info [} 216] Values due day 2 st Pulsecounter1 ST_MBus_Info [} 216] Meter reading pulse counter 1 st Pulsecounter2 ST_MBus_Info [} 216] Meter reading pulse counter 2 Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 113
## Page 114

Programming 4.1.18 ista overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block ista Water meter domaqua® m FB_MBUS_IST_Istameter [} 114] Water meter istameter® m FB_MBUS_IST_Istameter [} 114] Water meter istameter III FB_MBUS_IST_Istameter III [} 116] Pulse counter pulsonic II FB_MBUS_IST_Pulsonic II [} 118] Heat meter sensonic II FB_MBUS_IST_Sensonic II [} 120] 4.1.18.1 FB_MBUS_IST_Istameter The function block FB_MBUS_IST_Istameter is used to read water meters from Ista: -istameter® m -domaqua® m The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. The devices are supplied from a battery. The number of read operations is therefore limited. An internal meter prevents communication exceeding 96 times per day on average. The user must make sure that excessive queries are prevented. Further information See Operating principle of the function block [} 10] 114 Version: 1.8.0 TE1000
## Page 115

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. TE1000 Version: 1.8.0 115
## Page 116

Programming Name Type Description b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.18.2 FB_MBUS_IST_Istameter III The function block FB_MBUS_IST_Istameter III is used to read water meters from Ista: -istameter III The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. The devices are supplied from a battery. The number of read operations is therefore limited. An internal meter prevents communication exceeding 96 times per day on average. The user must make sure that excessive queries are prevented. Further information See Operating principle of the function block [} 10] 116 Version: 1.8.0 TE1000
## Page 117

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. TE1000 Version: 1.8.0 117
## Page 118

Programming Name Type Description b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.18.3 FB_MBUS_IST_Pulsonic II The function block FB_MBUS_IST_Pulsonic II is used to read energy meters with pulse output from Ista: -Pulsonic II The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Maximum number of readings The devices are supplied from a battery. The number of read operations is therefore limited. An internal counter prevents communication exceeding 96 times per day on average. The user must make sure that excessive queries are prevented. Further information See Operating principle of the function block [} 10] 118 Version: 1.8.0 TE1000
## Page 119

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Value : ST_MBus_Info; st Current Value : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. TE1000 Version: 1.8.0 119
## Page 120

Programming Name Type Description b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Value ST_MBus_Info [} 216] Current consumption value st Current Value ST_MBus_Info [} 216] Current flow rate / power st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.18.4 FB_MBUS_IST_Sensonic II The function block FB_MBUS_IST_Sensonic II is used to read heat meters from Ista: -Sensonic II The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. 120 Version: 1.8.0 TE1000
## Page 121

Programming Maximum number of readings The devices are supplied from a battery. The number of read operations is therefore limited. An internal counter prevents communication exceeding 96 times per day on average. The user must make sure that excessive queries are prevented. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; TE1000 Version: 1.8.0 121
## Page 122

Programming e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Cold Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Cold Energy ST_MBus_Info [} 216] Meter reading, cooling energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.19 Itron The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Itron Energy meter Integral-V Ultra Lite FB_MBUS_ITR_Integral VUltra Lite [} 123] 122 Version: 1.8.0 TE1000
## Page 123

Programming 4.1.19.1 FB_MBUS_ITR_Integral VUltra Lite The function block FB_MBUS_ITR_Integral VUltra Lite is used to read energy meters from Itron. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. TE1000 Version: 1.8.0 123
## Page 124

Programming Name Type Description usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Volume : ST_MBus_Info; st Power : ST_MBus_Info; st Flow : ST_MBus_Info; st Temp Flow : ST_MBus_Info; st Temp Return : ST_MBus_Info; st Temp Difference: ST_MBus_Info; st Date Time : ST_MBus_Info; st Operating Time : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Current energy st Volume ST_MBus_Info [} 216] Current volume st Power ST_MBus_Info [} 216] Current performance st Flow ST_MBus_Info [} 216] Current flow rate 124 Version: 1.8.0 TE1000
## Page 125

Programming Name Type Description st Temp Flow ST_MBus_Info [} 216] Current flow temperature st Temp Return ST_MBus_Info [} 216] Current return temperature st Temp Difference ST_MBus_Info [} 216] Current temperature difference st Date Time ST_MBus_Info [} 216] Date and time st Operating Time ST_MBus_Info [} 216] Operating time Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.32 Tc2_MBus from 3.4.6.0 4.1.20 Janitza overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Janitza Electricity meter UMG96S FB_MBUS_JAN_UMG96S [} 126] TE1000 Version: 1.8.0 125
## Page 126

Programming 4.1.20.1 FB_MBUS_JAN_UMG96S The function block FB_MBUS_JAN_UMG96S is used to read electricity meters from Janitza: -UMG96S The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR 126 Version: 1.8.0 TE1000
## Page 127

Programming Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Active Energy : ST_MBus_Info; st Active Energy Tariff1 : ST_MBus_Info; st Active Energy Tariff2 : ST_MBus_Info; st Reactive Energy : ST_MBus_Info; st Reactive Energy Tariff1 : ST_MBus_Info; st Reactive Energy Tariff2 : ST_MBus_Info; st Apparent Energy : ST_MBus_Info; st Active Power : ST_MBus_Info; st Active Power L1 : ST_MBus_Info; st Active Power L2 : ST_MBus_Info; st Active Power L3 : ST_MBus_Info; st Reactive Power : ST_MBus_Info; st Apparent Power : ST_MBus_Info; st Current : ST_MBus_Info; st Current L1 : ST_MBus_Info; st Current L2 : ST_MBus_Info; st Current L3 : ST_MBus_Info; st Voltage L1 : ST_MBus_Info; st Voltage L2 : ST_MBus_Info; st Voltage L3 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. TE1000 Version: 1.8.0 127
## Page 128

Programming Name Type Description b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Active Energy ST_MBus_Info [} 216] Active energy without backstop (telegram2, data point 14) st Active Energy Tariff ST_MBus_Info [} 216] Active energy, obtained (telegram2, data point 15) 1 st Active Energy Tariff ST_MBus_Info [} 216] Active energy, delivered (telegram2, data point 16) 2 st Reactive Energy ST_MBus_Info [} 216] Reactive energy, inductive (telegram2, data point 17) st Reactive Energy Ta ST_MBus_Info [} 216] Reactive energy, capacitive (telegram2, data point 18) riff1 st Reactive Energy Ta ST_MBus_Info [} 216] Reactive work, without backstop (telegram2, data point 19) riff2 st Apparent Energy ST_MBus_Info [} 216] Apparent energy (telegram2, data point 20) st Active Power ST_MBus_Info [} 216] Current consumption, power, total (telegram2, data point 29) st Active Power L1 ST_MBus_Info [} 216] Current consumption, power, phase L1 (telegram2, data point 38) st Active Power L2 ST_MBus_Info [} 216] Current consumption, power, phase L2 (telegram2, data point 39) st Active Power L3 ST_MBus_Info [} 216] Current consumption, power, phase L3 (telegram2, data point 40) st Reactive Power ST_MBus_Info [} 216] Reactive power (telegram2, data point 30) st Apparent Power ST_MBus_Info [} 216] Apparent power (telegram2, data point 31) st Current ST_MBus_Info [} 216] Current (telegram2, data point 28) st Current L1 ST_MBus_Info [} 216] Current L1 (telegram2, data point 35) st Current L2 ST_MBus_Info [} 216] Current L2 (telegram2, data point 36) st Current L3 ST_MBus_Info [} 216] Current L3 (telegram2, data point 37) st Voltage L1 ST_MBus_Info [} 216] Voltage L1 (telegram2, data point 32) st Voltage L2 ST_MBus_Info [} 216] Voltage L2 (telegram2, data point 33) st Voltage L3 ST_MBus_Info [} 216] Voltage L3 (telegram2, data point 34) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 128 Version: 1.8.0 TE1000
## Page 129

Programming 4.1.21 Kamstrup overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Kamstrup Electricity meter Kamstrup 162 FB_MBUS_KAM_Kamstrup E [} 129] Electricity meter Kamstrup 351 FB_MBUS_KAM_Kamstrup E [} 129] Electricity meter Kamstrup 382 FB_MBUS_KAM_Kamstrup E [} 129] Heat/cold meter Maxical III FB_MBUS_KAM_Maxical_III [} 131] Heat/cold meter Multical 401 FB_MBUS_KAM_Multical [} 133] Heat/cold meter Multical 402 FB_MBUS_KAM_Multical402 [} 136] Water meter Multical 41 FB_MBUS_KAM_Multical41 [} 139] Heat/cold meter Multical 601 FB_MBUS_KAM_Multical601 [} 141] 4.1.21.1 FB_MBUS_KAM_Kamstrup E The function block FB_MBUS_KAM_Kamstrup E is used to read electricity meters from Kamstrup: -Kamstrup 162 -Kamstrup 351 -Kamstrup 382 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; TE1000 Version: 1.8.0 129
## Page 130

Programming t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device 130 Version: 1.8.0 TE1000
## Page 131

Programming Name Type Description by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.21.2 FB_MBUS_KAM_Maxical_III The function block FB_MBUS_KAM_Maxical_III is used to read heat/cold meters from Kamstrup: -Maxical III The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; TE1000 Version: 1.8.0 131
## Page 132

Programming usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. 132 Version: 1.8.0 TE1000
## Page 133

Programming Name Type Description dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.21.3 FB_MBUS_KAM_Multical The function block FB_MBUS_KAM_Multical is used to read heat/cold meters from Kamstrup: -Multical 401 -Multical 601 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. TE1000 Version: 1.8.0 133
## Page 134

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; 134 Version: 1.8.0 TE1000
## Page 135

Programming st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 135
## Page 136

Programming 4.1.21.4 FB_MBUS_KAM_Multical402 The function block FB_MBUS_KAM_Multical402 is used to read energy meters from Kamstrup. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. 136 Version: 1.8.0 TE1000
## Page 137

Programming Name Type Description e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy Heating : ST_MBus_Info; st Volume : ST_MBus_Info; st On Time : ST_MBus_Info; st Temp Flow : ST_MBus_Info; st Temp Return : ST_MBus_Info; st Temp Diff : ST_MBus_Info; st Power Actual : ST_MBus_Info; st Power Max : ST_MBus_Info; st Flow Actual : ST_MBus_Info; st Flow Max : ST_MBus_Info; st Tariff2 : ST_MBus_Info; st Tariff3 : ST_MBus_Info; st Pulse Input A : ST_MBus_Info; st Pulse Input B : ST_MBus_Info; st Energy Cooling : ST_MBus_Info; st Date Time : ST_MBus_Info; st Energy Heating Target : ST_MBus_Info; st Volume Target : ST_MBus_Info; st Power Max Target : ST_MBus_Info; st Flow Max Target : ST_MBus_Info; st Tariff2Target : ST_MBus_Info; st Tariff3Target : ST_MBus_Info; st Pulse Input ATarget : ST_MBus_Info; st Pulse Input BTarget : ST_MBus_Info; st Energy Cooling Target : ST_MBus_Info; st Date Target : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. TE1000 Version: 1.8.0 137
## Page 138

Programming Name Type Description b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy Heating ST_MBus_Info [} 216] Heating energy st Volume ST_MBus_Info [} 216] Water consumption from district heating st On Time ST_MBus_Info [} 216] Operating hours st Temp Flow ST_MBus_Info [} 216] Current flow temperature st Temp Return ST_MBus_Info [} 216] Current return temperature st Temp Diff ST_MBus_Info [} 216] Current temperature difference st Power Actual ST_MBus_Info [} 216] Active power (maximum) st Power Max ST_MBus_Info [} 216] Current active power st Flow Actual ST_MBus_Info [} 216] Current flow rate st Flow Max ST_MBus_Info [} 216] Active power (maximum) st Tariff2 ST_MBus_Info [} 216] Tariff 2 st Tariff3 ST_MBus_Info [} 216] Tariff 3 st Pulse Input A ST_MBus_Info [} 216] Pulse input A st Pulse Input B ST_MBus_Info [} 216] Pulse input B st Energy Cooling ST_MBus_Info [} 216] Cooling energy st Date Time ST_MBus_Info [} 216] Date and time st Energy Heating Tar ST_MBus_Info [} 216] See manufacturer's specifications get st Volume Target ST_MBus_Info [} 216] st Power Max Target ST_MBus_Info [} 216] st Flow Max Target ST_MBus_Info [} 216] st Tariff2Target ST_MBus_Info [} 216] st Tariff3Target ST_MBus_Info [} 216] st Pulse Input ATarget ST_MBus_Info [} 216] st Pulse Input BTarget ST_MBus_Info [} 216] st Energy Cooling Tar ST_MBus_Info [} 216] get st Date Target ST_MBus_Info [} 216] Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 138 Version: 1.8.0 TE1000
## Page 139

Programming 4.1.21.5 FB_MBUS_KAM_Multical41 The function block FB_MBUS_KAM_Multical41 is used to read water meters from Kamstrup: -Multical 41 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block TE1000 Version: 1.8.0 139
## Page 140

Programming Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 140 Version: 1.8.0 TE1000
## Page 141

Programming 4.1.21.6 FB_MBUS_KAM_Multical601 The function block FB_MBUS_KAM_Multical601 is used to read heat/cold meters from Kamstrup: -Multical 601 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. TE1000 Version: 1.8.0 141
## Page 142

Programming Name Type Description b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Cooling Energy : ST_MBus_Info; st Energy T2 : ST_MBus_Info; st Energy T3 : ST_MBus_Info; st Pulsecounter1 : ST_MBus_Info; st Pulsecounter2 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) 142 Version: 1.8.0 TE1000
## Page 143

Programming Name Type Description e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Cooling Energy ST_MBus_Info [} 216] Meter reading, cooling energy consumption st Energy T2 ST_MBus_Info [} 216] Meter reading, energy consumption tariff 2 st Energy T3 ST_MBus_Info [} 216] Meter reading, energy consumption tariff 3 st Pulsecounter1 ST_MBus_Info [} 216] Pulse counter 1 st Pulsecounter2 ST_MBus_Info [} 216] Pulse counter 2 Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.22 Kundo overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block KUNDO Heat/cold meter Compact WMZ G20 FB_MBUS_KST_G20 [} 144] Heat/cold meter Compact WMZ G21 FB_MBUS_KST_G20 [} 144] External M-Bus module him1s FB_MBUS_KST_him1 [} 146] External M-Bus module him1plus FB_MBUS_KST_him1 [} 146] Pulse input him1plus FB_MBUS_KST_him1Puls [} 148] TE1000 Version: 1.8.0 143
## Page 144

Programming 4.1.22.1 FB_MBUS_KST_G20 The function block FB_MBUS_KST_G20 is used to read heat/cold meters from KUNDO System Technik: -Kompakt WZM G20 (with internal M-Bus module) -Kompakt WZM G21 (with internal M-Bus module) The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. 144 Version: 1.8.0 TE1000
## Page 145

Programming Name Type Description t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption TE1000 Version: 1.8.0 145
## Page 146

Programming Name Type Description st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.22.2 FB_MBUS_KST_him1 The function block FB_MBUS_KST_him1 is used to read M-Bus modules from KUNDO System Technik: -him1s -him1plus These modules can be used for reading consumption data from a KUNDO arithmetic unit. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; 146 Version: 1.8.0 TE1000
## Page 147

Programming usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. TE1000 Version: 1.8.0 147
## Page 148

Programming Name Type Description dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.22.3 FB_MBUS_KST_him1Puls The function block FB_MBUS_KST_him1Puls is used to read M-Bus modules from KUNDO System Technik: -him1plus (pulse input) The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; 148 Version: 1.8.0 TE1000
## Page 149

Programming b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Value : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status TE1000 Version: 1.8.0 149
## Page 150

Programming Name Type Description by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Value ST_MBus_Info [} 216] Meter reading Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.23 Landis & Gyr overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Landis & Gyr Heat/cold meter ULTRAHEAT 2WR5 FB_MBUS_LUG_Heat [} 150] Heat/cold meter ULTRAHEAT 2WR6 FB_MBUS_LUG_Heat [} 150] Heat/cold meter ULTRAHEAT UH50 FB_MBUS_LUG_Heat [} 150] 4.1.23.1 FB_MBUS_LUG_Heat The function block FB_MBUS_LUG_Heat is used to read heat/cold meters from Landis & Gyr: 150 Version: 1.8.0 TE1000
## Page 151

Programming -2WR5 -2WR6 -UH50 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block e Baudrate E_MBUS_Baudrate [} 209] 300, 1200, 2400, 4800, 9600 baud Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; TE1000 Version: 1.8.0 151
## Page 152

Programming usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.24 Metrima overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Metrima Heat meter F22 (default values) FB_MBUS_SVM_F22 [} 153] Heat meter F22 (with additional output FB_MBUS_SVM_F22_Ext values) [} 155] 152 Version: 1.8.0 TE1000
## Page 153

Programming 4.1.24.1 FB_MBUS_SVM_F22 The function block FB_MBUS_SVM_F22 is used to read heat meters from Metrima: -F22 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. TE1000 Version: 1.8.0 153
## Page 154

Programming Name Type Description t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Volume : ST_MBus_Info; st Volume2 : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Flow : ST_MBus_Info; st Power : ST_MBus_Info; st Pulsecounter1 : ST_MBus_Info; st Pulsecounter2 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption 154 Version: 1.8.0 TE1000
## Page 155

Programming Name Type Description st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Volume2 ST_MBus_Info [} 216] Accumulated volume. Energy calculation st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Flow ST_MBus_Info [} 216] Current water consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Pulsecounter1 ST_MBus_Info [} 216] Pulse counter 1 st Pulsecounter2 ST_MBus_Info [} 216] Pulse counter 2 Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.24.2 FB_MBUS_SVM_F22_Ext The function block FB_MBUS_SVM_F22_Ext is used to read heat meters from Metrima: -F22 (as FB_MBUS_SVM_F22() [} 153], but with the extended output values arr Acount Accums and arr Monthly Accums.) The function block is not suitable for BC/BX. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. TE1000 Version: 1.8.0 155
## Page 156

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; b Monthstorages : BOOL; by Monthstorages : BYTE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block b Monthstorages BOOL FALSE = due days and monthly values are not read (arr Account Accums and arr Monthly Accums) / TRUE = due days and monthly values are read (arr Account Accums and arr Monthly Accums). The number of monthly values (arr Monthly Accums) can be changed and depends on the variable by Monthstorages. by Monthstorages BYTE Number of monthly values (arr Monthly Accums), maximum 37 values. Only applies if by Monthstorages =TRUE. Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; 156 Version: 1.8.0 TE1000
## Page 157

Programming e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Volume : ST_MBus_Info; st Volume2 : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Flow : ST_MBus_Info; st Power : ST_MBus_Info; st Pulsecounter1 : ST_MBus_Info; st Pulsecounter2 : ST_MBus_Info; arr Account Accums : ARRAY [1..2] OF ST_MBus_F22; arr Monthly Accums : ARRAY [1..37] OF ST_MBus_F22; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Volume2 ST_MBus_Info [} 216] Accumulated volume. Energy calculation st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Flow ST_MBus_Info [} 216] Current water consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Pulsecounter1 ST_MBus_Info [} 216] Pulse counter 1 st Pulsecounter2 ST_MBus_Info [} 216] Pulse counter 2 arr Account Accums ARRAY OF ST_MBus_F22 2 due day values (energy, volume 1, volume 2, pulse counter 1, pulse counter 2, date). Values are only read if [} 218] b Monthstorages =TRUE. arr Monthly Accums ARRAY OF ST_MBus_F22 Maximum 37 monthly values (energy, volume 1, volume 2, pulse counter 1, pulse counter 2, date). Values are only [} 218] read if b Monthstorages =TRUE. The number of values depends on the variable by Monthstorages. TE1000 Version: 1.8.0 157
## Page 158

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.25 NZR overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block NZR 2-way pulse adapter IC-M2 FB_MBUS_NZR_ICM2 [} 158] 2-way pulse adapter IC-M2C FB_MBUS_NZR_ICM2 [} 158] Water meter Modularis 2 FB_MBUS_NZR_Modularis 2 [} 160] 4.1.25.1 FB_MBUS_NZR_ICM2 The function block FB_MBUS_NZR_ICM2 is used to read energy meters with pulse output from NZR: -IC-M2 -IC-M2C The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Up to 2 pulse generators can be connected to an IC-M2/IC-M2C at the same time. The IC-M2/IC-M2C behaves like 2 independent slaves. Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; 158 Version: 1.8.0 TE1000
## Page 159

Programming usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Value : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device TE1000 Version: 1.8.0 159
## Page 160

Programming Name Type Description by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Value ST_MBus_Info [} 216] Meter reading Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.25.2 FB_MBUS_NZR_Modularis2 The function block FB_MBUS_NZR_Modularis2 is used to read water meters from NZR: -Modularis 2 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. 160 Version: 1.8.0 TE1000
## Page 161

Programming Name Type Description e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING(3) Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption TE1000 Version: 1.8.0 161
## Page 162

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.26 OPTEC overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block OPTEC Electricity meter ECS Type 2 FB_MBUS_OPT_ECSType2 [} 162] 4.1.26.1 FB_MBUS_OPT_ECSType2 The function block FB_MBUS_OPT_ECSType2 is used to read electricity meters from OPTEC: -ECS (default readout data type 2) The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] 162 Version: 1.8.0 TE1000
## Page 163

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Ad r : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy T1_L1 : ST_MBus_Info; st Energy T1_L2 : ST_MBus_Info; st Energy T1_L3 : ST_MBus_Info; st Energy T1_Total : ST_MBus_Info; st Energy T2_L1 : ST_MBus_Info; st Energy T2_L2 : ST_MBus_Info; st Energy T2_L3 : ST_MBus_Info; st Energy T2_Total : ST_MBus_Info; st Power L1 : ST_MBus_Info; st Power L2 : ST_MBus_Info; st Power L3 : ST_MBus_Info; st Power Total : ST_MBus_Info; TE1000 Version: 1.8.0 163
## Page 164

Programming st Active Tariff : ST_MBus_Info; st Status Byte4 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy T1_L1 ST_MBus_Info [} 216] Meter reading, active energy consumed, tariff 1, phase L1 st Energy T1_L2 ST_MBus_Info [} 216] Meter reading, active energy consumed, tariff 1, phase L2 st Energy T1_L3 ST_MBus_Info [} 216] Meter reading, active energy consumed, tariff 1, phase L3 st Energy T1_Total ST_MBus_Info [} 216] Meter reading, active energy consumed, tariff 1, total st Energy T2_L1 ST_MBus_Info [} 216] Meter reading, active energy consumed, tariff 2, phase L1 st Energy T2_L2 ST_MBus_Info [} 216] Meter reading, active energy consumed, tariff 2, phase L2 st Energy T2_L3 ST_MBus_Info [} 216] Meter reading, active energy consumed, tariff 2, phase L3 st Energy T2_Total ST_MBus_Info [} 216] Meter reading, active energy consumed, tariff 2, total st Power L1 ST_MBus_Info [} 216] Current consumption, power, phase L1 st Power L2 ST_MBus_Info [} 216] Current consumption, power, phase L2 st Power L3 ST_MBus_Info [} 216] Current consumption, power, phase L3 st Power Total ST_MBus_Info [} 216] Current consumption, power, total st Active Tariff ST_MBus_Info [} 216] Current tariff st Status Byte4 ST_MBus_Info [} 216] Range Overflow Alarms Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.27 Relay overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Relay 1-4 analog inputs An Di 1-4 FB_MBUS_REL_An Di [} 165] 164 Version: 1.8.0 TE1000
## Page 165

Programming Vendor Type Device Function block 4 digital inputs Pad In 4 FB_MBUS_REL_Pad In4 [} 167] 1-way pulse adapter Pad Puls M1 FB_MBUS_REL_Pad Puls M1 [} 169] 1-way pulse adapter Pad Puls M1C FB_MBUS_REL_Pad Puls M1 [} 169] 2-way pulse adapter Pad Puls M2 FB_MBUS_REL_Pad Puls M2 [} 171] 2-way pulse adapter Pad Puls M2C FB_MBUS_REL_Pad Puls M2 [} 171] 4-way pulse adapter Pad Puls M4 FB_MBUS_REL_Pad Puls M4 [} 174] 4-way pulse adapter Pad Puls M4L FB_MBUS_REL_Pad Puls M4 [} 174] 4.1.27.1 FB_MBUS_REL_An Di The function block FB_MBUS_REL_An Di is used to read analog converters from Relay: -An Di 1 (1x 0/4-20 m A or 0-10 V) -An Di 2 (2x 0/4-20 m A or 0-10 V) -An Di 3 (3x 0/4-20 m A or 0-10 V) -An Di 4 (4x 0/4-20 m A or 0-10 V) The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Up to 4 sensors can be connected to an An Di 4 at the same time. The An Di 4 behaves like 4 independent slaves. Further information See Operating principle of the function block [} 10] TE1000 Version: 1.8.0 165
## Page 166

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Value : ST_MBus_Info; st Max : ST_MBus_Info; st Offset : ST_MBus_Info; by Info : BYTE; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. 166 Version: 1.8.0 TE1000
## Page 167

Programming Name Type Description b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING(3) Manufacturer sign st Value ST_MBus_Info [} 216] Meter reading st Max ST_MBus_Info [} 216] Maximum value st Offset ST_MBus_Info [} 216] Offset by Info BYTE Information byte. n Bit7-4: Information about the A/D modules installed in the An Di4 n Bit3: Protection bit (1: Protection enabled) n Bit2-1: No. of the current measurement input (0: Port1 ... 3: Port4) n Bit0: I/U measurement (1: current measurement) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.27.2 FB_MBUS_REL_Pad In4 The function block FB_MBUS_REL_Pad In4 is used to read digital inputs from Relay: -Pad In 4 (4 digital inputs) TE1000 Version: 1.8.0 167
## Page 168

Programming The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); b Data In1 : BOOL; b Data In2 : BOOL; 168 Version: 1.8.0 TE1000
## Page 169

Programming b Data In3 : BOOL; b Data In4 : BOOL; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign b Data In1 BOOL Digital input 1 b Data In2 BOOL Digital input 2 b Data In3 BOOL Digital input 3 b Data In4 BOOL Digital input 4 Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.27.3 FB_MBUS_REL_Pad Puls M1 The function block FB_MBUS_REL_Pad Puls M1 is used to read energy meters with pulse output from Relay: -Pad Puls M1 -Pad Puls M1C The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. TE1000 Version: 1.8.0 169
## Page 170

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Value : ST_MBus_Info; by Numerator : BYTE; by Denominator : BYTE; END_VAR 170 Version: 1.8.0 TE1000
## Page 171

Programming Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Value ST_MBus_Info [} 216] Meter reading by Numerator BYTE Pulse value numerator (range 1..255) by Denominator BYTE Pulse value denominator (range 1..255) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.27.4 FB_MBUS_REL_Pad Puls M2 The function block FB_MBUS_REL_Pad Puls M2 is used to read energy meters with pulse output from Relay: -Pad Puls M2 TE1000 Version: 1.8.0 171
## Page 172

Programming -Pad Puls M2C The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Up to 2 pulse generators can be connected to a Pad Puls 2/Pad Puls 2C at the same time. The Pad Puls 2/ Pad Puls 2C behaves like 2 independent slaves. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; 172 Version: 1.8.0 TE1000
## Page 173

Programming e Medium : E_MBUS_Medium; s Man : STRING(3); st Value : ST_MBus_Info; st Date Time : ST_MBus_Info; st Value Due Day : ST_MBus_Info; st Date Due Day : ST_MBus_Info; st Date Future Due Day : ST_MBus_Info; by Info : BYTE; by Numerator : BYTE; by Denominator : BYTE; by PStat : BYTE; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Value ST_MBus_Info [} 216] Meter reading st Date Time ST_MBus_Info [} 216] Current date st Value Due Day ST_MBus_Info [} 216] Due day meter reading st Date Due Day ST_MBus_Info [} 216] Last due day st Date Future Due Da ST_MBus_Info [} 216] Future due day y by Info BYTE Information byte (tariff and sampling method) by Numerator BYTE Pulse value numerator (range 1..99) by Denominator BYTE Pulse value denominator (1..255, 0 -> 256) by PStat BYTE Port status (current contact state at the port inputs) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 173
## Page 174

Programming 4.1.27.5 FB_MBUS_REL_Pad Puls M4 The function block FB_MBUS_REL_Pad Puls M4 is used to read energy meters with pulse output from Relay: -Pad Puls M4 -Pad Puls M4L The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Up to 4 pulse generators can be connected to a Pad Puls 4/Pad Puls 4L at the same time. The Pad Puls 4/ Pad Puls 4L behaves like 4 independent slaves. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. 174 Version: 1.8.0 TE1000
## Page 175

Programming Name Type Description b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Value : ST_MBus_Info; st Date Time : ST_MBus_Info; st Value Due Day : ST_MBus_Info; st Date Due Day : ST_MBus_Info; st Date Future Due Day : ST_MBus_Info; by Info : BYTE; by Numerator : BYTE; by Denominator : BYTE; by PStat : BYTE; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium TE1000 Version: 1.8.0 175
## Page 176

Programming Name Type Description s Man STRING Manufacturer sign st Value ST_MBus_Info [} 216] Meter reading st Date Time ST_MBus_Info [} 216] Current date st Value Due Day ST_MBus_Info [} 216] Due day meter reading st Date Due Day ST_MBus_Info [} 216] Last due day st Date Future Due Da ST_MBus_Info [} 216] Future due day y by Info BYTE Information byte (tariff and sampling method) by Numerator BYTE Pulse value numerator (range 1..99) by Denominator BYTE Pulse value denominator (1..255, 0 -> 256) by PStat BYTE Port status (current contact state at the port inputs) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.28 Saia-Burgess overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Saia-Burgess Electricity meter ALD1 FB_MBUS_SBC_ALD1 [} 177] Electricity meter ALE3 FB_MBUS_SBC_ALE3 [} 179] Electricity meter AWD3 FB_MBUS_SBC_ALE3 [} 179] 176 Version: 1.8.0 TE1000
## Page 177

Programming 4.1.28.1 FB_MBUS_SBC_ALD1 The function block FB_MBUS_SBC_ALD1 is used to read electricity meters from Saia-Burgess: -ALD1 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. TE1000 Version: 1.8.0 177
## Page 178

Programming Name Type Description usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy Total : ST_MBus_Info; st Energy Partial : ST_MBus_Info; st Voltage : ST_MBus_Info; st Current : ST_MBus_Info; st Power : ST_MBus_Info; st Reactiv Power : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy Total ST_MBus_Info [} 216] Meter reading, total energy st Energy Partial ST_MBus_Info [} 216] Meter reading, partial energy consumption. This value can be reset. st Voltage ST_MBus_Info [} 216] Voltage st Current ST_MBus_Info [} 216] Current st Power ST_MBus_Info [} 216] Power 178 Version: 1.8.0 TE1000
## Page 179

Programming Name Type Description st Reactiv Power ST_MBus_Info [} 216] Reactive power Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.28.2 FB_MBUS_SBC_ALE3 The function block FB_MBUS_SBC_ALE3 is used to read electricity meters from Saia-Burgess: -ALE3 -AWD3 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] TE1000 Version: 1.8.0 179
## Page 180

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy T1total : ST_MBus_Info; st Energy T1partial : ST_MBus_Info; st Energy T2total : ST_MBus_Info; st Energy T2partial : ST_MBus_Info; st Voltage L1 : ST_MBus_Info; st Current L1 : ST_MBus_Info; st Power L1 : ST_MBus_Info; st Reactiv Power L1 : ST_MBus_Info; st Voltage L2 : ST_MBus_Info; st Current L2 : ST_MBus_Info; st Power L2 : ST_MBus_Info; st Reactiv Power L2 : ST_MBus_Info; 180 Version: 1.8.0 TE1000
## Page 181

Programming st Voltage L3 : ST_MBus_Info; st Current L3 : ST_MBus_Info; st Power L3 : ST_MBus_Info; st Reactiv Power L3 : ST_MBus_Info; st Curr Trans Factor : ST_MBus_Info; st Power Total : ST_MBus_Info; st Reactive Power Total : ST_MBus_Info; st Tariff : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy T1total ST_MBus_Info [} 216] Meter reading, total energy tariff 1 st Energy T1partial ST_MBus_Info [} 216] Meter reading, partial energy consumption tariff 1. This value can be reset. st Energy T2total ST_MBus_Info [} 216] Meter reading, total energy tariff 2 st Energy T2partial ST_MBus_Info [} 216] Meter reading, partial energy consumption tariff 2. This value can be reset. st Voltage L1 ST_MBus_Info [} 216] Voltage phase L1 st Current L1 ST_MBus_Info [} 216] Current phase L1 st Power L1 ST_MBus_Info [} 216] Power phase L1 st Reactiv Power L1 ST_MBus_Info [} 216] Reactive power phase L1 st Voltage L2 ST_MBus_Info [} 216] Voltage phase L2 st Current L2 ST_MBus_Info [} 216] Current phase L2 st Power L2 ST_MBus_Info [} 216] Power phase L2 st Reactiv Power L2 ST_MBus_Info [} 216] Reactive power phase L2 st Voltage L3 ST_MBus_Info [} 216] Voltage phase L3 st Current L3 ST_MBus_Info [} 216] Current phase L3 st Power L3 ST_MBus_Info [} 216] Power phase L3 st Reactiv Power L3 ST_MBus_Info [} 216] Reactive power phase L3 st Curr Trans Factor ST_MBus_Info [} 216] Transformer factor (=0 for ALE3 devices) st Power Total ST_MBus_Info [} 216] Total power st Reactive Power Tot ST_MBus_Info [} 216] Total reactive power al st Tariff ST_MBus_Info [} 216] Current tariff (=0 for AWD3 devices) TE1000 Version: 1.8.0 181
## Page 182

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.29 Schlumberger overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Schlumberger Heat meter Integral-Mk Ma XX FB_MBUS_SLB_MK_Ma XX [} 184] Heat meter CF Echo I FB_MBUS_SLB_CFEcho I [} 182] 4.1.29.1 FB_MBUS_SLB_CFEcho I The function block FB_MBUS_SLB_CFEcho I is used to read heat meters from Schlumberger: -CF Echo I The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; 182 Version: 1.8.0 TE1000
## Page 183

Programming b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. TE1000 Version: 1.8.0 183
## Page 184

Programming Name Type Description b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.29.2 FB_MBUS_SLB_MK_Ma XX The function block FB_MBUS_SLB_MK_Ma XX is used to read heat meters from Schlumberger: 184 Version: 1.8.0 TE1000
## Page 185

Programming -Integral-MK Maxx / Up to 4 additional water meters can be connected to this device. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; TE1000 Version: 1.8.0 185
## Page 186

Programming st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; st Volume1 : ST_MBus_Info; st Volume2 : ST_MBus_Info; st Volume3 : ST_MBus_Info; st Volume4 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference st Volume1 ST_MBus_Info [} 216] Meter reading of additional water meter 1 st Volume2 ST_MBus_Info [} 216] Meter reading of additional water meter 2 st Volume3 ST_MBus_Info [} 216] Meter reading of additional water meter 3 st Volume4 ST_MBus_Info [} 216] Meter reading of additional water meter 4 Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.30 Schneider Electric The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Schneider Electric Electricity meter i EM3135 FB_MBUS_SEC_i EM3135 [} 187] 186 Version: 1.8.0 TE1000
## Page 187

Programming 4.1.30.1 FB_MBUS_SEC_i EM3135 The function block FB_MBUS_SEC_i EM3135 is used to read electricity meters from Schneider Electric. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR TE1000 Version: 1.8.0 187
## Page 188

Programming Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300…9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Current Phase1 : ST_MBus_Info; st Current Phase2 : ST_MBus_Info; st Current Phase3 : ST_MBus_Info; st Current Average : ST_MBus_Info; st Voltage L1N : ST_MBus_Info; st Voltage L2N : ST_MBus_Info; st Voltage L3N : ST_MBus_Info; st Voltage Average LN : ST_MBus_Info; st Voltage L1L2 : ST_MBus_Info; st Voltage L2L3 : ST_MBus_Info; st Voltage L3L1 : ST_MBus_Info; st Voltage Average LL : ST_MBus_Info; st Power Active Phase1 : ST_MBus_Info; st Power Active Phase2 : ST_MBus_Info; st Power Active Phase3 : ST_MBus_Info; st Power Active Total : ST_MBus_Info; st Power Reactive Total : ST_MBus_Info; st Power Apparent Total : ST_MBus_Info; st Power Factor Total : ST_MBus_Info; st Frequency : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. 188 Version: 1.8.0 TE1000
## Page 189

Programming Name Type Description b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Current Phase1 ST_MBus_Info [} 216] Current phase 1 st Current Phase2 ST_MBus_Info [} 216] Current phase 2 st Current Phase3 ST_MBus_Info [} 216] Current phase 3 st Current Average ST_MBus_Info [} 216] Average current st Voltage L1N ST_MBus_Info [} 216] Voltage L1-N st Voltage L2N ST_MBus_Info [} 216] Voltage L2-N st Voltage L3N ST_MBus_Info [} 216] Voltage L3-N st Voltage Average LN ST_MBus_Info [} 216] Average voltage L-N st Voltage L1L2 ST_MBus_Info [} 216] Voltage L1-L2 st Voltage L2L3 ST_MBus_Info [} 216] Voltage L2-L3 st Voltage L3L1 ST_MBus_Info [} 216] Voltage L3-L1 st Voltage Average LL ST_MBus_Info [} 216] Average voltage L-L st Power Active Phase ST_MBus_Info [} 216] Active power phase 1 1 st Power Active Phase ST_MBus_Info [} 216] Active power phase 2 2 st Power Active Phase ST_MBus_Info [} 216] Active power phase 3 3 st Power Active Total ST_MBus_Info [} 216] Total active power st Power Reactive Tot ST_MBus_Info [} 216] Total reactive power al st Power Apparent Tot ST_MBus_Info [} 216] Total apparent power al st Power Factor Total ST_MBus_Info [} 216] Power factor st Frequency ST_MBus_Info [} 216] Frequency Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.32 Tc2_MBus from 3.4.6.0 TE1000 Version: 1.8.0 189
## Page 190

Programming 4.1.31 Sensus overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Sensus Heat/cold meter Pollu Stat E FB_MBUS_SEN_Pollu [} 190] Heat/cold meter Pollu Therm FB_MBUS_SEN_Pollu [} 190] Heat/cold meter Pollu Com E FB_MBUS_SEN_Pollu [} 190] Water meter FB_MBUS_SEN_Water [} 192] 4.1.31.1 FB_MBUS_SEN_Pollu The function block FB_MBUS_SEN_Pollu is used to read heat/cold meters from Sensus: -Pollu Stat E -Pollu Com E -Pollu Therm The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] 190 Version: 1.8.0 TE1000
## Page 191

Programming Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Diff Temp : ST_MBus_Info; END_VAR TE1000 Version: 1.8.0 191
## Page 192

Programming Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Diff Temp ST_MBus_Info [} 216] Temperature difference Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.31.2 FB_MBUS_SEN_Water The function block FB_MBUS_SEN_Water is used to read water meters from Sensus. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. 192 Version: 1.8.0 TE1000
## Page 193

Programming Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; END_VAR TE1000 Version: 1.8.0 193
## Page 194

Programming Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.32 Sontex overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Sontex Heat/cold meter Supercal 531 (default FB_MBUS_SON_Supercal5 values) 31 [} 195] 194 Version: 1.8.0 TE1000
## Page 195

Programming 4.1.32.1 FB_MBUS_SON_Supercal531 The function block FB_MBUS_SON_Supercal531 is used to read heat/cold meters from Sontex: -Supercal 531 The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. TE1000 Version: 1.8.0 195
## Page 196

Programming Name Type Description st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Power : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Energy Tariff1 : ST_MBus_Info; st Volume Tariff1 : ST_MBus_Info; st Energy Tariff2 : ST_MBus_Info; st Volume Tariff2 : ST_MBus_Info; st Typ Tariff1 : ST_MBus_Info; st Limit Low Tariff1 : ST_MBus_Info; st Limit High Tariff1 : ST_MBus_Info; st Typ Tariff2 : ST_MBus_Info; st Limit Low Tariff2 : ST_MBus_Info; st Limit High Tariff2 : ST_MBus_Info; st Device Error : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. 196 Version: 1.8.0 TE1000
## Page 197

Programming Name Type Description e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Meter reading, energy consumption st Power ST_MBus_Info [} 216] Current energy consumption, power st Volume ST_MBus_Info [} 216] Meter reading, water consumption st Flow ST_MBus_Info [} 216] Current water consumption st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Energy Tariff1 ST_MBus_Info [} 216] Meter reading, energy consumption tariff 1 st Volume Tariff1 ST_MBus_Info [} 216] Meter reading, water consumption tariff 1 st Energy Tariff2 ST_MBus_Info [} 216] Meter reading, energy consumption tariff 2 st Volume Tariff2 ST_MBus_Info [} 216] Meter reading, water consumption tariff 2 st Type Tariff1 ST_MBus_Info [} 216] Type tariff 1 st Limit Low Tariff1 ST_MBus_Info [} 216] Lower limit value tariff 1 st Limit High Tariff1 ST_MBus_Info [} 216] Upper limit value tariff 1 st Type Tariff2 ST_MBus_Info [} 216] Type tariff 2 st Limit Low Tariff2 ST_MBus_Info [} 216] Lower limit value tariff 2 st Limit High Tariff2 ST_MBus_Info [} 216] Upper limit value tariff 2 st Device Error ST_MBus_Info [} 216] Error message from the device Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.33 TIP The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block TIP Electricity meter SINUS 85 M FB_MBUS_TIP_SINUS85M [} 198] TE1000 Version: 1.8.0 197
## Page 198

Programming 4.1.33.1 FB_MBUS_TIP_SINUS85M The function block FB_MBUS_TIP_SINUS85M is used to read electricity meters from Thüringer Industrie Produkte Gmb H. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; 198 Version: 1.8.0 TE1000
## Page 199

Programming b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 600, 1200, 2400, 4800, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Active Power Tariff1 : ST_MBus_Info; st Active Power Tariff2 : ST_MBus_Info; st Apparent Power L1 : ST_MBus_Info; st Apparent Power L2 : ST_MBus_Info; st Apparent Power L3 : ST_MBus_Info; st Apparent Power Total : ST_MBus_Info; st Active Power L1 : ST_MBus_Info; st Active Power L2 : ST_MBus_Info; st Active Power L3 : ST_MBus_Info; st Active Power Total : ST_MBus_Info; st Reactive Power L1 : ST_MBus_Info; st Reactive Power L2 : ST_MBus_Info; st Reactive Power L3 : ST_MBus_Info; st Reactive Power Total : ST_MBus_Info; st Voltage L1 : ST_MBus_Info; st Voltage L2 : ST_MBus_Info; st Voltage L3 : ST_MBus_Info; st Power Line Frequency : ST_MBus_Info; TE1000 Version: 1.8.0 199
## Page 200

Programming st Current Tariff : ST_MBus_Info; st Current L1 : ST_MBus_Info; st Current L2 : ST_MBus_Info; st Current L3 : ST_MBus_Info; st Current Total : ST_MBus_Info; st Power Factor L1 : ST_MBus_Info; st Power Factor L2 : ST_MBus_Info; st Power Factor L3 : ST_MBus_Info; st Power Factor Total : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Active Power Tariff1 ST_MBus_Info [} 216] Active energy import tariff 1 st Active Power Tariff2 ST_MBus_Info [} 216] Active energy import tariff 2 st Apparent Power L1 ST_MBus_Info [} 216] Current apparent power L1 st Apparent Power L2 ST_MBus_Info [} 216] Current apparent power L2 st Apparent Power L3 ST_MBus_Info [} 216] Current apparent power L3 st Apparent Power Tot ST_MBus_Info [} 216] Current measured apparent power al st Active Power L1 ST_MBus_Info [} 216] Current active power phase L1 st Active Power L2 ST_MBus_Info [} 216] Current active power phase L2 st Active Power L3 ST_MBus_Info [} 216] Current active power phase L3 st Active Power Total ST_MBus_Info [} 216] Current active power Total st Reactive Power L1 ST_MBus_Info [} 216] Current reactive power phase L1 st Reactive Power L2 ST_MBus_Info [} 216] Current reactive power phase L2 st Reactive Power L3 ST_MBus_Info [} 216] Current reactive power phase L3 st Reactive Power Tot ST_MBus_Info [} 216] Current reactive power Total al st Voltage L1 ST_MBus_Info [} 216] Current voltage phase L1 st Voltage L2 ST_MBus_Info [} 216] Current voltage phase L2 st Voltage L3 ST_MBus_Info [} 216] Current voltage phase L3 st Power Line Frequen ST_MBus_Info [} 216] Current mains frequency cy st Current Tariff ST_MBus_Info [} 216] Current tariff st Current L1 ST_MBus_Info [} 216] Instantaneous current phase L1 st Current L2 ST_MBus_Info [} 216] Instantaneous current phase L2 st Current L3 ST_MBus_Info [} 216] Instantaneous current phase L3 200 Version: 1.8.0 TE1000
## Page 201

Programming Name Type Description st Current Total ST_MBus_Info [} 216] Instantaneous current Total st Power Factor L1 ST_MBus_Info [} 216] Current form factor phase L1 (cos Phi) st Power Factor L2 ST_MBus_Info [} 216] Current form factor phase L2 (cos Phi) st Power Factor L3 ST_MBus_Info [} 216] Current form factor phase L3 (cos Phi) st Power Factor Total ST_MBus_Info [} 216] Current form factor Total (cos Phi) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.32 Tc2_MBus from 3.4.6.0 4.1.34 Zenner overview The function blocks only output a selection of the most common data. These data are described on the respective pages under "Outputs". If more or all data is required, the function blocks FB_MBUS_General [} 80], FB_MBUS_General_Ext [} 84] or FB_MBUS_General_Param [} 88] from the "General [} 78]" folder should be used. Note that these function blocks cannot be run on BC and BX systems. If data must be sent to the device (e.g. setting the primary address), the function block FB_MBUS_General_Send [} 90] can be used. Vendor Type Device Function block Zenner Arithmetic unit multidata WR3 FB_MBUS_ZRM_multidata WR3 [} 202] Heat meter zelsius ZR FB_MBUS_ZRM_zelsius ZR [} 205] TE1000 Version: 1.8.0 201
## Page 202

Programming 4.1.34.1 FB_MBUS_ZRM_multidata WR3 The function block FB_MBUS_ZRM_multidata WR3 is used to read arithmetic units from Zenner. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. 202 Version: 1.8.0 TE1000
## Page 203

Programming Name Type Description b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Volume Input1 : ST_MBus_Info; st Volume Input2 : ST_MBus_Info; st Device Error : ST_MBus_Info; st Timepoint : ST_MBus_Info; st Energy Timepoint : ST_MBus_Info; st Counter Input1 : ST_MBus_Info; st Counter Input2 : ST_MBus_Info; st Volume : ST_MBus_Info; st Flow : ST_MBus_Info; st Power : ST_MBus_Info; st Forward Temp : ST_MBus_Info; st Return Temp : ST_MBus_Info; st Device Clock : ST_MBus_Info; st Battery End Date : ST_MBus_Info; st Flow Max Timepoint : ST_MBus_Info; st Flow Max : ST_MBus_Info; st Power Max Timepoint : ST_MBus_Info; st Power Max : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) TE1000 Version: 1.8.0 203
## Page 204

Programming Name Type Description by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Current thermal energy st Volume Input1 ST_MBus_Info [} 216] Volume input 1 st Volume Input2 ST_MBus_Info [} 216] Volume input 2 st Device Error ST_MBus_Info [} 216] Error state MBus output st Timepoint ST_MBus_Info [} 216] Due day (date and time of the next due day) st Energy Timepoint ST_MBus_Info [} 216] Thermal energy on the due day st Counter Input1 ST_MBus_Info [} 216] Counter value input 1 on the due day st Counter Input2 ST_MBus_Info [} 216] Counter value input 2 on the due day st Volume ST_MBus_Info [} 216] Volume st Flow ST_MBus_Info [} 216] Current flow rate st Flow ST_MBus_Info [} 216] Power st Forward Temp ST_MBus_Info [} 216] Flow temperature st Return Temp ST_MBus_Info [} 216] Return temperature st Device Clock ST_MBus_Info [} 216] Current time of the meter st Battery End Date ST_MBus_Info [} 216] Estimated battery life st Flow Max Timepoint ST_MBus_Info [} 216] Storage time Maximum flow rate (absolute) st Flow Max ST_MBus_Info [} 216] Maximum flow rate (absolute) st Power Max Timepoi ST_MBus_Info [} 216] Storage time Maximum power value (absolute) nt st Power Max ST_MBus_Info [} 216] Maximum power value (absolute) Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 204 Version: 1.8.0 TE1000
## Page 205

Programming 4.1.34.2 FB_MBUS_ZRM_zelsius ZR The function block FB_MBUS_ZRM_zelsius ZR is used to read heat meters from Zenner. The function block can only be executed together with the function block FB_MBUSKL6781() [} 18]. Further information See Operating principle of the function block [} 10] Inputs VAR_INPUT usi Address : USINT; st Sec Adr : ST_MBUS_Sec Adr; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; b Start : BOOL; b SND_NKE : BOOL := TRUE; b Read Init : BOOL := TRUE; t Min Send Time : TIME := t#2s; usi Unit : USINT; b Disabled : BOOL := FALSE; END_VAR Name Type Description usi Address USINT Primary address [} 11] of the meter to be read with this function block. st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address [} 12] of the meter to be read with this function block. e Baudrate E_MBUS_Baudrate [} 209] 300, 2400, 9600 baud b Start BOOL All meters are read once on the positive edge of this input. b SND_NKE BOOL TRUE initializes the meter for each read operation and sets the meter to the first telegram (SND_NKE). b Read Init BOOL If the PLC is restarted, the meter is read once. t Min Send Time TIME Default t#2s. The meter is read again, once the time set here has elapsed. If t#0s the meter is not read and can be read manually with b Start. usi Unit USINT Unit of the energy values to be output by the function block. 0=W(h) / 1=KW(h) / 2 =MW(h) / 3=GW(h). b Disabled BOOL TRUE = deselection of the function block TE1000 Version: 1.8.0 205
## Page 206

Programming Inputs/outputs VAR_IN_OUT st Com : ST_MBUS_Communication; END_VAR Name Type Description st Com ST_MBUS_Communication This structure is used to link the function block [} 215] FB_MBUSKL6781() [} 215] with the meter blocks. Outputs VAR_OUTPUT b Busy : BOOL; b Ready : BOOL; b Error : BOOL; e Error : E_MBUS_ERROR; dw Id Number : DWORD; by Status : BYTE; by GEN : BYTE; by Counter : BYTE; usi Recived Adr : USINT; e Medium : E_MBUS_Medium; s Man : STRING(3); st Energy : ST_MBus_Info; st Volume Input1 : ST_MBus_Info; st Volume Input2 : ST_MBus_Info; st Device Error : ST_MBus_Info; st Timepoint : ST_MBus_Info; st Energy Timepoint : ST_MBus_Info; st Counter Input1 : ST_MBus_Info; st Counter Input2 : ST_MBus_Info; END_VAR Name Type Description b Busy BOOL The b Busy output is TRUE as long as the meter is being read. b Ready BOOL The b Ready output is TRUE for one cycle, once meter reading is completed. b Error BOOL This output goes TRUE as soon as an error occurs. This error is described via the e Error variable. e Error E_MBUS_ERROR [} 210] This output outputs an error code in the event of an error. b Error goes TRUE at the same time. dw Id Number DWORD Serial number of the meter (secondary address) by Status BYTE Device status by GEN BYTE Software version of the device by Counter BYTE Number of times the master has accessed data of the respective slave usi Recived Adr USINT Received primary address (0-250) e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign st Energy ST_MBus_Info [} 216] Current thermal energy st Volume Input1 ST_MBus_Info [} 216] Volume input 1 st Volume Input2 ST_MBus_Info [} 216] Volume input 2 st Device Error ST_MBus_Info [} 216] Error state MBus output st Timepoint ST_MBus_Info [} 216] Due day (date and time of the next due day) st Energy Timepoint ST_MBus_Info [} 216] Thermal energy on the due day st Counter Input1 ST_MBus_Info [} 216] Counter value input 1 on the due day st Counter Input2 ST_MBus_Info [} 216] Counter value input 2 on the due day 206 Version: 1.8.0 TE1000
## Page 207

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.1.35 Error codes Value Value Value (enum) Description (hex) (dec) 0x000 0 e MBUS_no_error There is no error on the function block, the function 0 block is not currently querying a meter. 0x000 1 e MBUS_busy The function block queries a meter. 1 0x000 3 e MBUS_Disabled The function block is disabled. 3 0x000 4 e MBUS_FBKL6781_Disabled The function block FB_MBUSKL6781() [} 18] is 4 disabled. 0x006 101 e MBUSERROR_CIField_wrong_72hex The 7th byte in the answer telegram contains the CI 5 _expected field. In this byte the hexadecimal number 72 is expected. It stands for variable data structure, low byte is sent first. Only this data structure is supported. 0x006 102 e MBUSERROR_no_data_received No data was received. 6 0x006 103 e MBUSERROR_error_checksum The answer telegram includes a checksum (sum of 7 all bytes from byte 5). The received checksum does not match the calculated checksum. This happens if the protocol was not received cleanly (e.g. in the event of interference on the cable or if the cable is too long). 0x006 104 e MBUSERROR_error_in_head_data The first 4 bytes are not included in the checksum. 8 These 4 bytes are monitored separately. 0x006 105 e MBUSERROR_usi Address_over_250 Addresses higher than 250 are not permitted. The 9 input usi Address of the meter block has been assigned a value above 250 (exception: address 254. This address can be used if only one meter is connected). 0x006 106 e MBUSERROR_send_error Error message for error during sending. A 0x006 108 e MBUSERROR_received_address_wr Received address does not match the sent address. C ong 0x006 109 e MBUSERROR_c MBUS_Max Com_bel Reserve. D ow_1 0x006 110 e MBUSERROR_i Com Id_over_c MBUS Reserve. E _Max Com 0x006 111 e MBUSERROR_manufacturer_sign_wr The answer telegram includes a manufacturer sign. F ong This sign is allocated to the meter blocks. This message appears if the received manufacturer sign does not match the function block used. 0x007 112 e MBUSERROR_baudrate_wrong Input e Baudrate of the function block was assigned 0 invalid values. Only E_MBUS_Baudrate [} 209] are allowed. 0x007 113 e MBUSERROR_Receive Buffer Full The receive buffer of the serial interface is full. This 1 may happen with long telegrams and/or long cycle times. The PLC is unable to read the data quick TE1000 Version: 1.8.0 207
## Page 208

Programming Value Value Value (enum) Description (hex) (dec) enough from the receive buffer, resulting in data loss. The situation may be resolved by reducing the cycle time. 0x007 114 e MBUSERROR_E5hex_no_received No single character E5 hexadecimal was received 2 after initialization of the meter. 0x007 115 e MBUSERROR_no_stop_character No end character in the data array. 3 0x007 116 e MBUSERROR_length_wrong Number of received characters <> the length field. 4 0x007 117 e MBUSERROR_wrong_terminal Incorrect terminal connected. 5 0x007 118 e MBUSERROR_Terminal_is_not_initial The terminal is not initialized. This message usually 6 ized means that there is no connection to the terminal. Terminal linked to the variables in the System Manager? Terminal plugged in incorrectly? Clean all, rebuild all and read again in the System Manager? 0x007 119 e MBUSERROR_st Sec Adr_udi Id Numb The input variable st Sec Adr.udi Id Number is not 7 er_wrong assigned. 0x007 120 e MBUSERROR_missing_parts_telegra Not all telegram values were received. 8 m 0x007 121 e MBUSERROR_no_stop_character_re No stop character was received (16hex). 9 ceived 0x007 122 e MBUSERROR_too_many_characters Too many characters were received. A 0x007 123 e MBUSERROR_Time Out_FB_KL6781 Timeout FB_KL6781. B 0x007 124 e MBUSERROR_Time Out_Meter FB Meter block timeout. C 0x00C 201 e MBUSERROR_COM_PARAMETERC Input parameters have changed during reception. 9 HANGED 0x00C 202 e MBUSERROR_COM_TXBUFFOVER String > transfer buffer. A RUN 0x00D 210 e MBUSERROR_COM_STRINGOVER End of the string. 2 RUN 0x00D 211 e MBUSERROR_COM_ZEROCHARIN String may not contain any zero characters. 3 VALID 0x00D 220 e MBUSERROR_COM_INVALIDPOINT Invalid data pointer, e.g. zero. C ER 0x00D 221 e MBUSERROR_COM_INVALIDRXPOI Invalid data pointer for Receive Data. D NTER 0x00D 222 e MBUSERROR_COM_INVALIDRXLE Invalid length for Receive Data e.g. zero. E NGTH 0x00D 223 e MBUSERROR_COM_DATASIZEOVE End of the data block. F RRUN 0x100 4097 e MBUSERROR_COM_INVALIDBAUD Invalid baud rate. 1 RATE 0x100 4098 e MBUSERROR_COM_INVALIDNUMD Invalid data bits. 2 ATABITS 0x100 4099 e MBUSERROR_COM_INVALIDNUMS Invalid stop bits. 3 TOPBITS 0x100 4100 e MBUSERROR_COM_INVALIDPARIT Invalid parity. 4 Y 208 Version: 1.8.0 TE1000
## Page 209

Programming Value Value Value (enum) Description (hex) (dec) 0x100 4101 e MBUSERROR_COM_INVALIDHAND Invalid handshake. 5 SHAKE 0x100 4102 e MBUSERROR_COM_INVALIDNUMR Invalid num register. 6 EGISTERS 0x100 4103 e MBUSERROR_COM_INVALIDREGIS Invalid register. 7 TER 0x100 4109 e MBUSERROR_COM_TIMEOUT COM timeout. 8 4.2 DUTs 4.2.1 Enums 4.2.1.1 E_MBUS_Baudrate Configurable baud rates TYPE E_MBUS_Baudrate : ( e MBUS_No Baudrate := 0, e MBUS_Baud300 := 30, e MBUS_Baud600 := 60, e MBUS_Baud1200 := 120, e MBUS_Baud2400 := 240, e MBUS_Baud4800 := 480, e MBUS_Baud9600 := 960 ) END_TYPE Name Description e MBUS_No Baudrate Standard baud rate = 2400 baud e MBUS_Baud300 300 baud e MBUS_Baud600 600 baud e MBUS_Baud1200 1200 baud e MBUS_Baud2400 2400 baud e MBUS_Baud4800 4800 baud e MBUS_Baud9600 9600 baud M-Bus meters are generally supplied with 2400 baud. Die KL6781 unterstützt 300, 600, 1200, 2400, 4800, 9600 baud. The KL6781 interface is set to e Baudrate when the PLC starts or when the input e Baudrate changes. Not all M-Bus devices support baud rates above 2400. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 209
## Page 210

Programming 4.2.1.2 E_MBUS_Error Error messages. TYPE E_MBUS_Error : ( e MBUS_no_error := 0, e MBUS_busy := 1, e MBUS_Disabled := 3, e MBUS_FBKL6781_Disabled := 4, e MBUSERROR_CIField_wrong_72hex_expected := 101, e MBUSERROR_no_data_received := 102, e MBUSERROR_error_checksum := 103, e MBUSERROR_error_in_head_data := 104, e MBUSERROR_usi Address_over_250 := 105, e MBUSERROR_send_error := 106, e MBUSERROR_received_address_wrong := 108, e MBUSERROR_c MBUS_Max Com_below_1 := 109, e MBUSERROR_i Com Id_over_c MBUS_Max Com := 110, e MBUSERROR_manufacturer_sign_wrong := 111, e MBUSERROR_baudrate_wrong := 112, e MBUSERROR_Receive Buffer Full := 113, e MBUSERROR_E5hex_no_received := 114, e MBUSERROR_no_stop_character := 115, e MBUSERROR_length_wrong := 116, e MBUSERROR_wrong_terminal := 117, e MBUSERROR_Terminal_is_not_initialized := 118, e MBUSERROR_st Sec Adr_udi Id Number_wrong := 119, e MBUSERROR_missing_parts_telegram := 120, e MBUSERROR_no_stop_character_received := 121, e MBUSERROR_too_many_characters := 122, e MBUSERROR_Time Out_FB_KL6781 := 123, e MBUSERROR_Time Out_Meter FB := 124, e MBUSERROR_COM_PARAMETERCHANGED := 201, e MBUSERROR_COM_TXBUFFOVERRUN := 202, e MBUSERROR_COM_STRINGOVERRUN := 210, e MBUSERROR_COM_ZEROCHARINVALID := 211, e MBUSERROR_COM_INVALIDPOINTER := 220, e MBUSERROR_COM_INVALIDRXPOINTER := 221, e MBUSERROR_COM_INVALIDRXLENGTH := 222, e MBUSERROR_COM_DATASIZEOVERRUN := 223, e MBUSERROR_COM_INVALIDBAUDRATE := 16#1001, e MBUSERROR_COM_INVALIDNUMDATABITS := 16#1002, e MBUSERROR_COM_INVALIDNUMSTOPBITS := 16#1003, e MBUSERROR_COM_INVALIDPARITY := 16#1004, e MBUSERROR_COM_INVALIDHANDSHAKE := 16#1005, e MBUSERROR_COM_INVALIDNUMREGISTERS := 16#1006, e MBUSERROR_COM_INVALIDREGISTER := 16#1007, e MBUSERROR_COM_TIMEOUT := 16#1008 ) END_TYPE Name Description e MBUS_no_error No error at the function block. The function block does not currently query a meter. e MBUS_busy The function block is querying a meter. e MBUS_Disabled The function block is disabled. e MBUS_FBKL6781_Disabled The function block FB_MBUS_KL6781() [} 18] is disabled. e MBUSERROR_CIField_wro The 7th byte in the answer telegram contains the CI field. In this byte the ng_72hex_expected hexadecimal number 72 is expected. It stands for variable data structure, low byte is sent first. Only this data structure is supported. e MBUSERROR_no_data_rec No data was received. eived e MBUSERROR_error_check The answer telegram includes a checksum (sum of all bytes from byte 5). sum The received checksum does not match the calculated checksum. This happens if the protocol was not received cleanly (e.g. in the event of interference on the cable or if the cable is too long). e MBUSERROR_error_in_he The first 4 bytes are not included in the checksum. These 4 bytes are ad_data monitored separately. 210 Version: 1.8.0 TE1000
## Page 211

Programming Name Description e MBUSERROR_usi Address_ Addresses higher than 250 are not permitted. The input usi Address of the over_250 meter block has been assigned a value above 250 (exception: address 254. This address can be used if only one meter is connected). e MBUSERROR_send_error Error message for error during sending. e MBUSERROR_received_ad Received address does not match the sent address. dress_wrong e MBUSERROR_c MBUS_Ma Reserve x Com_below_1 e MBUSERROR_i Com Id_ove Reserve r_c MBUS_Max Com e MBUSERROR_manufacture The answer telegram includes a manufacturer sign. This sign is allocated to r_sign_wrong the meter blocks. This message appears if the received manufacturer sign does not match the function block used. e MBUSERROR_baudrate_wr Input e Baudrate of the function block was assigned invalid values. Only ong E_MBUS_Baudrate [} 209] are allowed. e MBUSERROR_Receive Buff The receive buffer of the serial interface is full. This may happen with long er Full telegrams and/or long cycle times. The PLC is unable to read the data quick enough from the receive buffer, resulting in data loss. The situation may be resolved by reducing the cycle time. e MBUSERROR_E5hex_no_r No single character E5 hexadecimal was received after initialization of the eceived meter. e MBUSERROR_no_stop_ch No end character in the data array. aracter e MBUSERROR_length_wron Number of received characters <> the length field. g e MBUSERROR_wrong_termi Incorrect terminal connected. nal e MBUSERROR_Terminal_is The terminal is not initialized. This message usually means that there is no _not_initialized connection to the terminal. Terminal linked to the variables in the System Manager? Terminal plugged in incorrectly? Clean all, rebuild all and read again in the System Manager? e MBUSERROR_st Sec Adr_u The input variable st Sec Adr.udi Id Number is not assigned di Id Number_wrong e MBUSERROR_missing_par Not all telegram values were received. ts_telegram e MBUSERROR_no_stop_ch No stop character was received (16hex). aracter_received e MBUSERROR_too_many_c Too many characters were received. haracters e MBUSERROR_Time Out_F Timeout FB_KL6781. B_KL6781 e MBUSERROR_Time Out_M Meter block timeout. eter FB e MBUSERROR_COM_PAR Input parameters have changed during reception. AMETERCHANGED e MBUSERROR_COM_TXBU String > transfer buffer. FFOVERRUN e MBUSERROR_COM_STRI End of the string. NGOVERRUN e MBUSERROR_COM_ZER String may not contain any zero characters. OCHARINVALID e MBUSERROR_COM_INVA Invalid data pointer, e.g. zero. LIDPOINTER e MBUSERROR_COM_INVA Invalid data pointer for Receive Data. LIDRXPOINTER TE1000 Version: 1.8.0 211
## Page 212

Programming Name Description e MBUSERROR_COM_INVA Invalid length for Receive Data e.g. zero. LIDRXLENGTH e MBUSERROR_COM_DATA End of the data block. SIZEOVERRUN e MBUSERROR_COM_INVA Invalid baud rate. LIDBAUDRATE e MBUSERROR_COM_INVA Invalid data bits. LIDNUMDATABITS e MBUSERROR_COM_INVA Invalid stop bits. LIDNUMSTOPBITS e MBUSERROR_COM_INVA Invalid parity. LIDPARITY: e MBUSERROR_COM_INVA Invalid handshake. LIDHANDSHAKE e MBUSERROR_COM_INVA Invalid num register. LIDNUMREGISTERS e MBUSERROR_COM_INVA Invalid register. LIDREGISTER e MBUSERROR_COM_TIME COM timeout. OUT: COM Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.1.3 E_MBus_Fct Value function. TYPE E_MBus_Fct : ( e MBUS_Value Null := -1, e MBUS_Instantaneous Value := 0, e MBUS_Max := 1, e MBUS_Min := 2, e MBUS_Value During Error State := 3, e MBUS_Manufacturer Specific := 256 ) END_TYPE Name Description e MBUS_Value Null Not assigned. e MBUS_Instantaneous Value Instantaneous value. e MBUS_Max Maximum value. e MBUS_Min Minimum value. e MBUS_Value During Error St Faulty value. ate e MBUS_Manufacturer Specifi Manufacturer-specific. c Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 212 Version: 1.8.0 TE1000
## Page 213

Programming 4.2.1.4 E_MBUS_Medium Medium TYPE E_MBUS_Medium : ( e MBUS_Medium Null := -1, e MBUS_Medium Other := 0, e MBUS_Medium Oil := 1, e MBUS_Medium Electricity := 2, e MBUS_Medium Gas := 3, e MBUS_Medium Heat_Outlet := 4, e MBUS_Medium Steam := 5, e MBUS_Medium Hot_Water := 6, e MBUS_Medium Water := 7, e MBUS_Medium Heat_Cost_Allocator := 8, e MBUS_Medium Compressed_Air := 9, e MBUS_Medium Cooling_load_meter_outlet := 10, e MBUS_Medium Cooling_load_meter_intlet := 11, e MBUS_Medium Heat_inlet := 12, e MBUS_Medium Heat_cooling_load_Meter := 13, e MBUS_Medium Bus System := 14, e MBUS_Medium Unknown Medium := 15, e MBUS_Medium Reserved16 := 16, e MBUS_Medium Reserved17 := 17, e MBUS_Medium Reserved18 := 18, e MBUS_Medium Reserved19 := 19, e MBUS_Medium Reserved20 := 20, e MBUS_Medium Reserved21 := 21, e MBUS_Medium Cold Water := 22, e MBUS_Medium Dual Water := 23, e MBUS_Medium Pressure := 24, e MBUS_Medium A_D_Converter := 25, e MBUS_Medium Reserved26 := 26, e MBUS_Medium Reserved27 := 27, e MBUS_Medium Reserved28 := 28, e MBUS_Medium Reserved29 := 29, e MBUS_Medium Reserved30 := 30 ) END_TYPE Name Description e MBUS_Medium Null Not assigned. e MBUS_Medium Other Other e MBUS_Medium Oil Oil e MBUS_Medium Electricity Electricity e MBUS_Medium Gas Gas e MBUS_Medium Heat_Outlet Heat (outlet) e MBUS_Medium Steam Steam e MBUS_Medium Hot_Water Hot water e MBUS_Medium Water Water e MBUS_Medium Heat_Cost_ Heating cost distributor Allocator e MBUS_Medium Compresse Compressed air d_Air e MBUS_Medium Cooling_loa Cooling (outlet) d_meter_outlet e MBUS_Medium Cooling_loa Cooling (inlet) d_meter_intlet e MBUS_Medium Heat_inlet Heat (inlet) e MBUS_Medium Heat_coolin Heating / cooling g_load_Meter e MBUS_Medium Bus System Bus / system e MBUS_Medium Unknown Me Unknown dium e MBUS_Medium Reserved16 Reserved TE1000 Version: 1.8.0 213
## Page 214

Programming Name Description e MBUS_Medium Reserved17 Reserved e MBUS_Medium Reserved18 Reserved e MBUS_Medium Reserved19 Reserved e MBUS_Medium Reserved20 Reserved e MBUS_Medium Reserved21 Reserved e MBUS_Medium Cold Water Cold water e MBUS_Medium Dual Water Dual water e MBUS_Medium Pressure Pressure e MBUS_Medium A_D_Conve A/D converter rter e MBUS_Medium Reserved26 Reserved e MBUS_Medium Reserved27 Reserved e MBUS_Medium Reserved28 Reserved e MBUS_Medium Reserved29 Reserved e MBUS_Medium Reserved30 Reserved Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.2 Structures 4.2.2.1 ST_KL6781out Data22B Process image of the outputs. Linked to the terminals in the System Manager. TYPE ST_KL6781out Data22B : STRUCT Ctrl : WORD; D : ARRAY[0..21] OF BYTE; END_STRUCT END_TYPE Name Type Description Ctrl WORD Control word. D ARRAY OF BYTE 22 bytes for the output data of the M-Bus. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.2.2 ST_KL6781in Data22B Process image of the inputs. Linked to the terminals in the System Manager. TYPE ST_KL6781in Data22B : STRUCT Status : WORD; D : ARRAY[0..21] OF BYTE; END_STRUCT END_TYPE 214 Version: 1.8.0 TE1000
## Page 215

Programming Name Type Description Status WORD Status word D ARRAY OF BYTE 22 bytes for the output data of the M-Bus. Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.2.3 ST_MBUS_Communication Internal structure. This structure is used to link the function block FB_MBUSKL6781() [} 18] with the meter blocks. TYPE ST_MBUS_Communication : STRUCT b Start : BOOL; b Busy : BOOL; b SND_NKE : BOOL; b Send : BOOL; b Start Manuell : BOOL; b Blockade Sec Adr : BOOL; usi Address : USINT; by CField : BYTE; st Sec Adr : ST_MBUS_Sec Adr; e Error : E_MBUS_ERROR; e Baudrate : E_MBUS_Baudrate := e MBUS_Baud2400; arr MBus Long Frame : ARRAY[1..260] OF BYTE; by Send Byte : BYTE; ui Max Count : UINT; ui Count : UINT; st Kom Rx Buffer : ST_KL6781Com Buffer; st Kom Tx Buffer : ST_KL6781Com Buffer; END_STRUCT END_TYPE Name Type Description b Start BOOL Start b Busy BOOL This bit is set for as long as the function block is active. b SND_NKE BOOL SND_NKE is sent. b Send BOOL Data is being sent. b Start Manual BOOL Manual start b Blockade Sec Adr BOOL Secondary addressing results in blocking. usi Address USINT Primary address by CField BYTE C field st Sec Adr ST_MBUS_Sec Adr [} 217] Secondary address e Error E_MBUS_ERROR [} 210] Error number e Baudrate E_MBUS_Baudrate [} 209] Baud rate arr MBus Long Frame ARRAY OF BYTE Sent or received bytes. by Send Byte BYTE Number of sent bytes. ui Max Count UINT Maximum number of read commands ui Count UINT Current read command st Kom Rx Buffer ST_KL6781Com Buffer Receive buffer st Kom Tx Buffer ST_KL6781Com Buffer Transmit buffer Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 TE1000 Version: 1.8.0 215
## Page 216

Programming 4.2.2.4 ST_MBus_Data Value information. TYPE ST_MBus_Data : STRUCT s Value : STRING(25); s Unit : STRING(20); s Info : STRING; e Fct : E_MBus_Fct; i Tariff : INT; i Stor No : INT; i Unit : INT; by VIFE : BYTE; END_STRUCT END_TYPE Name Type Description s Value STRING Value s Unit STRING Unit s Info STRING Information e Fct E_MBus_Fct [} 212] Function i Tariff INT Tariff i Stor No INT Storage number i Unit INT Unit (integer) by VIFE BYTE VIFE Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.2.5 ST_MBus_Data2 Structure of the output values in the function block FB_MBUS_General_Ext() [} 84]. TYPE ST_MBus_Data2 : STRUCT arr Data : ARRAY[1..c MBUS_Max Data] OF ST_MBus_Data; END_STRUCT END_TYPE Name Type Description arr Data ARRAY OF Values ST_MBus_Data [} 216] Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.2.6 ST_MBus_Info Value information. TYPE ST_MBus_Info : STRUCT s Value : STRING(25); s Unit : STRING(20); e Fct : E_MBus_Fct; END_STRUCT END_TYPE 216 Version: 1.8.0 TE1000
## Page 217

Programming Name Type Description s Value STRING Value s Unit STRING Unit e Fct E_MBus_Fct [} 212] Function M-Bus devices may supply very large values, which cannot be displayed or can only be displayed inaccurately as numbers on BC/BX systems. The values are therefore supplied as strings (s Value). Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.2.7 ST_MBUS_Sec Adr Secondary address of a meter. TYPE ST_MBUS_Sec Adr : STRUCT udi Id Number : UDINT := 16#FFFFFFFF; ui Manufacturer : UINT := 16#FFFF; usi Version : USINT := 16#FF; usi Medium : USINT := 16#FF; END_STRUCT END_TYPE Name Type Description udi Id Number UDINT Serial number of the meter ui Manufacturer UINT Manufacturer sign usi Version USINT Meter software version usi Medium USINT Medium Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.2.8 ST_MBus_Scan Scanning information. TYPE ST_MBus_Scan : STRUCT usi Address : USINT; dw Id Number : DWORD; by Status : BYTE; e Medium : E_MBUS_Medium; s Man : STRING(3); by GEN : BYTE; END_STRUCT END_TYPE Name Type Description usi Address USINT Primary address [} 11] of the meter. dw Id Number DWORD Serial number of the meter (secondary address). by Status BYTE Status e Medium E_MBUS_Medium [} 213] Medium s Man STRING Manufacturer sign. by GEN BYTE Software version of the device TE1000 Version: 1.8.0 217
## Page 218

Programming Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.2.9 Hydrometer Data types Description ST_MBUS_Due Day HYD1 [} 218] Structure of the cutoff date values in the block FB_MBUS_HYD_Sharky_00 [} 111] 4.2.2.9.1 ST_MBUS_Due Day HYD1 Structure of the due day values in the function block FB_MBUS_HYD_Sharky_00() [} 111]. TYPE ST_MBUS_Due Day HYD1 : STRUCT st Energy : ST_MBus_Info; st Volume : ST_MBus_Info; st Tariff1 : ST_MBus_Info; st Tariff2 : ST_MBus_Info; st Date : ST_MBus_Info; st Date Future Due Day : ST_MBus_Info; END_STRUCT END_TYPE Name Type Description st Energy ST_MBus_Info [} 216] Meter reading energy st Volume ST_MBus_Info [} 216] Meter reading volume st Tariff1 ST_MBus_Info [} 216] Meter reading tariff 1 st Tariff2 ST_MBus_Info [} 216] Meter reading tariff 2 st Date ST_MBus_Info [} 216] Date of the due day st Date Future Due Da ST_MBus_Info [} 216] Date of the future due day y Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.2.2.10 Metrima Data types Description ST_MBus_F22 [} 218] Structure of the monthly values in the block FB_MBUS_SVM_F22_Ext [} 155] 4.2.2.10.1 ST_MBus_F22 Structure of the monthly values in the function block FB_MBUS_SVM_F22_Ext() [} 155]. TYPE ST_MBus_F22 : STRUCT st Energy : ST_MBus_Info; st Volume : ST_MBus_Info; st Volume2 : ST_MBus_Info; st Pulsecounter1 : ST_MBus_Info; st Pulsecounter2 : ST_MBus_Info; st Date : ST_MBus_Info; END_STRUCT END_TYPE 218 Version: 1.8.0 TE1000
## Page 219

Programming Name Type Description st Energy ST_MBus_Info [} 216] Meter reading energy st Volume ST_MBus_Info [} 216] Meter reading volume st Volume2 ST_MBus_Info [} 216] Meter reading volume st Pulsecounter1 ST_MBus_Info [} 216] Meter reading pulse counter 1 st Pulsecounter2 ST_MBus_Info [} 216] Meter reading pulse counter 2 st Date ST_MBus_Info [} 216] Datum Requirements Development Environment PLC library to include Twin CAT from v3.1.4020.14 Tc2_MBus from 3.3.5.0 4.3 GVLs 4.3.1 Param A parameter list for influencing various constants. VAR_GLOBAL CONSTANT c MBus_Max Data : INT := 40; c MBus_Max Telegrams : INT := 5; c MBus_Max Data Param : INT := 10; c MBus_Timeout Read Byte : TIME := T#1000ms; END_VAR Name Description c MBUS_Max Data The constant applies to all instances of the function blocks FB_MBUS_General() [} 80], FB_MBUS_General_Ext() [} 84] and FB_MBUS_General_Param() [} 88]. It indicates the maximum data volume expected in a meter telegram. c MBUS_Max Telegrams The constant applies to all instances of the function block FB_MBUS_General_Ext() [} 84]. It indicates the maximum number of telegrams to be expected. c MBUS_Max Data Param The constant applies to all instances of the function block FB_MBUS_General_Param() [} 88]. It indicates the maximum number of values to be displayed by the instances of function block FB_MBUS_General_Param() [} 88]. c MBus_Timeout Read Byte This constant applies to all blocks and defines the waiting time until a timeout error is reported when a byte is received. 4.4 Integration into Twin CAT 4.4.1 KL6781 with CX5120 This sample describes how to write a simple PLC program for M-Bus in Twin CAT and how to link it with the hardware. The task is to read a counter with four digital inputs. Sample: https://infosys.beckhoff.com/content/1033/tcplclib_tc2_mbus/Resources/6218378891.zip The Twin CAT project is available for download as *.zip file. This must first be unpacked locally so that the archive (*.tnzip file) is available for import into the Twin CAT project. TE1000 Version: 1.8.0 219
## Page 220

Programming Hardware Setting up the components The following hardware is required: • 1x CX5120 Embedded PC • 1x KL6781 M-Bus master terminal • 1x KL9010 end terminal Set up the hardware and the M-Bus components as described in the associated documentation. This example assumes that the counter address is known. Software Creation of the PLC program Create a new "Twin CAT XAE project" and a "Standard PLC project". Add the library Tc2_MBus under References in the PLC project. Generate a Global Variable List with the name GVL_MBus and create the following variables: VAR_GLOBAL st Com In AT %I* : ST_KL6781in Data22B; st Com Out AT %Q* : ST_KL6781out Data22B; st Com : ST_MBUS_Communication; END_VAR st Com In: Input variable for the M-Bus terminal (see ST_KL6781in Data22B [} 214]). st Com Out: Output variable for the M-Bus terminal (see ST_KL6781out Data22B [} 214]) st Com: Required for the communication with M-Bus (see ST_MBUS_Communication [} 215]). Create a program (CFC) for the background communication with M-Bus. The FB_MBUSKL6781 [} 18] block is called in this program. Make sure to link the communication block with st Com In, st Com Out and st Com. Create a MAIN program (CFC) in which the block FB_MBUS_REL_Pad In4 [} 167] is called up. Link the input usi Address of the counter block with the local variable usi Address and st Com with the global variable st Com. 220 Version: 1.8.0 TE1000
## Page 221

Programming Navigate to the task configuration section and configure the Plc Task. By way of example, the task is assigned priority 16 and a cycle time of 6 ms. Create a further task for the background communication. Assign a higher priority (smaller number) and a lower interval time to this task than the PLCTask. Add the program for the communication to this task. Further information on task configuration can be found in the description of the function block FB_MBUSKL6781 [} 18]. TE1000 Version: 1.8.0 221
## Page 222

Programming I/O configuration Select the CX as target system and initiate a search for its hardware. In the project instance within the PLC section, you can see that the input and output variables are assigned to the corresponding tasks. Now link the global variables of PLC program with the inputs and outputs of the Bus Terminals. Create the Solution and enable the configuration. When linking the data array, make sure that you select both the All types and Continuous options. Use the Shift key and the right mouse button to mark all data bytes of the terminal. 222 Version: 1.8.0 TE1000
## Page 223

Programming After starting the PLC, the current values are regularly read by the counter. TE1000 Version: 1.8.0 223
## Page 224

Appendix 5 Appendix 5.1 Support and Service Beckhoff and their partners around the world offer comprehensive support and service, making available fast and competent assistance with all questions related to Beckhoff products and system solutions. Download finder Our download finder contains all the files that we offer you for downloading. You will find application reports, technical documentation, technical drawings, configuration files and much more. The downloads are available in various formats. Beckhoff's branch offices and representatives Please contact your Beckhoff branch office or representative for local support and service on Beckhoff products! The addresses of Beckhoff's branch offices and representatives round the world can be found on our internet page: www.beckhoff.com You will also find further documentation for Beckhoff components there. Beckhoff Support Support offers you comprehensive technical assistance, helping you not only with the application of individual Beckhoff products, but also with other, wide-ranging services: • support • design, programming and commissioning of complex automation systems • and extensive training program for Beckhoff system components Hotline: +49 5246 963-157 e-mail: support@beckhoff.com Beckhoff Service The Beckhoff Service Center supports you in all matters of after-sales service: • on-site service • repair service • spare parts service • hotline service Hotline: +49 5246 963-460 e-mail: service@beckhoff.com Beckhoff Headquarters Beckhoff Automation Gmb H & Co. KG Huelshorstweg 20 33415 Verl Germany Phone: +49 5246 963-0 e-mail: info@beckhoff.com web: www.beckhoff.com 224 Version: 1.8.0 TE1000
## Page 225

Trademark statements Beckhoff®, Twin CAT®, Twin CAT/BSD®, TC/BSD®, Ether CAT®, Ether CAT G®, Ether CAT G10®, Ether CAT P®, Safety over Ether CAT®, Twin SAFE®, XFC®, XTS® and XPlanar® are registered trademarks of and licensed by Beckhoff Automation Gmb H.
## Page 226

More Information: www.beckhoff.com/te1000/ Beckhoff Automation Gmb H & Co. KG Hülshorstweg 20 33415 Verl Germany Phone: +49 5246 9630 info@beckhoff.com www.beckhoff.com
